---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ParametersList from '@xpack/docusaurus-plugin-doxygen/components/ParametersList'
import ParametersListItem from '@xpack/docusaurus-plugin-doxygen/components/ParametersListItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'
import SectionUser from '@xpack/docusaurus-plugin-doxygen/components/SectionUser'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `IROutliner.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/IPO/IROutliner.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/ipo/iroutliner-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/IRSimilarityIdentifier.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/irsimilarityidentifier-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/OptimizationRemarkEmitter.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Attributes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DIBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfoMetadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Mangler.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/mangler-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PassManager.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/IPO.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/ipo-h"
  isLocal="true" />
<IncludesListItem
  filePath="optional"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="vector"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/llvm">llvm</a></>}>
This is an optimization pass for GlobalISel generic memory operations. <a href="/docs/api/namespaces/llvm/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a></>}>
The <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> holds all the overarching information for outlining a set of regions that are structurally similar to one another, such as the types of the overall function, the output blocks, the sets of stores needed and a list of the different regions. <a href="/docs/api/structs/outlinablegroup/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Typedefs Index

<MembersIndex>

<MembersIndexItem
  type="using"
  name={<><a href="#ad0fabe111fc0db047a04c21481fa6aab">ArgLocWithBBCanon</a> = std::pair&lt; unsigned, unsigned &gt;</>}>
</MembersIndexItem>

<MembersIndexItem
  type="using"
  name={<><a href="#a69893e3a4e9fbee5b5aa9ac4b036dc5c">CanonList</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; unsigned, 2 &gt;</>}>
</MembersIndexItem>

<MembersIndexItem
  type="using"
  name={<><a href="#a0389cc3001a985e14dcff4067684ad70">PHINodeData</a> = std::pair&lt; <a href="#ad0fabe111fc0db047a04c21481fa6aab">ArgLocWithBBCanon</a>, <a href="#a69893e3a4e9fbee5b5aa9ac4b036dc5c">CanonList</a> &gt;</>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a4fcb90c9c38b3381765a891d0a61c1ea">alignOutputBlockWithAggFunc</a> (OutlinableGroup &amp;OG, OutlinableRegion &amp;Region, DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;OutputBBs, DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;EndBBs, const DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings, std::vector&lt; DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &gt; &amp;OutputStoreBBs)</>}>
For the outlined section, move needed the StoreInsts for the output registers into their own block. <a href="#a4fcb90c9c38b3381765a891d0a61c1ea">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a57d54880afa1fb74833cc7c43ad33377">analyzeAndPruneOutputBlocks</a> (DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;BlocksToPrune, OutlinableRegion &amp;Region)</>}>
Remove empty output blocks from the outlined region. <a href="#a57d54880afa1fb74833cc7c43ad33377">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a882dcfc2455d525e78a8bbf46863ace2">analyzeExitPHIsForOutputUses</a> (BasicBlock &#42;CurrentExitFromRegion, SmallPtrSet&lt; BasicBlock &#42;, 1 &gt; &amp;PotentialExitsFromRegion, DenseSet&lt; BasicBlock &#42; &gt; &amp;RegionBlocks, SetVector&lt; Value &#42; &gt; &amp;Outputs, DenseSet&lt; Value &#42; &gt; &amp;OutputsReplacedByPHINode, DenseSet&lt; Value &#42; &gt; &amp;OutputsWithNonPhiUses)</>}>
Test whether <code>CurrentExitFromRegion</code> contains any PhiNodes that should be considered outputs. <a href="#a882dcfc2455d525e78a8bbf46863ace2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a52a09c04ddc4ec6d039f1f11f01d019e">collectRegionsConstants</a> (OutlinableRegion &amp;Region, DenseMap&lt; unsigned, Constant &#42; &gt; &amp;GVNToConstant, DenseSet&lt; unsigned &gt; &amp;NotSame)</>}>
Find whether <code><a href="/docs/api/classes/llvm/region">Region</a></code> matches the global value numbering to <a href="/docs/api/classes/llvm/constant">Constant</a> mapping found so far. <a href="#a52a09c04ddc4ec6d039f1f11f01d019e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; bool &gt;</>}
  name={<><a href="#ac77f2569521257316a0f374b9a2682c5">constantMatches</a> (Value &#42;V, unsigned GVN, DenseMap&lt; unsigned, Constant &#42; &gt; &amp;GVNToConstant)</>}>
Find whether <code>V</code> matches the Constants previously found for the <code>GVN</code>. <a href="#ac77f2569521257316a0f374b9a2682c5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8120984c169f2ea17e785e7c6887702a">createAndInsertBasicBlocks</a> (DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;OldMap, DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;NewMap, Function &#42;ParentFunc, Twine BaseName)</>}>
Takes in a mapping, <code>OldMap</code> of ConstantValues to BasicBlocks, sorts keys, before creating a basic block for each <code>NewMap</code>, and inserting into the new block. <a href="#a8120984c169f2ea17e785e7c6887702a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ae86fef7fc5831c2514bff95bdf784d09">createSwitchStatement</a> (Module &amp;M, OutlinableGroup &amp;OG, DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;EndBBs, std::vector&lt; DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &gt; &amp;OutputStoreBBs)</>}>
Create the switch statement for outlined function to differentiate between all the output blocks. <a href="#ae86fef7fc5831c2514bff95bdf784d09">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/hash-code">hash&#95;code</a></>}
  name={<><a href="#a652d50395284a0dec463c533709bc231">encodePHINodeData</a> (PHINodeData &amp;PND)</>}>
Encode <code>PND</code> as an integer for easy lookup based on the argument location, the parent <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> canonical numbering, and the canonical numbering of the values stored in the <a href="/docs/api/classes/llvm/phinode">PHINode</a>. <a href="#a652d50395284a0dec463c533709bc231">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a4e06ebf129ddfb3b33a64f1a456cfc24">fillOverallFunction</a> (Module &amp;M, OutlinableGroup &amp;CurrentGroup, std::vector&lt; DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &gt; &amp;OutputStoreBBs, std::vector&lt; Function &#42; &gt; &amp;FuncsToRemove, const DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings)</>}>
Fill the new function that will serve as the replacement function for all of the extracted regions of a certain structure from the first region in the list of regions. <a href="#a4e06ebf129ddfb3b33a64f1a456cfc24">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a26b0639ceb3f28de2e6a283098c525b2">findCanonNumsForPHI</a> (PHINode &#42;PN, OutlinableRegion &amp;Region, const DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings, SmallVector&lt; std::pair&lt; unsigned, BasicBlock &#42; &gt; &gt; &amp;CanonNums, bool ReplacedWithOutlinedCall=true)</>}>
Find the canonical numbering for the incoming Values into the <a href="/docs/api/classes/llvm/phinode">PHINode</a> <code>PN</code>. <a href="#a26b0639ceb3f28de2e6a283098c525b2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#acda959f961048eba09125aba48d1142e">findConstants</a> (IRSimilarityCandidate &amp;C, DenseSet&lt; unsigned &gt; &amp;NotSame, std::vector&lt; unsigned &gt; &amp;Inputs)</>}>
Find the constants that will need to be lifted into arguments as they are not the same in each instance of the region. <a href="#acda959f961048eba09125aba48d1142e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></>}
  name={<><a href="#a8b12ae89227758cb5684cc7cf25a7f43">findCostForOutputBlocks</a> (Module &amp;M, OutlinableGroup &amp;CurrentGroup, TargetTransformInfo &amp;TTI)</>}>
Find the extra instructions needed to handle any output values for the region. <a href="#a8b12ae89227758cb5684cc7cf25a7f43">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; unsigned &gt;</>}
  name={<><a href="#af714eb55aced0ac27294c881d8be6ecb">findDuplicateOutputBlock</a> (DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;OutputBBs, std::vector&lt; DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &gt; &amp;OutputStoreBBs)</>}>
It is possible that there is a basic block that already performs the same stores. <a href="#af714eb55aced0ac27294c881d8be6ecb">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a9148948069532c9a5e1b59e3668b8cc3">findExtractedInputToOverallInputMapping</a> (OutlinableRegion &amp;Region, std::vector&lt; unsigned &gt; &amp;InputGVNs, SetVector&lt; Value &#42; &gt; &amp;ArgInputs)</>}>
Look over the inputs and map each input argument to an argument in the overall function for the OutlinableRegions. <a href="#a9148948069532c9a5e1b59e3668b8cc3">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a4eb66b98a828331ed6cb79ae82c0336f">findExtractedOutputToOverallOutputMapping</a> (Module &amp;M, OutlinableRegion &amp;Region, SetVector&lt; Value &#42; &gt; &amp;Outputs)</>}>
Create a mapping of the output arguments for the <code><a href="/docs/api/classes/llvm/region">Region</a></code> to the output arguments of the overall outlined function. <a href="#a4eb66b98a828331ed6cb79ae82c0336f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</>}
  name={<><a href="#af30ff2458bb283e423c1fc242a468579">findOrCreatePHIBlock</a> (OutlinableGroup &amp;Group, Value &#42;RetVal)</>}>
Find or create a <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> in the outlined function containing PhiBlocks for <code>RetVal</code>. <a href="#af30ff2458bb283e423c1fc242a468579">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;</>}
  name={<><a href="#a556a77d9b9acf322358b2c4131986b13">findOrCreatePHIInBlock</a> (PHINode &amp;PN, OutlinableRegion &amp;Region, BasicBlock &#42;OverallPhiBlock, const DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings, DenseSet&lt; PHINode &#42; &gt; &amp;UsedPHIs)</>}>
Find, or add <a href="/docs/api/classes/llvm/phinode">PHINode</a> <code>PN</code> to the combined <a href="/docs/api/classes/llvm/phinode">PHINode</a> Block <code>OverallPHIBlock</code> in order to condense the number of instructions added to the outlined function. <a href="#a556a77d9b9acf322358b2c4131986b13">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#ab0d72084e637eaecbbadd192d547ef8e">findOutputMapping</a> (const DenseMap&lt; Value &#42;, Value &#42; &gt; OutputMappings, Value &#42;Input)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> the <code>OutputMappings</code> structure for value <code><a href="/docs/api/classes/input">Input</a></code>, if it exists it has been used as an output for outlining, and has been renamed, and we return the new value, otherwise, we return the same value. <a href="#ab0d72084e637eaecbbadd192d547ef8e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#ab4b0641c5ffeeb3249b4ce9bb98c1a2d">findOutputValueInRegion</a> (OutlinableRegion &amp;Region, unsigned OutputCanon)</>}>
For the <code>OutputCanon</code> number passed in find the value represented by this canonical number. <a href="#ab4b0641c5ffeeb3249b4ce9bb98c1a2d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a48d81e3f58b8db143bc85763d25dbc7a">getCodeExtractorArguments</a> (OutlinableRegion &amp;Region, std::vector&lt; unsigned &gt; &amp;InputGVNs, DenseSet&lt; unsigned &gt; &amp;NotSame, DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings, SetVector&lt; Value &#42; &gt; &amp;ArgInputs, SetVector&lt; Value &#42; &gt; &amp;Outputs)</>}>
Find the input GVNs and the output values for a region of Instructions. <a href="#a48d81e3f58b8db143bc85763d25dbc7a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; unsigned &gt;</>}
  name={<><a href="#a1c7b2c4c8824cfb8d35c97f6923c3fe2">getGVNForPHINode</a> (OutlinableRegion &amp;Region, PHINode &#42;PN, DenseSet&lt; BasicBlock &#42; &gt; &amp;Blocks, unsigned AggArgIdx)</>}>
Create a special GVN for PHINodes that will be used outside of the region. <a href="#a1c7b2c4c8824cfb8d35c97f6923c3fe2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a202f8ebe30581a7e75bcedc9dee531af">getPassedArgumentAndAdjustArgumentLocation</a> (const Argument &#42;A, const OutlinableRegion &amp;Region)</>}>
For the function call now representing the <code><a href="/docs/api/classes/llvm/region">Region</a></code>, find the passed value to that call that represents <a href="/docs/api/classes/llvm/argument">Argument</a> <code>A</code> at the call location if the call has only been replaced by the call to the aggregate function. <a href="#a202f8ebe30581a7e75bcedc9dee531af">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#ad69884d9bf751011f8f9049542bbbd01">getPassedArgumentInAlreadyOutlinedFunction</a> (const Argument &#42;A, const OutlinableRegion &amp;Region)</>}>
For the function call now representing the <code><a href="/docs/api/classes/llvm/region">Region</a></code>, find the passed value to that call that represents <a href="/docs/api/classes/llvm/argument">Argument</a> <code>A</code> at the call location if the call has already been replaced with a call to the overall, aggregate function. <a href="#ad69884d9bf751011f8f9049542bbbd01">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8ad786f21829d9e92d31cc0b80c53dbb">getSortedConstantKeys</a> (std::vector&lt; Value &#42; &gt; &amp;SortedKeys, DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;Map)</>}>
A function to sort the keys of <code>Map</code>, which must be a mapping of constant values to basic blocks and return it in <code>SortedKeys</code>. <a href="#a8ad786f21829d9e92d31cc0b80c53dbb">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;</>}
  name={<><a href="#aac5cfc936b6963f4e848982328d39e8e">getSubprogramOrNull</a> (OutlinableGroup &amp;Group)</>}>
Get the subprogram if it exists for one of the outlined regions. <a href="#aac5cfc936b6963f4e848982328d39e8e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a9165dd298666d75ed2e5be7d5d8b50e5">mapInputsToGVNs</a> (IRSimilarityCandidate &amp;C, SetVector&lt; Value &#42; &gt; &amp;CurrentInputs, const DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings, std::vector&lt; unsigned &gt; &amp;EndInputNumbers)</>}>
Find the GVN for the inputs that have been found by the <a href="/docs/api/classes/llvm/codeextractor">CodeExtractor</a>. <a href="#a9165dd298666d75ed2e5be7d5d8b50e5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a3afc8c0c69b0c55edce3be13d5b7cc32">moveBBContents</a> (BasicBlock &amp;SourceBB, BasicBlock &amp;TargetBB)</>}>
Move the contents of <code>SourceBB</code> to before the last instruction of <code>TargetBB</code>. <a href="#a3afc8c0c69b0c55edce3be13d5b7cc32">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a4047976de351f78967fba27df7a6361f">moveFunctionData</a> (Function &amp;Old, Function &amp;New, DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;NewEnds)</>}>
Move each <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> in <code>Old</code> to <code>New</code>. <a href="#a4047976de351f78967fba27df7a6361f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a3bc949e06e148a6d2879eb45ca164146">nextIRInstructionDataMatchesNextInst</a> (IRInstructionData &amp;ID)</>}>
Checks that the next instruction in the InstructionDataList matches the next instruction in the module. <a href="#a3bc949e06e148a6d2879eb45ca164146">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a84e785627d5ab55370b5fa402ad7193f">outputHasNonPHI</a> (Value &#42;V, unsigned PHILoc, PHINode &amp;PN, SmallPtrSet&lt; BasicBlock &#42;, 1 &gt; &amp;Exits, DenseSet&lt; BasicBlock &#42; &gt; &amp;BlocksInRegion)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the <code>V</code> has any uses outside of the region other than <code>PN</code>. <a href="#a84e785627d5ab55370b5fa402ad7193f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a09e9f16b4a1aaf539000b95bf5442155">remapExtractedInputs</a> (const ArrayRef&lt; Value &#42; &gt; ArgInputs, const DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings, SetVector&lt; Value &#42; &gt; &amp;RemappedArgInputs)</>}>
Find the original value for the <code>ArgInput</code> values if any one of them was replaced during a previous extraction. <a href="#a09e9f16b4a1aaf539000b95bf5442155">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a96b5bd50d8e96b4c76ffc26508ce774d">replaceArgumentUses</a> (OutlinableRegion &amp;Region, DenseMap&lt; Value &#42;, BasicBlock &#42; &gt; &amp;OutputBBs, const DenseMap&lt; Value &#42;, Value &#42; &gt; &amp;OutputMappings, bool FirstFunction=false)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;</>}
  name={<><a href="#a7e2cad7ab18db9a3c940afc609c223dc">replaceCalledFunction</a> (Module &amp;M, OutlinableRegion &amp;Region)</>}>
Replace the extracted function in the <a href="/docs/api/classes/llvm/region">Region</a> with a call to the overall function constructed from the deduplicated similar regions, replacing and remapping the values passed to the extracted function as arguments to the new arguments of the overall function. <a href="#a7e2cad7ab18db9a3c940afc609c223dc">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ace02ac07a3f704ffd345301bff92e5a8">replaceConstants</a> (OutlinableRegion &amp;Region)</>}>
Within an extracted function, replace the constants that need to be lifted into arguments with the actual argument. <a href="#ace02ac07a3f704ffd345301bff92e5a8">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8e5c4577c64728c435eca5f4f7e163ab">replaceTargetsFromPHINode</a> (BasicBlock &#42;PHIBlock, BasicBlock &#42;Find, BasicBlock &#42;Replace, DenseSet&lt; BasicBlock &#42; &gt; &amp;Included)</>}>
Rewrite the BranchInsts in the incoming blocks to <code>PHIBlock</code> that are found in <code>Included</code> to branch to <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> <code>Replace</code> if they currently branch to the <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> <code>Find</code>. <a href="#a8e5c4577c64728c435eca5f4f7e163ab">More...</a>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a415af6f4421aa68820b3279b48acd928">EnableLinkOnceODRIROutlining</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a2dfbf70cabc04c37f6f46b2c312b2506">NoCostModel</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;iroutliner&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Typedefs

### ArgLocWithBBCanon {#ad0fabe111fc0db047a04c21481fa6aab}

<MemberDefinition
  prototype={<>using ArgLocWithBBCanon =  std::pair&lt;unsigned, unsigned&gt;</>}>

Definition at line <a href="#l01141">1141</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### CanonList {#a69893e3a4e9fbee5b5aa9ac4b036dc5c}

<MemberDefinition
  prototype={<>using CanonList =  SmallVector&lt;unsigned, 2&gt;</>}>

Definition at line <a href="#l01143">1143</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### PHINodeData {#a0389cc3001a985e14dcff4067684ad70}

<MemberDefinition
  prototype={<>using PHINodeData =  std::pair&lt;ArgLocWithBBCanon, CanonList&gt;</>}>

Definition at line <a href="#l01146">1146</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Functions

### alignOutputBlockWithAggFunc() {#a4fcb90c9c38b3381765a891d0a61c1ea}

<MemberDefinition
  prototype={<>static void alignOutputBlockWithAggFunc (<a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp; OG, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; OutputBBs, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; EndBBs, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &gt; &amp; OutputStoreBBs)</>}
  labels = {["static"]}>
For the outlined section, move needed the StoreInsts for the output registers into their own block.

Then, determine if there is a duplicate output block already created.


<ParametersList title="Parameters">
<ParametersListItem name="[in] OG">- The <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> of regions to be outlined.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> that is being analyzed.</ParametersListItem>
<ParametersListItem name="[inout] OutputBBs">- the blocks that stores for this region will be placed in.</ParametersListItem>
<ParametersListItem name="[in] EndBBs">- the final blocks of the extracted function.</ParametersListItem>
<ParametersListItem name="[in] OutputMappings">- OutputMappings the mapping of values that have been replaced by a new output value.</ParametersListItem>
<ParametersListItem name="[inout] OutputStoreBBs">- The existing output blocks.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l02069">2069</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### analyzeAndPruneOutputBlocks() {#a57d54880afa1fb74833cc7c43ad33377}

<MemberDefinition
  prototype={<>static bool analyzeAndPruneOutputBlocks (<a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; BlocksToPrune, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region)</>}
  labels = {["static"]}>
Remove empty output blocks from the outlined region.

<ParametersList title="Parameters">
<ParametersListItem name="BlocksToPrune">- Mapping of return values output blocks for the <code><a href="/docs/api/classes/llvm/region">Region</a></code>.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> we are analyzing.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l02022">2022</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### analyzeExitPHIsForOutputUses() {#a882dcfc2455d525e78a8bbf46863ace2}

<MemberDefinition
  prototype={<>static void analyzeExitPHIsForOutputUses (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; CurrentExitFromRegion, <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, 1 &gt; &amp; PotentialExitsFromRegion, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; RegionBlocks, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; Outputs, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputsReplacedByPHINode, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputsWithNonPhiUses)</>}
  labels = {["static"]}>
Test whether <code>CurrentExitFromRegion</code> contains any PhiNodes that should be considered outputs.

A PHINodes is an output when more than one incoming value has been marked by the <a href="/docs/api/classes/llvm/codeextractor">CodeExtractor</a> as an output.


<ParametersList title="Parameters">
<ParametersListItem name="CurrentExitFromRegion">&#91;in&#93; - The block to analyze.</ParametersListItem>
<ParametersListItem name="PotentialExitsFromRegion">&#91;in&#93; - The potential exit blocks from the region.</ParametersListItem>
<ParametersListItem name="RegionBlocks">&#91;in&#93; - The basic blocks in the region.</ParametersListItem>
<ParametersListItem name="Outputs">&#91;in, out&#93; - The existing outputs for the region, we may add PHINodes to this as we find that they replace output values.</ParametersListItem>
<ParametersListItem name="OutputsReplacedByPHINode">&#91;out&#93; - A set containing outputs that are totally replaced by a <a href="/docs/api/classes/llvm/phinode">PHINode</a>.</ParametersListItem>
<ParametersListItem name="OutputsWithNonPhiUses">&#91;out&#93; - A set containing outputs that are used in PHINodes, but have other uses, and should still be considered outputs.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l01093">1093</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### collectRegionsConstants() {#a52a09c04ddc4ec6d039f1f11f01d019e}

<MemberDefinition
  prototype={<>static bool collectRegionsConstants (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; unsigned, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; &gt; &amp; GVNToConstant, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; unsigned &gt; &amp; NotSame)</>}
  labels = {["static"]}>
Find whether <code><a href="/docs/api/classes/llvm/region">Region</a></code> matches the global value numbering to <a href="/docs/api/classes/llvm/constant">Constant</a> mapping found so far.

<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> we are checking for constants</ParametersListItem>
<ParametersListItem name="GVNToConstant">- The mapping of global value number to Constants.</ParametersListItem>
<ParametersListItem name="NotSame">- The set of global value numbers that do not have the same constant in each region.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
true if all Constants are the same in every use of a <a href="/docs/api/classes/llvm/constant">Constant</a> in <code><a href="/docs/api/classes/llvm/region">Region</a></code> and false if not
</SectionUser>

Definition at line <a href="#l00549">549</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### constantMatches() {#ac77f2569521257316a0f374b9a2682c5}

<MemberDefinition
  prototype={<>static std::optional&lt; bool &gt; constantMatches (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, unsigned GVN, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; unsigned, <a href="/docs/api/classes/llvm/constant">Constant</a> &#42; &gt; &amp; GVNToConstant)</>}
  labels = {["static"]}>
Find whether <code>V</code> matches the Constants previously found for the <code>GVN</code>.

<ParametersList title="Parameters">
<ParametersListItem name="V">- The value to check for consistency.</ParametersListItem>
<ParametersListItem name="GVN">- The global value number assigned to <code>V</code>.</ParametersListItem>
<ParametersListItem name="GVNToConstant">- The mapping of global value number to Constants.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
true if the <a href="/docs/api/classes/llvm/value">Value</a> matches the <a href="/docs/api/classes/llvm/constant">Constant</a> mapped to by V and false if it <code>V</code> is a <a href="/docs/api/classes/llvm/constant">Constant</a> but does not match.
</SectionUser>


<SectionUser title="Returns">
std::nullopt if <code>V</code> is not a <a href="/docs/api/classes/llvm/constant">Constant</a>.
</SectionUser>

Definition at line <a href="#l00463">463</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### createAndInsertBasicBlocks() {#a8120984c169f2ea17e785e7c6887702a}

<MemberDefinition
  prototype={<>static void createAndInsertBasicBlocks (<a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; OldMap, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; NewMap, <a href="/docs/api/classes/llvm/function">Function</a> &#42; ParentFunc, <a href="/docs/api/classes/llvm/twine">Twine</a> BaseName)</>}
  labels = {["static"]}>
Takes in a mapping, <code>OldMap</code> of ConstantValues to BasicBlocks, sorts keys, before creating a basic block for each <code>NewMap</code>, and inserting into the new block.

Each <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> is named with the scheme &quot;&lt;basename&gt;&#95;&lt;key&#95;idx&gt;&quot;.


<ParametersList title="Parameters">
<ParametersListItem name="OldMap">&#91;in&#93; - The mapping to base the new mapping off of.</ParametersListItem>
<ParametersListItem name="NewMap">&#91;out&#93; - The output mapping using the keys of <code>OldMap</code>.</ParametersListItem>
<ParametersListItem name="ParentFunc">&#91;in&#93; - The function to put the new basic block in.</ParametersListItem>
<ParametersListItem name="BaseName">&#91;in&#93; - The start of the <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> names to be appended to by an index value.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l02124">2124</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### createSwitchStatement() {#ae86fef7fc5831c2514bff95bdf784d09}

<MemberDefinition
  prototype={<>void createSwitchStatement (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp; OG, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; EndBBs, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &gt; &amp; OutputStoreBBs)</>}>
Create the switch statement for outlined function to differentiate between all the output blocks.

For the outlined section, determine if an outlined block already exists that matches the needed stores for the extracted section. 
<ParametersList title="Parameters">
<ParametersListItem name="[in] M">- The module we are outlining from.</ParametersListItem>
<ParametersListItem name="[in] OG">- The group of regions to be outlined.</ParametersListItem>
<ParametersListItem name="[in] EndBBs">- The final blocks of the extracted function.</ParametersListItem>
<ParametersListItem name="[inout] OutputStoreBBs">- The existing output blocks.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l02150">2150</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### encodePHINodeData() {#a652d50395284a0dec463c533709bc231}

<MemberDefinition
  prototype={<>static hash&#95;code encodePHINodeData (<a href="#a0389cc3001a985e14dcff4067684ad70">PHINodeData</a> &amp; PND)</>}
  labels = {["static"]}>
Encode <code>PND</code> as an integer for easy lookup based on the argument location, the parent <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> canonical numbering, and the canonical numbering of the values stored in the <a href="/docs/api/classes/llvm/phinode">PHINode</a>.

<ParametersList title="Parameters">
<ParametersListItem name="PND">- The data to hash.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
The hash code of <code>PND</code>.
</SectionUser>

Definition at line <a href="#l01154">1154</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### fillOverallFunction() {#a4e06ebf129ddfb3b33a64f1a456cfc24}

<MemberDefinition
  prototype={<>static void fillOverallFunction (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp; CurrentGroup, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &gt; &amp; OutputStoreBBs, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; <a href="/docs/api/classes/llvm/function">Function</a> &#42; &gt; &amp; FuncsToRemove, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings)</>}
  labels = {["static"]}>
Fill the new function that will serve as the replacement function for all of the extracted regions of a certain structure from the first region in the list of regions.

Replace this first region&#39;s extracted function with the new overall function.


<ParametersList title="Parameters">
<ParametersListItem name="[in] M">- The module we are outlining from.</ParametersListItem>
<ParametersListItem name="[in] CurrentGroup">- The group of regions to be outlined.</ParametersListItem>
<ParametersListItem name="[inout] OutputStoreBBs">- The output blocks for each different set of stores needed for the different functions.</ParametersListItem>
<ParametersListItem name="[inout] FuncsToRemove">- Extracted functions to erase from module once outlining is complete.</ParametersListItem>
<ParametersListItem name="[in] OutputMappings">- Extracted functions to erase from module once outlining is complete.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l02243">2243</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findCanonNumsForPHI() {#a26b0639ceb3f28de2e6a283098c525b2}

<MemberDefinition
  prototype={<>static void findCanonNumsForPHI (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PN, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings, <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; std::pair&lt; unsigned, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &gt; &amp; CanonNums, bool ReplacedWithOutlinedCall=<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#af6d5cafbdfc5313e65d990120021a3ec">true</a>)</>}
  labels = {["static"]}>
Find the canonical numbering for the incoming Values into the <a href="/docs/api/classes/llvm/phinode">PHINode</a> <code>PN</code>.

<ParametersList title="Parameters">
<ParametersListItem name="PN">&#91;in&#93; - The <a href="/docs/api/classes/llvm/phinode">PHINode</a> that we are finding the canonical numbers for.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">&#91;in&#93; - The <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> containing <code>PN</code>.</ParametersListItem>
<ParametersListItem name="OutputMappings">&#91;in&#93; - The mapping of output values from outlined region to their original values.</ParametersListItem>
<ParametersListItem name="CanonNums">&#91;out&#93; - The canonical numbering for the incoming values to <code>PN</code> paired with their incoming block.</ParametersListItem>
<ParametersListItem name="ReplacedWithOutlinedCall">- A flag to use the extracted function call of <code><a href="/docs/api/classes/llvm/region">Region</a></code> rather than the overall function&#39;s call.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l01634">1634</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findConstants() {#acda959f961048eba09125aba48d1142e}

<MemberDefinition
  prototype={<>static void findConstants (<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp; C, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; unsigned &gt; &amp; NotSame, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; unsigned &gt; &amp; Inputs)</>}
  labels = {["static"]}>
Find the constants that will need to be lifted into arguments as they are not the same in each instance of the region.

<ParametersList title="Parameters">
<ParametersListItem name="[in] C">- The <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> containing the region we are analyzing.</ParametersListItem>
<ParametersListItem name="[in] NotSame">- The set of global value numbers that do not have a single <a href="/docs/api/classes/llvm/constant">Constant</a> across all OutlinableRegions similar to <code>C</code>.</ParametersListItem>
<ParametersListItem name="[out] Inputs">- The list containing the global value numbers of the arguments needed for the region of code.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00778">778</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findCostForOutputBlocks() {#a8b12ae89227758cb5684cc7cf25a7f43}

<MemberDefinition
  prototype={<>static InstructionCost findCostForOutputBlocks (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp; CurrentGroup, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
Find the extra instructions needed to handle any output values for the region.

<ParametersList title="Parameters">
<ParametersListItem name="[in] M">- The <a href="/docs/api/classes/llvm/module">Module</a> to outline from.</ParametersListItem>
<ParametersListItem name="[in] CurrentGroup">- The collection of OutlinableRegions to analyze.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068&quot;>TTI</a>">- The <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> used to collect information for new instruction costs.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
the additional cost to handle the outputs.
</SectionUser>

Definition at line <a href="#l02556">2556</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findDuplicateOutputBlock() {#af714eb55aced0ac27294c881d8be6ecb}

<MemberDefinition
  prototype={<>std::optional&lt; unsigned &gt; findDuplicateOutputBlock (<a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; OutputBBs, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &gt; &amp; OutputStoreBBs)</>}>
It is possible that there is a basic block that already performs the same stores.

This returns a duplicate block, if it exists


<ParametersList title="Parameters">
<ParametersListItem name="OutputBBs">&#91;in&#93; the blocks we are looking for a duplicate of.</ParametersListItem>
<ParametersListItem name="OutputStoreBBs">&#91;in&#93; The existing output blocks.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
an optional value with the number output block if there is a match.
</SectionUser>

Definition at line <a href="#l01967">1967</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findExtractedInputToOverallInputMapping() {#a9148948069532c9a5e1b59e3668b8cc3}

<MemberDefinition
  prototype={<>static void findExtractedInputToOverallInputMapping (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; unsigned &gt; &amp; InputGVNs, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; ArgInputs)</>}
  labels = {["static"]}>
Look over the inputs and map each input argument to an argument in the overall function for the OutlinableRegions.

This creates a way to replace the arguments of the extracted function with the arguments of the new overall function.


<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The region of code to be analyzed.</ParametersListItem>
<ParametersListItem name="[in] InputGVNs">- The global value numbering of the input values collected.</ParametersListItem>
<ParametersListItem name="[in] ArgInputs">- The values of the arguments to the extracted function.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00934">934</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findExtractedOutputToOverallOutputMapping() {#a4eb66b98a828331ed6cb79ae82c0336f}

<MemberDefinition
  prototype={<>static void findExtractedOutputToOverallOutputMapping (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; Outputs)</>}
  labels = {["static"]}>
Create a mapping of the output arguments for the <code><a href="/docs/api/classes/llvm/region">Region</a></code> to the output arguments of the overall outlined function.

<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The region of code to be analyzed.</ParametersListItem>
<ParametersListItem name="[in] Outputs">- The values found by the code extractor.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l01276">1276</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findOrCreatePHIBlock() {#af30ff2458bb283e423c1fc242a468579}

<MemberDefinition
  prototype={<>static BasicBlock &#42; findOrCreatePHIBlock (<a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp; Group, <a href="/docs/api/classes/llvm/value">Value</a> &#42; RetVal)</>}
  labels = {["static"]}>
Find or create a <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> in the outlined function containing PhiBlocks for <code>RetVal</code>.

<ParametersList title="Parameters">
<ParametersListItem name="Group">- The <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> containing the information about the overall outlined function.</ParametersListItem>
<ParametersListItem name="RetVal">- The return value or exit option that we are currently evaluating.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
The found or newly created <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> to contain the needed PHINodes to be used as outputs.
</SectionUser>

Definition at line <a href="#l01540">1540</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findOrCreatePHIInBlock() {#a556a77d9b9acf322358b2c4131986b13}

<MemberDefinition
  prototype={<>static PHINode &#42; findOrCreatePHIInBlock (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp; PN, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; OverallPhiBlock, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; &gt; &amp; UsedPHIs)</>}
  labels = {["static"]}>
Find, or add <a href="/docs/api/classes/llvm/phinode">PHINode</a> <code>PN</code> to the combined <a href="/docs/api/classes/llvm/phinode">PHINode</a> Block <code>OverallPHIBlock</code> in order to condense the number of instructions added to the outlined function.

<ParametersList title="Parameters">
<ParametersListItem name="PN">&#91;in&#93; - The <a href="/docs/api/classes/llvm/phinode">PHINode</a> that we are finding the canonical numbers for.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">&#91;in&#93; - The <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> containing <code>PN</code>.</ParametersListItem>
<ParametersListItem name="OverallPhiBlock">&#91;in&#93; - The overall PHIBlock we are trying to find <code>PN</code> in.</ParametersListItem>
<ParametersListItem name="OutputMappings">&#91;in&#93; - The mapping of output values from outlined region to their original values.</ParametersListItem>
<ParametersListItem name="UsedPHIs">&#91;in, out&#93; - The PHINodes in the block that have already been matched.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
the newly found or created <a href="/docs/api/classes/llvm/phinode">PHINode</a> in <code>OverallPhiBlock</code>.
</SectionUser>

Definition at line <a href="#l01678">1678</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findOutputMapping() {#ab0d72084e637eaecbbadd192d547ef8e}

<MemberDefinition
  prototype={<>static Value &#42; findOutputMapping (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; OutputMappings, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Input)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> the <code>OutputMappings</code> structure for value <code><a href="/docs/api/classes/input">Input</a></code>, if it exists it has been used as an output for outlining, and has been renamed, and we return the new value, otherwise, we return the same value.

<ParametersList title="Parameters">
<ParametersListItem name="OutputMappings">&#91;in&#93; - The mapping of values to their renamed value after being used as an output for an outlined region.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/input&quot;>Input</a>">&#91;in&#93; - The value to find the remapped value of, if it exists.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
The remapped value if it has been renamed, and the same value if has not.
</SectionUser>

Definition at line <a href="#l00530">530</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### findOutputValueInRegion() {#ab4b0641c5ffeeb3249b4ce9bb98c1a2d}

<MemberDefinition
  prototype={<>static Value &#42; findOutputValueInRegion (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, unsigned OutputCanon)</>}
  labels = {["static"]}>
For the <code>OutputCanon</code> number passed in find the value represented by this canonical number.

If it is from a <a href="/docs/api/classes/llvm/phinode">PHINode</a>, we pick the first incoming value and return that <a href="/docs/api/classes/llvm/value">Value</a> instead.


<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> to get the <a href="/docs/api/classes/llvm/value">Value</a> from.</ParametersListItem>
<ParametersListItem name="OutputCanon">- The canonical number to find the <a href="/docs/api/classes/llvm/value">Value</a> from.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
The <a href="/docs/api/classes/llvm/value">Value</a> represented by a canonical number <code>OutputCanon</code> in <code><a href="/docs/api/classes/llvm/region">Region</a></code>.
</SectionUser>

Definition at line <a href="#l02504">2504</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### getCodeExtractorArguments() {#a48d81e3f58b8db143bc85763d25dbc7a}

<MemberDefinition
  prototype={<>static void getCodeExtractorArguments (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; unsigned &gt; &amp; InputGVNs, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; unsigned &gt; &amp; NotSame, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; ArgInputs, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; Outputs)</>}
  labels = {["static"]}>
Find the input GVNs and the output values for a region of Instructions.

Using the code extractor, we collect the inputs to the extracted function.

The <code><a href="/docs/api/classes/llvm/region">Region</a></code> can be identified as needing to be ignored in this function. It should be checked whether it should be ignored after a call to this function.


<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The region of code to be analyzed.</ParametersListItem>
<ParametersListItem name="[out] InputGVNs">- The global value numbers for the extracted arguments.</ParametersListItem>
<ParametersListItem name="[in] NotSame">- The global value numbers in the region that do not have the same constant value in the regions structurally similar to <code><a href="/docs/api/classes/llvm/region">Region</a></code>.</ParametersListItem>
<ParametersListItem name="[in] OutputMappings">- The mapping of values that have been replaced by a new output value after extraction.</ParametersListItem>
<ParametersListItem name="[out] ArgInputs">- The values of the inputs to the extracted function.</ParametersListItem>
<ParametersListItem name="[out] Outputs">- The set of values extracted by the <a href="/docs/api/classes/llvm/codeextractor">CodeExtractor</a> as outputs.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00863">863</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### getGVNForPHINode() {#a1c7b2c4c8824cfb8d35c97f6923c3fe2}

<MemberDefinition
  prototype={<>static std::optional&lt; unsigned &gt; getGVNForPHINode (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; PN, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; Blocks, unsigned AggArgIdx)</>}
  labels = {["static"]}>
Create a special GVN for PHINodes that will be used outside of the region.

We create a hash code based on the Canonical number of the parent <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a>, the canonical numbering of the values stored in the <a href="/docs/api/classes/llvm/phinode">PHINode</a> and the aggregate argument location. This is used to find whether this <a href="/docs/api/classes/llvm/phinode">PHINode</a> type has been given a canonical numbering already. If not, we assign it a value and store it for later use. The value is returned to identify different output schemes for the set of regions.


<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The region that <code>PN</code> is an output for.</ParametersListItem>
<ParametersListItem name="PN">- The <a href="/docs/api/classes/llvm/phinode">PHINode</a> we are analyzing.</ParametersListItem>
<ParametersListItem name="Blocks">- The blocks for the region we are analyzing.</ParametersListItem>
<ParametersListItem name="AggArgIdx">- The argument <code>PN</code> will be stored into.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
An optional holding the assigned canonical number, or std::nullopt if there is some attribute of the <a href="/docs/api/classes/llvm/phinode">PHINode</a> blocking it from being used.
</SectionUser>

Definition at line <a href="#l01174">1174</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### getPassedArgumentAndAdjustArgumentLocation() {#a202f8ebe30581a7e75bcedc9dee531af}

<MemberDefinition
  prototype={<>static Value &#42; getPassedArgumentAndAdjustArgumentLocation (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42; A, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region)</>}
  labels = {["static"]}>
For the function call now representing the <code><a href="/docs/api/classes/llvm/region">Region</a></code>, find the passed value to that call that represents <a href="/docs/api/classes/llvm/argument">Argument</a> <code>A</code> at the call location if the call has only been replaced by the call to the aggregate function.

<ParametersList title="Parameters">
<ParametersListItem name="A">- The <a href="/docs/api/classes/llvm/argument">Argument</a> to get the passed value for.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The extracted <a href="/docs/api/classes/llvm/region">Region</a> corresponding to the outlined function.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
The <a href="/docs/api/classes/llvm/value">Value</a> representing <code>A</code> at the call site.
</SectionUser>

Definition at line <a href="#l01609">1609</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### getPassedArgumentInAlreadyOutlinedFunction() {#ad69884d9bf751011f8f9049542bbbd01}

<MemberDefinition
  prototype={<>static Value &#42; getPassedArgumentInAlreadyOutlinedFunction (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42; A, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region)</>}
  labels = {["static"]}>
For the function call now representing the <code><a href="/docs/api/classes/llvm/region">Region</a></code>, find the passed value to that call that represents <a href="/docs/api/classes/llvm/argument">Argument</a> <code>A</code> at the call location if the call has already been replaced with a call to the overall, aggregate function.

<ParametersList title="Parameters">
<ParametersListItem name="A">- The <a href="/docs/api/classes/llvm/argument">Argument</a> to get the passed value for.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The extracted <a href="/docs/api/classes/llvm/region">Region</a> corresponding to the outlined function.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
The <a href="/docs/api/classes/llvm/value">Value</a> representing <code>A</code> at the call site.
</SectionUser>

Definition at line <a href="#l01593">1593</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### getSortedConstantKeys() {#a8ad786f21829d9e92d31cc0b80c53dbb}

<MemberDefinition
  prototype={<>static void getSortedConstantKeys (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; SortedKeys, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; Map)</>}
  labels = {["static"]}>
A function to sort the keys of <code>Map</code>, which must be a mapping of constant values to basic blocks and return it in <code>SortedKeys</code>.

<ParametersList title="Parameters">
<ParametersListItem name="SortedKeys">- The vector the keys will be return in and sorted.</ParametersListItem>
<ParametersListItem name="Map">- The <a href="/docs/api/classes/llvm/densemap">DenseMap</a> containing keys to sort.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00165">165</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### getSubprogramOrNull() {#aac5cfc936b6963f4e848982328d39e8e}

<MemberDefinition
  prototype={<>static DISubprogram &#42; getSubprogramOrNull (<a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp; Group)</>}
  labels = {["static"]}>
Get the subprogram if it exists for one of the outlined regions.

<ParametersList title="Parameters">
<ParametersListItem name="[in] Group">- The set of regions to find a subprogram for.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
the subprogram if it exists, or nullptr.
</SectionUser>

Definition at line <a href="#l00620">620</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### mapInputsToGVNs() {#a9165dd298666d75ed2e5be7d5d8b50e5}

<MemberDefinition
  prototype={<>static void mapInputsToGVNs (<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp; C, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; CurrentInputs, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpupromotealloca-cpp/#ac760e37eba1d852d0a28011a1a0ce05f">std::vector</a>&lt; unsigned &gt; &amp; EndInputNumbers)</>}
  labels = {["static"]}>
Find the GVN for the inputs that have been found by the <a href="/docs/api/classes/llvm/codeextractor">CodeExtractor</a>.

<ParametersList title="Parameters">
<ParametersListItem name="[in] C">- The <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> containing the region we are analyzing.</ParametersListItem>
<ParametersListItem name="[in] CurrentInputs">- The set of inputs found by the <a href="/docs/api/classes/llvm/codeextractor">CodeExtractor</a>.</ParametersListItem>
<ParametersListItem name="[in] OutputMappings">- The mapping of values that have been replaced by a new output value.</ParametersListItem>
<ParametersListItem name="[out] EndInputNumbers">- The global value numbers for the extracted arguments.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00806">806</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### moveBBContents() {#a3afc8c0c69b0c55edce3be13d5b7cc32}

<MemberDefinition
  prototype={<>static void moveBBContents (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp; SourceBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp; TargetBB)</>}
  labels = {["static"]}>
Move the contents of <code>SourceBB</code> to before the last instruction of <code>TargetBB</code>.

<ParametersList title="Parameters">
<ParametersListItem name="SourceBB">- the <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> to pull Instructions from.</ParametersListItem>
<ParametersListItem name="TargetBB">- the <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> to put <a href="/docs/api/classes/llvm/instruction">Instruction</a> into.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00156">156</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### moveFunctionData() {#a4047976de351f78967fba27df7a6361f}

<MemberDefinition
  prototype={<>static void moveFunctionData (<a href="/docs/api/classes/llvm/function">Function</a> &amp; Old, <a href="/docs/api/classes/llvm/function">Function</a> &amp; New, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; NewEnds)</>}
  labels = {["static"]}>
Move each <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> in <code>Old</code> to <code>New</code>.

<ParametersList title="Parameters">
<ParametersListItem name="[in] Old">- The function to move the basic blocks from.</ParametersListItem>
<ParametersListItem name="[in] New">- The function to move the basic blocks to.</ParametersListItem>
<ParametersListItem name="[out] NewEnds">- The return blocks of the new overall function.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00706">706</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### nextIRInstructionDataMatchesNextInst() {#a3bc949e06e148a6d2879eb45ca164146}

<MemberDefinition
  prototype={<>static bool nextIRInstructionDataMatchesNextInst (<a href="/docs/api/structs/llvm/irsimilarity/irinstructiondata">IRInstructionData</a> &amp; ID)</>}
  labels = {["static"]}>
Checks that the next instruction in the InstructionDataList matches the next instruction in the module.

If they do not, there could be the possibility that extra code has been inserted, and we must ignore it.


<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed&quot;>ID</a>">- The <a href="/docs/api/structs/llvm/irsimilarity/irinstructiondata">IRInstructionData</a> to check the next instruction of.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
true if the InstructionDataList and actual instruction match.
</SectionUser>

Definition at line <a href="#l02337">2337</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### outputHasNonPHI() {#a84e785627d5ab55370b5fa402ad7193f}

<MemberDefinition
  prototype={<>static bool outputHasNonPHI (<a href="/docs/api/classes/llvm/value">Value</a> &#42; V, unsigned PHILoc, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp; PN, <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;, 1 &gt; &amp; Exits, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; BlocksInRegion)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if the <code>V</code> has any uses outside of the region other than <code>PN</code>.

<ParametersList title="Parameters">
<ParametersListItem name="V">&#91;in&#93; - The value to check.</ParametersListItem>
<ParametersListItem name="PHILoc">&#91;in&#93; - The location in the <a href="/docs/api/classes/llvm/phinode">PHINode</a> of <code>V</code>.</ParametersListItem>
<ParametersListItem name="PN">&#91;in&#93; - The <a href="/docs/api/classes/llvm/phinode">PHINode</a> using <code>V</code>.</ParametersListItem>
<ParametersListItem name="Exits">&#91;in&#93; - The potential blocks we exit to from the outlined region.</ParametersListItem>
<ParametersListItem name="BlocksInRegion">&#91;in&#93; - The basic blocks contained in the region.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
true if <code>V</code> has any use soutside its region other than <code>PN</code>.
</SectionUser>

Definition at line <a href="#l01036">1036</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### remapExtractedInputs() {#a09e9f16b4a1aaf539000b95bf5442155}

<MemberDefinition
  prototype={<>static void remapExtractedInputs (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; ArgInputs, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; RemappedArgInputs)</>}
  labels = {["static"]}>
Find the original value for the <code>ArgInput</code> values if any one of them was replaced during a previous extraction.

<ParametersList title="Parameters">
<ParametersListItem name="[in] ArgInputs">- The inputs to be extracted by the code extractor.</ParametersListItem>
<ParametersListItem name="[in] OutputMappings">- The mapping of values that have been replaced by a new output value.</ParametersListItem>
<ParametersListItem name="[out] RemappedArgInputs">- The remapped values according to <code>OutputMappings</code> that will be extracted.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00832">832</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### replaceArgumentUses() {#a96b5bd50d8e96b4c76ffc26508ce774d}

<MemberDefinition
  prototype={<>static void replaceArgumentUses (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; OutputBBs, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42;, <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; OutputMappings, bool FirstFunction=false)</>}
  labels = {["static"]}>

<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The region of extracted code to be changed.</ParametersListItem>
<ParametersListItem name="[inout] OutputBBs">- The <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> for the output stores for this region.</ParametersListItem>
<ParametersListItem name="[in] FirstFunction">- A flag to indicate whether we are using this function to define the overall outlined function for all the regions, or if we are operating on one of the following regions.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l01800">1800</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### replaceCalledFunction() {#a7e2cad7ab18db9a3c940afc609c223dc}

<MemberDefinition
  prototype={<>CallInst &#42; replaceCalledFunction (<a href="/docs/api/classes/llvm/module">Module</a> &amp; M, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region)</>}>
Replace the extracted function in the <a href="/docs/api/classes/llvm/region">Region</a> with a call to the overall function constructed from the deduplicated similar regions, replacing and remapping the values passed to the extracted function as arguments to the new arguments of the overall function.

<ParametersList title="Parameters">
<ParametersListItem name="[in] M">- The module to outline from.</ParametersListItem>
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">- The regions of extracted code to be replaced with a new function.</ParametersListItem>
</ParametersList>

<SectionUser title="Returns">
a call instruction with the replaced function.
</SectionUser>

Definition at line <a href="#l01429">1429</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### replaceConstants() {#ace02ac07a3f704ffd345301bff92e5a8}

<MemberDefinition
  prototype={<>void replaceConstants (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp; Region)</>}>
Within an extracted function, replace the constants that need to be lifted into arguments with the actual argument.

<ParametersList title="Parameters">
<ParametersListItem name="<a href=&quot;/docs/api/classes/llvm/region&quot;>Region</a>">&#91;in&#93; - The region of extracted code to be changed.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l01934">1934</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### replaceTargetsFromPHINode() {#a8e5c4577c64728c435eca5f4f7e163ab}

<MemberDefinition
  prototype={<>static void replaceTargetsFromPHINode (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; PHIBlock, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; Find, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; Replace, <a href="/docs/api/classes/llvm/denseset">DenseSet</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; Included)</>}
  labels = {["static"]}>
Rewrite the BranchInsts in the incoming blocks to <code>PHIBlock</code> that are found in <code>Included</code> to branch to <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> <code>Replace</code> if they currently branch to the <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> <code>Find</code>.

This is used to fix up the incoming basic blocks when PHINodes are included in outlined regions.


<ParametersList title="Parameters">
<ParametersListItem name="PHIBlock">- The <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> containing the PHINodes that need to be checked.</ParametersListItem>
<ParametersListItem name="Find">- The successor block to be replaced.</ParametersListItem>
<ParametersListItem name="Replace">- The new succesor block to branch to.</ParametersListItem>
<ParametersListItem name="Included">- The set of blocks about to be outlined.</ParametersListItem>
</ParametersList>

Definition at line <a href="#l00220">220</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### EnableLinkOnceODRIROutlining {#a415af6f4421aa68820b3279b48acd928}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableLinkOnceODRIROutlining(&quot;enable-linkonceodr-ir-outlining&quot;, cl::Hidden, cl::desc(&quot;Enable the IR outliner on linkonceodr functions&quot;), cl::init(false))</>}
  labels = {["static"]}>

Definition at line <a href="#l00055">55</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

### NoCostModel {#a2dfbf70cabc04c37f6f46b2c312b2506}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; NoCostModel(&quot;ir-outlining-no-cost&quot;, cl::init(false), cl::ReallyHidden, cl::desc(&quot;Debug option to outline greedily, without restriction that &quot; &quot;calculated benefit outweighs cost&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00062">62</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;iroutliner&quot;</>}>

Definition at line <a href="#l00030">30</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/iroutliner-cpp">IROutliner.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><Highlight kind="comment">//===- IROutliner.cpp -- Outline Similar Regions ----------------&#42;- C++ -&#42;-===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><Highlight kind="normal"></Highlight><Highlight kind="comment">// See https://llvm.org/LICENSE.txt for license information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><Highlight kind="comment">/// \\file</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Implementation for the IROutliner which is used by the IROutliner Pass.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/ipo/iroutliner-h">llvm/Transforms/IPO/IROutliner.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/irsimilarityidentifier-h">llvm/Analysis/IRSimilarityIdentifier.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h">llvm/Analysis/OptimizationRemarkEmitter.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h">llvm/IR/Attributes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h">llvm/IR/DIBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h">llvm/IR/DebugInfoMetadata.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/mangler-h">llvm/IR/Mangler.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/passmanager-h">llvm/IR/PassManager.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/ipo-h">llvm/Transforms/IPO.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;optional&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;vector&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE &quot;iroutliner&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a>;</Highlight></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/irsimilarity">IRSimilarity</a>;</Highlight></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><Highlight kind="normal"></Highlight><Highlight kind="comment">// A command flag to be used for debugging to exclude branches from similarity</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><Highlight kind="normal"></Highlight><Highlight kind="comment">// matching and outlining.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</Highlight></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38" lineLink="/docs/api/namespaces/llvm/#a93b773511cf2c25df41bdd74e8718bd3"><Highlight kind="normal"></Highlight><Highlight kind="keyword">extern</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#a93b773511cf2c25df41bdd74e8718bd3">DisableBranches</a>;</Highlight></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><Highlight kind="normal"></Highlight><Highlight kind="comment">// A command flag to be used for debugging to indirect calls from similarity</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><Highlight kind="normal"></Highlight><Highlight kind="comment">// matching and outlining.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42" lineLink="/docs/api/namespaces/llvm/#a59a51d46c30287fc47551914e29de21e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">extern</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#a59a51d46c30287fc47551914e29de21e">DisableIndirectCalls</a>;</Highlight></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><Highlight kind="normal"></Highlight><Highlight kind="comment">// A command flag to be used for debugging to exclude intrinsics from similarity</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><Highlight kind="normal"></Highlight><Highlight kind="comment">// matching and outlining.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46" lineLink="/docs/api/namespaces/llvm/#a98fea048f88b5fe74294b5bf72acb93c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">extern</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#a98fea048f88b5fe74294b5bf72acb93c">DisableIntrinsics</a>;</Highlight></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// namespace llvm</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Set to true if the user wants the ir outliner to run on linkonceodr linkage</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><Highlight kind="normal"></Highlight><Highlight kind="comment">// functions. This is false by default because the linker can dedupe linkonceodr</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><Highlight kind="normal"></Highlight><Highlight kind="comment">// functions. Since the outliner is confined to a single module (modulo LTO),</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><Highlight kind="normal"></Highlight><Highlight kind="comment">// this is off by default. It should, however, be the default behavior in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><Highlight kind="normal"></Highlight><Highlight kind="comment">// LTO.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55" lineLink="#a415af6f4421aa68820b3279b48acd928"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a415af6f4421aa68820b3279b48acd928">EnableLinkOnceODRIROutlining</a>(</Highlight></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;enable-linkonceodr-ir-outlining&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable the IR outliner on linkonceodr functions&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This is a debug option to test small pieces of code to ensure that outlining</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><Highlight kind="normal"></Highlight><Highlight kind="comment">// works correctly.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62" lineLink="#a2dfbf70cabc04c37f6f46b2c312b2506"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a2dfbf70cabc04c37f6f46b2c312b2506">NoCostModel</a>(</Highlight></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;ir-outlining-no-cost&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40ab81f279502bb9ca74e6629cfb62844be">cl::ReallyHidden</a>,</Highlight></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Debug option to outline greedily, without restriction that &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;calculated benefit outweighs cost&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><Highlight kind="comment">/// The OutlinableGroup holds all the overarching information for outlining</Highlight></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><Highlight kind="comment">/// a set of regions that are structurally similar to one another, such as the</Highlight></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><Highlight kind="comment">/// types of the overall function, the output blocks, the sets of stores needed</Highlight></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><Highlight kind="comment">/// and a list of the different regions. This information is used in the</Highlight></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><Highlight kind="comment">/// deduplication of extracted regions with the same structure.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72" lineLink="/docs/api/structs/outlinablegroup"><Highlight kind="normal"></Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal"><a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><Highlight kind="comment">  /// The sections that could be outlined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74" lineLink="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11"><Highlight kind="normal">  std::vector&lt;OutlinableRegion &#42;&gt; <a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>;</Highlight></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><Highlight kind="comment">  /// The argument types for the function created as the overall function to</Highlight></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><Highlight kind="comment">  /// replace the extracted function for each region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78" lineLink="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d"><Highlight kind="normal">  std::vector&lt;Type &#42;&gt; <a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><Highlight kind="comment">  /// The FunctionType for the overall function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80" lineLink="/docs/api/structs/outlinablegroup/#aab2165e523387ae034bc2117b13c5d51"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;<a href="/docs/api/structs/outlinablegroup/#aab2165e523387ae034bc2117b13c5d51">OutlinedFunctionType</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><Highlight kind="comment">  /// The Function for the collective overall function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82" lineLink="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><Highlight kind="comment">  /// Flag for whether we should not consider this group of OutlinableRegions</Highlight></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><Highlight kind="comment">  /// for extraction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86" lineLink="/docs/api/structs/outlinablegroup/#a7bf6409b01dd04465404d268beec0898"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/outlinablegroup/#a7bf6409b01dd04465404d268beec0898">IgnoreGroup</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><Highlight kind="comment">  /// The return blocks for the overall function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89" lineLink="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> <a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>;</Highlight></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><Highlight kind="comment">  /// The PHIBlocks with their corresponding return block based on the return</Highlight></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><Highlight kind="comment">  /// value as the key.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93" lineLink="/docs/api/structs/outlinablegroup/#aa4ad3c4db3597f25f2fba7a690a68bc6"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> <a href="/docs/api/structs/outlinablegroup/#aa4ad3c4db3597f25f2fba7a690a68bc6">PHIBlocks</a>;</Highlight></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><Highlight kind="comment">  /// A set containing the different GVN store sets needed. Each array contains</Highlight></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><Highlight kind="comment">  /// a sorted list of the different values that need to be stored into output</Highlight></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><Highlight kind="comment">  /// registers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98" lineLink="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;ArrayRef&lt;unsigned&gt;</a>&gt; <a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>;</Highlight></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><Highlight kind="comment">  /// Flag for whether the \\ref ArgumentTypes have been defined after the</Highlight></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><Highlight kind="comment">  /// extraction of the first region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102" lineLink="/docs/api/structs/outlinablegroup/#a9fabb6e6f74e4ef23575f45ea098b827"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/outlinablegroup/#a9fabb6e6f74e4ef23575f45ea098b827">InputTypesSet</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><Highlight kind="comment">  /// The number of input values in \\ref ArgumentTypes.  Anything after this</Highlight></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><Highlight kind="comment">  /// index in ArgumentTypes is an output argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106" lineLink="/docs/api/structs/outlinablegroup/#aeab6020692f93361cff45734711204fc"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/outlinablegroup/#aeab6020692f93361cff45734711204fc">NumAggregateInputs</a> = 0;</Highlight></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><Highlight kind="comment">  /// The mapping of the canonical numbering of the values in outlined sections</Highlight></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><Highlight kind="comment">  /// to specific arguments.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110" lineLink="/docs/api/structs/outlinablegroup/#ac3c1798aada6da8b72185545e4944c25"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, unsigned&gt;</a> <a href="/docs/api/structs/outlinablegroup/#ac3c1798aada6da8b72185545e4944c25">CanonicalNumberToAggArg</a>;</Highlight></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><Highlight kind="comment">  /// The number of branches in the region target a basic block that is outside</Highlight></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><Highlight kind="comment">  /// of the region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114" lineLink="/docs/api/structs/outlinablegroup/#a8ef219d66e525d2c9fbb7f54e5869ad3"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/outlinablegroup/#a8ef219d66e525d2c9fbb7f54e5869ad3">BranchesToOutside</a> = 0;</Highlight></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><Highlight kind="comment">  /// Tracker counting backwards from the highest unsigned value possible to</Highlight></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><Highlight kind="comment">  /// avoid conflicting with the GVNs of assigned values.  We start at -3 since</Highlight></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><Highlight kind="comment">  /// -2 and -1 are assigned by the DenseMap.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119" lineLink="/docs/api/structs/outlinablegroup/#a72b89466c3b2fd45331e2c315e2c33e5"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/outlinablegroup/#a72b89466c3b2fd45331e2c315e2c33e5">PHINodeGVNTracker</a> = -3;</Highlight></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt;unsigned,</Highlight></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><Highlight kind="normal">           std::pair&lt;std::pair&lt;unsigned, unsigned&gt;, <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;unsigned, 2&gt;</a>&gt;&gt;</Highlight></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123" lineLink="/docs/api/structs/outlinablegroup/#a704926b49e550b25585651aea32b389b"><Highlight kind="normal">      <a href="/docs/api/structs/outlinablegroup/#a704926b49e550b25585651aea32b389b">PHINodeGVNToGVNs</a>;</Highlight></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124" lineLink="/docs/api/structs/outlinablegroup/#a78f1513d0fadc0e72c1c7373c2003666"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;hash&#95;code, unsigned&gt;</a> <a href="/docs/api/structs/outlinablegroup/#a78f1513d0fadc0e72c1c7373c2003666">GVNsToPHINodeGVN</a>;</Highlight></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><Highlight kind="comment">  /// The number of instructions that will be outlined by extracting \\ref</Highlight></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><Highlight kind="comment">  /// Regions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128" lineLink="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a> = 0;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><Highlight kind="comment">  /// The number of added instructions needed for the outlining of the \\ref</Highlight></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><Highlight kind="comment">  /// Regions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131" lineLink="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> = 0;</Highlight></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><Highlight kind="comment">  /// The argument that needs to be marked with the swifterr attribute.  If not</Highlight></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><Highlight kind="comment">  /// needed, there is no value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135" lineLink="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff"><Highlight kind="normal">  std::optional&lt;unsigned&gt; <a href="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff">SwiftErrorArgument</a>;</Highlight></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><Highlight kind="comment">  /// For the \\ref Regions, we look at every Value.  If it is a constant,</Highlight></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><Highlight kind="comment">  /// we check whether it is the same in Region.</Highlight></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><Highlight kind="comment">  /// \\param &#91;in,out&#93; NotSame contains the global value numbers where the</Highlight></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><Highlight kind="comment">  /// constant is not always the same, and must be passed in as an argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/outlinablegroup/#a61915f6a6a382f51fd1a8bf3dd188c0c">findSameConstants</a>(<a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> &amp;NotSame);</Highlight></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><Highlight kind="comment">  /// For the regions, look at each set of GVN stores needed and account for</Highlight></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><Highlight kind="comment">  /// each combination.  Add an argument to the argument types if there is</Highlight></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><Highlight kind="comment">  /// more than one combination.</Highlight></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><Highlight kind="comment">  /// \\param &#91;in&#93; M - The module we are outlining from.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/outlinablegroup/#ad67fb96194cff11216803ad74dba5687">collectGVNStoreSets</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M);</Highlight></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><Highlight kind="comment">/// Move the contents of \\p SourceBB to before the last instruction of \\p</Highlight></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><Highlight kind="comment">/// TargetBB.</Highlight></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><Highlight kind="comment">/// \\param SourceBB - the BasicBlock to pull Instructions from.</Highlight></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><Highlight kind="comment">/// \\param TargetBB - the BasicBlock to put Instruction into.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156" lineLink="#a3afc8c0c69b0c55edce3be13d5b7cc32"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a3afc8c0c69b0c55edce3be13d5b7cc32">moveBBContents</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;SourceBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;TargetBB) &#123;</Highlight></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><Highlight kind="normal">  TargetBB.<a href="/docs/api/classes/llvm/basicblock/#af29f89e91dfd0ae90950f0b1bf49798d">splice</a>(TargetBB.<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(), &amp;SourceBB);</Highlight></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><Highlight kind="comment">/// A function to sort the keys of \\p Map, which must be a mapping of constant</Highlight></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><Highlight kind="comment">/// values to basic blocks and return it in \\p SortedKeys</Highlight></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><Highlight kind="comment">/// \\param SortedKeys - The vector the keys will be return in and sorted.</Highlight></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><Highlight kind="comment">/// \\param Map - The DenseMap containing keys to sort.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165" lineLink="#a8ad786f21829d9e92d31cc0b80c53dbb"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a8ad786f21829d9e92d31cc0b80c53dbb">getSortedConstantKeys</a>(std::vector&lt;Value &#42;&gt; &amp;SortedKeys,</Highlight></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;Map) &#123;</Highlight></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;VtoBB : Map)</Highlight></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><Highlight kind="normal">    SortedKeys.push&#95;back(VtoBB.first);</Highlight></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Here we expect to have either 1 value that is void (nullptr) or multiple</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// values that are all constant integers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SortedKeys.size() == 1) &#123;</Highlight></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!SortedKeys&#91;0&#93; &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected a single void value.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">stable&#95;sort</a>(SortedKeys, &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</Highlight></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected non void values.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;LHSC = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>);</Highlight></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;RHSC = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>);</Highlight></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> LHSC-&gt;<a href="/docs/api/classes/llvm/constantint/#a31e8da5adf63afd38b4ab94bca823150">getLimitedValue</a>() &lt; RHSC-&gt;<a href="/docs/api/classes/llvm/constantint/#a31e8da5adf63afd38b4ab94bca823150">getLimitedValue</a>();</Highlight></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186" lineLink="/docs/api/structs/llvm/outlinableregion/#a7e03ba3e02776435b130c487f13289be"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/llvm/outlinableregion/#a7e03ba3e02776435b130c487f13289be">OutlinableRegion::findCorrespondingValueIn</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/outlinableregion/#ad3f327e6f6a42e9b7729a16fbba4bc58">OutlinableRegion</a> &amp;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>,</Highlight></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><Highlight kind="normal">                                                  <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><Highlight kind="normal">  std::optional&lt;unsigned&gt; GVN = <a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;getGVN(V);</Highlight></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GVN &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;No GVN for incoming value&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><Highlight kind="normal">  std::optional&lt;unsigned&gt; CanonNum = <a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;getCanonicalNum(&#42;GVN);</Highlight></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><Highlight kind="normal">  std::optional&lt;unsigned&gt; FirstGVN =</Highlight></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.Candidate-&gt;fromCanonicalNum(&#42;CanonNum);</Highlight></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><Highlight kind="normal">  std::optional&lt;Value &#42;&gt; FoundValueOpt = <a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>.Candidate-&gt;fromGVN(&#42;FirstGVN);</Highlight></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> FoundValueOpt.value&#95;or(</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198" lineLink="/docs/api/structs/llvm/outlinableregion/#a84b80673b9748e75da40fa84cca3a630"><Highlight kind="normal"><a href="/docs/api/structs/llvm/outlinableregion/#a84b80673b9748e75da40fa84cca3a630">OutlinableRegion::findCorrespondingBlockIn</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/outlinableregion/#ad3f327e6f6a42e9b7729a16fbba4bc58">OutlinableRegion</a> &amp;<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>,</Highlight></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><Highlight kind="normal">                                           <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;FirstNonPHI = &amp;&#42;BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a50909227135ef69932bff39b8ea3f572">getFirstNonPHIOrDbg</a>();</Highlight></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FirstNonPHI &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;block is empty?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CorrespondingVal = <a href="/docs/api/structs/llvm/outlinableregion/#a7e03ba3e02776435b130c487f13289be">findCorrespondingValueIn</a>(<a href="/docs/api/namespaces/llvm/#a9eb4f5b98b70ee4fab9614ed58282c1fa6311ae17c1ee52b36e68aaf4ad066387">Other</a>, FirstNonPHI);</Highlight></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CorrespondingVal)</Highlight></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CorrespondingBlock =</Highlight></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(CorrespondingVal)-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CorrespondingBlock;</Highlight></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><Highlight kind="comment">/// Rewrite the BranchInsts in the incoming blocks to \\p PHIBlock that are found</Highlight></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><Highlight kind="comment">/// in \\p Included to branch to BasicBlock \\p Replace if they currently branch</Highlight></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><Highlight kind="comment">/// to the BasicBlock \\p Find.  This is used to fix up the incoming basic blocks</Highlight></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><Highlight kind="comment">/// when PHINodes are included in outlined regions.</Highlight></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><Highlight kind="comment">/// \\param PHIBlock - The BasicBlock containing the PHINodes that need to be</Highlight></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><Highlight kind="comment">/// checked.</Highlight></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><Highlight kind="comment">/// \\param Find - The successor block to be replaced.</Highlight></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><Highlight kind="comment">/// \\param Replace - The new succesor block to branch to.</Highlight></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><Highlight kind="comment">/// \\param Included - The set of blocks about to be outlined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220" lineLink="#a8e5c4577c64728c435eca5f4f7e163ab"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a8e5c4577c64728c435eca5f4f7e163ab">replaceTargetsFromPHINode</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PHIBlock, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/mc/mcsubtargetinfo-cpp/#a08e140d603b53c440c54cffc85131c8f">Find</a>,</Highlight></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><Highlight kind="normal">                                      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Replace,</Highlight></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><Highlight kind="normal">                                      <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> &amp;Included) &#123;</Highlight></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : PHIBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 0, PNEnd = PN.getNumIncomingValues(); Idx != PNEnd;</Highlight></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><Highlight kind="normal">         ++Idx) &#123;</Highlight></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Check if the incoming block is included in the set of blocks being</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// outlined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/llvm/incoming">Incoming</a> = PN.getIncomingBlock(Idx);</Highlight></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Included.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>))</Highlight></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Not a branch instruction?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Look over the branching instructions into this block to see if we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// used to branch to Find in this outlined block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Succ = 0, End = BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a96b8f11f6f21ca0321294669dab83b35">getNumSuccessors</a>(); Succ != End;</Highlight></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><Highlight kind="normal">           Succ++) &#123;</Highlight></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If we have found the block to replace, we do so here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(Succ) != <a href="/docs/api/files/lib/lib/mc/mcsubtargetinfo-cpp/#a08e140d603b53c440c54cffc85131c8f">Find</a>)</Highlight></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><Highlight kind="normal">        BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#adc5e7f9c460c68455e826783d77f9a99">setSuccessor</a>(Succ, Replace);</Highlight></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248" lineLink="/docs/api/structs/llvm/outlinableregion/#a761b3c02cd196cb5f6fb019bcd86866e"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/outlinableregion/#a761b3c02cd196cb5f6fb019bcd86866e">OutlinableRegion::splitCandidate</a>() &#123;</Highlight></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/structs/llvm/outlinableregion/#a6a1b95a7f7c90784102fd63ffaa0ea00">CandidateSplit</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Candidate already split!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;BackInst = <a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;backInstruction();</Highlight></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;EndInst = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check whether the last instruction is a terminator, if it is, we do</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// not split on the following instruction. We leave the block as it is.  We</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// also check that this is not the last instruction in the Module, otherwise</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the check for whether the current following instruction matches the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// previously recorded instruction will be incorrect.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BackInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a7653277511df1034148a37520a585bb5">isTerminator</a>() ||</Highlight></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><Highlight kind="normal">      BackInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != &amp;BackInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a43b79a254fba6ce00adf5b963382a0a4">back</a>()) &#123;</Highlight></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><Highlight kind="normal">    EndInst = <a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;end()-&gt;Inst;</Highlight></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndInst &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected an end instruction?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We check if the current instruction following the last instruction in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// region is the same as the recorded instruction following the last</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction. If they do not match, there could be problems in rewriting</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the program after outlining, so we ignore it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BackInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a7653277511df1034148a37520a585bb5">isTerminator</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><Highlight kind="normal">      EndInst != BackInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a91bd28adea418a08cec78b72413d9d45">getNextNonDebugInstruction</a>())</Highlight></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;StartInst = (&#42;<a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;begin()).Inst;</Highlight></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StartInst &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected a start instruction?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a> = StartInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a> = <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>;</Highlight></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> BBSet;</Highlight></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;getBasicBlocks(BBSet);</Highlight></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We iterate over the instructions in the region, if we find a PHINode, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// check if there are predecessors outside of the region, if there are,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we ignore this region since we are unable to handle the severing of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// phi node right now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Handle extraneous inputs for PHINodes through variable number of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// inputs, similar to how outputs are handled.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> It = StartInst-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>();</Highlight></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a> = BackInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IBlock;</Highlight></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PHIPredBlock = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> EndBBTermAndBackInstDifferent = <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>-&gt;getTerminator() != BackInst;</Highlight></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;&#42;It)) &#123;</Highlight></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumPredsOutsideRegion = 0;</Highlight></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = PN-&gt;getNumIncomingValues(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BBSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(PN-&gt;getIncomingBlock(i))) &#123;</Highlight></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><Highlight kind="normal">        PHIPredBlock = PN-&gt;getIncomingBlock(i);</Highlight></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><Highlight kind="normal">        ++NumPredsOutsideRegion;</Highlight></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We must consider the case there the incoming block to the PHINode is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the same as the final block of the OutlinableRegion.  If this is the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// case, the branch from this block must also be outlined to be valid.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><Highlight kind="normal">      IBlock = PN-&gt;getIncomingBlock(i);</Highlight></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IBlock == <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a> &amp;&amp; EndBBTermAndBackInstDifferent) &#123;</Highlight></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><Highlight kind="normal">        PHIPredBlock = PN-&gt;getIncomingBlock(i);</Highlight></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><Highlight kind="normal">        ++NumPredsOutsideRegion;</Highlight></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumPredsOutsideRegion &gt; 1)</Highlight></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><Highlight kind="normal">    </Highlight></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><Highlight kind="normal">    It++;</Highlight></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the region starts with a PHINode, but is not the initial instruction of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the BasicBlock, we ignore this region for now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(StartInst) &amp;&amp; StartInst != &amp;&#42;<a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>-&gt;begin())</Highlight></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><Highlight kind="normal">  </Highlight></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the region ends with a PHINode, but does not contain all of the phi node</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instructions of the region, we ignore it for now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(BackInst) &amp;&amp;</Highlight></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><Highlight kind="normal">      BackInst != &amp;&#42;std::prev(<a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>-&gt;getFirstInsertionPt()))</Highlight></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The basic block gets split like so:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block:                 block:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   inst1                  inst1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   inst2                  inst2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   region1               br block&#95;to&#95;outline</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   region2              block&#95;to&#95;outline:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   region3          -&gt;    region1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   region4                region2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   inst3                  region3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   inst4                  region4</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//                          br block&#95;after&#95;outline</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//                        block&#95;after&#95;outline:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//                          inst3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//                          inst4</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><Highlight kind="normal">  std::string OriginalName = <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;getName().str();</Highlight></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a> = <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;splitBasicBlock(StartInst, OriginalName + </Highlight><Highlight kind="stringliteral">&quot;&#95;to&#95;outline&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;replaceSuccessorsPhiUsesWith(<a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>);</Highlight></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there was a PHINode with an incoming block outside the region,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// make sure is correctly updated in the newly split block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PHIPredBlock)</Highlight></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;replaceSuccessorsPhiUsesWith(PHIPredBlock, <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>);</Highlight></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#a6a1b95a7f7c90784102fd63ffaa0ea00">CandidateSplit</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BackInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a7653277511df1034148a37520a585bb5">isTerminator</a>()) &#123;</Highlight></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a> = EndInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a> = <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>-&gt;splitBasicBlock(EndInst, OriginalName + </Highlight><Highlight kind="stringliteral">&quot;&#95;after&#95;outline&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>-&gt;replaceSuccessorsPhiUsesWith(<a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>);</Highlight></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>-&gt;replaceSuccessorsPhiUsesWith(<a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>);</Highlight></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a> = BackInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/outlinableregion/#ad9bf08399ff5638f26f2f4eac57e03b2">EndsInBranch</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Refind the basic block set.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><Highlight kind="normal">  BBSet.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a16413f1a88d8baca228d0a1b4cc0bfc6">clear</a>();</Highlight></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;getBasicBlocks(BBSet);</Highlight></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For the phi nodes in the new starting basic block of the region, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reassign the targets of the basic blocks branching instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><Highlight kind="normal">  <a href="#a8e5c4577c64728c435eca5f4f7e163ab">replaceTargetsFromPHINode</a>(<a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>, BBSet);</Highlight></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>)</Highlight></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><Highlight kind="normal">    <a href="#a8e5c4577c64728c435eca5f4f7e163ab">replaceTargetsFromPHINode</a>(<a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>, BBSet);</Highlight></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375" lineLink="/docs/api/structs/llvm/outlinableregion/#af5d7aa7988108e9377f154cf6a22f02b"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/outlinableregion/#af5d7aa7988108e9377f154cf6a22f02b">OutlinableRegion::reattachCandidate</a>() &#123;</Highlight></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/outlinableregion/#a6a1b95a7f7c90784102fd63ffaa0ea00">CandidateSplit</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Candidate is not split!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The basic block gets reattached like so:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block:                        block:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   inst1                         inst1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   inst2                         inst2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   br block&#95;to&#95;outline           region1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block&#95;to&#95;outline:        -&gt;     region2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   region1                       region3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   region2                       region4</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   region3                       inst3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   region4                       inst4</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   br block&#95;after&#95;outline</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block&#95;after&#95;outline:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   inst3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   inst4</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a> != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;StartBB for Candidate is not defined!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;getTerminator() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Terminator removed from PrevBB!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Make sure PHINode references to the block we are merging into are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// updated to be incoming blocks from the predecessor to the current block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// NOTE: If this is updated such that the outlined block can have more than</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// one incoming block to a PHINode, this logic will have to updated</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to handle multiple precessors instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We only need to update this if the outlined section contains a PHINode, if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// it does not, then the incoming block was never changed in the first place.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// On the other hand, if PrevBB has no predecessors, it means that all</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// incoming blocks to the first block are contained in the region, and there</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// will be nothing to update.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;StartInst = (&#42;<a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;begin()).Inst;</Highlight></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(StartInst) &amp;&amp; !<a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;hasNPredecessors(0)) &#123;</Highlight></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;hasNPredecessorsOrMore(2) &amp;&amp;</Highlight></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;PrevBB has more than one predecessor. Should be 0 or 1.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BeforePrevBB = <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;getSinglePredecessor();</Highlight></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;replaceSuccessorsPhiUsesWith(<a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>, BeforePrevBB);</Highlight></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;getTerminator()-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we reattaching after outlining, we iterate over the phi nodes to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the initial block, and reassign the branch instructions of the incoming</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// blocks to the block we are remerging into.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/structs/llvm/outlinableregion/#ad5dce467e0d3954ba812f2e9611810b4">ExtractedFunction</a>) &#123;</Highlight></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> BBSet;</Highlight></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;getBasicBlocks(BBSet);</Highlight></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><Highlight kind="normal">    <a href="#a8e5c4577c64728c435eca5f4f7e163ab">replaceTargetsFromPHINode</a>(<a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>, BBSet);</Highlight></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/structs/llvm/outlinableregion/#ad9bf08399ff5638f26f2f4eac57e03b2">EndsInBranch</a>)</Highlight></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><Highlight kind="normal">      <a href="#a8e5c4577c64728c435eca5f4f7e163ab">replaceTargetsFromPHINode</a>(<a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>, BBSet);</Highlight></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><Highlight kind="normal">  <a href="#a3afc8c0c69b0c55edce3be13d5b7cc32">moveBBContents</a>(&#42;<a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>, &#42;<a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>);</Highlight></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PlacementBB = <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>;</Highlight></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a> != <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>)</Highlight></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><Highlight kind="normal">    PlacementBB = <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a>;</Highlight></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/structs/llvm/outlinableregion/#ad9bf08399ff5638f26f2f4eac57e03b2">EndsInBranch</a> &amp;&amp; PlacementBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a57f1945911ca1e95d0f51d7c3516b529">getUniqueSuccessor</a>() != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a> != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;FollowBB for Candidate is not defined!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PlacementBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Terminator removed from EndBB!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><Highlight kind="normal">    PlacementBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><Highlight kind="normal">    <a href="#a3afc8c0c69b0c55edce3be13d5b7cc32">moveBBContents</a>(&#42;<a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>, &#42;PlacementBB);</Highlight></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><Highlight kind="normal">    PlacementBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a089e003bb688e55b9a91ed4e7fed3678">replaceSuccessorsPhiUsesWith</a>(<a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>, PlacementBB);</Highlight></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>-&gt;replaceSuccessorsPhiUsesWith(<a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>, <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>);</Highlight></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Make sure to save changes back to the StartBB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#aeea36f22dc87339b7be65179d3f249b6">StartBB</a> = <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a>;</Highlight></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#a92e2737e736f30a9984ccd08bbb902c7">EndBB</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#a8f2224bfd6ac276c27b61578415e67df">PrevBB</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#a23d6f80b1fe2abb20b13b3c30864f423">FollowBB</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion/#a6a1b95a7f7c90784102fd63ffaa0ea00">CandidateSplit</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><Highlight kind="comment">/// Find whether \\p V matches the Constants previously found for the \\p GVN.</Highlight></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><Highlight kind="comment">/// \\param V - The value to check for consistency.</Highlight></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><Highlight kind="comment">/// \\param GVN - The global value number assigned to \\p V.</Highlight></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><Highlight kind="comment">/// \\param GVNToConstant - The mapping of global value number to Constants.</Highlight></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><Highlight kind="comment">/// \\returns true if the Value matches the Constant mapped to by V and false if</Highlight></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><Highlight kind="comment">/// it \\p V is a Constant but does not match.</Highlight></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><Highlight kind="comment">/// \\returns std::nullopt if \\p V is not a Constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> std::optional&lt;bool&gt;</Highlight></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463" lineLink="#ac77f2569521257316a0f374b9a2682c5"><Highlight kind="normal"><a href="#ac77f2569521257316a0f374b9a2682c5">constantMatches</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> GVN,</Highlight></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><Highlight kind="normal">                <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, Constant &#42;&gt;</a> &amp;GVNToConstant) &#123;</Highlight></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// See if we have a constants</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CST = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(V);</Highlight></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CST)</Highlight></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Holds a mapping from a global value number to a Constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, Constant &#42;&gt;::iterator</a> GVNToConstantIt;</Highlight></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Inserted;</Highlight></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we have a constant, try to make a new entry in the GVNToConstant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><Highlight kind="normal">  std::tie(GVNToConstantIt, Inserted) =</Highlight></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><Highlight kind="normal">      GVNToConstant.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(std::make&#95;pair(GVN, CST));</Highlight></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If it was found and is not equal, it is not the same. We do not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// handle this case yet, and exit early.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Inserted || (GVNToConstantIt-&gt;second == CST))</Highlight></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486" lineLink="/docs/api/structs/llvm/outlinableregion/#a086b69a5012fff81b179e92d137aae33"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/structs/llvm/outlinableregion/#a086b69a5012fff81b179e92d137aae33">OutlinableRegion::getBenefit</a>(<a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</Highlight></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> Benefit = 0;</Highlight></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Estimate the benefit of outlining a specific sections of the program.  We</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// delegate mostly this task to the TargetTransformInfo so that if the target</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// has specific changes, we can have a more accurate estimate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// However, getInstructionCost delegates the code size calculation for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// arithmetic instructions to getArithmeticInstrCost in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// include/Analysis/TargetTransformImpl.h, where it always estimates that the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// code size for a division and remainder instruction to be equal to 4, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// everything else to 1  This is not an accurate representation of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// division instruction for targets that have a native division instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// To be overly conservative, we only add 1 to the number of instructions for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// each division instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/irsimilarity/irinstructiondata">IRInstructionData</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> : &#42;<a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>) &#123;</Highlight></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.Inst;</Highlight></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FDiv:</Highlight></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FRem:</Highlight></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SDiv:</Highlight></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SRem:</Highlight></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::UDiv:</Highlight></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::URem:</Highlight></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><Highlight kind="normal">      Benefit += 1;</Highlight></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><Highlight kind="normal">      Benefit += <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getInstructionCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TargetTransformInfo::TCK&#95;CodeSize</a>);</Highlight></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Benefit;</Highlight></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><Highlight kind="comment">/// Check the \\p OutputMappings structure for value \\p Input, if it exists</Highlight></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><Highlight kind="comment">/// it has been used as an output for outlining, and has been renamed, and we</Highlight></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><Highlight kind="comment">/// return the new value, otherwise, we return the same value.</Highlight></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><Highlight kind="comment">/// \\param OutputMappings &#91;in&#93; - The mapping of values to their renamed value</Highlight></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><Highlight kind="comment">/// after being used as an output for an outlined region.</Highlight></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><Highlight kind="comment">/// \\param Input &#91;in&#93; - The value to find the remapped value of, if it exists.</Highlight></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><Highlight kind="comment">/// \\return The remapped value if it has been renamed, and the same value if has</Highlight></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><Highlight kind="comment">/// not.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530" lineLink="#ab0d72084e637eaecbbadd192d547ef8e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#ab0d72084e637eaecbbadd192d547ef8e">findOutputMapping</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> OutputMappings,</Highlight></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><Highlight kind="normal">                                <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/input">Input</a>) &#123;</Highlight></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;::const&#95;iterator</a> OutputMapping =</Highlight></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><Highlight kind="normal">      OutputMappings.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/classes/input">Input</a>);</Highlight></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OutputMapping != OutputMappings.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</Highlight></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OutputMapping-&gt;second;</Highlight></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/input">Input</a>;</Highlight></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><Highlight kind="comment">/// Find whether \\p Region matches the global value numbering to Constant</Highlight></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><Highlight kind="comment">/// mapping found so far.</Highlight></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><Highlight kind="comment">/// \\param Region - The OutlinableRegion we are checking for constants</Highlight></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><Highlight kind="comment">/// \\param GVNToConstant - The mapping of global value number to Constants.</Highlight></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><Highlight kind="comment">/// \\param NotSame - The set of global value numbers that do not have the same</Highlight></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><Highlight kind="comment">/// constant in each region.</Highlight></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><Highlight kind="comment">/// \\returns true if all Constants are the same in every use of a Constant in \\p</Highlight></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><Highlight kind="comment">/// Region and false if not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549" lineLink="#a52a09c04ddc4ec6d039f1f11f01d019e"><Highlight kind="normal"><a href="#a52a09c04ddc4ec6d039f1f11f01d019e">collectRegionsConstants</a>(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</Highlight></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, Constant &#42;&gt;</a> &amp;GVNToConstant,</Highlight></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> &amp;NotSame) &#123;</Highlight></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ConstantsTheSame = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Candidate;</Highlight></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/irsimilarity/irinstructiondata">IRInstructionData</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> : <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>) &#123;</Highlight></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Iterate over the operands in an instruction. If the global value number,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// assigned by the IRSimilarityCandidate, has been seen before, we check if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the number has been found to be not the same value in each instance.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.OperVals) &#123;</Highlight></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><Highlight kind="normal">      std::optional&lt;unsigned&gt; GVNOpt = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getGVN(V);</Highlight></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GVNOpt &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected a GVN for operand?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> GVN = &#42;GVNOpt;</Highlight></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Check if this global value has been found to not be the same already.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NotSame.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(GVN)) &#123;</Highlight></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V))</Highlight></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><Highlight kind="normal">          ConstantsTheSame = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If it has been the same so far, we check the value for if the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// associated Constant value match the previous instances of the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// global value number.  If the global value does not map to a Constant,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// it is considered to not be the same value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><Highlight kind="normal">      std::optional&lt;bool&gt; ConstantMatches =</Highlight></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><Highlight kind="normal">          <a href="#ac77f2569521257316a0f374b9a2682c5">constantMatches</a>(V, GVN, GVNToConstant);</Highlight></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ConstantMatches) &#123;</Highlight></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&#42;ConstantMatches)</Highlight></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><Highlight kind="normal">          ConstantsTheSame = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// While this value is a register, it might not have been previously,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// make sure we don&#39;t already have a constant mapped to this global value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// number.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GVNToConstant.<a href="/docs/api/classes/llvm/densemapbase/#a836d9cba6deced0bb1fa7333ce5afd3a">contains</a>(GVN))</Highlight></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><Highlight kind="normal">        ConstantsTheSame = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><Highlight kind="normal">      NotSame.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(GVN);</Highlight></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ConstantsTheSame;</Highlight></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598" lineLink="/docs/api/structs/outlinablegroup/#a61915f6a6a382f51fd1a8bf3dd188c0c"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/outlinablegroup/#a61915f6a6a382f51fd1a8bf3dd188c0c">OutlinableGroup::findSameConstants</a>(<a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> &amp;NotSame) &#123;</Highlight></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, Constant &#42;&gt;</a> GVNToConstant;</Highlight></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &#42;<a href="/docs/api/classes/llvm/region">Region</a> : <a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>)</Highlight></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><Highlight kind="normal">    <a href="#a52a09c04ddc4ec6d039f1f11f01d019e">collectRegionsConstants</a>(&#42;<a href="/docs/api/classes/llvm/region">Region</a>, GVNToConstant, NotSame);</Highlight></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605" lineLink="/docs/api/structs/outlinablegroup/#ad67fb96194cff11216803ad74dba5687"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/outlinablegroup/#ad67fb96194cff11216803ad74dba5687">OutlinableGroup::collectGVNStoreSets</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) &#123;</Highlight></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &#42;OS : <a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>)</Highlight></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><Highlight kind="normal">    <a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>.insert(OS-&gt;GVNStores);</Highlight></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We are adding an extracted argument to decide between which output path</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to use in the basic block.  It is used in a switch statement and only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// needs to be an integer.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>.size() &gt; 1)</Highlight></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><Highlight kind="normal">    <a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>.push&#95;back(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(M.getContext()));</Highlight></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><Highlight kind="comment">/// Get the subprogram if it exists for one of the outlined regions.</Highlight></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><Highlight kind="comment">/// \\param &#91;in&#93; Group - The set of regions to find a subprogram for.</Highlight></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><Highlight kind="comment">/// \\returns the subprogram if it exists, or nullptr.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620" lineLink="#aac5cfc936b6963f4e848982328d39e8e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;<a href="#aac5cfc936b6963f4e848982328d39e8e">getSubprogramOrNull</a>(<a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group) &#123;</Highlight></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &#42;OS : Group.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>)</Highlight></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a018669f7b1d6a21106f47398a087c30a">Call</a>-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>())</Highlight></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;SP = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getSubprogram())</Highlight></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> SP;</Highlight></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><Highlight kind="normal"><a href="/docs/api/classes/llvm/function">Function</a> &#42;IROutliner::createFunction(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, OutlinableGroup &amp;Group,</Highlight></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><Highlight kind="normal">                                     </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> FunctionNameSuffix) &#123;</Highlight></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Function is already defined!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;RetTy = <a href="/docs/api/classes/llvm/type/#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>.getContext());</Highlight></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// All extracted functions &#95;should&#95; have the same return type at this point</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// since the similarity identifier ensures that all branches outside of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// region occur in the same place.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// NOTE: Should we ever move to the model that uses a switch at every point</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// needed, meaning that we could branch within the region or out, it is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// possible that we will need to switch to using the most general case all of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the time.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (OutlinableRegion &#42;R : Group.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>) &#123;</Highlight></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ExtractedFuncType = <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>-&gt;ExtractedFunction-&gt;getReturnType();</Highlight></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((RetTy-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>() &amp;&amp; !ExtractedFuncType-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>()) ||</Highlight></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><Highlight kind="normal">        (RetTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>(1) &amp;&amp; ExtractedFuncType-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>(16)))</Highlight></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><Highlight kind="normal">      RetTy = ExtractedFuncType;</Highlight></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><Highlight kind="normal">  Group.<a href="/docs/api/structs/outlinablegroup/#aab2165e523387ae034bc2117b13c5d51">OutlinedFunctionType</a> = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(</Highlight></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><Highlight kind="normal">      RetTy, Group.<a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// These functions will only be called from within the same module, so</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we can set an internal linkage.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><Highlight kind="normal">  Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a> = <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(</Highlight></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><Highlight kind="normal">      Group.<a href="/docs/api/structs/outlinablegroup/#aab2165e523387ae034bc2117b13c5d51">OutlinedFunctionType</a>, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>,</Highlight></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;outlined&#95;ir&#95;func&#95;&quot;</Highlight><Highlight kind="normal"> + std::to&#95;string(FunctionNameSuffix), M);</Highlight></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Transfer the swifterr attribute to the correct function parameter.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Group.<a href="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff">SwiftErrorArgument</a>)</Highlight></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><Highlight kind="normal">    Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(&#42;Group.<a href="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff">SwiftErrorArgument</a>,</Highlight></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><Highlight kind="normal">                                         Attribute::SwiftError);</Highlight></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><Highlight kind="normal">  Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(Attribute::OptimizeForSize);</Highlight></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><Highlight kind="normal">  Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(Attribute::MinSize);</Highlight></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there&#39;s a DISubprogram associated with this outlined function, then</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// emit debug info for the outlined function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DISubprogram &#42;SP = <a href="#aac5cfc936b6963f4e848982328d39e8e">getSubprogramOrNull</a>(Group)) &#123;</Highlight></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>;</Highlight></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We have a DISubprogram. Get its DICompileUnit.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><Highlight kind="normal">    DICompileUnit &#42;CU = SP-&gt;getUnit();</Highlight></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><Highlight kind="normal">    DIBuilder <a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>(M, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, CU);</Highlight></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><Highlight kind="normal">    DIFile &#42;<a href="/docs/api/namespaces/anonymous-rustdemangle-cpp-/#a76a6de3bfe4b34e80479b5139aae1ab7a19c562a36aeb455d09534f93b4f5236f">Unit</a> = SP-&gt;getFile();</Highlight></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><Highlight kind="normal">    Mangler Mg;</Highlight></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Get the mangled name of the function for the linkage name.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><Highlight kind="normal">    std::string <a href="/docs/api/namespaces/llvm/nvptxisd/#ab995b6d422b079c863075e073b2eb96ba7cff9cc4a40fe2b19129ee8e9b0ec645">Dummy</a>;</Highlight></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><Highlight kind="normal">    llvm::raw&#95;string&#95;ostream MangledNameStream(Dummy);</Highlight></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><Highlight kind="normal">    Mg.<a href="/docs/api/classes/llvm/mangler/#aa1c9296fd511eb96bb487befbf5e7cea">getNameWithPrefix</a>(MangledNameStream, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><Highlight kind="normal">    DISubprogram &#42;OutlinedSP = <a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>.createFunction(</Highlight></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><Highlight kind="normal">        Unit </Highlight><Highlight kind="comment">/&#42; Context &#42;/</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName(), Dummy, Unit </Highlight><Highlight kind="comment">/&#42; File &#42;/</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><Highlight kind="normal">        0 </Highlight><Highlight kind="comment">/&#42; Line 0 is reserved for compiler-generated code. &#42;/</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>.createSubroutineType(<a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>.getOrCreateTypeArray(&#123;&#125;)), </Highlight><Highlight kind="comment">/&#42; void type &#42;/</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><Highlight kind="normal">        0, </Highlight><Highlight kind="comment">/&#42; Line 0 is reserved for compiler-generated code. &#42;/</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><Highlight kind="normal">        DINode::DIFlags::FlagArtificial </Highlight><Highlight kind="comment">/&#42; Compiler-generated code. &#42;/</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><Highlight kind="normal">        </Highlight><Highlight kind="comment">/&#42; Outlined code is optimized code by definition. &#42;/</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><Highlight kind="normal">        DISubprogram::SPFlagDefinition | DISubprogram::SPFlagOptimized);</Highlight></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t add any new variables to the subprogram.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>.finalizeSubprogram(OutlinedSP);</Highlight></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Attach subprogram to the function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;setSubprogram(OutlinedSP);</Highlight></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We&#39;re done with the DIBuilder.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/aarch64packey/#abf4394f452bde3f544999858d71e4b46a8a67c950f093761829058d45fbc3f522">DB</a>.finalize();</Highlight></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>;</Highlight></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><Highlight kind="comment">/// Move each BasicBlock in \\p Old to \\p New.</Highlight></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><Highlight kind="comment">/// \\param &#91;in&#93; Old - The function to move the basic blocks from.</Highlight></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><Highlight kind="comment">/// \\param &#91;in&#93; New - The function to move the basic blocks to.</Highlight></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><Highlight kind="comment">/// \\param &#91;out&#93; NewEnds - The return blocks of the new overall function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706" lineLink="#a4047976de351f78967fba27df7a6361f"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a4047976de351f78967fba27df7a6361f">moveFunctionData</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;Old, <a href="/docs/api/classes/llvm/function">Function</a> &amp;New,</Highlight></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;NewEnds) &#123;</Highlight></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;CurrBB : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(Old)) &#123;</Highlight></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><Highlight kind="normal">    CurrBB.removeFromParent();</Highlight></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><Highlight kind="normal">    CurrBB.insertInto(&amp;New);</Highlight></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = CurrBB.getTerminator();</Highlight></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For each block we find a return instruction is, it is a potential exit</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// path for the function.  We keep track of each block based on the return</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// value here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;RI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ReturnInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><Highlight kind="normal">      NewEnds.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(std::make&#95;pair(RI-&gt;getReturnValue(), &amp;CurrBB));</Highlight></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><Highlight kind="normal">    std::vector&lt;Instruction &#42;&gt; DebugInsts;</Highlight></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Val : CurrBB) &#123;</Highlight></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Since debug-info originates from many different locations in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// program, it will cause incorrect reporting from a debugger if we keep</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the same debug instructions. Drop non-intrinsic DbgVariableRecords</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// here, collect intrinsics for removal later.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><Highlight kind="normal">      Val.dropDbgRecords();</Highlight></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We must handle the scoping of called functions differently than</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// other outlined instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(&amp;Val)) &#123;</Highlight></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Remove the debug information for outlined functions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><Highlight kind="normal">        Val.setDebugLoc(<a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</Highlight></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Loop info metadata may contain line locations. Update them to have no</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// value in the new subprogram since the outlined code could be from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// several locations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> updateLoopInfoLoc = &#91;&amp;New&#93;(<a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42;MD) -&gt; <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;SP = New.getSubprogram())</Highlight></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/loc">Loc</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;DILocation&gt;</a>(MD))</Highlight></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DILocation::get</a>(New.getContext(), <a href="/docs/api/namespaces/llvm/loc">Loc</a>-&gt;getLine(),</Highlight></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><Highlight kind="normal">                                     <a href="/docs/api/namespaces/llvm/loc">Loc</a>-&gt;getColumn(), SP, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MD;</Highlight></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><Highlight kind="normal">        &#125;;</Highlight></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#aecd4ed57fa6a20d048310d43f5c96da9">updateLoopMetadataDebugLocations</a>(Val, updateLoopInfoLoc);</Highlight></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// From this point we are only handling call instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(&amp;Val);</Highlight></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Collect debug intrinsics for later removal.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(CI)) &#123;</Highlight></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><Highlight kind="normal">        DebugInsts.push&#95;back(&amp;Val);</Highlight></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Edit the scope of called functions inside of outlined functions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;SP = New.getSubprogram()) &#123;</Highlight></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/dilocation">DILocation</a> &#42;DI = <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DILocation::get</a>(New.getContext(), 0, 0, SP);</Highlight></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><Highlight kind="normal">        Val.setDebugLoc(DI);</Highlight></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : DebugInsts)</Highlight></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><Highlight kind="comment">/// Find the constants that will need to be lifted into arguments</Highlight></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><Highlight kind="comment">/// as they are not the same in each instance of the region.</Highlight></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><Highlight kind="comment">/// \\param &#91;in&#93; C - The IRSimilarityCandidate containing the region we are</Highlight></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><Highlight kind="comment">/// analyzing.</Highlight></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><Highlight kind="comment">/// \\param &#91;in&#93; NotSame - The set of global value numbers that do not have a</Highlight></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><Highlight kind="comment">/// single Constant across all OutlinableRegions similar to \\p C.</Highlight></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><Highlight kind="comment">/// \\param &#91;out&#93; Inputs - The list containing the global value numbers of the</Highlight></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><Highlight kind="comment">/// arguments needed for the region of code.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778" lineLink="#acda959f961048eba09125aba48d1142e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#acda959f961048eba09125aba48d1142e">findConstants</a>(<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> &amp;NotSame,</Highlight></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><Highlight kind="normal">                          std::vector&lt;unsigned&gt; &amp;Inputs) &#123;</Highlight></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> Seen;</Highlight></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iterate over the instructions, and find what constants will need to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// extracted into arguments.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (IRInstructionDataList::iterator IDIt = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.begin(), EndIDIt = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.end();</Highlight></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><Highlight kind="normal">       IDIt != EndIDIt; IDIt++) &#123;</Highlight></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : (&#42;IDIt).OperVals) &#123;</Highlight></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Since these are stored before any outlining, they will be in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// global value numbering.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> GVN = &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getGVN(V);</Highlight></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V))</Highlight></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NotSame.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(GVN) &amp;&amp; Seen.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(GVN).second)</Highlight></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><Highlight kind="normal">          Inputs.push&#95;back(GVN);</Highlight></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><Highlight kind="comment">/// Find the GVN for the inputs that have been found by the CodeExtractor.</Highlight></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><Highlight kind="comment">/// \\param &#91;in&#93; C - The IRSimilarityCandidate containing the region we are</Highlight></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><Highlight kind="comment">/// analyzing.</Highlight></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><Highlight kind="comment">/// \\param &#91;in&#93; CurrentInputs - The set of inputs found by the</Highlight></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><Highlight kind="comment">/// CodeExtractor.</Highlight></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><Highlight kind="comment">/// \\param &#91;in&#93; OutputMappings - The mapping of values that have been replaced</Highlight></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><Highlight kind="comment">/// by a new output value.</Highlight></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><Highlight kind="comment">/// \\param &#91;out&#93; EndInputNumbers - The global value numbers for the extracted</Highlight></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><Highlight kind="comment">/// arguments.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806" lineLink="#a9165dd298666d75ed2e5be7d5d8b50e5"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a9165dd298666d75ed2e5be7d5d8b50e5">mapInputsToGVNs</a>(<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>,</Highlight></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;CurrentInputs,</Highlight></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><Highlight kind="normal">                            </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings,</Highlight></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><Highlight kind="normal">                            std::vector&lt;unsigned&gt; &amp;EndInputNumbers) &#123;</Highlight></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get the Global Value Number for each input.  We check if the Value has been</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// replaced by a different value at output, and use the original value before</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// replacement.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/input">Input</a> : CurrentInputs) &#123;</Highlight></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/input">Input</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Have a nullptr as an input&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> It = OutputMappings.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/classes/input">Input</a>);</Highlight></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It != OutputMappings.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</Highlight></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><Highlight kind="normal">      <a href="/docs/api/classes/input">Input</a> = It-&gt;second;</Highlight></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getGVN(<a href="/docs/api/classes/input">Input</a>) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Could not find a numbering for the given input&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><Highlight kind="normal">    EndInputNumbers.push&#95;back(&#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getGVN(<a href="/docs/api/classes/input">Input</a>));</Highlight></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><Highlight kind="comment">/// Find the original value for the \\p ArgInput values if any one of them was</Highlight></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><Highlight kind="comment">/// replaced during a previous extraction.</Highlight></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><Highlight kind="comment">/// \\param &#91;in&#93; ArgInputs - The inputs to be extracted by the code extractor.</Highlight></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><Highlight kind="comment">/// \\param &#91;in&#93; OutputMappings - The mapping of values that have been replaced</Highlight></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><Highlight kind="comment">/// by a new output value.</Highlight></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><Highlight kind="comment">/// \\param &#91;out&#93; RemappedArgInputs - The remapped values according to</Highlight></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><Highlight kind="comment">/// \\p OutputMappings that will be extracted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832" lineLink="#a09e9f16b4a1aaf539000b95bf5442155"><Highlight kind="normal"><a href="#a09e9f16b4a1aaf539000b95bf5442155">remapExtractedInputs</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Value &#42;&gt;</a> ArgInputs,</Highlight></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><Highlight kind="normal">                     </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings,</Highlight></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><Highlight kind="normal">                     <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;RemappedArgInputs) &#123;</Highlight></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get the global value number for each input that will be extracted as an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// argument by the code extractor, remapping if needed for reloaded values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/input">Input</a> : ArgInputs) &#123;</Highlight></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> It = OutputMappings.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(<a href="/docs/api/classes/input">Input</a>);</Highlight></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It != OutputMappings.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</Highlight></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><Highlight kind="normal">      <a href="/docs/api/classes/input">Input</a> = It-&gt;second;</Highlight></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><Highlight kind="normal">    RemappedArgInputs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/classes/input">Input</a>);</Highlight></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><Highlight kind="comment">/// Find the input GVNs and the output values for a region of Instructions.</Highlight></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><Highlight kind="comment">/// Using the code extractor, we collect the inputs to the extracted function.</Highlight></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><Highlight kind="comment">/// The \\p Region can be identified as needing to be ignored in this function.</Highlight></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><Highlight kind="comment">/// It should be checked whether it should be ignored after a call to this</Highlight></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><Highlight kind="comment">/// function.</Highlight></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><Highlight kind="comment">/// \\param &#91;in,out&#93; Region - The region of code to be analyzed.</Highlight></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><Highlight kind="comment">/// \\param &#91;out&#93; InputGVNs - The global value numbers for the extracted</Highlight></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><Highlight kind="comment">/// arguments.</Highlight></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><Highlight kind="comment">/// \\param &#91;in&#93; NotSame - The global value numbers in the region that do not</Highlight></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><Highlight kind="comment">/// have the same constant value in the regions structurally similar to</Highlight></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><Highlight kind="comment">/// \\p Region.</Highlight></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><Highlight kind="comment">/// \\param &#91;in&#93; OutputMappings - The mapping of values that have been replaced</Highlight></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><Highlight kind="comment">/// by a new output value after extraction.</Highlight></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><Highlight kind="comment">/// \\param &#91;out&#93; ArgInputs - The values of the inputs to the extracted function.</Highlight></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><Highlight kind="comment">/// \\param &#91;out&#93; Outputs - The set of values extracted by the CodeExtractor</Highlight></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><Highlight kind="comment">/// as outputs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863" lineLink="#a48d81e3f58b8db143bc85763d25dbc7a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a48d81e3f58b8db143bc85763d25dbc7a">getCodeExtractorArguments</a>(</Highlight></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>, std::vector&lt;unsigned&gt; &amp;InputGVNs,</Highlight></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> &amp;NotSame, <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings,</Highlight></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;ArgInputs, <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;Outputs) &#123;</Highlight></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Candidate;</Highlight></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// OverallInputs are the inputs to the region found by the CodeExtractor,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// SinkCands and HoistCands are used by the CodeExtractor to find sunken</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// allocas of values whose lifetimes are contained completely within the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// outlined region. PremappedInputs are the arguments found by the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// CodeExtractor, removing conditions such as sunken allocas, but that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// may need to be remapped due to the extracted output values replacing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the original values. We use DummyOutputs for this first run of finding</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// inputs and outputs since the outputs could change during findAllocas,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the correct set of extracted outputs will be in the final Outputs ValueSet.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> OverallInputs, PremappedInputs, SinkCands, HoistCands,</Highlight></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><Highlight kind="normal">      DummyOutputs;</Highlight></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Use the code extractor to get the inputs and outputs, without sunken</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// allocas or removing llvm.assumes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/codeextractor">CodeExtractor</a> &#42;CE = <a href="/docs/api/classes/llvm/region">Region</a>.CE;</Highlight></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><Highlight kind="normal">  CE-&gt;findInputsOutputs(OverallInputs, DummyOutputs, SinkCands);</Highlight></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/region">Region</a>.StartBB &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Region must have a start BasicBlock!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;OrigF = <a href="/docs/api/classes/llvm/region">Region</a>.StartBB-&gt;<a href="/docs/api/classes/llvm/regionbase/#a7ed9c79ac80ed5996c7e241814302eab">getParent</a>();</Highlight></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/codeextractoranalysiscache">CodeExtractorAnalysisCache</a> CEAC(&#42;OrigF);</Highlight></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dummy = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The region may be ineligible due to VarArgs in the parent function. In this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// case we ignore the region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CE-&gt;isEligible()) &#123;</Highlight></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/region">Region</a>.IgnoreRegion = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find if any values are going to be sunk into the function when extracted</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><Highlight kind="normal">  CE-&gt;findAllocas(CEAC, SinkCands, HoistCands, Dummy);</Highlight></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><Highlight kind="normal">  CE-&gt;findInputsOutputs(PremappedInputs, Outputs, SinkCands);</Highlight></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Support regions with sunken allocas: values whose lifetimes are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// contained completely within the outlined region.  These are not guaranteed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to be the same in every region, so we must elevate them all to arguments</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// when they appear.  If these values are not equal, it means there is some</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Input in OverallInputs that was removed for ArgInputs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OverallInputs.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>() != PremappedInputs.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>()) &#123;</Highlight></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/region">Region</a>.IgnoreRegion = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><Highlight kind="normal">  <a href="#acda959f961048eba09125aba48d1142e">findConstants</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, NotSame, InputGVNs);</Highlight></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><Highlight kind="normal">  <a href="#a9165dd298666d75ed2e5be7d5d8b50e5">mapInputsToGVNs</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, OverallInputs, OutputMappings, InputGVNs);</Highlight></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><Highlight kind="normal">  <a href="#a09e9f16b4a1aaf539000b95bf5442155">remapExtractedInputs</a>(PremappedInputs.<a href="/docs/api/classes/llvm/setvector/#a0c7d0dae14eb8a5916fff9f72d8b46d2">getArrayRef</a>(), OutputMappings,</Highlight></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><Highlight kind="normal">                       ArgInputs);</Highlight></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Sort the GVNs, since we now have constants included in the \\ref InputGVNs</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we need to make sure they are in a deterministic order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">stable&#95;sort</a>(InputGVNs);</Highlight></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><Highlight kind="comment">/// Look over the inputs and map each input argument to an argument in the</Highlight></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><Highlight kind="comment">/// overall function for the OutlinableRegions.  This creates a way to replace</Highlight></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><Highlight kind="comment">/// the arguments of the extracted function with the arguments of the new</Highlight></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><Highlight kind="comment">/// overall function.</Highlight></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><Highlight kind="comment">/// \\param &#91;in,out&#93; Region - The region of code to be analyzed.</Highlight></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><Highlight kind="comment">/// \\param &#91;in&#93; InputGVNs - The global value numbering of the input values</Highlight></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><Highlight kind="comment">/// collected.</Highlight></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><Highlight kind="comment">/// \\param &#91;in&#93; ArgInputs - The values of the arguments to the extracted</Highlight></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><Highlight kind="comment">/// function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934" lineLink="#a9148948069532c9a5e1b59e3668b8cc3"><Highlight kind="normal"><a href="#a9148948069532c9a5e1b59e3668b8cc3">findExtractedInputToOverallInputMapping</a>(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</Highlight></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><Highlight kind="normal">                                        std::vector&lt;unsigned&gt; &amp;InputGVNs,</Highlight></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;ArgInputs) &#123;</Highlight></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Candidate;</Highlight></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><Highlight kind="normal">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</Highlight></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This counts the argument number in the overall function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> TypeIndex = 0;</Highlight></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This counts the argument number in the extracted function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OriginalIndex = 0;</Highlight></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find the mapping of the extracted arguments to the arguments for the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// overall function. Since there may be extra arguments in the overall</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// function to account for the extracted constants, we have two different</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// counters as we find extracted arguments, and as we come across overall</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// arguments.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Additionally, in our first pass, for the first extracted function,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we find argument locations for the canonical value numbering.  This</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// numbering overrides any discovered location for the extracted code.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> InputVal : InputGVNs) &#123;</Highlight></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><Highlight kind="normal">    std::optional&lt;unsigned&gt; CanonicalNumberOpt = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getCanonicalNum(InputVal);</Highlight></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CanonicalNumberOpt &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Canonical number not found?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> CanonicalNumber = &#42;CanonicalNumberOpt;</Highlight></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><Highlight kind="normal">    std::optional&lt;Value &#42;&gt; InputOpt = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.fromGVN(InputVal);</Highlight></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InputOpt &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Global value number not found?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/input">Input</a> = &#42;InputOpt;</Highlight></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, unsigned&gt;::iterator</a> AggArgIt =</Highlight></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><Highlight kind="normal">        Group.<a href="/docs/api/structs/outlinablegroup/#ac3c1798aada6da8b72185545e4944c25">CanonicalNumberToAggArg</a>.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(CanonicalNumber);</Highlight></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Group.<a href="/docs/api/structs/outlinablegroup/#a9fabb6e6f74e4ef23575f45ea098b827">InputTypesSet</a>) &#123;</Highlight></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><Highlight kind="normal">      Group.<a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>.push&#95;back(<a href="/docs/api/classes/input">Input</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the input value has a swifterr attribute, make sure to mark the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// argument in the overall function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/input">Input</a>-&gt;isSwiftError()) &#123;</Highlight></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><Highlight kind="normal">            !Group.<a href="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff">SwiftErrorArgument</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><Highlight kind="normal">            </Highlight><Highlight kind="stringliteral">&quot;Argument already marked with swifterr for this OutlinableGroup!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><Highlight kind="normal">        Group.<a href="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff">SwiftErrorArgument</a> = TypeIndex;</Highlight></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if we have a constant. If we do add it to the overall argument</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// number to Constant map for the region, and continue to the next input.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CST = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Constant&gt;</a>(<a href="/docs/api/classes/input">Input</a>)) &#123;</Highlight></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AggArgIt != Group.<a href="/docs/api/structs/outlinablegroup/#ac3c1798aada6da8b72185545e4944c25">CanonicalNumberToAggArg</a>.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</Highlight></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToConstant.insert(std::make&#95;pair(AggArgIt-&gt;second, CST));</Highlight></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><Highlight kind="normal">        Group.<a href="/docs/api/structs/outlinablegroup/#ac3c1798aada6da8b72185545e4944c25">CanonicalNumberToAggArg</a>.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(</Highlight></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><Highlight kind="normal">            std::make&#95;pair(CanonicalNumber, TypeIndex));</Highlight></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToConstant.insert(std::make&#95;pair(TypeIndex, CST));</Highlight></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><Highlight kind="normal">      TypeIndex++;</Highlight></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// It is not a constant, we create the mapping from extracted argument list</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to the overall argument list, using the canonical location, if it exists.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ArgInputs.<a href="/docs/api/classes/llvm/setvector/#abb03e3b6c4fd937936a13afe4f60d291">count</a>(<a href="/docs/api/classes/input">Input</a>) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Input cannot be found!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AggArgIt != Group.<a href="/docs/api/structs/outlinablegroup/#ac3c1798aada6da8b72185545e4944c25">CanonicalNumberToAggArg</a>.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</Highlight></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OriginalIndex != AggArgIt-&gt;second)</Highlight></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/region">Region</a>.ChangedArgOrder = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedArgToAgg.insert(</Highlight></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><Highlight kind="normal">          std::make&#95;pair(OriginalIndex, AggArgIt-&gt;second));</Highlight></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToExtracted.insert(</Highlight></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><Highlight kind="normal">          std::make&#95;pair(AggArgIt-&gt;second, OriginalIndex));</Highlight></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><Highlight kind="normal">      Group.<a href="/docs/api/structs/outlinablegroup/#ac3c1798aada6da8b72185545e4944c25">CanonicalNumberToAggArg</a>.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(</Highlight></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><Highlight kind="normal">          std::make&#95;pair(CanonicalNumber, TypeIndex));</Highlight></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedArgToAgg.insert(std::make&#95;pair(OriginalIndex, TypeIndex));</Highlight></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToExtracted.insert(std::make&#95;pair(TypeIndex, OriginalIndex));</Highlight></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><Highlight kind="normal">    OriginalIndex++;</Highlight></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><Highlight kind="normal">    TypeIndex++;</Highlight></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the function type definitions for the OutlinableGroup holding the region</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// have not been set, set the length of the inputs here.  We should have the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// same inputs for all of the different regions contained in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// OutlinableGroup since they are all structurally similar to one another.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Group.<a href="/docs/api/structs/outlinablegroup/#a9fabb6e6f74e4ef23575f45ea098b827">InputTypesSet</a>) &#123;</Highlight></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><Highlight kind="normal">    Group.<a href="/docs/api/structs/outlinablegroup/#aeab6020692f93361cff45734711204fc">NumAggregateInputs</a> = TypeIndex;</Highlight></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><Highlight kind="normal">    Group.<a href="/docs/api/structs/outlinablegroup/#a9fabb6e6f74e4ef23575f45ea098b827">InputTypesSet</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/region">Region</a>.NumExtractedInputs = OriginalIndex;</Highlight></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><Highlight kind="comment">/// Check if the \\p V has any uses outside of the region other than \\p PN.</Highlight></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><Highlight kind="comment">/// \\param V &#91;in&#93; - The value to check.</Highlight></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><Highlight kind="comment">/// \\param PHILoc &#91;in&#93; - The location in the PHINode of \\p V.</Highlight></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><Highlight kind="comment">/// \\param PN &#91;in&#93; - The PHINode using \\p V.</Highlight></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><Highlight kind="comment">/// \\param Exits &#91;in&#93; - The potential blocks we exit to from the outlined</Highlight></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><Highlight kind="comment">/// region.</Highlight></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><Highlight kind="comment">/// \\param BlocksInRegion &#91;in&#93; - The basic blocks contained in the region.</Highlight></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><Highlight kind="comment">/// \\returns true if \\p V has any use soutside its region other than \\p PN.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036" lineLink="#a84e785627d5ab55370b5fa402ad7193f"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a84e785627d5ab55370b5fa402ad7193f">outputHasNonPHI</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> PHILoc, <a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN,</Highlight></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 1&gt;</a> &amp;Exits,</Highlight></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> &amp;BlocksInRegion) &#123;</Highlight></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We check to see if the value is used by the PHINode from some other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// predecessor not included in the region.  If it is, we make sure</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to keep it as an output.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/namespaces/llvm/#adc4eb8be6f7a12ede962987fb9cabb47">llvm::seq&lt;unsigned&gt;</a>(0, PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>()),</Highlight></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><Highlight kind="normal">             &#91;PHILoc, &amp;PN, V, &amp;BlocksInRegion&#93;(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx) &#123;</Highlight></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><Highlight kind="normal">               return (Idx != PHILoc &amp;&amp; V == PN.getIncomingValue(Idx) &amp;&amp;</Highlight></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><Highlight kind="normal">                       !BlocksInRegion.contains(PN.getIncomingBlock(Idx)));</Highlight></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><Highlight kind="normal">             &#125;))</Highlight></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if the value is used by any other instructions outside the region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(V-&gt;users(), &#91;&amp;Exits, &amp;BlocksInRegion&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><Highlight kind="normal">    Instruction &#42;I = dyn&#95;cast&lt;Instruction&gt;(U);</Highlight></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><Highlight kind="normal">    if (!I)</Highlight></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><Highlight kind="normal">      return false;</Highlight></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the use of the item is inside the region, we skip it.  Uses</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inside the region give us useful information about how the item could be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// used as an output.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><Highlight kind="normal">    BasicBlock &#42;Parent = I-&gt;getParent();</Highlight></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><Highlight kind="normal">    if (BlocksInRegion.contains(Parent))</Highlight></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><Highlight kind="normal">      return false;</Highlight></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If it&#39;s not a PHINode then we definitely know the use matters.  This</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// output value will not completely combined with another item in a PHINode</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// as it is directly reference by another non-phi instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><Highlight kind="normal">    if (!isa&lt;PHINode&gt;(I))</Highlight></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><Highlight kind="normal">      return true;</Highlight></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we have a PHINode outside one of the exit locations, then it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// can be considered an outside use as well.  If there is a PHINode</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// contained in the Exit where this values use matters, it will be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// caught when we analyze that PHINode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><Highlight kind="normal">    if (!Exits.contains(Parent))</Highlight></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><Highlight kind="normal">      return true;</Highlight></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><Highlight kind="normal">    return false;</Highlight></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><Highlight kind="comment">/// Test whether \\p CurrentExitFromRegion contains any PhiNodes that should be</Highlight></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><Highlight kind="comment">/// considered outputs. A PHINodes is an output when more than one incoming</Highlight></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><Highlight kind="comment">/// value has been marked by the CodeExtractor as an output.</Highlight></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><Highlight kind="comment">/// \\param CurrentExitFromRegion &#91;in&#93; - The block to analyze.</Highlight></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><Highlight kind="comment">/// \\param PotentialExitsFromRegion &#91;in&#93; - The potential exit blocks from the</Highlight></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><Highlight kind="comment">/// region.</Highlight></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><Highlight kind="comment">/// \\param RegionBlocks &#91;in&#93; - The basic blocks in the region.</Highlight></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><Highlight kind="comment">/// \\param Outputs &#91;in, out&#93; - The existing outputs for the region, we may add</Highlight></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><Highlight kind="comment">/// PHINodes to this as we find that they replace output values.</Highlight></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><Highlight kind="comment">/// \\param OutputsReplacedByPHINode &#91;out&#93; - A set containing outputs that are</Highlight></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><Highlight kind="comment">/// totally replaced  by a PHINode.</Highlight></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><Highlight kind="comment">/// \\param OutputsWithNonPhiUses &#91;out&#93; - A set containing outputs that are used</Highlight></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><Highlight kind="comment">/// in PHINodes, but have other uses, and should still be considered outputs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093" lineLink="#a882dcfc2455d525e78a8bbf46863ace2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a882dcfc2455d525e78a8bbf46863ace2">analyzeExitPHIsForOutputUses</a>(</Highlight></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CurrentExitFromRegion,</Highlight></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 1&gt;</a> &amp;PotentialExitsFromRegion,</Highlight></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> &amp;RegionBlocks, <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;Outputs,</Highlight></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;Value &#42;&gt;</a> &amp;OutputsReplacedByPHINode,</Highlight></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;Value &#42;&gt;</a> &amp;OutputsWithNonPhiUses) &#123;</Highlight></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : CurrentExitFromRegion-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Find all incoming values from the outlining region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;unsigned, 2&gt;</a> IncomingVals;</Highlight></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = PN.getNumIncomingValues(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RegionBlocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(PN.getIncomingBlock(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)))</Highlight></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><Highlight kind="normal">        IncomingVals.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Do not process PHI if there are no predecessors from region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumIncomingVals = IncomingVals.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</Highlight></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumIncomingVals == 0)</Highlight></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If there is one predecessor, we mark it as a value that needs to be kept</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// as an output.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumIncomingVals == 1) &#123;</Highlight></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = PN.getIncomingValue(&#42;IncomingVals.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>());</Highlight></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><Highlight kind="normal">      OutputsWithNonPhiUses.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(V);</Highlight></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><Highlight kind="normal">      OutputsReplacedByPHINode.<a href="/docs/api/classes/llvm/detail/densesetimpl/#af972d87e15b5f6ed61bd5c3956c5213d">erase</a>(V);</Highlight></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This PHINode will be used as an output value, so we add it to our list.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><Highlight kind="normal">    Outputs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(&amp;PN);</Highlight></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Not all of the incoming values should be ignored as other inputs and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// outputs may have uses in outlined region.  If they have other uses</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// outside of the single PHINode we should not skip over it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx : IncomingVals) &#123;</Highlight></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = PN.getIncomingValue(Idx);</Highlight></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a84e785627d5ab55370b5fa402ad7193f">outputHasNonPHI</a>(V, Idx, PN, PotentialExitsFromRegion, RegionBlocks)) &#123;</Highlight></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><Highlight kind="normal">        OutputsWithNonPhiUses.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(V);</Highlight></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><Highlight kind="normal">        OutputsReplacedByPHINode.<a href="/docs/api/classes/llvm/detail/densesetimpl/#af972d87e15b5f6ed61bd5c3956c5213d">erase</a>(V);</Highlight></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OutputsWithNonPhiUses.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(V))</Highlight></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><Highlight kind="normal">        OutputsReplacedByPHINode.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(V);</Highlight></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Represents the type for the unsigned number denoting the output number for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><Highlight kind="normal"></Highlight><Highlight kind="comment">// phi node, along with the canonical number for the exit block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141" lineLink="#ad0fabe111fc0db047a04c21481fa6aab"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="#ad0fabe111fc0db047a04c21481fa6aab">ArgLocWithBBCanon</a> = std::pair&lt;unsigned, unsigned&gt;;</Highlight></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The list of canonical numbers for the incoming values to a PHINode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143" lineLink="#a69893e3a4e9fbee5b5aa9ac4b036dc5c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="#a69893e3a4e9fbee5b5aa9ac4b036dc5c">CanonList</a> = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;unsigned, 2&gt;</a>;</Highlight></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The pair type representing the set of canonical values being combined in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><Highlight kind="normal"></Highlight><Highlight kind="comment">// PHINode, along with the location data for the PHINode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146" lineLink="#a0389cc3001a985e14dcff4067684ad70"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="#a0389cc3001a985e14dcff4067684ad70">PHINodeData</a> = std::pair&lt;ArgLocWithBBCanon, CanonList&gt;;</Highlight></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><Highlight kind="comment">/// Encode \\p PND as an integer for easy lookup based on the argument location,</Highlight></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><Highlight kind="comment">/// the parent BasicBlock canonical numbering, and the canonical numbering of</Highlight></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><Highlight kind="comment">/// the values stored in the PHINode.</Highlight></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><Highlight kind="comment">/// \\param PND - The data to hash.</Highlight></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><Highlight kind="comment">/// \\returns The hash code of \\p PND.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154" lineLink="#a652d50395284a0dec463c533709bc231"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/hash-code">hash&#95;code</a> <a href="#a652d50395284a0dec463c533709bc231">encodePHINodeData</a>(<a href="#a0389cc3001a985e14dcff4067684ad70">PHINodeData</a> &amp;PND) &#123;</Highlight></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#add71474638430694c84640146383fc44">llvm::hash&#95;combine</a>(</Highlight></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a0e2e479cf4860dc8a00614e36ee3d5e9">llvm::hash&#95;value</a>(PND.first.first), <a href="/docs/api/namespaces/llvm/#a0e2e479cf4860dc8a00614e36ee3d5e9">llvm::hash&#95;value</a>(PND.first.second),</Highlight></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#af80edfc5e42059e045aa7bf7fe42bee3">llvm::hash&#95;combine&#95;range</a>(PND.second.begin(), PND.second.end()));</Highlight></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><Highlight kind="comment">/// Create a special GVN for PHINodes that will be used outside of</Highlight></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><Highlight kind="comment">/// the region.  We create a hash code based on the Canonical number of the</Highlight></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><Highlight kind="comment">/// parent BasicBlock, the canonical numbering of the values stored in the</Highlight></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><Highlight kind="comment">/// PHINode and the aggregate argument location.  This is used to find whether</Highlight></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><Highlight kind="comment">/// this PHINode type has been given a canonical numbering already.  If not, we</Highlight></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><Highlight kind="comment">/// assign it a value and store it for later use.  The value is returned to</Highlight></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><Highlight kind="comment">/// identify different output schemes for the set of regions.</Highlight></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><Highlight kind="comment">/// \\param Region - The region that \\p PN is an output for.</Highlight></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><Highlight kind="comment">/// \\param PN - The PHINode we are analyzing.</Highlight></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><Highlight kind="comment">/// \\param Blocks - The blocks for the region we are analyzing.</Highlight></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><Highlight kind="comment">/// \\param AggArgIdx - The argument \\p PN will be stored into.</Highlight></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><Highlight kind="comment">/// \\returns An optional holding the assigned canonical number, or std::nullopt</Highlight></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><Highlight kind="comment">/// if there is some attribute of the PHINode blocking it from being used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174" lineLink="#a1c7b2c4c8824cfb8d35c97f6923c3fe2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> std::optional&lt;unsigned&gt; <a href="#a1c7b2c4c8824cfb8d35c97f6923c3fe2">getGVNForPHINode</a>(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</Highlight></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><Highlight kind="normal">                                                <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN,</Highlight></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><Highlight kind="normal">                                                <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> &amp;Blocks,</Highlight></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><Highlight kind="normal">                                                </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AggArgIdx) &#123;</Highlight></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><Highlight kind="normal">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</Highlight></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;Cand = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Candidate;</Highlight></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PHIBB = PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><Highlight kind="normal">  <a href="#a69893e3a4e9fbee5b5aa9ac4b036dc5c">CanonList</a> PHIGVNs;</Highlight></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/llvm/incoming">Incoming</a>;</Highlight></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IncomingBlock;</Highlight></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 0, EIdx = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); Idx &lt; EIdx; Idx++) &#123;</Highlight></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/incoming">Incoming</a> = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(Idx);</Highlight></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><Highlight kind="normal">    IncomingBlock = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(Idx);</Highlight></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we cannot find a GVN, and the incoming block is included in the region</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// this means that the input to the PHINode is not included in the region we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// are trying to analyze, meaning, that if it was outlined, we would be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// adding an extra input.  We ignore this case for now, and so ignore the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><Highlight kind="normal">    std::optional&lt;unsigned&gt; OGVN = Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a3ffe65f27fa3355ffd96fbcd0bb1cbb9">getGVN</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</Highlight></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OGVN &amp;&amp; Blocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(IncomingBlock)) &#123;</Highlight></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/region">Region</a>.IgnoreRegion = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the incoming block isn&#39;t in the region, we don&#39;t have to worry about</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// this incoming value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Blocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(IncomingBlock))</Highlight></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Collect the canonical numbers of the values in the PHINode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> GVN = &#42;OGVN;</Highlight></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><Highlight kind="normal">    OGVN = Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#ae6b404a6e77e0349378afa8ae7ce0e4a">getCanonicalNum</a>(GVN);</Highlight></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OGVN &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;No GVN found for incoming value?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><Highlight kind="normal">    PHIGVNs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#42;OGVN);</Highlight></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Find the incoming block and use the canonical numbering as well to define</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the hash for the PHINode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><Highlight kind="normal">    OGVN = Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a3ffe65f27fa3355ffd96fbcd0bb1cbb9">getGVN</a>(IncomingBlock);</Highlight></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If there is no number for the incoming block, it is because we have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// split the candidate basic blocks.  So we use the previous block that it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// was split from to find the valid global value numbering for the PHINode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OGVN) &#123;</Highlight></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#ae22d915fa9ab51e40345773c663ebdeb">getStartBB</a>() == IncomingBlock &amp;&amp;</Highlight></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Unknown basic block used in exit path PHINode.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PrevBlock = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Iterate over the predecessors to the incoming block of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// PHINode, when we find a block that is not contained in the region</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// we know that this is the first block that we split from, and should</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// have a valid global value numbering.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(IncomingBlock))</Highlight></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Blocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(Pred)) &#123;</Highlight></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><Highlight kind="normal">          PrevBlock = Pred;</Highlight></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PrevBlock &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected a predecessor not in the reigon!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><Highlight kind="normal">      OGVN = Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a3ffe65f27fa3355ffd96fbcd0bb1cbb9">getGVN</a>(PrevBlock);</Highlight></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><Highlight kind="normal">    GVN = &#42;OGVN;</Highlight></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><Highlight kind="normal">    OGVN = Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#ae6b404a6e77e0349378afa8ae7ce0e4a">getCanonicalNum</a>(GVN);</Highlight></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OGVN &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;No GVN found for incoming block?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><Highlight kind="normal">    PHIGVNs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#42;OGVN);</Highlight></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now that we have the GVNs for the incoming values, we are going to combine</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// them with the GVN of the incoming bock, and the output location of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// PHINode to generate a hash value representing this instance of the PHINode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;hash&#95;code, unsigned&gt;::iterator</a> GVNToPHIIt;</Highlight></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, PHINodeData&gt;::iterator</a> PHIToGVNIt;</Highlight></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><Highlight kind="normal">  std::optional&lt;unsigned&gt; BBGVN = Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a3ffe65f27fa3355ffd96fbcd0bb1cbb9">getGVN</a>(PHIBB);</Highlight></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BBGVN &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Could not find GVN for the incoming block!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><Highlight kind="normal">  BBGVN = Cand.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#ae6b404a6e77e0349378afa8ae7ce0e4a">getCanonicalNum</a>(&#42;BBGVN);</Highlight></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BBGVN &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Could not find canonical number for the incoming block!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create a pair of the exit block canonical value, and the aggregate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// argument location, connected to the canonical numbers stored in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// PHINode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><Highlight kind="normal">  <a href="#a0389cc3001a985e14dcff4067684ad70">PHINodeData</a> TemporaryPair =</Highlight></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><Highlight kind="normal">      std::make&#95;pair(std::make&#95;pair(&#42;BBGVN, AggArgIdx), PHIGVNs);</Highlight></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/hash-code">hash&#95;code</a> PHINodeDataHash = <a href="#a652d50395284a0dec463c533709bc231">encodePHINodeData</a>(TemporaryPair);</Highlight></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Look for and create a new entry in our connection between canonical</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// numbers for PHINodes, and the set of objects we just created.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><Highlight kind="normal">  GVNToPHIIt = Group.<a href="/docs/api/structs/outlinablegroup/#a78f1513d0fadc0e72c1c7373c2003666">GVNsToPHINodeGVN</a>.find(PHINodeDataHash);</Highlight></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GVNToPHIIt == Group.<a href="/docs/api/structs/outlinablegroup/#a78f1513d0fadc0e72c1c7373c2003666">GVNsToPHINodeGVN</a>.end()) &#123;</Highlight></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Inserted = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><Highlight kind="normal">    std::tie(PHIToGVNIt, Inserted) = Group.<a href="/docs/api/structs/outlinablegroup/#a704926b49e550b25585651aea32b389b">PHINodeGVNToGVNs</a>.insert(</Highlight></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><Highlight kind="normal">        std::make&#95;pair(Group.<a href="/docs/api/structs/outlinablegroup/#a72b89466c3b2fd45331e2c315e2c33e5">PHINodeGVNTracker</a>, TemporaryPair));</Highlight></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><Highlight kind="normal">    std::tie(GVNToPHIIt, Inserted) = Group.<a href="/docs/api/structs/outlinablegroup/#a78f1513d0fadc0e72c1c7373c2003666">GVNsToPHINodeGVN</a>.insert(</Highlight></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><Highlight kind="normal">        std::make&#95;pair(PHINodeDataHash, Group.<a href="/docs/api/structs/outlinablegroup/#a72b89466c3b2fd45331e2c315e2c33e5">PHINodeGVNTracker</a>--));</Highlight></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> GVNToPHIIt-&gt;second;</Highlight></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><Highlight kind="comment">/// Create a mapping of the output arguments for the \\p Region to the output</Highlight></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><Highlight kind="comment">/// arguments of the overall outlined function.</Highlight></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><Highlight kind="comment">/// \\param &#91;in,out&#93; Region - The region of code to be analyzed.</Highlight></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><Highlight kind="comment">/// \\param &#91;in&#93; Outputs - The values found by the code extractor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276" lineLink="#a4eb66b98a828331ed6cb79ae82c0336f"><Highlight kind="normal"><a href="#a4eb66b98a828331ed6cb79ae82c0336f">findExtractedOutputToOverallOutputMapping</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</Highlight></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;Outputs) &#123;</Highlight></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><Highlight kind="normal">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</Highlight></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Candidate;</Highlight></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;&gt;</a> BE;</Highlight></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> BlocksInRegion;</Highlight></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getBasicBlocks(BlocksInRegion, BE);</Highlight></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find the exits to the region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 1&gt;</a> Exits;</Highlight></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : BE)</Highlight></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>))</Highlight></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BlocksInRegion.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(Succ))</Highlight></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><Highlight kind="normal">        Exits.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Succ);</Highlight></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// After determining which blocks exit to PHINodes, we add these PHINodes to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the set of outputs to be processed.  We also check the incoming values of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the PHINodes for whether they should no longer be considered outputs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;Value &#42;&gt;</a> OutputsReplacedByPHINode;</Highlight></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;Value &#42;&gt;</a> OutputsWithNonPhiUses;</Highlight></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBB : Exits)</Highlight></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><Highlight kind="normal">    <a href="#a882dcfc2455d525e78a8bbf46863ace2">analyzeExitPHIsForOutputUses</a>(ExitBB, Exits, BlocksInRegion, Outputs,</Highlight></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><Highlight kind="normal">                                 OutputsReplacedByPHINode,</Highlight></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><Highlight kind="normal">                                 OutputsWithNonPhiUses);</Highlight></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This counts the argument number in the extracted function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OriginalIndex = <a href="/docs/api/classes/llvm/region">Region</a>.NumExtractedInputs;</Highlight></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This counts the argument number in the overall function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> TypeIndex = Group.<a href="/docs/api/structs/outlinablegroup/#aeab6020692f93361cff45734711204fc">NumAggregateInputs</a>;</Highlight></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> TypeFound;</Highlight></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> AggArgsUsed;</Highlight></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iterate over the output types and identify if there is an aggregate pointer</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// type whose base type matches the current output type. If there is, we mark</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that we will use this output register for this value. If not we add another</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// type to the overall argument type list. We also store the GVNs used for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// stores to identify which values will need to be moved into an special</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block that holds the stores to the output registers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;Output : Outputs) &#123;</Highlight></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><Highlight kind="normal">    TypeFound = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We can do this since it is a result value, and will have a number</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// that is necessarily the same. BUT if in the future, the instructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// do not have to be in same order, but are functionally the same, we will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// have to use a different scheme, as one-to-one correspondence is not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// guaranteed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ArgumentSize = Group.<a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>.size();</Highlight></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the output is combined in a PHINode, we make sure to skip over it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OutputsReplacedByPHINode.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(Output))</Highlight></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AggArgIdx = 0;</Highlight></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Jdx = TypeIndex; Jdx &lt; ArgumentSize; Jdx++) &#123;</Highlight></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PointerType&gt;</a>(Group.<a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>&#91;Jdx&#93;))</Highlight></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AggArgsUsed.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(Jdx).second)</Highlight></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><Highlight kind="normal">      TypeFound = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedArgToAgg.insert(std::make&#95;pair(OriginalIndex, Jdx));</Highlight></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToExtracted.insert(std::make&#95;pair(Jdx, OriginalIndex));</Highlight></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><Highlight kind="normal">      AggArgIdx = Jdx;</Highlight></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We were unable to find an unused type in the output type set that matches</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the output, so we add a pointer type to the argument types of the overall</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// function to handle this output and create a mapping to it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TypeFound) &#123;</Highlight></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><Highlight kind="normal">      Group.<a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>.push&#95;back(<a href="/docs/api/classes/llvm/pointertype/#a8d7f800be5fd53dcfcdcbdc6fd9ccfe3">PointerType::get</a>(Output-&gt;getContext(),</Highlight></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><Highlight kind="normal">          M.getDataLayout().getAllocaAddrSpace()));</Highlight></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Mark the new pointer type as the last value in the aggregate argument</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// list.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ArgTypeIdx = Group.<a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>.size() - 1;</Highlight></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><Highlight kind="normal">      AggArgsUsed.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(ArgTypeIdx);</Highlight></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedArgToAgg.insert(</Highlight></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><Highlight kind="normal">          std::make&#95;pair(OriginalIndex, ArgTypeIdx));</Highlight></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToExtracted.insert(</Highlight></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><Highlight kind="normal">          std::make&#95;pair(ArgTypeIdx, OriginalIndex));</Highlight></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><Highlight kind="normal">      AggArgIdx = ArgTypeIdx;</Highlight></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Adapt to the extra input from the PHINode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Output);</Highlight></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><Highlight kind="normal">    std::optional&lt;unsigned&gt; GVN;</Highlight></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PN &amp;&amp; !BlocksInRegion.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())) &#123;</Highlight></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Values outside the region can be combined into PHINode when we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// have multiple exits. We collect both of these into a list to identify</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// which values are being used in the PHINode. Each list identifies a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// different PHINode, and a different output. We store the PHINode as it&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// own canonical value.  These canonical values are also dependent on the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// output argument it is saved to.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If two PHINodes have the same canonical values, but different aggregate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// argument locations, then they will have distinct Canonical Values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><Highlight kind="normal">      GVN = <a href="#a1c7b2c4c8824cfb8d35c97f6923c3fe2">getGVNForPHINode</a>(<a href="/docs/api/classes/llvm/region">Region</a>, PN, BlocksInRegion, AggArgIdx);</Highlight></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GVN)</Highlight></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we do not have a PHINode we use the global value numbering for the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// output value, to find the canonical number to add to the set of stored</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><Highlight kind="normal">      GVN = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getGVN(Output);</Highlight></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><Highlight kind="normal">      GVN = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getCanonicalNum(&#42;GVN);</Highlight></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Each region has a potentially unique set of outputs.  We save which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// values are output in a list of canonical values so we can differentiate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// among the different store schemes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/region">Region</a>.GVNStores.push&#95;back(&#42;GVN);</Highlight></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><Highlight kind="normal">    OriginalIndex++;</Highlight></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><Highlight kind="normal">    TypeIndex++;</Highlight></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We sort the stored values to make sure that we are not affected by analysis</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// order when determining what combination of items were stored.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">stable&#95;sort</a>(<a href="/docs/api/classes/llvm/region">Region</a>.GVNStores);</Highlight></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> IROutliner::findAddInputsOutputs(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</Highlight></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><Highlight kind="normal">                                      <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;unsigned&gt;</a> &amp;NotSame) &#123;</Highlight></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><Highlight kind="normal">  std::vector&lt;unsigned&gt; Inputs;</Highlight></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><Highlight kind="normal">  SetVector&lt;Value &#42;&gt; ArgInputs, Outputs;</Highlight></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><Highlight kind="normal">  <a href="#a48d81e3f58b8db143bc85763d25dbc7a">getCodeExtractorArguments</a>(Region, Inputs, NotSame, OutputMappings, ArgInputs,</Highlight></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><Highlight kind="normal">                            Outputs);</Highlight></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.IgnoreRegion)</Highlight></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Map the inputs found by the CodeExtractor to the arguments found for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the overall function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><Highlight kind="normal">  <a href="#a9148948069532c9a5e1b59e3668b8cc3">findExtractedInputToOverallInputMapping</a>(Region, Inputs, ArgInputs);</Highlight></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Map the outputs found by the CodeExtractor to the arguments found for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the overall function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><Highlight kind="normal">  <a href="#a4eb66b98a828331ed6cb79ae82c0336f">findExtractedOutputToOverallOutputMapping</a>(M, Region, Outputs);</Highlight></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><Highlight kind="comment">/// Replace the extracted function in the Region with a call to the overall</Highlight></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><Highlight kind="comment">/// function constructed from the deduplicated similar regions, replacing and</Highlight></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><Highlight kind="comment">/// remapping the values passed to the extracted function as arguments to the</Highlight></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><Highlight kind="comment">/// new arguments of the overall function.</Highlight></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><Highlight kind="comment">/// \\param &#91;in&#93; M - The module to outline from.</Highlight></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><Highlight kind="comment">/// \\param &#91;in&#93; Region - The regions of extracted code to be replaced with a new</Highlight></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><Highlight kind="comment">/// function.</Highlight></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><Highlight kind="comment">/// \\returns a call instruction with the replaced function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429" lineLink="#a7e2cad7ab18db9a3c940afc609c223dc"><Highlight kind="normal"><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="#a7e2cad7ab18db9a3c940afc609c223dc">replaceCalledFunction</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>) &#123;</Highlight></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><Highlight kind="normal">  std::vector&lt;Value &#42;&gt; NewCallArgs;</Highlight></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;unsigned, unsigned&gt;::iterator</a> ArgPair;</Highlight></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><Highlight kind="normal">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</Highlight></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/classes/llvm/region">Region</a>.Call;</Highlight></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Call to replace is nullptr?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;AggFunc = Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>;</Highlight></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AggFunc &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Function to replace with is nullptr?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the arguments are the same size, there are not values that need to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// made into an argument, the argument ordering has not been change, or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// different output registers to handle.  We can simply replace the called</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// function in this case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/region">Region</a>.ChangedArgOrder &amp;&amp; AggFunc-&gt;<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() == <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;arg&#95;size()) &#123;</Highlight></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Replace call to &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; with call to &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><Highlight kind="normal">                      &lt;&lt; &#42;AggFunc &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; with same number of arguments\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;setCalledFunction(AggFunc);</Highlight></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>;</Highlight></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We have a different number of arguments than the new function, so</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we need to use our previously mappings off extracted argument to overall</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// function argument, and constants to overall function argument to create the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// new argument list.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AggArgIdx = 0; AggArgIdx &lt; AggFunc-&gt;<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>(); AggArgIdx++) &#123;</Highlight></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AggArgIdx == AggFunc-&gt;<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() - 1 &amp;&amp;</Highlight></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><Highlight kind="normal">        Group.<a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>.size() &gt; 1) &#123;</Highlight></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we are on the last argument, and we need to differentiate between</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// output blocks, add an integer to the argument list to determine</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// what block to take</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Set switch block argument to &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><Highlight kind="normal">                        &lt;&lt; <a href="/docs/api/classes/llvm/region">Region</a>.OutputBlockNum &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><Highlight kind="normal">      NewCallArgs.push&#95;back(ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(M.getContext()),</Highlight></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><Highlight kind="normal">                                             <a href="/docs/api/classes/llvm/region">Region</a>.OutputBlockNum));</Highlight></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><Highlight kind="normal">    ArgPair = <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToExtracted.find(AggArgIdx);</Highlight></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ArgPair != <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToExtracted.<a href="/docs/api/classes/llvm/regionbase/#a9b0ebfeb3f47f1ad763e5b184dcb4e03">end</a>()) &#123;</Highlight></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;ArgumentValue = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getArgOperand(ArgPair-&gt;second);</Highlight></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we found the mapping from the extracted function to the overall</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// function, we simply add it to the argument list.  We use the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// value, it just needs to honor the new order of arguments.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Setting argument &quot;</Highlight><Highlight kind="normal"> &lt;&lt; AggArgIdx &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to value &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><Highlight kind="normal">                        &lt;&lt; &#42;ArgumentValue &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><Highlight kind="normal">      NewCallArgs.push&#95;back(ArgumentValue);</Highlight></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If it is a constant, we simply add it to the argument list as a value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/region">Region</a>.AggArgToConstant.<a href="/docs/api/classes/llvm/regionbase/#a75479f44e7157d1a8592231addb67c9c">contains</a>(AggArgIdx)) &#123;</Highlight></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CST = <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToConstant.find(AggArgIdx)-&gt;second;</Highlight></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Setting argument &quot;</Highlight><Highlight kind="normal"> &lt;&lt; AggArgIdx &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to value &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><Highlight kind="normal">                        &lt;&lt; &#42;CST &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><Highlight kind="normal">      NewCallArgs.push&#95;back(CST);</Highlight></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add a nullptr value if the argument is not found in the extracted</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// function.  If we cannot find a value, it means it is not in use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// for the region, so we should not pass anything to it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Setting argument &quot;</Highlight><Highlight kind="normal"> &lt;&lt; AggArgIdx &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to nullptr\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><Highlight kind="normal">    NewCallArgs.push&#95;back(<a href="/docs/api/classes/llvm/constantpointernull/#a96f5c85e4022e369266541b2db3fda69">ConstantPointerNull::get</a>(</Highlight></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/pointertype">PointerType</a> &#42;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(AggFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(AggArgIdx)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>())));</Highlight></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Replace call to &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; with call to &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><Highlight kind="normal">                    &lt;&lt; &#42;AggFunc &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; with new set of arguments\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create the new call instruction and erase the old one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><Highlight kind="normal">  <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> = <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(AggFunc-&gt;<a href="/docs/api/classes/llvm/function/#a21075305f0e463b24aafc2fb99514ace">getFunctionType</a>(), AggFunc, NewCallArgs, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><Highlight kind="normal">                          <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getIterator());</Highlight></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// It is possible that the call to the outlined function is either the first</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction is in the new block, the last instruction, or both.  If either</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of these is the case, we need to make sure that we replace the instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in the IRInstructionData struct with the new call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;OldCall = <a href="/docs/api/classes/llvm/region">Region</a>.Call;</Highlight></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/region">Region</a>.NewFront-&gt;Inst == OldCall)</Highlight></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/region">Region</a>.NewFront-&gt;Inst = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>;</Highlight></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/region">Region</a>.NewBack-&gt;Inst == OldCall)</Highlight></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/region">Region</a>.NewBack-&gt;Inst = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>;</Highlight></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Transfer any debug information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><Highlight kind="normal">  <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;setDebugLoc(<a href="/docs/api/classes/llvm/region">Region</a>.Call-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Since our output may determine which branch we go to, we make sure to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// propagate this new call value through the module.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><Highlight kind="normal">  OldCall-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>);</Highlight></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove the old instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><Highlight kind="normal">  OldCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/region">Region</a>.Call = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>;</Highlight></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Make sure that the argument in the new function has the SwiftError</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Group.<a href="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff">SwiftErrorArgument</a>)</Highlight></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;addParamAttr(&#42;Group.<a href="/docs/api/structs/outlinablegroup/#a0d093de2575838ee30b3fbce09a020ff">SwiftErrorArgument</a>, Attribute::SwiftError);</Highlight></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>;</Highlight></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><Highlight kind="comment">/// Find or create a BasicBlock in the outlined function containing PhiBlocks</Highlight></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><Highlight kind="comment">/// for \\p RetVal.</Highlight></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><Highlight kind="comment">/// \\param Group - The OutlinableGroup containing the information about the</Highlight></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><Highlight kind="comment">/// overall outlined function.</Highlight></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><Highlight kind="comment">/// \\param RetVal - The return value or exit option that we are currently</Highlight></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><Highlight kind="comment">/// evaluating.</Highlight></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><Highlight kind="comment">/// \\returns The found or newly created BasicBlock to contain the needed</Highlight></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><Highlight kind="comment">/// PHINodes to be used as outputs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540" lineLink="#af30ff2458bb283e423c1fc242a468579"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="#af30ff2458bb283e423c1fc242a468579">findOrCreatePHIBlock</a>(<a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group, <a href="/docs/api/classes/llvm/value">Value</a> &#42;RetVal) &#123;</Highlight></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;::iterator</a> PhiBlockForRetVal,</Highlight></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><Highlight kind="normal">      ReturnBlockForRetVal;</Highlight></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><Highlight kind="normal">  PhiBlockForRetVal = Group.<a href="/docs/api/structs/outlinablegroup/#aa4ad3c4db3597f25f2fba7a690a68bc6">PHIBlocks</a>.find(RetVal);</Highlight></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><Highlight kind="normal">  ReturnBlockForRetVal = Group.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>.find(RetVal);</Highlight></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ReturnBlockForRetVal != Group.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>.end() &amp;&amp;</Highlight></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Could not find output value!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ReturnBB = ReturnBlockForRetVal-&gt;second;</Highlight></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find if a PHIBlock exists for this return value already.  If it is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the first time we are analyzing this, we will not, so we record it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><Highlight kind="normal">  PhiBlockForRetVal = Group.<a href="/docs/api/structs/outlinablegroup/#aa4ad3c4db3597f25f2fba7a690a68bc6">PHIBlocks</a>.find(RetVal);</Highlight></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PhiBlockForRetVal != Group.<a href="/docs/api/structs/outlinablegroup/#aa4ad3c4db3597f25f2fba7a690a68bc6">PHIBlocks</a>.end())</Highlight></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> PhiBlockForRetVal-&gt;second;</Highlight></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><Highlight kind="normal">  </Highlight></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we did not find a block, we create one, and insert it into the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// overall function and record it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Inserted = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PHIBlock = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(ReturnBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), </Highlight><Highlight kind="stringliteral">&quot;phi&#95;block&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><Highlight kind="normal">                                            ReturnBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>());</Highlight></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><Highlight kind="normal">  std::tie(PhiBlockForRetVal, Inserted) =</Highlight></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><Highlight kind="normal">      Group.<a href="/docs/api/structs/outlinablegroup/#aa4ad3c4db3597f25f2fba7a690a68bc6">PHIBlocks</a>.insert(std::make&#95;pair(RetVal, PHIBlock));</Highlight></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We find the predecessors of the return block in the newly created outlined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// function in order to point them to the new PHIBlock rather than the already</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// existing return block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BranchInst &#42;, 2&gt;</a> BranchesToChange;</Highlight></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(ReturnBB))</Highlight></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><Highlight kind="normal">    BranchesToChange.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(Pred-&gt;getTerminator()));</Highlight></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now we mark the branch instructions found, and change the references of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// return block to the newly created PHIBlock.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI : BranchesToChange)</Highlight></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Succ = 0, End = BI-&gt;getNumSuccessors(); Succ &lt; End; Succ++) &#123;</Highlight></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BI-&gt;getSuccessor(Succ) != ReturnBB)</Highlight></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><Highlight kind="normal">      BI-&gt;setSuccessor(Succ, PHIBlock);</Highlight></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(ReturnBB, PHIBlock);</Highlight></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> PhiBlockForRetVal-&gt;second;</Highlight></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><Highlight kind="comment">/// For the function call now representing the \\p Region, find the passed value</Highlight></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><Highlight kind="comment">/// to that call that represents Argument \\p A at the call location if the</Highlight></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><Highlight kind="comment">/// call has already been replaced with a call to the  overall, aggregate</Highlight></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><Highlight kind="comment">/// function.</Highlight></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><Highlight kind="comment">/// \\param A - The Argument to get the passed value for.</Highlight></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><Highlight kind="comment">/// \\param Region - The extracted Region corresponding to the outlined function.</Highlight></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><Highlight kind="comment">/// \\returns The Value representing \\p A at the call site.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;</Highlight></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593" lineLink="#ad69884d9bf751011f8f9049542bbbd01"><Highlight kind="normal"><a href="#ad69884d9bf751011f8f9049542bbbd01">getPassedArgumentInAlreadyOutlinedFunction</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>,</Highlight></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><Highlight kind="normal">                                           </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>) &#123;</Highlight></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we don&#39;t need to adjust the argument number at all (since the call</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// has already been replaced by a call to the overall outlined function)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we can just get the specified argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/region">Region</a>.Call-&gt;getArgOperand(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getArgNo());</Highlight></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><Highlight kind="comment">/// For the function call now representing the \\p Region, find the passed value</Highlight></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><Highlight kind="comment">/// to that call that represents Argument \\p A at the call location if the</Highlight></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><Highlight kind="comment">/// call has only been replaced by the call to the aggregate function.</Highlight></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><Highlight kind="comment">/// \\param A - The Argument to get the passed value for.</Highlight></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><Highlight kind="comment">/// \\param Region - The extracted Region corresponding to the outlined function.</Highlight></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><Highlight kind="comment">/// \\returns The Value representing \\p A at the call site.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;</Highlight></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609" lineLink="#a202f8ebe30581a7e75bcedc9dee531af"><Highlight kind="normal"><a href="#a202f8ebe30581a7e75bcedc9dee531af">getPassedArgumentAndAdjustArgumentLocation</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>,</Highlight></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><Highlight kind="normal">                                           </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>) &#123;</Highlight></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ArgNum = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getArgNo();</Highlight></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><Highlight kind="normal">  </Highlight></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If it is a constant, we can look at our mapping from when we created</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the outputs to figure out what the constant value is.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/region">Region</a>.AggArgToConstant.count(ArgNum))</Highlight></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToConstant.find(ArgNum)-&gt;second;</Highlight></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><Highlight kind="normal">  </Highlight></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If it is not a constant, and we are not looking at the overall function, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// need to adjust which argument we are looking at.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><Highlight kind="normal">  ArgNum = <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToExtracted.find(ArgNum)-&gt;second;</Highlight></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/region">Region</a>.Call-&gt;getArgOperand(ArgNum);</Highlight></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><Highlight kind="comment">/// Find the canonical numbering for the incoming Values into the PHINode \\p PN.</Highlight></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><Highlight kind="comment">/// \\param PN &#91;in&#93; - The PHINode that we are finding the canonical numbers for.</Highlight></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><Highlight kind="comment">/// \\param Region &#91;in&#93; - The OutlinableRegion containing \\p PN.</Highlight></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><Highlight kind="comment">/// \\param OutputMappings &#91;in&#93; - The mapping of output values from outlined</Highlight></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><Highlight kind="comment">/// region to their original values.</Highlight></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><Highlight kind="comment">/// \\param CanonNums &#91;out&#93; - The canonical numbering for the incoming values to</Highlight></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><Highlight kind="comment">/// \\p PN paired with their incoming block.</Highlight></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><Highlight kind="comment">/// \\param ReplacedWithOutlinedCall - A flag to use the extracted function call</Highlight></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><Highlight kind="comment">/// of \\p Region rather than the overall function&#39;s call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634" lineLink="#a26b0639ceb3f28de2e6a283098c525b2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a26b0639ceb3f28de2e6a283098c525b2">findCanonNumsForPHI</a>(</Highlight></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</Highlight></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings,</Highlight></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt;std::pair&lt;unsigned, BasicBlock &#42;&gt;&gt; &amp;CanonNums,</Highlight></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ReplacedWithOutlinedCall = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iterate over the incoming values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 0, EIdx = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); Idx &lt; EIdx; Idx++) &#123;</Highlight></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;IVal = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(Idx);</Highlight></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IBlock = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(Idx);</Highlight></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we have an argument as incoming value, we need to grab the passed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// value from the call itself.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/argument">Argument</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Argument&gt;</a>(IVal)) &#123;</Highlight></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ReplacedWithOutlinedCall)</Highlight></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><Highlight kind="normal">        IVal = <a href="#ad69884d9bf751011f8f9049542bbbd01">getPassedArgumentInAlreadyOutlinedFunction</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/region">Region</a>);</Highlight></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><Highlight kind="normal">        IVal = <a href="#a202f8ebe30581a7e75bcedc9dee531af">getPassedArgumentAndAdjustArgumentLocation</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/region">Region</a>);</Highlight></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Get the original value if it has been replaced by an output value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><Highlight kind="normal">    IVal = <a href="#ab0d72084e637eaecbbadd192d547ef8e">findOutputMapping</a>(OutputMappings, IVal);</Highlight></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Find and add the canonical number for the incoming value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><Highlight kind="normal">    std::optional&lt;unsigned&gt; GVN = <a href="/docs/api/classes/llvm/region">Region</a>.Candidate-&gt;getGVN(IVal);</Highlight></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GVN &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;No GVN for incoming value&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><Highlight kind="normal">    std::optional&lt;unsigned&gt; CanonNum = <a href="/docs/api/classes/llvm/region">Region</a>.Candidate-&gt;getCanonicalNum(&#42;GVN);</Highlight></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CanonNum &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;No Canonical Number for GVN&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><Highlight kind="normal">    CanonNums.push&#95;back(std::make&#95;pair(&#42;CanonNum, IBlock));</Highlight></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><Highlight kind="comment">/// Find, or add PHINode \\p PN to the combined PHINode Block \\p OverallPHIBlock</Highlight></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><Highlight kind="comment">/// in order to condense the number of instructions added to the outlined</Highlight></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><Highlight kind="comment">/// function.</Highlight></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><Highlight kind="comment">/// \\param PN &#91;in&#93; - The PHINode that we are finding the canonical numbers for.</Highlight></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><Highlight kind="comment">/// \\param Region &#91;in&#93; - The OutlinableRegion containing \\p PN.</Highlight></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><Highlight kind="comment">/// \\param OverallPhiBlock &#91;in&#93; - The overall PHIBlock we are trying to find</Highlight></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><Highlight kind="comment">/// \\p PN in.</Highlight></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><Highlight kind="comment">/// \\param OutputMappings &#91;in&#93; - The mapping of output values from outlined</Highlight></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><Highlight kind="comment">/// region to their original values.</Highlight></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><Highlight kind="comment">/// \\param UsedPHIs &#91;in, out&#93; - The PHINodes in the block that have already been</Highlight></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><Highlight kind="comment">/// matched.</Highlight></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><Highlight kind="comment">/// \\return the newly found or created PHINode in \\p OverallPhiBlock.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/phinode">PHINode</a>&#42;</Highlight></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678" lineLink="#a556a77d9b9acf322358b2c4131986b13"><Highlight kind="normal"><a href="#a556a77d9b9acf322358b2c4131986b13">findOrCreatePHIInBlock</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</Highlight></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><Highlight kind="normal">                       <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OverallPhiBlock,</Highlight></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><Highlight kind="normal">                       </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings,</Highlight></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><Highlight kind="normal">                       <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;PHINode &#42;&gt;</a> &amp;UsedPHIs) &#123;</Highlight></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><Highlight kind="normal">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</Highlight></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><Highlight kind="normal">  </Highlight></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><Highlight kind="normal">  </Highlight></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A list of the canonical numbering assigned to each incoming value, paired</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// with the incoming block for the PHINode passed into this function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;unsigned, BasicBlock &#42;&gt;</a>&gt; PNCanonNums;</Highlight></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We have to use the extracted function since we have merged this region into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the overall function yet.  We make sure to reassign the argument numbering</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// since it is possible that the argument ordering is different between the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// functions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><Highlight kind="normal">  <a href="#a26b0639ceb3f28de2e6a283098c525b2">findCanonNumsForPHI</a>(&amp;PN, <a href="/docs/api/classes/llvm/region">Region</a>, OutputMappings, PNCanonNums,</Highlight></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><Highlight kind="normal">                      </Highlight><Highlight kind="comment">/&#42; ReplacedWithOutlinedCall = &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &#42;FirstRegion = Group.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;;</Highlight></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A list of the canonical numbering assigned to each incoming value, paired</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// with the incoming block for the PHINode that we are currently comparing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the passed PHINode to.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;unsigned, BasicBlock &#42;&gt;</a>&gt; CurrentCanonNums;</Highlight></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find the Canonical Numbering for each PHINode, if it matches, we replace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the uses of the PHINode we are searching for, with the found PHINode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;CurrPN : OverallPhiBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this PHINode has already been matched to another PHINode to be merged,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we skip it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UsedPHIs.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(&amp;CurrPN))</Highlight></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><Highlight kind="normal">    CurrentCanonNums.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</Highlight></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><Highlight kind="normal">    <a href="#a26b0639ceb3f28de2e6a283098c525b2">findCanonNumsForPHI</a>(&amp;CurrPN, &#42;FirstRegion, OutputMappings, CurrentCanonNums,</Highlight></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><Highlight kind="normal">                        </Highlight><Highlight kind="comment">/&#42; ReplacedWithOutlinedCall = &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the list of incoming values is not the same length, then they cannot</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// match since there is not an analogue for each incoming value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PNCanonNums.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() != CurrentCanonNums.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>())</Highlight></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> FoundMatch = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We compare the canonical value for each incoming value in the passed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// in PHINode to one already present in the outlined region.  If the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// incoming values do not match, then the PHINodes do not match.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We also check to make sure that the incoming block matches as well by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// finding the corresponding incoming block in the combined outlined region</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// for the current outlined region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 0, Edx = PNCanonNums.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); Idx &lt; Edx; ++Idx) &#123;</Highlight></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><Highlight kind="normal">      std::pair&lt;unsigned, BasicBlock &#42;&gt; ToCompareTo = CurrentCanonNums&#91;Idx&#93;;</Highlight></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><Highlight kind="normal">      std::pair&lt;unsigned, BasicBlock &#42;&gt; ToAdd = PNCanonNums&#91;Idx&#93;;</Highlight></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ToCompareTo.first != ToAdd.first) &#123;</Highlight></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><Highlight kind="normal">        FoundMatch = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CorrespondingBlock =</Highlight></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/region">Region</a>.findCorrespondingBlockIn(&#42;FirstRegion, ToAdd.second);</Highlight></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CorrespondingBlock &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Found block is nullptr&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CorrespondingBlock != ToCompareTo.second) &#123;</Highlight></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><Highlight kind="normal">        FoundMatch = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If all incoming values and branches matched, then we can merge</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// into the found PHINode.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FoundMatch) &#123;</Highlight></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><Highlight kind="normal">      UsedPHIs.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(&amp;CurrPN);</Highlight></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;CurrPN;</Highlight></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we&#39;ve made it here, it means we weren&#39;t able to replace the PHINode, so</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we must insert it ourselves.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(PN.<a href="/docs/api/classes/llvm/instruction/#a0a4d51e372293abe5e5f6dac133e80a6">clone</a>());</Highlight></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><Highlight kind="normal">  NewPN-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(OverallPhiBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</Highlight></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 0, Edx = NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); Idx &lt; Edx;</Highlight></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><Highlight kind="normal">       Idx++) &#123;</Highlight></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;IncomingVal = NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(Idx);</Highlight></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IncomingBlock = NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(Idx);</Highlight></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Find corresponding basic block in the overall function for the incoming</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BlockToUse =</Highlight></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/region">Region</a>.findCorrespondingBlockIn(&#42;FirstRegion, IncomingBlock);</Highlight></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><Highlight kind="normal">    NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a5ba57877c55dfdbe6e3bbfdacd9ef8c1">setIncomingBlock</a>(Idx, BlockToUse);</Highlight></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we have an argument we make sure we replace using the argument from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the correct function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/argument">Argument</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Argument&gt;</a>(IncomingVal)) &#123;</Highlight></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getArgNo());</Highlight></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><Highlight kind="normal">      NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(Idx, Val);</Highlight></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><Highlight kind="normal">    </Highlight></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Find the corresponding value in the overall function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><Highlight kind="normal">    IncomingVal = <a href="#ab0d72084e637eaecbbadd192d547ef8e">findOutputMapping</a>(OutputMappings, IncomingVal);</Highlight></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val = <a href="/docs/api/classes/llvm/region">Region</a>.findCorrespondingValueIn(&#42;FirstRegion, IncomingVal);</Highlight></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Val &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Value is nullptr?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;::iterator</a> RemappedIt =</Highlight></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><Highlight kind="normal">        FirstRegion-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#aa6e8e852e322a0a5383c6f0fce17daa2">RemappedArguments</a>.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(Val);</Highlight></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RemappedIt != FirstRegion-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#aa6e8e852e322a0a5383c6f0fce17daa2">RemappedArguments</a>.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</Highlight></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><Highlight kind="normal">      Val = RemappedIt-&gt;second;</Highlight></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><Highlight kind="normal">    NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a88cdefb709309eddc6e5daca0be6a7b4">setIncomingValue</a>(Idx, Val);</Highlight></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewPN;</Highlight></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Within an extracted function, replace the argument uses of the extracted</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><Highlight kind="normal"></Highlight><Highlight kind="comment">// region with the arguments of the function for an OutlinableGroup.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><Highlight kind="comment">/// \\param &#91;in&#93; Region - The region of extracted code to be changed.</Highlight></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><Highlight kind="comment">/// \\param &#91;in,out&#93; OutputBBs - The BasicBlock for the output stores for this</Highlight></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><Highlight kind="comment">/// region.</Highlight></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><Highlight kind="comment">/// \\param &#91;in&#93; FirstFunction - A flag to indicate whether we are using this</Highlight></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><Highlight kind="comment">/// function to define the overall outlined function for all the regions, or</Highlight></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><Highlight kind="comment">/// if we are operating on one of the following regions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800" lineLink="#a96b5bd50d8e96b4c76ffc26508ce774d"><Highlight kind="normal"><a href="#a96b5bd50d8e96b4c76ffc26508ce774d">replaceArgumentUses</a>(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</Highlight></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><Highlight kind="normal">                    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;OutputBBs,</Highlight></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><Highlight kind="normal">                    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings,</Highlight></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><Highlight kind="normal">                    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> FirstFunction = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><Highlight kind="normal">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</Highlight></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Region has no extracted function?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;DominatingFunction = <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction;</Highlight></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FirstFunction)</Highlight></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><Highlight kind="normal">    DominatingFunction = Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>;</Highlight></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> DT(&#42;DominatingFunction);</Highlight></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;PHINode &#42;&gt;</a> UsedPHIs;</Highlight></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ArgIdx = 0; ArgIdx &lt; <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction-&gt;arg&#95;size();</Highlight></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><Highlight kind="normal">       ArgIdx++) &#123;</Highlight></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/region">Region</a>.ExtractedArgToAgg.<a href="/docs/api/classes/llvm/regionbase/#a75479f44e7157d1a8592231addb67c9c">contains</a>(ArgIdx) &amp;&amp;</Highlight></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;No mapping from extracted to outlined?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AggArgIdx = <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedArgToAgg.find(ArgIdx)-&gt;second;</Highlight></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;AggArg = Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(AggArgIdx);</Highlight></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;Arg = <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction-&gt;getArg(ArgIdx);</Highlight></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The argument is an input, so we can simply replace it with the overall</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// argument value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ArgIdx &lt; <a href="/docs/api/classes/llvm/region">Region</a>.NumExtractedInputs) &#123;</Highlight></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Replacing uses of input &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Arg &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; in function &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><Highlight kind="normal">                        &lt;&lt; &#42;<a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; with &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;AggArg</Highlight></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; in function &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><Highlight kind="normal">      Arg-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(AggArg);</Highlight></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="/docs/api/classes/llvm/region">Region</a>.Call-&gt;getArgOperand(ArgIdx);</Highlight></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/region">Region</a>.RemappedArguments.insert(std::make&#95;pair(V, AggArg));</Highlight></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we are replacing an output, we place the store value in its own</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// block inside the overall function before replacing the use of the output</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// in the function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Arg-&gt;<a href="/docs/api/classes/llvm/value/#a3a402430a1bbe70a9282dcb0e0b6a2cd">hasOneUse</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Output argument can only have one use&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/user">User</a> &#42;InstAsUser = Arg-&gt;<a href="/docs/api/classes/llvm/value/#a46db903db2484e1ef5062d094d6b0854">user&#95;back</a>();</Highlight></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InstAsUser &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;User is nullptr!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(InstAsUser);</Highlight></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 4&gt;</a> Descendants;</Highlight></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><Highlight kind="normal">    DT.<a href="/docs/api/classes/llvm/dominatortreebase/#a406e4a6b7277aab7efd423ae30a9fb12">getDescendants</a>(BB, Descendants);</Highlight></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> EdgeAdded = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Descendants.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 0) &#123;</Highlight></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><Highlight kind="normal">      EdgeAdded = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><Highlight kind="normal">      DT.<a href="/docs/api/classes/llvm/dominatortreebase/#a51145a3ae24ea73b3692a17088edea7b">insertEdge</a>(&amp;DominatingFunction-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>(), BB);</Highlight></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><Highlight kind="normal">      DT.<a href="/docs/api/classes/llvm/dominatortreebase/#a406e4a6b7277aab7efd423ae30a9fb12">getDescendants</a>(BB, Descendants);</Highlight></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Iterate over the following blocks, looking for return instructions,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// if we find one, find the corresponding output block for the return value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// and move our store instruction there.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DescendBB : Descendants) &#123;</Highlight></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/returninst">ReturnInst</a> &#42;RI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ReturnInst&gt;</a>(DescendBB-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RI)</Highlight></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;RetVal = RI-&gt;<a href="/docs/api/classes/llvm/returninst/#a6c2dee0852138a5cb8a4fef5883db9ec">getReturnValue</a>();</Highlight></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> VBBIt = OutputBBs.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(RetVal);</Highlight></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VBBIt != OutputBBs.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Could not find output value!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If this is storing a PHINode, we must make sure it is included in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// overall function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;ValueOperand = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand();</Highlight></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;NewI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;clone());</Highlight></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><Highlight kind="normal">      NewI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</Highlight></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OutputBB = VBBIt-&gt;second;</Highlight></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><Highlight kind="normal">      NewI-&gt;<a href="/docs/api/classes/llvm/instruction/#afcd9d2ea284c4d90541291ff9c47d332">insertInto</a>(OutputBB, OutputBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</Highlight></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Move store for instruction &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><Highlight kind="normal">                        &lt;&lt; &#42;OutputBB &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If this is storing a PHINode, we must make sure it is included in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// overall function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(ValueOperand) ||</Highlight></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/region">Region</a>.Candidate-&gt;getGVN(ValueOperand).has&#95;value()) &#123;</Highlight></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FirstFunction)</Highlight></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;CorrVal =</Highlight></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/region">Region</a>.findCorrespondingValueIn(&#42;Group.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;, ValueOperand);</Highlight></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CorrVal &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Value is nullptr?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><Highlight kind="normal">        NewI-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, CorrVal);</Highlight></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand());</Highlight></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If it has a value, it was not split by the code extractor, which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// is what we are looking for.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/region">Region</a>.Candidate-&gt;getGVN(PN))</Highlight></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We record the parent block for the PHINode in the Region so that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// we can exclude it from checks later on.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/region">Region</a>.PHIBlocks.insert(std::make&#95;pair(RetVal, PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()));</Highlight></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If this is the first function, we do not need to worry about mergiing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// this with any other block in the overall outlined function, so we can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// just continue.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FirstFunction) &#123;</Highlight></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PHIBlock = PN-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><Highlight kind="normal">        Group.<a href="/docs/api/structs/outlinablegroup/#aa4ad3c4db3597f25f2fba7a690a68bc6">PHIBlocks</a>.insert(std::make&#95;pair(RetVal, PHIBlock));</Highlight></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We look for the aggregate block that contains the PHINodes leading into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// this exit path. If we can&#39;t find one, we create one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OverallPhiBlock = <a href="#af30ff2458bb283e423c1fc242a468579">findOrCreatePHIBlock</a>(Group, RetVal);</Highlight></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// For our PHINode, we find the combined canonical numbering, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// attempt to find a matching PHINode in the overall PHIBlock.  If we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// cannot, we copy the PHINode and move it into this new block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPN = <a href="#a556a77d9b9acf322358b2c4131986b13">findOrCreatePHIInBlock</a>(&#42;PN, <a href="/docs/api/classes/llvm/region">Region</a>, OverallPhiBlock,</Highlight></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><Highlight kind="normal">                                              OutputMappings, UsedPHIs);</Highlight></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><Highlight kind="normal">      NewI-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(0, NewPN);</Highlight></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we added an edge for basic blocks without a predecessor, we remove it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EdgeAdded)</Highlight></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><Highlight kind="normal">      DT.<a href="/docs/api/classes/llvm/dominatortreebase/#ab0f09aefdf088f84a0bff7cba86454b4">deleteEdge</a>(&amp;DominatingFunction-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>(), BB);</Highlight></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Replacing uses of output &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Arg &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; in function &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><Highlight kind="normal">                      &lt;&lt; &#42;<a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; with &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;AggArg</Highlight></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; in function &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><Highlight kind="normal">    Arg-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(AggArg);</Highlight></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><Highlight kind="comment">/// Within an extracted function, replace the constants that need to be lifted</Highlight></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><Highlight kind="comment">/// into arguments with the actual argument.</Highlight></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><Highlight kind="comment">/// \\param Region &#91;in&#93; - The region of extracted code to be changed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934" lineLink="#ace02ac07a3f704ffd345301bff92e5a8"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#ace02ac07a3f704ffd345301bff92e5a8">replaceConstants</a>(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>) &#123;</Highlight></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><Highlight kind="normal">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;Group = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</Highlight></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iterate over the constants that need to be elevated into arguments</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (std::pair&lt;unsigned, Constant &#42;&gt; &amp;Const : <a href="/docs/api/classes/llvm/region">Region</a>.AggArgToConstant) &#123;</Highlight></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AggArgIdx = Const.first;</Highlight></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;OutlinedFunction = Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>;</Highlight></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutlinedFunction &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Overall Function is not defined?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/constant">Constant</a> &#42;CST = Const.second;</Highlight></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;Arg = Group.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(AggArgIdx);</Highlight></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Identify the argument it will be elevated to, and replace instances of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// that constant in the function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: If in the future constants do not have one global value number,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// i.e. a constant 1 could be mapped to several values, this check will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// have to be more strict.  It cannot be using only replaceUsesWithIf.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Replacing uses of constant &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;CST</Highlight></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; in function &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;OutlinedFunction &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; with &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><Highlight kind="normal">                      &lt;&lt; &#42;Arg &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><Highlight kind="normal">    CST-&gt;<a href="/docs/api/classes/llvm/value/#a7e8dad1701aa6445be4a29f654b0473c">replaceUsesWithIf</a>(Arg, &#91;OutlinedFunction&#93;(<a href="/docs/api/classes/llvm/use">Use</a> &amp;U) &#123;</Highlight></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U.getUser()))</Highlight></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFunction() == OutlinedFunction;</Highlight></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><Highlight kind="comment">/// It is possible that there is a basic block that already performs the same</Highlight></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><Highlight kind="comment">/// stores. This returns a duplicate block, if it exists</Highlight></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><Highlight kind="comment">/// \\param OutputBBs &#91;in&#93; the blocks we are looking for a duplicate of.</Highlight></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><Highlight kind="comment">/// \\param OutputStoreBBs &#91;in&#93; The existing output blocks.</Highlight></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><Highlight kind="comment">/// \\returns an optional value with the number output block if there is a match.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967" lineLink="#af714eb55aced0ac27294c881d8be6ecb"><Highlight kind="normal">std::optional&lt;unsigned&gt; <a href="#af714eb55aced0ac27294c881d8be6ecb">findDuplicateOutputBlock</a>(</Highlight></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;OutputBBs,</Highlight></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><Highlight kind="normal">    std::vector&lt;<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a>&gt; &amp;OutputStoreBBs) &#123;</Highlight></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Mismatch = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MatchingNum = 0;</Highlight></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We compare the new set output blocks to the other sets of output blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If they are the same number, and have identical instructions, they are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// considered to be the same.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;CompBBs : OutputStoreBBs) &#123;</Highlight></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><Highlight kind="normal">    Mismatch = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;VToB : CompBBs) &#123;</Highlight></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;::iterator</a> OutputBBIt =</Highlight></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><Highlight kind="normal">          OutputBBs.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(VToB.first);</Highlight></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OutputBBIt == OutputBBs.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</Highlight></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><Highlight kind="normal">        Mismatch = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CompBB = VToB.second;</Highlight></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OutputBB = OutputBBIt-&gt;second;</Highlight></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CompBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>() - 1 != OutputBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>()) &#123;</Highlight></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><Highlight kind="normal">        Mismatch = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> NIt = OutputBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</Highlight></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;CompBB) &#123;</Highlight></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.isIdenticalTo(&amp;(&#42;NIt))) &#123;</Highlight></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><Highlight kind="normal">          Mismatch = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><Highlight kind="normal">        NIt++;</Highlight></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Mismatch)</Highlight></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MatchingNum;</Highlight></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><Highlight kind="normal">    MatchingNum++;</Highlight></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><Highlight kind="comment">/// Remove empty output blocks from the outlined region.</Highlight></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><Highlight kind="comment">/// \\param BlocksToPrune - Mapping of return values output blocks for the \\p</Highlight></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><Highlight kind="comment">/// Region.</Highlight></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><Highlight kind="comment">/// \\param Region - The OutlinableRegion we are analyzing.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022" lineLink="#a57d54880afa1fb74833cc7c43ad33377"><Highlight kind="normal"><a href="#a57d54880afa1fb74833cc7c43ad33377">analyzeAndPruneOutputBlocks</a>(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;BlocksToPrune,</Highlight></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><Highlight kind="normal">                            <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>) &#123;</Highlight></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllRemoved = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RetValueForBB;</Highlight></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB;</Highlight></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armlowoverheadloops-cpp/#a3bf42baf773b375802538951c88d8e12">ToRemove</a>;</Highlight></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iterate over the output blocks created in the outlined section.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;VtoBB : BlocksToPrune) &#123;</Highlight></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><Highlight kind="normal">    RetValueForBB = VtoBB.first;</Highlight></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><Highlight kind="normal">    NewBB = VtoBB.second;</Highlight></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><Highlight kind="normal">  </Highlight></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If there are no instructions, we remove it from the module, and also</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// mark the value for removal from the return value to output block mapping.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>() == 0) &#123;</Highlight></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><Highlight kind="normal">      NewBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armlowoverheadloops-cpp/#a3bf42baf773b375802538951c88d8e12">ToRemove</a>.push&#95;back(RetValueForBB);</Highlight></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><Highlight kind="normal">    </Highlight></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Mark that we could not remove all the blocks since they were not all</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// empty.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><Highlight kind="normal">    AllRemoved = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove the return value from the mapping.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armlowoverheadloops-cpp/#a3bf42baf773b375802538951c88d8e12">ToRemove</a>)</Highlight></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><Highlight kind="normal">    BlocksToPrune.<a href="/docs/api/classes/llvm/densemapbase/#a1eb8504bab5f794778d82db6ac829923">erase</a>(V);</Highlight></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Mark the region as having the no output scheme.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AllRemoved)</Highlight></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/region">Region</a>.OutputBlockNum = -1;</Highlight></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><Highlight kind="normal">  </Highlight></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AllRemoved;</Highlight></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><Highlight kind="comment">/// For the outlined section, move needed the StoreInsts for the output</Highlight></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><Highlight kind="comment">/// registers into their own block. Then, determine if there is a duplicate</Highlight></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><Highlight kind="comment">/// output block already created.</Highlight></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><Highlight kind="comment">/// \\param &#91;in&#93; OG - The OutlinableGroup of regions to be outlined.</Highlight></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><Highlight kind="comment">/// \\param &#91;in&#93; Region - The OutlinableRegion that is being analyzed.</Highlight></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><Highlight kind="comment">/// \\param &#91;in,out&#93; OutputBBs - the blocks that stores for this region will be</Highlight></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><Highlight kind="comment">/// placed in.</Highlight></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><Highlight kind="comment">/// \\param &#91;in&#93; EndBBs - the final blocks of the extracted function.</Highlight></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><Highlight kind="comment">/// \\param &#91;in&#93; OutputMappings - OutputMappings the mapping of values that have</Highlight></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><Highlight kind="comment">/// been replaced by a new output value.</Highlight></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><Highlight kind="comment">/// \\param &#91;in,out&#93; OutputStoreBBs - The existing output blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069" lineLink="#a4fcb90c9c38b3381765a891d0a61c1ea"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a4fcb90c9c38b3381765a891d0a61c1ea">alignOutputBlockWithAggFunc</a>(</Highlight></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><Highlight kind="normal">    <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;OG, <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</Highlight></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;OutputBBs,</Highlight></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;EndBBs,</Highlight></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings,</Highlight></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><Highlight kind="normal">    std::vector&lt;<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a>&gt; &amp;OutputStoreBBs) &#123;</Highlight></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If none of the output blocks have any instructions, this means that we do</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// not have to determine if it matches any of the other output schemes, and we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// don&#39;t have to do anything else.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a57d54880afa1fb74833cc7c43ad33377">analyzeAndPruneOutputBlocks</a>(OutputBBs, <a href="/docs/api/classes/llvm/region">Region</a>))</Highlight></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Determine is there is a duplicate set of blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><Highlight kind="normal">  std::optional&lt;unsigned&gt; MatchingBB =</Highlight></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><Highlight kind="normal">      <a href="#af714eb55aced0ac27294c881d8be6ecb">findDuplicateOutputBlock</a>(OutputBBs, OutputStoreBBs);</Highlight></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there is, we remove the new output blocks.  If it does not,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we add it to our list of sets of output blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MatchingBB) &#123;</Highlight></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Set output block for region in function&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><Highlight kind="normal">                      &lt;&lt; <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;MatchingBB);</Highlight></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/region">Region</a>.OutputBlockNum = &#42;MatchingBB;</Highlight></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;VtoBB : OutputBBs)</Highlight></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><Highlight kind="normal">      VtoBB.second-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/region">Region</a>.OutputBlockNum = OutputStoreBBs.size();</Highlight></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;RetValueForBB;</Highlight></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB;</Highlight></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><Highlight kind="normal">  OutputStoreBBs.push&#95;back(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a>());</Highlight></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;VtoBB : OutputBBs) &#123;</Highlight></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><Highlight kind="normal">    RetValueForBB = VtoBB.first;</Highlight></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><Highlight kind="normal">    NewBB = VtoBB.second;</Highlight></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;::iterator</a> VBBIt =</Highlight></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><Highlight kind="normal">        EndBBs.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(RetValueForBB);</Highlight></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Create output block for region in&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><Highlight kind="normal">                      &lt;&lt; <a href="/docs/api/classes/llvm/region">Region</a>.ExtractedFunction &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><Highlight kind="normal">                      &lt;&lt; &#42;NewBB);</Highlight></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(VBBIt-&gt;second, NewBB);</Highlight></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><Highlight kind="normal">    OutputStoreBBs.back().insert(std::make&#95;pair(RetValueForBB, NewBB));</Highlight></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><Highlight kind="comment">/// Takes in a mapping, \\p OldMap of ConstantValues to BasicBlocks, sorts keys,</Highlight></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><Highlight kind="comment">/// before creating a basic block for each \\p NewMap, and inserting into the new</Highlight></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><Highlight kind="comment">/// block. Each BasicBlock is named with the scheme &quot;&lt;basename&gt;&#95;&lt;key&#95;idx&gt;&quot;.</Highlight></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><Highlight kind="comment">/// \\param OldMap &#91;in&#93; - The mapping to base the new mapping off of.</Highlight></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><Highlight kind="comment">/// \\param NewMap &#91;out&#93; - The output mapping using the keys of \\p OldMap.</Highlight></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><Highlight kind="comment">/// \\param ParentFunc &#91;in&#93; - The function to put the new basic block in.</Highlight></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><Highlight kind="comment">/// \\param BaseName &#91;in&#93; - The start of the BasicBlock names to be appended to</Highlight></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><Highlight kind="comment">/// by an index value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124" lineLink="#a8120984c169f2ea17e785e7c6887702a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a8120984c169f2ea17e785e7c6887702a">createAndInsertBasicBlocks</a>(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;OldMap,</Highlight></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><Highlight kind="normal">                                       <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;NewMap,</Highlight></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><Highlight kind="normal">                                       <a href="/docs/api/classes/llvm/function">Function</a> &#42;ParentFunc, <a href="/docs/api/classes/llvm/twine">Twine</a> BaseName) &#123;</Highlight></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 0;</Highlight></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><Highlight kind="normal">  std::vector&lt;Value &#42;&gt; SortedKeys;</Highlight></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><Highlight kind="normal">  </Highlight></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><Highlight kind="normal">  <a href="#a8ad786f21829d9e92d31cc0b80c53dbb">getSortedConstantKeys</a>(SortedKeys, OldMap);</Highlight></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;RetVal : SortedKeys) &#123;</Highlight></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</Highlight></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><Highlight kind="normal">        ParentFunc-&gt;<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>(),</Highlight></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/twine">Twine</a>(BaseName) + <a href="/docs/api/classes/llvm/twine">Twine</a>(</Highlight><Highlight kind="stringliteral">&quot;&#95;&quot;</Highlight><Highlight kind="normal">) + <a href="/docs/api/classes/llvm/twine">Twine</a>(</Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(Idx++)),</Highlight></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><Highlight kind="normal">        ParentFunc);</Highlight></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><Highlight kind="normal">    NewMap.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(std::make&#95;pair(RetVal, NewBB));</Highlight></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><Highlight kind="comment">/// Create the switch statement for outlined function to differentiate between</Highlight></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><Highlight kind="comment">/// all the output blocks.</Highlight></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><Highlight kind="comment">/// For the outlined section, determine if an outlined block already exists that</Highlight></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><Highlight kind="comment">/// matches the needed stores for the extracted section.</Highlight></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><Highlight kind="comment">/// \\param &#91;in&#93; M - The module we are outlining from.</Highlight></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><Highlight kind="comment">/// \\param &#91;in&#93; OG - The group of regions to be outlined.</Highlight></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><Highlight kind="comment">/// \\param &#91;in&#93; EndBBs - The final blocks of the extracted function.</Highlight></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><Highlight kind="comment">/// \\param &#91;in,out&#93; OutputStoreBBs - The existing output blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150" lineLink="#ae86fef7fc5831c2514bff95bdf784d09"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#ae86fef7fc5831c2514bff95bdf784d09">createSwitchStatement</a>(</Highlight></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;OG, <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;EndBBs,</Highlight></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><Highlight kind="normal">    std::vector&lt;<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a>&gt; &amp;OutputStoreBBs) &#123;</Highlight></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We only need the switch statement if there is more than one store</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// combination, or there is more than one set of output blocks.  The first</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// will occur when we store different sets of values for two different</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// regions.  The second will occur when we have two outputs that are combined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in a PHINode outside of the region in one outlined instance, and are used</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// seaparately in another. This will create the same set of OutputGVNs, but</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// will generate two different output schemes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OG.<a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>.size() &gt; 1) &#123;</Highlight></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;AggFunc = OG.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>;</Highlight></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Create a final block for each different return block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> ReturnBBs;</Highlight></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><Highlight kind="normal">    <a href="#a8120984c169f2ea17e785e7c6887702a">createAndInsertBasicBlocks</a>(OG.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>, ReturnBBs, AggFunc, </Highlight><Highlight kind="stringliteral">&quot;final&#95;block&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;RetBlockPair : ReturnBBs) &#123;</Highlight></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><Highlight kind="normal">      std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;OutputBlock =</Highlight></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><Highlight kind="normal">          &#42;OG.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>.find(RetBlockPair.first);</Highlight></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ReturnBlock = RetBlockPair.second;</Highlight></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EndBB = OutputBlock.second;</Highlight></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Term = EndBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</Highlight></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Move the return value to the final block instead of the original exit</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// stub.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><Highlight kind="normal">      Term-&gt;moveBefore(&#42;ReturnBlock, ReturnBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</Highlight></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Put the switch statement in the old end basic block for the function</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// with a fall through to the new return block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Create switch statement in &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;AggFunc &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; for &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><Highlight kind="normal">                        &lt;&lt; OutputStoreBBs.<a href="/docs/api/classes/llvm/function/#a969eb757b1e43b455d4a8d0f603e695b">size</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;SwitchI =</Highlight></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/switchinst/#a3c1416226bed5e92acb74aebe8e20f5a">SwitchInst::Create</a>(AggFunc-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(AggFunc-&gt;<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() - 1),</Highlight></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><Highlight kind="normal">                             ReturnBlock, OutputStoreBBs.<a href="/docs/api/classes/llvm/basicblock/#ab9f68be0e2bcdf14f503f45edea63023">size</a>(), EndBB);</Highlight></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 0;</Highlight></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> &amp;OutputStoreBB : OutputStoreBBs) &#123;</Highlight></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;::iterator</a> OSBBIt =</Highlight></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><Highlight kind="normal">            OutputStoreBB.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(OutputBlock.first);</Highlight></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OSBBIt == OutputStoreBB.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</Highlight></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = OSBBIt-&gt;second;</Highlight></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><Highlight kind="normal">        SwitchI-&gt;<a href="/docs/api/classes/llvm/switchinst/#a62abc2475d09c01d583ba24a487898fd">addCase</a>(</Highlight></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><Highlight kind="normal">            ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(M.getContext()), Idx), BB);</Highlight></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><Highlight kind="normal">        Term = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</Highlight></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><Highlight kind="normal">        Term-&gt;setSuccessor(0, ReturnBlock);</Highlight></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><Highlight kind="normal">        Idx++;</Highlight></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OutputStoreBBs.size() &lt; 2 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Different store sets not handled!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there needs to be stores, move them from the output blocks to their</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// corresponding ending block.  We do not check that the OutputGVNCombinations</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is equal to 1 here since that could just been the case where there are 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// outputs. Instead, we check whether there is more than one set of output</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// blocks since this is the only case where we would have to move the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// stores, and erase the extraneous blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OutputStoreBBs.size() == 1) &#123;</Highlight></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Move store instructions to the end block in &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><Highlight kind="normal">                      &lt;&lt; &#42;OG.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> OutputBlocks = OutputStoreBBs&#91;0&#93;;</Highlight></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;VBPair : OutputBlocks) &#123;</Highlight></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;::iterator</a> EndBBIt =</Highlight></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><Highlight kind="normal">          EndBBs.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(VBPair.first);</Highlight></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndBBIt != EndBBs.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Could not find end block&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EndBB = EndBBIt-&gt;second;</Highlight></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OutputBB = VBPair.second;</Highlight></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Term = OutputBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</Highlight></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><Highlight kind="normal">      Term-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><Highlight kind="normal">      Term = EndBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</Highlight></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><Highlight kind="normal">      <a href="#a3afc8c0c69b0c55edce3be13d5b7cc32">moveBBContents</a>(&#42;OutputBB, &#42;EndBB);</Highlight></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><Highlight kind="normal">      Term-&gt;moveBefore(&#42;EndBB, EndBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</Highlight></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><Highlight kind="normal">      OutputBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><Highlight kind="comment">/// Fill the new function that will serve as the replacement function for all of</Highlight></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><Highlight kind="comment">/// the extracted regions of a certain structure from the first region in the</Highlight></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><Highlight kind="comment">/// list of regions.  Replace this first region&#39;s extracted function with the</Highlight></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><Highlight kind="comment">/// new overall function.</Highlight></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><Highlight kind="comment">/// \\param &#91;in&#93; M - The module we are outlining from.</Highlight></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><Highlight kind="comment">/// \\param &#91;in&#93; CurrentGroup - The group of regions to be outlined.</Highlight></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><Highlight kind="comment">/// \\param &#91;in,out&#93; OutputStoreBBs - The output blocks for each different</Highlight></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><Highlight kind="comment">/// set of stores needed for the different functions.</Highlight></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><Highlight kind="comment">/// \\param &#91;in,out&#93; FuncsToRemove - Extracted functions to erase from module</Highlight></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><Highlight kind="comment">/// once outlining is complete.</Highlight></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><Highlight kind="comment">/// \\param &#91;in&#93; OutputMappings - Extracted functions to erase from module</Highlight></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><Highlight kind="comment">/// once outlining is complete.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243" lineLink="#a4e06ebf129ddfb3b33a64f1a456cfc24"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a4e06ebf129ddfb3b33a64f1a456cfc24">fillOverallFunction</a>(</Highlight></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;CurrentGroup,</Highlight></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><Highlight kind="normal">    std::vector&lt;<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a>&gt; &amp;OutputStoreBBs,</Highlight></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><Highlight kind="normal">    std::vector&lt;Function &#42;&gt; &amp;FuncsToRemove,</Highlight></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, Value &#42;&gt;</a> &amp;OutputMappings) &#123;</Highlight></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &#42;CurrentOS = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;;</Highlight></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Move first extracted function&#39;s instructions into new function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Move instructions from &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><Highlight kind="normal">                    &lt;&lt; &#42;CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#ad5dce467e0d3954ba812f2e9611810b4">ExtractedFunction</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to instruction &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><Highlight kind="normal">                    &lt;&lt; &#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><Highlight kind="normal">  <a href="#a4047976de351f78967fba27df7a6361f">moveFunctionData</a>(&#42;CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#ad5dce467e0d3954ba812f2e9611810b4">ExtractedFunction</a>,</Highlight></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><Highlight kind="normal">                   &#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>, CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>);</Highlight></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Transfer the attributes from the function to the new function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/attribute">Attribute</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> : CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#ad5dce467e0d3954ba812f2e9611810b4">ExtractedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#a7477aafbbe989ad35b96fac186d8e9fd">getAttributes</a>().getFnAttrs())</Highlight></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><Highlight kind="normal">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>-&gt;<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</Highlight></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create a new set of output blocks for the first extracted function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a> NewBBs;</Highlight></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><Highlight kind="normal">  <a href="#a8120984c169f2ea17e785e7c6887702a">createAndInsertBasicBlocks</a>(CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>, NewBBs,</Highlight></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><Highlight kind="normal">                             CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>, </Highlight><Highlight kind="stringliteral">&quot;output&#95;block&#95;0&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><Highlight kind="normal">  CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a262d2672038afdeba85e23a30ea4c22d">OutputBlockNum</a> = 0;</Highlight></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><Highlight kind="normal">  <a href="#a96b5bd50d8e96b4c76ffc26508ce774d">replaceArgumentUses</a>(&#42;CurrentOS, NewBBs, OutputMappings, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><Highlight kind="normal">  <a href="#ace02ac07a3f704ffd345301bff92e5a8">replaceConstants</a>(&#42;CurrentOS);</Highlight></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We first identify if any output blocks are empty, if they are we remove</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// them. We then create a branch instruction to the basic block to the return</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block for the function for each non empty output block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a57d54880afa1fb74833cc7c43ad33377">analyzeAndPruneOutputBlocks</a>(NewBBs, &#42;CurrentOS)) &#123;</Highlight></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><Highlight kind="normal">    OutputStoreBBs.push&#95;back(<a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;</a>());</Highlight></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (std::pair&lt;Value &#42;, BasicBlock &#42;&gt; &amp;VToBB : NewBBs) &#123;</Highlight></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;::iterator</a> VBBIt =</Highlight></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><Highlight kind="normal">          CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>.find(VToBB.first);</Highlight></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EndBB = VBBIt-&gt;second;</Highlight></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(EndBB, VToBB.second);</Highlight></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><Highlight kind="normal">      OutputStoreBBs.back().insert(VToBB);</Highlight></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace the call to the extracted function with the outlined function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><Highlight kind="normal">  CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a018669f7b1d6a21106f47398a087c30a">Call</a> = <a href="#a7e2cad7ab18db9a3c940afc609c223dc">replaceCalledFunction</a>(M, &#42;CurrentOS);</Highlight></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We only delete the extracted functions at the end since we may need to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reference instructions contained in them for mapping purposes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><Highlight kind="normal">  FuncsToRemove.push&#95;back(CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#ad5dce467e0d3954ba812f2e9611810b4">ExtractedFunction</a>);</Highlight></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> IROutliner::deduplicateExtractedSections(</Highlight></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/module">Module</a> &amp;M, OutlinableGroup &amp;CurrentGroup,</Highlight></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><Highlight kind="normal">    std::vector&lt;Function &#42;&gt; &amp;FuncsToRemove, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> &amp;OutlinedFunctionNum) &#123;</Highlight></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><Highlight kind="normal">  createFunction(M, CurrentGroup, OutlinedFunctionNum);</Highlight></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><Highlight kind="normal">  std::vector&lt;DenseMap&lt;Value &#42;, BasicBlock &#42;&gt;&gt; OutputStoreBBs;</Highlight></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><Highlight kind="normal">  OutlinableRegion &#42;CurrentOS;</Highlight></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><Highlight kind="normal">  <a href="#a4e06ebf129ddfb3b33a64f1a456cfc24">fillOverallFunction</a>(M, CurrentGroup, OutputStoreBBs, FuncsToRemove,</Highlight></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><Highlight kind="normal">                      OutputMappings);</Highlight></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><Highlight kind="normal">  std::vector&lt;Value &#42;&gt; SortedKeys;</Highlight></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 1; Idx &lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.size(); Idx++) &#123;</Highlight></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><Highlight kind="normal">    CurrentOS = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;Idx&#93;;</Highlight></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><Highlight kind="normal">    AttributeFuncs::mergeAttributesForOutlining(&#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>,</Highlight></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><Highlight kind="normal">                                               &#42;CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#ad5dce467e0d3954ba812f2e9611810b4">ExtractedFunction</a>);</Highlight></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Create a set of BasicBlocks, one for each return block, to hold the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// needed store instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><Highlight kind="normal">    DenseMap&lt;Value &#42;, BasicBlock &#42;&gt; NewBBs;</Highlight></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><Highlight kind="normal">    <a href="#a8120984c169f2ea17e785e7c6887702a">createAndInsertBasicBlocks</a>(</Highlight></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><Highlight kind="normal">        CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>, NewBBs, CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a95133d99b799f98e5c92dacc3028c621">OutlinedFunction</a>,</Highlight></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;output&#95;block&#95;&quot;</Highlight><Highlight kind="normal"> + Twine(</Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(Idx)));</Highlight></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"><Highlight kind="normal">    <a href="#a96b5bd50d8e96b4c76ffc26508ce774d">replaceArgumentUses</a>(&#42;CurrentOS, NewBBs, OutputMappings);</Highlight></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><Highlight kind="normal">    <a href="#a4fcb90c9c38b3381765a891d0a61c1ea">alignOutputBlockWithAggFunc</a>(CurrentGroup, &#42;CurrentOS, NewBBs,</Highlight></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><Highlight kind="normal">                                CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>, OutputMappings,</Highlight></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><Highlight kind="normal">                                OutputStoreBBs);</Highlight></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><Highlight kind="normal">    CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a018669f7b1d6a21106f47398a087c30a">Call</a> = <a href="#a7e2cad7ab18db9a3c940afc609c223dc">replaceCalledFunction</a>(M, &#42;CurrentOS);</Highlight></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><Highlight kind="normal">    FuncsToRemove.push&#95;back(CurrentOS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#ad5dce467e0d3954ba812f2e9611810b4">ExtractedFunction</a>);</Highlight></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create a switch statement to handle the different output schemes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><Highlight kind="normal">  <a href="#ae86fef7fc5831c2514bff95bdf784d09">createSwitchStatement</a>(M, CurrentGroup, CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a8a8e100a9a4c618756cbfc6286ae0e71">EndBBs</a>, OutputStoreBBs);</Highlight></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><Highlight kind="normal">  OutlinedFunctionNum++;</Highlight></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><Highlight kind="comment">/// Checks that the next instruction in the InstructionDataList matches the</Highlight></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><Highlight kind="comment">/// next instruction in the module.  If they do not, there could be the</Highlight></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><Highlight kind="comment">/// possibility that extra code has been inserted, and we must ignore it.</Highlight></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><Highlight kind="comment">/// \\param ID - The IRInstructionData to check the next instruction of.</Highlight></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><Highlight kind="comment">/// \\returns true if the InstructionDataList and actual instruction match.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337" lineLink="#a3bc949e06e148a6d2879eb45ca164146"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a3bc949e06e148a6d2879eb45ca164146">nextIRInstructionDataMatchesNextInst</a>(<a href="/docs/api/structs/llvm/irsimilarity/irinstructiondata">IRInstructionData</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>) &#123;</Highlight></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We check if there is a discrepancy between the InstructionDataList</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and the actual next instruction in the module.  If there is, it means</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that an extra instruction was added, likely by the CodeExtractor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Since we do not have any similarity data about this particular</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction, we cannot confidently outline it, and must discard this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// candidate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><Highlight kind="normal">  IRInstructionDataList::iterator NextIDIt = std::next(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getIterator());</Highlight></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NextIDLInst = NextIDIt-&gt;Inst;</Highlight></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;NextModuleInst = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.Inst-&gt;isTerminator())</Highlight></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><Highlight kind="normal">    NextModuleInst = <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.Inst-&gt;getNextNonDebugInstruction();</Highlight></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NextIDLInst != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><Highlight kind="normal">    NextModuleInst =</Highlight></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><Highlight kind="normal">        &amp;&#42;NextIDIt-&gt;Inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;instructionsWithoutDebug().begin();</Highlight></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NextIDLInst &amp;&amp; NextIDLInst != NextModuleInst)</Highlight></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IROutliner::isCompatibleWithAlreadyOutlinedCode(</Highlight></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>) &#123;</Highlight></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><Highlight kind="normal">  IRSimilarityCandidate &#42;IRSC = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate;</Highlight></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> StartIdx = IRSC-&gt;<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#ada960ccf6a96ca62ce5db3af1b7bf7f5">getStartIdx</a>();</Highlight></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> EndIdx = IRSC-&gt;<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a5fd2e1a8a3658307e8c0d87a153d8c24">getEndIdx</a>();</Highlight></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A check to make sure that we are not about to attempt to outline something</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that has already been outlined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = StartIdx; Idx &lt;= EndIdx; Idx++)</Highlight></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Outlined.contains(Idx))</Highlight></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We check if the recorded instruction matches the actual next instruction,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// if it does not, we fix it in the InstructionDataList.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;backInstruction()-&gt;isTerminator()) &#123;</Highlight></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;NewEndInst =</Highlight></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;backInstruction()-&gt;getNextNonDebugInstruction();</Highlight></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewEndInst &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Next instruction is a nullptr?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;end()-&gt;Inst != NewEndInst) &#123;</Highlight></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><Highlight kind="normal">      IRInstructionDataList &#42;IDL = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;front()-&gt;IDL;</Highlight></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><Highlight kind="normal">      IRInstructionData &#42;NewEndIRID = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> (InstDataAllocator.Allocate())</Highlight></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><Highlight kind="normal">          IRInstructionData(&#42;NewEndInst,</Highlight></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><Highlight kind="normal">                            InstructionClassifier.visit(&#42;NewEndInst), &#42;IDL);</Highlight></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Insert the first IRInstructionData of the new region after the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// last IRInstructionData of the IRSimilarityCandidate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><Highlight kind="normal">      IDL-&gt;<a href="/docs/api/classes/llvm/simple-ilist/#a7f4bd492b552181942252ccddc0db26e">insert</a>(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;end(), &#42;NewEndIRID);</Highlight></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(&#42;IRSC, &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(IRInstructionData &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>) &#123;</Highlight></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a3bc949e06e148a6d2879eb45ca164146">nextIRInstructionDataMatchesNextInst</a>(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>))</Highlight></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !this-&gt;InstructionClassifier.visit(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.Inst);</Highlight></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> IROutliner::pruneIncompatibleRegions(</Highlight></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><Highlight kind="normal">    std::vector&lt;IRSimilarityCandidate&gt; &amp;CandidateVec,</Highlight></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><Highlight kind="normal">    OutlinableGroup &amp;CurrentGroup) &#123;</Highlight></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> PreviouslyOutlined;</Highlight></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Sort from beginning to end, so the IRSimilarityCandidates are in order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">stable&#95;sort</a>(CandidateVec, &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> IRSimilarityCandidate &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</Highlight></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><Highlight kind="normal">                               </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> IRSimilarityCandidate &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</Highlight></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.getStartIdx() &lt; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.getStartIdx();</Highlight></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"><Highlight kind="normal">  IRSimilarityCandidate &amp;FirstCandidate = CandidateVec&#91;0&#93;;</Highlight></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Since outlining a call and a branch instruction will be the same as only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// outlinining a call instruction, we ignore it as a space saving.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FirstCandidate.getLength() == 2) &#123;</Highlight></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CallInst&gt;</a>(FirstCandidate.front()-&gt;Inst) &amp;&amp;</Highlight></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(FirstCandidate.back()-&gt;Inst))</Highlight></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> CurrentEndIdx = 0;</Highlight></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (IRSimilarityCandidate &amp;IRSC : CandidateVec) &#123;</Highlight></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><Highlight kind="normal">    PreviouslyOutlined = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> StartIdx = IRSC.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#ada960ccf6a96ca62ce5db3af1b7bf7f5">getStartIdx</a>();</Highlight></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> EndIdx = IRSC.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a5fd2e1a8a3658307e8c0d87a153d8c24">getEndIdx</a>();</Highlight></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &amp;FnForCurrCand = &#42;IRSC.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#abfc4581d38f96e5833319a3d1ad24c1c">getFunction</a>();</Highlight></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = StartIdx; Idx &lt;= EndIdx; Idx++)</Highlight></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Outlined.contains(Idx)) &#123;</Highlight></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><Highlight kind="normal">        PreviouslyOutlined = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PreviouslyOutlined)</Highlight></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check over the instructions, and if the basic block has its address</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// taken for use somewhere else, we do not outline that block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> BBHasAddressTaken = <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(IRSC, &#91;&#93;(IRInstructionData &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>)&#123;</Highlight></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.Inst-&gt;getParent()-&gt;hasAddressTaken();</Highlight></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BBHasAddressTaken)</Highlight></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FnForCurrCand.<a href="/docs/api/classes/llvm/function/#a9c38a8cc0a38636c95bd2826de9d72d4">hasOptNone</a>())</Highlight></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FnForCurrCand.<a href="/docs/api/classes/llvm/function/#afb28a4deafe2954b0534cc6399ce518b">hasFnAttribute</a>(</Highlight><Highlight kind="stringliteral">&quot;nooutline&quot;</Highlight><Highlight kind="normal">)) &#123;</Highlight></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</Highlight></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;... Skipping function with nooutline attribute: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><Highlight kind="normal">               &lt;&lt; FnForCurrCand.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IRSC.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#af79c3d65a39c004b7517e811db43522c">front</a>()-&gt;<a href="/docs/api/structs/llvm/irsimilarity/irinstructiondata/#a8f280453f9963266308cb61e428f5268">Inst</a>-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()-&gt;<a href="/docs/api/classes/llvm/globalvalue/#ae28d149d03a6ae88267f649bc1dbe42c">hasLinkOnceODRLinkage</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><Highlight kind="normal">        !OutlineFromLinkODRs)</Highlight></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Greedily prune out any regions that will overlap with already chosen</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// regions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurrentEndIdx != 0 &amp;&amp; StartIdx &lt;= CurrentEndIdx)</Highlight></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> BadInst = <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(IRSC, &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(IRInstructionData &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>) &#123;</Highlight></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a3bc949e06e148a6d2879eb45ca164146">nextIRInstructionDataMatchesNextInst</a>(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>))</Highlight></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !this-&gt;InstructionClassifier.visit(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.Inst);</Highlight></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BadInst)</Highlight></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><Highlight kind="normal">    OutlinableRegion &#42;OS = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> (RegionAllocator.Allocate())</Highlight></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><Highlight kind="normal">        OutlinableRegion(IRSC, CurrentGroup);</Highlight></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><Highlight kind="normal">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.push&#95;back(OS);</Highlight></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><Highlight kind="normal">    CurrentEndIdx = EndIdx;</Highlight></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></Highlight></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><Highlight kind="normal">IROutliner::findBenefitFromAllRegions(OutlinableGroup &amp;CurrentGroup) &#123;</Highlight></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><Highlight kind="normal">  InstructionCost RegionBenefit = 0;</Highlight></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (OutlinableRegion &#42;Region : CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>) &#123;</Highlight></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><Highlight kind="normal">    TargetTransformInfo &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> = getTTI(&#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>-&gt;StartBB-&gt;getParent());</Highlight></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We add the number of instructions in the region to the benefit as an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// estimate as to how much will be removed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><Highlight kind="normal">    RegionBenefit += <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>-&gt;getBenefit(<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</Highlight></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Adding: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; RegionBenefit</Highlight></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; saved instructions to overfall benefit.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> RegionBenefit;</Highlight></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><Highlight kind="comment">/// For the \\p OutputCanon number passed in find the value represented by this</Highlight></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><Highlight kind="comment">/// canonical number. If it is from a PHINode, we pick the first incoming</Highlight></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><Highlight kind="comment">/// value and return that Value instead.</Highlight></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><Highlight kind="comment">/// \\param Region - The OutlinableRegion to get the Value from.</Highlight></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><Highlight kind="comment">/// \\param OutputCanon - The canonical number to find the Value from.</Highlight></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><Highlight kind="comment">/// \\returns The Value represented by a canonical number \\p OutputCanon in \\p</Highlight></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><Highlight kind="comment">/// Region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504" lineLink="#ab4b0641c5ffeeb3249b4ce9bb98c1a2d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#ab4b0641c5ffeeb3249b4ce9bb98c1a2d">findOutputValueInRegion</a>(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</Highlight></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><Highlight kind="normal">                                      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OutputCanon) &#123;</Highlight></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><Highlight kind="normal">  <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;CurrentGroup = &#42;<a href="/docs/api/classes/llvm/region">Region</a>.Parent;</Highlight></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the value is greater than the value in the tracker, we have a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// PHINode and will instead use one of the incoming values to find the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OutputCanon &gt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a72b89466c3b2fd45331e2c315e2c33e5">PHINodeGVNTracker</a>) &#123;</Highlight></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> It = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a704926b49e550b25585651aea32b389b">PHINodeGVNToGVNs</a>.find(OutputCanon);</Highlight></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It != CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a704926b49e550b25585651aea32b389b">PHINodeGVNToGVNs</a>.end() &amp;&amp;</Highlight></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Could not find GVN set for PHINode number!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(It-&gt;second.second.size() &gt; 0 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;PHINode does not have any values!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><Highlight kind="normal">    OutputCanon = &#42;It-&gt;second.second.begin();</Highlight></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><Highlight kind="normal">  std::optional&lt;unsigned&gt; OGVN =</Highlight></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/region">Region</a>.Candidate-&gt;fromCanonicalNum(OutputCanon);</Highlight></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OGVN &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Could not find GVN for Canonical Number?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><Highlight kind="normal">  std::optional&lt;Value &#42;&gt; OV = <a href="/docs/api/classes/llvm/region">Region</a>.Candidate-&gt;fromGVN(&#42;OGVN);</Highlight></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OV &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Could not find value for GVN?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;OV;</Highlight></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></Highlight></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><Highlight kind="normal">IROutliner::findCostOutputReloads(OutlinableGroup &amp;CurrentGroup) &#123;</Highlight></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><Highlight kind="normal">  InstructionCost OverallCost = 0;</Highlight></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (OutlinableRegion &#42;Region : CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>) &#123;</Highlight></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><Highlight kind="normal">    TargetTransformInfo &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> = getTTI(&#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>-&gt;StartBB-&gt;getParent());</Highlight></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Each output incurs a load after the call, so we add that to the cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OutputCanon : <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>-&gt;GVNStores) &#123;</Highlight></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="#ab4b0641c5ffeeb3249b4ce9bb98c1a2d">findOutputValueInRegion</a>(&#42;Region, OutputCanon);</Highlight></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><Highlight kind="normal">      InstructionCost LoadCost =</Highlight></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.<a href="/docs/api/classes/llvm/targettransforminfo/#a34c987c590db0e5cff66d9869a34c556">getMemoryOpCost</a>(Instruction::Load, <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType(), <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a>(1), 0,</Highlight></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><Highlight kind="normal">                              <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TargetTransformInfo::TCK&#95;CodeSize</a>);</Highlight></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Adding: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; LoadCost</Highlight></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; instructions to cost for output of type &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><Highlight kind="normal">                        &lt;&lt; &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><Highlight kind="normal">      OverallCost += LoadCost;</Highlight></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OverallCost;</Highlight></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><Highlight kind="comment">/// Find the extra instructions needed to handle any output values for the</Highlight></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><Highlight kind="comment">/// region.</Highlight></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><Highlight kind="comment">/// \\param &#91;in&#93; M - The Module to outline from.</Highlight></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><Highlight kind="comment">/// \\param &#91;in&#93; CurrentGroup - The collection of OutlinableRegions to analyze.</Highlight></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><Highlight kind="comment">/// \\param &#91;in&#93; TTI - The TargetTransformInfo used to collect information for</Highlight></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><Highlight kind="comment">/// new instruction costs.</Highlight></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><Highlight kind="comment">/// \\returns the additional cost to handle the outputs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556" lineLink="#a8b12ae89227758cb5684cc7cf25a7f43"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="#a8b12ae89227758cb5684cc7cf25a7f43">findCostForOutputBlocks</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M,</Highlight></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><Highlight kind="normal">                                               <a href="/docs/api/structs/outlinablegroup">OutlinableGroup</a> &amp;CurrentGroup,</Highlight></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><Highlight kind="normal">                                               <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</Highlight></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> OutputCost = 0;</Highlight></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumOutputBranches = 0;</Highlight></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;FirstRegion = &#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;;</Highlight></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate">IRSimilarityCandidate</a> &amp;Candidate = &#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;-&gt;Candidate;</Highlight></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> CandidateBlocks;</Highlight></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><Highlight kind="normal">  Candidate.<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a93f165686cbc3ed0554ec8431f9c9b21">getBasicBlocks</a>(CandidateBlocks);</Highlight></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Count the number of different output branches that point to blocks outside</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;BasicBlock &#42;&gt;</a> FoundBlocks;</Highlight></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/irsimilarity/irinstructiondata">IRInstructionData</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> : Candidate) &#123;</Highlight></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.Inst))</Highlight></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.OperVals) &#123;</Highlight></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(V);</Highlight></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CandidateBlocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(BB) &amp;&amp; FoundBlocks.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(BB).second)</Highlight></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><Highlight kind="normal">        NumOutputBranches++;</Highlight></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><Highlight kind="normal">  CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a8ef219d66e525d2c9fbb7f54e5869ad3">BranchesToOutside</a> = NumOutputBranches;</Highlight></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;unsigned&gt;</a> &amp;OutputUse :</Highlight></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><Highlight kind="normal">       CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>) &#123;</Highlight></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OutputCanon : OutputUse) &#123;</Highlight></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = <a href="#ab4b0641c5ffeeb3249b4ce9bb98c1a2d">findOutputValueInRegion</a>(FirstRegion, OutputCanon);</Highlight></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> StoreCost =</Highlight></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getMemoryOpCost(Instruction::Load, V-&gt;getType(), <a href="/docs/api/structs/llvm/align">Align</a>(1), 0,</Highlight></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><Highlight kind="normal">                              <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TargetTransformInfo::TCK&#95;CodeSize</a>);</Highlight></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// An instruction cost is added for each store set that needs to occur for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// various output combinations inside the function, plus a branch to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// return to the exit block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Adding: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; StoreCost</Highlight></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; instructions to cost for output of type &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><Highlight kind="normal">                        &lt;&lt; &#42;V-&gt;getType() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><Highlight kind="normal">      OutputCost += StoreCost &#42; NumOutputBranches;</Highlight></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> BranchCost =</Highlight></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getCFInstrCost(Instruction::Br, <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TargetTransformInfo::TCK&#95;CodeSize</a>);</Highlight></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Adding &quot;</Highlight><Highlight kind="normal"> &lt;&lt; BranchCost &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to the current cost for&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; a branch instruction\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><Highlight kind="normal">    OutputCost += BranchCost &#42; NumOutputBranches;</Highlight></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there is more than one output scheme, we must have a comparison and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// branch for each different item in the switch statement.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>.size() &gt; 1) &#123;</Highlight></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ComparisonCost = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getCmpSelInstrCost(</Highlight></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><Highlight kind="normal">        Instruction::ICmp, <a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(M.getContext()),</Highlight></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(M.getContext()), <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">CmpInst::BAD&#95;ICMP&#95;PREDICATE</a>,</Highlight></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TargetTransformInfo::TCK&#95;CodeSize</a>);</Highlight></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> BranchCost =</Highlight></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getCFInstrCost(Instruction::Br, <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TargetTransformInfo::TCK&#95;CodeSize</a>);</Highlight></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> DifferentBlocks = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a53e3a8f28cb8e7a01334b7560467d9ea">OutputGVNCombinations</a>.size();</Highlight></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> TotalCost = ComparisonCost &#42; BranchCost &#42; DifferentBlocks;</Highlight></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Adding: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; TotalCost</Highlight></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; instructions for each switch case for each different&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; output path in a function\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><Highlight kind="normal">    OutputCost += TotalCost &#42; NumOutputBranches;</Highlight></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OutputCost;</Highlight></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> IROutliner::findCostBenefit(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, OutlinableGroup &amp;CurrentGroup) &#123;</Highlight></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><Highlight kind="normal">  InstructionCost RegionBenefit = findBenefitFromAllRegions(CurrentGroup);</Highlight></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><Highlight kind="normal">  CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a> += RegionBenefit;</Highlight></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Current Benefit: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><Highlight kind="normal">  InstructionCost OutputReloadCost = findCostOutputReloads(CurrentGroup);</Highlight></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><Highlight kind="normal">  CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> += OutputReloadCost;</Highlight></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Current Cost: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><Highlight kind="normal">  InstructionCost AverageRegionBenefit =</Highlight></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><Highlight kind="normal">      RegionBenefit / CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.size();</Highlight></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OverallArgumentNum = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a25b29490419d6ea97ce7d79dc58f306d">ArgumentTypes</a>.size();</Highlight></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumRegions = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.size();</Highlight></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><Highlight kind="normal">  TargetTransformInfo &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> =</Highlight></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><Highlight kind="normal">      getTTI(&#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;-&gt;Candidate-&gt;getFunction());</Highlight></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We add one region to the cost once, to account for the instructions added</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// inside of the newly created function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Adding: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; AverageRegionBenefit</Highlight></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; instructions to cost for body of new function.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><Highlight kind="normal">  CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> += AverageRegionBenefit;</Highlight></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Current Cost: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For each argument, we must add an instruction for loading the argument</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// out of the register and into a value inside of the newly outlined function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Adding: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; OverallArgumentNum</Highlight></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; instructions to cost for each argument in the new&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; function.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><Highlight kind="normal">  CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> +=</Highlight></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><Highlight kind="normal">      OverallArgumentNum &#42; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a>;</Highlight></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Current Cost: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Each argument needs to either be loaded into a register or onto the stack.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Some arguments will only be loaded into the stack once the argument</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// registers are filled.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Adding: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; OverallArgumentNum</Highlight></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; instructions to cost for each argument in the new&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; function &quot;</Highlight><Highlight kind="normal"> &lt;&lt; NumRegions &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; times for the &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;needed argument handling at the call site.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><Highlight kind="normal">  CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> +=</Highlight></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><Highlight kind="normal">      2 &#42; OverallArgumentNum &#42; <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272cae46c9eecc49bd2dc253c607e78a0fb86">TargetTransformInfo::TCC&#95;Basic</a> &#42; NumRegions;</Highlight></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Current Cost: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><Highlight kind="normal">  CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> += <a href="#a8b12ae89227758cb5684cc7cf25a7f43">findCostForOutputBlocks</a>(M, CurrentGroup, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>);</Highlight></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Current Cost: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> IROutliner::updateOutputMapping(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>,</Highlight></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><Highlight kind="normal">                                     <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Value &#42;&gt;</a> Outputs,</Highlight></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><Highlight kind="normal">                                     <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI) &#123;</Highlight></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For and load instructions following the call</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Operand = LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2d1ff28d6923802e165905b8d1766e76">getPointerOperand</a>();</Highlight></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><Highlight kind="normal">  std::optional&lt;unsigned&gt; OutputIdx;</Highlight></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find if the operand it is an output register.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ArgIdx = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.NumExtractedInputs;</Highlight></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><Highlight kind="normal">       ArgIdx &lt; Region.Call-&gt;arg&#95;size(); ArgIdx++) &#123;</Highlight></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Operand == <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Call-&gt;getArgOperand(ArgIdx)) &#123;</Highlight></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><Highlight kind="normal">      OutputIdx = ArgIdx - <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.NumExtractedInputs;</Highlight></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we found an output register, place a mapping of the new value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to the original in the mapping.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OutputIdx)</Highlight></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OutputMappings.contains(Outputs&#91;&#42;OutputIdx&#93;)) &#123;</Highlight></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Mapping extracted output &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;LI &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><Highlight kind="normal">                      &lt;&lt; &#42;Outputs&#91;&#42;OutputIdx&#93; &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><Highlight kind="normal">    OutputMappings.insert(std::make&#95;pair(LI, Outputs&#91;&#42;OutputIdx&#93;));</Highlight></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Orig = OutputMappings.find(Outputs&#91;&#42;OutputIdx&#93;)-&gt;second;</Highlight></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Mapping extracted output &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Orig &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><Highlight kind="normal">                      &lt;&lt; &#42;Outputs&#91;&#42;OutputIdx&#93; &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><Highlight kind="normal">    OutputMappings.insert(std::make&#95;pair(LI, Orig));</Highlight></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IROutliner::extractSection(<a href="/docs/api/structs/llvm/outlinableregion">OutlinableRegion</a> &amp;<a href="/docs/api/classes/llvm/region">Region</a>) &#123;</Highlight></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><Highlight kind="normal">  SetVector&lt;Value &#42;&gt; ArgInputs, Outputs, SinkCands;</Highlight></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.StartBB &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;StartBB for the OutlinableRegion is nullptr!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;InitialStart = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.StartBB;</Highlight></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;OrigF = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.StartBB-&gt;getParent();</Highlight></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><Highlight kind="normal">  CodeExtractorAnalysisCache CEAC(&#42;OrigF);</Highlight></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.ExtractedFunction =</Highlight></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.CE-&gt;extractCodeRegion(CEAC, ArgInputs, Outputs);</Highlight></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the extraction was successful, find the BasicBlock, and reassign the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// OutlinableRegion blocks</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.ExtractedFunction) &#123;</Highlight></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;CodeExtractor failed to outline &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.StartBB</Highlight></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.reattachCandidate();</Highlight></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get the block containing the called branch, and reassign the blocks as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// necessary.  If the original block still exists, it is because we ended on</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a branch instruction, and so we move the contents into the block before</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and assign the previous block correctly.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/objcarc/#a494b44abeacdfac8bb26d3203571d1c2a8f9bfe9d1345237cb3b2b205864da075">User</a> &#42;InstAsUser = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.ExtractedFunction-&gt;user&#95;back();</Highlight></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;RewrittenBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(InstAsUser)-&gt;getParent();</Highlight></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.PrevBB = RewrittenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</Highlight></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.PrevBB &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;PrevBB is nullptr?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.PrevBB == InitialStart) &#123;</Highlight></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;NewPrev = InitialStart-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</Highlight></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;BI = NewPrev-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</Highlight></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><Highlight kind="normal">    BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><Highlight kind="normal">    <a href="#a3afc8c0c69b0c55edce3be13d5b7cc32">moveBBContents</a>(&#42;InitialStart, &#42;NewPrev);</Highlight></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.PrevBB = NewPrev;</Highlight></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><Highlight kind="normal">    InitialStart-&gt;<a href="/docs/api/classes/llvm/basicblock/#a8dd327a937563afdb08250abc43820b0">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.StartBB = RewrittenBB;</Highlight></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.EndBB = RewrittenBB;</Highlight></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The sequences of outlinable regions has now changed.  We must fix the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// IRInstructionDataList for consistency.  Although they may not be illegal</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instructions, they should not be compared with anything else as they</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// should not be outlined in this round.  So marking these as illegal is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// allowed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><Highlight kind="normal">  IRInstructionDataList &#42;IDL = <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;front()-&gt;IDL;</Highlight></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;BeginRewritten = &amp;&#42;RewrittenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</Highlight></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;EndRewritten = &amp;&#42;RewrittenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</Highlight></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.NewFront = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> (InstDataAllocator.Allocate()) IRInstructionData(</Highlight></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><Highlight kind="normal">      &#42;BeginRewritten, InstructionClassifier.visit(&#42;BeginRewritten), &#42;IDL);</Highlight></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.NewBack = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> (InstDataAllocator.Allocate()) IRInstructionData(</Highlight></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><Highlight kind="normal">      &#42;EndRewritten, InstructionClassifier.visit(&#42;EndRewritten), &#42;IDL);</Highlight></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Insert the first IRInstructionData of the new region in front of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// first IRInstructionData of the IRSimilarityCandidate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><Highlight kind="normal">  IDL-&gt;<a href="/docs/api/classes/llvm/simple-ilist/#a7f4bd492b552181942252ccddc0db26e">insert</a>(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;begin(), &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.NewFront);</Highlight></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Insert the first IRInstructionData of the new region after the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// last IRInstructionData of the IRSimilarityCandidate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><Highlight kind="normal">  IDL-&gt;<a href="/docs/api/classes/llvm/simple-ilist/#a7f4bd492b552181942252ccddc0db26e">insert</a>(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;end(), &#42;<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.NewBack);</Highlight></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove the IRInstructionData from the IRSimilarityCandidate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><Highlight kind="normal">  IDL-&gt;<a href="/docs/api/classes/llvm/simple-ilist/#a4b588a868b58f1ac0917a59e7c48b5cc">erase</a>(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;begin(), std::prev(<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Candidate-&gt;end()));</Highlight></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RewrittenBB != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> &amp;&amp;</Highlight></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Could not find a predecessor after extraction!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iterate over the new set of instructions to find the new call</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;RewrittenBB)</Highlight></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallInst &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.ExtractedFunction == CI-&gt;getCalledFunction())</Highlight></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.Call = CI;</Highlight></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LoadInst &#42;LI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><Highlight kind="normal">      updateOutputMapping(Region, Outputs.<a href="/docs/api/classes/llvm/setvector/#a0c7d0dae14eb8a5916fff9f72d8b46d2">getArrayRef</a>(), LI);</Highlight></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>.reattachCandidate();</Highlight></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IROutliner::doOutline(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) &#123;</Highlight></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find the possible similarity sections.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><Highlight kind="normal">  InstructionClassifier.EnableBranches = !<a href="/docs/api/namespaces/llvm/#a93b773511cf2c25df41bdd74e8718bd3">DisableBranches</a>;</Highlight></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><Highlight kind="normal">  InstructionClassifier.EnableIndirectCalls = !<a href="/docs/api/namespaces/llvm/#a59a51d46c30287fc47551914e29de21e">DisableIndirectCalls</a>;</Highlight></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><Highlight kind="normal">  InstructionClassifier.EnableIntrinsics = !<a href="/docs/api/namespaces/llvm/#a98fea048f88b5fe74294b5bf72acb93c">DisableIntrinsics</a>;</Highlight></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><Highlight kind="normal">  IRSimilarityIdentifier &amp;<a href="/docs/api/namespaces/llvm/object/#a42e5b6ee6f67085d2115b2ea44588c47acfaaa2f9ff08c82a08d647efc1a2964b">Identifier</a> = getIRSI(M);</Highlight></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/irsimilarity/#a1e2d2e59b2467bacdc6db54dcc9bc4a1">SimilarityGroupList</a> &amp;SimilarityCandidates = &#42;<a href="/docs/api/namespaces/llvm/object/#a42e5b6ee6f67085d2115b2ea44588c47acfaaa2f9ff08c82a08d647efc1a2964b">Identifier</a>.getSimilarity();</Highlight></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Sort them by size of extracted sections</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OutlinedFunctionNum = 0;</Highlight></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we only have one SimilarityGroup in SimilarityCandidates, we do not have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to sort them by the potential number of instructions to be outlined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SimilarityCandidates.size() &gt; 1)</Highlight></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable&#95;sort</a>(SimilarityCandidates,</Highlight></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><Highlight kind="normal">                      &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::vector&lt;IRSimilarityCandidate&gt; &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</Highlight></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><Highlight kind="normal">                         </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::vector&lt;IRSimilarityCandidate&gt; &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</Highlight></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><Highlight kind="normal">                        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>&#91;0&#93;.getLength() &#42; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>.size() &gt;</Highlight></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><Highlight kind="normal">                               <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>&#91;0&#93;.getLength() &#42; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>.size();</Highlight></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><Highlight kind="normal">                      &#125;);</Highlight></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Creating OutlinableGroups for each SimilarityCandidate to be used in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// each of the following for loops to avoid making an allocator.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><Highlight kind="normal">  std::vector&lt;OutlinableGroup&gt; PotentialGroups(SimilarityCandidates.size());</Highlight></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><Highlight kind="normal">  DenseSet&lt;unsigned&gt; NotSame;</Highlight></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><Highlight kind="normal">  std::vector&lt;OutlinableGroup &#42;&gt; NegativeCostGroups;</Highlight></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><Highlight kind="normal">  std::vector&lt;OutlinableRegion &#42;&gt; OutlinedRegions;</Highlight></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iterate over the possible sets of similarity.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> PotentialGroupIdx = 0;</Highlight></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/irsimilarity/#a2198f86ce16da838bdeea4de7e59ef31">SimilarityGroup</a> &amp;CandidateVec : SimilarityCandidates) &#123;</Highlight></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><Highlight kind="normal">    OutlinableGroup &amp;CurrentGroup = PotentialGroups&#91;PotentialGroupIdx++&#93;;</Highlight></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remove entries that were previously outlined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><Highlight kind="normal">    pruneIncompatibleRegions(CandidateVec, CurrentGroup);</Highlight></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We pruned the number of regions to 0 to 1, meaning that it&#39;s not worth</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// trying to outlined since there is no compatible similar instance of this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// code.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.size() &lt; 2)</Highlight></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Determine if there are any values that are the same constant throughout</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// each section in the set.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><Highlight kind="normal">    NotSame.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1fbf4d66a9eeaa9ade03e8febee097ee">clear</a>();</Highlight></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><Highlight kind="normal">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a61915f6a6a382f51fd1a8bf3dd188c0c">findSameConstants</a>(NotSame);</Highlight></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a7bf6409b01dd04465404d268beec0898">IgnoreGroup</a>)</Highlight></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Create a CodeExtractor for each outlinable region. Identify inputs and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// outputs for each section using the code extractor and create the argument</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// types for the Aggregate Outlining Function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><Highlight kind="normal">    OutlinedRegions.clear();</Highlight></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (OutlinableRegion &#42;OS : CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>) &#123;</Highlight></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Break the outlinable region out of its parent BasicBlock into its own</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// BasicBlocks (see function implementation).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><Highlight kind="normal">      OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a761b3c02cd196cb5f6fb019bcd86866e">splitCandidate</a>();</Highlight></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// There&#39;s a chance that when the region is split, extra instructions are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// added to the region. This makes the region no longer viable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// to be split, so we ignore it for outlining.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a6a1b95a7f7c90784102fd63ffaa0ea00">CandidateSplit</a>)</Highlight></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;BasicBlock &#42;&gt;</a> BE;</Highlight></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><Highlight kind="normal">      DenseSet&lt;BasicBlock &#42;&gt; BlocksInRegion;</Highlight></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><Highlight kind="normal">      OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a93f165686cbc3ed0554ec8431f9c9b21">getBasicBlocks</a>(BlocksInRegion, BE);</Highlight></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><Highlight kind="normal">      OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a06ee910ecb16eaaab4f069fa05c2a95a">CE</a> = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> (ExtractorAllocator.Allocate())</Highlight></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><Highlight kind="normal">          CodeExtractor(BE, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><Highlight kind="normal">                        </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="stringliteral">&quot;outlined&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><Highlight kind="normal">      findAddInputsOutputs(M, &#42;OS, NotSame);</Highlight></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a737734321cd2dd3896e64015cab7ab95">IgnoreRegion</a>)</Highlight></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><Highlight kind="normal">        OutlinedRegions.push&#95;back(OS);</Highlight></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We recombine the blocks together now that we have gathered all the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// needed information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><Highlight kind="normal">      OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#af5d7aa7988108e9377f154cf6a22f02b">reattachCandidate</a>();</Highlight></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><Highlight kind="normal">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a> = std::move(OutlinedRegions);</Highlight></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.empty())</Highlight></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><Highlight kind="normal">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ad67fb96194cff11216803ad74dba5687">collectGVNStoreSets</a>(M);</Highlight></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CostModel)</Highlight></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><Highlight kind="normal">      findCostBenefit(M, CurrentGroup);</Highlight></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we are adhering to the cost model, skip those groups where the cost</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// outweighs the benefits.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &gt;= CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a> &amp;&amp; CostModel) &#123;</Highlight></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><Highlight kind="normal">      OptimizationRemarkEmitter &amp;ORE =</Highlight></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><Highlight kind="normal">          getORE(&#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;-&gt;Candidate-&gt;getFunction());</Highlight></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><Highlight kind="normal">      ORE.<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><Highlight kind="normal">        IRSimilarityCandidate &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;-&gt;Candidate;</Highlight></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><Highlight kind="normal">        OptimizationRemarkMissed <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </Highlight><Highlight kind="stringliteral">&quot;WouldNotDecreaseSize&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"><Highlight kind="normal">                                   <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;frontInstruction());</Highlight></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;did not outline &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><Highlight kind="normal">          &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(std::to&#95;string(CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.size()))</Highlight></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><Highlight kind="normal">          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; regions due to estimated increase of &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><Highlight kind="normal">          &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</Highlight><Highlight kind="stringliteral">&quot;InstructionIncrease&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><Highlight kind="normal">                     CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> - CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a>)</Highlight></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><Highlight kind="normal">          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; instructions at locations &quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a2145da5bde7663d745e9c3ade392809f">interleave</a>(</Highlight></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><Highlight kind="normal">            CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.begin(), CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.end(),</Highlight></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><Highlight kind="normal">            &#91;&amp;R&#93;(OutlinableRegion &#42;Region) &#123;</Highlight></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><Highlight kind="normal">              R &lt;&lt; ore::NV(</Highlight></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><Highlight kind="normal">                  </Highlight><Highlight kind="stringliteral">&quot;DebugLoc&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><Highlight kind="normal">                  Region-&gt;Candidate-&gt;frontInstruction()-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><Highlight kind="normal">            &#125;,</Highlight></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><Highlight kind="normal">            &#91;&amp;R&#93;() &#123; R &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; &quot;</Highlight><Highlight kind="normal">; &#125;);</Highlight></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>;</Highlight></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><Highlight kind="normal">    NegativeCostGroups.push&#95;back(&amp;CurrentGroup);</Highlight></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><Highlight kind="normal">  ExtractorAllocator.DestroyAll();</Highlight></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NegativeCostGroups.size() &gt; 1)</Highlight></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">stable&#95;sort</a>(NegativeCostGroups,</Highlight></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><Highlight kind="normal">                &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> OutlinableGroup &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> OutlinableGroup &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</Highlight></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"><Highlight kind="normal">                  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;Benefit - <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>-&gt;Cost &gt; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;Benefit - <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>-&gt;Cost;</Highlight></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><Highlight kind="normal">                &#125;);</Highlight></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><Highlight kind="normal">  std::vector&lt;Function &#42;&gt; FuncsToRemove;</Highlight></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (OutlinableGroup &#42;CG : NegativeCostGroups) &#123;</Highlight></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><Highlight kind="normal">    OutlinableGroup &amp;CurrentGroup = &#42;CG;</Highlight></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"><Highlight kind="normal">    OutlinedRegions.clear();</Highlight></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (OutlinableRegion &#42;Region : CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>) &#123;</Highlight></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We check whether our region is compatible with what has already been</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// outlined, and whether we need to ignore this item.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!isCompatibleWithAlreadyOutlinedCode(&#42;Region))</Highlight></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><Highlight kind="normal">      OutlinedRegions.push&#95;back(Region);</Highlight></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OutlinedRegions.size() &lt; 2)</Highlight></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Reestimate the cost and benefit of the OutlinableGroup. Continue only if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we are still outlining enough regions to make up for the added cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><Highlight kind="normal">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a> = std::move(OutlinedRegions);</Highlight></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CostModel) &#123;</Highlight></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><Highlight kind="normal">      CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a> = 0;</Highlight></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><Highlight kind="normal">      CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> = 0;</Highlight></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><Highlight kind="normal">      findCostBenefit(M, CurrentGroup);</Highlight></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &gt;= CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a>)</Highlight></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><Highlight kind="normal">    OutlinedRegions.clear();</Highlight></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (OutlinableRegion &#42;Region : CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>) &#123;</Highlight></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>-&gt;splitCandidate();</Highlight></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/amdgpu/hsamd/#a7f822c68e1b547ae15cc6ef4bc59176daf447ac856e7e72435904956e3b15f433">Region</a>-&gt;CandidateSplit)</Highlight></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><Highlight kind="normal">      OutlinedRegions.push&#95;back(Region);</Highlight></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><Highlight kind="normal">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a> = std::move(OutlinedRegions);</Highlight></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.size() &lt; 2) &#123;</Highlight></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (OutlinableRegion &#42;R : CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>)</Highlight></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>-&gt;reattachCandidate();</Highlight></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Outlining regions with cost &quot;</Highlight><Highlight kind="normal"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a></Highlight></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; and benefit &quot;</Highlight><Highlight kind="normal"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Create functions out of all the sections, and mark them as outlined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><Highlight kind="normal">    OutlinedRegions.clear();</Highlight></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (OutlinableRegion &#42;OS : CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>) &#123;</Highlight></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;BasicBlock &#42;&gt;</a> BE;</Highlight></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"><Highlight kind="normal">      DenseSet&lt;BasicBlock &#42;&gt; BlocksInRegion;</Highlight></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><Highlight kind="normal">      OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a93f165686cbc3ed0554ec8431f9c9b21">getBasicBlocks</a>(BlocksInRegion, BE);</Highlight></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><Highlight kind="normal">      OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a06ee910ecb16eaaab4f069fa05c2a95a">CE</a> = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> (ExtractorAllocator.Allocate())</Highlight></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><Highlight kind="normal">          CodeExtractor(BE, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><Highlight kind="normal">                        </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="stringliteral">&quot;outlined&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> FunctionOutlined = extractSection(&#42;OS);</Highlight></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FunctionOutlined) &#123;</Highlight></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> StartIdx = OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#ada960ccf6a96ca62ce5db3af1b7bf7f5">getStartIdx</a>();</Highlight></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> EndIdx = OS-&gt;<a href="/docs/api/structs/llvm/outlinableregion/#a9db9e67d9d8c8f5c0cd2b8a64915f884">Candidate</a>-&gt;<a href="/docs/api/classes/llvm/irsimilarity/irsimilaritycandidate/#a5fd2e1a8a3658307e8c0d87a153d8c24">getEndIdx</a>();</Highlight></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = StartIdx; Idx &lt;= EndIdx; Idx++)</Highlight></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><Highlight kind="normal">          Outlined.insert(Idx);</Highlight></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"><Highlight kind="normal">        OutlinedRegions.push&#95;back(OS);</Highlight></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Outlined &quot;</Highlight><Highlight kind="normal"> &lt;&lt; OutlinedRegions.size()</Highlight></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; with benefit &quot;</Highlight><Highlight kind="normal"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a></Highlight></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; and cost &quot;</Highlight><Highlight kind="normal"> &lt;&lt; CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><Highlight kind="normal">    CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a> = std::move(OutlinedRegions);</Highlight></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.empty())</Highlight></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><Highlight kind="normal">    OptimizationRemarkEmitter &amp;ORE =</Highlight></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><Highlight kind="normal">        getORE(&#42;CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;-&gt;Call-&gt;getFunction());</Highlight></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><Highlight kind="normal">    ORE.<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><Highlight kind="normal">      IRSimilarityCandidate &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>&#91;0&#93;-&gt;Candidate;</Highlight></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><Highlight kind="normal">      OptimizationRemark <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </Highlight><Highlight kind="stringliteral">&quot;Outlined&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;front()-&gt;Inst);</Highlight></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;outlined &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(std::to&#95;string(CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.size()))</Highlight></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><Highlight kind="normal">        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; regions with decrease of &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><Highlight kind="normal">        &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</Highlight><Highlight kind="stringliteral">&quot;Benefit&quot;</Highlight><Highlight kind="normal">, CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#ae0f753d38671d8138865d30d8cf5720b">Benefit</a> - CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a69a17456977b7d8eb5795eb51870d41c">Cost</a>)</Highlight></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"><Highlight kind="normal">        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; instructions at locations &quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a2145da5bde7663d745e9c3ade392809f">interleave</a>(</Highlight></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><Highlight kind="normal">          CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.begin(), CurrentGroup.<a href="/docs/api/structs/outlinablegroup/#a75bbc3b17e5b70e0e1fac394f26b5c11">Regions</a>.end(),</Highlight></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><Highlight kind="normal">          &#91;&amp;R&#93;(OutlinableRegion &#42;Region) &#123;</Highlight></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"><Highlight kind="normal">            R &lt;&lt; ore::NV(</Highlight><Highlight kind="stringliteral">&quot;DebugLoc&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><Highlight kind="normal">                         Region-&gt;Candidate-&gt;frontInstruction()-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><Highlight kind="normal">          &#125;,</Highlight></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"><Highlight kind="normal">          &#91;&amp;R&#93;() &#123; R &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; &quot;</Highlight><Highlight kind="normal">; &#125;);</Highlight></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>;</Highlight></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><Highlight kind="normal">    deduplicateExtractedSections(M, CurrentGroup, FuncsToRemove,</Highlight></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><Highlight kind="normal">                                 OutlinedFunctionNum);</Highlight></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Function &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> : FuncsToRemove)</Highlight></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OutlinedFunctionNum;</Highlight></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013" lineLink="/docs/api/classes/llvm/iroutliner/#adc7588dad82317423eb5949ca4bac107"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/iroutliner/#adc7588dad82317423eb5949ca4bac107">IROutliner::run</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) &#123;</Highlight></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><Highlight kind="normal">  CostModel = !<a href="#a2dfbf70cabc04c37f6f46b2c312b2506">NoCostModel</a>;</Highlight></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><Highlight kind="normal">  OutlineFromLinkODRs = <a href="#a415af6f4421aa68820b3279b48acd928">EnableLinkOnceODRIROutlining</a>;</Highlight></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> doOutline(M) &gt; 0;</Highlight></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020" lineLink="/docs/api/classes/llvm/iroutlinerpass/#a5b9a8fe2c3b6834817b2c12b08441cff"><Highlight kind="normal"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/classes/llvm/iroutlinerpass/#a5b9a8fe2c3b6834817b2c12b08441cff">IROutlinerPass::run</a>(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M, <a href="/docs/api/namespaces/llvm/#af9c9208365fd9ce11392b4d79485e259">ModuleAnalysisManager</a> &amp;AM) &#123;</Highlight></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a> = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/namespaces/llvm/#a4143e067711d3c7795276b225a8d6eb9">FunctionAnalysisManagerModuleProxy</a>&gt;(M).getManager();</Highlight></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><Highlight kind="normal">  std::function&lt;<a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GTTI =</Highlight></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><Highlight kind="normal">      &#91;&amp;<a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>&#93;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; &#123;</Highlight></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#a83c7e5ca51099e4efa895791a02fb0ed">FAM</a>.getResult&lt;<a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"><Highlight kind="normal">  std::function&lt;<a href="/docs/api/classes/llvm/irsimilarity/irsimilarityidentifier">IRSimilarityIdentifier</a> &amp;(<a href="/docs/api/classes/llvm/module">Module</a> &amp;)&gt; GIRSI =</Highlight></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><Highlight kind="normal">      &#91;&amp;AM&#93;(<a href="/docs/api/classes/llvm/module">Module</a> &amp;M) -&gt; <a href="/docs/api/classes/llvm/irsimilarity/irsimilarityidentifier">IRSimilarityIdentifier</a> &amp; &#123;</Highlight></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/irsimilarityanalysis">IRSimilarityAnalysis</a>&gt;(M);</Highlight></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><Highlight kind="normal">  std::unique&#95;ptr&lt;OptimizationRemarkEmitter&gt; ORE;</Highlight></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><Highlight kind="normal">  std::function&lt;<a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &amp;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;)&gt; GORE =</Highlight></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"><Highlight kind="normal">      &#91;&amp;ORE&#93;(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) -&gt; <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &amp; &#123;</Highlight></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><Highlight kind="normal">    ORE.reset(</Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>));</Highlight></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;ORE;</Highlight></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/iroutliner">IROutliner</a>(GTTI, GIRSI, GORE).<a href="/docs/api/classes/llvm/iroutlinerpass/#a5b9a8fe2c3b6834817b2c12b08441cff">run</a>(M))</Highlight></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/preservedanalyses/#a03797a73044a81cbc6a3409d6c72ee8f">PreservedAnalyses::none</a>();</Highlight></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</Highlight></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><Highlight kind="normal">&#125;</Highlight></CodeLine>

</ProgramListing>

</DoxygenPage>
