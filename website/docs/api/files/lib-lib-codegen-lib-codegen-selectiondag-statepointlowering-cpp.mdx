---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `StatepointLowering.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="StatepointLowering.h"
  permalink="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-h"
  isLocal="true" />
<IncludesListItem
  filePath="SelectionDAGBuilder.h"
  permalink="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/selectiondagbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallBitVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallbitvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/FunctionLoweringInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/functionloweringinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/GCMetadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/gcmetadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/ISDOpcodes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/isdopcodes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFrameInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineframeinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineMemOperand.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinememoperand-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/SelectionDAG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/selectiondag-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/SelectionDAGNodes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/selectiondagnodes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/StackMaps.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/stackmaps-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetLowering.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetlowering-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetOpcodes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetopcodes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGenTypes/MachineValueType.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegentypes/machinevaluetype-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CallingConv.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/callingconv-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GCStrategy.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/gcstrategy-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Statepoint.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/statepoint-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetMachine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetOptions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetoptions-h"
  isLocal="true" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstddef"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="tuple"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
</IncludesList>

## Typedefs Index

<MembersIndex>

<MembersIndexItem
  type="typedef"
  name={<><a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord">FunctionLoweringInfo::StatepointRelocationRecord</a> <a href="#ae5fbc6e1ce3fcbb7f185ed9e7beffec7">RecordType</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type={<>std::optional&lt; int &gt;</>}
  name={<><a href="#a6ac2c0f0b7439c31332c78cd1ca5c4fe">findPreviousSpillSlot</a> (const Value &#42;Val, SelectionDAGBuilder &amp;Builder, int LookUpDepth)</>}>
Utility function for reservePreviousStackSlotForValue. <a href="#a6ac2c0f0b7439c31332c78cd1ca5c4fe">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::pair&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/gcresultinst">GCResultInst</a> &#42;, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/gcresultinst">GCResultInst</a> &#42; &gt;</>}
  name={<><a href="#ab1af1f498b4d814ee68810a03fbe28a7">getGCResultLocality</a> (const GCStatepointInst &amp;S)</>}>
Return two gc.results if present. <a href="#ab1af1f498b4d814ee68810a03fbe28a7">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a> &#42;</>}
  name={<><a href="#aec1de11231135901271d92c7d90dae60">getMachineMemOperand</a> (MachineFunction &amp;MF, FrameIndexSDNode &amp;FI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a720af7e7f23150174952da03d216341a">isGCValue</a> (const Value &#42;V, SelectionDAGBuilder &amp;Builder)</>}>
Return true if value V represents the GC value. <a href="#a720af7e7f23150174952da03d216341a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::pair&lt; <a href="/docs/api/classes/llvm/sdvalue">SDValue</a>, <a href="/docs/api/classes/llvm/sdnode">SDNode</a> &#42; &gt;</>}
  name={<><a href="#af8947d9c8165e82094241d319758e0c5">lowerCallFromStatepointLoweringInfo</a> (SelectionDAGBuilder::StatepointLoweringInfo &amp;SI, SelectionDAGBuilder &amp;Builder)</>}>
Extract call from statepoint, lower it and return pointer to the call node. <a href="#af8947d9c8165e82094241d319758e0c5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a1692829d8158767fe5ac1809c90a77a3">lowerIncomingStatepointValue</a> (SDValue Incoming, bool RequireSpillSlot, SmallVectorImpl&lt; SDValue &gt; &amp;Ops, SmallVectorImpl&lt; MachineMemOperand &#42; &gt; &amp;MemRefs, SelectionDAGBuilder &amp;Builder)</>}>
Lower a single value incoming to a statepoint node. <a href="#a1692829d8158767fe5ac1809c90a77a3">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a9029ef3db44eac67782fd8ccb7796a0c">lowerStatepointMetaArgs</a> (SmallVectorImpl&lt; SDValue &gt; &amp;Ops, SmallVectorImpl&lt; MachineMemOperand &#42; &gt; &amp;MemRefs, SmallVectorImpl&lt; SDValue &gt; &amp;GCPtrs, DenseMap&lt; SDValue, int &gt; &amp;LowerAsVReg, SelectionDAGBuilder::StatepointLoweringInfo &amp;SI, SelectionDAGBuilder &amp;Builder)</>}>
Lower deopt state and gc pointer arguments of the statepoint. <a href="#a9029ef3db44eac67782fd8ccb7796a0c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a> (SmallVectorImpl&lt; SDValue &gt; &amp;Ops, SelectionDAGBuilder &amp;Builder, uint64&#95;t Value)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#adec63d991d7eb048d87fa3888099c848">reservePreviousStackSlotForValue</a> (const Value &#42;IncomingValue, SelectionDAGBuilder &amp;Builder)</>}>
Try to find existing copies of the incoming values in stack slots used for statepoint spilling. <a href="#adec63d991d7eb048d87fa3888099c848">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::tuple&lt; <a href="/docs/api/classes/llvm/sdvalue">SDValue</a>, <a href="/docs/api/classes/llvm/sdvalue">SDValue</a>, <a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a> &#42; &gt;</>}
  name={<><a href="#afb9b4b3ff97e290070f42849b51a13a5">spillIncomingStatepointValue</a> (SDValue Incoming, SDValue Chain, SelectionDAGBuilder &amp;Builder)</>}>
Spill a value incoming to the statepoint. <a href="#afb9b4b3ff97e290070f42849b51a13a5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac56a1eac8e1bf8bbe2530ba919e3542c">STATISTIC</a> (NumSlotsAllocatedForStatepoints, &quot;Number of stack slots allocated for statepoints&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a190019db36961a89ee7ac54d621812f9">STATISTIC</a> (NumOfStatepoints, &quot;Number of statepoint nodes encountered&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a832142292a9ea54449b2930dd109a131">STATISTIC</a> (StatepointMaxSlotsRequired, &quot;Maximum number of stack slots required for a singe statepoint&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a8300a0e0276d27757963efa800126f14">willLowerDirectly</a> (SDValue Incoming)</>}>
Return true if-and-only-if the given <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> can be lowered as either a constant argument or a stack reference. <a href="#a8300a0e0276d27757963efa800126f14">More...</a>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#adc011fee2f0e40238d54aa2a8820c728">MaxRegistersForGCPointers</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ab9bf191372abad68cbfc02b4e33cebc6">UseRegistersForDeoptValues</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a08e0d3f870d52149756ca3cec34ab6a0">UseRegistersForGCPointersInLandingPad</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;statepoint-lowering&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Typedefs

### RecordType {#ae5fbc6e1ce3fcbb7f185ed9e7beffec7}

<MemberDefinition
  prototype="typedef FunctionLoweringInfo::StatepointRelocationRecord RecordType">

Definition at line <a href="#l00076">76</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Functions

### findPreviousSpillSlot() {#a6ac2c0f0b7439c31332c78cd1ca5c4fe}

<MemberDefinition
  prototype={<>static std::optional&lt; int &gt; findPreviousSpillSlot (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42; Val, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder, int LookUpDepth)</>}
  labels = {["static"]}>
Utility function for reservePreviousStackSlotForValue.

Tries to find stack slot index to which we have spilled value for previous statepoints. LookUpDepth specifies maximum DFS depth this function is allowed to look.

Definition at line <a href="#l00160">160</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### getGCResultLocality() {#ab1af1f498b4d814ee68810a03fbe28a7}

<MemberDefinition
  prototype={<>static std::pair&lt; const GCResultInst &#42;, const GCResultInst &#42; &gt; getGCResultLocality (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/gcstatepointinst">GCStatepointInst</a> &amp; S)</>}
  labels = {["static"]}>
Return two gc.results if present.

First result is a block local gc.result, second result is a non-block local gc.result. Corresponding entry will be nullptr if not present.

Definition at line <a href="#l00999">999</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### getMachineMemOperand() {#aec1de11231135901271d92c7d90dae60}

<MemberDefinition
  prototype={<>static MachineMemOperand &#42; getMachineMemOperand (<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp; MF, <a href="/docs/api/classes/llvm/frameindexsdnode">FrameIndexSDNode</a> &amp; FI)</>}
  labels = {["static"]}>

Definition at line <a href="#l00358">358</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### isGCValue() {#a720af7e7f23150174952da03d216341a}

<MemberDefinition
  prototype={<>static bool isGCValue (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder)</>}
  labels = {["static"]}>
Return true if value V represents the GC value.

The behavior is conservative in case it is not sure that value is not GC the function returns true.

Definition at line <a href="#l00502">502</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### lowerCallFromStatepointLoweringInfo() {#af8947d9c8165e82094241d319758e0c5}

<MemberDefinition
  prototype={<>static std::pair&lt; SDValue, SDNode &#42; &gt; lowerCallFromStatepointLoweringInfo (<a href="/docs/api/structs/llvm/selectiondagbuilder/statepointloweringinfo">SelectionDAGBuilder::StatepointLoweringInfo</a> &amp; SI, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder)</>}
  labels = {["static"]}>
Extract call from statepoint, lower it and return pointer to the call node.

Also update NodeMap so that getValue(statepoint) will reference lowered call result

Definition at line <a href="#l00318">318</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### lowerIncomingStatepointValue() {#a1692829d8158767fe5ac1809c90a77a3}

<MemberDefinition
  prototype={<>static void lowerIncomingStatepointValue (<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Incoming, bool RequireSpillSlot, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> &gt; &amp; Ops, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a> &#42; &gt; &amp; MemRefs, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder)</>}
  labels = {["static"]}>
Lower a single value incoming to a statepoint node.

This value can be either a deopt value or a gc value, the handling is the same. We special case constants and allocas, then fall back to spilling if required.

Definition at line <a href="#l00424">424</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### lowerStatepointMetaArgs() {#a9029ef3db44eac67782fd8ccb7796a0c}

<MemberDefinition
  prototype={<>static void lowerStatepointMetaArgs (<a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> &gt; &amp; Ops, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a> &#42; &gt; &amp; MemRefs, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> &gt; &amp; GCPtrs, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/sdvalue">SDValue</a>, int &gt; &amp; LowerAsVReg, <a href="/docs/api/structs/llvm/selectiondagbuilder/statepointloweringinfo">SelectionDAGBuilder::StatepointLoweringInfo</a> &amp; SI, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder)</>}
  labels = {["static"]}>
Lower deopt state and gc pointer arguments of the statepoint.

The actual lowering is described in lowerIncomingStatepointValue. This function is responsible for lowering everything in the right position and playing some tricks to avoid redundant stack manipulation where possible. On completion, &#39;Ops&#39; will contain ready to use operands for machine code statepoint. The chain nodes will have already been created and the DAG root will be set to the last value spilled (if any were).

Definition at line <a href="#l00520">520</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### pushStackMapConstant() {#a720a77a05d768dabfa739d154c11ddfd}

<MemberDefinition
  prototype={<>static void pushStackMapConstant (<a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> &gt; &amp; Ops, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder, uint64&#95;t Value)</>}
  labels = {["static"]}>

Definition at line <a href="#l00078">78</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### reservePreviousStackSlotForValue() {#adec63d991d7eb048d87fa3888099c848}

<MemberDefinition
  prototype={<>static void reservePreviousStackSlotForValue (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42; IncomingValue, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder)</>}
  labels = {["static"]}>
Try to find existing copies of the incoming values in stack slots used for statepoint spilling.

If we can find a spill slot for the incoming value, mark that slot as allocated, and reuse the same slot for this safepoint. This helps to avoid series of loads and stores that only serve to reshuffle values on the stack between calls.

Definition at line <a href="#l00268">268</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### spillIncomingStatepointValue() {#afb9b4b3ff97e290070f42849b51a13a5}

<MemberDefinition
  prototype={<>static std::tuple&lt; SDValue, SDValue, MachineMemOperand &#42; &gt; spillIncomingStatepointValue (<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Incoming, <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Chain, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder)</>}
  labels = {["static"]}>
Spill a value incoming to the statepoint.

It might be either part of vmstate or gcstate. In both cases unconditionally spill it on the stack unless it is a null constant. Return pair with first element being frame index containing saved value and second element with outgoing chain from the emitted store

Definition at line <a href="#l00376">376</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ac56a1eac8e1bf8bbe2530ba919e3542c}

<MemberDefinition
  prototype={<>STATISTIC (NumSlotsAllocatedForStatepoints, &quot;Number of stack <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp/#ad95860b0cf8da9d86f5683f19fafbb32">slots</a> allocated <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> statepoints&quot;)</>}>

Definition at line <a href="#l00058">58</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a190019db36961a89ee7ac54d621812f9}

<MemberDefinition
  prototype={<>STATISTIC (NumOfStatepoints, &quot;Number of statepoint <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuunifydivergentexitnodes-cpp/#aaa253dd3e56c37edd403113782c0ef94">nodes</a> encountered&quot;)</>}>

Definition at line <a href="#l00060">60</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a832142292a9ea54449b2930dd109a131}

<MemberDefinition
  prototype={<>STATISTIC (StatepointMaxSlotsRequired, &quot;Maximum number of stack <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp/#ad95860b0cf8da9d86f5683f19fafbb32">slots</a> required <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> a singe statepoint&quot;)</>}>

Definition at line <a href="#l00061">61</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### willLowerDirectly() {#a8300a0e0276d27757963efa800126f14}

<MemberDefinition
  prototype={<>static bool willLowerDirectly (<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Incoming)</>}
  labels = {["static"]}>
Return true if-and-only-if the given <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> can be lowered as either a constant argument or a stack reference.

The key point is that the value doesn&#39;t need to be spilled or tracked as a vreg use.

Definition at line <a href="#l00247">247</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### MaxRegistersForGCPointers {#adc011fee2f0e40238d54aa2a8820c728}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; MaxRegistersForGCPointers(&quot;max-registers-for-gc-values&quot;, cl::Hidden, cl::init(0), cl::desc(&quot;Max number of VRegs allowed to pass GC pointer meta args in&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00072">72</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### UseRegistersForDeoptValues {#ab9bf191372abad68cbfc02b4e33cebc6}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; UseRegistersForDeoptValues(&quot;use-registers-for-deopt-values&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Allow using registers for non pointer deopt args&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00064">64</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### UseRegistersForGCPointersInLandingPad {#a08e0d3f870d52149756ca3cec34ab6a0}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; UseRegistersForGCPointersInLandingPad(&quot;use-registers-for-gc-values-in-landing-pad&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Allow using registers for gc pointer in landing pad&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00068">68</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;statepoint-lowering&quot;</>}>

Definition at line <a href="#l00056">56</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- StatepointLowering.cpp - SDAGBuilder&#39;s statepoint code -------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This file includes support code use by SelectionDAGBuilder when lowering a</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// statepoint sequence in SelectionDAG IR.</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-h">StatepointLowering.h</a>&quot;</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/selectiondagbuilder-h">SelectionDAGBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h">llvm/ADT/SetVector.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallbitvector-h">llvm/ADT/SmallBitVector.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallset-h">llvm/ADT/SmallSet.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/functionloweringinfo-h">llvm/CodeGen/FunctionLoweringInfo.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/gcmetadata-h">llvm/CodeGen/GCMetadata.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/isdopcodes-h">llvm/CodeGen/ISDOpcodes.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineframeinfo-h">llvm/CodeGen/MachineFrameInfo.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h">llvm/CodeGen/MachineFunction.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinememoperand-h">llvm/CodeGen/MachineMemOperand.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/selectiondag-h">llvm/CodeGen/SelectionDAG.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/selectiondagnodes-h">llvm/CodeGen/SelectionDAGNodes.h</a>&quot;</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/stackmaps-h">llvm/CodeGen/StackMaps.h</a>&quot;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetlowering-h">llvm/CodeGen/TargetLowering.h</a>&quot;</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetopcodes-h">llvm/CodeGen/TargetOpcodes.h</a>&quot;</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegentypes/machinevaluetype-h">llvm/CodeGenTypes/MachineValueType.h</a>&quot;</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/callingconv-h">llvm/IR/CallingConv.h</a>&quot;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/gcstrategy-h">llvm/IR/GCStrategy.h</a>&quot;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/statepoint-h">llvm/IR/Statepoint.h</a>&quot;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h">llvm/Target/TargetMachine.h</a>&quot;</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetoptions-h">llvm/Target/TargetOptions.h</a>&quot;</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightPreprocessor">#include &lt;cstddef&gt;</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightPreprocessor">#include &lt;cstdint&gt;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightPreprocessor">#include &lt;iterator&gt;</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightPreprocessor">#include &lt;tuple&gt;</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE &quot;statepoint-lowering&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58" lineLink="#ac56a1eac8e1bf8bbe2530ba919e3542c"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSlotsAllocatedForStatepoints,</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Number of stack slots allocated for statepoints&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60" lineLink="#a190019db36961a89ee7ac54d621812f9"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumOfStatepoints, </span><span class="doxyHighlightStringLiteral">&quot;Number of statepoint nodes encountered&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61" lineLink="#a832142292a9ea54449b2930dd109a131"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(StatepointMaxSlotsRequired,</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Maximum number of stack slots required for a singe statepoint&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64" lineLink="#ab9bf191372abad68cbfc02b4e33cebc6"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#ab9bf191372abad68cbfc02b4e33cebc6">UseRegistersForDeoptValues</a>(</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;use-registers-for-deopt-values&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Allow using registers for non pointer deopt args&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68" lineLink="#a08e0d3f870d52149756ca3cec34ab6a0"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a08e0d3f870d52149756ca3cec34ab6a0">UseRegistersForGCPointersInLandingPad</a>(</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;use-registers-for-gc-values-in-landing-pad&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Allow using registers for gc pointer in landing pad&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72" lineLink="#adc011fee2f0e40238d54aa2a8820c728"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#adc011fee2f0e40238d54aa2a8820c728">MaxRegistersForGCPointers</a>(</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;max-registers-for-gc-values&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0),</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Max number of VRegs allowed to pass GC pointer meta args in&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76" lineLink="#ae5fbc6e1ce3fcbb7f185ed9e7beffec7"><span class="doxyHighlightKeyword">typedef</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord">FunctionLoweringInfo::StatepointRelocationRecord</a> <a href="#ae5fbc6e1ce3fcbb7f185ed9e7beffec7">RecordType</a>;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78" lineLink="#a720a77a05d768dabfa739d154c11ddfd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;SDValue&gt;</a>&amp; <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>,</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder, uint64&#95;t <a href="/docs/api/classes/llvm/value">Value</a>) &#123;</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdloc">SDLoc</a> L = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>();</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#abf892d1e00a3d79026c5ab518c187c45">getTargetConstant</a>(StackMaps::ConstantOp, L,</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlight">                                              MVT::i64));</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#abf892d1e00a3d79026c5ab518c187c45">getTargetConstant</a>(<a href="/docs/api/classes/llvm/value">Value</a>, L, MVT::i64));</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86" lineLink="/docs/api/classes/llvm/statepointloweringstate/#aeb4b5a7ad5a49f17f8a34890eb6efefe"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/statepointloweringstate/#aeb4b5a7ad5a49f17f8a34890eb6efefe">StatepointLoweringState::startNewStatepoint</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Consistency check</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PendingGCRelocateCalls.empty() &amp;&amp;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Trying to visit statepoint before finished processing previous one&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlight">  Locations.clear();</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">  NextSlotToAllocate = 0;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Need to resize this on each safepoint - we need the two to stay in sync and</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the clear patterns of a SelectionDAGBuilder have no relation to</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FunctionLoweringInfo.  Also need to ensure used bits get cleared.</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">  AllocatedStackSlots.clear();</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight">  AllocatedStackSlots.resize(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a9691f14813e0540e6a1c90cfdad39df3">StatepointStackSlots</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99" lineLink="/docs/api/classes/llvm/statepointloweringstate/#a2651c31aeb22030422cc4e9ef6c21e22"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/statepointloweringstate/#a2651c31aeb22030422cc4e9ef6c21e22">StatepointLoweringState::clear</a>() &#123;</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">  Locations.clear();</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">  AllocatedStackSlots.clear();</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PendingGCRelocateCalls.empty() &amp;&amp;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;cleared before statepoint sequence completed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/sdvalue">SDValue</a></span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107" lineLink="/docs/api/classes/llvm/statepointloweringstate/#a4841be2489ba10321338a1874b53f249"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/statepointloweringstate/#a4841be2489ba10321338a1874b53f249">StatepointLoweringState::allocateStackSlot</a>(<a href="/docs/api/structs/llvm/evt">EVT</a> <a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>,</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlight">  NumSlotsAllocatedForStatepoints++;</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#ac64ec73b0617befef1fb2eae78d12b5f">getMachineFunction</a>().<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SpillSize = <a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>.getStoreSize();</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((SpillSize &#42; 8) ==</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlight">             (-8u &amp; (7 + <a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>.getSizeInBits())) &amp;&amp; </span><span class="doxyHighlightComment">// Round up modulo 8</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Size not in bytes?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First look for a previously created stack slot which is not in</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// use (accounting for the fact arbitrary slots may already be</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reserved), or to create a new stack slot and use it.</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">size&#95;t</span><span class="doxyHighlight"> NumSlots = AllocatedStackSlots.size();</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NextSlotToAllocate &lt;= NumSlots &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Broken invariant&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AllocatedStackSlots.size() ==</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">         Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a9691f14813e0540e6a1c90cfdad39df3">StatepointStackSlots</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &amp;&amp;</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Broken invariant&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (; NextSlotToAllocate &lt; NumSlots; NextSlotToAllocate++) &#123;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!AllocatedStackSlots.test(NextSlotToAllocate)) &#123;</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a9691f14813e0540e6a1c90cfdad39df3">StatepointStackSlots</a>&#91;NextSlotToAllocate&#93;;</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a9284fd53296d2a2f8ae654d000971000">getObjectSize</a>(FI) == SpillSize) &#123;</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">        AllocatedStackSlots.set(NextSlotToAllocate);</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// TODO: Is ValueType the right thing to use here?</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#acb59cbd8f4a8c1cf820b2b540aebdac1">getFrameIndex</a>(FI, <a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>);</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Couldn&#39;t find a free slot, so create a new one:</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> SpillSlot = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#ae83b3d8e9a944b5d818e80524a5003e2">CreateStackTemporary</a>(<a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>);</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> FI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FrameIndexSDNode&gt;</a>(SpillSlot)-&gt;getIndex();</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">  MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a477686b0d65454f32799cb86f406104c">markAsStatepointSpillSlotObjectIndex</a>(FI);</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a9691f14813e0540e6a1c90cfdad39df3">StatepointStackSlots</a>.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FI);</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">  AllocatedStackSlots.resize(AllocatedStackSlots.size()+1, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AllocatedStackSlots.size() ==</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlight">         Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a9691f14813e0540e6a1c90cfdad39df3">StatepointStackSlots</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &amp;&amp;</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Broken invariant&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">  StatepointMaxSlotsRequired.updateMax(</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a9691f14813e0540e6a1c90cfdad39df3">StatepointStackSlots</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SpillSlot;</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlightComment">/// Utility function for reservePreviousStackSlotForValue. Tries to find</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlightComment">/// stack slot index to which we have spilled value for previous statepoints.</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlightComment">/// LookUpDepth specifies maximum DFS depth this function is allowed to look.</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160" lineLink="#a6ac2c0f0b7439c31332c78cd1ca5c4fe"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::optional&lt;int&gt; <a href="#a6ac2c0f0b7439c31332c78cd1ca5c4fe">findPreviousSpillSlot</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val,</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder,</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><span class="doxyHighlight">                                                </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> LookUpDepth) &#123;</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Can not look any further - give up now</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LookUpDepth &lt;= 0)</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Spill location is known for gc relocates</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Relocate = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GCRelocateInst&gt;</a>(Val)) &#123;</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Statepoint = Relocate-&gt;getStatepoint();</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GCStatepointInst&gt;</a>(Statepoint) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Statepoint)) &amp;&amp;</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;GetStatepoint must return one of two types&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Statepoint))</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;RelocationMap = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a460bac4fe51e0dcd08f1fb328005926d">StatepointRelocationMaps</a></span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">                                    &#91;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GCStatepointInst&gt;</a>(Statepoint)&#93;;</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = RelocationMap.find(Relocate);</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It == RelocationMap.end())</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/classes/llvm/record">Record</a> = It-&gt;second;</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/record">Record</a>.type != <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2ca4e2303faf0f163fb7a4af33f778884e8">RecordType::Spill</a>)</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/record">Record</a>.payload.FI;</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look through bitcast instructions.</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &#42;Cast = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(Val))</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a6ac2c0f0b7439c31332c78cd1ca5c4fe">findPreviousSpillSlot</a>(Cast-&gt;getOperand(0), Builder, LookUpDepth - 1);</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look through phi nodes</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All incoming values should have same known stack slot, otherwise result</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is unknown.</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Val)) &#123;</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">    std::optional&lt;int&gt; MergedResult;</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;IncomingValue : Phi-&gt;incoming&#95;values()) &#123;</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">      std::optional&lt;int&gt; SpillSlot =</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><span class="doxyHighlight">          <a href="#a6ac2c0f0b7439c31332c78cd1ca5c4fe">findPreviousSpillSlot</a>(IncomingValue, Builder, LookUpDepth - 1);</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SpillSlot)</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MergedResult &amp;&amp; &#42;MergedResult != &#42;SpillSlot)</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">      MergedResult = SpillSlot;</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MergedResult;</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: We can do better for PHI nodes. In cases like this:</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ptr = phi(relocated&#95;pointer, not&#95;relocated&#95;pointer)</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   statepoint(ptr)</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We will return that stack slot for ptr is unknown. And later we might</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// assign different stack slots for ptr and relocated&#95;pointer. This limits</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// llvm&#39;s ability to remove redundant stores.</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Unfortunately it&#39;s hard to accomplish in current infrastructure.</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We use this function to eliminate spill store completely, while</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in example we still need to emit store, but instead of any location</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we need to use special &quot;preferred&quot; location.</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: handle simple updates.  If a value is modified and the original</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// value is no longer live, it would be nice to put the modified value in the</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// same slot.  This allows folding of the memory accesses for some</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions types (like an increment).</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   statepoint (i)</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   i1 = i+1</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   statepoint (i1)</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// However we need to be careful for cases like this:</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   statepoint(i)</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   i1 = i+1</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   statepoint(i, i1)</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Here we want to reserve spill slot for &#39;i&#39;, but not for &#39;i+1&#39;. If we just</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// put handling of simple modifications in this function like it&#39;s done</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for bitcasts we might end up reserving i&#39;s slot for &#39;i+1&#39; because order in</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which we visit values is unspecified.</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t know any information about this instruction</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlightComment">/// Return true if-and-only-if the given SDValue can be lowered as either a</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlightComment">/// constant argument or a stack reference.  The key point is that the value</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlightComment">/// doesn&#39;t need to be spilled or tracked as a vreg use.</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247" lineLink="#a8300a0e0276d27757963efa800126f14"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a8300a0e0276d27757963efa800126f14">willLowerDirectly</a>(<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/structs/llvm/incoming">Incoming</a>) &#123;</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We are making an unchecked assumption that the frame size &lt;= 2^16 as that</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is the largest offset which can be encoded in the stackmap format.</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FrameIndexSDNode&gt;</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>))</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The largest constant describeable in the StackMap format is 64 bits.</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Potential Optimization:  Constants values are sign extended by consumer,</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and thus there are many constants of static type &gt; 64 bits whose value</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// happens to be sext(Con64) and could thus be lowered directly.</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/incoming">Incoming</a>.getValueType().getSizeInBits() &gt; 64)</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a2e392c596f41ac56b67f31c2e4b33dd1">isIntOrFPConstant</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>) || <a href="/docs/api/structs/llvm/incoming">Incoming</a>.isUndef();</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlightComment">/// Try to find existing copies of the incoming values in stack slots used for</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlightComment">/// statepoint spilling.  If we can find a spill slot for the incoming value,</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlightComment">/// mark that slot as allocated, and reuse the same slot for this safepoint.</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlightComment">/// This helps to avoid series of loads and stores that only serve to reshuffle</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlightComment">/// values on the stack between calls.</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268" lineLink="#adec63d991d7eb048d87fa3888099c848"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#adec63d991d7eb048d87fa3888099c848">reservePreviousStackSlotForValue</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;IncomingValue,</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/structs/llvm/incoming">Incoming</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(IncomingValue);</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we won&#39;t spill this, we don&#39;t need to check for previously allocated</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stack slots.</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a8300a0e0276d27757963efa800126f14">willLowerDirectly</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>))</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> OldLocation = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.<a href="/docs/api/classes/llvm/statepointloweringstate/#a2e2d4007205a6b163daaf00e3aba04bd">getLocation</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldLocation.<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>())</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Duplicates in input</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> LookUpDepth = 6;</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">  std::optional&lt;int&gt; Index =</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">      <a href="#a6ac2c0f0b7439c31332c78cd1ca5c4fe">findPreviousSpillSlot</a>(IncomingValue, Builder, LookUpDepth);</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Index)</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;StatepointSlots = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a9691f14813e0540e6a1c90cfdad39df3">StatepointStackSlots</a>;</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SlotIt = <a href="/docs/api/namespaces/llvm/#a086e9fbdb06276db7753101a08a63adf">find</a>(StatepointSlots, &#42;Index);</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SlotIt != StatepointSlots.end() &amp;&amp;</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Value spilled to the unknown stack slot&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is one of our dedicated lowering slots</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = std::distance(StatepointSlots.begin(), SlotIt);</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.<a href="/docs/api/classes/llvm/statepointloweringstate/#a6cdb26e5268cc05eb7f9726a140f1ae2">isStackSlotAllocated</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)) &#123;</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// stack slot already assigned to someone else, can&#39;t use it!</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: currently we reserve space for gc arguments after doing</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// normal allocation for deopt arguments.  We should reserve for</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &#95;all&#95; deopt and gc arguments, then start allocating.  This</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// will prevent some moves being inserted when vm state changes,</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// but gc state doesn&#39;t between two calls.</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reserve this stack slot</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.<a href="/docs/api/classes/llvm/statepointloweringstate/#af93bbb466651e3e6abdf9e35c0a34b30">reserveStackSlot</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Cache this slot so we find it when going through the normal</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// assignment loop.</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/namespaces/llvm/loc">Loc</a> =</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#a6ececde40ed933c2dfb5af16cb002529">getTargetFrameIndex</a>(&#42;Index, Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>());</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.<a href="/docs/api/classes/llvm/statepointloweringstate/#a83f9edf0427d9c6d437318242326e331">setLocation</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>, <a href="/docs/api/namespaces/llvm/loc">Loc</a>);</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlightComment">/// Extract call from statepoint, lower it and return pointer to the</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlightComment">/// call node. Also update NodeMap so that getValue(statepoint) will</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlightComment">/// reference lowered call result</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318" lineLink="#af8947d9c8165e82094241d319758e0c5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::pair&lt;SDValue, SDNode &#42;&gt; <a href="#af8947d9c8165e82094241d319758e0c5">lowerCallFromStatepointLoweringInfo</a>(</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/selectiondagbuilder/statepointloweringinfo">SelectionDAGBuilder::StatepointLoweringInfo</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>,</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> ReturnValue, CallEndVal;</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">  std::tie(ReturnValue, CallEndVal) =</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ab29b69c993fbb9a4b9d28c3600df005d">lowerInvokable</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.CLI, <a href="/docs/api/namespaces/llvm/si">SI</a>.EHPadBB);</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdnode">SDNode</a> &#42;CallEnd = CallEndVal.<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>();</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get a call instruction from the call sequence chain.  Tail calls are not</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allowed.  The following code is essentially reverse engineering X86&#39;s</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LowerCallTo.</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We are expecting DAG to have the following form:</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ch = eh&#95;label (only in case of invoke statepoint)</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ch, glue = callseq&#95;start ch</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ch, glue = X86::Call ch, glue</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ch, glue = callseq&#95;end ch, glue</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   get&#95;return&#95;value ch, glue</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// get&#95;return&#95;value can either be a sequence of CopyFromReg instructions</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to grab the return value from the return register(s), or it can be a LOAD</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to load a value returned by reference via a stack slot.</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a23f2f5947fc429aff1270651c6d019ea">getOpcode</a>() == ISD::EH&#95;LABEL)</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><span class="doxyHighlight">    CallEnd = CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a8388f666d6e735f35837ad03ed1f7a7a">getOperand</a>(0).<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>();</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasDef = !<a href="/docs/api/namespaces/llvm/si">SI</a>.CLI.RetTy-&gt;isVoidTy();</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasDef) &#123;</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a23f2f5947fc429aff1270651c6d019ea">getOpcode</a>() == ISD::LOAD)</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">      CallEnd = CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a8388f666d6e735f35837ad03ed1f7a7a">getOperand</a>(0).<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>();</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a23f2f5947fc429aff1270651c6d019ea">getOpcode</a>() == <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a84c47705bcf7271413738ae8bf3871e6">ISD::CopyFromReg</a>)</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">        CallEnd = CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a8388f666d6e735f35837ad03ed1f7a7a">getOperand</a>(0).<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>();</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a23f2f5947fc429aff1270651c6d019ea">getOpcode</a>() == ISD::CALLSEQ&#95;END &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;expected!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::make&#95;pair(ReturnValue, CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a8388f666d6e735f35837ad03ed1f7a7a">getOperand</a>(0).<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>());</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358" lineLink="#aec1de11231135901271d92c7d90dae60"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a>&#42; <a href="#aec1de11231135901271d92c7d90dae60">getMachineMemOperand</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/frameindexsdnode">FrameIndexSDNode</a> &amp;FI) &#123;</span></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PtrInfo = <a href="/docs/api/structs/llvm/machinepointerinfo/#ad8ce1aee13dbdcc05d20284a30e83170">MachinePointerInfo::getFixedStack</a>(MF, FI.<a href="/docs/api/classes/llvm/frameindexsdnode/#a1cf719b8c945859e29131c892774b21c">getIndex</a>());</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MMOFlags = <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2ddaed357b1367bc90a56fefa4d1b0e17374">MachineMemOperand::MOStore</a> |</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2dda7d12be6206e5b0026c71bbcd5cb76494">MachineMemOperand::MOLoad</a> | <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2dda796891d6ca349b671fce24b6d01d77a8">MachineMemOperand::MOVolatile</a>;</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MF.<a href="/docs/api/classes/llvm/machinefunction/#a453ae3052b4f5b14cb4c184243ce5027">getMachineMemOperand</a>(PtrInfo, MMOFlags,</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">                                 MFI.getObjectSize(FI.<a href="/docs/api/classes/llvm/frameindexsdnode/#a1cf719b8c945859e29131c892774b21c">getIndex</a>()),</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">                                 MFI.getObjectAlign(FI.<a href="/docs/api/classes/llvm/frameindexsdnode/#a1cf719b8c945859e29131c892774b21c">getIndex</a>()));</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlightComment">/// Spill a value incoming to the statepoint. It might be either part of</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlightComment">/// vmstate</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlightComment">/// or gcstate. In both cases unconditionally spill it on the stack unless it</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlightComment">/// is a null constant. Return pair with first element being frame index</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlightComment">/// containing saved value and second element with outgoing chain from the</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlightComment">/// emitted store</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::tuple&lt;SDValue, SDValue, MachineMemOperand&#42;&gt;</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376" lineLink="#afb9b4b3ff97e290070f42849b51a13a5"><span class="doxyHighlight"><a href="#afb9b4b3ff97e290070f42849b51a13a5">spillIncomingStatepointValue</a>(<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/structs/llvm/incoming">Incoming</a>, <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Chain,</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/namespaces/llvm/loc">Loc</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.<a href="/docs/api/classes/llvm/statepointloweringstate/#a2e2d4007205a6b163daaf00e3aba04bd">getLocation</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a>&#42; MMO = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit new store if we didn&#39;t do it for this ptr before</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/loc">Loc</a>.getNode()) &#123;</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/loc">Loc</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.<a href="/docs/api/classes/llvm/statepointloweringstate/#a4841be2489ba10321338a1874b53f249">allocateStackSlot</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>.getValueType(),</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">                                                       Builder);</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Index = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FrameIndexSDNode&gt;</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>)-&gt;getIndex();</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We use TargetFrameIndex so that isel will not select it into LEA</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/loc">Loc</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#a6ececde40ed933c2dfb5af16cb002529">getTargetFrameIndex</a>(Index, Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>());</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Right now we always allocate spill slots that are of the same</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// size as the value we&#39;re about to spill (the size of spillee can</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// vary since we spill vectors of pointers too).  At some point we</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// can consider allowing spills of smaller values to larger slots</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (i.e. change the &#39;==&#39; in the assert below to a &#39;&gt;=&#39;).</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#ac64ec73b0617befef1fb2eae78d12b5f">getMachineFunction</a>().<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a9284fd53296d2a2f8ae654d000971000">getObjectSize</a>(Index) &#42; 8) ==</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">               (-8 &amp; (7 + </span><span class="doxyHighlightComment">// Round up modulo 8</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">                      (int64&#95;t)<a href="/docs/api/structs/llvm/incoming">Incoming</a>.getValueSizeInBits())) &amp;&amp;</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Bad spill:  stack slot does not match!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note: Using the alignment of the spill slot (rather than the abi or</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// preferred alignment) is required for correctness when dealing with spill</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// slots with preferred alignments larger than frame alignment..</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MF = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#ac64ec73b0617befef1fb2eae78d12b5f">getMachineFunction</a>();</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PtrInfo = <a href="/docs/api/structs/llvm/machinepointerinfo/#ad8ce1aee13dbdcc05d20284a30e83170">MachinePointerInfo::getFixedStack</a>(MF, Index);</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;StoreMMO = MF.getMachineMemOperand(</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><span class="doxyHighlight">        PtrInfo, <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2ddaed357b1367bc90a56fefa4d1b0e17374">MachineMemOperand::MOStore</a>, MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a9284fd53296d2a2f8ae654d000971000">getObjectSize</a>(Index),</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">        MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a8320a54de0a273478de910ac3795058b">getObjectAlign</a>(Index));</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">    Chain = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#a89ed6b26ee4f62aec32468329f828a2f">getStore</a>(Chain, Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), <a href="/docs/api/structs/llvm/incoming">Incoming</a>, <a href="/docs/api/namespaces/llvm/loc">Loc</a>,</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">                                 StoreMMO);</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">    MMO = <a href="#aec1de11231135901271d92c7d90dae60">getMachineMemOperand</a>(MF, &#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FrameIndexSDNode&gt;</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>));</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.<a href="/docs/api/classes/llvm/statepointloweringstate/#a83f9edf0427d9c6d437318242326e331">setLocation</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>, <a href="/docs/api/namespaces/llvm/loc">Loc</a>);</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>.getNode());</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::make&#95;tuple(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, Chain, MMO);</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlightComment">/// Lower a single value incoming to a statepoint node.  This value can be</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlightComment">/// either a deopt value or a gc value, the handling is the same.  We special</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlightComment">/// case constants and allocas, then fall back to spilling if required.</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424" lineLink="#a1692829d8158767fe5ac1809c90a77a3"><span class="doxyHighlight"><a href="#a1692829d8158767fe5ac1809c90a77a3">lowerIncomingStatepointValue</a>(<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/structs/llvm/incoming">Incoming</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> RequireSpillSlot,</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;SDValue&gt;</a> &amp;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>,</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineMemOperand &#42;&gt;</a> &amp;MemRefs,</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">  </span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a8300a0e0276d27757963efa800126f14">willLowerDirectly</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>)) &#123;</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/frameindexsdnode">FrameIndexSDNode</a> &#42;FI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FrameIndexSDNode&gt;</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>)) &#123;</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This handles allocas as arguments to the statepoint (this is only</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// really meaningful for a deopt value.  For GC, we&#39;d be trying to</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// relocate the address of the alloca itself?)</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>.getValueType() == Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Incoming value is a frame index!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#a6ececde40ed933c2dfb5af16cb002529">getTargetFrameIndex</a>(FI-&gt;getIndex(),</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">                                                    Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>()));</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MF = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#ac64ec73b0617befef1fb2eae78d12b5f">getMachineFunction</a>();</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MMO = <a href="#aec1de11231135901271d92c7d90dae60">getMachineMemOperand</a>(MF, &#42;FI);</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">      MemRefs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MMO);</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>.getValueType().getSizeInBits() &lt;= 64);</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">    </span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/incoming">Incoming</a>.isUndef()) &#123;</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Put an easily recognized constant that&#39;s unlikely to be a valid</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// value so that uses of undef by the consumer of the stackmap is</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// easily recognized. This is legal since the compiler is always</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// allowed to chose an arbitrary value for undef.</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">      <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, Builder, 0xFEFEFEFE);</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the original value was a constant, make sure it gets recorded as</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// such in the stackmap.  This is required so that the consumer can</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// parse any internal format to the deopt state.  It also handles null</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pointers and other constant pointers in GC states.</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantsdnode">ConstantSDNode</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantSDNode&gt;</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>)) &#123;</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">      <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, Builder, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getSExtValue());</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/constantfpsdnode">ConstantFPSDNode</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantFPSDNode&gt;</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>)) &#123;</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">      <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, Builder,</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlight">                           <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getValueAPF().bitcastToAPInt().getZExtValue());</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;unhandled direct lowering case&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RequireSpillSlot) &#123;</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this value is live in (not live-on-return, or live-through), we can</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// treat it the same way patchpoint treats it&#39;s &quot;live in&quot; values.  We&#39;ll</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// end up folding some of these into stack references, but they&#39;ll be</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// handled by the register allocator.  Note that we do not have the notion</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of a late use so these values might be placed in registers which are</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// clobbered by the call.  This is fine for live-in. For live-through</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// fix-up pass should be executed to force spilling of such registers.</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise, locate a spill slot and explicitly spill it so it can be</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// found by the runtime later.  Note: We know all of these spills are</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// independent, but don&#39;t bother to exploit that chain wise.  DAGCombine</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// will happily do so as needed, so doing it here would be a small compile</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// time win at most. </span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Chain = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#aa3e946c1fc678a70e849244389bd929a">getRoot</a>();</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Res = <a href="#afb9b4b3ff97e290070f42849b51a13a5">spillIncomingStatepointValue</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>, Chain, Builder);</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(std::get&lt;0&gt;(Res));</span></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MMO = std::get&lt;2&gt;(Res))</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlight">      MemRefs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MMO);</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">    Chain = std::get&lt;1&gt;(Res);</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#ae0fc3f54d06d2230bf93a19d45f51706">setRoot</a>(Chain);</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlightComment">/// Return true if value V represents the GC value. The behavior is conservative</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlightComment">/// in case it is not sure that value is not GC the function returns true.</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502" lineLink="#a720af7e7f23150174952da03d216341a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a720af7e7f23150174952da03d216341a">isGCValue</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Ty = V-&gt;getType();</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Ty-&gt;isPtrOrPtrVectorTy())</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;GFI = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a9b4db8b8082660004fda0c282da0ff0a">GFI</a>)</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsManaged = GFI-&gt;getStrategy().isGCManagedPointer(Ty))</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;IsManaged;</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// conservative</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlightComment">/// Lower deopt state and gc pointer arguments of the statepoint.  The actual</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlightComment">/// lowering is described in lowerIncomingStatepointValue.  This function is</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlightComment">/// responsible for lowering everything in the right position and playing some</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlightComment">/// tricks to avoid redundant stack manipulation where possible.  On</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlightComment">/// completion, &#39;Ops&#39; will contain ready to use operands for machine code</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlightComment">/// statepoint. The chain nodes will have already been created and the DAG root</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlightComment">/// will be set to the last value spilled (if any were).</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520" lineLink="#a9029ef3db44eac67782fd8ccb7796a0c"><span class="doxyHighlight"><a href="#a9029ef3db44eac67782fd8ccb7796a0c">lowerStatepointMetaArgs</a>(<a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;SDValue&gt;</a> &amp;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>,</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineMemOperand &#42;&gt;</a> &amp;MemRefs,</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;SDValue&gt;</a> &amp;GCPtrs,</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;SDValue, int&gt;</a> &amp;LowerAsVReg,</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">                        <a href="/docs/api/structs/llvm/selectiondagbuilder/statepointloweringinfo">SelectionDAGBuilder::StatepointLoweringInfo</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>,</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlight">                        <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Lower the deopt and gc arguments for this statepoint.  Layout will be:</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// deopt argument length, deopt arguments.., gc arguments...</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Figure out what lowering strategy we&#39;re going to use for each part</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note: It is conservatively correct to lower both &quot;live-in&quot; and &quot;live-out&quot;</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as &quot;live-through&quot;. A &quot;live-through&quot; variable is one which is &quot;live-in&quot;,</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &quot;live-out&quot;, and live throughout the lifetime of the call (i.e. we can find</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it from any PC within the transitive callee of the statepoint).  In</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// particular, if the callee spills callee preserved registers we may not</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be able to find a value placed in that register during the call.  This is</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// fine for live-out, but not for live-through.  If we were willing to make</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// assumptions about the code generator producing the callee, we could</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// potentially allow live-through values in callee saved registers.</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LiveInDeopt =</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointFlags &amp; (uint64&#95;t)<a href="/docs/api/namespaces/llvm/#abba0f0474eb4e32d1ed7b6dfdb0d5140a8cf633e3cd4e8b21a16304c58495bfbc">StatepointFlags::DeoptLiveIn</a>;</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Decide which deriver pointers will go on VRegs</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxVRegPtrs = <a href="#adc011fee2f0e40238d54aa2a8820c728">MaxRegistersForGCPointers</a>.getValue();</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Pointers used on exceptional path of invoke statepoint.</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We cannot assing them to VRegs.</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;SDValue, 8&gt;</a> LPadPointers;</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a08e0d3f870d52149756ca3cec34ab6a0">UseRegistersForGCPointersInLandingPad</a>)</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;StInvoke =</span></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;InvokeInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointInstr)) &#123;</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/landingpadinst">LandingPadInst</a> &#42;LPI = StInvoke-&gt;getLandingPadInst();</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Relocate : <a href="/docs/api/namespaces/llvm/si">SI</a>.GCRelocates)</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Relocate-&gt;getOperand(0) == LPI) &#123;</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">          LPadPointers.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(Relocate-&gt;getBasePtr()));</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">          LPadPointers.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(Relocate-&gt;getDerivedPtr()));</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Deciding how to lower GC Pointers:\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// List of unique lowered GC Pointer values.</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;SDValue, 16&gt;</a> LoweredGCPtrs;</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Map lowered GC Pointer value to the index in above vector</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;SDValue, unsigned&gt;</a> GCPtrIndexMap;</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> CurNumVRegs = 0;</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> canPassGCPtrOnVReg = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> SD) &#123;</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SD.getValueType().isVector())</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LPadPointers.<a href="/docs/api/classes/llvm/smallset/#a2a98f19750ba941ce791b75ca6d77e48">count</a>(SD))</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="#a8300a0e0276d27757963efa800126f14">willLowerDirectly</a>(SD);</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> processGCPtr = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> PtrSD = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V);</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LoweredGCPtrs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(PtrSD))</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">; </span><span class="doxyHighlightComment">// skip duplicates</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlight">    GCPtrIndexMap&#91;PtrSD&#93; = LoweredGCPtrs.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>() - 1;</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(PtrSD) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;must not have been seen&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a3d95cc2d359b8d9ed5bd9504b44930b5">size</a>() == MaxVRegPtrs)</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V-&gt;getType()-&gt;isVectorTy() == PtrSD.<a href="/docs/api/classes/llvm/sdvalue/#a6b2b8ca5b0fdf6484247d5ae74deb9ff">getValueType</a>().<a href="/docs/api/structs/llvm/evt/#aa54976197fff266f4143beb44fc9764c">isVector</a>() &amp;&amp;</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;IR and SD types disagree&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!canPassGCPtrOnVReg(PtrSD)) &#123;</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;direct/spill &quot;</span><span class="doxyHighlight">; PtrSD.<a href="/docs/api/classes/llvm/sdvalue/#a68cdc2666693dffb9173a9dffee11ab8">dump</a>(&amp;Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>));</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;vreg &quot;</span><span class="doxyHighlight">; PtrSD.<a href="/docs/api/classes/llvm/sdvalue/#a68cdc2666693dffb9173a9dffee11ab8">dump</a>(&amp;Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>));</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">    LowerAsVReg&#91;PtrSD&#93; = CurNumVRegs++;</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Process derived pointers first to give them more chance to go on VReg.</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs)</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">    processGCPtr(V);</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.Bases)</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">    processGCPtr(V);</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a3d95cc2d359b8d9ed5bd9504b44930b5">size</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; pointers will go in vregs\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> requireSpillSlot = &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#a4c20c587f89ae2926f9e8a99093e8419">getTargetLoweringInfo</a>().<a href="/docs/api/classes/llvm/targetloweringbase/#a80b305b278aa0e04f80312e15b2b6d54">isTypeLegal</a>(</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">             Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V).<a href="/docs/api/classes/llvm/sdvalue/#a6b2b8ca5b0fdf6484247d5ae74deb9ff">getValueType</a>()))</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a720af7e7f23150174952da03d216341a">isGCValue</a>(V, Builder))</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V));</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !(LiveInDeopt || <a href="#ab9bf191372abad68cbfc02b4e33cebc6">UseRegistersForDeoptValues</a>);</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Before we actually start lowering (and allocating spill slots for values),</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reserve any stack slots which we judge to be profitable to reuse for a</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// particular value.  This is purely an optimization over the code below and</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// doesn&#39;t change semantics at all.  It is important for performance that we</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reserve slots for both deopt and gc values before lowering either.</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.DeoptState) &#123;</span></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (requireSpillSlot(V))</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">      <a href="#adec63d991d7eb048d87fa3888099c848">reservePreviousStackSlotForValue</a>(V, Builder);</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs) &#123;</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> SDV = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V);</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SDV))</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">      <a href="#adec63d991d7eb048d87fa3888099c848">reservePreviousStackSlotForValue</a>(V, Builder);</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.Bases) &#123;</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> SDV = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V);</span></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SDV))</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">      <a href="#adec63d991d7eb048d87fa3888099c848">reservePreviousStackSlotForValue</a>(V, Builder);</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First, prefix the list with the number of unique values to be</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// lowered.  Note that this is the number of &#42;Values&#42; not the</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// number of SDValues required to lower them.</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> NumVMSArgs = <a href="/docs/api/namespaces/llvm/si">SI</a>.DeoptState.size();</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">  <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, Builder, NumVMSArgs);</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The vm state arguments are lowered in an opaque manner.  We do not know</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// what type of values are contained within.</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Lowering deopt state\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.DeoptState) &#123;</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/structs/llvm/incoming">Incoming</a>;</span></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If this is a function argument at a static frame index, generate it as</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the frame index.</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;Arg = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Argument&gt;</a>(V)) &#123;</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> FI = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a4adbd2ebdab9c844ce0443c43c3ee16d">getArgumentFrameIndex</a>(Arg);</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FI != INT&#95;MAX)</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">        <a href="/docs/api/structs/llvm/incoming">Incoming</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#acb59cbd8f4a8c1cf820b2b540aebdac1">getFrameIndex</a>(FI, Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>());</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/llvm/incoming">Incoming</a>.getNode())</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/incoming">Incoming</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V);</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Value &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;V</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; requireSpillSlot = &quot;</span><span class="doxyHighlight"> &lt;&lt; requireSpillSlot(V) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">    <a href="#a1692829d8158767fe5ac1809c90a77a3">lowerIncomingStatepointValue</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>, requireSpillSlot(V), <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, MemRefs,</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">                                 Builder);</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Finally, go ahead and lower all the gc arguments.</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">  <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, Builder, LoweredGCPtrs.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>());</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> SDV : LoweredGCPtrs)</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">    <a href="#a1692829d8158767fe5ac1809c90a77a3">lowerIncomingStatepointValue</a>(SDV, !LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SDV), <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, MemRefs,</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">                                 Builder);</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Copy to out vector. LoweredGCPtrs will be empty after this point.</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">  GCPtrs = LoweredGCPtrs.<a href="/docs/api/classes/llvm/setvector/#a7c36580f905b274ca0a1ade46ba06ae0">takeVector</a>();</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there are any explicit spill slots passed to the statepoint, record</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them, but otherwise do not do anything special.  These are user provided</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allocas and give control over placement to the consumer.  In this case,</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it is the contents of the slot which may get updated, not the pointer to</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the alloca</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SDValue, 4&gt;</a> Allocas;</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.GCLives) &#123;</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/structs/llvm/incoming">Incoming</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V);</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/frameindexsdnode">FrameIndexSDNode</a> &#42;FI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FrameIndexSDNode&gt;</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>)) &#123;</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This handles allocas as arguments to the statepoint</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>.getValueType() == Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Incoming value is a frame index!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlight">      Allocas.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#a6ececde40ed933c2dfb5af16cb002529">getTargetFrameIndex</a>(</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">          FI-&gt;getIndex(), Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>()));</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MF = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#ac64ec73b0617befef1fb2eae78d12b5f">getMachineFunction</a>();</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MMO = <a href="#aec1de11231135901271d92c7d90dae60">getMachineMemOperand</a>(MF, &#42;FI);</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">      MemRefs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MMO);</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">  <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, Builder, Allocas.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.append(Allocas.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Allocas.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now construct GC base/derived map;</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">  <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, Builder, <a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs.size());</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdloc">SDLoc</a> L = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>();</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i &lt; <a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs.size(); ++i) &#123;</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.Bases&#91;i&#93;);</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GCPtrIndexMap.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;base not found in index map&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#abf892d1e00a3d79026c5ab518c187c45">getTargetConstant</a>(GCPtrIndexMap&#91;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>&#93;, L, MVT::i64));</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Derived = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs&#91;i&#93;);</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GCPtrIndexMap.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(Derived) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;derived not found in index map&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">        Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#abf892d1e00a3d79026c5ab518c187c45">getTargetConstant</a>(GCPtrIndexMap&#91;Derived&#93;, L, MVT::i64));</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707" lineLink="/docs/api/classes/llvm/selectiondagbuilder/#afe97e2bc5bd74272ca1b54da1fb30e06"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/classes/llvm/selectiondagbuilder/#afe97e2bc5bd74272ca1b54da1fb30e06">SelectionDAGBuilder::LowerAsSTATEPOINT</a>(</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/selectiondagbuilder/statepointloweringinfo">SelectionDAGBuilder::StatepointLoweringInfo</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The basic scheme here is that information about both the original call and</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the safepoint is encoded in the CallInst.  We create a temporary call and</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// lower it, then reverse engineer the calling sequence.</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">  NumOfStatepoints++;</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clear state</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.startNewStatepoint(&#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.Bases.size() == <a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs.size() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Pointer without base!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/classes/llvm/selectiondagbuilder/#a9b4db8b8082660004fda0c282da0ff0a">GFI</a> || <a href="/docs/api/namespaces/llvm/si">SI</a>.Bases.empty()) &amp;&amp;</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;No gc specified, so cannot relocate pointers!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointInstr) <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Lowering statepoint &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointInstr &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/reloc">Reloc</a> : <a href="/docs/api/namespaces/llvm/si">SI</a>.GCRelocates)</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/reloc">Reloc</a>-&gt;getParent() == <a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointInstr-&gt;getParent())</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.scheduleRelocCall(&#42;<a href="/docs/api/namespaces/llvm/reloc">Reloc</a>);</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Lower statepoint vmstate and gcstate arguments</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All lowered meta args.</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SDValue, 10&gt;</a> LoweredMetaArgs;</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Lowered GC pointers (subset of above).</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SDValue, 16&gt;</a> LoweredGCArgs;</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineMemOperand&#42;, 16&gt;</a> MemRefs;</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Maps derived pointer SDValue to statepoint result of relocated pointer.</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;SDValue, int&gt;</a> LowerAsVReg;</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><span class="doxyHighlight">  <a href="#a9029ef3db44eac67782fd8ccb7796a0c">lowerStatepointMetaArgs</a>(LoweredMetaArgs, MemRefs, LoweredGCArgs, LowerAsVReg,</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">                          <a href="/docs/api/namespaces/llvm/si">SI</a>, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now that we&#39;ve emitted the spills, we need to update the root so that the</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// call sequence is ordered correctly.</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.CLI.setChain(<a href="/docs/api/classes/llvm/selectiondagbuilder/#aa3e946c1fc678a70e849244389bd929a">getRoot</a>());</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get call node, we will replace it later with statepoint</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> ReturnVal;</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdnode">SDNode</a> &#42;CallNode;</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">  std::tie(ReturnVal, CallNode) = <a href="#af8947d9c8165e82094241d319758e0c5">lowerCallFromStatepointLoweringInfo</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Construct the actual GC&#95;TRANSITION&#95;START, STATEPOINT, and GC&#95;TRANSITION&#95;END</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// nodes with all the appropriate arguments and return values.</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Call Node: Chain, Target, &#123;Args&#125;, RegMask, &#91;Glue&#93;</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Chain = CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#a8388f666d6e735f35837ad03ed1f7a7a">getOperand</a>(0);</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Glue;</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CallHasIncomingGlue = CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#ae1fa8ded9bce6f8321a69e99e41a473c">getGluedNode</a>();</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CallHasIncomingGlue) &#123;</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Glue is always last operand</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">    Glue = CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#a8388f666d6e735f35837ad03ed1f7a7a">getOperand</a>(CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#a7f311fcc2415eee3cb3694013b985304">getNumOperands</a>() - 1);</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build the GC&#95;TRANSITION&#95;START node if necessary.</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The operands to the GC&#95;TRANSITION&#95;&#123;START,END&#125; nodes are laid out in the</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// order in which they appear in the call to the statepoint intrinsic. If</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// any of the operands is a pointer-typed, that operand is immediately</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// followed by a SRCVALUE for the pointer that may be used during lowering</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (e.g. to form MachinePointerInfo values for loads/stores).</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsGCTransition =</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">      (<a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointFlags &amp; (uint64&#95;t)<a href="/docs/api/namespaces/llvm/#abba0f0474eb4e32d1ed7b6dfdb0d5140a9db1ed1dc0fe1fc6b917ab0430b7844c">StatepointFlags::GCTransition</a>) ==</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">      (uint64&#95;t)<a href="/docs/api/namespaces/llvm/#abba0f0474eb4e32d1ed7b6dfdb0d5140a9db1ed1dc0fe1fc6b917ab0430b7844c">StatepointFlags::GCTransition</a>;</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsGCTransition) &#123;</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SDValue, 8&gt;</a> TSOps;</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add chain</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">    TSOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Chain);</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add GC transition arguments</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Value &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.GCTransitionArgs) &#123;</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">      TSOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V));</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V-&gt;getType()-&gt;isPointerTy())</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">        TSOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getSrcValue(V));</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add glue if necessary</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CallHasIncomingGlue)</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">      TSOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Glue);</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/sdvtlist">SDVTList</a> NodeTys = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getVTList(MVT::Other, MVT::Glue);</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> GCTransitionStart =</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getNode(ISD::GC&#95;TRANSITION&#95;START, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), NodeTys, TSOps);</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">    Chain = GCTransitionStart.<a href="/docs/api/classes/llvm/sdvalue/#a64932427432abeb61241e98bea167580">getValue</a>(0);</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">    Glue = GCTransitionStart.<a href="/docs/api/classes/llvm/sdvalue/#a64932427432abeb61241e98bea167580">getValue</a>(1);</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Currently, all of these operands are being marked as read/write in</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PrologEpilougeInserter.cpp, we should special case the VMState arguments</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and flags to be read-only.</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SDValue, 40&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>;</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add the &lt;id&gt; and &lt;numBytes&gt; constants.</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetConstant(<a href="/docs/api/namespaces/llvm/si">SI</a>.ID, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), MVT::i64));</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetConstant(<a href="/docs/api/namespaces/llvm/si">SI</a>.NumPatchBytes, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), MVT::i32));</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Calculate and push starting position of vmstate arguments</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get number of arguments incoming directly into call node</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumCallRegArgs =</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">      CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#a7f311fcc2415eee3cb3694013b985304">getNumOperands</a>() - (CallHasIncomingGlue ? 4 : 3);</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetConstant(NumCallRegArgs, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), MVT::i32));</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add call target</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> CallTarget = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>(CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#a8388f666d6e735f35837ad03ed1f7a7a">getOperand</a>(1).<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>(), 0);</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(CallTarget);</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add call arguments</span></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get position of register mask in the call</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdnode/#a423c330f7f1bd8f3510e2bb304435217">SDNode::op&#95;iterator</a> RegMaskIt;</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CallHasIncomingGlue)</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">    RegMaskIt = CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#ae499cc99d4fe44d343ca9ac6a2ae8845">op&#95;end</a>() - 2;</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">    RegMaskIt = CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#ae499cc99d4fe44d343ca9ac6a2ae8845">op&#95;end</a>() - 1;</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.insert(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.end(), CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#aee6bd1fd282469b3476efce4b707f09a">op&#95;begin</a>() + 2, RegMaskIt);</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add a constant argument for the calling convention</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">  <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/si">SI</a>.CLI.CallConv);</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add a constant argument for the flags</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">  uint64&#95;t Flags = <a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointFlags;</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(((Flags &amp; ~(uint64&#95;t)<a href="/docs/api/namespaces/llvm/#abba0f0474eb4e32d1ed7b6dfdb0d5140a003ec4f8bc6c6d93aa1801253e494916">StatepointFlags::MaskAll</a>) == 0) &amp;&amp;</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unknown flag used&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">  <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, Flags);</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert all vmstate and gcstate arguments</span></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">llvm::append&#95;range</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, LoweredMetaArgs);</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add register mask from call node</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(&#42;RegMaskIt);</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add chain</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(Chain);</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Same for the glue, but we add it only if original call had it</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Glue.<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>())</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(Glue);</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute return values.  Provide a glue output since we consume one as</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// input.  This allows someone else to chain off us as needed.</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;EVT, 8&gt;</a> NodeTys;</span></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SD : LoweredGCArgs) &#123;</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SD))</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">    NodeTys.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(SD.getValueType());</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Statepoint has &quot;</span><span class="doxyHighlight"> &lt;&lt; NodeTys.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; results\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NodeTys.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a3d95cc2d359b8d9ed5bd9504b44930b5">size</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Inconsistent GC Ptr lowering&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">  NodeTys.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MVT::Other);</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">  NodeTys.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MVT::Glue);</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumResults = NodeTys.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/machinesdnode">MachineSDNode</a> &#42;StatepointMCNode =</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getMachineNode(TargetOpcode::STATEPOINT, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), NodeTys, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>);</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.setNodeMemRefs(StatepointMCNode, MemRefs);</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For values lowered to tied-defs, create the virtual registers if used</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in other blocks. For local gc.relocate record appropriate statepoint</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// result in StatepointLoweringState.</span></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;SDValue, Register&gt;</a> VirtRegs;</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Relocate : <a href="/docs/api/namespaces/llvm/si">SI</a>.GCRelocates) &#123;</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><span class="doxyHighlight">    Value &#42;Derived = Relocate-&gt;getDerivedPtr();</span></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> SD = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(Derived);</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> It = LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(SD);</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (It == LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Relocated = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>(StatepointMCNode, It-&gt;second);</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Handle local relocate. Note that different relocates might</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// map to the same SDValue.</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointInstr-&gt;getParent() == Relocate-&gt;getParent()) &#123;</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Res = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.getLocation(SD);</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Res)</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Res == Relocated);</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.setLocation(SD, Relocated);</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Handle multiple gc.relocates of the same input efficiently.</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VirtRegs.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SD))</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RetTy = Relocate-&gt;getType();</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/register">Register</a> Reg = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.CreateRegs(RetTy);</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/regsforvalue">RegsForValue</a> RFV(&#42;<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getContext(), <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetLoweringInfo(),</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getDataLayout(), Reg, RetTy, std::nullopt);</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Chain = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getRoot();</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">    RFV.<a href="/docs/api/structs/llvm/regsforvalue/#adf93dd21d49c19700e980b15f19cb7d7">getCopyToRegs</a>(Relocated, <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), Chain, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">    PendingExports.push&#95;back(Chain);</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">    VirtRegs&#91;SD&#93; = Reg;</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Record for later use how each relocation was lowered.  This is needed to</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allow later gc.relocates to mirror the lowering chosen.</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;StatepointInstr = <a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointInstr;</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;RelocationMap = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.StatepointRelocationMaps&#91;StatepointInstr&#93;;</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;Relocate : <a href="/docs/api/namespaces/llvm/si">SI</a>.GCRelocates) &#123;</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Value &#42;V = Relocate-&gt;<a href="/docs/api/classes/llvm/gcrelocateinst/#ae587391ac557593d998dbca4e62f0dab">getDerivedPtr</a>();</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> SDV = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V);</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/namespaces/llvm/loc">Loc</a> = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.getLocation(SDV);</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLocal = (Relocate-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == StatepointInstr-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">    RecordType <a href="/docs/api/classes/llvm/record">Record</a>;</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsLocal &amp;&amp; LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SDV)) &#123;</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Result is already stored in StatepointLowering</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/record">Record</a>.type = <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2cafcf3e806047173bc7c8581b355375870">RecordType::SDValueNode</a>;</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SDV)) &#123;</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/record">Record</a>.type = <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2cad7321692f596ba5573d414ce3452c26f">RecordType::VReg</a>;</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VirtRegs.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SDV));</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/record">Record</a>.payload.Reg = VirtRegs&#91;SDV&#93;;</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/loc">Loc</a>.getNode()) &#123;</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/record">Record</a>.type = <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2ca4e2303faf0f163fb7a4af33f778884e8">RecordType::Spill</a>;</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/record">Record</a>.payload.FI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FrameIndexSDNode&gt;</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>)-&gt;getIndex();</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/record">Record</a>.type = <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2cae1c6c7a77fab355eb08576b3bd29b924">RecordType::NoRelocate</a>;</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we didn&#39;t relocate a value, we&#39;ll essentialy end up inserting an</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// additional use of the original value when lowering the gc.relocate.</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We need to make sure the value is available at the new use, which</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// might be in another block.</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Relocate-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != StatepointInstr-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/selectiondagbuilder/#aa5254258c6a479f86e6ecfc4dcdd7a5e">ExportFromCurrentBlock</a>(V);</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">    RelocationMap&#91;Relocate&#93; = <a href="/docs/api/classes/llvm/record">Record</a>;</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">  </span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdnode">SDNode</a> &#42;SinkNode = StatepointMCNode;</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build the GC&#95;TRANSITION&#95;END node if necessary.</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See the comment above regarding GC&#95;TRANSITION&#95;START for the layout of</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the operands to the GC&#95;TRANSITION&#95;END node.</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsGCTransition) &#123;</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SDValue, 8&gt;</a> TEOps;</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add chain</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">    TEOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>(StatepointMCNode, NumResults - 2));</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add GC transition arguments</span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Value &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.GCTransitionArgs) &#123;</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">      TEOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V));</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V-&gt;getType()-&gt;isPointerTy())</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">        TEOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getSrcValue(V));</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add glue</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">    TEOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>(StatepointMCNode, NumResults - 1));</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/sdvtlist">SDVTList</a> NodeTys = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getVTList(MVT::Other, MVT::Glue);</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> GCTransitionStart =</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getNode(ISD::GC&#95;TRANSITION&#95;END, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), NodeTys, TEOps);</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">    SinkNode = GCTransitionStart.<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>();</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace original call</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Call: ch,glue = CALL ...</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Statepoint: &#91;gc relocates&#93;,ch,glue = STATEPOINT ...</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumSinkValues = SinkNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#a7f06dbaee5fa2b239de548d0a775b25b">getNumValues</a>();</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> StatepointValues&#91;2&#93; = &#123;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>(SinkNode, NumSinkValues - 2),</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">                                 <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>(SinkNode, NumSinkValues - 1)&#125;;</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.ReplaceAllUsesWith(CallNode, StatepointValues);</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove original call node</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.DeleteNode(CallNode);</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Since we always emit CopyToRegs (even for local relocates), we must</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// update root, so that they are emitted before any local uses.</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">  (void)<a href="/docs/api/classes/llvm/selectiondagbuilder/#aef34360e8bb4bdecf3fd6345ff504f81">getControlRoot</a>();</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: A better future implementation would be to emit a single variable</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// argument, variable return value STATEPOINT node here and then hookup the</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// return value of each gc.relocate to the respective output of the</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// previously emitted STATEPOINT value.  Unfortunately, this doesn&#39;t appear</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to actually be possible today.</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ReturnVal;</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlightComment">/// Return two gc.results if present.  First result is a block local</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlightComment">/// gc.result, second result is a non-block local gc.result.  Corresponding</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlightComment">/// entry will be nullptr if not present.</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::pair&lt;const GCResultInst&#42;, const GCResultInst&#42;&gt;</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999" lineLink="#ab1af1f498b4d814ee68810a03fbe28a7"><span class="doxyHighlight"><a href="#ab1af1f498b4d814ee68810a03fbe28a7">getGCResultLocality</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/gcstatepointinst">GCStatepointInst</a> &amp;S) &#123;</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">  std::pair&lt;const GCResultInst &#42;, const GCResultInst&#42;&gt; Res(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : S.<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;GRI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GCResultInst&gt;</a>(U);</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!GRI)</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GRI-&gt;getParent() == S.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">      Res.first = GRI;</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">      Res.second = GRI;</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Res;</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014" lineLink="/docs/api/classes/llvm/selectiondagbuilder/#a32cff45e4cfd323ecc3896adcb08c2a9"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/selectiondagbuilder/#a32cff45e4cfd323ecc3896adcb08c2a9">SelectionDAGBuilder::LowerStatepoint</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/gcstatepointinst">GCStatepointInst</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EHPadBB </span><span class="doxyHighlightComment">/&#42;= nullptr&#42;/</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getCallingConv() != <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca4f42667edde6e9cb80cfae6361e5e76a">CallingConv::AnyReg</a> &amp;&amp;</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;anyregcc is not supported on statepoints!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check that the associated GCStrategy expects to encounter statepoints.</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#a9b4db8b8082660004fda0c282da0ff0a">GFI</a>-&gt;getStrategy().useStatepoints() &amp;&amp;</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;GCStrategy does not expect to encounter statepoints&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> ActualCallee;</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Callee = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getActualCalledOperand());</span></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getNumPatchBytes() &gt; 0) &#123;</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we&#39;ve been asked to emit a nop sequence instead of a call instruction</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for this statepoint then don&#39;t lower the call target, but use a constant</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &#96;undef&#96; instead.  Not lowering the call target lets statepoint clients</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// get away without providing a physical address for the symbolic call</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// target at link time.</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">    ActualCallee = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getUNDEF(Callee.getValueType());</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">    ActualCallee = Callee;</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GCResultLocality = <a href="#ab1af1f498b4d814ee68810a03fbe28a7">getGCResultLocality</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/attributeset">AttributeSet</a> retAttrs;</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GCResultLocality.first)</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><span class="doxyHighlight">    retAttrs = GCResultLocality.first-&gt;getAttributes().getRetAttrs();</span></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/selectiondagbuilder/statepointloweringinfo">StatepointLoweringInfo</a> <a href="/docs/api/namespaces/llvm/si">SI</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>);</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#a8a8a4b167d0244a5c34b6819dd3d5c56">populateCallLoweringInfo</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.CLI, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/gcstatepointinst/#a603a5bfcd809283f948cbf101851c173a4bd61c6f1d2d253230fb6a6cca78d8aa">GCStatepointInst::CallArgsBeginPos</a>,</span></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">                           <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getNumCallArgs(), ActualCallee,</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">                           <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getActualReturnType(), retAttrs,</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">                           </span><span class="doxyHighlightComment">/&#42;IsPatchPoint=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// There may be duplication in the gc.relocate list; such as two copies of</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// each relocation on normal and exceptional path for an invoke.  We only</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// need to spill once and record one copy in the stackmap, but we need to</span></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reload once per gc.relocate.  (Dedupping gc.relocates is trickier and best</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// handled as a CSE problem elsewhere.)</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: There a couple of major stackmap size optimizations we could do</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// here if we wished.</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1) If we&#39;ve encountered a derived pair &#123;B, D&#125;, we don&#39;t need to actually</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// record &#123;B,B&#125; if it&#39;s seen later.</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2) Due to rematerialization, actual derived pointers are somewhat rare;</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// given that, we could change the format to record base pointer relocations</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// separately with half the space. This would require a format rev and a</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// fairly major rework of the STATEPOINT node though.</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;SDValue, 8&gt;</a> Seen;</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;Relocate : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getGCRelocates()) &#123;</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/si">SI</a>.GCRelocates.push&#95;back(Relocate);</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> DerivedSD = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(Relocate-&gt;getDerivedPtr());</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Seen.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(DerivedSD).second) &#123;</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/si">SI</a>.Bases.push&#95;back(Relocate-&gt;getBasePtr());</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs.push&#95;back(Relocate-&gt;getDerivedPtr());</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we find a deopt value which isn&#39;t explicitly added, we need to</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ensure it gets lowered such that gc cycles occurring before the</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// deoptimization event during the lifetime of the call don&#39;t invalidate</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the pointer we&#39;re deopting with.  Note that we assume that all</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pointers passed to deopt are base pointers; relaxing that assumption</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// would require relatively large changes to how we represent relocations.</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Value &#42;V : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.deopt&#95;operands()) &#123;</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a720af7e7f23150174952da03d216341a">isGCValue</a>(V, &#42;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Seen.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V)).second) &#123;</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/si">SI</a>.Bases.push&#95;back(V);</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs.push&#95;back(V);</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.GCLives = <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef&lt;const Use&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.gc&#95;live&#95;begin(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.gc&#95;live&#95;end());</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointInstr = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.ID = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getID();</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.DeoptState = <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef&lt;const Use&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.deopt&#95;begin(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.deopt&#95;end());</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.GCTransitionArgs = <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef&lt;const Use&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.gc&#95;transition&#95;args&#95;begin(),</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">                                            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.gc&#95;transition&#95;args&#95;end());</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointFlags = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getFlags();</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.NumPatchBytes = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getNumPatchBytes();</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.EHPadBB = EHPadBB;</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> ReturnValue = <a href="/docs/api/classes/llvm/selectiondagbuilder/#afe97e2bc5bd74272ca1b54da1fb30e06">LowerAsSTATEPOINT</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Export the result value if needed</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!GCResultLocality.first &amp;&amp; !GCResultLocality.second) &#123;</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The return value is not needed, just generate a poison value.</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note: This covers the void return case.</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getIntPtrConstant(-1, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>()));</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GCResultLocality.first) &#123;</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Result value will be used in a same basic block. Don&#39;t export it or</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// perform any explicit register copies. The gc&#95;result will simply grab</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this value. </span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ReturnValue);</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!GCResultLocality.second)</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Result value will be used in a different basic block so we need to export</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it now.  Default exporting mechanism will not work here because statepoint</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// call has a different type than the actual call. It means that by default</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// llvm will create export register of the wrong type (always i32 in our</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// case). So instead we need to create export register with correct type</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// manually.</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: To eliminate this problem we can remove gc.result intrinsics</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       completely and make statepoint call to return a tuple.</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy = GCResultLocality.second-&gt;getType();</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/register">Register</a> Reg = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.CreateRegs(RetTy);</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/regsforvalue">RegsForValue</a> RFV(&#42;<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getContext(), <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetLoweringInfo(),</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">                   <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getDataLayout(), Reg, RetTy,</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">                   <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getCallingConv());</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Chain = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getEntryNode();</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">  </span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">  RFV.<a href="/docs/api/structs/llvm/regsforvalue/#adf93dd21d49c19700e980b15f19cb7d7">getCopyToRegs</a>(ReturnValue, <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), Chain, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><span class="doxyHighlight">  PendingExports.push&#95;back(Chain);</span></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.ValueMap&#91;&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = Reg;</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140" lineLink="/docs/api/classes/llvm/selectiondagbuilder/#a57ee991742a8027b5ef002c616a6b9fd"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/selectiondagbuilder/#a57ee991742a8027b5ef002c616a6b9fd">SelectionDAGBuilder::LowerCallSiteWithDeoptBundleImpl</a>(</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Callee, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EHPadBB,</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> VarArgDisallowed, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ForceVoidReturnTy) &#123;</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/selectiondagbuilder/statepointloweringinfo">StatepointLoweringInfo</a> <a href="/docs/api/namespaces/llvm/si">SI</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>);</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ArgBeginIndex = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;arg&#95;begin() - <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;op&#95;begin();</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#a8a8a4b167d0244a5c34b6819dd3d5c56">populateCallLoweringInfo</a>(</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/si">SI</a>.CLI, <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, ArgBeginIndex, <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;arg&#95;size(), Callee,</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">      ForceVoidReturnTy ? <a href="/docs/api/classes/llvm/type/#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(&#42;<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getContext()) : <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getType(),</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getAttributes().getRetAttrs(), </span><span class="doxyHighlightComment">/&#42;IsPatchPoint=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VarArgDisallowed)</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/si">SI</a>.CLI.IsVarArg = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getFunctionType()-&gt;isVarArg();</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DeoptBundle = &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getOperandBundle(<a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9ca3f6df86c6efab701ade7abbc3134c25a">LLVMContext::OB&#95;deopt</a>);</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> DefaultID = <a href="/docs/api/structs/llvm/statepointdirectives/#ac6c1765b4a9a319dac2aad8cdc622ef2">StatepointDirectives::DeoptBundleStatepointID</a>;</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SD = <a href="/docs/api/namespaces/llvm/#a830906f493a6d5c69ac5a94675c657fb">parseStatepointDirectivesFromAttrs</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getAttributes());</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.ID = SD.StatepointID.value&#95;or(DefaultID);</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.NumPatchBytes = SD.NumPatchBytes.value&#95;or(0);</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.DeoptState =</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef&lt;const Use&gt;</a>(DeoptBundle.Inputs.begin(), DeoptBundle.Inputs.end());</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointFlags = </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight">uint64&#95;t</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(<a href="/docs/api/namespaces/llvm/#abba0f0474eb4e32d1ed7b6dfdb0d5140a6adf97f83acf6453d4a6a4b1070f3754">StatepointFlags::None</a>);</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/si">SI</a>.EHPadBB = EHPadBB;</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NB! The GC arguments are deliberately left empty.</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Lowering call with deopt bundle &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> ReturnVal = <a href="/docs/api/classes/llvm/selectiondagbuilder/#afe97e2bc5bd74272ca1b54da1fb30e06">LowerAsSTATEPOINT</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>)) &#123;</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">    ReturnVal = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a3756185351596750edbb4790d9923eea">lowerRangeToAssertZExt</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>, &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, ReturnVal);</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, ReturnVal);</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174" lineLink="/docs/api/classes/llvm/selectiondagbuilder/#a475d759da0893604f08519960a12d297"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/selectiondagbuilder/#a475d759da0893604f08519960a12d297">SelectionDAGBuilder::LowerCallSiteWithDeoptBundle</a>(</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Callee, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EHPadBB) &#123;</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#a57ee991742a8027b5ef002c616a6b9fd">LowerCallSiteWithDeoptBundleImpl</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, Callee, EHPadBB,</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">                                   </span><span class="doxyHighlightComment">/&#42; VarArgDisallowed = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">                                   </span><span class="doxyHighlightComment">/&#42; ForceVoidReturnTy  = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> SelectionDAGBuilder::visitGCResult(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/gcresultinst">GCResultInst</a> &amp;CI) &#123;</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The result value of the gc&#95;result is simply the result of the actual</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// call.  We&#39;ve already emitted this, so just grab the value.</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = CI.<a href="/docs/api/classes/llvm/gcprojectioninst/#a6cffcfabac72ca61185ea24c1208b937">getStatepoint</a>();</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GCStatepointInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>)) &amp;&amp;</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;GetStatepoint must return one of two types&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>))</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GCStatepointInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>() == CI.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()) &#123;</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;CI, <a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>));</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Statepoint is in different basic block so we should have stored call</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// result in a virtual register.</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can not use default getValue() functionality to copy value from this</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// register because statepoint and actual call return types can be</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// different, and getValue() will use CopyFromReg of the wrong type,</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which is always i32 in our case.</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy = CI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> CopyFromReg = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ac0b87e85b015d15077a7d9432c500df3">getCopyFromRegs</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, RetTy);</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">  </span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CopyFromReg.getNode());</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;CI, CopyFromReg);</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> SelectionDAGBuilder::visitGCRelocate(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &amp;Relocate) &#123;</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Value &#42;Statepoint = Relocate.<a href="/docs/api/classes/llvm/gcprojectioninst/#a6cffcfabac72ca61185ea24c1208b937">getStatepoint</a>();</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Consistency check</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We skip this check for relocates not in the same basic block as their</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// statepoint. It would be too expensive to preserve validation info through</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// different basic blocks.</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GCStatepointInst&gt;</a>(Statepoint) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Statepoint)) &amp;&amp;</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;GetStatepoint must return one of two types&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Statepoint))</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GCStatepointInst&gt;</a>(Statepoint)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>() == Relocate.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.relocCallVisited(Relocate);</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> Value &#42;DerivedPtr = Relocate.<a href="/docs/api/classes/llvm/gcrelocateinst/#ae587391ac557593d998dbca4e62f0dab">getDerivedPtr</a>();</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;RelocationMap =</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.StatepointRelocationMaps&#91;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GCStatepointInst&gt;</a>(Statepoint)&#93;;</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> SlotIt = RelocationMap.find(&amp;Relocate);</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SlotIt != RelocationMap.end() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Relocating not lowered gc value&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="#ae5fbc6e1ce3fcbb7f185ed9e7beffec7">RecordType</a> &amp;Record = SlotIt-&gt;second;</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If relocation was done via virtual register..</span></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Record.<a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#a71262a52679c1bff78fbec385a79a000">type</a> == <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2cafcf3e806047173bc7c8581b355375870">RecordType::SDValueNode</a>) &#123;</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GCStatepointInst&gt;</a>(Statepoint)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>() ==</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">               Relocate.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() &amp;&amp;</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Nonlocal gc.relocate mapped via SDValue&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a> SDV = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.getLocation(<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(DerivedPtr));</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SDV.<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;empty SDValue&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;Relocate, SDV);</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Record.<a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#a71262a52679c1bff78fbec385a79a000">type</a> == <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2cad7321692f596ba5573d414ce3452c26f">RecordType::VReg</a>) &#123;</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a> InReg = Record.<a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#a3b35426a048cac6e35a0d4eeb04ba7b5">payload</a>.<a href="/docs/api/unions/llvm/functionloweringinfo/statepointrelocationrecord/payload-t/#a3d33cc05e9188ed1f6843e7fb86bcf0b">Reg</a>;</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">    RegsForValue RFV(&#42;<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getContext(), <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetLoweringInfo(),</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getDataLayout(), InReg, Relocate.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">                     std::nullopt); </span><span class="doxyHighlightComment">// This is not an ABI copy.</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We generate copy to/from regs even for local uses, hence we must</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// chain with current root to ensure proper ordering of copies w.r.t.</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// statepoint.</span></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a> <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a> = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getRoot();</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a> Relocation = RFV.getCopyFromRegs(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>, <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(),</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">                                             Chain, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;Relocate, Relocation);</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Record.<a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#a71262a52679c1bff78fbec385a79a000">type</a> == <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2ca4e2303faf0f163fb7a4af33f778884e8">RecordType::Spill</a>) &#123;</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/dwarf/#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = Record.<a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#a3b35426a048cac6e35a0d4eeb04ba7b5">payload</a>.<a href="/docs/api/unions/llvm/functionloweringinfo/statepointrelocationrecord/payload-t/#ad33089865c2bb187d94754afb33c704e">FI</a>;</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a> SpillSlot = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetFrameIndex(Index, <a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>());</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// All the reloads are independent and are reading memory only modified by</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// statepoints (i.e. no other aliasing stores); informing SelectionDAG of</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// this lets CSE kick in for free and allows reordering of</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions if possible.  The lowering for statepoint sets the root,</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// so this is ordering all reloads with the either</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a) the statepoint node itself, or</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// b) the entry of the current block for an invoke statepoint.</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a> <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a> = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getRoot(); </span><span class="doxyHighlightComment">// != Builder.getRoot()</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MF = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getMachineFunction();</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MFI = MF.getFrameInfo();</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PtrInfo = <a href="/docs/api/structs/llvm/machinepointerinfo/#ad8ce1aee13dbdcc05d20284a30e83170">MachinePointerInfo::getFixedStack</a>(MF, Index);</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LoadMMO = MF.getMachineMemOperand(PtrInfo, <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2dda7d12be6206e5b0026c71bbcd5cb76494">MachineMemOperand::MOLoad</a>,</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">                                            MFI.getObjectSize(Index),</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">                                            MFI.getObjectAlign(Index));</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> LoadVT = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetLoweringInfo().getValueType(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getDataLayout(),</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">                                                           Relocate.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a> SpillLoad =</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getLoad(LoadVT, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), Chain, SpillSlot, LoadMMO);</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#a9a1381eb77fac8d57f54f7bf25919a4e">PendingLoads</a>.push&#95;back(SpillLoad.<a href="/docs/api/classes/llvm/sdvalue/#a64932427432abeb61241e98bea167580">getValue</a>(1));</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SpillLoad.<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>());</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;Relocate, SpillLoad);</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Record.<a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#a71262a52679c1bff78fbec385a79a000">type</a> == <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2cae1c6c7a77fab355eb08576b3bd29b924">RecordType::NoRelocate</a>);</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a> SD = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(DerivedPtr);</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SD.<a href="/docs/api/classes/llvm/sdvalue/#a1c861a21f795c3108ab690f3a45c881a">isUndef</a>() &amp;&amp; SD.<a href="/docs/api/classes/llvm/sdvalue/#a6b2b8ca5b0fdf6484247d5ae74deb9ff">getValueType</a>().<a href="/docs/api/structs/llvm/evt/#a45e76d44a189e456d52e37ba3dda0fce">getSizeInBits</a>() &lt;= 64) &#123;</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Lowering relocate(undef) as arbitrary constant. Current constant value</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is chosen such that it&#39;s unlikely to be a valid pointer.</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;Relocate, <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getConstant(0xFEFEFEFE, SDLoc(SD), MVT::i64));</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We didn&#39;t need to spill these special cases (constants and allocas).</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See the handling in spillIncomingValueForStatepoint for detail.</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;Relocate, SD);</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302" lineLink="/docs/api/classes/llvm/selectiondagbuilder/#a459873061a3fed537ca026ddaffe57ed"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/selectiondagbuilder/#a459873061a3fed537ca026ddaffe57ed">SelectionDAGBuilder::LowerDeoptimizeCall</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI) &#123;</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;TLI = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetLoweringInfo();</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Callee = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getExternalSymbol(TLI.getLibcallName(RTLIB::DEOPTIMIZE),</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">                                         TLI.getPointerTy(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getDataLayout()));</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We don&#39;t lower calls to &#95;&#95;llvm&#95;deoptimize as varargs, but as a regular</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// call.  We also do not lower the return value to any virtual register, and</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// change the immediately following return to a trap instruction.</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#a57ee991742a8027b5ef002c616a6b9fd">LowerCallSiteWithDeoptBundleImpl</a>(CI, Callee, </span><span class="doxyHighlightComment">/&#42; EHPadBB = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">                                   </span><span class="doxyHighlightComment">/&#42; VarArgDisallowed = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">                                   </span><span class="doxyHighlightComment">/&#42; ForceVoidReturnTy = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315" lineLink="/docs/api/classes/llvm/selectiondagbuilder/#acf29bbf079b2610d2c8481212261fc49"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/selectiondagbuilder/#acf29bbf079b2610d2c8481212261fc49">SelectionDAGBuilder::LowerDeoptimizingReturn</a>() &#123;</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We do not lower the return value from llvm.deoptimize to any virtual</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// register, and change the immediately following return to a trap</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction.</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTarget().Options.TrapUnreachable)</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.setRoot(</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getNode(ISD::TRAP, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), MVT::Other, <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getRoot()));</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
