---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `StatepointLowering.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="StatepointLowering.h"
  permalink="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-h"
  isLocal="true" />
<IncludesListItem
  filePath="SelectionDAGBuilder.h"
  permalink="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/selectiondagbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallBitVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallbitvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/FunctionLoweringInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/functionloweringinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/GCMetadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/gcmetadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/ISDOpcodes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/isdopcodes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFrameInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineframeinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineMemOperand.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinememoperand-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/SelectionDAG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/selectiondag-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/SelectionDAGNodes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/selectiondagnodes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/StackMaps.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/stackmaps-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetLowering.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetlowering-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetOpcodes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetopcodes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGenTypes/MachineValueType.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegentypes/machinevaluetype-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CallingConv.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/callingconv-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GCStrategy.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/gcstrategy-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Statepoint.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/statepoint-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetMachine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetOptions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetoptions-h"
  isLocal="true" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstddef"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="tuple"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
</IncludesList>

## Typedefs Index

<MembersIndex>

<MembersIndexItem
  type="typedef"
  name={<><a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord">FunctionLoweringInfo::StatepointRelocationRecord</a> <a href="#ae5fbc6e1ce3fcbb7f185ed9e7beffec7">RecordType</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type={<>std::optional&lt; int &gt;</>}
  name={<><a href="#a6ac2c0f0b7439c31332c78cd1ca5c4fe">findPreviousSpillSlot</a> (const Value &#42;Val, SelectionDAGBuilder &amp;Builder, int LookUpDepth)</>}>
Utility function for reservePreviousStackSlotForValue. <a href="#a6ac2c0f0b7439c31332c78cd1ca5c4fe">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::pair&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/gcresultinst">GCResultInst</a> &#42;, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/gcresultinst">GCResultInst</a> &#42; &gt;</>}
  name={<><a href="#ab1af1f498b4d814ee68810a03fbe28a7">getGCResultLocality</a> (const GCStatepointInst &amp;S)</>}>
Return two gc.results if present. <a href="#ab1af1f498b4d814ee68810a03fbe28a7">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a> &#42;</>}
  name={<><a href="#aec1de11231135901271d92c7d90dae60">getMachineMemOperand</a> (MachineFunction &amp;MF, FrameIndexSDNode &amp;FI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a720af7e7f23150174952da03d216341a">isGCValue</a> (const Value &#42;V, SelectionDAGBuilder &amp;Builder)</>}>
Return true if value V represents the GC value. <a href="#a720af7e7f23150174952da03d216341a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::pair&lt; <a href="/docs/api/classes/llvm/sdvalue">SDValue</a>, <a href="/docs/api/classes/llvm/sdnode">SDNode</a> &#42; &gt;</>}
  name={<><a href="#af8947d9c8165e82094241d319758e0c5">lowerCallFromStatepointLoweringInfo</a> (SelectionDAGBuilder::StatepointLoweringInfo &amp;SI, SelectionDAGBuilder &amp;Builder)</>}>
Extract call from statepoint, lower it and return pointer to the call node. <a href="#af8947d9c8165e82094241d319758e0c5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a1692829d8158767fe5ac1809c90a77a3">lowerIncomingStatepointValue</a> (SDValue Incoming, bool RequireSpillSlot, SmallVectorImpl&lt; SDValue &gt; &amp;Ops, SmallVectorImpl&lt; MachineMemOperand &#42; &gt; &amp;MemRefs, SelectionDAGBuilder &amp;Builder)</>}>
Lower a single value incoming to a statepoint node. <a href="#a1692829d8158767fe5ac1809c90a77a3">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a9029ef3db44eac67782fd8ccb7796a0c">lowerStatepointMetaArgs</a> (SmallVectorImpl&lt; SDValue &gt; &amp;Ops, SmallVectorImpl&lt; MachineMemOperand &#42; &gt; &amp;MemRefs, SmallVectorImpl&lt; SDValue &gt; &amp;GCPtrs, DenseMap&lt; SDValue, int &gt; &amp;LowerAsVReg, SelectionDAGBuilder::StatepointLoweringInfo &amp;SI, SelectionDAGBuilder &amp;Builder)</>}>
Lower deopt state and gc pointer arguments of the statepoint. <a href="#a9029ef3db44eac67782fd8ccb7796a0c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a> (SmallVectorImpl&lt; SDValue &gt; &amp;Ops, SelectionDAGBuilder &amp;Builder, uint64&#95;t Value)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#adec63d991d7eb048d87fa3888099c848">reservePreviousStackSlotForValue</a> (const Value &#42;IncomingValue, SelectionDAGBuilder &amp;Builder)</>}>
Try to find existing copies of the incoming values in stack slots used for statepoint spilling. <a href="#adec63d991d7eb048d87fa3888099c848">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::tuple&lt; <a href="/docs/api/classes/llvm/sdvalue">SDValue</a>, <a href="/docs/api/classes/llvm/sdvalue">SDValue</a>, <a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a> &#42; &gt;</>}
  name={<><a href="#afb9b4b3ff97e290070f42849b51a13a5">spillIncomingStatepointValue</a> (SDValue Incoming, SDValue Chain, SelectionDAGBuilder &amp;Builder)</>}>
Spill a value incoming to the statepoint. <a href="#afb9b4b3ff97e290070f42849b51a13a5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ac56a1eac8e1bf8bbe2530ba919e3542c">STATISTIC</a> (NumSlotsAllocatedForStatepoints, &quot;Number of stack slots allocated for statepoints&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a190019db36961a89ee7ac54d621812f9">STATISTIC</a> (NumOfStatepoints, &quot;Number of statepoint nodes encountered&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a832142292a9ea54449b2930dd109a131">STATISTIC</a> (StatepointMaxSlotsRequired, &quot;Maximum number of stack slots required for a singe statepoint&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a8300a0e0276d27757963efa800126f14">willLowerDirectly</a> (SDValue Incoming)</>}>
Return true if-and-only-if the given <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> can be lowered as either a constant argument or a stack reference. <a href="#a8300a0e0276d27757963efa800126f14">More...</a>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#adc011fee2f0e40238d54aa2a8820c728">MaxRegistersForGCPointers</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ab9bf191372abad68cbfc02b4e33cebc6">UseRegistersForDeoptValues</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a08e0d3f870d52149756ca3cec34ab6a0">UseRegistersForGCPointersInLandingPad</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;statepoint-lowering&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Typedefs

### RecordType {#ae5fbc6e1ce3fcbb7f185ed9e7beffec7}

<MemberDefinition
  prototype="typedef FunctionLoweringInfo::StatepointRelocationRecord RecordType">

Definition at line <a href="#l00076">76</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Functions

### findPreviousSpillSlot() {#a6ac2c0f0b7439c31332c78cd1ca5c4fe}

<MemberDefinition
  prototype={<>static std::optional&lt; int &gt; findPreviousSpillSlot (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42; Val, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder, int LookUpDepth)</>}
  labels = {["static"]}>
Utility function for reservePreviousStackSlotForValue.

Tries to find stack slot index to which we have spilled value for previous statepoints. LookUpDepth specifies maximum DFS depth this function is allowed to look.

Definition at line <a href="#l00160">160</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### getGCResultLocality() {#ab1af1f498b4d814ee68810a03fbe28a7}

<MemberDefinition
  prototype={<>static std::pair&lt; const GCResultInst &#42;, const GCResultInst &#42; &gt; getGCResultLocality (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/gcstatepointinst">GCStatepointInst</a> &amp; S)</>}
  labels = {["static"]}>
Return two gc.results if present.

First result is a block local gc.result, second result is a non-block local gc.result. Corresponding entry will be nullptr if not present.

Definition at line <a href="#l00999">999</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### getMachineMemOperand() {#aec1de11231135901271d92c7d90dae60}

<MemberDefinition
  prototype={<>static MachineMemOperand &#42; getMachineMemOperand (<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp; MF, <a href="/docs/api/classes/llvm/frameindexsdnode">FrameIndexSDNode</a> &amp; FI)</>}
  labels = {["static"]}>

Definition at line <a href="#l00358">358</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### isGCValue() {#a720af7e7f23150174952da03d216341a}

<MemberDefinition
  prototype={<>static bool isGCValue (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42; V, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder)</>}
  labels = {["static"]}>
Return true if value V represents the GC value.

The behavior is conservative in case it is not sure that value is not GC the function returns true.

Definition at line <a href="#l00502">502</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### lowerCallFromStatepointLoweringInfo() {#af8947d9c8165e82094241d319758e0c5}

<MemberDefinition
  prototype={<>static std::pair&lt; SDValue, SDNode &#42; &gt; lowerCallFromStatepointLoweringInfo (<a href="/docs/api/structs/llvm/selectiondagbuilder/statepointloweringinfo">SelectionDAGBuilder::StatepointLoweringInfo</a> &amp; SI, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder)</>}
  labels = {["static"]}>
Extract call from statepoint, lower it and return pointer to the call node.

Also update NodeMap so that getValue(statepoint) will reference lowered call result

Definition at line <a href="#l00318">318</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### lowerIncomingStatepointValue() {#a1692829d8158767fe5ac1809c90a77a3}

<MemberDefinition
  prototype={<>static void lowerIncomingStatepointValue (<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Incoming, bool RequireSpillSlot, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> &gt; &amp; Ops, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a> &#42; &gt; &amp; MemRefs, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder)</>}
  labels = {["static"]}>
Lower a single value incoming to a statepoint node.

This value can be either a deopt value or a gc value, the handling is the same. We special case constants and allocas, then fall back to spilling if required.

Definition at line <a href="#l00424">424</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### lowerStatepointMetaArgs() {#a9029ef3db44eac67782fd8ccb7796a0c}

<MemberDefinition
  prototype={<>static void lowerStatepointMetaArgs (<a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> &gt; &amp; Ops, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a> &#42; &gt; &amp; MemRefs, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> &gt; &amp; GCPtrs, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/sdvalue">SDValue</a>, int &gt; &amp; LowerAsVReg, <a href="/docs/api/structs/llvm/selectiondagbuilder/statepointloweringinfo">SelectionDAGBuilder::StatepointLoweringInfo</a> &amp; SI, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder)</>}
  labels = {["static"]}>
Lower deopt state and gc pointer arguments of the statepoint.

The actual lowering is described in lowerIncomingStatepointValue. This function is responsible for lowering everything in the right position and playing some tricks to avoid redundant stack manipulation where possible. On completion, &#39;Ops&#39; will contain ready to use operands for machine code statepoint. The chain nodes will have already been created and the DAG root will be set to the last value spilled (if any were).

Definition at line <a href="#l00520">520</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### pushStackMapConstant() {#a720a77a05d768dabfa739d154c11ddfd}

<MemberDefinition
  prototype={<>static void pushStackMapConstant (<a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> &gt; &amp; Ops, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder, uint64&#95;t Value)</>}
  labels = {["static"]}>

Definition at line <a href="#l00078">78</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### reservePreviousStackSlotForValue() {#adec63d991d7eb048d87fa3888099c848}

<MemberDefinition
  prototype={<>static void reservePreviousStackSlotForValue (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/value">Value</a> &#42; IncomingValue, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder)</>}
  labels = {["static"]}>
Try to find existing copies of the incoming values in stack slots used for statepoint spilling.

If we can find a spill slot for the incoming value, mark that slot as allocated, and reuse the same slot for this safepoint. This helps to avoid series of loads and stores that only serve to reshuffle values on the stack between calls.

Definition at line <a href="#l00268">268</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### spillIncomingStatepointValue() {#afb9b4b3ff97e290070f42849b51a13a5}

<MemberDefinition
  prototype={<>static std::tuple&lt; SDValue, SDValue, MachineMemOperand &#42; &gt; spillIncomingStatepointValue (<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Incoming, <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Chain, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp; Builder)</>}
  labels = {["static"]}>
Spill a value incoming to the statepoint.

It might be either part of vmstate or gcstate. In both cases unconditionally spill it on the stack unless it is a null constant. Return pair with first element being frame index containing saved value and second element with outgoing chain from the emitted store

Definition at line <a href="#l00376">376</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ac56a1eac8e1bf8bbe2530ba919e3542c}

<MemberDefinition
  prototype={<>STATISTIC (NumSlotsAllocatedForStatepoints, &quot;Number of stack <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp/#ad95860b0cf8da9d86f5683f19fafbb32">slots</a> allocated <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> statepoints&quot;)</>}>

Definition at line <a href="#l00058">58</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a190019db36961a89ee7ac54d621812f9}

<MemberDefinition
  prototype={<>STATISTIC (NumOfStatepoints, &quot;Number of statepoint <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuunifydivergentexitnodes-cpp/#aaa253dd3e56c37edd403113782c0ef94">nodes</a> encountered&quot;)</>}>

Definition at line <a href="#l00060">60</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a832142292a9ea54449b2930dd109a131}

<MemberDefinition
  prototype={<>STATISTIC (StatepointMaxSlotsRequired, &quot;Maximum number of stack <a href="/docs/api/files/lib/lib/codegen/stackcoloring-cpp/#ad95860b0cf8da9d86f5683f19fafbb32">slots</a> required <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> a singe statepoint&quot;)</>}>

Definition at line <a href="#l00061">61</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### willLowerDirectly() {#a8300a0e0276d27757963efa800126f14}

<MemberDefinition
  prototype={<>static bool willLowerDirectly (<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Incoming)</>}
  labels = {["static"]}>
Return true if-and-only-if the given <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> can be lowered as either a constant argument or a stack reference.

The key point is that the value doesn&#39;t need to be spilled or tracked as a vreg use.

Definition at line <a href="#l00247">247</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### MaxRegistersForGCPointers {#adc011fee2f0e40238d54aa2a8820c728}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; MaxRegistersForGCPointers(&quot;max-registers-for-gc-values&quot;, cl::Hidden, cl::init(0), cl::desc(&quot;Max number of VRegs allowed to pass GC pointer meta args in&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00072">72</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### UseRegistersForDeoptValues {#ab9bf191372abad68cbfc02b4e33cebc6}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; UseRegistersForDeoptValues(&quot;use-registers-for-deopt-values&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Allow using registers for non pointer deopt args&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00064">64</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

### UseRegistersForGCPointersInLandingPad {#a08e0d3f870d52149756ca3cec34ab6a0}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; UseRegistersForGCPointersInLandingPad(&quot;use-registers-for-gc-values-in-landing-pad&quot;, cl::Hidden, cl::init(false), cl::desc(&quot;Allow using registers for gc pointer in landing pad&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00068">68</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;statepoint-lowering&quot;</>}>

Definition at line <a href="#l00056">56</a> of file <a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-cpp">StatepointLowering.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><Highlight kind="comment">//===- StatepointLowering.cpp - SDAGBuilder&#39;s statepoint code -------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><Highlight kind="normal"></Highlight><Highlight kind="comment">// See https://llvm.org/LICENSE.txt for license information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This file includes support code use by SelectionDAGBuilder when lowering a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><Highlight kind="normal"></Highlight><Highlight kind="comment">// statepoint sequence in SelectionDAG IR.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/statepointlowering-h">StatepointLowering.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/selectiondag/selectiondagbuilder-h">SelectionDAGBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h">llvm/ADT/SetVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallbitvector-h">llvm/ADT/SmallBitVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallset-h">llvm/ADT/SmallSet.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/functionloweringinfo-h">llvm/CodeGen/FunctionLoweringInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/gcmetadata-h">llvm/CodeGen/GCMetadata.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/isdopcodes-h">llvm/CodeGen/ISDOpcodes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineframeinfo-h">llvm/CodeGen/MachineFrameInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h">llvm/CodeGen/MachineFunction.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinememoperand-h">llvm/CodeGen/MachineMemOperand.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/selectiondag-h">llvm/CodeGen/SelectionDAG.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/selectiondagnodes-h">llvm/CodeGen/SelectionDAGNodes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/stackmaps-h">llvm/CodeGen/StackMaps.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetlowering-h">llvm/CodeGen/TargetLowering.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetopcodes-h">llvm/CodeGen/TargetOpcodes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegentypes/machinevaluetype-h">llvm/CodeGenTypes/MachineValueType.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/callingconv-h">llvm/IR/CallingConv.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/gcstrategy-h">llvm/IR/GCStrategy.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/statepoint-h">llvm/IR/Statepoint.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h">llvm/Target/TargetMachine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetoptions-h">llvm/Target/TargetOptions.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cassert&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cstddef&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cstdint&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;iterator&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;tuple&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;utility&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a>;</Highlight></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE &quot;statepoint-lowering&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58" lineLink="#ac56a1eac8e1bf8bbe2530ba919e3542c"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumSlotsAllocatedForStatepoints,</Highlight></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Number of stack slots allocated for statepoints&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60" lineLink="#a190019db36961a89ee7ac54d621812f9"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumOfStatepoints, </Highlight><Highlight kind="stringliteral">&quot;Number of statepoint nodes encountered&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61" lineLink="#a832142292a9ea54449b2930dd109a131"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(StatepointMaxSlotsRequired,</Highlight></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Maximum number of stack slots required for a singe statepoint&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64" lineLink="#ab9bf191372abad68cbfc02b4e33cebc6"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#ab9bf191372abad68cbfc02b4e33cebc6">UseRegistersForDeoptValues</a>(</Highlight></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;use-registers-for-deopt-values&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Allow using registers for non pointer deopt args&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68" lineLink="#a08e0d3f870d52149756ca3cec34ab6a0"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a08e0d3f870d52149756ca3cec34ab6a0">UseRegistersForGCPointersInLandingPad</a>(</Highlight></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;use-registers-for-gc-values-in-landing-pad&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Allow using registers for gc pointer in landing pad&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72" lineLink="#adc011fee2f0e40238d54aa2a8820c728"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#adc011fee2f0e40238d54aa2a8820c728">MaxRegistersForGCPointers</a>(</Highlight></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;max-registers-for-gc-values&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0),</Highlight></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Max number of VRegs allowed to pass GC pointer meta args in&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76" lineLink="#ae5fbc6e1ce3fcbb7f185ed9e7beffec7"><Highlight kind="normal"></Highlight><Highlight kind="keyword">typedef</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord">FunctionLoweringInfo::StatepointRelocationRecord</a> <a href="#ae5fbc6e1ce3fcbb7f185ed9e7beffec7">RecordType</a>;</Highlight></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78" lineLink="#a720a77a05d768dabfa739d154c11ddfd"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;SDValue&gt;</a>&amp; <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>,</Highlight></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><Highlight kind="normal">                                 <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder, uint64&#95;t <a href="/docs/api/classes/llvm/value">Value</a>) &#123;</Highlight></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdloc">SDLoc</a> L = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>();</Highlight></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#abf892d1e00a3d79026c5ab518c187c45">getTargetConstant</a>(StackMaps::ConstantOp, L,</Highlight></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><Highlight kind="normal">                                              MVT::i64));</Highlight></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#abf892d1e00a3d79026c5ab518c187c45">getTargetConstant</a>(<a href="/docs/api/classes/llvm/value">Value</a>, L, MVT::i64));</Highlight></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86" lineLink="/docs/api/classes/llvm/statepointloweringstate/#aeb4b5a7ad5a49f17f8a34890eb6efefe"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/statepointloweringstate/#aeb4b5a7ad5a49f17f8a34890eb6efefe">StatepointLoweringState::startNewStatepoint</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Consistency check</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PendingGCRelocateCalls.empty() &amp;&amp;</Highlight></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Trying to visit statepoint before finished processing previous one&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><Highlight kind="normal">  Locations.clear();</Highlight></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><Highlight kind="normal">  NextSlotToAllocate = 0;</Highlight></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Need to resize this on each safepoint - we need the two to stay in sync and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the clear patterns of a SelectionDAGBuilder have no relation to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FunctionLoweringInfo.  Also need to ensure used bits get cleared.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><Highlight kind="normal">  AllocatedStackSlots.clear();</Highlight></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><Highlight kind="normal">  AllocatedStackSlots.resize(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a9691f14813e0540e6a1c90cfdad39df3">StatepointStackSlots</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</Highlight></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99" lineLink="/docs/api/classes/llvm/statepointloweringstate/#a2651c31aeb22030422cc4e9ef6c21e22"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/statepointloweringstate/#a2651c31aeb22030422cc4e9ef6c21e22">StatepointLoweringState::clear</a>() &#123;</Highlight></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><Highlight kind="normal">  Locations.clear();</Highlight></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><Highlight kind="normal">  AllocatedStackSlots.clear();</Highlight></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PendingGCRelocateCalls.empty() &amp;&amp;</Highlight></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;cleared before statepoint sequence completed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><Highlight kind="normal"><a href="/docs/api/classes/llvm/sdvalue">SDValue</a></Highlight></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107" lineLink="/docs/api/classes/llvm/statepointloweringstate/#a4841be2489ba10321338a1874b53f249"><Highlight kind="normal"><a href="/docs/api/classes/llvm/statepointloweringstate/#a4841be2489ba10321338a1874b53f249">StatepointLoweringState::allocateStackSlot</a>(<a href="/docs/api/structs/llvm/evt">EVT</a> <a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>,</Highlight></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><Highlight kind="normal">                                           <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><Highlight kind="normal">  NumSlotsAllocatedForStatepoints++;</Highlight></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#ac64ec73b0617befef1fb2eae78d12b5f">getMachineFunction</a>().<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</Highlight></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SpillSize = <a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>.getStoreSize();</Highlight></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((SpillSize &#42; 8) ==</Highlight></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><Highlight kind="normal">             (-8u &amp; (7 + <a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>.getSizeInBits())) &amp;&amp; </Highlight><Highlight kind="comment">// Round up modulo 8</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Size not in bytes?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// First look for a previously created stack slot which is not in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// use (accounting for the fact arbitrary slots may already be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reserved), or to create a new stack slot and use it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">size&#95;t</Highlight><Highlight kind="normal"> NumSlots = AllocatedStackSlots.size();</Highlight></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NextSlotToAllocate &lt;= NumSlots &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Broken invariant&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AllocatedStackSlots.size() ==</Highlight></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><Highlight kind="normal">         Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a9691f14813e0540e6a1c90cfdad39df3">StatepointStackSlots</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Broken invariant&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (; NextSlotToAllocate &lt; NumSlots; NextSlotToAllocate++) &#123;</Highlight></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AllocatedStackSlots.test(NextSlotToAllocate)) &#123;</Highlight></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> FI = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a9691f14813e0540e6a1c90cfdad39df3">StatepointStackSlots</a>&#91;NextSlotToAllocate&#93;;</Highlight></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a9284fd53296d2a2f8ae654d000971000">getObjectSize</a>(FI) == SpillSize) &#123;</Highlight></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><Highlight kind="normal">        AllocatedStackSlots.set(NextSlotToAllocate);</Highlight></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// TODO: Is ValueType the right thing to use here?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#acb59cbd8f4a8c1cf820b2b540aebdac1">getFrameIndex</a>(FI, <a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>);</Highlight></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Couldn&#39;t find a free slot, so create a new one:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> SpillSlot = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#ae83b3d8e9a944b5d818e80524a5003e2">CreateStackTemporary</a>(<a href="/docs/api/namespaces/llvm/#ad18871060ac1b051c7322cc6ad71e11c">ValueType</a>);</Highlight></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> FI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FrameIndexSDNode&gt;</a>(SpillSlot)-&gt;getIndex();</Highlight></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><Highlight kind="normal">  MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a477686b0d65454f32799cb86f406104c">markAsStatepointSpillSlotObjectIndex</a>(FI);</Highlight></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a9691f14813e0540e6a1c90cfdad39df3">StatepointStackSlots</a>.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FI);</Highlight></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><Highlight kind="normal">  AllocatedStackSlots.resize(AllocatedStackSlots.size()+1, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AllocatedStackSlots.size() ==</Highlight></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><Highlight kind="normal">         Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a9691f14813e0540e6a1c90cfdad39df3">StatepointStackSlots</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Broken invariant&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><Highlight kind="normal">  StatepointMaxSlotsRequired.updateMax(</Highlight></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a9691f14813e0540e6a1c90cfdad39df3">StatepointStackSlots</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</Highlight></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> SpillSlot;</Highlight></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><Highlight kind="comment">/// Utility function for reservePreviousStackSlotForValue. Tries to find</Highlight></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><Highlight kind="comment">/// stack slot index to which we have spilled value for previous statepoints.</Highlight></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><Highlight kind="comment">/// LookUpDepth specifies maximum DFS depth this function is allowed to look.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160" lineLink="#a6ac2c0f0b7439c31332c78cd1ca5c4fe"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> std::optional&lt;int&gt; <a href="#a6ac2c0f0b7439c31332c78cd1ca5c4fe">findPreviousSpillSlot</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Val,</Highlight></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><Highlight kind="normal">                                                <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder,</Highlight></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><Highlight kind="normal">                                                </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> LookUpDepth) &#123;</Highlight></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Can not look any further - give up now</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LookUpDepth &lt;= 0)</Highlight></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Spill location is known for gc relocates</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Relocate = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GCRelocateInst&gt;</a>(Val)) &#123;</Highlight></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Statepoint = Relocate-&gt;getStatepoint();</Highlight></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GCStatepointInst&gt;</a>(Statepoint) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Statepoint)) &amp;&amp;</Highlight></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;GetStatepoint must return one of two types&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Statepoint))</Highlight></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;RelocationMap = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a460bac4fe51e0dcd08f1fb328005926d">StatepointRelocationMaps</a></Highlight></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><Highlight kind="normal">                                    &#91;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GCStatepointInst&gt;</a>(Statepoint)&#93;;</Highlight></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> It = RelocationMap.find(Relocate);</Highlight></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It == RelocationMap.end())</Highlight></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/classes/llvm/record">Record</a> = It-&gt;second;</Highlight></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/record">Record</a>.type != <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2ca4e2303faf0f163fb7a4af33f778884e8">RecordType::Spill</a>)</Highlight></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/record">Record</a>.payload.FI;</Highlight></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Look through bitcast instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/bitcastinst">BitCastInst</a> &#42;Cast = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BitCastInst&gt;</a>(Val))</Highlight></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a6ac2c0f0b7439c31332c78cd1ca5c4fe">findPreviousSpillSlot</a>(Cast-&gt;getOperand(0), Builder, LookUpDepth - 1);</Highlight></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Look through phi nodes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// All incoming values should have same known stack slot, otherwise result</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is unknown.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Val)) &#123;</Highlight></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><Highlight kind="normal">    std::optional&lt;int&gt; MergedResult;</Highlight></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;IncomingValue : Phi-&gt;incoming&#95;values()) &#123;</Highlight></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><Highlight kind="normal">      std::optional&lt;int&gt; SpillSlot =</Highlight></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><Highlight kind="normal">          <a href="#a6ac2c0f0b7439c31332c78cd1ca5c4fe">findPreviousSpillSlot</a>(IncomingValue, Builder, LookUpDepth - 1);</Highlight></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SpillSlot)</Highlight></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MergedResult &amp;&amp; &#42;MergedResult != &#42;SpillSlot)</Highlight></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><Highlight kind="normal">      MergedResult = SpillSlot;</Highlight></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MergedResult;</Highlight></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: We can do better for PHI nodes. In cases like this:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   ptr = phi(relocated&#95;pointer, not&#95;relocated&#95;pointer)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   statepoint(ptr)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We will return that stack slot for ptr is unknown. And later we might</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// assign different stack slots for ptr and relocated&#95;pointer. This limits</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// llvm&#39;s ability to remove redundant stores.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Unfortunately it&#39;s hard to accomplish in current infrastructure.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We use this function to eliminate spill store completely, while</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in example we still need to emit store, but instead of any location</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we need to use special &quot;preferred&quot; location.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: handle simple updates.  If a value is modified and the original</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// value is no longer live, it would be nice to put the modified value in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// same slot.  This allows folding of the memory accesses for some</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instructions types (like an increment).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   statepoint (i)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   i1 = i+1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   statepoint (i1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// However we need to be careful for cases like this:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   statepoint(i)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   i1 = i+1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   statepoint(i, i1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Here we want to reserve spill slot for &#39;i&#39;, but not for &#39;i+1&#39;. If we just</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// put handling of simple modifications in this function like it&#39;s done</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// for bitcasts we might end up reserving i&#39;s slot for &#39;i+1&#39; because order in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// which we visit values is unspecified.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Don&#39;t know any information about this instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><Highlight kind="comment">/// Return true if-and-only-if the given SDValue can be lowered as either a</Highlight></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><Highlight kind="comment">/// constant argument or a stack reference.  The key point is that the value</Highlight></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><Highlight kind="comment">/// doesn&#39;t need to be spilled or tracked as a vreg use.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247" lineLink="#a8300a0e0276d27757963efa800126f14"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a8300a0e0276d27757963efa800126f14">willLowerDirectly</a>(<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/structs/llvm/incoming">Incoming</a>) &#123;</Highlight></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We are making an unchecked assumption that the frame size &lt;= 2^16 as that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is the largest offset which can be encoded in the stackmap format.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FrameIndexSDNode&gt;</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>))</Highlight></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The largest constant describeable in the StackMap format is 64 bits.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Potential Optimization:  Constants values are sign extended by consumer,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and thus there are many constants of static type &gt; 64 bits whose value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// happens to be sext(Con64) and could thus be lowered directly.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/incoming">Incoming</a>.getValueType().getSizeInBits() &gt; 64)</Highlight></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a2e392c596f41ac56b67f31c2e4b33dd1">isIntOrFPConstant</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>) || <a href="/docs/api/structs/llvm/incoming">Incoming</a>.isUndef();</Highlight></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><Highlight kind="comment">/// Try to find existing copies of the incoming values in stack slots used for</Highlight></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><Highlight kind="comment">/// statepoint spilling.  If we can find a spill slot for the incoming value,</Highlight></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><Highlight kind="comment">/// mark that slot as allocated, and reuse the same slot for this safepoint.</Highlight></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><Highlight kind="comment">/// This helps to avoid series of loads and stores that only serve to reshuffle</Highlight></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><Highlight kind="comment">/// values on the stack between calls.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268" lineLink="#adec63d991d7eb048d87fa3888099c848"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#adec63d991d7eb048d87fa3888099c848">reservePreviousStackSlotForValue</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;IncomingValue,</Highlight></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><Highlight kind="normal">                                             <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/structs/llvm/incoming">Incoming</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(IncomingValue);</Highlight></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we won&#39;t spill this, we don&#39;t need to check for previously allocated</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// stack slots.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a8300a0e0276d27757963efa800126f14">willLowerDirectly</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>))</Highlight></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> OldLocation = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.<a href="/docs/api/classes/llvm/statepointloweringstate/#a2e2d4007205a6b163daaf00e3aba04bd">getLocation</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</Highlight></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OldLocation.<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>())</Highlight></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Duplicates in input</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> LookUpDepth = 6;</Highlight></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><Highlight kind="normal">  std::optional&lt;int&gt; Index =</Highlight></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><Highlight kind="normal">      <a href="#a6ac2c0f0b7439c31332c78cd1ca5c4fe">findPreviousSpillSlot</a>(IncomingValue, Builder, LookUpDepth);</Highlight></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Index)</Highlight></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;StatepointSlots = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a9691f14813e0540e6a1c90cfdad39df3">StatepointStackSlots</a>;</Highlight></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SlotIt = <a href="/docs/api/namespaces/llvm/#a086e9fbdb06276db7753101a08a63adf">find</a>(StatepointSlots, &#42;Index);</Highlight></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SlotIt != StatepointSlots.end() &amp;&amp;</Highlight></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Value spilled to the unknown stack slot&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is one of our dedicated lowering slots</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = std::distance(StatepointSlots.begin(), SlotIt);</Highlight></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.<a href="/docs/api/classes/llvm/statepointloweringstate/#a6cdb26e5268cc05eb7f9726a140f1ae2">isStackSlotAllocated</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>)) &#123;</Highlight></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// stack slot already assigned to someone else, can&#39;t use it!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: currently we reserve space for gc arguments after doing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// normal allocation for deopt arguments.  We should reserve for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#95;all&#95; deopt and gc arguments, then start allocating.  This</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// will prevent some moves being inserted when vm state changes,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// but gc state doesn&#39;t between two calls.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Reserve this stack slot</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.<a href="/docs/api/classes/llvm/statepointloweringstate/#af93bbb466651e3e6abdf9e35c0a34b30">reserveStackSlot</a>(<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</Highlight></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Cache this slot so we find it when going through the normal</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// assignment loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/namespaces/llvm/loc">Loc</a> =</Highlight></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#a6ececde40ed933c2dfb5af16cb002529">getTargetFrameIndex</a>(&#42;Index, Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>());</Highlight></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.<a href="/docs/api/classes/llvm/statepointloweringstate/#a83f9edf0427d9c6d437318242326e331">setLocation</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>, <a href="/docs/api/namespaces/llvm/loc">Loc</a>);</Highlight></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><Highlight kind="comment">/// Extract call from statepoint, lower it and return pointer to the</Highlight></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><Highlight kind="comment">/// call node. Also update NodeMap so that getValue(statepoint) will</Highlight></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><Highlight kind="comment">/// reference lowered call result</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318" lineLink="#af8947d9c8165e82094241d319758e0c5"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> std::pair&lt;SDValue, SDNode &#42;&gt; <a href="#af8947d9c8165e82094241d319758e0c5">lowerCallFromStatepointLoweringInfo</a>(</Highlight></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/selectiondagbuilder/statepointloweringinfo">SelectionDAGBuilder::StatepointLoweringInfo</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>,</Highlight></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> ReturnValue, CallEndVal;</Highlight></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><Highlight kind="normal">  std::tie(ReturnValue, CallEndVal) =</Highlight></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ab29b69c993fbb9a4b9d28c3600df005d">lowerInvokable</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.CLI, <a href="/docs/api/namespaces/llvm/si">SI</a>.EHPadBB);</Highlight></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdnode">SDNode</a> &#42;CallEnd = CallEndVal.<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>();</Highlight></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get a call instruction from the call sequence chain.  Tail calls are not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// allowed.  The following code is essentially reverse engineering X86&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// LowerCallTo.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We are expecting DAG to have the following form:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ch = eh&#95;label (only in case of invoke statepoint)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   ch, glue = callseq&#95;start ch</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   ch, glue = X86::Call ch, glue</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   ch, glue = callseq&#95;end ch, glue</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   get&#95;return&#95;value ch, glue</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// get&#95;return&#95;value can either be a sequence of CopyFromReg instructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to grab the return value from the return register(s), or it can be a LOAD</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to load a value returned by reference via a stack slot.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a23f2f5947fc429aff1270651c6d019ea">getOpcode</a>() == ISD::EH&#95;LABEL)</Highlight></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><Highlight kind="normal">    CallEnd = CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a8388f666d6e735f35837ad03ed1f7a7a">getOperand</a>(0).<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>();</Highlight></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasDef = !<a href="/docs/api/namespaces/llvm/si">SI</a>.CLI.RetTy-&gt;isVoidTy();</Highlight></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasDef) &#123;</Highlight></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a23f2f5947fc429aff1270651c6d019ea">getOpcode</a>() == ISD::LOAD)</Highlight></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><Highlight kind="normal">      CallEnd = CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a8388f666d6e735f35837ad03ed1f7a7a">getOperand</a>(0).<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>();</Highlight></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a23f2f5947fc429aff1270651c6d019ea">getOpcode</a>() == <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a84c47705bcf7271413738ae8bf3871e6">ISD::CopyFromReg</a>)</Highlight></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><Highlight kind="normal">        CallEnd = CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a8388f666d6e735f35837ad03ed1f7a7a">getOperand</a>(0).<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>();</Highlight></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a23f2f5947fc429aff1270651c6d019ea">getOpcode</a>() == ISD::CALLSEQ&#95;END &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;expected!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::make&#95;pair(ReturnValue, CallEnd-&gt;<a href="/docs/api/classes/llvm/sdnode/#a8388f666d6e735f35837ad03ed1f7a7a">getOperand</a>(0).<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>());</Highlight></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358" lineLink="#aec1de11231135901271d92c7d90dae60"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a>&#42; <a href="#aec1de11231135901271d92c7d90dae60">getMachineMemOperand</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF,</Highlight></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><Highlight kind="normal">                                               <a href="/docs/api/classes/llvm/frameindexsdnode">FrameIndexSDNode</a> &amp;FI) &#123;</Highlight></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> PtrInfo = <a href="/docs/api/structs/llvm/machinepointerinfo/#ad8ce1aee13dbdcc05d20284a30e83170">MachinePointerInfo::getFixedStack</a>(MF, FI.<a href="/docs/api/classes/llvm/frameindexsdnode/#a1cf719b8c945859e29131c892774b21c">getIndex</a>());</Highlight></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MMOFlags = <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2ddaed357b1367bc90a56fefa4d1b0e17374">MachineMemOperand::MOStore</a> |</Highlight></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2dda7d12be6206e5b0026c71bbcd5cb76494">MachineMemOperand::MOLoad</a> | <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2dda796891d6ca349b671fce24b6d01d77a8">MachineMemOperand::MOVolatile</a>;</Highlight></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;MFI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</Highlight></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MF.<a href="/docs/api/classes/llvm/machinefunction/#a453ae3052b4f5b14cb4c184243ce5027">getMachineMemOperand</a>(PtrInfo, MMOFlags,</Highlight></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><Highlight kind="normal">                                 MFI.getObjectSize(FI.<a href="/docs/api/classes/llvm/frameindexsdnode/#a1cf719b8c945859e29131c892774b21c">getIndex</a>()),</Highlight></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><Highlight kind="normal">                                 MFI.getObjectAlign(FI.<a href="/docs/api/classes/llvm/frameindexsdnode/#a1cf719b8c945859e29131c892774b21c">getIndex</a>()));</Highlight></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><Highlight kind="comment">/// Spill a value incoming to the statepoint. It might be either part of</Highlight></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><Highlight kind="comment">/// vmstate</Highlight></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><Highlight kind="comment">/// or gcstate. In both cases unconditionally spill it on the stack unless it</Highlight></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><Highlight kind="comment">/// is a null constant. Return pair with first element being frame index</Highlight></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><Highlight kind="comment">/// containing saved value and second element with outgoing chain from the</Highlight></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><Highlight kind="comment">/// emitted store</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> std::tuple&lt;SDValue, SDValue, MachineMemOperand&#42;&gt;</Highlight></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376" lineLink="#afb9b4b3ff97e290070f42849b51a13a5"><Highlight kind="normal"><a href="#afb9b4b3ff97e290070f42849b51a13a5">spillIncomingStatepointValue</a>(<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/structs/llvm/incoming">Incoming</a>, <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Chain,</Highlight></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/namespaces/llvm/loc">Loc</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.<a href="/docs/api/classes/llvm/statepointloweringstate/#a2e2d4007205a6b163daaf00e3aba04bd">getLocation</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</Highlight></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinememoperand">MachineMemOperand</a>&#42; MMO = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Emit new store if we didn&#39;t do it for this ptr before</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/loc">Loc</a>.getNode()) &#123;</Highlight></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/loc">Loc</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.<a href="/docs/api/classes/llvm/statepointloweringstate/#a4841be2489ba10321338a1874b53f249">allocateStackSlot</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>.getValueType(),</Highlight></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><Highlight kind="normal">                                                       Builder);</Highlight></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> Index = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FrameIndexSDNode&gt;</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>)-&gt;getIndex();</Highlight></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We use TargetFrameIndex so that isel will not select it into LEA</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/loc">Loc</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#a6ececde40ed933c2dfb5af16cb002529">getTargetFrameIndex</a>(Index, Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>());</Highlight></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Right now we always allocate spill slots that are of the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// size as the value we&#39;re about to spill (the size of spillee can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// vary since we spill vectors of pointers too).  At some point we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// can consider allowing spills of smaller values to larger slots</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (i.e. change the &#39;==&#39; in the assert below to a &#39;&gt;=&#39;).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machineframeinfo">MachineFrameInfo</a> &amp;MFI = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#ac64ec73b0617befef1fb2eae78d12b5f">getMachineFunction</a>().<a href="/docs/api/classes/llvm/machinefunction/#a54f334a9c8ca6d105eae383ae87e4524">getFrameInfo</a>();</Highlight></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a9284fd53296d2a2f8ae654d000971000">getObjectSize</a>(Index) &#42; 8) ==</Highlight></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><Highlight kind="normal">               (-8 &amp; (7 + </Highlight><Highlight kind="comment">// Round up modulo 8</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><Highlight kind="normal">                      (int64&#95;t)<a href="/docs/api/structs/llvm/incoming">Incoming</a>.getValueSizeInBits())) &amp;&amp;</Highlight></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Bad spill:  stack slot does not match!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Note: Using the alignment of the spill slot (rather than the abi or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// preferred alignment) is required for correctness when dealing with spill</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// slots with preferred alignments larger than frame alignment..</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;MF = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#ac64ec73b0617befef1fb2eae78d12b5f">getMachineFunction</a>();</Highlight></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> PtrInfo = <a href="/docs/api/structs/llvm/machinepointerinfo/#ad8ce1aee13dbdcc05d20284a30e83170">MachinePointerInfo::getFixedStack</a>(MF, Index);</Highlight></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;StoreMMO = MF.getMachineMemOperand(</Highlight></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><Highlight kind="normal">        PtrInfo, <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2ddaed357b1367bc90a56fefa4d1b0e17374">MachineMemOperand::MOStore</a>, MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a9284fd53296d2a2f8ae654d000971000">getObjectSize</a>(Index),</Highlight></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><Highlight kind="normal">        MFI.<a href="/docs/api/classes/llvm/machineframeinfo/#a8320a54de0a273478de910ac3795058b">getObjectAlign</a>(Index));</Highlight></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><Highlight kind="normal">    Chain = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#a89ed6b26ee4f62aec32468329f828a2f">getStore</a>(Chain, Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), <a href="/docs/api/structs/llvm/incoming">Incoming</a>, <a href="/docs/api/namespaces/llvm/loc">Loc</a>,</Highlight></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><Highlight kind="normal">                                 StoreMMO);</Highlight></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><Highlight kind="normal">    MMO = <a href="#aec1de11231135901271d92c7d90dae60">getMachineMemOperand</a>(MF, &#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FrameIndexSDNode&gt;</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>));</Highlight></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><Highlight kind="normal">    Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.<a href="/docs/api/classes/llvm/statepointloweringstate/#a83f9edf0427d9c6d437318242326e331">setLocation</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>, <a href="/docs/api/namespaces/llvm/loc">Loc</a>);</Highlight></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>.getNode());</Highlight></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::make&#95;tuple(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, Chain, MMO);</Highlight></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><Highlight kind="comment">/// Lower a single value incoming to a statepoint node.  This value can be</Highlight></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><Highlight kind="comment">/// either a deopt value or a gc value, the handling is the same.  We special</Highlight></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><Highlight kind="comment">/// case constants and allocas, then fall back to spilling if required.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424" lineLink="#a1692829d8158767fe5ac1809c90a77a3"><Highlight kind="normal"><a href="#a1692829d8158767fe5ac1809c90a77a3">lowerIncomingStatepointValue</a>(<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/structs/llvm/incoming">Incoming</a>, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> RequireSpillSlot,</Highlight></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;SDValue&gt;</a> &amp;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>,</Highlight></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineMemOperand &#42;&gt;</a> &amp;MemRefs,</Highlight></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><Highlight kind="normal">  </Highlight></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a8300a0e0276d27757963efa800126f14">willLowerDirectly</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>)) &#123;</Highlight></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/frameindexsdnode">FrameIndexSDNode</a> &#42;FI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FrameIndexSDNode&gt;</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>)) &#123;</Highlight></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This handles allocas as arguments to the statepoint (this is only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// really meaningful for a deopt value.  For GC, we&#39;d be trying to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// relocate the address of the alloca itself?)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>.getValueType() == Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Incoming value is a frame index!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#a6ececde40ed933c2dfb5af16cb002529">getTargetFrameIndex</a>(FI-&gt;getIndex(),</Highlight></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><Highlight kind="normal">                                                    Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>()));</Highlight></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;MF = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#ac64ec73b0617befef1fb2eae78d12b5f">getMachineFunction</a>();</Highlight></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MMO = <a href="#aec1de11231135901271d92c7d90dae60">getMachineMemOperand</a>(MF, &#42;FI);</Highlight></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><Highlight kind="normal">      MemRefs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MMO);</Highlight></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>.getValueType().getSizeInBits() &lt;= 64);</Highlight></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><Highlight kind="normal">    </Highlight></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/incoming">Incoming</a>.isUndef()) &#123;</Highlight></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Put an easily recognized constant that&#39;s unlikely to be a valid</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// value so that uses of undef by the consumer of the stackmap is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// easily recognized. This is legal since the compiler is always</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// allowed to chose an arbitrary value for undef.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><Highlight kind="normal">      <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, Builder, 0xFEFEFEFE);</Highlight></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the original value was a constant, make sure it gets recorded as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// such in the stackmap.  This is required so that the consumer can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// parse any internal format to the deopt state.  It also handles null</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// pointers and other constant pointers in GC states.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constantsdnode">ConstantSDNode</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantSDNode&gt;</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>)) &#123;</Highlight></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><Highlight kind="normal">      <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, Builder, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getSExtValue());</Highlight></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/constantfpsdnode">ConstantFPSDNode</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantFPSDNode&gt;</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>)) &#123;</Highlight></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><Highlight kind="normal">      <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, Builder,</Highlight></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><Highlight kind="normal">                           <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getValueAPF().bitcastToAPInt().getZExtValue());</Highlight></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;unhandled direct lowering case&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RequireSpillSlot) &#123;</Highlight></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this value is live in (not live-on-return, or live-through), we can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// treat it the same way patchpoint treats it&#39;s &quot;live in&quot; values.  We&#39;ll</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// end up folding some of these into stack references, but they&#39;ll be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// handled by the register allocator.  Note that we do not have the notion</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// of a late use so these values might be placed in registers which are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// clobbered by the call.  This is fine for live-in. For live-through</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// fix-up pass should be executed to force spilling of such registers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</Highlight></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise, locate a spill slot and explicitly spill it so it can be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// found by the runtime later.  Note: We know all of these spills are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// independent, but don&#39;t bother to exploit that chain wise.  DAGCombine</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// will happily do so as needed, so doing it here would be a small compile</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// time win at most. </Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Chain = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#aa3e946c1fc678a70e849244389bd929a">getRoot</a>();</Highlight></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Res = <a href="#afb9b4b3ff97e290070f42849b51a13a5">spillIncomingStatepointValue</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>, Chain, Builder);</Highlight></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(std::get&lt;0&gt;(Res));</Highlight></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MMO = std::get&lt;2&gt;(Res))</Highlight></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><Highlight kind="normal">      MemRefs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MMO);</Highlight></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><Highlight kind="normal">    Chain = std::get&lt;1&gt;(Res);</Highlight></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><Highlight kind="normal">    Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#ae0fc3f54d06d2230bf93a19d45f51706">setRoot</a>(Chain);</Highlight></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><Highlight kind="comment">/// Return true if value V represents the GC value. The behavior is conservative</Highlight></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><Highlight kind="comment">/// in case it is not sure that value is not GC the function returns true.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502" lineLink="#a720af7e7f23150174952da03d216341a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a720af7e7f23150174952da03d216341a">isGCValue</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Ty = V-&gt;getType();</Highlight></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Ty-&gt;isPtrOrPtrVectorTy())</Highlight></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;GFI = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a9b4db8b8082660004fda0c282da0ff0a">GFI</a>)</Highlight></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsManaged = GFI-&gt;getStrategy().isGCManagedPointer(Ty))</Highlight></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;IsManaged;</Highlight></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// conservative</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><Highlight kind="comment">/// Lower deopt state and gc pointer arguments of the statepoint.  The actual</Highlight></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><Highlight kind="comment">/// lowering is described in lowerIncomingStatepointValue.  This function is</Highlight></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><Highlight kind="comment">/// responsible for lowering everything in the right position and playing some</Highlight></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><Highlight kind="comment">/// tricks to avoid redundant stack manipulation where possible.  On</Highlight></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><Highlight kind="comment">/// completion, &#39;Ops&#39; will contain ready to use operands for machine code</Highlight></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><Highlight kind="comment">/// statepoint. The chain nodes will have already been created and the DAG root</Highlight></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><Highlight kind="comment">/// will be set to the last value spilled (if any were).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520" lineLink="#a9029ef3db44eac67782fd8ccb7796a0c"><Highlight kind="normal"><a href="#a9029ef3db44eac67782fd8ccb7796a0c">lowerStatepointMetaArgs</a>(<a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;SDValue&gt;</a> &amp;<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>,</Highlight></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineMemOperand &#42;&gt;</a> &amp;MemRefs,</Highlight></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;SDValue&gt;</a> &amp;GCPtrs,</Highlight></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;SDValue, int&gt;</a> &amp;LowerAsVReg,</Highlight></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><Highlight kind="normal">                        <a href="/docs/api/structs/llvm/selectiondagbuilder/statepointloweringinfo">SelectionDAGBuilder::StatepointLoweringInfo</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>,</Highlight></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/selectiondagbuilder">SelectionDAGBuilder</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Lower the deopt and gc arguments for this statepoint.  Layout will be:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// deopt argument length, deopt arguments.., gc arguments...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Figure out what lowering strategy we&#39;re going to use for each part</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note: It is conservatively correct to lower both &quot;live-in&quot; and &quot;live-out&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// as &quot;live-through&quot;. A &quot;live-through&quot; variable is one which is &quot;live-in&quot;,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &quot;live-out&quot;, and live throughout the lifetime of the call (i.e. we can find</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// it from any PC within the transitive callee of the statepoint).  In</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// particular, if the callee spills callee preserved registers we may not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// be able to find a value placed in that register during the call.  This is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// fine for live-out, but not for live-through.  If we were willing to make</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// assumptions about the code generator producing the callee, we could</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// potentially allow live-through values in callee saved registers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> LiveInDeopt =</Highlight></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointFlags &amp; (uint64&#95;t)<a href="/docs/api/namespaces/llvm/#abba0f0474eb4e32d1ed7b6dfdb0d5140a8cf633e3cd4e8b21a16304c58495bfbc">StatepointFlags::DeoptLiveIn</a>;</Highlight></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Decide which deriver pointers will go on VRegs</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxVRegPtrs = <a href="#adc011fee2f0e40238d54aa2a8820c728">MaxRegistersForGCPointers</a>.getValue();</Highlight></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Pointers used on exceptional path of invoke statepoint.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We cannot assing them to VRegs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;SDValue, 8&gt;</a> LPadPointers;</Highlight></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a08e0d3f870d52149756ca3cec34ab6a0">UseRegistersForGCPointersInLandingPad</a>)</Highlight></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;StInvoke =</Highlight></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;InvokeInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointInstr)) &#123;</Highlight></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/landingpadinst">LandingPadInst</a> &#42;LPI = StInvoke-&gt;getLandingPadInst();</Highlight></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Relocate : <a href="/docs/api/namespaces/llvm/si">SI</a>.GCRelocates)</Highlight></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Relocate-&gt;getOperand(0) == LPI) &#123;</Highlight></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><Highlight kind="normal">          LPadPointers.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(Relocate-&gt;getBasePtr()));</Highlight></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><Highlight kind="normal">          LPadPointers.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(Relocate-&gt;getDerivedPtr()));</Highlight></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Deciding how to lower GC Pointers:\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// List of unique lowered GC Pointer values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;SDValue, 16&gt;</a> LoweredGCPtrs;</Highlight></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Map lowered GC Pointer value to the index in above vector</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;SDValue, unsigned&gt;</a> GCPtrIndexMap;</Highlight></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> CurNumVRegs = 0;</Highlight></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> canPassGCPtrOnVReg = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> SD) &#123;</Highlight></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SD.getValueType().isVector())</Highlight></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LPadPointers.<a href="/docs/api/classes/llvm/smallset/#a2a98f19750ba941ce791b75ca6d77e48">count</a>(SD))</Highlight></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !<a href="#a8300a0e0276d27757963efa800126f14">willLowerDirectly</a>(SD);</Highlight></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> processGCPtr = &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> PtrSD = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V);</Highlight></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoweredGCPtrs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(PtrSD))</Highlight></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// skip duplicates</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><Highlight kind="normal">    GCPtrIndexMap&#91;PtrSD&#93; = LoweredGCPtrs.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>() - 1;</Highlight></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(PtrSD) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;must not have been seen&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a3d95cc2d359b8d9ed5bd9504b44930b5">size</a>() == MaxVRegPtrs)</Highlight></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V-&gt;getType()-&gt;isVectorTy() == PtrSD.<a href="/docs/api/classes/llvm/sdvalue/#a6b2b8ca5b0fdf6484247d5ae74deb9ff">getValueType</a>().<a href="/docs/api/structs/llvm/evt/#aa54976197fff266f4143beb44fc9764c">isVector</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;IR and SD types disagree&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!canPassGCPtrOnVReg(PtrSD)) &#123;</Highlight></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;direct/spill &quot;</Highlight><Highlight kind="normal">; PtrSD.<a href="/docs/api/classes/llvm/sdvalue/#a68cdc2666693dffb9173a9dffee11ab8">dump</a>(&amp;Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>));</Highlight></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;vreg &quot;</Highlight><Highlight kind="normal">; PtrSD.<a href="/docs/api/classes/llvm/sdvalue/#a68cdc2666693dffb9173a9dffee11ab8">dump</a>(&amp;Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>));</Highlight></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><Highlight kind="normal">    LowerAsVReg&#91;PtrSD&#93; = CurNumVRegs++;</Highlight></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Process derived pointers first to give them more chance to go on VReg.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs)</Highlight></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><Highlight kind="normal">    processGCPtr(V);</Highlight></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.Bases)</Highlight></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><Highlight kind="normal">    processGCPtr(V);</Highlight></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a3d95cc2d359b8d9ed5bd9504b44930b5">size</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; pointers will go in vregs\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> requireSpillSlot = &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#a4c20c587f89ae2926f9e8a99093e8419">getTargetLoweringInfo</a>().<a href="/docs/api/classes/llvm/targetloweringbase/#a80b305b278aa0e04f80312e15b2b6d54">isTypeLegal</a>(</Highlight></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><Highlight kind="normal">             Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V).<a href="/docs/api/classes/llvm/sdvalue/#a6b2b8ca5b0fdf6484247d5ae74deb9ff">getValueType</a>()))</Highlight></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a720af7e7f23150174952da03d216341a">isGCValue</a>(V, Builder))</Highlight></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V));</Highlight></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !(LiveInDeopt || <a href="#ab9bf191372abad68cbfc02b4e33cebc6">UseRegistersForDeoptValues</a>);</Highlight></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Before we actually start lowering (and allocating spill slots for values),</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reserve any stack slots which we judge to be profitable to reuse for a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// particular value.  This is purely an optimization over the code below and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// doesn&#39;t change semantics at all.  It is important for performance that we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reserve slots for both deopt and gc values before lowering either.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.DeoptState) &#123;</Highlight></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (requireSpillSlot(V))</Highlight></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><Highlight kind="normal">      <a href="#adec63d991d7eb048d87fa3888099c848">reservePreviousStackSlotForValue</a>(V, Builder);</Highlight></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs) &#123;</Highlight></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> SDV = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V);</Highlight></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SDV))</Highlight></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><Highlight kind="normal">      <a href="#adec63d991d7eb048d87fa3888099c848">reservePreviousStackSlotForValue</a>(V, Builder);</Highlight></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.Bases) &#123;</Highlight></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> SDV = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V);</Highlight></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SDV))</Highlight></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><Highlight kind="normal">      <a href="#adec63d991d7eb048d87fa3888099c848">reservePreviousStackSlotForValue</a>(V, Builder);</Highlight></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// First, prefix the list with the number of unique values to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// lowered.  Note that this is the number of &#42;Values&#42; not the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// number of SDValues required to lower them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> NumVMSArgs = <a href="/docs/api/namespaces/llvm/si">SI</a>.DeoptState.size();</Highlight></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><Highlight kind="normal">  <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, Builder, NumVMSArgs);</Highlight></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The vm state arguments are lowered in an opaque manner.  We do not know</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// what type of values are contained within.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Lowering deopt state\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.DeoptState) &#123;</Highlight></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/structs/llvm/incoming">Incoming</a>;</Highlight></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this is a function argument at a static frame index, generate it as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the frame index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/argument">Argument</a> &#42;Arg = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Argument&gt;</a>(V)) &#123;</Highlight></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> FI = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.<a href="/docs/api/classes/llvm/functionloweringinfo/#a4adbd2ebdab9c844ce0443c43c3ee16d">getArgumentFrameIndex</a>(Arg);</Highlight></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FI != INT&#95;MAX)</Highlight></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><Highlight kind="normal">        <a href="/docs/api/structs/llvm/incoming">Incoming</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#acb59cbd8f4a8c1cf820b2b540aebdac1">getFrameIndex</a>(FI, Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>());</Highlight></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/structs/llvm/incoming">Incoming</a>.getNode())</Highlight></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/incoming">Incoming</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V);</Highlight></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Value &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;V</Highlight></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; requireSpillSlot = &quot;</Highlight><Highlight kind="normal"> &lt;&lt; requireSpillSlot(V) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><Highlight kind="normal">    <a href="#a1692829d8158767fe5ac1809c90a77a3">lowerIncomingStatepointValue</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>, requireSpillSlot(V), <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, MemRefs,</Highlight></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><Highlight kind="normal">                                 Builder);</Highlight></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Finally, go ahead and lower all the gc arguments.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><Highlight kind="normal">  <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, Builder, LoweredGCPtrs.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>());</Highlight></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> SDV : LoweredGCPtrs)</Highlight></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><Highlight kind="normal">    <a href="#a1692829d8158767fe5ac1809c90a77a3">lowerIncomingStatepointValue</a>(SDV, !LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SDV), <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, MemRefs,</Highlight></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><Highlight kind="normal">                                 Builder);</Highlight></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Copy to out vector. LoweredGCPtrs will be empty after this point.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><Highlight kind="normal">  GCPtrs = LoweredGCPtrs.<a href="/docs/api/classes/llvm/setvector/#a7c36580f905b274ca0a1ade46ba06ae0">takeVector</a>();</Highlight></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there are any explicit spill slots passed to the statepoint, record</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// them, but otherwise do not do anything special.  These are user provided</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// allocas and give control over placement to the consumer.  In this case,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// it is the contents of the slot which may get updated, not the pointer to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the alloca</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SDValue, 4&gt;</a> Allocas;</Highlight></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.GCLives) &#123;</Highlight></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/structs/llvm/incoming">Incoming</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V);</Highlight></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/frameindexsdnode">FrameIndexSDNode</a> &#42;FI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FrameIndexSDNode&gt;</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>)) &#123;</Highlight></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This handles allocas as arguments to the statepoint</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>.getValueType() == Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Incoming value is a frame index!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><Highlight kind="normal">      Allocas.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#a6ececde40ed933c2dfb5af16cb002529">getTargetFrameIndex</a>(</Highlight></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><Highlight kind="normal">          FI-&gt;getIndex(), Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>()));</Highlight></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;MF = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#ac64ec73b0617befef1fb2eae78d12b5f">getMachineFunction</a>();</Highlight></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MMO = <a href="#aec1de11231135901271d92c7d90dae60">getMachineMemOperand</a>(MF, &#42;FI);</Highlight></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><Highlight kind="normal">      MemRefs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MMO);</Highlight></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><Highlight kind="normal">  <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, Builder, Allocas.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>());</Highlight></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.append(Allocas.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Allocas.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</Highlight></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now construct GC base/derived map;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><Highlight kind="normal">  <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, Builder, <a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs.size());</Highlight></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdloc">SDLoc</a> L = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>();</Highlight></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i &lt; <a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs.size(); ++i) &#123;</Highlight></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.Bases&#91;i&#93;);</Highlight></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GCPtrIndexMap.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;base not found in index map&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(</Highlight></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><Highlight kind="normal">        Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#abf892d1e00a3d79026c5ab518c187c45">getTargetConstant</a>(GCPtrIndexMap&#91;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>&#93;, L, MVT::i64));</Highlight></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Derived = Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs&#91;i&#93;);</Highlight></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(GCPtrIndexMap.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(Derived) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;derived not found in index map&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(</Highlight></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><Highlight kind="normal">        Builder.<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.<a href="/docs/api/classes/llvm/selectiondag/#abf892d1e00a3d79026c5ab518c187c45">getTargetConstant</a>(GCPtrIndexMap&#91;Derived&#93;, L, MVT::i64));</Highlight></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707" lineLink="/docs/api/classes/llvm/selectiondagbuilder/#afe97e2bc5bd74272ca1b54da1fb30e06"><Highlight kind="normal"><a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/classes/llvm/selectiondagbuilder/#afe97e2bc5bd74272ca1b54da1fb30e06">SelectionDAGBuilder::LowerAsSTATEPOINT</a>(</Highlight></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/selectiondagbuilder/statepointloweringinfo">SelectionDAGBuilder::StatepointLoweringInfo</a> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</Highlight></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The basic scheme here is that information about both the original call and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the safepoint is encoded in the CallInst.  We create a temporary call and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// lower it, then reverse engineer the calling sequence.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><Highlight kind="normal">  NumOfStatepoints++;</Highlight></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Clear state</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.startNewStatepoint(&#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.Bases.size() == <a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs.size() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Pointer without base!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/classes/llvm/selectiondagbuilder/#a9b4db8b8082660004fda0c282da0ff0a">GFI</a> || <a href="/docs/api/namespaces/llvm/si">SI</a>.Bases.empty()) &amp;&amp;</Highlight></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;No gc specified, so cannot relocate pointers!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointInstr) <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</Highlight></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Lowering statepoint &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointInstr &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/reloc">Reloc</a> : <a href="/docs/api/namespaces/llvm/si">SI</a>.GCRelocates)</Highlight></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/reloc">Reloc</a>-&gt;getParent() == <a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointInstr-&gt;getParent())</Highlight></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.scheduleRelocCall(&#42;<a href="/docs/api/namespaces/llvm/reloc">Reloc</a>);</Highlight></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Lower statepoint vmstate and gcstate arguments</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// All lowered meta args.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SDValue, 10&gt;</a> LoweredMetaArgs;</Highlight></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Lowered GC pointers (subset of above).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SDValue, 16&gt;</a> LoweredGCArgs;</Highlight></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineMemOperand&#42;, 16&gt;</a> MemRefs;</Highlight></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Maps derived pointer SDValue to statepoint result of relocated pointer.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;SDValue, int&gt;</a> LowerAsVReg;</Highlight></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><Highlight kind="normal">  <a href="#a9029ef3db44eac67782fd8ccb7796a0c">lowerStatepointMetaArgs</a>(LoweredMetaArgs, MemRefs, LoweredGCArgs, LowerAsVReg,</Highlight></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><Highlight kind="normal">                          <a href="/docs/api/namespaces/llvm/si">SI</a>, &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now that we&#39;ve emitted the spills, we need to update the root so that the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// call sequence is ordered correctly.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.CLI.setChain(<a href="/docs/api/classes/llvm/selectiondagbuilder/#aa3e946c1fc678a70e849244389bd929a">getRoot</a>());</Highlight></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get call node, we will replace it later with statepoint</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> ReturnVal;</Highlight></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdnode">SDNode</a> &#42;CallNode;</Highlight></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><Highlight kind="normal">  std::tie(ReturnVal, CallNode) = <a href="#af8947d9c8165e82094241d319758e0c5">lowerCallFromStatepointLoweringInfo</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Construct the actual GC&#95;TRANSITION&#95;START, STATEPOINT, and GC&#95;TRANSITION&#95;END</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// nodes with all the appropriate arguments and return values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Call Node: Chain, Target, &#123;Args&#125;, RegMask, &#91;Glue&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Chain = CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#a8388f666d6e735f35837ad03ed1f7a7a">getOperand</a>(0);</Highlight></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Glue;</Highlight></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CallHasIncomingGlue = CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#ae1fa8ded9bce6f8321a69e99e41a473c">getGluedNode</a>();</Highlight></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallHasIncomingGlue) &#123;</Highlight></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Glue is always last operand</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><Highlight kind="normal">    Glue = CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#a8388f666d6e735f35837ad03ed1f7a7a">getOperand</a>(CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#a7f311fcc2415eee3cb3694013b985304">getNumOperands</a>() - 1);</Highlight></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Build the GC&#95;TRANSITION&#95;START node if necessary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The operands to the GC&#95;TRANSITION&#95;&#123;START,END&#125; nodes are laid out in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// order in which they appear in the call to the statepoint intrinsic. If</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// any of the operands is a pointer-typed, that operand is immediately</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// followed by a SRCVALUE for the pointer that may be used during lowering</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (e.g. to form MachinePointerInfo values for loads/stores).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsGCTransition =</Highlight></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><Highlight kind="normal">      (<a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointFlags &amp; (uint64&#95;t)<a href="/docs/api/namespaces/llvm/#abba0f0474eb4e32d1ed7b6dfdb0d5140a9db1ed1dc0fe1fc6b917ab0430b7844c">StatepointFlags::GCTransition</a>) ==</Highlight></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><Highlight kind="normal">      (uint64&#95;t)<a href="/docs/api/namespaces/llvm/#abba0f0474eb4e32d1ed7b6dfdb0d5140a9db1ed1dc0fe1fc6b917ab0430b7844c">StatepointFlags::GCTransition</a>;</Highlight></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsGCTransition) &#123;</Highlight></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SDValue, 8&gt;</a> TSOps;</Highlight></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add chain</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><Highlight kind="normal">    TSOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Chain);</Highlight></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add GC transition arguments</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> Value &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.GCTransitionArgs) &#123;</Highlight></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><Highlight kind="normal">      TSOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V));</Highlight></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V-&gt;getType()-&gt;isPointerTy())</Highlight></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><Highlight kind="normal">        TSOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getSrcValue(V));</Highlight></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add glue if necessary</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallHasIncomingGlue)</Highlight></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><Highlight kind="normal">      TSOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Glue);</Highlight></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/sdvtlist">SDVTList</a> NodeTys = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getVTList(MVT::Other, MVT::Glue);</Highlight></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> GCTransitionStart =</Highlight></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getNode(ISD::GC&#95;TRANSITION&#95;START, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), NodeTys, TSOps);</Highlight></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><Highlight kind="normal">    Chain = GCTransitionStart.<a href="/docs/api/classes/llvm/sdvalue/#a64932427432abeb61241e98bea167580">getValue</a>(0);</Highlight></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><Highlight kind="normal">    Glue = GCTransitionStart.<a href="/docs/api/classes/llvm/sdvalue/#a64932427432abeb61241e98bea167580">getValue</a>(1);</Highlight></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Currently, all of these operands are being marked as read/write in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// PrologEpilougeInserter.cpp, we should special case the VMState arguments</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and flags to be read-only.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SDValue, 40&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>;</Highlight></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add the &lt;id&gt; and &lt;numBytes&gt; constants.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetConstant(<a href="/docs/api/namespaces/llvm/si">SI</a>.ID, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), MVT::i64));</Highlight></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(</Highlight></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetConstant(<a href="/docs/api/namespaces/llvm/si">SI</a>.NumPatchBytes, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), MVT::i32));</Highlight></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Calculate and push starting position of vmstate arguments</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get number of arguments incoming directly into call node</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumCallRegArgs =</Highlight></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><Highlight kind="normal">      CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#a7f311fcc2415eee3cb3694013b985304">getNumOperands</a>() - (CallHasIncomingGlue ? 4 : 3);</Highlight></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetConstant(NumCallRegArgs, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), MVT::i32));</Highlight></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add call target</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> CallTarget = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>(CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#a8388f666d6e735f35837ad03ed1f7a7a">getOperand</a>(1).<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>(), 0);</Highlight></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(CallTarget);</Highlight></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add call arguments</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get position of register mask in the call</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdnode/#a423c330f7f1bd8f3510e2bb304435217">SDNode::op&#95;iterator</a> RegMaskIt;</Highlight></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CallHasIncomingGlue)</Highlight></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><Highlight kind="normal">    RegMaskIt = CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#ae499cc99d4fe44d343ca9ac6a2ae8845">op&#95;end</a>() - 2;</Highlight></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><Highlight kind="normal">    RegMaskIt = CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#ae499cc99d4fe44d343ca9ac6a2ae8845">op&#95;end</a>() - 1;</Highlight></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.insert(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.end(), CallNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#aee6bd1fd282469b3476efce4b707f09a">op&#95;begin</a>() + 2, RegMaskIt);</Highlight></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add a constant argument for the calling convention</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><Highlight kind="normal">  <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/si">SI</a>.CLI.CallConv);</Highlight></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add a constant argument for the flags</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><Highlight kind="normal">  uint64&#95;t Flags = <a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointFlags;</Highlight></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(((Flags &amp; ~(uint64&#95;t)<a href="/docs/api/namespaces/llvm/#abba0f0474eb4e32d1ed7b6dfdb0d5140a003ec4f8bc6c6d93aa1801253e494916">StatepointFlags::MaskAll</a>) == 0) &amp;&amp;</Highlight></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Unknown flag used&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><Highlight kind="normal">  <a href="#a720a77a05d768dabfa739d154c11ddfd">pushStackMapConstant</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, Flags);</Highlight></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Insert all vmstate and gcstate arguments</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">llvm::append&#95;range</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, LoweredMetaArgs);</Highlight></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add register mask from call node</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(&#42;RegMaskIt);</Highlight></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add chain</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(Chain);</Highlight></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Same for the glue, but we add it only if original call had it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Glue.<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>())</Highlight></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(Glue);</Highlight></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Compute return values.  Provide a glue output since we consume one as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// input.  This allows someone else to chain off us as needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;EVT, 8&gt;</a> NodeTys;</Highlight></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SD : LoweredGCArgs) &#123;</Highlight></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SD))</Highlight></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><Highlight kind="normal">    NodeTys.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(SD.getValueType());</Highlight></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Statepoint has &quot;</Highlight><Highlight kind="normal"> &lt;&lt; NodeTys.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; results\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NodeTys.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a3d95cc2d359b8d9ed5bd9504b44930b5">size</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Inconsistent GC Ptr lowering&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><Highlight kind="normal">  NodeTys.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MVT::Other);</Highlight></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><Highlight kind="normal">  NodeTys.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(MVT::Glue);</Highlight></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumResults = NodeTys.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</Highlight></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinesdnode">MachineSDNode</a> &#42;StatepointMCNode =</Highlight></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getMachineNode(TargetOpcode::STATEPOINT, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), NodeTys, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>);</Highlight></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.setNodeMemRefs(StatepointMCNode, MemRefs);</Highlight></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For values lowered to tied-defs, create the virtual registers if used</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in other blocks. For local gc.relocate record appropriate statepoint</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// result in StatepointLoweringState.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;SDValue, Register&gt;</a> VirtRegs;</Highlight></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Relocate : <a href="/docs/api/namespaces/llvm/si">SI</a>.GCRelocates) &#123;</Highlight></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><Highlight kind="normal">    Value &#42;Derived = Relocate-&gt;getDerivedPtr();</Highlight></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> SD = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(Derived);</Highlight></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> It = LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(SD);</Highlight></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It == LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>())</Highlight></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Relocated = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>(StatepointMCNode, It-&gt;second);</Highlight></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Handle local relocate. Note that different relocates might</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// map to the same SDValue.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointInstr-&gt;getParent() == Relocate-&gt;getParent()) &#123;</Highlight></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Res = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.getLocation(SD);</Highlight></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Res)</Highlight></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Res == Relocated);</Highlight></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.setLocation(SD, Relocated);</Highlight></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Handle multiple gc.relocates of the same input efficiently.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VirtRegs.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SD))</Highlight></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RetTy = Relocate-&gt;getType();</Highlight></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/register">Register</a> Reg = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.CreateRegs(RetTy);</Highlight></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/regsforvalue">RegsForValue</a> RFV(&#42;<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getContext(), <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetLoweringInfo(),</Highlight></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><Highlight kind="normal">                     <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getDataLayout(), Reg, RetTy, std::nullopt);</Highlight></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Chain = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getRoot();</Highlight></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><Highlight kind="normal">    RFV.<a href="/docs/api/structs/llvm/regsforvalue/#adf93dd21d49c19700e980b15f19cb7d7">getCopyToRegs</a>(Relocated, <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), Chain, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><Highlight kind="normal">    PendingExports.push&#95;back(Chain);</Highlight></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><Highlight kind="normal">    VirtRegs&#91;SD&#93; = Reg;</Highlight></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Record for later use how each relocation was lowered.  This is needed to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// allow later gc.relocates to mirror the lowering chosen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;StatepointInstr = <a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointInstr;</Highlight></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;RelocationMap = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.StatepointRelocationMaps&#91;StatepointInstr&#93;;</Highlight></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;Relocate : <a href="/docs/api/namespaces/llvm/si">SI</a>.GCRelocates) &#123;</Highlight></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> Value &#42;V = Relocate-&gt;<a href="/docs/api/classes/llvm/gcrelocateinst/#ae587391ac557593d998dbca4e62f0dab">getDerivedPtr</a>();</Highlight></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> SDV = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V);</Highlight></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> <a href="/docs/api/namespaces/llvm/loc">Loc</a> = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.getLocation(SDV);</Highlight></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsLocal = (Relocate-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() == StatepointInstr-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</Highlight></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><Highlight kind="normal">    RecordType <a href="/docs/api/classes/llvm/record">Record</a>;</Highlight></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsLocal &amp;&amp; LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SDV)) &#123;</Highlight></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Result is already stored in StatepointLowering</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/record">Record</a>.type = <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2cafcf3e806047173bc7c8581b355375870">RecordType::SDValueNode</a>;</Highlight></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LowerAsVReg.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SDV)) &#123;</Highlight></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/record">Record</a>.type = <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2cad7321692f596ba5573d414ce3452c26f">RecordType::VReg</a>;</Highlight></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VirtRegs.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(SDV));</Highlight></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/record">Record</a>.payload.Reg = VirtRegs&#91;SDV&#93;;</Highlight></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/loc">Loc</a>.getNode()) &#123;</Highlight></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/record">Record</a>.type = <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2ca4e2303faf0f163fb7a4af33f778884e8">RecordType::Spill</a>;</Highlight></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/record">Record</a>.payload.FI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;FrameIndexSDNode&gt;</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>)-&gt;getIndex();</Highlight></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/record">Record</a>.type = <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2cae1c6c7a77fab355eb08576b3bd29b924">RecordType::NoRelocate</a>;</Highlight></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we didn&#39;t relocate a value, we&#39;ll essentialy end up inserting an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// additional use of the original value when lowering the gc.relocate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We need to make sure the value is available at the new use, which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// might be in another block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Relocate-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != StatepointInstr-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</Highlight></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/selectiondagbuilder/#aa5254258c6a479f86e6ecfc4dcdd7a5e">ExportFromCurrentBlock</a>(V);</Highlight></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><Highlight kind="normal">    RelocationMap&#91;Relocate&#93; = <a href="/docs/api/classes/llvm/record">Record</a>;</Highlight></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><Highlight kind="normal">  </Highlight></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdnode">SDNode</a> &#42;SinkNode = StatepointMCNode;</Highlight></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Build the GC&#95;TRANSITION&#95;END node if necessary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// See the comment above regarding GC&#95;TRANSITION&#95;START for the layout of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the operands to the GC&#95;TRANSITION&#95;END node.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsGCTransition) &#123;</Highlight></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SDValue, 8&gt;</a> TEOps;</Highlight></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add chain</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><Highlight kind="normal">    TEOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>(StatepointMCNode, NumResults - 2));</Highlight></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add GC transition arguments</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> Value &#42;V : <a href="/docs/api/namespaces/llvm/si">SI</a>.GCTransitionArgs) &#123;</Highlight></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><Highlight kind="normal">      TEOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V));</Highlight></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V-&gt;getType()-&gt;isPointerTy())</Highlight></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><Highlight kind="normal">        TEOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getSrcValue(V));</Highlight></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add glue</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><Highlight kind="normal">    TEOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>(StatepointMCNode, NumResults - 1));</Highlight></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/sdvtlist">SDVTList</a> NodeTys = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getVTList(MVT::Other, MVT::Glue);</Highlight></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> GCTransitionStart =</Highlight></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getNode(ISD::GC&#95;TRANSITION&#95;END, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), NodeTys, TEOps);</Highlight></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><Highlight kind="normal">    SinkNode = GCTransitionStart.<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>();</Highlight></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace original call</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Call: ch,glue = CALL ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Statepoint: &#91;gc relocates&#93;,ch,glue = STATEPOINT ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumSinkValues = SinkNode-&gt;<a href="/docs/api/classes/llvm/sdnode/#a7f06dbaee5fa2b239de548d0a775b25b">getNumValues</a>();</Highlight></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> StatepointValues&#91;2&#93; = &#123;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>(SinkNode, NumSinkValues - 2),</Highlight></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><Highlight kind="normal">                                 <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a>(SinkNode, NumSinkValues - 1)&#125;;</Highlight></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.ReplaceAllUsesWith(CallNode, StatepointValues);</Highlight></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove original call node</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.DeleteNode(CallNode);</Highlight></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Since we always emit CopyToRegs (even for local relocates), we must</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// update root, so that they are emitted before any local uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><Highlight kind="normal">  (void)<a href="/docs/api/classes/llvm/selectiondagbuilder/#aef34360e8bb4bdecf3fd6345ff504f81">getControlRoot</a>();</Highlight></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: A better future implementation would be to emit a single variable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// argument, variable return value STATEPOINT node here and then hookup the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// return value of each gc.relocate to the respective output of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// previously emitted STATEPOINT value.  Unfortunately, this doesn&#39;t appear</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to actually be possible today.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ReturnVal;</Highlight></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><Highlight kind="comment">/// Return two gc.results if present.  First result is a block local</Highlight></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><Highlight kind="comment">/// gc.result, second result is a non-block local gc.result.  Corresponding</Highlight></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><Highlight kind="comment">/// entry will be nullptr if not present.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> std::pair&lt;const GCResultInst&#42;, const GCResultInst&#42;&gt;</Highlight></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999" lineLink="#ab1af1f498b4d814ee68810a03fbe28a7"><Highlight kind="normal"><a href="#ab1af1f498b4d814ee68810a03fbe28a7">getGCResultLocality</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/gcstatepointinst">GCStatepointInst</a> &amp;S) &#123;</Highlight></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><Highlight kind="normal">  std::pair&lt;const GCResultInst &#42;, const GCResultInst&#42;&gt; Res(</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : S.<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;GRI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GCResultInst&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GRI)</Highlight></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GRI-&gt;getParent() == S.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</Highlight></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><Highlight kind="normal">      Res.first = GRI;</Highlight></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><Highlight kind="normal">      Res.second = GRI;</Highlight></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Res;</Highlight></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014" lineLink="/docs/api/classes/llvm/selectiondagbuilder/#a32cff45e4cfd323ecc3896adcb08c2a9"><Highlight kind="normal"><a href="/docs/api/classes/llvm/selectiondagbuilder/#a32cff45e4cfd323ecc3896adcb08c2a9">SelectionDAGBuilder::LowerStatepoint</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/gcstatepointinst">GCStatepointInst</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><Highlight kind="normal">                                     </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EHPadBB </Highlight><Highlight kind="comment">/&#42;= nullptr&#42;/</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getCallingConv() != <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4ca4f42667edde6e9cb80cfae6361e5e76a">CallingConv::AnyReg</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;anyregcc is not supported on statepoints!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check that the associated GCStrategy expects to encounter statepoints.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#a9b4db8b8082660004fda0c282da0ff0a">GFI</a>-&gt;getStrategy().useStatepoints() &amp;&amp;</Highlight></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;GCStrategy does not expect to encounter statepoints&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> ActualCallee;</Highlight></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Callee = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getActualCalledOperand());</Highlight></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getNumPatchBytes() &gt; 0) &#123;</Highlight></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we&#39;ve been asked to emit a nop sequence instead of a call instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// for this statepoint then don&#39;t lower the call target, but use a constant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#96;undef&#96; instead.  Not lowering the call target lets statepoint clients</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// get away without providing a physical address for the symbolic call</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// target at link time.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><Highlight kind="normal">    ActualCallee = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getUNDEF(Callee.getValueType());</Highlight></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><Highlight kind="normal">    ActualCallee = Callee;</Highlight></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GCResultLocality = <a href="#ab1af1f498b4d814ee68810a03fbe28a7">getGCResultLocality</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/attributeset">AttributeSet</a> retAttrs;</Highlight></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GCResultLocality.first)</Highlight></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><Highlight kind="normal">    retAttrs = GCResultLocality.first-&gt;getAttributes().getRetAttrs();</Highlight></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/selectiondagbuilder/statepointloweringinfo">StatepointLoweringInfo</a> <a href="/docs/api/namespaces/llvm/si">SI</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>);</Highlight></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#a8a8a4b167d0244a5c34b6819dd3d5c56">populateCallLoweringInfo</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>.CLI, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/gcstatepointinst/#a603a5bfcd809283f948cbf101851c173a4bd61c6f1d2d253230fb6a6cca78d8aa">GCStatepointInst::CallArgsBeginPos</a>,</Highlight></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><Highlight kind="normal">                           <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getNumCallArgs(), ActualCallee,</Highlight></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><Highlight kind="normal">                           <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getActualReturnType(), retAttrs,</Highlight></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><Highlight kind="normal">                           </Highlight><Highlight kind="comment">/&#42;IsPatchPoint=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// There may be duplication in the gc.relocate list; such as two copies of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// each relocation on normal and exceptional path for an invoke.  We only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// need to spill once and record one copy in the stackmap, but we need to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reload once per gc.relocate.  (Dedupping gc.relocates is trickier and best</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// handled as a CSE problem elsewhere.)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: There a couple of major stackmap size optimizations we could do</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// here if we wished.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 1) If we&#39;ve encountered a derived pair &#123;B, D&#125;, we don&#39;t need to actually</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// record &#123;B,B&#125; if it&#39;s seen later.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 2) Due to rematerialization, actual derived pointers are somewhat rare;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// given that, we could change the format to record base pointer relocations</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// separately with half the space. This would require a format rev and a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// fairly major rework of the STATEPOINT node though.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;SDValue, 8&gt;</a> Seen;</Highlight></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &#42;Relocate : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getGCRelocates()) &#123;</Highlight></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/si">SI</a>.GCRelocates.push&#95;back(Relocate);</Highlight></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> DerivedSD = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(Relocate-&gt;getDerivedPtr());</Highlight></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Seen.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(DerivedSD).second) &#123;</Highlight></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/si">SI</a>.Bases.push&#95;back(Relocate-&gt;getBasePtr());</Highlight></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs.push&#95;back(Relocate-&gt;getDerivedPtr());</Highlight></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we find a deopt value which isn&#39;t explicitly added, we need to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ensure it gets lowered such that gc cycles occurring before the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// deoptimization event during the lifetime of the call don&#39;t invalidate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the pointer we&#39;re deopting with.  Note that we assume that all</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// pointers passed to deopt are base pointers; relaxing that assumption</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// would require relatively large changes to how we represent relocations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Value &#42;V : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.deopt&#95;operands()) &#123;</Highlight></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a720af7e7f23150174952da03d216341a">isGCValue</a>(V, &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">))</Highlight></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Seen.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(V)).second) &#123;</Highlight></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/si">SI</a>.Bases.push&#95;back(V);</Highlight></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/si">SI</a>.Ptrs.push&#95;back(V);</Highlight></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.GCLives = <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef&lt;const Use&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.gc&#95;live&#95;begin(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.gc&#95;live&#95;end());</Highlight></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointInstr = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.ID = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getID();</Highlight></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.DeoptState = <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef&lt;const Use&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.deopt&#95;begin(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.deopt&#95;end());</Highlight></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.GCTransitionArgs = <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef&lt;const Use&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.gc&#95;transition&#95;args&#95;begin(),</Highlight></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><Highlight kind="normal">                                            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.gc&#95;transition&#95;args&#95;end());</Highlight></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointFlags = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getFlags();</Highlight></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.NumPatchBytes = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getNumPatchBytes();</Highlight></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.EHPadBB = EHPadBB;</Highlight></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> ReturnValue = <a href="/docs/api/classes/llvm/selectiondagbuilder/#afe97e2bc5bd74272ca1b54da1fb30e06">LowerAsSTATEPOINT</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>);</Highlight></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Export the result value if needed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GCResultLocality.first &amp;&amp; !GCResultLocality.second) &#123;</Highlight></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The return value is not needed, just generate a poison value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Note: This covers the void return case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getIntPtrConstant(-1, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>()));</Highlight></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GCResultLocality.first) &#123;</Highlight></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Result value will be used in a same basic block. Don&#39;t export it or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// perform any explicit register copies. The gc&#95;result will simply grab</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// this value. </Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ReturnValue);</Highlight></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!GCResultLocality.second)</Highlight></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Result value will be used in a different basic block so we need to export</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// it now.  Default exporting mechanism will not work here because statepoint</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// call has a different type than the actual call. It means that by default</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// llvm will create export register of the wrong type (always i32 in our</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// case). So instead we need to create export register with correct type</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// manually.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: To eliminate this problem we can remove gc.result intrinsics</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       completely and make statepoint call to return a tuple.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy = GCResultLocality.second-&gt;getType();</Highlight></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/register">Register</a> Reg = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.CreateRegs(RetTy);</Highlight></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/regsforvalue">RegsForValue</a> RFV(&#42;<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getContext(), <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetLoweringInfo(),</Highlight></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><Highlight kind="normal">                   <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getDataLayout(), Reg, RetTy,</Highlight></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><Highlight kind="normal">                   <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getCallingConv());</Highlight></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Chain = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getEntryNode();</Highlight></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><Highlight kind="normal">  </Highlight></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><Highlight kind="normal">  RFV.<a href="/docs/api/structs/llvm/regsforvalue/#adf93dd21d49c19700e980b15f19cb7d7">getCopyToRegs</a>(ReturnValue, <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), Chain, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><Highlight kind="normal">  PendingExports.push&#95;back(Chain);</Highlight></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.ValueMap&#91;&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = Reg;</Highlight></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140" lineLink="/docs/api/classes/llvm/selectiondagbuilder/#a57ee991742a8027b5ef002c616a6b9fd"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/selectiondagbuilder/#a57ee991742a8027b5ef002c616a6b9fd">SelectionDAGBuilder::LowerCallSiteWithDeoptBundleImpl</a>(</Highlight></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Callee, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EHPadBB,</Highlight></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> VarArgDisallowed, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ForceVoidReturnTy) &#123;</Highlight></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/selectiondagbuilder/statepointloweringinfo">StatepointLoweringInfo</a> <a href="/docs/api/namespaces/llvm/si">SI</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>);</Highlight></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ArgBeginIndex = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;arg&#95;begin() - <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;op&#95;begin();</Highlight></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#a8a8a4b167d0244a5c34b6819dd3d5c56">populateCallLoweringInfo</a>(</Highlight></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/si">SI</a>.CLI, <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, ArgBeginIndex, <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;arg&#95;size(), Callee,</Highlight></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><Highlight kind="normal">      ForceVoidReturnTy ? <a href="/docs/api/classes/llvm/type/#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(&#42;<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getContext()) : <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getType(),</Highlight></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getAttributes().getRetAttrs(), </Highlight><Highlight kind="comment">/&#42;IsPatchPoint=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VarArgDisallowed)</Highlight></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/si">SI</a>.CLI.IsVarArg = <a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getFunctionType()-&gt;isVarArg();</Highlight></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> DeoptBundle = &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getOperandBundle(<a href="/docs/api/classes/llvm/llvmcontext/#a44d727ac5fccf852bfb2bae3e06adc9ca3f6df86c6efab701ade7abbc3134c25a">LLVMContext::OB&#95;deopt</a>);</Highlight></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> DefaultID = <a href="/docs/api/structs/llvm/statepointdirectives/#ac6c1765b4a9a319dac2aad8cdc622ef2">StatepointDirectives::DeoptBundleStatepointID</a>;</Highlight></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SD = <a href="/docs/api/namespaces/llvm/#a830906f493a6d5c69ac5a94675c657fb">parseStatepointDirectivesFromAttrs</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>-&gt;getAttributes());</Highlight></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.ID = SD.StatepointID.value&#95;or(DefaultID);</Highlight></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.NumPatchBytes = SD.NumPatchBytes.value&#95;or(0);</Highlight></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.DeoptState =</Highlight></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef&lt;const Use&gt;</a>(DeoptBundle.Inputs.begin(), DeoptBundle.Inputs.end());</Highlight></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.StatepointFlags = </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal">uint64&#95;t</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(<a href="/docs/api/namespaces/llvm/#abba0f0474eb4e32d1ed7b6dfdb0d5140a6adf97f83acf6453d4a6a4b1070f3754">StatepointFlags::None</a>);</Highlight></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/si">SI</a>.EHPadBB = EHPadBB;</Highlight></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// NB! The GC arguments are deliberately left empty.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Lowering call with deopt bundle &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/sdvalue">SDValue</a> ReturnVal = <a href="/docs/api/classes/llvm/selectiondagbuilder/#afe97e2bc5bd74272ca1b54da1fb30e06">LowerAsSTATEPOINT</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>)) &#123;</Highlight></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><Highlight kind="normal">    ReturnVal = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a3756185351596750edbb4790d9923eea">lowerRangeToAssertZExt</a>(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>, &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, ReturnVal);</Highlight></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, ReturnVal);</Highlight></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174" lineLink="/docs/api/classes/llvm/selectiondagbuilder/#a475d759da0893604f08519960a12d297"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/selectiondagbuilder/#a475d759da0893604f08519960a12d297">SelectionDAGBuilder::LowerCallSiteWithDeoptBundle</a>(</Highlight></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callbase">CallBase</a> &#42;<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Callee, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;EHPadBB) &#123;</Highlight></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#a57ee991742a8027b5ef002c616a6b9fd">LowerCallSiteWithDeoptBundleImpl</a>(<a href="/docs/api/groups/arcopt/#ga9c9cf6ad55eb23d77d083a184e416c09">Call</a>, Callee, EHPadBB,</Highlight></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><Highlight kind="normal">                                   </Highlight><Highlight kind="comment">/&#42; VarArgDisallowed = &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><Highlight kind="normal">                                   </Highlight><Highlight kind="comment">/&#42; ForceVoidReturnTy  = &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> SelectionDAGBuilder::visitGCResult(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/gcresultinst">GCResultInst</a> &amp;CI) &#123;</Highlight></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The result value of the gc&#95;result is simply the result of the actual</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// call.  We&#39;ve already emitted this, so just grab the value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = CI.<a href="/docs/api/classes/llvm/gcprojectioninst/#a6cffcfabac72ca61185ea24c1208b937">getStatepoint</a>();</Highlight></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GCStatepointInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>)) &amp;&amp;</Highlight></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;GetStatepoint must return one of two types&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>))</Highlight></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GCStatepointInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>() == CI.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()) &#123;</Highlight></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;CI, <a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>));</Highlight></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Statepoint is in different basic block so we should have stored call</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// result in a virtual register.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can not use default getValue() functionality to copy value from this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// register because statepoint and actual call return types can be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// different, and getValue() will use CopyFromReg of the wrong type,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// which is always i32 in our case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy = CI.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> CopyFromReg = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ac0b87e85b015d15077a7d9432c500df3">getCopyFromRegs</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>, RetTy);</Highlight></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><Highlight kind="normal">  </Highlight></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(CopyFromReg.getNode());</Highlight></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;CI, CopyFromReg);</Highlight></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> SelectionDAGBuilder::visitGCRelocate(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/gcrelocateinst">GCRelocateInst</a> &amp;Relocate) &#123;</Highlight></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> Value &#42;Statepoint = Relocate.<a href="/docs/api/classes/llvm/gcprojectioninst/#a6cffcfabac72ca61185ea24c1208b937">getStatepoint</a>();</Highlight></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Consistency check</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We skip this check for relocates not in the same basic block as their</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// statepoint. It would be too expensive to preserve validation info through</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// different basic blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GCStatepointInst&gt;</a>(Statepoint) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Statepoint)) &amp;&amp;</Highlight></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;GetStatepoint must return one of two types&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;UndefValue&gt;</a>(Statepoint))</Highlight></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GCStatepointInst&gt;</a>(Statepoint)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>() == Relocate.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>())</Highlight></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.relocCallVisited(Relocate);</Highlight></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> Value &#42;DerivedPtr = Relocate.<a href="/docs/api/classes/llvm/gcrelocateinst/#ae587391ac557593d998dbca4e62f0dab">getDerivedPtr</a>();</Highlight></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;RelocationMap =</Highlight></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>.StatepointRelocationMaps&#91;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GCStatepointInst&gt;</a>(Statepoint)&#93;;</Highlight></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SlotIt = RelocationMap.find(&amp;Relocate);</Highlight></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SlotIt != RelocationMap.end() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Relocating not lowered gc value&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="#ae5fbc6e1ce3fcbb7f185ed9e7beffec7">RecordType</a> &amp;Record = SlotIt-&gt;second;</Highlight></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If relocation was done via virtual register..</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Record.<a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#a71262a52679c1bff78fbec385a79a000">type</a> == <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2cafcf3e806047173bc7c8581b355375870">RecordType::SDValueNode</a>) &#123;</Highlight></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;GCStatepointInst&gt;</a>(Statepoint)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>() ==</Highlight></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><Highlight kind="normal">               Relocate.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Nonlocal gc.relocate mapped via SDValue&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a> SDV = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a77cbbcab1440ac5ef835e1a3d3f6c74e">StatepointLowering</a>.getLocation(<a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(DerivedPtr));</Highlight></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SDV.<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;empty SDValue&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;Relocate, SDV);</Highlight></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Record.<a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#a71262a52679c1bff78fbec385a79a000">type</a> == <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2cad7321692f596ba5573d414ce3452c26f">RecordType::VReg</a>) &#123;</Highlight></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/mem2reg-cpp/#a6fde3eb6ca09ddf2fd76432176d817bb">Register</a> InReg = Record.<a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#a3b35426a048cac6e35a0d4eeb04ba7b5">payload</a>.<a href="/docs/api/unions/llvm/functionloweringinfo/statepointrelocationrecord/payload-t/#a3d33cc05e9188ed1f6843e7fb86bcf0b">Reg</a>;</Highlight></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><Highlight kind="normal">    RegsForValue RFV(&#42;<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getContext(), <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetLoweringInfo(),</Highlight></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><Highlight kind="normal">                     <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getDataLayout(), InReg, Relocate.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</Highlight></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><Highlight kind="normal">                     std::nullopt); </Highlight><Highlight kind="comment">// This is not an ABI copy.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We generate copy to/from regs even for local uses, hence we must</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// chain with current root to ensure proper ordering of copies w.r.t.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// statepoint.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a> <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a> = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getRoot();</Highlight></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a> Relocation = RFV.getCopyFromRegs(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>, <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad10e64e191507974af84a4ea069a9e36">FuncInfo</a>, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(),</Highlight></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><Highlight kind="normal">                                             Chain, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;Relocate, Relocation);</Highlight></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Record.<a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#a71262a52679c1bff78fbec385a79a000">type</a> == <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2ca4e2303faf0f163fb7a4af33f778884e8">RecordType::Spill</a>) &#123;</Highlight></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/dwarf/#a5d3c920b66ea797d6adb243862fdf47a">Index</a> = Record.<a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#a3b35426a048cac6e35a0d4eeb04ba7b5">payload</a>.<a href="/docs/api/unions/llvm/functionloweringinfo/statepointrelocationrecord/payload-t/#ad33089865c2bb187d94754afb33c704e">FI</a>;</Highlight></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a> SpillSlot = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetFrameIndex(Index, <a href="/docs/api/classes/llvm/selectiondagbuilder/#a2f4850c6b936e27186113935b002b36f">getFrameIndexTy</a>());</Highlight></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// All the reloads are independent and are reading memory only modified by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// statepoints (i.e. no other aliasing stores); informing SelectionDAG of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// this lets CSE kick in for free and allows reordering of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instructions if possible.  The lowering for statepoint sets the root,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// so this is ordering all reloads with the either</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// a) the statepoint node itself, or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// b) the entry of the current block for an invoke statepoint.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a> <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a> = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getRoot(); </Highlight><Highlight kind="comment">// != Builder.getRoot()</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;MF = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getMachineFunction();</Highlight></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;MFI = MF.getFrameInfo();</Highlight></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> PtrInfo = <a href="/docs/api/structs/llvm/machinepointerinfo/#ad8ce1aee13dbdcc05d20284a30e83170">MachinePointerInfo::getFixedStack</a>(MF, Index);</Highlight></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LoadMMO = MF.getMachineMemOperand(PtrInfo, <a href="/docs/api/classes/llvm/machinememoperand/#aaa2020e47e35179234b9ea27d555b2dda7d12be6206e5b0026c71bbcd5cb76494">MachineMemOperand::MOLoad</a>,</Highlight></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><Highlight kind="normal">                                            MFI.getObjectSize(Index),</Highlight></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><Highlight kind="normal">                                            MFI.getObjectAlign(Index));</Highlight></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> LoadVT = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetLoweringInfo().getValueType(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getDataLayout(),</Highlight></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><Highlight kind="normal">                                                           Relocate.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>());</Highlight></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a> SpillLoad =</Highlight></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getLoad(LoadVT, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), Chain, SpillSlot, LoadMMO);</Highlight></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#a9a1381eb77fac8d57f54f7bf25919a4e">PendingLoads</a>.push&#95;back(SpillLoad.<a href="/docs/api/classes/llvm/sdvalue/#a64932427432abeb61241e98bea167580">getValue</a>(1));</Highlight></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SpillLoad.<a href="/docs/api/classes/llvm/sdvalue/#a2b08aa629a6326d1a0444ee6d477c39d">getNode</a>());</Highlight></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;Relocate, SpillLoad);</Highlight></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Record.<a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#a71262a52679c1bff78fbec385a79a000">type</a> == <a href="/docs/api/structs/llvm/functionloweringinfo/statepointrelocationrecord/#ae85ec708fd4e537d4b331ce7f94acb2cae1c6c7a77fab355eb08576b3bd29b924">RecordType::NoRelocate</a>);</Highlight></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a51cb24bd3e700fcf2f93d1afbb555a16">SDValue</a> SD = <a href="/docs/api/classes/llvm/selectiondagbuilder/#a025adb087cac36e2cd504a33e8cb749d">getValue</a>(DerivedPtr);</Highlight></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SD.<a href="/docs/api/classes/llvm/sdvalue/#a1c861a21f795c3108ab690f3a45c881a">isUndef</a>() &amp;&amp; SD.<a href="/docs/api/classes/llvm/sdvalue/#a6b2b8ca5b0fdf6484247d5ae74deb9ff">getValueType</a>().<a href="/docs/api/structs/llvm/evt/#a45e76d44a189e456d52e37ba3dda0fce">getSizeInBits</a>() &lt;= 64) &#123;</Highlight></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Lowering relocate(undef) as arbitrary constant. Current constant value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is chosen such that it&#39;s unlikely to be a valid pointer.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;Relocate, <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getConstant(0xFEFEFEFE, SDLoc(SD), MVT::i64));</Highlight></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We didn&#39;t need to spill these special cases (constants and allocas).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// See the handling in spillIncomingValueForStatepoint for detail.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad8368fe85feec440623e9558e100f357">setValue</a>(&amp;Relocate, SD);</Highlight></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302" lineLink="/docs/api/classes/llvm/selectiondagbuilder/#a459873061a3fed537ca026ddaffe57ed"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/selectiondagbuilder/#a459873061a3fed537ca026ddaffe57ed">SelectionDAGBuilder::LowerDeoptimizeCall</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI) &#123;</Highlight></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;TLI = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTargetLoweringInfo();</Highlight></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/sdvalue">SDValue</a> Callee = <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getExternalSymbol(TLI.getLibcallName(RTLIB::DEOPTIMIZE),</Highlight></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><Highlight kind="normal">                                         TLI.getPointerTy(<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getDataLayout()));</Highlight></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We don&#39;t lower calls to &#95;&#95;llvm&#95;deoptimize as varargs, but as a regular</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// call.  We also do not lower the return value to any virtual register, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// change the immediately following return to a trap instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/selectiondagbuilder/#a57ee991742a8027b5ef002c616a6b9fd">LowerCallSiteWithDeoptBundleImpl</a>(CI, Callee, </Highlight><Highlight kind="comment">/&#42; EHPadBB = &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><Highlight kind="normal">                                   </Highlight><Highlight kind="comment">/&#42; VarArgDisallowed = &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><Highlight kind="normal">                                   </Highlight><Highlight kind="comment">/&#42; ForceVoidReturnTy = &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315" lineLink="/docs/api/classes/llvm/selectiondagbuilder/#acf29bbf079b2610d2c8481212261fc49"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/selectiondagbuilder/#acf29bbf079b2610d2c8481212261fc49">SelectionDAGBuilder::LowerDeoptimizingReturn</a>() &#123;</Highlight></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We do not lower the return value from llvm.deoptimize to any virtual</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// register, and change the immediately following return to a trap</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getTarget().Options.TrapUnreachable)</Highlight></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.setRoot(</Highlight></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getNode(ISD::TRAP, <a href="/docs/api/classes/llvm/selectiondagbuilder/#abb661ad9d4e5fd0d8806106e9b4d7256">getCurSDLoc</a>(), MVT::Other, <a href="/docs/api/classes/llvm/selectiondagbuilder/#ad997f08bfd4680a697130632badf740e">DAG</a>.getRoot()));</Highlight></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><Highlight kind="normal">&#125;</Highlight></CodeLine>

</ProgramListing>


</DoxygenPage>
