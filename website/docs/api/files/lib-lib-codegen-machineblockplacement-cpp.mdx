---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/codegen/machineblockplacement-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `MachineBlockPlacement.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="BranchFolding.h"
  permalink="/docs/api/files/lib/lib/codegen/branchfolding-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BlockFrequencyInfoImpl.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfoimpl-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ProfileSummaryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MBFIWrapper.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/mbfiwrapper-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineBasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinebasicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineBlockFrequencyInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineblockfrequencyinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineBranchProbabilityInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinebranchprobabilityinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineFunctionPass.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunctionpass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineLoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machineloopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachinePostDominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinepostdominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/MachineSizeOpts.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/machinesizeopts-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TailDuplicator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/tailduplicator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetInstrInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetinstrinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetLowering.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetlowering-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetPassConfig.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetpassconfig-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/CodeGen/TargetSubtargetInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/codegen/targetsubtargetinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugLoc.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debugloc-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PrintPasses.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/printpasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/InitializePasses.h"
  permalink="/docs/api/files/include/include/llvm/initializepasses-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Pass.h"
  permalink="/docs/api/files/include/include/llvm/pass-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Allocator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/allocator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/BlockFrequency.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/blockfrequency-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/BranchProbability.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CodeGen.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/codegen-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Compiler.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Target/TargetMachine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/CodeLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/codelayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="memory"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="string"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="tuple"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="vector"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/llvm">llvm</a></>}>
This is an optimization pass for GlobalISel generic memory operations. <a href="/docs/api/namespaces/llvm/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-machineblockplacement-cpp-">anonymous&#123;MachineBlockPlacement.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a></>}>
A chain of blocks which will be laid out contiguously. <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement">MachineBlockPlacement</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/blockandtaildupresult">BlockAndTailDupResult</a></>}>
Pair struct containing basic block and taildup profitability. <a href="/docs/api/structs/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/blockandtaildupresult/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/weightededge">WeightedEdge</a></>}>
<a href="/docs/api/classes/llvm/triple">Triple</a> struct containing edge weight and the edge. <a href="/docs/api/structs/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/weightededge/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats">MachineBlockPlacementStats</a></>}>
A pass to compute block placement statistics. <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#details">More...</a>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type={<>uint64&#95;t</>}
  name={<><a href="#ac20133598c564acc81e5abadc5a1d637">countMBBInstruction</a> (MachineBasicBlock &#42;MBB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a></>}
  name={<><a href="#a0a894de03271c0ccc991e40f4cdd2623">getAdjustedProbability</a> (BranchProbability OrigProb, BranchProbability AdjustedSumProb)</>}>
The helper function returns the branch probability that is adjusted or normalized over the new total <code>AdjustedSumProb</code>. <a href="#a0a894de03271c0ccc991e40f4cdd2623">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>Branch Probability Basic Block static false <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#ae2b0d0345572d6718e219aa76d1d54edab45cffe084dd3d20d928bee85e7b0f21">std::string</a></>}
  name={<><a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a> (const MachineBasicBlock &#42;BB)</>}>
Helper to print the name of a MBB. <a href="#a8f9ee7f9ffc036496a8663335da175fa">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a></>}
  name={<><a href="#a3d135a8abf70dc93455708cc087cc0b0">getLayoutSuccessorProbThreshold</a> (const MachineBasicBlock &#42;BB)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a73743365177645c3db889f210cd5ad1d">greaterWithBias</a> (BlockFrequency A, BlockFrequency B, BlockFrequency EntryFreq)</>}>
Compare 2 <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>&#39;s with a small penalty for <code>A</code>. <a href="#a73743365177645c3db889f210cd5ad1d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ab20068697df3d13ab12e09852d99b7f7">hasSameSuccessors</a> (MachineBasicBlock &amp;BB, SmallPtrSetImpl&lt; const MachineBasicBlock &#42; &gt; &amp;Successors)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if <code>BB</code> has exactly the successors in <code>Successors</code>. <a href="#ab20068697df3d13ab12e09852d99b7f7">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aa4d0eea634133a91f99ee833a4d073ef">INITIALIZE&#95;PASS&#95;BEGIN</a> (MachineBlockPlacement, DEBUG&#95;TYPE, &quot;Branch Probability Basic Block Placement&quot;, false, false) INITIALIZE&#95;PASS&#95;END(MachineBlockPlacement</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ace73c7d6fee046409626ebb1799d0454">INITIALIZE&#95;PASS&#95;BEGIN</a> (MachineBlockPlacementStats, &quot;block-placement-stats&quot;, &quot;Basic Block Placement Stats&quot;, false, false) INITIALIZE&#95;PASS&#95;END(MachineBlockPlacementStats</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ad05af0aa86e2b12cf42ab78461b937cd">STATISTIC</a> (NumCondBranches, &quot;Number of conditional branches&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a0b86f72bc30eb2255f4c0a22ffab9d3d">STATISTIC</a> (NumUncondBranches, &quot;Number of unconditional branches&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ad2d61a27d105b8e831a92e20acdeca10">STATISTIC</a> (CondBranchTakenFreq, &quot;Potential frequency of taking conditional branches&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a6eeb8d383eae14ff1d8952fe471fb841">STATISTIC</a> (UncondBranchTakenFreq, &quot;Potential frequency of taking unconditional branches&quot;)</>}>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a1f1e40c7ec4c37b42f76da67c75e638d">AlignAllBlock</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a4dbf76303569b68b0d3719627c88e9fe">AlignAllNonFallThruBlocks</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a956f6faccd85fe2a75302e0ac3ecc606">ApplyExtTspForSize</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a84ae0b35deb4cbcffc27c3d52a781fca">BranchFoldPlacement</a></>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a030569d5a541b6110f2ae1b6a3413a58">DEBUG&#95;TYPE</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a41cd121b4df30e5c0dc17f0c479e843a">ExitBlockBias</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a1160412b923427430e8bf4c819d79a93">ExtTspBlockPlacementMaxBlocks</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="Branch Probability Basic Block"
  name={<><a href="#a80b3a35dc5c2cb6840ae523bc8d1902a">false</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a3ede40cd3f6f158cb8cbbc9de3844d98">ForceLoopColdBlock</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ae71e7939345cee7ef0596b40d1ad068b">ForcePreciseRotationCost</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a72b387cbb4c16dbf0558135dd26ddfd0">JumpInstCost</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#acba0c508ce2e626b58485ceb28068cf1">LoopToColdBlockRatio</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a7713277c884a7bf39711c1c0d6cf9c26">MaxBytesForAlignmentOverride</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a75fe07dfba15c73225c8ca4cd720049d">MisfetchCost</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="Branch Probability Basic Block"
  name={<><a href="#a10783a549bfb83fd142ae4e645a283ef">Placement</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a0d30337c58d278817264718434f122ca">PreciseRotationCost</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ad1fed248fc2af534bd094b35c9f0c64b">RenumberBlocksBeforeView</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/unifyloopexits-cpp/#a4741a07a0e5675f89cfed122008e0a76">block</a> placement</>}
  name={<><a href="#a971b2fc3751cade0a6b2f76c92774317">stats</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/unifyloopexits-cpp/#a4741a07a0e5675f89cfed122008e0a76">block</a> placement Basic Block <a href="#a10783a549bfb83fd142ae4e645a283ef">Placement</a></>}
  name={<><a href="#a086f939e29b718dc5a01e4bcfe6af2a1">Stats</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#abf71e6f582691ae8bdf8ed170fb11ae6">TailDupPlacement</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#adc8acb8291add6a055468711f701e78d">TailDupPlacementAggressiveThreshold</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a7344284dac6ba9b8e48d9be67c954bfc">TailDupPlacementPenalty</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a707021480bba6c165b873f9e238859c5">TailDupPlacementThreshold</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a84dfb254ed1062bc06a43d2365974bd2">TailDupProfilePercentThreshold</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a8ac66559c601e390e9477131019ee0ca">TriangleChainCount</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;block-placement&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### countMBBInstruction() {#ac20133598c564acc81e5abadc5a1d637}

<MemberDefinition
  prototype={<>static uint64&#95;t countMBBInstruction (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; MBB)</>}
  labels = {["static"]}>

Definition at line <a href="#l03272">3272</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### getAdjustedProbability() {#a0a894de03271c0ccc991e40f4cdd2623}

<MemberDefinition
  prototype={<>static BranchProbability getAdjustedProbability (<a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> OrigProb, <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> AdjustedSumProb)</>}
  labels = {["static"]}>
The helper function returns the branch probability that is adjusted or normalized over the new total <code>AdjustedSumProb</code>.

Definition at line <a href="#l00769">769</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### getBlockName() {#a8f9ee7f9ffc036496a8663335da175fa}

<MemberDefinition
  prototype={<>Branch Probability Basic Block static false std::string getBlockName (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; BB)</>}
  labels = {["static"]}>
Helper to print the name of a MBB.

Only used by debug logging.

Definition at line <a href="#l00657">657</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### getLayoutSuccessorProbThreshold() {#a3d135a8abf70dc93455708cc087cc0b0}

<MemberDefinition
  prototype={<>static BranchProbability getLayoutSuccessorProbThreshold (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; BB)</>}
  labels = {["static"]}>

Definition at line <a href="#l01397">1397</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### greaterWithBias() {#a73743365177645c3db889f210cd5ad1d}

<MemberDefinition
  prototype={<>static bool greaterWithBias (<a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> A, <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> B, <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> EntryFreq)</>}
  labels = {["static"]}>
Compare 2 <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>&#39;s with a small penalty for <code>A</code>.

In order to be conservative, we apply a X% penalty to account for increased icache pressure and static heuristics. For small frequencies we use only the numerators to improve accuracy. For simplicity, we assume the penalty is less than 100% TODO(iteratee): <a href="/docs/api/classes/llvm/use">Use</a> 64-bit fixed point edge frequencies everywhere.

Definition at line <a href="#l00817">817</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### hasSameSuccessors() {#ab20068697df3d13ab12e09852d99b7f7}

<MemberDefinition
  prototype={<>static bool hasSameSuccessors (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp; BB, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42; &gt; &amp; Successors)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if <code>BB</code> has exactly the successors in <code>Successors</code>.

Definition at line <a href="#l00784">784</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS&#95;BEGIN() {#aa4d0eea634133a91f99ee833a4d073ef}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS&#95;BEGIN (MachineBlockPlacement, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, &quot;Branch Probability Basic Block Placement&quot;, false, false)</>}>

Definition at line <a href="#l00643">643</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### INITIALIZE&#95;PASS&#95;BEGIN() {#ace73c7d6fee046409626ebb1799d0454}

<MemberDefinition
  prototype={<>INITIALIZE&#95;PASS&#95;BEGIN (MachineBlockPlacementStats, &quot;block-placement-stats&quot;, &quot;Basic Block <a href="#a10783a549bfb83fd142ae4e645a283ef">Placement</a> Stats&quot;, false, false)</>}>

Definition at line <a href="#l03809">3809</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ad05af0aa86e2b12cf42ab78461b937cd}

<MemberDefinition
  prototype={<>STATISTIC (NumCondBranches, &quot;Number of conditional branches&quot;)</>}>

Definition at line <a href="#l00080">80</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a0b86f72bc30eb2255f4c0a22ffab9d3d}

<MemberDefinition
  prototype={<>STATISTIC (NumUncondBranches, &quot;Number of unconditional branches&quot;)</>}>

Definition at line <a href="#l00081">81</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ad2d61a27d105b8e831a92e20acdeca10}

<MemberDefinition
  prototype={<>STATISTIC (CondBranchTakenFreq, &quot;Potential frequency of taking conditional branches&quot;)</>}>

Definition at line <a href="#l00082">82</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a6eeb8d383eae14ff1d8952fe471fb841}

<MemberDefinition
  prototype={<>STATISTIC (UncondBranchTakenFreq, &quot;Potential frequency of taking unconditional branches&quot;)</>}>

Definition at line <a href="#l00084">84</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### AlignAllBlock {#a1f1e40c7ec4c37b42f76da67c75e638d}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; AlignAllBlock(&quot;align-all-blocks&quot;, cl::desc(&quot;Force the alignment of all blocks in the function in log2 format &quot; &quot;(e.g 4 means align on 16B boundaries).&quot;), cl::init(0), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00087">87</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### AlignAllNonFallThruBlocks {#a4dbf76303569b68b0d3719627c88e9fe}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; AlignAllNonFallThruBlocks(&quot;align-all-nofallthru-blocks&quot;, cl::desc(&quot;Force the alignment of all blocks that have no fall-through &quot; &quot;predecessors (i.e. don&#39;t add nops that are executed). In log2 &quot; &quot;format (e.g 4 means align on 16B boundaries).&quot;), cl::init(0), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00093">93</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### ApplyExtTspForSize {#a956f6faccd85fe2a75302e0ac3ecc606}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ApplyExtTspForSize(&quot;apply-ext-tsp-for-size&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Use ext-tsp for size-aware block placement.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00223">223</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### BranchFoldPlacement {#a84ae0b35deb4cbcffc27c3d52a781fca}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; BranchFoldPlacement(&quot;branch-fold-placement&quot;, cl::desc(&quot;Perform branch folding during placement. &quot; &quot;Reduces code size.&quot;), cl::init(true), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00157">157</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### DEBUG&#95;TYPE {#a030569d5a541b6110f2ae1b6a3413a58}

<MemberDefinition
  prototype={<>DEBUG&#95;TYPE</>}>

Definition at line <a href="#l00650">650</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### ExitBlockBias {#a41cd121b4df30e5c0dc17f0c479e843a}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; ExitBlockBias(&quot;block-placement-exit-block-bias&quot;, cl::desc(&quot;Block frequency percentage a loop exit block needs &quot; &quot;over the original exit to be considered the new exit.&quot;), cl::init(0), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00107">107</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### ExtTspBlockPlacementMaxBlocks {#a1160412b923427430e8bf4c819d79a93}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; ExtTspBlockPlacementMaxBlocks(&quot;ext-tsp-block-placement-max-blocks&quot;, cl::desc(&quot;Maximum number of basic blocks in a function to run ext-TSP &quot; &quot;block placement.&quot;), cl::init(UINT&#95;MAX), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00215">215</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### false {#a80b3a35dc5c2cb6840ae523bc8d1902a}

<MemberDefinition
  prototype="block placement Basic Block Placement false">

Definition at line <a href="#l00651">651</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### ForceLoopColdBlock {#a3ede40cd3f6f158cb8cbbc9de3844d98}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ForceLoopColdBlock(&quot;force-loop-cold-block&quot;, cl::desc(&quot;Force outlining cold blocks from loops.&quot;), cl::init(false), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00123">123</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### ForcePreciseRotationCost {#ae71e7939345cee7ef0596b40d1ad068b}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ForcePreciseRotationCost(&quot;force-precise-rotation-cost&quot;, cl::desc(&quot;Force the use of precise cost &quot; &quot;loop rotation strategy.&quot;), cl::init(false), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00134">134</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### JumpInstCost {#a72b387cbb4c16dbf0558135dd26ddfd0}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; JumpInstCost(&quot;jump-inst-cost&quot;, cl::desc(&quot;Cost of jump instructions.&quot;), cl::init(1), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00146">146</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### LoopToColdBlockRatio {#acba0c508ce2e626b58485ceb28068cf1}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; LoopToColdBlockRatio(&quot;loop-to-cold-block-ratio&quot;, cl::desc(&quot;Outline loop blocks from loop chain if (frequency of loop) / &quot; &quot;(frequency of block) is greater than this ratio&quot;), cl::init(5), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00116">116</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### MaxBytesForAlignmentOverride {#a7713277c884a7bf39711c1c0d6cf9c26}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; MaxBytesForAlignmentOverride(&quot;max-bytes-for-alignment&quot;, cl::desc(&quot;Forces the maximum bytes allowed to be emitted when padding for &quot; &quot;alignment&quot;), cl::init(0), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00100">100</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### MisfetchCost {#a75fe07dfba15c73225c8ca4cd720049d}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; MisfetchCost(&quot;misfetch-cost&quot;, cl::desc(&quot;Cost that models the probabilistic risk of an instruction &quot; &quot;misfetch due to a jump comparing to falling through, whose cost &quot; &quot;is zero.&quot;), cl::init(1), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00139">139</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### Placement {#a10783a549bfb83fd142ae4e645a283ef}

<MemberDefinition
  prototype="Branch Probability Basic Block Placement">

Definition at line <a href="#l00651">651</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### PreciseRotationCost {#a0d30337c58d278817264718434f122ca}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; PreciseRotationCost(&quot;precise-rotation-cost&quot;, cl::desc(&quot;Model the cost of loop rotation more &quot; &quot;precisely by using profile data.&quot;), cl::init(false), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00128">128</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### RenumberBlocksBeforeView {#ad1fed248fc2af534bd094b35c9f0c64b}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; RenumberBlocksBeforeView(&quot;renumber-blocks-before-view&quot;, cl::desc( &quot;If true, basic blocks are re-numbered before MBP layout is printed &quot; &quot;into a dot graph. Only used when a function is being printed.&quot;), cl::init(false), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00208">208</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### stats {#a971b2fc3751cade0a6b2f76c92774317}

<MemberDefinition
  prototype="block placement stats">

Definition at line <a href="#l03813">3813</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### Stats {#a086f939e29b718dc5a01e4bcfe6af2a1}

<MemberDefinition
  prototype="block placement Basic Block Placement Stats">

Definition at line <a href="#l03814">3814</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### TailDupPlacement {#abf71e6f582691ae8bdf8ed170fb11ae6}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; TailDupPlacement(&quot;tail-dup-placement&quot;, cl::desc(&quot;Perform tail duplication during placement. &quot; &quot;Creates more fallthrough opportunities in &quot; &quot;outline branches.&quot;), cl::init(true), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00150">150</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### TailDupPlacementAggressiveThreshold {#adc8acb8291add6a055468711f701e78d}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; TailDupPlacementAggressiveThreshold(&quot;tail-dup-placement-aggressive-threshold&quot;, cl::desc(&quot;Instruction cutoff for aggressive tail duplication during &quot; &quot;layout. Used at -O3. Tail merging during layout is forced to &quot; &quot;have a threshold that won&#39;t conflict.&quot;), cl::init(4), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00171">171</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### TailDupPlacementPenalty {#a7344284dac6ba9b8e48d9be67c954bfc}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; TailDupPlacementPenalty(&quot;tail-dup-placement-penalty&quot;, cl::desc( &quot;Cost penalty for blocks that can avoid breaking CFG by copying. &quot; &quot;Copying can increase fallthrough, but it also increases icache &quot; &quot;pressure. This parameter controls the penalty to account for that. &quot; &quot;Percent as integer.&quot;), cl::init(2), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00179">179</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### TailDupPlacementThreshold {#a707021480bba6c165b873f9e238859c5}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; TailDupPlacementThreshold(&quot;tail-dup-placement-threshold&quot;, cl::desc(&quot;Instruction cutoff for tail duplication during layout. &quot; &quot;Tail merging during layout is forced to have a threshold &quot; &quot;that won&#39;t conflict.&quot;), cl::init(2), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00163">163</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### TailDupProfilePercentThreshold {#a84dfb254ed1062bc06a43d2365974bd2}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; TailDupProfilePercentThreshold(&quot;tail-dup-profile-percent-threshold&quot;, cl::desc(&quot;If profile count information is used in tail duplication cost &quot; &quot;model, the gained fall through number from tail duplication &quot; &quot;should be at least this percent of hot count.&quot;), cl::init(50), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00189">189</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

### TriangleChainCount {#a8ac66559c601e390e9477131019ee0ca}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; TriangleChainCount(&quot;triangle-chain-count&quot;, cl::desc(&quot;Number of triangle-shaped-CFG&#39;s that need to be in a row for the &quot; &quot;triangle tail duplication heuristic to kick in. 0 to disable.&quot;), cl::init(2), cl::Hidden)</>}
  labels = {["static"]}>

Definition at line <a href="#l00197">197</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;block-placement&quot;</>}>

Definition at line <a href="#l00078">78</a> of file <a href="/docs/api/files/lib/lib/codegen/machineblockplacement-cpp">MachineBlockPlacement.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><Highlight kind="comment">//===- MachineBlockPlacement.cpp - Basic Block Code Layout optimization ---===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><Highlight kind="normal"></Highlight><Highlight kind="comment">// See https://llvm.org/LICENSE.txt for license information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This file implements basic block placement transformations using the CFG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><Highlight kind="normal"></Highlight><Highlight kind="comment">// structure and branch probability estimates.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The pass strives to preserve the structure of the CFG (that is, retain</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><Highlight kind="normal"></Highlight><Highlight kind="comment">// a topological ordering of basic blocks) in the absence of a &#42;strong&#42; signal</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><Highlight kind="normal"></Highlight><Highlight kind="comment">// to the contrary from probabilities. However, within the CFG structure, it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><Highlight kind="normal"></Highlight><Highlight kind="comment">// attempts to choose an ordering which favors placing more likely sequences of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><Highlight kind="normal"></Highlight><Highlight kind="comment">// blocks adjacent to each other.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The algorithm works from the inner-most loop within a function outward, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><Highlight kind="normal"></Highlight><Highlight kind="comment">// at each stage walks through the basic blocks, trying to coalesce them into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><Highlight kind="normal"></Highlight><Highlight kind="comment">// sequential chains where allowed by the CFG (or demanded by heavy</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><Highlight kind="normal"></Highlight><Highlight kind="comment">// probabilities). Finally, it walks the blocks in topological order, and the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><Highlight kind="normal"></Highlight><Highlight kind="comment">// first time it reaches a chain of basic blocks, it schedules them in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><Highlight kind="normal"></Highlight><Highlight kind="comment">// function in-order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/codegen/branchfolding-h">BranchFolding.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h">llvm/ADT/SetVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfoimpl-h">llvm/Analysis/BlockFrequencyInfoImpl.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h">llvm/Analysis/ProfileSummaryInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/mbfiwrapper-h">llvm/CodeGen/MBFIWrapper.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinebasicblock-h">llvm/CodeGen/MachineBasicBlock.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineblockfrequencyinfo-h">llvm/CodeGen/MachineBlockFrequencyInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinebranchprobabilityinfo-h">llvm/CodeGen/MachineBranchProbabilityInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunction-h">llvm/CodeGen/MachineFunction.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinefunctionpass-h">llvm/CodeGen/MachineFunctionPass.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machineloopinfo-h">llvm/CodeGen/MachineLoopInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinepostdominators-h">llvm/CodeGen/MachinePostDominators.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/machinesizeopts-h">llvm/CodeGen/MachineSizeOpts.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/tailduplicator-h">llvm/CodeGen/TailDuplicator.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetinstrinfo-h">llvm/CodeGen/TargetInstrInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetlowering-h">llvm/CodeGen/TargetLowering.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetpassconfig-h">llvm/CodeGen/TargetPassConfig.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/codegen/targetsubtargetinfo-h">llvm/CodeGen/TargetSubtargetInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debugloc-h">llvm/IR/DebugLoc.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/printpasses-h">llvm/IR/PrintPasses.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/initializepasses-h">llvm/InitializePasses.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/pass-h">llvm/Pass.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/allocator-h">llvm/Support/Allocator.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/blockfrequency-h">llvm/Support/BlockFrequency.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h">llvm/Support/BranchProbability.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/codegen-h">llvm/Support/CodeGen.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h">llvm/Support/Compiler.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/target/targetmachine-h">llvm/Target/TargetMachine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/codelayout-h">llvm/Transforms/Utils/CodeLayout.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;algorithm&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cassert&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cstdint&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;iterator&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;memory&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;string&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;tuple&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;utility&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;vector&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a>;</Highlight></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE &quot;block-placement&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80" lineLink="#ad05af0aa86e2b12cf42ab78461b937cd"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumCondBranches, </Highlight><Highlight kind="stringliteral">&quot;Number of conditional branches&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81" lineLink="#a0b86f72bc30eb2255f4c0a22ffab9d3d"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(NumUncondBranches, </Highlight><Highlight kind="stringliteral">&quot;Number of unconditional branches&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82" lineLink="#ad2d61a27d105b8e831a92e20acdeca10"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(CondBranchTakenFreq,</Highlight></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Potential frequency of taking conditional branches&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84" lineLink="#a6eeb8d383eae14ff1d8952fe471fb841"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(UncondBranchTakenFreq,</Highlight></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Potential frequency of taking unconditional branches&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87" lineLink="#a1f1e40c7ec4c37b42f76da67c75e638d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a1f1e40c7ec4c37b42f76da67c75e638d">AlignAllBlock</a>(</Highlight></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;align-all-blocks&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Force the alignment of all blocks in the function in log2 format &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;(e.g 4 means align on 16B boundaries).&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93" lineLink="#a4dbf76303569b68b0d3719627c88e9fe"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a4dbf76303569b68b0d3719627c88e9fe">AlignAllNonFallThruBlocks</a>(</Highlight></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;align-all-nofallthru-blocks&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Force the alignment of all blocks that have no fall-through &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;predecessors (i.e. don&#39;t add nops that are executed). In log2 &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;format (e.g 4 means align on 16B boundaries).&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100" lineLink="#a7713277c884a7bf39711c1c0d6cf9c26"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a7713277c884a7bf39711c1c0d6cf9c26">MaxBytesForAlignmentOverride</a>(</Highlight></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;max-bytes-for-alignment&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Forces the maximum bytes allowed to be emitted when padding for &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;alignment&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><Highlight kind="normal"></Highlight><Highlight kind="comment">// FIXME: Find a good default for this flag and remove the flag.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107" lineLink="#a41cd121b4df30e5c0dc17f0c479e843a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a41cd121b4df30e5c0dc17f0c479e843a">ExitBlockBias</a>(</Highlight></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;block-placement-exit-block-bias&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Block frequency percentage a loop exit block needs &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;over the original exit to be considered the new exit.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Definition:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><Highlight kind="normal"></Highlight><Highlight kind="comment">// - Outlining: placement of a basic block outside the chain or hot path.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116" lineLink="#acba0c508ce2e626b58485ceb28068cf1"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#acba0c508ce2e626b58485ceb28068cf1">LoopToColdBlockRatio</a>(</Highlight></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;loop-to-cold-block-ratio&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Outline loop blocks from loop chain if (frequency of loop) / &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;(frequency of block) is greater than this ratio&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(5), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123" lineLink="#a3ede40cd3f6f158cb8cbbc9de3844d98"><Highlight kind="normal">    <a href="#a3ede40cd3f6f158cb8cbbc9de3844d98">ForceLoopColdBlock</a>(</Highlight><Highlight kind="stringliteral">&quot;force-loop-cold-block&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><Highlight kind="normal">                       <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Force outlining cold blocks from loops.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><Highlight kind="normal">                       <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128" lineLink="#a0d30337c58d278817264718434f122ca"><Highlight kind="normal">    <a href="#a0d30337c58d278817264718434f122ca">PreciseRotationCost</a>(</Highlight><Highlight kind="stringliteral">&quot;precise-rotation-cost&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><Highlight kind="normal">                        <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Model the cost of loop rotation more &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><Highlight kind="normal">                                 </Highlight><Highlight kind="stringliteral">&quot;precisely by using profile data.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><Highlight kind="normal">                        <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134" lineLink="#ae71e7939345cee7ef0596b40d1ad068b"><Highlight kind="normal">    <a href="#ae71e7939345cee7ef0596b40d1ad068b">ForcePreciseRotationCost</a>(</Highlight><Highlight kind="stringliteral">&quot;force-precise-rotation-cost&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><Highlight kind="normal">                             <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Force the use of precise cost &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><Highlight kind="normal">                                      </Highlight><Highlight kind="stringliteral">&quot;loop rotation strategy.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><Highlight kind="normal">                             <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139" lineLink="#a75fe07dfba15c73225c8ca4cd720049d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a75fe07dfba15c73225c8ca4cd720049d">MisfetchCost</a>(</Highlight></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;misfetch-cost&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Cost that models the probabilistic risk of an instruction &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;misfetch due to a jump comparing to falling through, whose cost &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;is zero.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(1), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146" lineLink="#a72b387cbb4c16dbf0558135dd26ddfd0"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a72b387cbb4c16dbf0558135dd26ddfd0">JumpInstCost</a>(</Highlight><Highlight kind="stringliteral">&quot;jump-inst-cost&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><Highlight kind="normal">                                      <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Cost of jump instructions.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><Highlight kind="normal">                                      <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(1), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150" lineLink="#abf71e6f582691ae8bdf8ed170fb11ae6"><Highlight kind="normal">    <a href="#abf71e6f582691ae8bdf8ed170fb11ae6">TailDupPlacement</a>(</Highlight><Highlight kind="stringliteral">&quot;tail-dup-placement&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><Highlight kind="normal">                     <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Perform tail duplication during placement. &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><Highlight kind="normal">                              </Highlight><Highlight kind="stringliteral">&quot;Creates more fallthrough opportunities in &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><Highlight kind="normal">                              </Highlight><Highlight kind="stringliteral">&quot;outline branches.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><Highlight kind="normal">                     <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157" lineLink="#a84ae0b35deb4cbcffc27c3d52a781fca"><Highlight kind="normal">    <a href="#a84ae0b35deb4cbcffc27c3d52a781fca">BranchFoldPlacement</a>(</Highlight><Highlight kind="stringliteral">&quot;branch-fold-placement&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><Highlight kind="normal">                        <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Perform branch folding during placement. &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><Highlight kind="normal">                                 </Highlight><Highlight kind="stringliteral">&quot;Reduces code size.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><Highlight kind="normal">                        <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Heuristic for tail duplication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163" lineLink="#a707021480bba6c165b873f9e238859c5"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a707021480bba6c165b873f9e238859c5">TailDupPlacementThreshold</a>(</Highlight></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;tail-dup-placement-threshold&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Instruction cutoff for tail duplication during layout. &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Tail merging during layout is forced to have a threshold &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;that won&#39;t conflict.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(2), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Heuristic for aggressive tail duplication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171" lineLink="#adc8acb8291add6a055468711f701e78d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#adc8acb8291add6a055468711f701e78d">TailDupPlacementAggressiveThreshold</a>(</Highlight></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;tail-dup-placement-aggressive-threshold&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Instruction cutoff for aggressive tail duplication during &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;layout. Used at -O3. Tail merging during layout is forced to &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;have a threshold that won&#39;t conflict.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(4), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Heuristic for tail duplication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179" lineLink="#a7344284dac6ba9b8e48d9be67c954bfc"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a7344284dac6ba9b8e48d9be67c954bfc">TailDupPlacementPenalty</a>(</Highlight></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;tail-dup-placement-penalty&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Cost penalty for blocks that can avoid breaking CFG by copying. &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Copying can increase fallthrough, but it also increases icache &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;pressure. This parameter controls the penalty to account for that. &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Percent as integer.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(2), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Heuristic for tail duplication if profile count is used in cost model.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189" lineLink="#a84dfb254ed1062bc06a43d2365974bd2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a84dfb254ed1062bc06a43d2365974bd2">TailDupProfilePercentThreshold</a>(</Highlight></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;tail-dup-profile-percent-threshold&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;If profile count information is used in tail duplication cost &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;model, the gained fall through number from tail duplication &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;should be at least this percent of hot count.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(50), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Heuristic for triangle chains.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197" lineLink="#a8ac66559c601e390e9477131019ee0ca"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a8ac66559c601e390e9477131019ee0ca">TriangleChainCount</a>(</Highlight></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;triangle-chain-count&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Number of triangle-shaped-CFG&#39;s that need to be in a row for the &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;triangle tail duplication heuristic to kick in. 0 to disable.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(2), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Use case: When block layout is visualized after MBP pass, the basic blocks</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><Highlight kind="normal"></Highlight><Highlight kind="comment">// are labeled in layout order; meanwhile blocks could be numbered in a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><Highlight kind="normal"></Highlight><Highlight kind="comment">// different order. It&#39;s hard to map between the graph and pass output.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><Highlight kind="normal"></Highlight><Highlight kind="comment">// With this option on, the basic blocks are renumbered in function layout</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><Highlight kind="normal"></Highlight><Highlight kind="comment">// order. For debugging only.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208" lineLink="#ad1fed248fc2af534bd094b35c9f0c64b"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#ad1fed248fc2af534bd094b35c9f0c64b">RenumberBlocksBeforeView</a>(</Highlight></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;renumber-blocks-before-view&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;If true, basic blocks are re-numbered before MBP layout is printed &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;into a dot graph. Only used when a function is being printed.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215" lineLink="#a1160412b923427430e8bf4c819d79a93"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a1160412b923427430e8bf4c819d79a93">ExtTspBlockPlacementMaxBlocks</a>(</Highlight></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;ext-tsp-block-placement-max-blocks&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Maximum number of basic blocks in a function to run ext-TSP &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;block placement.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(UINT&#95;MAX), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>);</Highlight></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Apply the ext-tsp algorithm minimizing the size of a binary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223" lineLink="#a956f6faccd85fe2a75302e0ac3ecc606"><Highlight kind="normal">    <a href="#a956f6faccd85fe2a75302e0ac3ecc606">ApplyExtTspForSize</a>(</Highlight><Highlight kind="stringliteral">&quot;apply-ext-tsp-for-size&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><Highlight kind="normal">                       <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Use ext-tsp for size-aware block placement.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</Highlight></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><Highlight kind="normal"></Highlight><Highlight kind="keyword">extern</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#ae4599fe5d1385154f1bfbc41a10495c5">EnableExtTspBlockPlacement</a>;</Highlight></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><Highlight kind="normal"></Highlight><Highlight kind="keyword">extern</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#a2dee051dfc0746e4fbf6e26175ece121">ApplyExtTspWithoutProfile</a>;</Highlight></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><Highlight kind="normal"></Highlight><Highlight kind="keyword">extern</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="/docs/api/namespaces/llvm/#a75dea20875e2199efbf65662db1234d8">StaticLikelyProb</a>;</Highlight></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><Highlight kind="normal"></Highlight><Highlight kind="keyword">extern</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="/docs/api/namespaces/llvm/#a4de1c8a569d0350e16d8c5e0746d5bbf">ProfileLikelyProb</a>;</Highlight></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Internal option used to control BFI display only after MBP pass.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Defined in CodeGen/MachineBlockFrequencyInfo.cpp:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><Highlight kind="normal"></Highlight><Highlight kind="comment">// -view-block-layout-with-bfi=</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235" lineLink="/docs/api/namespaces/llvm/#a7cc8a419725f3a9ce1d23c2db21ea143"><Highlight kind="normal"></Highlight><Highlight kind="keyword">extern</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;GVDAGType&gt;</a> <a href="/docs/api/namespaces/llvm/#a7cc8a419725f3a9ce1d23c2db21ea143">ViewBlockLayoutWithBFI</a>;</Highlight></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Command line option to specify the name of the function for CFG dump</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Defined in Analysis/BlockFrequencyInfo.cpp:  -view-bfi-func-name=</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><Highlight kind="normal"></Highlight><Highlight kind="keyword">extern</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;std::string&gt;</a> <a href="/docs/api/namespaces/llvm/#a6391a34afa5b4ed1a5e556a8cc4d971b">ViewBlockFreqFuncName</a>;</Highlight></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// namespace llvm</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242" lineLink="/docs/api/namespaces/anonymous-machineblockplacement-cpp-"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a>;</Highlight></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><Highlight kind="comment">/// Type for our function-wide basic block -&gt; block chain mapping.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247" lineLink="/docs/api/namespaces/anonymous-machineblockplacement-cpp-/#a2e9703f1f38a15be415246106144a16d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/anonymous-machineblockplacement-cpp-/#a2e9703f1f38a15be415246106144a16d">BlockToChainMapType</a> = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MachineBasicBlock &#42;, BlockChain &#42;&gt;</a>;</Highlight></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><Highlight kind="comment">/// A chain of blocks which will be laid out contiguously.</Highlight></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><Highlight kind="comment">/// This is the datastructure representing a chain of consecutive blocks that</Highlight></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><Highlight kind="comment">/// are profitable to layout together in order to maximize fallthrough</Highlight></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><Highlight kind="comment">/// probabilities and code locality. We also can use a block chain to represent</Highlight></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><Highlight kind="comment">/// a sequence of basic blocks which have some external (correctness)</Highlight></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><Highlight kind="comment">/// requirement for sequential layout.</Highlight></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><Highlight kind="comment">/// Chains can be built around a single basic block and can be merged to grow</Highlight></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><Highlight kind="comment">/// them. They participate in a block-to-chain mapping, which is updated</Highlight></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><Highlight kind="comment">/// automatically as chains are merged together.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><Highlight kind="comment">  /// The sequence of blocks belonging to this chain.</Highlight></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><Highlight kind="comment">  /// This is the sequence of blocks for a particular chain. These will be laid</Highlight></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><Highlight kind="comment">  /// out in-order within the function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 4&gt;</a> Blocks;</Highlight></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><Highlight kind="comment">  /// A handle to the function-wide basic block to block chain mapping.</Highlight></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><Highlight kind="comment">  /// This is retained in each block chain to simplify the computation of child</Highlight></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><Highlight kind="comment">  /// block chains for SCC-formation and iteration. We store the edges to child</Highlight></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><Highlight kind="comment">  /// basic blocks, and map them back to their associated chains using this</Highlight></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><Highlight kind="comment">  /// structure.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-machineblockplacement-cpp-/#a2e9703f1f38a15be415246106144a16d">BlockToChainMapType</a> &amp;BlockToChain;</Highlight></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><Highlight kind="comment">  /// Construct a new BlockChain.</Highlight></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><Highlight kind="comment">  /// This builds a new block chain representing a single basic block in the</Highlight></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><Highlight kind="comment">  /// function. It also registers itself as the chain that block participates</Highlight></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><Highlight kind="comment">  /// in with the BlockToChain mapping.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a>(<a href="/docs/api/namespaces/anonymous-machineblockplacement-cpp-/#a2e9703f1f38a15be415246106144a16d">BlockToChainMapType</a> &amp;BlockToChain, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB)</Highlight></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><Highlight kind="normal">      : Blocks(1, BB), BlockToChain(BlockToChain) &#123;</Highlight></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BB &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Cannot create a chain with a null basic block&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><Highlight kind="normal">    BlockToChain&#91;BB&#93; = </Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><Highlight kind="comment">  /// Iterator over blocks within the chain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#aac2485344159ae07cfd3aa75113f50f5"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#aac2485344159ae07cfd3aa75113f50f5">iterator</a> = <a href="/docs/api/classes/llvm/smallvectorimpl/#ac5b936169badf0b703567eb960278648">SmallVectorImpl&lt;MachineBasicBlock &#42;&gt;::iterator</a>;</Highlight></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a4b69724989408455732d7e436d4da6be"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a4b69724989408455732d7e436d4da6be">const&#95;iterator</a> = <a href="/docs/api/classes/llvm/smallvectorimpl/#a641b0782e0cc309372855bfc19fdfd97">SmallVectorImpl&lt;MachineBasicBlock &#42;&gt;::const&#95;iterator</a>;</Highlight></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><Highlight kind="comment">  /// Beginning of blocks within the chain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#afdac6ad64953988f2ba10ecc1df333c5"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#aac2485344159ae07cfd3aa75113f50f5">iterator</a> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#afdac6ad64953988f2ba10ecc1df333c5">begin</a>() &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Blocks.begin(); &#125;</Highlight></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a5c35917ea8f9b30658afaa6a5753048a"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a4b69724989408455732d7e436d4da6be">const&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a5c35917ea8f9b30658afaa6a5753048a">begin</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Blocks.begin(); &#125;</Highlight></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><Highlight kind="comment">  /// End of blocks within the chain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a273f25cc15e7c494d9e5dd29cb07a88b"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#aac2485344159ae07cfd3aa75113f50f5">iterator</a> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a273f25cc15e7c494d9e5dd29cb07a88b">end</a>() &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Blocks.end(); &#125;</Highlight></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a25661224cb2e0ab5b2985319276fbfce"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a4b69724989408455732d7e436d4da6be">const&#95;iterator</a> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a25661224cb2e0ab5b2985319276fbfce">end</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Blocks.end(); &#125;</Highlight></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#aa6a5128cead90f00a37234c186692340"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#aa6a5128cead90f00a37234c186692340">remove</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#aac2485344159ae07cfd3aa75113f50f5">iterator</a> i = <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#afdac6ad64953988f2ba10ecc1df333c5">begin</a>(); i != <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a273f25cc15e7c494d9e5dd29cb07a88b">end</a>(); ++i) &#123;</Highlight></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&#42;i == BB) &#123;</Highlight></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><Highlight kind="normal">        Blocks.erase(i);</Highlight></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><Highlight kind="comment">  /// Merge a block chain into this one.</Highlight></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><Highlight kind="comment">  /// This routine merges a block chain into this one. It takes care of forming</Highlight></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><Highlight kind="comment">  /// a contiguous sequence of basic blocks, updating the edge list, and</Highlight></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><Highlight kind="comment">  /// updating the block -&gt; chain mapping. It does not free or tear down the</Highlight></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><Highlight kind="comment">  /// old chain, but the old chain&#39;s block list is no longer valid.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a939be2486e7faed5e6e1fd9d02311273"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a939be2486e7faed5e6e1fd9d02311273">merge</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB, <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;Chain) &#123;</Highlight></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BB &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Can&#39;t merge a null block.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Blocks.empty() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Can&#39;t merge into an empty chain.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Fast path in case we don&#39;t have a chain already.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Chain) &#123;</Highlight></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!BlockToChain&#91;BB&#93; &amp;&amp;</Highlight></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Passed chain is null, but BB has entry in BlockToChain.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><Highlight kind="normal">      Blocks.push&#95;back(BB);</Highlight></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><Highlight kind="normal">      BlockToChain&#91;BB&#93; = </Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BB == &#42;Chain-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Passed BB is not head of Chain.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Chain-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>() != Chain-&gt;<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</Highlight></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Update the incoming blocks to point to this chain, and add them to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// chain structure.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ChainBB : &#42;Chain) &#123;</Highlight></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><Highlight kind="normal">      Blocks.push&#95;back(ChainBB);</Highlight></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BlockToChain&#91;ChainBB&#93; == Chain &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Incoming blocks not in chain.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><Highlight kind="normal">      BlockToChain&#91;ChainBB&#93; = </Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><Highlight kind="comment">  /// Dump the blocks in this chain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#aa8b7b149176869053e12294206134631"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/compiler-h/#aa863693eef567397d9c292da5bf22d34">LLVM&#95;DUMP&#95;METHOD</a> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#aa8b7b149176869053e12294206134631">dump</a>() &#123;</Highlight></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : &#42;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;dump();</Highlight></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif </Highlight><Highlight kind="comment">// NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><Highlight kind="comment">  /// Count of predecessors of any block within the chain which have not</Highlight></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><Highlight kind="comment">  /// yet been scheduled.  In general, we will delay scheduling this chain</Highlight></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><Highlight kind="comment">  /// until those predecessors are scheduled (or we find a sufficiently good</Highlight></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><Highlight kind="comment">  /// reason to override this heuristic.)  Note that when forming loop chains,</Highlight></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><Highlight kind="comment">  /// blocks outside the loop are ignored and treated as if they were already</Highlight></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><Highlight kind="comment">  /// scheduled.</Highlight></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><Highlight kind="comment">  /// Note: This field is reinitialized multiple times - once for each loop,</Highlight></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><Highlight kind="comment">  /// and then once for the function as a whole.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a8e686b9f871a08ccedf4c9af685a2ee0"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#a8e686b9f871a08ccedf4c9af685a2ee0">UnscheduledPredecessors</a> = 0;</Highlight></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#ad7175334e09f55bf7b5fb08d9522449e">MachineBlockPlacement</a> : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a> &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><Highlight kind="comment">  /// A type for a block filter set.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal">BlockFilterSet = <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;const MachineBasicBlock &#42;, 16&gt;</a>;</Highlight></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><Highlight kind="comment">  /// Pair struct containing basic block and taildup profitability</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal">BlockAndTailDupResult &#123;</Highlight></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ShouldTailDup;</Highlight></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><Highlight kind="comment">  /// Triple struct containing edge weight and the edge.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal">WeightedEdge &#123;</Highlight></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> Weight;</Highlight></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Src = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Dest = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><Highlight kind="comment">  /// work lists of blocks that are ready to be laid out</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 16&gt;</a> BlockWorkList;</Highlight></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 16&gt;</a> EHPadWorkList;</Highlight></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><Highlight kind="comment">  /// Edges that have already been computed as optimal.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MachineBasicBlock &#42;, BlockAndTailDupResult&gt;</a> ComputedEdges;</Highlight></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><Highlight kind="comment">  /// Machine Function</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &#42;F = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><Highlight kind="comment">  /// A handle to the branch probability pass.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebranchprobabilityinfo">MachineBranchProbabilityInfo</a> &#42;MBPI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><Highlight kind="comment">  /// A handle to the function-wide block frequency pass.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><Highlight kind="normal">  std::unique&#95;ptr&lt;MBFIWrapper&gt; MBFI;</Highlight></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><Highlight kind="comment">  /// A handle to the loop info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machineloopinfo">MachineLoopInfo</a> &#42;MLI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><Highlight kind="comment">  /// Preferred loop exit.</Highlight></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><Highlight kind="comment">  /// Member variable for convenience. It may be removed by duplication deep</Highlight></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><Highlight kind="comment">  /// in the call stack.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;PreferredLoopExit = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><Highlight kind="comment">  /// A handle to the target&#39;s instruction info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;TII = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><Highlight kind="comment">  /// A handle to the target&#39;s lowering info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetloweringbase">TargetLoweringBase</a> &#42;TLI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><Highlight kind="comment">  /// A handle to the post dominator tree.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinepostdominatortree">MachinePostDominatorTree</a> &#42;MPDT = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/targetpassconfig">TargetPassConfig</a> &#42;PassConfig = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><Highlight kind="comment">  /// Duplicator used to duplicate tails during placement.</Highlight></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><Highlight kind="comment">  /// Placement decisions can open up new tail duplication opportunities, but</Highlight></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><Highlight kind="comment">  /// since tail duplication affects placement decisions of later blocks, it</Highlight></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><Highlight kind="comment">  /// must be done inline.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/tailduplicator">TailDuplicator</a> TailDup;</Highlight></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><Highlight kind="comment">  /// Partial tail duplication threshold.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> DupThreshold;</Highlight></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> TailDupSize;</Highlight></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><Highlight kind="comment">  /// True:  use block profile count to compute tail duplication cost.</Highlight></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><Highlight kind="comment">  /// False: use block frequency to compute tail duplication cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> UseProfileCount = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><Highlight kind="comment">  /// Allocator and owner of BlockChain structures.</Highlight></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><Highlight kind="comment">  /// We build BlockChains lazily while processing the loop structure of</Highlight></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><Highlight kind="comment">  /// a function. To reduce malloc traffic, we allocate them using this</Highlight></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><Highlight kind="comment">  /// slab-like allocator, and destroy them after the pass completes. An</Highlight></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><Highlight kind="comment">  /// important guarantee is that this allocator produces stable pointers to</Highlight></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><Highlight kind="comment">  /// the chains.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/specificbumpptrallocator">SpecificBumpPtrAllocator&lt;BlockChain&gt;</a> ChainAllocator;</Highlight></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><Highlight kind="comment">  /// Function wide BasicBlock to BlockChain mapping.</Highlight></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><Highlight kind="comment">  /// This mapping allows efficiently moving from any given basic block to the</Highlight></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><Highlight kind="comment">  /// BlockChain it participates in, if any. We use it to, among other things,</Highlight></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><Highlight kind="comment">  /// allow implicitly defining edges between chains as the existing edges</Highlight></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><Highlight kind="comment">  /// between basic blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MachineBasicBlock &#42;, BlockChain &#42;&gt;</a> BlockToChain;</Highlight></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><Highlight kind="comment">  /// The set of basic blocks that have terminators that cannot be fully</Highlight></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><Highlight kind="comment">  /// analyzed.  These basic blocks cannot be re-ordered safely by</Highlight></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><Highlight kind="comment">  /// MachineBlockPlacement, and we must preserve physical layout of these</Highlight></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><Highlight kind="comment">  /// blocks and their successors through the pass.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;MachineBasicBlock &#42;, 4&gt;</a> BlocksWithUnanalyzableExits;</Highlight></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><Highlight kind="comment">  /// Get block profile count or frequency according to UseProfileCount.</Highlight></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><Highlight kind="comment">  /// The return value is used to model tail duplication cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> getBlockCountOrFrequency(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UseProfileCount) &#123;</Highlight></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> = MBFI-&gt;getBlockProfileCount(BB);</Highlight></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>)</Highlight></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(&#42;<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>);</Highlight></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0);</Highlight></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MBFI-&gt;getBlockFreq(BB);</Highlight></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><Highlight kind="comment">  /// Scale the DupThreshold according to basic block size.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> scaleThreshold(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB);</Highlight></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> initTailDupThreshold();</Highlight></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><Highlight kind="comment">  /// Decrease the UnscheduledPredecessors count for all blocks in chain, and</Highlight></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><Highlight kind="comment">  /// if the count goes to 0, add them to the appropriate work list.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> markChainSuccessors(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><Highlight kind="normal">                           </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopHeaderBB,</Highlight></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><Highlight kind="normal">                           </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><Highlight kind="comment">  /// Decrease the UnscheduledPredecessors count for a single block, and</Highlight></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><Highlight kind="comment">  /// if the count goes to 0, add them to the appropriate work list.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> markBlockSuccessors(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;Chain, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><Highlight kind="normal">                           </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopHeaderBB,</Highlight></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><Highlight kind="normal">                           </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a></Highlight></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><Highlight kind="normal">  collectViableSuccessors(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><Highlight kind="normal">                          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter,</Highlight></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><Highlight kind="normal">                          <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 4&gt;</a> &amp;Successors);</Highlight></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> isBestSuccessor(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred,</Highlight></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><Highlight kind="normal">                       BlockFilterSet &#42;BlockFilter);</Highlight></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> findDuplicateCandidates(<a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineBasicBlock &#42;&gt;</a> &amp;Candidates,</Highlight></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><Highlight kind="normal">                               BlockFilterSet &#42;BlockFilter);</Highlight></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> repeatedlyTailDuplicateBlock(</Highlight></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;&amp;LPred,</Highlight></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopHeaderBB, <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><Highlight kind="normal">      BlockFilterSet &#42;BlockFilter,</Highlight></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> &amp;PrevUnplacedBlockIt,</Highlight></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/setvector/#a813fd00ac7e5e3261ffe67f9322a5480">BlockFilterSet::iterator</a> &amp;PrevUnplacedBlockInFilterIt);</Highlight></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><Highlight kind="normal">  maybeTailDuplicateBlock(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LPred,</Highlight></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><Highlight kind="normal">                          <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;Chain, BlockFilterSet &#42;BlockFilter,</Highlight></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><Highlight kind="normal">                          <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> &amp;PrevUnplacedBlockIt,</Highlight></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><Highlight kind="normal">                          <a href="/docs/api/classes/llvm/setvector/#a813fd00ac7e5e3261ffe67f9322a5480">BlockFilterSet::iterator</a> &amp;PrevUnplacedBlockInFilterIt,</Highlight></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><Highlight kind="normal">                          </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &amp;DuplicatedToLPred);</Highlight></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> hasBetterLayoutPredecessor(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ,</Highlight></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;SuccChain,</Highlight></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> SuccProb,</Highlight></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> RealSuccProb,</Highlight></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter);</Highlight></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><Highlight kind="normal">  BlockAndTailDupResult selectBestSuccessor(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><Highlight kind="normal">                                            </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><Highlight kind="normal">                                            </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter);</Highlight></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><Highlight kind="normal">  selectBestCandidateBlock(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><Highlight kind="normal">                           <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineBasicBlock &#42;&gt;</a> &amp;WorkList);</Highlight></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><Highlight kind="normal">  getFirstUnplacedBlock(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;PlacedChain,</Highlight></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> &amp;PrevUnplacedBlockIt);</Highlight></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><Highlight kind="normal">  getFirstUnplacedBlock(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;PlacedChain,</Highlight></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><Highlight kind="normal">                        <a href="/docs/api/classes/llvm/setvector/#a813fd00ac7e5e3261ffe67f9322a5480">BlockFilterSet::iterator</a> &amp;PrevUnplacedBlockInFilterIt,</Highlight></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><Highlight kind="normal">                        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter);</Highlight></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><Highlight kind="comment">  /// Add a basic block to the work list if it is appropriate.</Highlight></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><Highlight kind="comment">  ///</Highlight></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><Highlight kind="comment">  /// If the optional parameter BlockFilter is provided, only MBB</Highlight></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><Highlight kind="comment">  /// present in the set will be added to the worklist. If nullptr</Highlight></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><Highlight kind="comment">  /// is provided, no filtering occurs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> fillWorkLists(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</Highlight></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><Highlight kind="normal">                     <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;BlockChain &#42;&gt;</a> &amp;UpdatedPreds,</Highlight></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><Highlight kind="normal">                     </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter);</Highlight></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> buildChain(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB, <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><Highlight kind="normal">                  BlockFilterSet &#42;BlockFilter = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> canMoveBottomBlockToTop(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BottomBlock,</Highlight></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><Highlight kind="normal">                               </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;OldTop);</Highlight></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> hasViableTopFallthrough(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Top,</Highlight></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><Highlight kind="normal">                               </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet);</Highlight></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> TopFallThroughFreq(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Top,</Highlight></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><Highlight kind="normal">                                    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet);</Highlight></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> FallThroughGains(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;NewTop,</Highlight></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;OldTop,</Highlight></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ExitBB,</Highlight></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet);</Highlight></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;findBestLoopTopHelper(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;OldTop,</Highlight></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><Highlight kind="normal">                                           </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &amp;L,</Highlight></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><Highlight kind="normal">                                           </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet);</Highlight></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;findBestLoopTop(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &amp;L,</Highlight></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><Highlight kind="normal">                                     </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet);</Highlight></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;findBestLoopExit(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &amp;L,</Highlight></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><Highlight kind="normal">                                      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet,</Highlight></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><Highlight kind="normal">                                      <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> &amp;ExitFreq);</Highlight></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><Highlight kind="normal">  BlockFilterSet collectLoopBlockSet(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &amp;L);</Highlight></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> buildLoopChains(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &amp;L);</Highlight></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> rotateLoop(<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;LoopChain, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ExitingBB,</Highlight></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><Highlight kind="normal">                  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> ExitFreq, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet);</Highlight></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> rotateLoopWithProfile(<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;LoopChain, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &amp;L,</Highlight></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><Highlight kind="normal">                             </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet);</Highlight></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> buildCFGChains();</Highlight></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> optimizeBranches();</Highlight></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> alignBlocks();</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><Highlight kind="comment">  /// Returns true if a block should be tail-duplicated to increase fallthrough</Highlight></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><Highlight kind="comment">  /// opportunities.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> shouldTailDuplicate(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB);</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><Highlight kind="comment">  /// Check the edge frequencies to see if tail duplication will increase</Highlight></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><Highlight kind="comment">  /// fallthroughs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> isProfitableToTailDup(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><Highlight kind="normal">                             </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ,</Highlight></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> QProb, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><Highlight kind="normal">                             </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter);</Highlight></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><Highlight kind="comment">  /// Check for a trellis layout.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> isTrellis(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><Highlight kind="normal">                 </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineBasicBlock &#42;&gt;</a> &amp;ViableSuccs,</Highlight></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><Highlight kind="normal">                 </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;Chain, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter);</Highlight></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><Highlight kind="comment">  /// Get the best successor given a trellis layout.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><Highlight kind="normal">  BlockAndTailDupResult getBestTrellisSuccessor(</Highlight></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineBasicBlock &#42;&gt;</a> &amp;ViableSuccs,</Highlight></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> AdjustedSumProb, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter);</Highlight></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><Highlight kind="comment">  /// Get the best pair of non-conflicting edges.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> std::pair&lt;WeightedEdge, WeightedEdge&gt; getBestNonConflictingEdges(</Highlight></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/mutablearrayref">MutableArrayRef</a>&lt;<a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;WeightedEdge, 8&gt;</a>&gt; Edges);</Highlight></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><Highlight kind="comment">  /// Returns true if a block can tail duplicate into all unplaced</Highlight></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><Highlight kind="comment">  /// predecessors. Filters based on loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> canTailDuplicateUnplacedPreds(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><Highlight kind="normal">                                     <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ,</Highlight></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><Highlight kind="normal">                                     </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><Highlight kind="normal">                                     </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter);</Highlight></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><Highlight kind="comment">  /// Find chains of triangles to tail-duplicate where a global analysis works,</Highlight></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><Highlight kind="comment">  /// but a local analysis would not find them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> precomputeTriangleChains();</Highlight></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><Highlight kind="comment">  /// Apply a post-processing step optimizing block placement.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> applyExtTsp(</Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> OptForSize);</Highlight></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><Highlight kind="comment">  /// Modify the existing block placement in the function and adjust all jumps.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> assignBlockOrder(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::vector&lt;const MachineBasicBlock &#42;&gt; &amp;NewOrder);</Highlight></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><Highlight kind="comment">  /// Create a single CFG chain from the current block order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> createCFGChainExtTsp();</Highlight></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#a4944db6b12999ee0713352c27e8125e4"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#a4944db6b12999ee0713352c27e8125e4">ID</a>; </Highlight><Highlight kind="comment">// Pass identification, replacement for typeid</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#ad7175334e09f55bf7b5fb08d9522449e"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#ad7175334e09f55bf7b5fb08d9522449e">MachineBlockPlacement</a>() : <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a>(<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#a4944db6b12999ee0713352c27e8125e4">ID</a>) &#123;</Highlight></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#af3e08655b0654029c7cf037651c8d7d6">initializeMachineBlockPlacementPass</a>(&#42;<a href="/docs/api/classes/llvm/passregistry/#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</Highlight></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> runOnMachineFunction(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) </Highlight><Highlight kind="keyword">override</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#ad65badde897b7d4f51fc7c545538a388"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#ad65badde897b7d4f51fc7c545538a388">allowTailDupPlacement</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(F);</Highlight></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#abf71e6f582691ae8bdf8ed170fb11ae6">TailDupPlacement</a> &amp;&amp; !F-&gt;getTarget().requiresStructuredCFG();</Highlight></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#a237eea84de9a4035f23734cb04d32389"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#a237eea84de9a4035f23734cb04d32389">getAnalysisUsage</a>(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</Highlight><Highlight kind="keyword"> const override </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machinebranchprobabilityinfowrapperpass">MachineBranchProbabilityInfoWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machineblockfrequencyinfowrapperpass">MachineBlockFrequencyInfoWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#abf71e6f582691ae8bdf8ed170fb11ae6">TailDupPlacement</a>)</Highlight></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><Highlight kind="normal">      AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machinepostdominatortreewrapperpass">MachinePostDominatorTreeWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machineloopinfowrapperpass">MachineLoopInfoWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/profilesummaryinfowrapperpass">ProfileSummaryInfoWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/targetpassconfig">TargetPassConfig</a>&gt;();</Highlight></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinefunctionpass/#a864fd57b4304ef933b3281d0ef85a88e">MachineFunctionPass::getAnalysisUsage</a>(AU);</Highlight></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// end anonymous namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#a4944db6b12999ee0713352c27e8125e4">MachineBlockPlacement::ID</a> = 0;</Highlight></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641" lineLink="/docs/api/namespaces/llvm/#adc14e69cab3ee0a21fdfdd40632b7ee1"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/#adc14e69cab3ee0a21fdfdd40632b7ee1">llvm::MachineBlockPlacementID</a> = <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#a4944db6b12999ee0713352c27e8125e4">MachineBlockPlacement::ID</a>;</Highlight></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643" lineLink="#aa4d0eea634133a91f99ee833a4d073ef"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE&#95;PASS&#95;BEGIN</a>(<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#ad7175334e09f55bf7b5fb08d9522449e">MachineBlockPlacement</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>,</Highlight></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><Highlight kind="normal">                      </Highlight><Highlight kind="stringliteral">&quot;Branch Probability Basic Block Placement&quot;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/machinebranchprobabilityinfowrapperpass">MachineBranchProbabilityInfoWrapperPass</a>)</Highlight></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/machineblockfrequencyinfowrapperpass">MachineBlockFrequencyInfoWrapperPass</a>)</Highlight></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/machinepostdominatortreewrapperpass">MachinePostDominatorTreeWrapperPass</a>)</Highlight></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/machineloopinfowrapperpass">MachineLoopInfoWrapperPass</a>)</Highlight></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/profilesummaryinfowrapperpass">ProfileSummaryInfoWrapperPass</a>)</Highlight></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650" lineLink="#a030569d5a541b6110f2ae1b6a3413a58"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a74ce8276b89067e806f67c45a6d92575">INITIALIZE&#95;PASS&#95;END</a>(<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#ad7175334e09f55bf7b5fb08d9522449e">MachineBlockPlacement</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>,</Highlight></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651" lineLink="#a80b3a35dc5c2cb6840ae523bc8d1902a"><Highlight kind="normal">                    </Highlight><Highlight kind="stringliteral">&quot;Branch Probability Basic Block Placement&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/false">false</a>, <a href="/docs/api/namespaces/false">false</a>)</Highlight></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><Highlight kind="comment">/// Helper to print the name of a MBB.</Highlight></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><Highlight kind="comment">/// Only used by debug logging.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657" lineLink="#a8f9ee7f9ffc036496a8663335da175fa"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> std::string <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><Highlight kind="normal">  std::string Result;</Highlight></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/raw-string-ostream">raw&#95;string&#95;ostream</a> OS(Result);</Highlight></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><Highlight kind="normal">  OS &lt;&lt; <a href="/docs/api/namespaces/llvm/#af7881286e3ea4d7f1c4a63c87c132dac">printMBBReference</a>(&#42;BB);</Highlight></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><Highlight kind="normal">  OS &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; (&#39;&quot;</Highlight><Highlight kind="normal"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#aedf6cb1135961f41f39dc58ca8576123">getName</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;&#39;)&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><Highlight kind="normal">  OS.<a href="/docs/api/classes/llvm/raw-ostream/#a520bdf57dfe3e73abb53d482893f0a27">flush</a>();</Highlight></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Result;</Highlight></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><Highlight kind="comment">/// Mark a chain&#39;s successors as having one fewer preds.</Highlight></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><Highlight kind="comment">/// When a chain is being merged into the &quot;placed&quot; chain, this routine will</Highlight></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><Highlight kind="comment">/// quickly walk the successors of each block in the chain and mark them as</Highlight></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><Highlight kind="comment">/// having one fewer active predecessor. It also adds any successors of this</Highlight></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><Highlight kind="comment">/// chain which reach the zero-predecessor state to the appropriate worklist.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::markChainSuccessors(</Highlight></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;Chain, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopHeaderBB,</Highlight></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter) &#123;</Highlight></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Walk all the blocks in this chain, marking their successors as having</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a predecessor placed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : Chain) &#123;</Highlight></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><Highlight kind="normal">    markBlockSuccessors(Chain, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, LoopHeaderBB, BlockFilter);</Highlight></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><Highlight kind="comment">/// Mark a single block&#39;s successors as having one fewer preds.</Highlight></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><Highlight kind="comment">/// Under normal circumstances, this is only called by markChainSuccessors,</Highlight></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><Highlight kind="comment">/// but if a block that was to be placed is completely tail-duplicated away,</Highlight></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><Highlight kind="comment">/// and was duplicated into the chain end, we need to redo markBlockSuccessors</Highlight></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><Highlight kind="comment">/// for just that block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::markBlockSuccessors(</Highlight></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;Chain, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>,</Highlight></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopHeaderBB, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter) &#123;</Highlight></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add any successors for which this is the only un-placed in-loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// predecessor to the worklist as a viable candidate for CFG-neutral</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// placement. No subsequent placement of this block will violate the CFG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// shape, so we get to use heuristics to choose a favorable placement.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;successors()) &#123;</Highlight></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BlockFilter &amp;&amp; !BlockFilter-&gt;count(Succ))</Highlight></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;SuccChain = &#42;BlockToChain&#91;Succ&#93;;</Highlight></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Disregard edges within a fixed chain, or edges to the loop header.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&amp;Chain == &amp;SuccChain || Succ == LoopHeaderBB)</Highlight></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This is a cross-chain edge that is within the loop, so decrement the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// loop predecessor count of the destination chain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccChain.UnscheduledPredecessors == 0 ||</Highlight></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><Highlight kind="normal">        --SuccChain.UnscheduledPredecessors &gt; 0)</Highlight></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewBB = &#42;SuccChain.begin();</Highlight></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewBB-&gt;isEHPad())</Highlight></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><Highlight kind="normal">      EHPadWorkList.push&#95;back(NewBB);</Highlight></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><Highlight kind="normal">      BlockWorkList.push&#95;back(NewBB);</Highlight></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><Highlight kind="comment">/// This helper function collects the set of successors of block</Highlight></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><Highlight kind="comment">/// \\p BB that are allowed to be its layout successors, and return</Highlight></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><Highlight kind="comment">/// the total branch probability of edges from \\p BB to those</Highlight></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><Highlight kind="comment">/// blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><Highlight kind="normal"><a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> MachineBlockPlacement::collectViableSuccessors(</Highlight></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter,</Highlight></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 4&gt;</a> &amp;Successors) &#123;</Highlight></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Adjust edge probabilities by excluding edges pointing to blocks that is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// either not in BlockFilter or is already in the current chain. Consider the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// following CFG:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     ---&gt;A</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     |  / \\</Highlight></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><Highlight kind="comment">  //     | B   C</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     |  \\ / \\</Highlight></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><Highlight kind="comment">  //     ----D   E</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Assume A-&gt;C is very hot (&gt;90%), and C-&gt;D has a 50% probability, then after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A-&gt;C is chosen as a fall-through, D won&#39;t be selected as a successor of C</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// due to CFG constraint (the probability of C-&gt;D is not greater than</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// HotProb to break topo-order). If we exclude E that is not in BlockFilter</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// when calculating the probability of C-&gt;D, D will be selected and we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// will get A C D B as the layout of this loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> AdjustedSumProb = <a href="/docs/api/classes/llvm/branchprobability/#a56e1b2d1999aadf4c513caee1ce5275b">BranchProbability::getOne</a>();</Highlight></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>()) &#123;</Highlight></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> SkipSucc = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Succ-&gt;isEHPad() || (BlockFilter &amp;&amp; !BlockFilter-&gt;count(Succ))) &#123;</Highlight></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><Highlight kind="normal">      SkipSucc = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><Highlight kind="normal">      <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;SuccChain = BlockToChain&#91;Succ&#93;;</Highlight></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccChain == &amp;Chain) &#123;</Highlight></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><Highlight kind="normal">        SkipSucc = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Succ != &#42;SuccChain-&gt;begin()) &#123;</Highlight></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(Succ)</Highlight></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><Highlight kind="normal">                          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; -&gt; Mid chain!\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SkipSucc)</Highlight></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><Highlight kind="normal">      AdjustedSumProb -= MBPI-&gt;getEdgeProbability(BB, Succ);</Highlight></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><Highlight kind="normal">      Successors.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Succ);</Highlight></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> AdjustedSumProb;</Highlight></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><Highlight kind="comment">/// The helper function returns the branch probability that is adjusted</Highlight></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><Highlight kind="comment">/// or normalized over the new total \\p AdjustedSumProb.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a></Highlight></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769" lineLink="#a0a894de03271c0ccc991e40f4cdd2623"><Highlight kind="normal"><a href="#a0a894de03271c0ccc991e40f4cdd2623">getAdjustedProbability</a>(<a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> OrigProb,</Highlight></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><Highlight kind="normal">                       <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> AdjustedSumProb) &#123;</Highlight></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> SuccProb;</Highlight></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><Highlight kind="normal">  uint32&#95;t SuccProbN = OrigProb.<a href="/docs/api/classes/llvm/branchprobability/#a7be5759bf75c903d1695fa97eca6f139">getNumerator</a>();</Highlight></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><Highlight kind="normal">  uint32&#95;t SuccProbD = AdjustedSumProb.<a href="/docs/api/classes/llvm/branchprobability/#a7be5759bf75c903d1695fa97eca6f139">getNumerator</a>();</Highlight></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccProbN &gt;= SuccProbD)</Highlight></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><Highlight kind="normal">    SuccProb = <a href="/docs/api/classes/llvm/branchprobability/#a56e1b2d1999aadf4c513caee1ce5275b">BranchProbability::getOne</a>();</Highlight></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><Highlight kind="normal">    SuccProb = <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a>(SuccProbN, SuccProbD);</Highlight></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> SuccProb;</Highlight></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><Highlight kind="comment">/// Check if \\p BB has exactly the successors in \\p Successors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784" lineLink="#ab20068697df3d13ab12e09852d99b7f7"><Highlight kind="normal"><a href="#ab20068697df3d13ab12e09852d99b7f7">hasSameSuccessors</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;BB,</Highlight></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><Highlight kind="normal">                  <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;const MachineBasicBlock &#42;&gt;</a> &amp;Successors) &#123;</Highlight></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB.<a href="/docs/api/classes/llvm/machinebasicblock/#a81626de817a0cb021ff8e915cf1942ed">succ&#95;size</a>() != Successors.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>())</Highlight></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We don&#39;t want to count self-loops</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Successors.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(&amp;BB))</Highlight></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : BB.<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>())</Highlight></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Successors.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(Succ))</Highlight></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><Highlight kind="comment">/// Check if a block should be tail duplicated to increase fallthrough</Highlight></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><Highlight kind="comment">/// opportunities.</Highlight></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><Highlight kind="comment">/// \\p BB Block to check.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MachineBlockPlacement::shouldTailDuplicate(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Blocks with single successors don&#39;t create additional fallthrough</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// opportunities. Don&#39;t duplicate them. TODO: When conditional exits are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// analyzable, allow them to be duplicated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsSimple = TailDup.isSimpleBB(BB);</Highlight></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a81626de817a0cb021ff8e915cf1942ed">succ&#95;size</a>() == 1)</Highlight></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> TailDup.shouldTailDuplicate(IsSimple, &#42;BB);</Highlight></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><Highlight kind="comment">/// Compare 2 BlockFrequency&#39;s with a small penalty for \\p A.</Highlight></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><Highlight kind="comment">/// In order to be conservative, we apply a X% penalty to account for</Highlight></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><Highlight kind="comment">/// increased icache pressure and static heuristics. For small frequencies</Highlight></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><Highlight kind="comment">/// we use only the numerators to improve accuracy. For simplicity, we assume</Highlight></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><Highlight kind="comment">/// the penalty is less than 100%</Highlight></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><Highlight kind="comment">/// TODO(iteratee): Use 64-bit fixed point edge frequencies everywhere.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817" lineLink="#a73743365177645c3db889f210cd5ad1d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a73743365177645c3db889f210cd5ad1d">greaterWithBias</a>(<a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>,</Highlight></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> EntryFreq) &#123;</Highlight></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> ThresholdProb(<a href="#a7344284dac6ba9b8e48d9be67c954bfc">TailDupPlacementPenalty</a>, 100);</Highlight></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> Gain = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a> - <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>;</Highlight></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> (Gain / ThresholdProb) &gt;= EntryFreq;</Highlight></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><Highlight kind="comment">/// Check the edge frequencies to see if tail duplication will increase</Highlight></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><Highlight kind="comment">/// fallthroughs. It only makes sense to call this function when</Highlight></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><Highlight kind="comment">/// \\p Succ would not be chosen otherwise. Tail duplication of \\p Succ is</Highlight></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><Highlight kind="comment">/// always locally profitable if we would have picked \\p Succ without</Highlight></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><Highlight kind="comment">/// considering duplication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MachineBlockPlacement::isProfitableToTailDup(</Highlight></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ,</Highlight></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> QProb, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter) &#123;</Highlight></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We need to do a probability calculation to make sure this is profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// First: does succ have a successor that post-dominates? This affects the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// calculation. The 2 relevant cases are:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    BB         BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    | \\Qout    | \\Qout</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   P|  C       |P C</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    =   C&#39;     =   C&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    |  /Qin    |  /Qin</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    | /        | /</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    Succ       Succ</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    / \\        | \\  V</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  U/   =V      |U \\</Highlight></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><Highlight kind="comment">  //  /     \\      =   D</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  D      E     |  /</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//               | /</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//               |/</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//               PDom</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  &#39;=&#39; : Branch taken for that CFG edge</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// In the second case, Placing Succ while duplicating it into C prevents the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// fallthrough of Succ into either D or PDom, because they now have C as an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// unplaced predecessor</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Start by figuring out which case we fall into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;PDom = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 4&gt;</a> SuccSuccs;</Highlight></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only scan the relevant successors</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> AdjustedSuccSumProb =</Highlight></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><Highlight kind="normal">      collectViableSuccessors(Succ, Chain, BlockFilter, SuccSuccs);</Highlight></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> PProb = MBPI-&gt;getEdgeProbability(BB, Succ);</Highlight></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/asmprinter-cpp/#a9541bbf765f7db0b078a45d6f43c34b4a8cb28931840da67702e5bd9068512905">BBFreq</a> = MBFI-&gt;getBlockFreq(BB);</Highlight></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SuccFreq = MBFI-&gt;getBlockFreq(Succ);</Highlight></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/asmprinter-cpp/#a9541bbf765f7db0b078a45d6f43c34b4a8cb28931840da67702e5bd9068512905">BBFreq</a> &#42; PProb;</Highlight></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> Qout = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/asmprinter/asmprinter-cpp/#a9541bbf765f7db0b078a45d6f43c34b4a8cb28931840da67702e5bd9068512905">BBFreq</a> &#42; QProb;</Highlight></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> EntryFreq = MBFI-&gt;getEntryFreq();</Highlight></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there are no more successors, it is profitable to copy, as it strictly</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// increases fallthrough.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccSuccs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 0)</Highlight></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a73743365177645c3db889f210cd5ad1d">greaterWithBias</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, Qout, EntryFreq);</Highlight></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> BestSuccSucc = <a href="/docs/api/classes/llvm/branchprobability/#afd00958cba7080048a84cccfcef55d71">BranchProbability::getZero</a>();</Highlight></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find the PDom or the best Succ if no PDom exists.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SuccSucc : SuccSuccs) &#123;</Highlight></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Prob = MBPI-&gt;getEdgeProbability(Succ, SuccSucc);</Highlight></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Prob &gt; BestSuccSucc)</Highlight></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><Highlight kind="normal">      BestSuccSucc = Prob;</Highlight></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PDom == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MPDT-&gt;dominates(SuccSucc, Succ)) &#123;</Highlight></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><Highlight kind="normal">        PDom = SuccSucc;</Highlight></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For the comparisons, we need to know Succ&#39;s best incoming edge that isn&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// from BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SuccBestPred = <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0);</Highlight></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SuccPred : Succ-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</Highlight></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccPred == Succ || SuccPred == BB ||</Highlight></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><Highlight kind="normal">        BlockToChain&#91;SuccPred&#93; == &amp;Chain ||</Highlight></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><Highlight kind="normal">        (BlockFilter &amp;&amp; !BlockFilter-&gt;count(SuccPred)))</Highlight></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Freq =</Highlight></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><Highlight kind="normal">        MBFI-&gt;getBlockFreq(SuccPred) &#42; MBPI-&gt;getEdgeProbability(SuccPred, Succ);</Highlight></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Freq &gt; SuccBestPred)</Highlight></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><Highlight kind="normal">      SuccBestPred = Freq;</Highlight></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Qin is Succ&#39;s best unplaced incoming edge that isn&#39;t BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> Qin = SuccBestPred;</Highlight></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If it doesn&#39;t have a post-dominating successor, here is the calculation:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    BB        BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    | \\Qout   |  \\</Highlight></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><Highlight kind="comment">  //   P|  C      |   =</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    =   C&#39;    |    C</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    |  /Qin   |     |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    | /       |     C&#39; (+Succ)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    Succ      Succ /|</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    / \\       |  \\/ |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  U/   =V     |  == |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  /     \\     | /  \\|</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  D      E    D     E</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  &#39;=&#39; : Branch taken for that CFG edge</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  Cost in the first case is: P + V</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  For this calculation, we always assume P &gt; Qout. If Qout &gt; P</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  The result of this function will be ignored at the caller.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  Let F = SuccFreq - Qin</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  Cost in the second case is: Qout + min(Qin, F) &#42; U + max(Qin, F) &#42; V</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PDom == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> || !Succ-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(PDom)) &#123;</Highlight></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> UProb = BestSuccSucc;</Highlight></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> VProb = AdjustedSuccSumProb - UProb;</Highlight></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = SuccFreq - Qin;</Highlight></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> V = SuccFreq &#42; VProb;</Highlight></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> QinU = std::min(Qin, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#42; UProb;</Highlight></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> BaseCost = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> + V;</Highlight></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> DupCost = Qout + QinU + std::max(Qin, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#42; VProb;</Highlight></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a73743365177645c3db889f210cd5ad1d">greaterWithBias</a>(BaseCost, DupCost, EntryFreq);</Highlight></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> UProb = MBPI-&gt;getEdgeProbability(Succ, PDom);</Highlight></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> VProb = AdjustedSuccSumProb - UProb;</Highlight></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> U = SuccFreq &#42; UProb;</Highlight></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> V = SuccFreq &#42; VProb;</Highlight></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = SuccFreq - Qin;</Highlight></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there is a post-dominating successor, here is the calculation:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// BB         BB                 BB          BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// | \\Qout    |   \\               | \\Qout     |  \\</Highlight></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><Highlight kind="comment">  // |P C       |    =              |P C        |   =</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// =   C&#39;     |P    C             =   C&#39;      |P   C</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// |  /Qin    |      |            |  /Qin     |     |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// | /        |      C&#39; (+Succ)   | /         |     C&#39; (+Succ)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Succ       Succ  /|            Succ        Succ /|</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// | \\  V     |   \\/ |            | \\  V      |  \\/ |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// |U \\       |U  /\\ =?           |U =        |U /\\ |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// =   D      = =  =?|            |   D       | =  =|</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// |  /       |/     D            |  /        |/    D</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// | /        |     /             | =         |    /</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// |/         |    /              |/          |   =</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Dom         Dom                Dom         Dom</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  &#39;=&#39; : Branch taken for that CFG edge</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The cost for taken branches in the first case is P + U</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Let F = SuccFreq - Qin</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The cost in the second case (assuming independence), given the layout:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// BB, Succ, (C+Succ), D, Dom or the layout:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// BB, Succ, D, Dom, (C+Succ)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is Qout + max(F, Qin) &#42; U + min(F, Qin)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// compare P + U vs Qout + P &#42; U + Qin.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The 3rd and 4th cases cover when Dom would be chosen to follow Succ.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For the 3rd case, the cost is P + 2 &#42; V</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For the 4th case, the cost is Qout + min(Qin, F) &#42; U + max(Qin, F) &#42; V + V</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We choose 4 over 3 when (P + V) &gt; Qout + min(Qin, F) &#42; U + max(Qin, F) &#42; V</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UProb &gt; AdjustedSuccSumProb / 2 &amp;&amp;</Highlight></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><Highlight kind="normal">      !hasBetterLayoutPredecessor(Succ, PDom, &#42;BlockToChain&#91;PDom&#93;, UProb, UProb,</Highlight></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><Highlight kind="normal">                                  Chain, BlockFilter))</Highlight></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Cases 3 &amp; 4</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a73743365177645c3db889f210cd5ad1d">greaterWithBias</a>(</Highlight></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><Highlight kind="normal">        (<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> + V), (Qout + std::max(Qin, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#42; VProb + std::min(Qin, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#42; UProb),</Highlight></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><Highlight kind="normal">        EntryFreq);</Highlight></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Cases 1 &amp; 2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a73743365177645c3db889f210cd5ad1d">greaterWithBias</a>((<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> + U),</Highlight></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><Highlight kind="normal">                         (Qout + std::min(Qin, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#42; AdjustedSuccSumProb +</Highlight></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><Highlight kind="normal">                          std::max(Qin, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#42; UProb),</Highlight></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><Highlight kind="normal">                         EntryFreq);</Highlight></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><Highlight kind="comment">/// Check for a trellis layout. \\p BB is the upper part of a trellis if its</Highlight></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><Highlight kind="comment">/// successors form the lower part of a trellis. A successor set S forms the</Highlight></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><Highlight kind="comment">/// lower part of a trellis if all of the predecessors of S are either in S or</Highlight></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><Highlight kind="comment">/// have all of S as successors. We ignore trellises where BB doesn&#39;t have 2</Highlight></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><Highlight kind="comment">/// successors because for fewer than 2, it&#39;s trivial, and for 3 or greater they</Highlight></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><Highlight kind="comment">/// are very uncommon and complex to compute optimally. Allowing edges within S</Highlight></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><Highlight kind="comment">/// is not strictly a trellis, but the same algorithm works, so we allow it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MachineBlockPlacement::isTrellis(</Highlight></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineBasicBlock &#42;&gt;</a> &amp;ViableSuccs,</Highlight></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;Chain, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter) &#123;</Highlight></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Technically BB could form a trellis with branching factor higher than 2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// But that&#39;s extremely uncommon.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a81626de817a0cb021ff8e915cf1942ed">succ&#95;size</a>() != 2 || ViableSuccs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() != 2)</Highlight></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const MachineBasicBlock &#42;, 2&gt;</a> Successors(BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a6321b189ea8fd5058663f8a87d6c23e9">succ&#95;begin</a>(),</Highlight></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><Highlight kind="normal">                                                       BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3ddd708642d60c1661992ff8ba1b215d">succ&#95;end</a>());</Highlight></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// To avoid reviewing the same predecessors twice.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const MachineBasicBlock &#42;, 8&gt;</a> SeenPreds;</Highlight></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : ViableSuccs) &#123;</Highlight></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> PredCount = 0;</Highlight></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;SuccPred : Succ-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</Highlight></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Allow triangle successors, but don&#39;t count them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Successors.count(SuccPred)) &#123;</Highlight></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Make sure that it is actually a triangle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;CheckSucc : SuccPred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>())</Highlight></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Successors.count(CheckSucc))</Highlight></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;PredChain = BlockToChain&#91;SuccPred&#93;;</Highlight></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccPred == BB || (BlockFilter &amp;&amp; !BlockFilter-&gt;count(SuccPred)) ||</Highlight></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><Highlight kind="normal">          PredChain == &amp;Chain || PredChain == BlockToChain&#91;Succ&#93;)</Highlight></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><Highlight kind="normal">      ++PredCount;</Highlight></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Perform the successor check only once.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SeenPreds.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(SuccPred).second)</Highlight></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#ab20068697df3d13ab12e09852d99b7f7">hasSameSuccessors</a>(&#42;SuccPred, Successors))</Highlight></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If one of the successors has only BB as a predecessor, it is not a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// trellis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PredCount &lt; 1)</Highlight></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><Highlight kind="comment">/// Pick the highest total weight pair of edges that can both be laid out.</Highlight></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><Highlight kind="comment">/// The edges in \\p Edges&#91;0&#93; are assumed to have a different destination than</Highlight></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><Highlight kind="comment">/// the edges in \\p Edges&#91;1&#93;. Simple counting shows that the best pair is either</Highlight></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><Highlight kind="comment">/// the individual highest weight edges to the 2 different destinations, or in</Highlight></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><Highlight kind="comment">/// case of a conflict, one of them should be replaced with a 2nd best edge.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><Highlight kind="normal">std::pair&lt;MachineBlockPlacement::WeightedEdge,</Highlight></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><Highlight kind="normal">          MachineBlockPlacement::WeightedEdge&gt;</Highlight></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><Highlight kind="normal">MachineBlockPlacement::getBestNonConflictingEdges(</Highlight></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/mutablearrayref">MutableArrayRef</a>&lt;<a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBlockPlacement::WeightedEdge, 8&gt;</a>&gt;</Highlight></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><Highlight kind="normal">        Edges) &#123;</Highlight></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Sort the edges, and then for each successor, find the best incoming</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// predecessor. If the best incoming predecessors aren&#39;t the same,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// then that is clearly the best layout. If there is a conflict, one of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// successors will have to fallthrough from the second best predecessor. We</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// compare which combination is better overall.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Sort for highest frequency.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = &#91;&#93;(WeightedEdge <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, WeightedEdge <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Weight &gt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.Weight; &#125;;</Highlight></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable&#95;sort</a>(Edges&#91;0&#93;, Cmp);</Highlight></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable&#95;sort</a>(Edges&#91;1&#93;, Cmp);</Highlight></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> BestA = Edges&#91;0&#93;.begin();</Highlight></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> BestB = Edges&#91;1&#93;.begin();</Highlight></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Arrange for the correct answer to be in BestA and BestB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the 2 best edges don&#39;t conflict, the answer is already there.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BestA-&gt;Src == BestB-&gt;Src) &#123;</Highlight></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Compare the total fallthrough of (Best + Second Best) for both pairs</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SecondBestA = std::next(BestA);</Highlight></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SecondBestB = std::next(BestB);</Highlight></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> BestAScore = BestA-&gt;Weight + SecondBestB-&gt;Weight;</Highlight></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> BestBScore = BestB-&gt;Weight + SecondBestA-&gt;Weight;</Highlight></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BestAScore &lt; BestBScore)</Highlight></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><Highlight kind="normal">      BestA = SecondBestA;</Highlight></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><Highlight kind="normal">      BestB = SecondBestB;</Highlight></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Arrange for the BB edge to be in BestA if it exists.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BestB-&gt;Src == BB)</Highlight></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><Highlight kind="normal">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(BestA, BestB);</Highlight></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::make&#95;pair(&#42;BestA, &#42;BestB);</Highlight></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><Highlight kind="comment">/// Get the best successor from \\p BB based on \\p BB being part of a trellis.</Highlight></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><Highlight kind="comment">/// We only handle trellises with 2 successors, so the algorithm is</Highlight></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><Highlight kind="comment">/// straightforward: Find the best pair of edges that don&#39;t conflict. We find</Highlight></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><Highlight kind="comment">/// the best incoming edge for each successor in the trellis. If those conflict,</Highlight></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><Highlight kind="comment">/// we consider which of them should be replaced with the second best.</Highlight></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><Highlight kind="comment">/// Upon return the two best edges will be in \\p BestEdges. If one of the edges</Highlight></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><Highlight kind="comment">/// comes from \\p BB, it will be in \\p BestEdges&#91;0&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><Highlight kind="normal">MachineBlockPlacement::BlockAndTailDupResult</Highlight></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><Highlight kind="normal">MachineBlockPlacement::getBestTrellisSuccessor(</Highlight></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineBasicBlock &#42;&gt;</a> &amp;ViableSuccs,</Highlight></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> AdjustedSumProb, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter) &#123;</Highlight></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><Highlight kind="normal">  BlockAndTailDupResult <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = &#123;</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const MachineBasicBlock &#42;, 4&gt;</a> Successors(BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a6321b189ea8fd5058663f8a87d6c23e9">succ&#95;begin</a>(),</Highlight></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><Highlight kind="normal">                                                       BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3ddd708642d60c1661992ff8ba1b215d">succ&#95;end</a>());</Highlight></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We assume size 2 because it&#39;s common. For general n, we would have to do</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the Hungarian algorithm, but it&#39;s not worth the complexity because more</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// than 2 successors is fairly uncommon, and a trellis even more so.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Successors.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() != 2 || ViableSuccs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() != 2)</Highlight></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</Highlight></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect the edge frequencies of all edges that form the trellis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;WeightedEdge, 8&gt;</a> Edges&#91;2&#93;;</Highlight></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> SuccIndex = 0;</Highlight></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Succ : ViableSuccs) &#123;</Highlight></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;SuccPred : Succ-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</Highlight></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Skip any placed predecessors that are not BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccPred != BB)</Highlight></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((BlockFilter &amp;&amp; !BlockFilter-&gt;count(SuccPred)) ||</Highlight></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><Highlight kind="normal">            BlockToChain&#91;SuccPred&#93; == &amp;Chain ||</Highlight></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><Highlight kind="normal">            BlockToChain&#91;SuccPred&#93; == BlockToChain&#91;Succ&#93;)</Highlight></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> EdgeFreq = MBFI-&gt;getBlockFreq(SuccPred) &#42;</Highlight></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><Highlight kind="normal">                                MBPI-&gt;getEdgeProbability(SuccPred, Succ);</Highlight></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><Highlight kind="normal">      Edges&#91;SuccIndex&#93;.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;EdgeFreq, SuccPred, Succ&#125;);</Highlight></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><Highlight kind="normal">    ++SuccIndex;</Highlight></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Pick the best combination of 2 edges from all the edges in the trellis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><Highlight kind="normal">  WeightedEdge BestA, BestB;</Highlight></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><Highlight kind="normal">  std::tie(BestA, BestB) = getBestNonConflictingEdges(BB, Edges);</Highlight></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BestA.Src != BB) &#123;</Highlight></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we have a trellis, and BB doesn&#39;t have the best fallthrough edges,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we shouldn&#39;t choose any successor. We&#39;ve already looked and there&#39;s a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// better fallthrough edge for all the successors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Trellis, but not one of the chosen edges.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</Highlight></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Did we pick the triangle edge? If tail-duplication is profitable, do</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that instead. Otherwise merge the triangle edge now while we know it is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// optimal.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BestA.Dest == BestB.Src) &#123;</Highlight></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The edges are BB-&gt;Succ1-&gt;Succ2, and we&#39;re looking to see if BB-&gt;Succ2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// would be better.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ1 = BestA.Dest;</Highlight></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ2 = BestB.Dest;</Highlight></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check to see if tail-duplication would be profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#ad65badde897b7d4f51fc7c545538a388">allowTailDupPlacement</a>() &amp;&amp; shouldTailDuplicate(Succ2) &amp;&amp;</Highlight></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><Highlight kind="normal">        canTailDuplicateUnplacedPreds(BB, Succ2, Chain, BlockFilter) &amp;&amp;</Highlight></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><Highlight kind="normal">        isProfitableToTailDup(BB, Succ2, MBPI-&gt;getEdgeProbability(BB, Succ1),</Highlight></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><Highlight kind="normal">                              Chain, BlockFilter)) &#123;</Highlight></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> Succ2Prob = <a href="#a0a894de03271c0ccc991e40f4cdd2623">getAdjustedProbability</a>(</Highlight></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><Highlight kind="normal">                     MBPI-&gt;getEdgeProbability(BB, Succ2), AdjustedSumProb);</Highlight></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><Highlight kind="normal">                 <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    Selected: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(Succ2)</Highlight></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;, probability: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; Succ2Prob</Highlight></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; (Tail Duplicate)\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.BB = Succ2;</Highlight></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.ShouldTailDup = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</Highlight></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We have already computed the optimal edge for the other side of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// trellis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><Highlight kind="normal">  ComputedEdges&#91;BestB.Src&#93; = &#123;BestB.Dest, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> TrellisSucc = BestA.Dest;</Highlight></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> SuccProb = <a href="#a0a894de03271c0ccc991e40f4cdd2623">getAdjustedProbability</a>(</Highlight></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><Highlight kind="normal">                 MBPI-&gt;getEdgeProbability(BB, TrellisSucc), AdjustedSumProb);</Highlight></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    Selected: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(TrellisSucc)</Highlight></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;, probability: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; SuccProb &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; (Trellis)\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.BB = TrellisSucc;</Highlight></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</Highlight></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><Highlight kind="comment">/// When the option allowTailDupPlacement() is on, this method checks if the</Highlight></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><Highlight kind="comment">/// fallthrough candidate block \\p Succ (of block \\p BB) can be tail-duplicated</Highlight></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><Highlight kind="comment">/// into all of its unplaced, unfiltered predecessors, that are not BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MachineBlockPlacement::canTailDuplicateUnplacedPreds(</Highlight></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ,</Highlight></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;Chain, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter) &#123;</Highlight></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!shouldTailDuplicate(Succ))</Highlight></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The result of canTailDuplicate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Duplicate = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Number of possible duplication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> NumDup = 0;</Highlight></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For CFG checking.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const MachineBasicBlock &#42;, 4&gt;</a> Successors(BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a6321b189ea8fd5058663f8a87d6c23e9">succ&#95;begin</a>(),</Highlight></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><Highlight kind="normal">                                                       BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3ddd708642d60c1661992ff8ba1b215d">succ&#95;end</a>());</Highlight></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred : Succ-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</Highlight></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Make sure all unplaced and unfiltered predecessors can be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// tail-duplicated into.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Skip any blocks that are already placed or not in this loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred == BB || (BlockFilter &amp;&amp; !BlockFilter-&gt;count(Pred)) ||</Highlight></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><Highlight kind="normal">        (BlockToChain&#91;Pred&#93; == &amp;Chain &amp;&amp; !Succ-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#aa8d1d8d88835b75b05b14ab774785e8a">succ&#95;empty</a>()))</Highlight></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TailDup.canTailDuplicate(Succ, Pred)) &#123;</Highlight></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Successors.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &gt; 1 &amp;&amp; <a href="#ab20068697df3d13ab12e09852d99b7f7">hasSameSuccessors</a>(&#42;Pred, Successors))</Highlight></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// This will result in a trellis after tail duplication, so we don&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// need to copy Succ into this predecessor. In the presence</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// of a trellis tail duplication can continue to be profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// For example:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// A            A</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// |\\           |\\</Highlight></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><Highlight kind="comment">        // | \\          | \\</Highlight></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><Highlight kind="comment">        // |  C         |  C+BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// | /          |  |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// |/           |  |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// BB    =&gt;     BB |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// |\\           |\\/|</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// | \\          |/\\|</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// |  D         |  D</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// | /          | /</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// |/           |/</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Succ         Succ</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// After BB was duplicated into C, the layout looks like the one on the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// right. BB and C now have the same successors. When considering</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// whether Succ can be duplicated into all its unplaced predecessors, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// ignore C.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We can do this because C already has a profitable fallthrough, namely</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// D. TODO(iteratee): ignore sufficiently cold predecessors for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// duplication and for this test.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// This allows trellises to be laid out in 2 separate chains</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// (A,B,Succ,...) and later (C,D,...) This is a reasonable heuristic</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// because it allows the creation of 2 fallthrough paths with links</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// between them, and we correctly identify the best layout for these</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// CFGs. We want to extend trellises that the user created in addition</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// to trellises created by tail-duplication, so we just look for the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// CFG.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><Highlight kind="normal">      Duplicate = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><Highlight kind="normal">    NumDup++;</Highlight></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// No possible duplication in current filter set.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumDup == 0)</Highlight></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If profile information is available, findDuplicateCandidates can do more</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// precise benefit analysis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunction().hasProfileData())</Highlight></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is mainly for function exit BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The integrated tail duplication is really designed for increasing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// fallthrough from predecessors from Succ to its successors. We may need</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// other machanism to handle different cases.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Succ-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#aa8d1d8d88835b75b05b14ab774785e8a">succ&#95;empty</a>())</Highlight></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Plus the already placed predecessor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><Highlight kind="normal">  NumDup++;</Highlight></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the duplication candidate has more unplaced predecessors than</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// successors, the extra duplication can&#39;t bring more fallthrough.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     Pred1 Pred2 Pred3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//         \\   |   /</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//          \\  |  /</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//           \\ | /</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//            Dup</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//            / \\</Highlight></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><Highlight kind="comment">  //           /   \\</Highlight></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><Highlight kind="comment">  //       Succ1  Succ2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// In this example Dup has 2 successors and 3 predecessors, duplication of Dup</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// can increase the fallthrough from Pred1 to Succ1 and from Pred2 to Succ2,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// but the duplication into Pred3 can&#39;t increase fallthrough.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A small number of extra duplication may not hurt too much. We need a better</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// heuristic to handle it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((NumDup &gt; Succ-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a81626de817a0cb021ff8e915cf1942ed">succ&#95;size</a>()) || !Duplicate)</Highlight></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><Highlight kind="comment">/// Find chains of triangles where we believe it would be profitable to</Highlight></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><Highlight kind="comment">/// tail-duplicate them all, but a local analysis would not find them.</Highlight></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><Highlight kind="comment">/// There are 3 ways this can be profitable:</Highlight></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><Highlight kind="comment">/// 1) The post-dominators marked 50% are actually taken 55% (This shrinks with</Highlight></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><Highlight kind="comment">///    longer chains)</Highlight></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><Highlight kind="comment">/// 2) The chains are statically correlated. Branch probabilities have a very</Highlight></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><Highlight kind="comment">///    U-shaped distribution.</Highlight></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><Highlight kind="comment">///    &#91;http://nrs.harvard.edu/urn-3:HUL.InstRepos:24015805&#93;</Highlight></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><Highlight kind="comment">///    If the branches in a chain are likely to be from the same side of the</Highlight></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><Highlight kind="comment">///    distribution as their predecessor, but are independent at runtime, this</Highlight></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><Highlight kind="comment">///    transformation is profitable. (Because the cost of being wrong is a small</Highlight></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><Highlight kind="comment">///    fixed cost, unlike the standard triangle layout where the cost of being</Highlight></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><Highlight kind="comment">///    wrong scales with the # of triangles.)</Highlight></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><Highlight kind="comment">/// 3) The chains are dynamically correlated. If the probability that a previous</Highlight></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><Highlight kind="comment">///    branch was taken positively influences whether the next branch will be</Highlight></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><Highlight kind="comment">///    taken</Highlight></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><Highlight kind="comment">/// We believe that 2 and 3 are common enough to justify the small margin in 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::precomputeTriangleChains() &#123;</Highlight></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal">TriangleChain &#123;</Highlight></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><Highlight kind="normal">    std::vector&lt;MachineBasicBlock &#42;&gt; Edges;</Highlight></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><Highlight kind="normal">    TriangleChain(MachineBasicBlock &#42;src, MachineBasicBlock &#42;dst)</Highlight></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><Highlight kind="normal">        : Edges(&#123;src, dst&#125;) &#123;&#125;</Highlight></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/sys/path/#acb80894344c78dacf8d5ff8c23be697d">append</a>(MachineBasicBlock &#42;dst) &#123;</Highlight></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(getKey()-&gt;isSuccessor(dst) &amp;&amp;</Highlight></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Attempting to append a block that is not a successor.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><Highlight kind="normal">      Edges.push&#95;back(dst);</Highlight></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab1772fd431decccb7926d484ea223db7">count</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Edges.size() - 1; &#125;</Highlight></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><Highlight kind="normal">    MachineBasicBlock &#42;getKey()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Edges.back(); &#125;</Highlight></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a8ac66559c601e390e9477131019ee0ca">TriangleChainCount</a> == 0)</Highlight></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Pre-computing triangle chains.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Map from last block to the chain that contains it. This allows us to extend</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// chains as we find new triangles.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MachineBasicBlock &#42;, TriangleChain&gt;</a> TriangleChainMap;</Highlight></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;BB : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If BB doesn&#39;t have 2 successors, it doesn&#39;t start a triangle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB.<a href="/docs/api/classes/llvm/machinebasicblock/#a81626de817a0cb021ff8e915cf1942ed">succ&#95;size</a>() != 2)</Highlight></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;PDom = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : BB.<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>()) &#123;</Highlight></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MPDT-&gt;dominates(Succ, &amp;BB))</Highlight></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><Highlight kind="normal">      PDom = Succ;</Highlight></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If BB doesn&#39;t have a post-dominating successor, it doesn&#39;t form a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// triangle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PDom == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If PDom has a hint that it is low probability, skip this triangle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MBPI-&gt;getEdgeProbability(&amp;BB, PDom) &lt; <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a>(50, 100))</Highlight></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If PDom isn&#39;t eligible for duplication, this isn&#39;t the kind of triangle</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we&#39;re looking for.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!shouldTailDuplicate(PDom))</Highlight></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CanTailDuplicate = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If PDom can&#39;t tail-duplicate into it&#39;s non-BB predecessors, then this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// isn&#39;t the kind of triangle we&#39;re looking for.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred : PDom-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</Highlight></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred == &amp;BB)</Highlight></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TailDup.canTailDuplicate(PDom, Pred)) &#123;</Highlight></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><Highlight kind="normal">        CanTailDuplicate = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we can&#39;t tail-duplicate PDom to its predecessors, then skip this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// triangle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CanTailDuplicate)</Highlight></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Now we have an interesting triangle. Insert it if it&#39;s not part of an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// existing chain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Note: This cannot be replaced with a call insert() or emplace() because</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the find key is BB, but the insert/emplace key is PDom.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Found = TriangleChainMap.<a href="/docs/api/classes/llvm/densemapbase/#a0c047f127ed4380a6f383d70bec4eb94">find</a>(&amp;BB);</Highlight></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If it is, remove the chain from the map, grow it, and put it back in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// map with the end as the new key.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Found != TriangleChainMap.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>()) &#123;</Highlight></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><Highlight kind="normal">      TriangleChain <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a> = std::move(Found-&gt;second);</Highlight></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><Highlight kind="normal">      TriangleChainMap.<a href="/docs/api/classes/llvm/densemapbase/#a1eb8504bab5f794778d82db6ac829923">erase</a>(Found);</Highlight></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><Highlight kind="normal">      <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(PDom);</Highlight></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><Highlight kind="normal">      TriangleChainMap.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(std::make&#95;pair(<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.getKey(), std::move(Chain)));</Highlight></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> InsertResult = TriangleChainMap.<a href="/docs/api/classes/llvm/densemapbase/#a1a245b31aced1374f28f45d2b297f402">try&#95;emplace</a>(PDom, &amp;BB, PDom);</Highlight></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertResult.second &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Block seen twice.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><Highlight kind="normal">      (void)InsertResult;</Highlight></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iterating over a DenseMap is safe here, because the only thing in the body</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the loop is inserting into another DenseMap (ComputedEdges).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ComputedEdges is never iterated, so this doesn&#39;t lead to non-determinism.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;ChainPair : TriangleChainMap) &#123;</Highlight></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><Highlight kind="normal">    TriangleChain &amp;<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a> = ChainPair.second;</Highlight></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Benchmarking has shown that due to branch correlation duplicating 2 or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// more triangles is profitable, despite the calculations assuming</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// independence.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.count() &lt; <a href="#a8ac66559c601e390e9477131019ee0ca">TriangleChainCount</a>)</Highlight></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;dst = <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.Edges.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>();</Highlight></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><Highlight kind="normal">    <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.Edges.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#ad97688dfe9cd802e2a0691cbe620218a">pop&#95;back</a>();</Highlight></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;src : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.Edges)) &#123;</Highlight></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Marking edge: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(src) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;-&gt;&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><Highlight kind="normal">                        &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(dst)</Highlight></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; as pre-computed based on triangles.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> InsertResult = ComputedEdges.insert(&#123;src, &#123;dst, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">&#125;&#125;);</Highlight></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InsertResult.second &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Block seen twice.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><Highlight kind="normal">      (void)InsertResult;</Highlight></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><Highlight kind="normal">      dst = src;</Highlight></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><Highlight kind="normal"></Highlight><Highlight kind="comment">// When profile is not present, return the StaticLikelyProb.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><Highlight kind="normal"></Highlight><Highlight kind="comment">// When profile is available, we need to handle the triangle-shape CFG.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a></Highlight></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397" lineLink="#a3d135a8abf70dc93455708cc087cc0b0"><Highlight kind="normal"><a href="#a3d135a8abf70dc93455708cc087cc0b0">getLayoutSuccessorProbThreshold</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#acf6442108e21e7e5379feb8962de65b7">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/classes/llvm/function/#a9084ce2576fad285c1c0dc1e165dd4b6">hasProfileData</a>())</Highlight></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a>(<a href="/docs/api/namespaces/llvm/#a75dea20875e2199efbf65662db1234d8">StaticLikelyProb</a>, 100);</Highlight></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a81626de817a0cb021ff8e915cf1942ed">succ&#95;size</a>() == 2) &#123;</Highlight></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ1 = &#42;BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a6321b189ea8fd5058663f8a87d6c23e9">succ&#95;begin</a>();</Highlight></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ2 = &#42;(BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a6321b189ea8fd5058663f8a87d6c23e9">succ&#95;begin</a>() + 1);</Highlight></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Succ1-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(Succ2) || Succ2-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(Succ1)) &#123;</Highlight></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><Highlight kind="normal">      </Highlight><Highlight kind="comment">/&#42; See case 1 below for the cost analysis. For BB-&gt;Succ to</Highlight></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><Highlight kind="comment">       &#42; be taken with smaller cost, the following needs to hold:</Highlight></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><Highlight kind="comment">       &#42;   Prob(BB-&gt;Succ) &gt; 2 &#42; Prob(BB-&gt;Pred)</Highlight></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><Highlight kind="comment">       &#42;   So the threshold T in the calculation below</Highlight></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><Highlight kind="comment">       &#42;   (1-T) &#42; Prob(BB-&gt;Succ) &gt; T &#42; Prob(BB-&gt;Pred)</Highlight></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><Highlight kind="comment">       &#42;   So T / (1 - T) = 2, Yielding T = 2/3</Highlight></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><Highlight kind="comment">       &#42; Also adding user specified branch bias, we have</Highlight></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><Highlight kind="comment">       &#42;   T = (2/3)&#42;(ProfileLikelyProb/50)</Highlight></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><Highlight kind="comment">       &#42;     = (2&#42;ProfileLikelyProb)/150)</Highlight></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><Highlight kind="comment">       &#42;/</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a>(2 &#42; <a href="/docs/api/namespaces/llvm/#a4de1c8a569d0350e16d8c5e0746d5bbf">ProfileLikelyProb</a>, 150);</Highlight></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a>(<a href="/docs/api/namespaces/llvm/#a4de1c8a569d0350e16d8c5e0746d5bbf">ProfileLikelyProb</a>, 100);</Highlight></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><Highlight kind="comment">/// Checks to see if the layout candidate block \\p Succ has a better layout</Highlight></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><Highlight kind="comment">/// predecessor than \\c BB. If yes, returns true.</Highlight></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><Highlight kind="comment">/// \\p SuccProb: The probability adjusted for only remaining blocks.</Highlight></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><Highlight kind="comment">///   Only used for logging</Highlight></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><Highlight kind="comment">/// \\p RealSuccProb: The un-adjusted probability.</Highlight></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><Highlight kind="comment">/// \\p Chain: The chain that BB belongs to and Succ is being considered for.</Highlight></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><Highlight kind="comment">/// \\p BlockFilter: if non-null, the set of blocks that make up the loop being</Highlight></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><Highlight kind="comment">///    considered</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MachineBlockPlacement::hasBetterLayoutPredecessor(</Highlight></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ,</Highlight></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;SuccChain, <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> SuccProb,</Highlight></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> RealSuccProb, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter) &#123;</Highlight></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// There isn&#39;t a better layout when there are no unscheduled predecessors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccChain.UnscheduledPredecessors == 0)</Highlight></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// There are two basic scenarios here:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// -------------------------------------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Case 1: triangular shape CFG (if-then):</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     | \\</Highlight></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><Highlight kind="comment">  //     |  \\</Highlight></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><Highlight kind="comment">  //     |   Pred</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     |   /</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     Succ</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// In this case, we are evaluating whether to select edge -&gt; Succ, e.g.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// set Succ as the layout successor of BB. Picking Succ as BB&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// successor breaks the CFG constraints (FIXME: define these constraints).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// With this layout, Pred BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is forced to be outlined, so the overall cost will be cost of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// branch taken from BB to Pred, plus the cost of back taken branch</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// from Pred to Succ, as well as the additional cost associated</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// with the needed unconditional jump instruction from Pred To Succ.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The cost of the topological order layout is the taken branch cost</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// from BB to Succ, so to make BB-&gt;Succ a viable candidate, the following</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// must hold:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     2 &#42; freq(BB-&gt;Pred) &#42; taken&#95;branch&#95;cost + unconditional&#95;jump&#95;cost</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//      &lt; freq(BB-&gt;Succ) &#42;  taken&#95;branch&#95;cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Ignoring unconditional jump cost, we get</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    freq(BB-&gt;Succ) &gt; 2 &#42; freq(BB-&gt;Pred), i.e.,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    prob(BB-&gt;Succ) &gt; 2 &#42; prob(BB-&gt;Pred)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// When real profile data is available, we can precisely compute the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// probability threshold that is needed for edge BB-&gt;Succ to be considered.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Without profile data, the heuristic requires the branch bias to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a lot larger to make sure the signal is very strong (e.g. 80% default).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// -----------------------------------------------------------------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Case 2: diamond like CFG (if-then-else):</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     S</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    / \\</Highlight></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><Highlight kind="comment">  //   |   \\</Highlight></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><Highlight kind="comment">  //  BB    Pred</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   \\    /</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    Succ</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    ..</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The current block is BB and edge BB-&gt;Succ is now being evaluated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note that edge S-&gt;BB was previously already selected because</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// prob(S-&gt;BB) &gt; prob(S-&gt;Pred).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// At this point, 2 blocks can be placed after BB: Pred or Succ. If we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// choose Pred, we will have a topological ordering as shown on the left</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in the picture below. If we choose Succ, we have the solution as shown</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// on the right:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   topo-order:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       S-----                             ---S</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       |    |                             |  |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    ---BB   |                             |  BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    |       |                             |  |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    |  Pred--                             |  Succ--</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    |  |                                  |       |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    ---Succ                               ---Pred--</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cost = freq(S-&gt;Pred) + freq(BB-&gt;Succ)    cost = 2 &#42; freq (S-&gt;Pred)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//      = freq(S-&gt;Pred) + freq(S-&gt;BB)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we have profile data (i.e, branch probabilities can be trusted), the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cost (number of taken branches) with layout S-&gt;BB-&gt;Succ-&gt;Pred is 2 &#42;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// freq(S-&gt;Pred) while the cost of topo order is freq(S-&gt;Pred) + freq(S-&gt;BB).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We know Prob(S-&gt;BB) &gt; Prob(S-&gt;Pred), so freq(S-&gt;BB) &gt; freq(S-&gt;Pred), which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// means the cost of topological order is greater.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// When profile data is not available, however, we need to be more</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// conservative. If the branch prediction is wrong, breaking the topo-order</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// will actually yield a layout with large cost. For this reason, we need</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// strong biased branch at block S with Prob(S-&gt;BB) in order to select</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// BB-&gt;Succ. This is equivalent to looking the CFG backward with backward</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// edge: Prob(Succ-&gt;BB) needs to &gt;= HotProb in order to be selected (without</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// profile data).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// --------------------------------------------------------------------------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Case 3: forked diamond</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       S</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//      / \\</Highlight></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><Highlight kind="comment">  //     /   \\</Highlight></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><Highlight kind="comment">  //   BB    Pred</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   | \\   / |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   |  \\ /  |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   |   X   |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   |  / \\  |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   | /   \\ |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   S1     S2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The current block is BB and edge BB-&gt;S1 is now being evaluated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// As above S-&gt;BB was already selected because</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// prob(S-&gt;BB) &gt; prob(S-&gt;Pred). Assume that prob(BB-&gt;S1) &gt;= prob(BB-&gt;S2).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// topo-order:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     S-------|                     ---S</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     |       |                     |  |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  ---BB      |                     |  BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  |          |                     |  |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  |  Pred----|                     |  S1----</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  |  |                             |       |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  --(S1 or S2)                     ---Pred--</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//                                        |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//                                       S2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// topo-cost = freq(S-&gt;Pred) + freq(BB-&gt;S1) + freq(BB-&gt;S2)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    + min(freq(Pred-&gt;S1), freq(Pred-&gt;S2))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Non-topo-order cost:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// non-topo-cost = 2 &#42; freq(S-&gt;Pred) + freq(BB-&gt;S2).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// To be conservative, we can assume that min(freq(Pred-&gt;S1), freq(Pred-&gt;S2))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is 0 Then the non topo layout is better when</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// freq(S-&gt;Pred) &lt; freq(BB-&gt;S1).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is exactly what is checked below.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note there are other shapes that apply (Pred may not be a single block,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// but they all fit this general pattern.)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> HotProb = <a href="#a3d135a8abf70dc93455708cc087cc0b0">getLayoutSuccessorProbThreshold</a>(BB);</Highlight></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Make sure that a hot successor doesn&#39;t have a globally more</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// important predecessor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> CandidateEdgeFreq = MBFI-&gt;getBlockFreq(BB) &#42; RealSuccProb;</Highlight></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> BadCFGConflict = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred : Succ-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</Highlight></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;PredChain = BlockToChain&#91;Pred&#93;;</Highlight></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred == Succ || PredChain == &amp;SuccChain ||</Highlight></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><Highlight kind="normal">        (BlockFilter &amp;&amp; !BlockFilter-&gt;count(Pred)) || PredChain == &amp;Chain ||</Highlight></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><Highlight kind="normal">        Pred != &#42;std::prev(PredChain-&gt;end()) ||</Highlight></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// This check is redundant except for look ahead. This function is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// called for lookahead by isProfitableToTailDup when BB hasn&#39;t been</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// placed yet.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><Highlight kind="normal">        (Pred == BB))</Highlight></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Do backward checking.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For all cases above, we need a backward checking to filter out edges that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// are not &#39;strongly&#39; biased.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// BB  Pred</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  \\ /</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  Succ</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We select edge BB-&gt;Succ if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//      freq(BB-&gt;Succ) &gt; freq(Succ) &#42; HotProb</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//      i.e. freq(BB-&gt;Succ) &gt; freq(BB-&gt;Succ) &#42; HotProb + freq(Pred-&gt;Succ) &#42;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//      HotProb</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//      i.e. freq((BB-&gt;Succ) &#42; (1 - HotProb) &gt; freq(Pred-&gt;Succ) &#42; HotProb</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Case 1 is covered too, because the first equation reduces to:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// prob(BB-&gt;Succ) &gt; HotProb. (freq(Succ) = freq(BB) for a triangle)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> PredEdgeFreq =</Highlight></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><Highlight kind="normal">        MBFI-&gt;getBlockFreq(Pred) &#42; MBPI-&gt;getEdgeProbability(Pred, Succ);</Highlight></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PredEdgeFreq &#42; HotProb &gt;= CandidateEdgeFreq &#42; HotProb.<a href="/docs/api/classes/llvm/branchprobability/#aaee6034264d5d0782e5d1489360730d9">getCompl</a>()) &#123;</Highlight></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><Highlight kind="normal">      BadCFGConflict = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BadCFGConflict) &#123;</Highlight></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    Not a candidate: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(Succ) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; -&gt; &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><Highlight kind="normal">                      &lt;&lt; SuccProb &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; (prob) (non-cold CFG conflict)\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><Highlight kind="comment">/// Select the best successor for a block.</Highlight></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><Highlight kind="comment">/// This looks across all successors of a particular block and attempts to</Highlight></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><Highlight kind="comment">/// select the &quot;best&quot; one to be the layout successor. It only considers direct</Highlight></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><Highlight kind="comment">/// successors which also pass the block filter. It will attempt to avoid</Highlight></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><Highlight kind="comment">/// breaking CFG structure, but cave and break such structures in the case of</Highlight></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><Highlight kind="comment">/// very hot successor edges.</Highlight></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><Highlight kind="comment">/// \\returns The best successor block found, or null if none are viable, along</Highlight></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><Highlight kind="comment">/// with a boolean indicating if tail duplication is necessary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><Highlight kind="normal">MachineBlockPlacement::BlockAndTailDupResult</Highlight></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><Highlight kind="normal">MachineBlockPlacement::selectBestSuccessor(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><Highlight kind="normal">                                           </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><Highlight kind="normal">                                           </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter) &#123;</Highlight></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> HotProb(<a href="/docs/api/namespaces/llvm/#a75dea20875e2199efbf65662db1234d8">StaticLikelyProb</a>, 100);</Highlight></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><Highlight kind="normal">  BlockAndTailDupResult BestSucc = &#123;</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> BestProb = <a href="/docs/api/classes/llvm/branchprobability/#afd00958cba7080048a84cccfcef55d71">BranchProbability::getZero</a>();</Highlight></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 4&gt;</a> Successors;</Highlight></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> AdjustedSumProb =</Highlight></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><Highlight kind="normal">      collectViableSuccessors(BB, Chain, BlockFilter, Successors);</Highlight></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Selecting best successor for: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(BB)</Highlight></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// if we already precomputed the best successor for BB, return that if still</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// applicable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> FoundEdge = ComputedEdges.find(BB);</Highlight></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FoundEdge != ComputedEdges.end()) &#123;</Highlight></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ = FoundEdge-&gt;second.BB;</Highlight></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><Highlight kind="normal">    ComputedEdges.<a href="/docs/api/classes/llvm/basicblock/#a018d5142c1a4469d9296a26a59fe2783">erase</a>(FoundEdge);</Highlight></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;SuccChain = BlockToChain&#91;Succ&#93;;</Highlight></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(Succ) &amp;&amp; (!BlockFilter || BlockFilter-&gt;count(Succ)) &amp;&amp;</Highlight></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><Highlight kind="normal">        SuccChain != &amp;Chain &amp;&amp; Succ == &#42;SuccChain-&gt;begin())</Highlight></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> FoundEdge-&gt;second;</Highlight></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// if BB is part of a trellis, Use the trellis to determine the optimal</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// fallthrough edges</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (isTrellis(BB, Successors, Chain, BlockFilter))</Highlight></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> getBestTrellisSuccessor(BB, Successors, AdjustedSumProb, Chain,</Highlight></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><Highlight kind="normal">                                   BlockFilter);</Highlight></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For blocks with CFG violations, we may be able to lay them out anyway with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// tail-duplication. We keep this vector so we can perform the probability</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// calculations the minimum number of times.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;BranchProbability, MachineBasicBlock &#42;&gt;</a>, 4&gt;</Highlight></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><Highlight kind="normal">      DupCandidates;</Highlight></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : Successors) &#123;</Highlight></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> RealSuccProb = MBPI-&gt;getEdgeProbability(BB, Succ);</Highlight></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> SuccProb =</Highlight></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><Highlight kind="normal">        <a href="#a0a894de03271c0ccc991e40f4cdd2623">getAdjustedProbability</a>(RealSuccProb, AdjustedSumProb);</Highlight></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;SuccChain = &#42;BlockToChain&#91;Succ&#93;;</Highlight></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Skip the edge \\c BB-&gt;Succ if block \\c Succ has a better layout</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// predecessor that yields lower global cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (hasBetterLayoutPredecessor(BB, Succ, SuccChain, SuccProb, RealSuccProb,</Highlight></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><Highlight kind="normal">                                   Chain, BlockFilter)) &#123;</Highlight></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If tail duplication would make Succ profitable, place it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#ad65badde897b7d4f51fc7c545538a388">allowTailDupPlacement</a>() &amp;&amp; shouldTailDuplicate(Succ))</Highlight></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><Highlight kind="normal">        DupCandidates.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(SuccProb, Succ);</Highlight></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    Candidate: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(Succ)</Highlight></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;, probability: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; SuccProb</Highlight></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><Highlight kind="normal">               &lt;&lt; (SuccChain.UnscheduledPredecessors != 0 ? </Highlight><Highlight kind="stringliteral">&quot; (CFG break)&quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BestSucc.BB &amp;&amp; BestProb &gt;= SuccProb) &#123;</Highlight></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    Not the best candidate, continuing\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    Setting it as best candidate\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><Highlight kind="normal">    BestSucc.BB = Succ;</Highlight></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><Highlight kind="normal">    BestProb = SuccProb;</Highlight></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Handle the tail duplication candidates in order of decreasing probability.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Stop at the first one that is profitable. Also stop if they are less</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// profitable than BestSucc. Position is important because we preserve it and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// prefer first best match. Here we aren&#39;t comparing in order, so we capture</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the position instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable&#95;sort</a>(DupCandidates,</Highlight></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><Highlight kind="normal">                    &#91;&#93;(std::tuple&lt;BranchProbability, MachineBasicBlock &#42;&gt; L,</Highlight></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><Highlight kind="normal">                       std::tuple&lt;BranchProbability, MachineBasicBlock &#42;&gt; R) &#123;</Highlight></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><Highlight kind="normal">                      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::get&lt;0&gt;(L) &gt; std::get&lt;0&gt;(R);</Highlight></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><Highlight kind="normal">                    &#125;);</Highlight></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Tup : DupCandidates) &#123;</Highlight></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> DupProb;</Highlight></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ;</Highlight></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><Highlight kind="normal">    std::tie(DupProb, Succ) = Tup;</Highlight></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DupProb &lt; BestProb)</Highlight></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (canTailDuplicateUnplacedPreds(BB, Succ, Chain, BlockFilter) &amp;&amp;</Highlight></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><Highlight kind="normal">        (isProfitableToTailDup(BB, Succ, BestProb, Chain, BlockFilter))) &#123;</Highlight></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    Candidate: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(Succ)</Highlight></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;, probability: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; DupProb</Highlight></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; (Tail Duplicate)\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><Highlight kind="normal">      BestSucc.BB = Succ;</Highlight></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><Highlight kind="normal">      BestSucc.ShouldTailDup = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BestSucc.BB)</Highlight></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    Selected: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(BestSucc.BB) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BestSucc;</Highlight></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><Highlight kind="comment">/// Select the best block from a worklist.</Highlight></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><Highlight kind="comment">/// This looks through the provided worklist as a list of candidate basic</Highlight></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><Highlight kind="comment">/// blocks and select the most profitable one to place. The definition of</Highlight></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><Highlight kind="comment">/// profitable only really makes sense in the context of a loop. This returns</Highlight></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><Highlight kind="comment">/// the most frequently visited block in the worklist, which in the case of</Highlight></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><Highlight kind="comment">/// a loop, is the one most desirable to be physically close to the rest of the</Highlight></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><Highlight kind="comment">/// loop body in order to improve i-cache behavior.</Highlight></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><Highlight kind="comment">/// \\returns The best block found, or null if none are viable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><Highlight kind="normal"><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;MachineBlockPlacement::selectBestCandidateBlock(</Highlight></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;Chain, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineBasicBlock &#42;&gt;</a> &amp;WorkList) &#123;</Highlight></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Once we need to walk the worklist looking for a candidate, cleanup the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// worklist of already placed entries.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: If this shows up on profiles, it could be folded (at the cost of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// some code complexity) into the loop below.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ac9a7de5a04920954ac964059cfc428ad">llvm::erase&#95;if</a>(WorkList, &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BlockToChain.lookup(BB) == &amp;<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>;</Highlight></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</Highlight></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsEHPad = WorkList&#91;0&#93;-&gt;isEHPad();</Highlight></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BestBlock = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> BestFreq;</Highlight></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : WorkList) &#123;</Highlight></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;isEHPad() == IsEHPad &amp;&amp;</Highlight></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;EHPad mismatch between block and work list.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;SuccChain = &#42;BlockToChain&#91;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93;;</Highlight></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&amp;SuccChain == &amp;Chain)</Highlight></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SuccChain.UnscheduledPredecessors == 0 &amp;&amp;</Highlight></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Found CFG-violating block&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> CandidateFreq = MBFI-&gt;getBlockFreq(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</Highlight></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; -&gt; &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><Highlight kind="normal">                      &lt;&lt; <a href="/docs/api/namespaces/llvm/#ada715bce8140114cd2fd2f8ab018f7c3">printBlockFreq</a>(MBFI-&gt;getMBFI(), CandidateFreq)</Highlight></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; (freq)\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For ehpad, we layout the least probable first as to avoid jumping back</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// from least probable landingpads to more probable ones.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: Using probability is probably (!) not the best way to achieve</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// this. We should probably have a more principled approach to layout</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// cleanup code.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The goal is to get:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//                 +--------------------------+</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//                 |                          V</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// InnerLp -&gt; InnerCleanup    OuterLp -&gt; OuterCleanup -&gt; Resume</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Rather than:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//                 +-------------------------------------+</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//                 V                                     |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// OuterLp -&gt; OuterCleanup -&gt; Resume     InnerLp -&gt; InnerCleanup</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BestBlock &amp;&amp; (IsEHPad ^ (BestFreq &gt;= CandidateFreq)))</Highlight></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><Highlight kind="normal">    BestBlock = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>;</Highlight></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><Highlight kind="normal">    BestFreq = CandidateFreq;</Highlight></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BestBlock;</Highlight></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><Highlight kind="comment">/// Retrieve the first unplaced basic block in the entire function.</Highlight></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><Highlight kind="comment">/// This routine is called when we are unable to use the CFG to walk through</Highlight></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><Highlight kind="comment">/// all of the basic blocks and form a chain due to unnatural loops in the CFG.</Highlight></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><Highlight kind="comment">/// We walk through the function&#39;s blocks in order, starting from the</Highlight></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><Highlight kind="comment">/// LastUnplacedBlockIt. We update this iterator on each call to avoid</Highlight></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><Highlight kind="comment">/// re-scanning the entire sequence on repeated calls to this routine.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><Highlight kind="normal"><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;MachineBlockPlacement::getFirstUnplacedBlock(</Highlight></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;PlacedChain,</Highlight></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> &amp;PrevUnplacedBlockIt) &#123;</Highlight></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = PrevUnplacedBlockIt, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;end(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>;</Highlight></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><Highlight kind="normal">       ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BlockToChain&#91;&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; != &amp;PlacedChain) &#123;</Highlight></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><Highlight kind="normal">      PrevUnplacedBlockIt = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Now select the head of the chain to which the unplaced block belongs</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// as the block to place. This will force the entire chain to be placed,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// and satisfies the requirements of merging chains.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;BlockToChain&#91;&amp;&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;-&gt;begin();</Highlight></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><Highlight kind="comment">/// Retrieve the first unplaced basic block among the blocks in BlockFilter.</Highlight></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><Highlight kind="comment">/// This is similar to getFirstUnplacedBlock for the entire function, but since</Highlight></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><Highlight kind="comment">/// the size of BlockFilter is typically far less than the number of blocks in</Highlight></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><Highlight kind="comment">/// the entire function, iterating through the BlockFilter is more efficient.</Highlight></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><Highlight kind="comment">/// When processing the entire funciton, using the version without BlockFilter</Highlight></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><Highlight kind="comment">/// has a complexity of #(loops in function) &#42; #(blocks in function), while this</Highlight></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><Highlight kind="comment">/// version has a complexity of sum(#(loops in block) foreach block in function)</Highlight></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><Highlight kind="comment">/// which is always smaller. For long function mostly sequential in structure,</Highlight></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><Highlight kind="comment">/// the complexity is amortized to 1 &#42; #(blocks in function).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><Highlight kind="normal"><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;MachineBlockPlacement::getFirstUnplacedBlock(</Highlight></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;PlacedChain,</Highlight></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><Highlight kind="normal">    BlockFilterSet::iterator &amp;PrevUnplacedBlockInFilterIt,</Highlight></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter) &#123;</Highlight></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BlockFilter);</Highlight></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (; PrevUnplacedBlockInFilterIt != BlockFilter-&gt;end();</Highlight></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><Highlight kind="normal">       ++PrevUnplacedBlockInFilterIt) &#123;</Highlight></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = BlockToChain&#91;&#42;PrevUnplacedBlockInFilterIt&#93;;</Highlight></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> != &amp;PlacedChain) &#123;</Highlight></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;begin();</Highlight></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::fillWorkLists(</Highlight></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;BlockChain &#42;&gt;</a> &amp;UpdatedPreds,</Highlight></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &#42;BlockFilter = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a> = &#42;BlockToChain&#91;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93;;</Highlight></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UpdatedPreds.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(&amp;Chain).second)</Highlight></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><Highlight kind="normal">      <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.UnscheduledPredecessors == 0 &amp;&amp;</Highlight></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;Attempting to place block with unscheduled predecessors in worklist.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ChainBB : Chain) &#123;</Highlight></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BlockToChain&#91;ChainBB&#93; == &amp;Chain &amp;&amp;</Highlight></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Block in chain doesn&#39;t match BlockToChain map.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred : ChainBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</Highlight></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BlockFilter &amp;&amp; !BlockFilter-&gt;count(Pred))</Highlight></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BlockToChain&#91;Pred&#93; == &amp;Chain)</Highlight></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><Highlight kind="normal">      ++<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.UnscheduledPredecessors;</Highlight></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.UnscheduledPredecessors != 0)</Highlight></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB = &#42;<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>();</Highlight></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a1100bfbadd996d464150c6a68fa8dc1d">isEHPad</a>())</Highlight></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><Highlight kind="normal">    EHPadWorkList.push&#95;back(BB);</Highlight></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><Highlight kind="normal">    BlockWorkList.push&#95;back(BB);</Highlight></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::buildChain(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;HeadBB,</Highlight></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><Highlight kind="normal">                                       <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><Highlight kind="normal">                                       BlockFilterSet &#42;BlockFilter) &#123;</Highlight></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(HeadBB &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;BB must not be null.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BlockToChain&#91;HeadBB&#93; == &amp;Chain &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;BlockToChainMap mis-match.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> PrevUnplacedBlockIt = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;begin();</Highlight></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><Highlight kind="normal">  BlockFilterSet::iterator PrevUnplacedBlockInFilterIt;</Highlight></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BlockFilter)</Highlight></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><Highlight kind="normal">    PrevUnplacedBlockInFilterIt = BlockFilter-&gt;begin();</Highlight></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopHeaderBB = HeadBB;</Highlight></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><Highlight kind="normal">  markChainSuccessors(Chain, LoopHeaderBB, BlockFilter);</Highlight></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB = &#42;std::prev(<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</Highlight></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BB &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;null block found at end of chain in loop.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BlockToChain&#91;BB&#93; == &amp;Chain &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;BlockToChainMap mis-match in loop.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(&#42;std::prev(<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>()) == BB &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;BB Not found at end of chain.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Look for the best viable successor if there is one to place immediately</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// after this block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = selectBestSuccessor(BB, Chain, BlockFilter);</Highlight></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BestSucc = <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.BB;</Highlight></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ShouldTailDup = <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.ShouldTailDup;</Highlight></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#ad65badde897b7d4f51fc7c545538a388">allowTailDupPlacement</a>())</Highlight></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><Highlight kind="normal">      ShouldTailDup |= (BestSucc &amp;&amp; canTailDuplicateUnplacedPreds(</Highlight></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><Highlight kind="normal">                                        BB, BestSucc, Chain, BlockFilter));</Highlight></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If an immediate successor isn&#39;t available, look for the best viable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// block among those we&#39;ve identified as not violating the loop&#39;s CFG at</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// this point. This won&#39;t be a fallthrough, but it will increase locality.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BestSucc)</Highlight></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><Highlight kind="normal">      BestSucc = selectBestCandidateBlock(Chain, BlockWorkList);</Highlight></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BestSucc)</Highlight></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><Highlight kind="normal">      BestSucc = selectBestCandidateBlock(Chain, EHPadWorkList);</Highlight></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BestSucc) &#123;</Highlight></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BlockFilter)</Highlight></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><Highlight kind="normal">        BestSucc = getFirstUnplacedBlock(Chain, PrevUnplacedBlockInFilterIt,</Highlight></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><Highlight kind="normal">                                         BlockFilter);</Highlight></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><Highlight kind="normal">        BestSucc = getFirstUnplacedBlock(Chain, PrevUnplacedBlockIt);</Highlight></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BestSucc)</Highlight></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Unnatural loop CFG detected, forcibly merging the &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><Highlight kind="normal">                           </Highlight><Highlight kind="stringliteral">&quot;layout successor until the CFG reduces\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Placement may have changed tail duplication opportunities.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check for that now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#ad65badde897b7d4f51fc7c545538a388">allowTailDupPlacement</a>() &amp;&amp; BestSucc &amp;&amp; ShouldTailDup) &#123;</Highlight></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><Highlight kind="normal">      repeatedlyTailDuplicateBlock(BestSucc, BB, LoopHeaderBB, Chain,</Highlight></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><Highlight kind="normal">                                   BlockFilter, PrevUnplacedBlockIt,</Highlight></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><Highlight kind="normal">                                   PrevUnplacedBlockInFilterIt);</Highlight></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the chosen successor was duplicated into BB, don&#39;t bother laying</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// it out, just go round the loop again with BB as the chain end.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(BestSucc))</Highlight></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Place this block, updating the datastructures to reflect its placement.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;SuccChain = &#42;BlockToChain&#91;BestSucc&#93;;</Highlight></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Zero out UnscheduledPredecessors for the successor we&#39;re about to merge</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// in case we selected a successor that didn&#39;t fit naturally into the CFG.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><Highlight kind="normal">    SuccChain.UnscheduledPredecessors = 0;</Highlight></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Merging from &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(BB) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><Highlight kind="normal">                      &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(BestSucc) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><Highlight kind="normal">    markChainSuccessors(SuccChain, LoopHeaderBB, BlockFilter);</Highlight></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><Highlight kind="normal">    <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.merge(BestSucc, &amp;SuccChain);</Highlight></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><Highlight kind="normal">    BB = &#42;std::prev(<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</Highlight></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Finished forming chain for header block &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><Highlight kind="normal">                    &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(&#42;<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>()) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><Highlight kind="normal"></Highlight><Highlight kind="comment">// If bottom of block BB has only one successor OldTop, in most cases it is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><Highlight kind="normal"></Highlight><Highlight kind="comment">// profitable to move it before OldTop, except the following case:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><Highlight kind="normal"></Highlight><Highlight kind="comment">//     --&gt;OldTop&lt;-</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><Highlight kind="normal"></Highlight><Highlight kind="comment">//     |    .    |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><Highlight kind="normal"></Highlight><Highlight kind="comment">//     |    .    |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><Highlight kind="normal"></Highlight><Highlight kind="comment">//     |    .    |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><Highlight kind="normal"></Highlight><Highlight kind="comment">//     ---Pred   |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><Highlight kind="normal"></Highlight><Highlight kind="comment">//          |    |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><Highlight kind="normal"></Highlight><Highlight kind="comment">//         BB-----</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><Highlight kind="normal"></Highlight><Highlight kind="comment">// If BB is moved before OldTop, Pred needs a taken branch to BB, and it can&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><Highlight kind="normal"></Highlight><Highlight kind="comment">// layout the other successor below it, so it can&#39;t reduce taken branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><Highlight kind="normal"></Highlight><Highlight kind="comment">// In this case we keep its original layout.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MachineBlockPlacement::canMoveBottomBlockToTop(</Highlight></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BottomBlock, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;OldTop) &#123;</Highlight></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BottomBlock-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a03936a9b37da541420049422204ab206">pred&#95;size</a>() != 1)</Highlight></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred = &#42;BottomBlock-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab644fcf07a4c2708333cf66276282357">pred&#95;begin</a>();</Highlight></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred-&gt;succ&#95;size() != 2)</Highlight></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;OtherBB = &#42;Pred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a6321b189ea8fd5058663f8a87d6c23e9">succ&#95;begin</a>();</Highlight></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OtherBB == BottomBlock)</Highlight></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><Highlight kind="normal">    OtherBB = &#42;Pred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#abd32ea34faf1cde285a1b8daccd9c167">succ&#95;rbegin</a>();</Highlight></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OtherBB == OldTop)</Highlight></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Find out the possible fall through frequence to the top of a loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><Highlight kind="normal"><a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a></Highlight></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><Highlight kind="normal">MachineBlockPlacement::TopFallThroughFreq(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Top,</Highlight></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><Highlight kind="normal">                                          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet) &#123;</Highlight></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> MaxFreq = <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0);</Highlight></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred : Top-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</Highlight></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;PredChain = BlockToChain&#91;Pred&#93;;</Highlight></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoopBlockSet.count(Pred) &amp;&amp;</Highlight></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><Highlight kind="normal">        (!PredChain || Pred == &#42;std::prev(PredChain-&gt;end()))) &#123;</Highlight></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Found a Pred block can be placed before Top.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Check if Top is the best successor of Pred.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> TopProb = MBPI-&gt;getEdgeProbability(Pred, Top);</Highlight></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> TopOK = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : Pred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>()) &#123;</Highlight></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SuccProb = MBPI-&gt;getEdgeProbability(Pred, Succ);</Highlight></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><Highlight kind="normal">        <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;SuccChain = BlockToChain&#91;Succ&#93;;</Highlight></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Check if Succ can be placed after Pred.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Succ should not be in any chain, or it is the head of some chain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoopBlockSet.count(Succ) &amp;&amp; (SuccProb &gt; TopProb) &amp;&amp;</Highlight></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><Highlight kind="normal">            (!SuccChain || Succ == &#42;SuccChain-&gt;begin())) &#123;</Highlight></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><Highlight kind="normal">          TopOK = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TopOK) &#123;</Highlight></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> EdgeFreq =</Highlight></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><Highlight kind="normal">            MBFI-&gt;getBlockFreq(Pred) &#42; MBPI-&gt;getEdgeProbability(Pred, Top);</Highlight></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EdgeFreq &gt; MaxFreq)</Highlight></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><Highlight kind="normal">          MaxFreq = EdgeFreq;</Highlight></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MaxFreq;</Highlight></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Compute the fall through gains when move NewTop before OldTop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><Highlight kind="normal"></Highlight><Highlight kind="comment">// In following diagram, edges marked as &quot;-&quot; are reduced fallthrough, edges</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><Highlight kind="normal"></Highlight><Highlight kind="comment">// marked as &quot;+&quot; are increased fallthrough, this function computes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><Highlight kind="normal"></Highlight><Highlight kind="comment">//      SUM(increased fallthrough) - SUM(decreased fallthrough)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><Highlight kind="normal"></Highlight><Highlight kind="comment">//              |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><Highlight kind="normal"></Highlight><Highlight kind="comment">//              | -</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><Highlight kind="normal"></Highlight><Highlight kind="comment">//              V</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><Highlight kind="normal"></Highlight><Highlight kind="comment">//        ---&gt;OldTop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><Highlight kind="normal"></Highlight><Highlight kind="comment">//        |     .</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><Highlight kind="normal"></Highlight><Highlight kind="comment">//        |     .</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><Highlight kind="normal"></Highlight><Highlight kind="comment">//       +|     .    +</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><Highlight kind="normal"></Highlight><Highlight kind="comment">//        |   Pred ---&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><Highlight kind="normal"></Highlight><Highlight kind="comment">//        |     |-</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><Highlight kind="normal"></Highlight><Highlight kind="comment">//        |     V</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><Highlight kind="normal"></Highlight><Highlight kind="comment">//        --- NewTop &lt;---</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><Highlight kind="normal"></Highlight><Highlight kind="comment">//              |-</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><Highlight kind="normal"></Highlight><Highlight kind="comment">//              V</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><Highlight kind="normal"><a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> MachineBlockPlacement::FallThroughGains(</Highlight></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;NewTop, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;OldTop,</Highlight></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ExitBB, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet) &#123;</Highlight></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> FallThrough2Top = TopFallThroughFreq(OldTop, LoopBlockSet);</Highlight></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> FallThrough2Exit = <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0);</Highlight></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExitBB)</Highlight></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><Highlight kind="normal">    FallThrough2Exit =</Highlight></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><Highlight kind="normal">        MBFI-&gt;getBlockFreq(NewTop) &#42; MBPI-&gt;getEdgeProbability(NewTop, ExitBB);</Highlight></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> BackEdgeFreq =</Highlight></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><Highlight kind="normal">      MBFI-&gt;getBlockFreq(NewTop) &#42; MBPI-&gt;getEdgeProbability(NewTop, OldTop);</Highlight></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find the best Pred of NewTop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BestPred = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> FallThroughFromPred = <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0);</Highlight></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred : NewTop-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</Highlight></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoopBlockSet.count(Pred))</Highlight></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;PredChain = BlockToChain&#91;Pred&#93;;</Highlight></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PredChain || Pred == &#42;std::prev(PredChain-&gt;end())) &#123;</Highlight></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> EdgeFreq =</Highlight></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><Highlight kind="normal">          MBFI-&gt;getBlockFreq(Pred) &#42; MBPI-&gt;getEdgeProbability(Pred, NewTop);</Highlight></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EdgeFreq &gt; FallThroughFromPred) &#123;</Highlight></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><Highlight kind="normal">        FallThroughFromPred = EdgeFreq;</Highlight></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><Highlight kind="normal">        BestPred = Pred;</Highlight></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If NewTop is not placed after Pred, another successor can be placed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// after Pred.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> NewFreq = <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0);</Highlight></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BestPred) &#123;</Highlight></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : BestPred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>()) &#123;</Highlight></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((Succ == NewTop) || (Succ == BestPred) || !LoopBlockSet.count(Succ))</Highlight></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ComputedEdges.contains(Succ))</Highlight></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><Highlight kind="normal">      <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;SuccChain = BlockToChain&#91;Succ&#93;;</Highlight></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((SuccChain &amp;&amp; (Succ != &#42;SuccChain-&gt;begin())) ||</Highlight></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><Highlight kind="normal">          (SuccChain == BlockToChain&#91;BestPred&#93;))</Highlight></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> EdgeFreq = MBFI-&gt;getBlockFreq(BestPred) &#42;</Highlight></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><Highlight kind="normal">                                MBPI-&gt;getEdgeProbability(BestPred, Succ);</Highlight></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EdgeFreq &gt; NewFreq)</Highlight></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><Highlight kind="normal">        NewFreq = EdgeFreq;</Highlight></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> OrigEdgeFreq = MBFI-&gt;getBlockFreq(BestPred) &#42;</Highlight></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><Highlight kind="normal">                                  MBPI-&gt;getEdgeProbability(BestPred, NewTop);</Highlight></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewFreq &gt; OrigEdgeFreq) &#123;</Highlight></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If NewTop is not the best successor of Pred, then Pred doesn&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// fallthrough to NewTop. So there is no FallThroughFromPred and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// NewFreq.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><Highlight kind="normal">      NewFreq = <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0);</Highlight></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><Highlight kind="normal">      FallThroughFromPred = <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0);</Highlight></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0);</Highlight></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> Gains = BackEdgeFreq + NewFreq;</Highlight></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> Lost =</Highlight></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><Highlight kind="normal">      FallThrough2Top + FallThrough2Exit + FallThroughFromPred;</Highlight></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Gains &gt; Lost)</Highlight></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = Gains - Lost;</Highlight></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</Highlight></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><Highlight kind="comment">/// Helper function of findBestLoopTop. Find the best loop top block</Highlight></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><Highlight kind="comment">/// from predecessors of old top.</Highlight></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><Highlight kind="comment">/// Look for a block which is strictly better than the old top for laying</Highlight></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><Highlight kind="comment">/// out before the old top of the loop. This looks for only two patterns:</Highlight></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><Highlight kind="comment">///     1 a block has only one successor, the old loop top</Highlight></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><Highlight kind="comment">///        Because such a block will always result in an unconditional jump,</Highlight></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><Highlight kind="comment">///        rotating it in front of the old top is always profitable.</Highlight></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><Highlight kind="comment">///     2 a block has two successors, one is old top, another is exit</Highlight></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><Highlight kind="comment">///        and it has more than one predecessors</Highlight></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><Highlight kind="comment">///        If it is below one of its predecessors P, only P can fall through to</Highlight></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><Highlight kind="comment">///        it, all other predecessors need a jump to it, and another conditional</Highlight></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><Highlight kind="comment">///        jump to loop header. If it is moved before loop header, all its</Highlight></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><Highlight kind="comment">///        predecessors jump to it, then fall through to loop header. So all its</Highlight></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><Highlight kind="comment">///        predecessors except P can reduce one taken branch.</Highlight></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><Highlight kind="comment">///        At the same time, move it before old top increases the taken branch</Highlight></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><Highlight kind="comment">///        to loop exit block, so the reduced taken branch will be compared with</Highlight></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><Highlight kind="comment">///        the increased taken branch to the loop exit block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><Highlight kind="normal"><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;MachineBlockPlacement::findBestLoopTopHelper(</Highlight></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;OldTop, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &amp;L,</Highlight></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet) &#123;</Highlight></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check that the header hasn&#39;t been fused with a preheader block due to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// crazy branches. If it has, we need to start with the header at the top to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// prevent pulling the preheader into the loop body.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;HeaderChain = &#42;BlockToChain&#91;OldTop&#93;;</Highlight></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoopBlockSet.count(&#42;HeaderChain.begin()))</Highlight></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OldTop;</Highlight></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OldTop != &#42;HeaderChain.begin())</Highlight></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OldTop;</Highlight></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Finding best loop top for: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(OldTop)</Highlight></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> BestGains = <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0);</Highlight></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BestPred = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred : OldTop-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</Highlight></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoopBlockSet.count(Pred))</Highlight></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred == <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.getHeader())</Highlight></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;   old top pred: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(Pred) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;, has &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><Highlight kind="normal">                      &lt;&lt; Pred-&gt;succ&#95;size() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; successors, &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><Highlight kind="normal">                      &lt;&lt; <a href="/docs/api/namespaces/llvm/#ada715bce8140114cd2fd2f8ab018f7c3">printBlockFreq</a>(MBFI-&gt;getMBFI(), &#42;Pred) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; freq\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred-&gt;succ&#95;size() &gt; 2)</Highlight></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;OtherBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred-&gt;succ&#95;size() == 2) &#123;</Highlight></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><Highlight kind="normal">      OtherBB = &#42;Pred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a6321b189ea8fd5058663f8a87d6c23e9">succ&#95;begin</a>();</Highlight></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OtherBB == OldTop)</Highlight></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><Highlight kind="normal">        OtherBB = &#42;Pred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#abd32ea34faf1cde285a1b8daccd9c167">succ&#95;rbegin</a>();</Highlight></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!canMoveBottomBlockToTop(Pred, OldTop))</Highlight></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> Gains =</Highlight></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><Highlight kind="normal">        FallThroughGains(Pred, OldTop, OtherBB, LoopBlockSet);</Highlight></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((Gains &gt; <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0)) &amp;&amp;</Highlight></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><Highlight kind="normal">        (Gains &gt; BestGains ||</Highlight></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><Highlight kind="normal">         ((Gains == BestGains) &amp;&amp; Pred-&gt;isLayoutSuccessor(OldTop)))) &#123;</Highlight></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><Highlight kind="normal">      BestPred = Pred;</Highlight></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><Highlight kind="normal">      BestGains = Gains;</Highlight></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If no direct predecessor is fine, just use the loop header.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BestPred) &#123;</Highlight></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    final top unchanged\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OldTop;</Highlight></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Walk backwards through any straight line of predecessors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (BestPred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a03936a9b37da541420049422204ab206">pred&#95;size</a>() == 1 &amp;&amp;</Highlight></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><Highlight kind="normal">         (&#42;BestPred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab644fcf07a4c2708333cf66276282357">pred&#95;begin</a>())-&gt;succ&#95;size() == 1 &amp;&amp;</Highlight></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><Highlight kind="normal">         &#42;BestPred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab644fcf07a4c2708333cf66276282357">pred&#95;begin</a>() != <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.getHeader())</Highlight></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><Highlight kind="normal">    BestPred = &#42;BestPred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ab644fcf07a4c2708333cf66276282357">pred&#95;begin</a>();</Highlight></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    final top: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(BestPred) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BestPred;</Highlight></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><Highlight kind="comment">/// Find the best loop top block for layout.</Highlight></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><Highlight kind="comment">/// This function iteratively calls findBestLoopTopHelper, until no new better</Highlight></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><Highlight kind="comment">/// BB can be found.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><Highlight kind="normal"><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><Highlight kind="normal">MachineBlockPlacement::findBestLoopTop(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &amp;L,</Highlight></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><Highlight kind="normal">                                       </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet) &#123;</Highlight></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Placing the latch block before the header may introduce an extra branch</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that skips this block the first time the loop is executed, which we want</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to avoid when optimising for size.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: in theory there is a case that does not introduce a new branch,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// i.e. when the layout predecessor does not fallthrough to the loop header.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// In practice this never happens though: there always seems to be a preheader</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that can fallthrough and that is also placed before the header.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.getHeader(), PSI, MBFI.get()))</Highlight></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.getHeader();</Highlight></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;OldTop = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;NewTop = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.getHeader();</Highlight></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (NewTop != OldTop) &#123;</Highlight></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><Highlight kind="normal">    OldTop = NewTop;</Highlight></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><Highlight kind="normal">    NewTop = findBestLoopTopHelper(OldTop, L, LoopBlockSet);</Highlight></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewTop != OldTop)</Highlight></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><Highlight kind="normal">      ComputedEdges&#91;NewTop&#93; = &#123;OldTop, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewTop;</Highlight></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><Highlight kind="comment">/// Find the best loop exiting block for layout.</Highlight></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><Highlight kind="comment">/// This routine implements the logic to analyze the loop looking for the best</Highlight></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><Highlight kind="comment">/// block to layout at the top of the loop. Typically this is done to maximize</Highlight></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><Highlight kind="comment">/// fallthrough opportunities.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><Highlight kind="normal"><a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><Highlight kind="normal">MachineBlockPlacement::findBestLoopExit(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &amp;L,</Highlight></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><Highlight kind="normal">                                        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet,</Highlight></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> &amp;ExitFreq) &#123;</Highlight></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We don&#39;t want to layout the loop linearly in all cases. If the loop header</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is just a normal basic block in the loop, we want to look for what block</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// within the loop is the best one to layout at the top. However, if the loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// header has be pre-merged into a chain due to predecessors not having</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// analyzable branches, &#42;and&#42; the predecessor it is merged with is &#42;not&#42; part</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the loop, rotating the header into the middle of the loop will create</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a non-contiguous range of blocks which is Very Bad. So start with the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// header and only rotate if safe.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;HeaderChain = &#42;BlockToChain&#91;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.getHeader()&#93;;</Highlight></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoopBlockSet.count(&#42;HeaderChain.begin()))</Highlight></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> BestExitEdgeFreq;</Highlight></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> BestExitLoopDepth = 0;</Highlight></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ExitingBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there are exits to outer loops, loop rotation can severely limit</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// fallthrough opportunities unless it selects such an exit. Keep a set of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// blocks where rotating to exit with that block will reach an outer loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;MachineBasicBlock &#42;, 4&gt;</a> BlocksExitingToOuterLoop;</Highlight></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Finding best loop exit for: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><Highlight kind="normal">                    &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.getHeader()) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.getBlocks()) &#123;</Highlight></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a> = &#42;BlockToChain&#91;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93;;</Highlight></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Ensure that this block is at the end of a chain; otherwise it could be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// mid-way through an inner loop or a successor of an unanalyzable branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> != &#42;std::prev(<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>()))</Highlight></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Now walk the successors. We need to establish whether this has a viable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// exiting successor and whether it has a viable non-exiting successor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We store the old exiting state and restore it if a viable looping</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// successor isn&#39;t found.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;OldExitingBB = ExitingBB;</Highlight></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> OldBestExitEdgeFreq = BestExitEdgeFreq;</Highlight></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasLoopingSucc = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;successors()) &#123;</Highlight></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Succ-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a1100bfbadd996d464150c6a68fa8dc1d">isEHPad</a>())</Highlight></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Succ == <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</Highlight></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><Highlight kind="normal">      <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;SuccChain = &#42;BlockToChain&#91;Succ&#93;;</Highlight></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Don&#39;t split chains, either this chain or the successor&#39;s chain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&amp;Chain == &amp;SuccChain) &#123;</Highlight></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    exiting: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; -&gt; &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><Highlight kind="normal">                          &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(Succ) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; (chain conflict)\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SuccProb = MBPI-&gt;getEdgeProbability(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, Succ);</Highlight></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LoopBlockSet.count(Succ)) &#123;</Highlight></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    looping: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; -&gt; &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><Highlight kind="normal">                          &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(Succ) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; (&quot;</Highlight><Highlight kind="normal"> &lt;&lt; SuccProb &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;)\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><Highlight kind="normal">        HasLoopingSucc = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SuccLoopDepth = 0;</Highlight></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &#42;ExitLoop = MLI-&gt;getLoopFor(Succ)) &#123;</Highlight></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><Highlight kind="normal">        SuccLoopDepth = ExitLoop-&gt;getLoopDepth();</Highlight></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExitLoop-&gt;contains(&amp;L))</Highlight></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><Highlight kind="normal">          BlocksExitingToOuterLoop.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</Highlight></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> ExitEdgeFreq = MBFI-&gt;getBlockFreq(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#42; SuccProb;</Highlight></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    exiting: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; -&gt; &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><Highlight kind="normal">                 &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(Succ) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; &#91;L:&quot;</Highlight><Highlight kind="normal"> &lt;&lt; SuccLoopDepth &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;&#93; (&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><Highlight kind="normal">                 &lt;&lt; <a href="/docs/api/namespaces/llvm/#ada715bce8140114cd2fd2f8ab018f7c3">printBlockFreq</a>(MBFI-&gt;getMBFI(), ExitEdgeFreq) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;)\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Note that we bias this toward an existing layout successor to retain</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// incoming order in the absence of better information. The exit must have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// a frequency higher than the current exit before we consider breaking</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the layout.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> Bias(100 - <a href="#a41cd121b4df30e5c0dc17f0c479e843a">ExitBlockBias</a>, 100);</Highlight></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ExitingBB || SuccLoopDepth &gt; BestExitLoopDepth ||</Highlight></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><Highlight kind="normal">          ExitEdgeFreq &gt; BestExitEdgeFreq ||</Highlight></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><Highlight kind="normal">          (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>-&gt;isLayoutSuccessor(Succ) &amp;&amp;</Highlight></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><Highlight kind="normal">           !(ExitEdgeFreq &lt; BestExitEdgeFreq &#42; Bias))) &#123;</Highlight></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><Highlight kind="normal">        BestExitEdgeFreq = ExitEdgeFreq;</Highlight></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><Highlight kind="normal">        ExitingBB = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>;</Highlight></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!HasLoopingSucc) &#123;</Highlight></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Restore the old exiting state, no viable looping successor was found.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><Highlight kind="normal">      ExitingBB = OldExitingBB;</Highlight></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><Highlight kind="normal">      BestExitEdgeFreq = OldBestExitEdgeFreq;</Highlight></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Without a candidate exiting block or with only a single block in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// loop, just use the loop header to layout the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ExitingBB) &#123;</Highlight></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    No other candidate exit blocks, using loop header\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.getNumBlocks() == 1) &#123;</Highlight></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;    Loop has 1 block, using loop header as exit\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Also, if we have exit blocks which lead to outer loops but didn&#39;t select</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// one of them as the exiting block we are rotating toward, disable loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// rotation altogether.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BlocksExitingToOuterLoop.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#af8a50544090e81ac83601aff8f4b0142">empty</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><Highlight kind="normal">      !BlocksExitingToOuterLoop.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(ExitingBB))</Highlight></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  Best exiting block: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(ExitingBB)</Highlight></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><Highlight kind="normal">  ExitFreq = BestExitEdgeFreq;</Highlight></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ExitingBB;</Highlight></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><Highlight kind="comment">/// Check if there is a fallthrough to loop header Top.</Highlight></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><Highlight kind="comment">///   1 Look for a Pred that can be layout before Top.</Highlight></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><Highlight kind="comment">///   2 Check if Top is the most possible successor of Pred.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MachineBlockPlacement::hasViableTopFallthrough(</Highlight></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Top, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet) &#123;</Highlight></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred : Top-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</Highlight></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;PredChain = BlockToChain&#91;Pred&#93;;</Highlight></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoopBlockSet.count(Pred) &amp;&amp;</Highlight></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><Highlight kind="normal">        (!PredChain || Pred == &#42;std::prev(PredChain-&gt;end()))) &#123;</Highlight></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Found a Pred block can be placed before Top.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Check if Top is the best successor of Pred.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> TopProb = MBPI-&gt;getEdgeProbability(Pred, Top);</Highlight></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> TopOK = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : Pred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>()) &#123;</Highlight></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SuccProb = MBPI-&gt;getEdgeProbability(Pred, Succ);</Highlight></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><Highlight kind="normal">        <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;SuccChain = BlockToChain&#91;Succ&#93;;</Highlight></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Check if Succ can be placed after Pred.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Succ should not be in any chain, or it is the head of some chain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((!SuccChain || Succ == &#42;SuccChain-&gt;begin()) &amp;&amp; SuccProb &gt; TopProb) &#123;</Highlight></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349"><Highlight kind="normal">          TopOK = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TopOK)</Highlight></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><Highlight kind="comment">/// Attempt to rotate an exiting block to the bottom of the loop.</Highlight></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><Highlight kind="comment">/// Once we have built a chain, try to rotate it to line up the hot exit block</Highlight></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><Highlight kind="comment">/// with fallthrough out of the loop if doing so doesn&#39;t introduce unnecessary</Highlight></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><Highlight kind="comment">/// branches. For example, if the loop has fallthrough into its header and out</Highlight></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><Highlight kind="comment">/// of its bottom already, don&#39;t rotate it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::rotateLoop(<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;LoopChain,</Highlight></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><Highlight kind="normal">                                       </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ExitingBB,</Highlight></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><Highlight kind="normal">                                       <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> ExitFreq,</Highlight></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><Highlight kind="normal">                                       </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet) &#123;</Highlight></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ExitingBB)</Highlight></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Top = &#42;LoopChain.<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</Highlight></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Bottom = &#42;std::prev(LoopChain.end());</Highlight></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If ExitingBB is already the last one in a chain then nothing to do.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Bottom == ExitingBB)</Highlight></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The entry block should always be the first BB in a function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Top-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a9103c1c7b60d793b0efd41c741286508">isEntryBlock</a>())</Highlight></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ViableTopFallthrough = hasViableTopFallthrough(Top, LoopBlockSet);</Highlight></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the header has viable fallthrough, check whether the current loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// bottom is a viable exiting block. If so, bail out as rotating will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// introduce an unnecessary branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ViableTopFallthrough) &#123;</Highlight></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : Bottom-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>()) &#123;</Highlight></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><Highlight kind="normal">      <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;SuccChain = BlockToChain&#91;Succ&#93;;</Highlight></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoopBlockSet.count(Succ) &amp;&amp;</Highlight></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><Highlight kind="normal">          (!SuccChain || Succ == &#42;SuccChain-&gt;begin()))</Highlight></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Rotate will destroy the top fallthrough, we need to ensure the new exit</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// frequency is larger than top fallthrough.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> FallThrough2Top = TopFallThroughFreq(Top, LoopBlockSet);</Highlight></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FallThrough2Top &gt;= ExitFreq)</Highlight></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#aac2485344159ae07cfd3aa75113f50f5">BlockChain::iterator</a> ExitIt = <a href="/docs/api/namespaces/llvm/#a086e9fbdb06276db7753101a08a63adf">llvm::find</a>(LoopChain, ExitingBB);</Highlight></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExitIt == LoopChain.end())</Highlight></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Rotating a loop exit to the bottom when there is a fallthrough to top</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// trades the entry fallthrough for an exit fallthrough.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there is no bottom-&gt;top edge, but the chosen exit block does have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a fallthrough, we break that fallthrough for nothing in return.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Let&#39;s consider an example. We have a built chain of basic blocks</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// B1, B2, ..., Bn, where Bk is a ExitingBB - chosen exit block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// By doing a rotation we get</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Bk+1, ..., Bn, B1, ..., Bk</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Break of fallthrough to B1 is compensated by a fallthrough from Bk.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we had a fallthrough Bk -&gt; Bk+1 it is broken now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// It might be compensated by fallthrough Bn -&gt; B1.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// So we have a condition to avoid creation of extra branch by loop rotation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// All below must be true to avoid loop rotation:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   If there is a fallthrough to top (B1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   There was fallthrough from chosen exit block (Bk) to next one (Bk+1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   There is no fallthrough from bottom (Bn) to top (B1).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Please note that there is no exit fallthrough from Bn because we checked it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// above.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ViableTopFallthrough) &#123;</Highlight></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(std::next(ExitIt) != LoopChain.end() &amp;&amp;</Highlight></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Exit should not be last BB&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;NextBlockInChain = &#42;std::next(ExitIt);</Highlight></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExitingBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(NextBlockInChain))</Highlight></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Bottom-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(Top))</Highlight></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Rotating loop to put exit &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(ExitingBB)</Highlight></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; at bottom\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><Highlight kind="normal">  std::rotate(LoopChain.begin(), std::next(ExitIt), LoopChain.end());</Highlight></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><Highlight kind="comment">/// Attempt to rotate a loop based on profile data to reduce branch cost.</Highlight></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><Highlight kind="comment">/// With profile data, we can determine the cost in terms of missed fall through</Highlight></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><Highlight kind="comment">/// opportunities when rotating a loop chain and select the best rotation.</Highlight></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><Highlight kind="comment">/// Basically, there are three kinds of cost to consider for each rotation:</Highlight></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><Highlight kind="comment">///    1 The possibly missed fall through edge (if it exists) from BB out of</Highlight></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><Highlight kind="comment">///    the loop to the loop header.</Highlight></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><Highlight kind="comment">///    2 The possibly missed fall through edges (if they exist) from the loop</Highlight></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><Highlight kind="comment">///    exits to BB out of the loop.</Highlight></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><Highlight kind="comment">///    3 The missed fall through edge (if it exists) from the last BB to the</Highlight></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><Highlight kind="comment">///    first BB in the loop chain.</Highlight></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><Highlight kind="comment">///  Therefore, the cost for a given rotation is the sum of costs listed above.</Highlight></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><Highlight kind="comment">///  We select the best rotation with the smallest cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::rotateLoopWithProfile(</Highlight></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;LoopChain, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &amp;L,</Highlight></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BlockFilterSet &amp;LoopBlockSet) &#123;</Highlight></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> RotationPos = LoopChain.end();</Highlight></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ChainHeaderBB = &#42;LoopChain.<a href="/docs/api/classes/llvm/machinebasicblock/#ab2d91e7bec944efcbc39d8e30644f111">begin</a>();</Highlight></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The entry block should always be the first BB in a function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ChainHeaderBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a9103c1c7b60d793b0efd41c741286508">isEntryBlock</a>())</Highlight></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> SmallestRotationCost = <a href="/docs/api/classes/llvm/blockfrequency/#a5bd2a8de4fde83093df0cc2415db2312">BlockFrequency::max</a>();</Highlight></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A utility lambda that scales up a block frequency by dividing it by a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// branch probability which is the reciprocal of the scale.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ScaleBlockFrequency = &#91;&#93;(<a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> Freq,</Highlight></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><Highlight kind="normal">                                </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Scale) -&gt; <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> &#123;</Highlight></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Scale == 0)</Highlight></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0);</Highlight></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Use operator / between BlockFrequency and BranchProbability to implement</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// saturating multiplication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Freq / <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a>(1, Scale);</Highlight></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Compute the cost of the missed fall-through edge to the loop header if the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// chain head is not the loop header. As we only consider natural loops with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// single header, this computation can be done only once.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> HeaderFallThroughCost(0);</Highlight></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Pred : ChainHeaderBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>()) &#123;</Highlight></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;PredChain = BlockToChain&#91;Pred&#93;;</Highlight></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoopBlockSet.count(Pred) &amp;&amp;</Highlight></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><Highlight kind="normal">        (!PredChain || Pred == &#42;std::prev(PredChain-&gt;end()))) &#123;</Highlight></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> EdgeFreq = MBFI-&gt;getBlockFreq(Pred) &#42;</Highlight></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><Highlight kind="normal">                      MBPI-&gt;getEdgeProbability(Pred, ChainHeaderBB);</Highlight></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> FallThruCost = ScaleBlockFrequency(EdgeFreq, <a href="#a75fe07dfba15c73225c8ca4cd720049d">MisfetchCost</a>);</Highlight></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the predecessor has only an unconditional jump to the header, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// need to consider the cost of this jump.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred-&gt;succ&#95;size() == 1)</Highlight></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><Highlight kind="normal">        FallThruCost += ScaleBlockFrequency(EdgeFreq, <a href="#a72b387cbb4c16dbf0558135dd26ddfd0">JumpInstCost</a>);</Highlight></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><Highlight kind="normal">      HeaderFallThroughCost = std::max(HeaderFallThroughCost, FallThruCost);</Highlight></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Here we collect all exit blocks in the loop, and for each exit we find out</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// its hottest exit edge. For each loop rotation, we define the loop exit cost</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// as the sum of frequencies of exit edges we collect here, excluding the exit</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// edge from the tail of the loop chain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;MachineBasicBlock &#42;, BlockFrequency&gt;</a>, 4&gt; ExitsWithFreq;</Highlight></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BB : LoopChain) &#123;</Highlight></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> LargestExitEdgeProb = <a href="/docs/api/classes/llvm/branchprobability/#afd00958cba7080048a84cccfcef55d71">BranchProbability::getZero</a>();</Highlight></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Succ : BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>()) &#123;</Highlight></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><Highlight kind="normal">      <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;SuccChain = BlockToChain&#91;Succ&#93;;</Highlight></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoopBlockSet.count(Succ) &amp;&amp;</Highlight></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><Highlight kind="normal">          (!SuccChain || Succ == &#42;SuccChain-&gt;begin())) &#123;</Highlight></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SuccProb = MBPI-&gt;getEdgeProbability(BB, Succ);</Highlight></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><Highlight kind="normal">        LargestExitEdgeProb = std::max(LargestExitEdgeProb, SuccProb);</Highlight></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LargestExitEdgeProb &gt; <a href="/docs/api/classes/llvm/branchprobability/#afd00958cba7080048a84cccfcef55d71">BranchProbability::getZero</a>()) &#123;</Highlight></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ExitFreq = MBFI-&gt;getBlockFreq(BB) &#42; LargestExitEdgeProb;</Highlight></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><Highlight kind="normal">      ExitsWithFreq.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(BB, ExitFreq);</Highlight></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// In this loop we iterate every block in the loop chain and calculate the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cost assuming the block is the head of the loop chain. When the loop ends,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we should have found the best candidate as the loop chain&#39;s head.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Iter = LoopChain.begin(), TailIter = std::prev(LoopChain.end()),</Highlight></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><Highlight kind="normal">            EndIter = LoopChain.end();</Highlight></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><Highlight kind="normal">       Iter != EndIter; Iter++, TailIter++) &#123;</Highlight></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TailIter is used to track the tail of the loop chain if the block we are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// checking (pointed by Iter) is the head of the chain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TailIter == LoopChain.end())</Highlight></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><Highlight kind="normal">      TailIter = LoopChain.begin();</Highlight></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> TailBB = &#42;TailIter;</Highlight></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Calculate the cost by putting this BB to the top.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0);</Highlight></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the current BB is the loop header, we need to take into account the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// cost of the missed fall through edge from outside of the loop to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// header.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Iter != LoopChain.begin())</Highlight></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += HeaderFallThroughCost;</Highlight></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Collect the loop exit cost by summing up frequencies of all exit edges</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// except the one from the chain tail.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;ExitWithFreq : ExitsWithFreq)</Highlight></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TailBB != ExitWithFreq.first)</Highlight></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += ExitWithFreq.second;</Highlight></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The cost of breaking the once fall-through edge from the tail to the top</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// of the loop chain. Here we need to consider three cases:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// 1 If the tail node has only one successor, then we will get an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    additional jmp instruction. So the cost here is (MisfetchCost +</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    JumpInstCost) &#42; tail node frequency.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// 2 If the tail node has two successors, then we may still get an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    additional jmp instruction if the layout successor after the loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    chain is not its CFG successor. Note that the more frequently executed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    jmp instruction will be put ahead of the other one. Assume the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    frequency of those two branches are x and y, where x is the frequency</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    of the edge to the chain head, then the cost will be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    (x &#42; MisfetechCost + min(x, y) &#42; JumpInstCost) &#42; tail node frequency.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// 3 If the tail node has more than two successors (this rarely happens),</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//    we won&#39;t consider any additional cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TailBB-&gt;isSuccessor(&#42;Iter)) &#123;</Highlight></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> TailBBFreq = MBFI-&gt;getBlockFreq(TailBB);</Highlight></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TailBB-&gt;succ&#95;size() == 1)</Highlight></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += ScaleBlockFrequency(TailBBFreq, <a href="#a75fe07dfba15c73225c8ca4cd720049d">MisfetchCost</a> + <a href="#a72b387cbb4c16dbf0558135dd26ddfd0">JumpInstCost</a>);</Highlight></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TailBB-&gt;succ&#95;size() == 2) &#123;</Highlight></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> TailToHeadProb = MBPI-&gt;getEdgeProbability(TailBB, &#42;Iter);</Highlight></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> TailToHeadFreq = TailBBFreq &#42; TailToHeadProb;</Highlight></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ColderEdgeFreq = TailToHeadProb &gt; <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a>(1, 2)</Highlight></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><Highlight kind="normal">                                  ? TailBBFreq &#42; TailToHeadProb.<a href="/docs/api/classes/llvm/branchprobability/#aaee6034264d5d0782e5d1489360730d9">getCompl</a>()</Highlight></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><Highlight kind="normal">                                  : TailToHeadFreq;</Highlight></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += ScaleBlockFrequency(TailToHeadFreq, <a href="#a75fe07dfba15c73225c8ca4cd720049d">MisfetchCost</a>) +</Highlight></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><Highlight kind="normal">                ScaleBlockFrequency(ColderEdgeFreq, <a href="#a72b387cbb4c16dbf0558135dd26ddfd0">JumpInstCost</a>);</Highlight></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;The cost of loop rotation by making &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><Highlight kind="normal">                      &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(&#42;Iter) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to the top: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576"><Highlight kind="normal">                      &lt;&lt; <a href="/docs/api/namespaces/llvm/#ada715bce8140114cd2fd2f8ab018f7c3">printBlockFreq</a>(MBFI-&gt;getMBFI(), <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> &lt; SmallestRotationCost) &#123;</Highlight></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><Highlight kind="normal">      SmallestRotationCost = <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><Highlight kind="normal">      RotationPos = <a href="/docs/api/namespaces/anonymous-cskyconstantislandpass-cpp-/#a0bd7d621ba8de56e4052df49da823802">Iter</a>;</Highlight></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RotationPos != LoopChain.end()) &#123;</Highlight></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Rotate loop by making &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(&#42;RotationPos)</Highlight></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to the top\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><Highlight kind="normal">    std::rotate(LoopChain.begin(), RotationPos, LoopChain.end());</Highlight></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><Highlight kind="comment">/// Collect blocks in the given loop that are to be placed.</Highlight></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><Highlight kind="comment">/// When profile data is available, exclude cold blocks from the returned set;</Highlight></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><Highlight kind="comment">/// otherwise, collect all blocks in the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><Highlight kind="normal">MachineBlockPlacement::BlockFilterSet</Highlight></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><Highlight kind="normal">MachineBlockPlacement::collectLoopBlockSet(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &amp;L) &#123;</Highlight></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect the blocks in a set ordered by block number, as this gives the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// order as they appear in the function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal">MBBCompare &#123;</Highlight></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> operator()(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> MachineBasicBlock &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>,</Highlight></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><Highlight kind="normal">                    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> MachineBasicBlock &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getNumber() &lt; <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getNumber();</Highlight></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><Highlight kind="normal">  std::set&lt;const MachineBasicBlock &#42;, MBBCompare&gt; LoopBlockSet;</Highlight></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Filter cold blocks off from LoopBlockSet when profile data is available.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect the sum of frequencies of incoming edges to the loop header from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// outside. If we treat the loop as a super block, this is the frequency of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the loop. Then for each block in the loop, we calculate the ratio between</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// its frequency and the frequency of the loop block. When it is too small,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// don&#39;t add it to the loop chain. If there are outer loops, then this block</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// will be merged into the first outer loop chain for which this block is not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cold anymore. This needs precise profile data and we only do this when</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// profile data is available.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunction().hasProfileData() || <a href="#a3ede40cd3f6f158cb8cbbc9de3844d98">ForceLoopColdBlock</a>) &#123;</Highlight></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> LoopFreq(0);</Highlight></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LoopPred : <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.getHeader()-&gt;predecessors())</Highlight></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.contains(LoopPred))</Highlight></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><Highlight kind="normal">        LoopFreq += MBFI-&gt;getBlockFreq(LoopPred) &#42;</Highlight></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><Highlight kind="normal">                    MBPI-&gt;getEdgeProbability(LoopPred, <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.getHeader());</Highlight></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopBB : <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.getBlocks()) &#123;</Highlight></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LoopBlockSet.count(LoopBB))</Highlight></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Freq = MBFI-&gt;getBlockFreq(LoopBB).<a href="/docs/api/classes/llvm/blockfrequency/#a8e9ed6b20c2503f66f1fd0725297aedc">getFrequency</a>();</Highlight></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Freq == 0 || LoopFreq.getFrequency() / Freq &gt; <a href="#acba0c508ce2e626b58485ceb28068cf1">LoopToColdBlockRatio</a>)</Highlight></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><Highlight kind="normal">      <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a> = BlockToChain&#91;LoopBB&#93;;</Highlight></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ChainBB : &#42;Chain)</Highlight></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><Highlight kind="normal">        LoopBlockSet.insert(ChainBB);</Highlight></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><Highlight kind="normal">    LoopBlockSet.insert(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.block&#95;begin(), <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.block&#95;end());</Highlight></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Copy the blocks into a BlockFilterSet, as iterating it is faster than</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// std::set. We will only remove blocks and never insert them, which will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// preserve the ordering.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><Highlight kind="normal">  BlockFilterSet <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a>(LoopBlockSet.begin(), LoopBlockSet.end());</Highlight></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/mipsisd/#a422daf9aa810935178671306b651d69ba366e1eac31eeb1a1892d62ccfc0c8cf8">Ret</a>;</Highlight></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><Highlight kind="comment">/// Forms basic block chains from the natural loop structures.</Highlight></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><Highlight kind="comment">/// These chains are designed to preserve the existing &#42;structure&#42; of the code</Highlight></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><Highlight kind="comment">/// as much as possible. We can then stitch the chains together in a way which</Highlight></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647"><Highlight kind="comment">/// both preserves the topological structure and minimizes taken conditional</Highlight></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><Highlight kind="comment">/// branches.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::buildLoopChains(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &amp;L) &#123;</Highlight></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// First recurse through any nested loops, building chains for those inner</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// loops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &#42;InnerLoop : L)</Highlight></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><Highlight kind="normal">    buildLoopChains(&#42;InnerLoop);</Highlight></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BlockWorkList.empty() &amp;&amp;</Highlight></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;BlockWorkList not empty when starting to build loop chains.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EHPadWorkList.empty() &amp;&amp;</Highlight></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;EHPadWorkList not empty when starting to build loop chains.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><Highlight kind="normal">  BlockFilterSet LoopBlockSet = collectLoopBlockSet(L);</Highlight></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if we have profile data for this function. If yes, we will rotate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// this loop by modeling costs more precisely which requires the profile data</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// for better layout.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> RotateLoopWithProfile =</Highlight></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><Highlight kind="normal">      <a href="#ae71e7939345cee7ef0596b40d1ad068b">ForcePreciseRotationCost</a> ||</Highlight></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><Highlight kind="normal">      (<a href="#a0d30337c58d278817264718434f122ca">PreciseRotationCost</a> &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunction().<a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/partialinlining-cpp/#a8884a3765a9cdbc730400587d4a3192c">hasProfileData</a>());</Highlight></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// First check to see if there is an obviously preferable top block for the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// loop. This will default to the header, but may end up as one of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// predecessors to the header if there is one which will result in strictly</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// fewer branches in the loop body.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopTop = findBestLoopTop(L, LoopBlockSet);</Highlight></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we selected just the header for the loop top, look for a potentially</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// profitable exit block in the event that rotating the loop can eliminate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// branches by placing an exit edge at the bottom.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Loops are processed innermost to uttermost, make sure we clear</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// PreferredLoopExit before processing a new loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><Highlight kind="normal">  PreferredLoopExit = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> ExitFreq;</Highlight></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RotateLoopWithProfile &amp;&amp; LoopTop == <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.getHeader())</Highlight></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><Highlight kind="normal">    PreferredLoopExit = findBestLoopExit(L, LoopBlockSet, ExitFreq);</Highlight></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;LoopChain = &#42;BlockToChain&#91;LoopTop&#93;;</Highlight></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: This is a really lame way of walking the chains in the loop: we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// walk the blocks, and use a set to prevent visiting a particular chain</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// twice.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BlockChain &#42;, 4&gt;</a> UpdatedPreds;</Highlight></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LoopChain.UnscheduledPredecessors == 0 &amp;&amp;</Highlight></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;LoopChain should not have unscheduled predecessors.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><Highlight kind="normal">  UpdatedPreds.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(&amp;LoopChain);</Highlight></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopBB : LoopBlockSet)</Highlight></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><Highlight kind="normal">    fillWorkLists(LoopBB, UpdatedPreds, &amp;LoopBlockSet);</Highlight></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><Highlight kind="normal">  buildChain(LoopTop, LoopChain, &amp;LoopBlockSet);</Highlight></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RotateLoopWithProfile)</Highlight></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><Highlight kind="normal">    rotateLoopWithProfile(LoopChain, L, LoopBlockSet);</Highlight></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><Highlight kind="normal">    rotateLoop(LoopChain, PreferredLoopExit, ExitFreq, LoopBlockSet);</Highlight></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</Highlight></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Crash at the end so we get all of the debugging output first.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> BadLoop = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LoopChain.UnscheduledPredecessors) &#123;</Highlight></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><Highlight kind="normal">      BadLoop = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Loop chain contains a block without its preds placed!\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  Loop header:  &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(&#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.block&#95;begin()) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  Chain header: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(&#42;LoopChain.begin()) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ChainBB : LoopChain) &#123;</Highlight></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;          ... &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(ChainBB) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoopBlockSet.remove(ChainBB)) &#123;</Highlight></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We don&#39;t mark the loop as bad here because there are real situations</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// where this can occur. For example, with an unanalyzable fallthrough</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// from a loop block to a non-loop block or vice versa.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Loop chain contains a block not contained by the loop!\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  Loop header:  &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(&#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.block&#95;begin()) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  Chain header: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(&#42;LoopChain.begin()) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  Bad block:    &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(ChainBB) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LoopBlockSet.empty()) &#123;</Highlight></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><Highlight kind="normal">      BadLoop = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopBB : LoopBlockSet)</Highlight></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Loop contains blocks never placed into a chain!\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  Loop header:  &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(&#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>.block&#95;begin()) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  Chain header: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(&#42;LoopChain.begin()) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  Bad block:    &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(LoopBB) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!BadLoop &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Detected problems with the placement of this loop.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><Highlight kind="normal">  BlockWorkList.clear();</Highlight></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><Highlight kind="normal">  EHPadWorkList.clear();</Highlight></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::buildCFGChains() &#123;</Highlight></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Ensure that every BB in the function has an associated chain to simplify</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the assumptions of the remaining algorithm.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineOperand, 4&gt;</a> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>; </Highlight><Highlight kind="comment">// For analyzeBranch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> FI = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;begin(), FE = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;end(); FI != FE;</Highlight></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><Highlight kind="normal">       ++FI) &#123;</Highlight></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB = &amp;&#42;FI;</Highlight></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a> =</Highlight></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> (ChainAllocator.Allocate()) <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a>(BlockToChain, BB);</Highlight></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Also, merge any blocks which we cannot reason about and must preserve</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the exact fallthrough behavior for.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>.clear();</Highlight></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, &#42;FBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// For analyzeBranch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;analyzeBranch(&#42;BB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>) || !FI-&gt;canFallThrough())</Highlight></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> NextFI = std::next(FI);</Highlight></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;NextBB = &amp;&#42;NextFI;</Highlight></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Ensure that the layout successor is a viable block, as we know that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// fallthrough is a possibility.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NextFI != FE &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Can&#39;t fallthrough past the last block.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Pre-merging due to unanalyzable fallthrough: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><Highlight kind="normal">                        &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(BB) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; -&gt; &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(NextBB)</Highlight></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><Highlight kind="normal">      <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>-&gt;merge(NextBB, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><Highlight kind="normal">      BlocksWithUnanalyzableExits.<a href="/docs/api/classes/llvm/smallvectorimpl/#a94d23373106467003722f7d6c17b1528">insert</a>(&amp;&#42;BB);</Highlight></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><Highlight kind="normal">      FI = NextFI;</Highlight></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><Highlight kind="normal">      BB = NextBB;</Highlight></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Build any loop-based chains.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><Highlight kind="normal">  PreferredLoopExit = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &#42;L : &#42;MLI)</Highlight></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><Highlight kind="normal">    buildLoopChains(&#42;L);</Highlight></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BlockWorkList.empty() &amp;&amp;</Highlight></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;BlockWorkList should be empty before building final chain.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EHPadWorkList.empty() &amp;&amp;</Highlight></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;EHPadWorkList should be empty before building final chain.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BlockChain &#42;, 4&gt;</a> UpdatedPreds;</Highlight></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</Highlight></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><Highlight kind="normal">    fillWorkLists(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, UpdatedPreds);</Highlight></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;FunctionChain = &#42;BlockToChain&#91;&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;front()&#93;;</Highlight></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><Highlight kind="normal">  buildChain(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;front(), FunctionChain);</Highlight></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal">FunctionBlockSetType = <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;MachineBasicBlock &#42;, 16&gt;</a>;</Highlight></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</Highlight></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Crash at the end so we get all of the debugging output first.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> BadFunc = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><Highlight kind="normal">    FunctionBlockSetType FunctionBlockSet;</Highlight></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</Highlight></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><Highlight kind="normal">      FunctionBlockSet.insert(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</Highlight></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ChainBB : FunctionChain)</Highlight></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!FunctionBlockSet.erase(ChainBB)) &#123;</Highlight></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><Highlight kind="normal">        BadFunc = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Function chain contains a block not in the function!\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  Bad block:    &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(ChainBB) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!FunctionBlockSet.empty()) &#123;</Highlight></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811"><Highlight kind="normal">      BadFunc = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;RemainingBB : FunctionBlockSet)</Highlight></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Function contains blocks never placed into a chain!\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  Bad block:    &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(RemainingBB) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!BadFunc &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Detected problems with the block placement.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remember original layout ordering, so we can update terminators after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reordering to point to the original layout successor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 4&gt;</a> OriginalLayoutSuccessors(</Highlight></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getNumBlockIDs());</Highlight></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><Highlight kind="normal">  &#123;</Highlight></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LastMBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LastMBB != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><Highlight kind="normal">        OriginalLayoutSuccessors&#91;LastMBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()&#93; = &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>;</Highlight></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><Highlight kind="normal">      LastMBB = &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>;</Highlight></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><Highlight kind="normal">    OriginalLayoutSuccessors&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;back().getNumber()&#93; = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Splice the blocks into place.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> InsertPos = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;begin();</Highlight></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;&#91;MBP&#93; Function: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ChainBB : FunctionChain) &#123;</Highlight></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; (ChainBB == &#42;FunctionChain.begin() ? </Highlight><Highlight kind="stringliteral">&quot;Placing chain &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><Highlight kind="normal">                                                            : </Highlight><Highlight kind="stringliteral">&quot;          ... &quot;</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><Highlight kind="normal">                      &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(ChainBB) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InsertPos != <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a>(ChainBB))</Highlight></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;splice(InsertPos, ChainBB);</Highlight></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><Highlight kind="normal">      ++InsertPos;</Highlight></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Update the terminator of the previous block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ChainBB == &#42;FunctionChain.begin())</Highlight></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;PrevBB = &amp;&#42;std::prev(<a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a>(ChainBB));</Highlight></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: It would be awesome of updateTerminator would just return rather</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// than assert when the branch cannot be analyzed in order to remove this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// boiler plate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>.clear();</Highlight></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, &#42;FBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// For analyzeBranch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BlocksWithUnanalyzableExits.count(PrevBB)) &#123;</Highlight></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Given the exact block placement we chose, we may actually not &#95;need&#95; to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// be able to edit PrevBB&#39;s terminator sequence, but not being &#95;able&#95; to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// do that at this point is a bug.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;analyzeBranch(&#42;PrevBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>) ||</Highlight></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><Highlight kind="normal">              !PrevBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a5ffb77c69d69a5beff906caaecfd7be4">canFallThrough</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Unexpected block with un-analyzable fallthrough!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>.clear();</Highlight></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> = FBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The &quot;PrevBB&quot; is not yet updated to reflect current code layout, so,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   o. it may fall-through to a block without explicit &quot;goto&quot; instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//      before layout, and no longer fall-through it after layout; or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   o. just opposite.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// analyzeBranch() may return erroneous value for FBB when these two</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// situations take place. For the first scenario FBB is mistakenly set NULL;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// for the 2nd scenario, the FBB, which is expected to be NULL, is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// mistakenly pointing to &quot;&#42;BI&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Thus, if the future change needs to use FBB before the layout is set, it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// has to correct FBB first by using the code similar to the following:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// if (!Cond.empty() &amp;&amp; (!FBB || FBB == ChainBB)) &#123;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   PrevBB-&gt;updateTerminator();</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   Cond.clear();</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   TBB = FBB = nullptr;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   if (TII-&gt;analyzeBranch(&#42;PrevBB, TBB, FBB, Cond)) &#123;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     // FIXME: This should never take place.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     TBB = FBB = nullptr;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   &#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;analyzeBranch(&#42;PrevBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) &#123;</Highlight></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><Highlight kind="normal">      PrevBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a5803a49facae20ca4b002dcba6f1d03e">updateTerminator</a>(OriginalLayoutSuccessors&#91;PrevBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()&#93;);</Highlight></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Fixup the last block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>.clear();</Highlight></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, &#42;FBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// For analyzeBranch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;analyzeBranch(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;back(), <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>)) &#123;</Highlight></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;PrevBB = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;back();</Highlight></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><Highlight kind="normal">    PrevBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a5803a49facae20ca4b002dcba6f1d03e">updateTerminator</a>(OriginalLayoutSuccessors&#91;PrevBB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()&#93;);</Highlight></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><Highlight kind="normal">  BlockWorkList.clear();</Highlight></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><Highlight kind="normal">  EHPadWorkList.clear();</Highlight></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::optimizeBranches() &#123;</Highlight></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;FunctionChain = &#42;BlockToChain&#91;&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;front()&#93;;</Highlight></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineOperand, 4&gt;</a> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>;</Highlight></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now that all the basic blocks in the chain have the proper layout,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// make a final call to analyzeBranch with AllowModify set.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Indeed, the target may be able to optimize the branches in a way we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cannot because all branches may not be analyzable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// E.g., the target may be able to remove an unconditional branch to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a fallthrough when it occurs after predicated terminators.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ChainBB : FunctionChain) &#123;</Highlight></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>.clear();</Highlight></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, &#42;FBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;analyzeBranch(&#42;ChainBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, </Highlight><Highlight kind="comment">/&#42;AllowModify&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">))</Highlight></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> || !FBB || <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>.empty())</Highlight></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we are optimizing for size we do not consider the runtime performance.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Instead, we retain the original branch condition so we have more uniform</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instructions which will benefit ICF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(ChainBB, PSI, MBFI.get()))</Highlight></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If ChainBB has a two-way branch, try to re-order the branches</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// such that we branch to the successor with higher probability first.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MBPI-&gt;getEdgeProbability(ChainBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>) &gt;=</Highlight></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><Highlight kind="normal">        MBPI-&gt;getEdgeProbability(ChainBB, FBB))</Highlight></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;reverseBranchCondition(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>))</Highlight></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Reverse order of the two branches: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937"><Highlight kind="normal">                      &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(ChainBB) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; &lt; &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(FBB)</Highlight></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Dl = ChainBB-&gt;findBranchDebugLoc();</Highlight></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;removeBranch(&#42;ChainBB);</Highlight></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;insertBranch(&#42;ChainBB, FBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, Dl);</Highlight></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::alignBlocks() &#123;</Highlight></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Walk through the backedges of the function now that we have fully laid out</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the basic blocks and align the destination of each backedge. We don&#39;t rely</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// exclusively on the loop info here so that we can align backedges in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// unnatural CFGs and backedges that were introduced purely because of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// loop rotations done during this layout pass.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a1f1e40c7ec4c37b42f76da67c75e638d">AlignAllBlock</a> &amp;&amp; !<a href="#a4dbf76303569b68b0d3719627c88e9fe">AlignAllNonFallThruBlocks</a>) &#123;</Highlight></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunction().hasMinSize() ||</Highlight></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><Highlight kind="normal">        (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunction().hasOptSize() &amp;&amp; !TLI-&gt;alignLoopsWithOptSize()))</Highlight></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;FunctionChain = &#42;BlockToChain&#91;&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;front()&#93;;</Highlight></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Empty chain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FunctionChain.begin() == FunctionChain.end())</Highlight></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> ColdProb(1, 5); </Highlight><Highlight kind="comment">// 20%</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> EntryFreq = MBFI-&gt;getBlockFreq(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;front());</Highlight></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> WeightedEntryFreq = EntryFreq &#42; ColdProb;</Highlight></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;ChainBB : FunctionChain) &#123;</Highlight></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ChainBB == &#42;FunctionChain.begin())</Highlight></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t align non-looping basic blocks. These are unlikely to execute</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// enough times to matter in practice. Note that we&#39;ll still handle</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// unnatural CFGs inside of a natural outer loop (the common case) and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// rotated loops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machineloop">MachineLoop</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a> = MLI-&gt;getLoopFor(ChainBB);</Highlight></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!L)</Highlight></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/align">Align</a> TLIAlign = TLI-&gt;getPrefLoopAlignment(L);</Highlight></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MDAlign = 1;</Highlight></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;LoopID = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getLoopID();</Highlight></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LoopID) &#123;</Highlight></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/mdoperand">MDOperand</a> &amp;MDO : <a href="/docs/api/namespaces/llvm/#a02981de53fb6ffd384d39addc4d25f37">llvm::drop&#95;begin</a>(LoopID-&gt;<a href="/docs/api/classes/llvm/mdnode/#a571612461ea4af620bc4c441d61579a3">operands</a>())) &#123;</Highlight></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;MD = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MDNode&gt;</a>(MDO);</Highlight></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MD == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/mdstring">MDString</a> &#42;S = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MDString&gt;</a>(MD-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(0));</Highlight></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (S == </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (S-&gt;<a href="/docs/api/classes/llvm/mdstring/#ae44259d9edd71181ea8b89d18f27a967">getString</a>() == </Highlight><Highlight kind="stringliteral">&quot;llvm.loop.align&quot;</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MD-&gt;<a href="/docs/api/classes/llvm/mdnode/#aa4068e37ec583962685e3567dc102ae5">getNumOperands</a>() == 2 &amp;&amp;</Highlight></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><Highlight kind="normal">                 </Highlight><Highlight kind="stringliteral">&quot;per-loop align metadata should have two operands.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"><Highlight kind="normal">          MDAlign =</Highlight></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/mdconst/#ad938857d6c6603847adf3a8cbe403d17">mdconst::extract&lt;ConstantInt&gt;</a>(MD-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(1))-&gt;getZExtValue();</Highlight></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MDAlign &gt;= 1 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;per-loop align value must be positive.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Use max of the TLIAlign and MDAlign</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/align">Align</a> LoopAlign = std::max(TLIAlign, <a href="/docs/api/structs/llvm/align">Align</a>(MDAlign));</Highlight></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LoopAlign == 1)</Highlight></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Don&#39;t care about loop alignment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the block is cold relative to the function entry don&#39;t waste space</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// aligning it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> Freq = MBFI-&gt;getBlockFreq(ChainBB);</Highlight></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Freq &lt; WeightedEntryFreq)</Highlight></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the block is cold relative to its loop header, don&#39;t align it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// regardless of what edges into the block exist.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopHeader = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>-&gt;getHeader();</Highlight></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> LoopHeaderFreq = MBFI-&gt;getBlockFreq(LoopHeader);</Highlight></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Freq &lt; (LoopHeaderFreq &#42; ColdProb))</Highlight></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the global profiles indicates so, don&#39;t align it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(ChainBB, PSI, MBFI.get()) &amp;&amp;</Highlight></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><Highlight kind="normal">        !TLI-&gt;alignLoopsWithOptSize())</Highlight></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check for the existence of a non-layout predecessor which would benefit</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// from aligning this block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LayoutPred =</Highlight></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><Highlight kind="normal">        &amp;&#42;std::prev(<a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a>(ChainBB));</Highlight></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> DetermineMaxAlignmentPadding = &#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Set the maximum bytes allowed to be emitted for alignment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxBytes;</Highlight></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a7713277c884a7bf39711c1c0d6cf9c26">MaxBytesForAlignmentOverride</a>.getNumOccurrences() &gt; 0)</Highlight></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"><Highlight kind="normal">        MaxBytes = <a href="#a7713277c884a7bf39711c1c0d6cf9c26">MaxBytesForAlignmentOverride</a>;</Highlight></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><Highlight kind="normal">        MaxBytes = TLI-&gt;getMaxPermittedBytesForAlignment(ChainBB);</Highlight></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><Highlight kind="normal">      ChainBB-&gt;setMaxBytesForAlignment(MaxBytes);</Highlight></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Force alignment if all the predecessors are jumps. We already checked</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// that the block isn&#39;t cold above.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LayoutPred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(ChainBB)) &#123;</Highlight></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><Highlight kind="normal">      ChainBB-&gt;setAlignment(LoopAlign);</Highlight></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"><Highlight kind="normal">      DetermineMaxAlignmentPadding();</Highlight></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03044" /><CodeLine lineNumber="3044"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03045" /><CodeLine lineNumber="3045"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Align this block if the layout predecessor&#39;s edge into this block is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03046" /><CodeLine lineNumber="3046"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// cold relative to the block. When this is true, other predecessors make up</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03047" /><CodeLine lineNumber="3047"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// all of the hot entries into the block and thus alignment is likely to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03048" /><CodeLine lineNumber="3048"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// important.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03049" /><CodeLine lineNumber="3049"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> LayoutProb =</Highlight></CodeLine>
<Link id="l03050" /><CodeLine lineNumber="3050"><Highlight kind="normal">        MBPI-&gt;getEdgeProbability(LayoutPred, ChainBB);</Highlight></CodeLine>
<Link id="l03051" /><CodeLine lineNumber="3051"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> LayoutEdgeFreq = MBFI-&gt;getBlockFreq(LayoutPred) &#42; LayoutProb;</Highlight></CodeLine>
<Link id="l03052" /><CodeLine lineNumber="3052"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LayoutEdgeFreq &lt;= (Freq &#42; ColdProb)) &#123;</Highlight></CodeLine>
<Link id="l03053" /><CodeLine lineNumber="3053"><Highlight kind="normal">      ChainBB-&gt;setAlignment(LoopAlign);</Highlight></CodeLine>
<Link id="l03054" /><CodeLine lineNumber="3054"><Highlight kind="normal">      DetermineMaxAlignmentPadding();</Highlight></CodeLine>
<Link id="l03055" /><CodeLine lineNumber="3055"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03056" /><CodeLine lineNumber="3056"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03057" /><CodeLine lineNumber="3057"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03058" /><CodeLine lineNumber="3058"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasMaxBytesOverride =</Highlight></CodeLine>
<Link id="l03059" /><CodeLine lineNumber="3059"><Highlight kind="normal">      <a href="#a7713277c884a7bf39711c1c0d6cf9c26">MaxBytesForAlignmentOverride</a>.getNumOccurrences() &gt; 0;</Highlight></CodeLine>
<Link id="l03060" /><CodeLine lineNumber="3060"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03061" /><CodeLine lineNumber="3061"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a1f1e40c7ec4c37b42f76da67c75e638d">AlignAllBlock</a>)</Highlight></CodeLine>
<Link id="l03062" /><CodeLine lineNumber="3062"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Align all of the blocks in the function to a specific alignment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03063" /><CodeLine lineNumber="3063"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l03064" /><CodeLine lineNumber="3064"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasMaxBytesOverride)</Highlight></CodeLine>
<Link id="l03065" /><CodeLine lineNumber="3065"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.setAlignment(<a href="/docs/api/structs/llvm/align">Align</a>(1ULL &lt;&lt; <a href="#a1f1e40c7ec4c37b42f76da67c75e638d">AlignAllBlock</a>),</Highlight></CodeLine>
<Link id="l03066" /><CodeLine lineNumber="3066"><Highlight kind="normal">                         <a href="#a7713277c884a7bf39711c1c0d6cf9c26">MaxBytesForAlignmentOverride</a>);</Highlight></CodeLine>
<Link id="l03067" /><CodeLine lineNumber="3067"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03068" /><CodeLine lineNumber="3068"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.setAlignment(<a href="/docs/api/structs/llvm/align">Align</a>(1ULL &lt;&lt; <a href="#a1f1e40c7ec4c37b42f76da67c75e638d">AlignAllBlock</a>));</Highlight></CodeLine>
<Link id="l03069" /><CodeLine lineNumber="3069"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03070" /><CodeLine lineNumber="3070"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a4dbf76303569b68b0d3719627c88e9fe">AlignAllNonFallThruBlocks</a>) &#123;</Highlight></CodeLine>
<Link id="l03071" /><CodeLine lineNumber="3071"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Align all of the blocks that have no fall-through predecessors to a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03072" /><CodeLine lineNumber="3072"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// specific alignment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03073" /><CodeLine lineNumber="3073"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MBI = std::next(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;begin()), MBE = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;end(); MBI != MBE; ++MBI) &#123;</Highlight></CodeLine>
<Link id="l03074" /><CodeLine lineNumber="3074"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> LayoutPred = std::prev(MBI);</Highlight></CodeLine>
<Link id="l03075" /><CodeLine lineNumber="3075"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LayoutPred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#adc8f1be4a77ae671ac139d5f06b44deb">isSuccessor</a>(&amp;&#42;MBI)) &#123;</Highlight></CodeLine>
<Link id="l03076" /><CodeLine lineNumber="3076"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasMaxBytesOverride)</Highlight></CodeLine>
<Link id="l03077" /><CodeLine lineNumber="3077"><Highlight kind="normal">          MBI-&gt;setAlignment(<a href="/docs/api/structs/llvm/align">Align</a>(1ULL &lt;&lt; <a href="#a4dbf76303569b68b0d3719627c88e9fe">AlignAllNonFallThruBlocks</a>),</Highlight></CodeLine>
<Link id="l03078" /><CodeLine lineNumber="3078"><Highlight kind="normal">                            <a href="#a7713277c884a7bf39711c1c0d6cf9c26">MaxBytesForAlignmentOverride</a>);</Highlight></CodeLine>
<Link id="l03079" /><CodeLine lineNumber="3079"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03080" /><CodeLine lineNumber="3080"><Highlight kind="normal">          MBI-&gt;setAlignment(<a href="/docs/api/structs/llvm/align">Align</a>(1ULL &lt;&lt; <a href="#a4dbf76303569b68b0d3719627c88e9fe">AlignAllNonFallThruBlocks</a>));</Highlight></CodeLine>
<Link id="l03081" /><CodeLine lineNumber="3081"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03082" /><CodeLine lineNumber="3082"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03083" /><CodeLine lineNumber="3083"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03084" /><CodeLine lineNumber="3084"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03085" /><CodeLine lineNumber="3085"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03086" /><CodeLine lineNumber="3086"><Highlight kind="comment">/// Tail duplicate \\p BB into (some) predecessors if profitable, repeating if</Highlight></CodeLine>
<Link id="l03087" /><CodeLine lineNumber="3087"><Highlight kind="comment">/// it was duplicated into its chain predecessor and removed.</Highlight></CodeLine>
<Link id="l03088" /><CodeLine lineNumber="3088"><Highlight kind="comment">/// \\p BB    - Basic block that may be duplicated.</Highlight></CodeLine>
<Link id="l03089" /><CodeLine lineNumber="3089"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l03090" /><CodeLine lineNumber="3090"><Highlight kind="comment">/// \\p LPred - Chosen layout predecessor of \\p BB.</Highlight></CodeLine>
<Link id="l03091" /><CodeLine lineNumber="3091"><Highlight kind="comment">///            Updated to be the chain end if LPred is removed.</Highlight></CodeLine>
<Link id="l03092" /><CodeLine lineNumber="3092"><Highlight kind="comment">/// \\p Chain - Chain to which \\p LPred belongs, and \\p BB will belong.</Highlight></CodeLine>
<Link id="l03093" /><CodeLine lineNumber="3093"><Highlight kind="comment">/// \\p BlockFilter - Set of blocks that belong to the loop being laid out.</Highlight></CodeLine>
<Link id="l03094" /><CodeLine lineNumber="3094"><Highlight kind="comment">///                  Used to identify which blocks to update predecessor</Highlight></CodeLine>
<Link id="l03095" /><CodeLine lineNumber="3095"><Highlight kind="comment">///                  counts.</Highlight></CodeLine>
<Link id="l03096" /><CodeLine lineNumber="3096"><Highlight kind="comment">/// \\p PrevUnplacedBlockIt - Iterator pointing to the last block that was</Highlight></CodeLine>
<Link id="l03097" /><CodeLine lineNumber="3097"><Highlight kind="comment">///                          chosen in the given order due to unnatural CFG</Highlight></CodeLine>
<Link id="l03098" /><CodeLine lineNumber="3098"><Highlight kind="comment">///                          only needed if \\p BB is removed and</Highlight></CodeLine>
<Link id="l03099" /><CodeLine lineNumber="3099"><Highlight kind="comment">///                          \\p PrevUnplacedBlockIt pointed to \\p BB.</Highlight></CodeLine>
<Link id="l03100" /><CodeLine lineNumber="3100"><Highlight kind="comment">/// @return true if \\p BB was removed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03101" /><CodeLine lineNumber="3101"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MachineBlockPlacement::repeatedlyTailDuplicateBlock(</Highlight></CodeLine>
<Link id="l03102" /><CodeLine lineNumber="3102"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;&amp;LPred,</Highlight></CodeLine>
<Link id="l03103" /><CodeLine lineNumber="3103"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LoopHeaderBB, <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l03104" /><CodeLine lineNumber="3104"><Highlight kind="normal">    BlockFilterSet &#42;BlockFilter, <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> &amp;PrevUnplacedBlockIt,</Highlight></CodeLine>
<Link id="l03105" /><CodeLine lineNumber="3105"><Highlight kind="normal">    BlockFilterSet::iterator &amp;PrevUnplacedBlockInFilterIt) &#123;</Highlight></CodeLine>
<Link id="l03106" /><CodeLine lineNumber="3106"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Removed, DuplicatedToLPred;</Highlight></CodeLine>
<Link id="l03107" /><CodeLine lineNumber="3107"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> DuplicatedToOriginalLPred;</Highlight></CodeLine>
<Link id="l03108" /><CodeLine lineNumber="3108"><Highlight kind="normal">  Removed = maybeTailDuplicateBlock(</Highlight></CodeLine>
<Link id="l03109" /><CodeLine lineNumber="3109"><Highlight kind="normal">      BB, LPred, Chain, BlockFilter, PrevUnplacedBlockIt,</Highlight></CodeLine>
<Link id="l03110" /><CodeLine lineNumber="3110"><Highlight kind="normal">      PrevUnplacedBlockInFilterIt, DuplicatedToLPred);</Highlight></CodeLine>
<Link id="l03111" /><CodeLine lineNumber="3111"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Removed)</Highlight></CodeLine>
<Link id="l03112" /><CodeLine lineNumber="3112"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03113" /><CodeLine lineNumber="3113"><Highlight kind="normal">  DuplicatedToOriginalLPred = DuplicatedToLPred;</Highlight></CodeLine>
<Link id="l03114" /><CodeLine lineNumber="3114"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iteratively try to duplicate again. It can happen that a block that is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03115" /><CodeLine lineNumber="3115"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// duplicated into is still small enough to be duplicated again.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03116" /><CodeLine lineNumber="3116"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// No need to call markBlockSuccessors in this case, as the blocks being</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03117" /><CodeLine lineNumber="3117"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// duplicated from here on are already scheduled.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03118" /><CodeLine lineNumber="3118"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (DuplicatedToLPred &amp;&amp; Removed) &#123;</Highlight></CodeLine>
<Link id="l03119" /><CodeLine lineNumber="3119"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;DupBB, &#42;DupPred;</Highlight></CodeLine>
<Link id="l03120" /><CodeLine lineNumber="3120"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The removal callback causes Chain.end() to be updated when a block is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03121" /><CodeLine lineNumber="3121"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// removed. On the first pass through the loop, the chain end should be the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03122" /><CodeLine lineNumber="3122"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// same as it was on function entry. On subsequent passes, because we are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03123" /><CodeLine lineNumber="3123"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// duplicating the block at the end of the chain, if it is removed the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03124" /><CodeLine lineNumber="3124"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// chain will have shrunk by one block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03125" /><CodeLine lineNumber="3125"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#aac2485344159ae07cfd3aa75113f50f5">BlockChain::iterator</a> ChainEnd = <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>();</Highlight></CodeLine>
<Link id="l03126" /><CodeLine lineNumber="3126"><Highlight kind="normal">    DupBB = &#42;(--ChainEnd);</Highlight></CodeLine>
<Link id="l03127" /><CodeLine lineNumber="3127"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Now try to duplicate again.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03128" /><CodeLine lineNumber="3128"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ChainEnd == <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>())</Highlight></CodeLine>
<Link id="l03129" /><CodeLine lineNumber="3129"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03130" /><CodeLine lineNumber="3130"><Highlight kind="normal">    DupPred = &#42;std::prev(ChainEnd);</Highlight></CodeLine>
<Link id="l03131" /><CodeLine lineNumber="3131"><Highlight kind="normal">    Removed = maybeTailDuplicateBlock(</Highlight></CodeLine>
<Link id="l03132" /><CodeLine lineNumber="3132"><Highlight kind="normal">        DupBB, DupPred, Chain, BlockFilter, PrevUnplacedBlockIt,</Highlight></CodeLine>
<Link id="l03133" /><CodeLine lineNumber="3133"><Highlight kind="normal">        PrevUnplacedBlockInFilterIt, DuplicatedToLPred);</Highlight></CodeLine>
<Link id="l03134" /><CodeLine lineNumber="3134"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03135" /><CodeLine lineNumber="3135"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If BB was duplicated into LPred, it is now scheduled. But because it was</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03136" /><CodeLine lineNumber="3136"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// removed, markChainSuccessors won&#39;t be called for its chain. Instead we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03137" /><CodeLine lineNumber="3137"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// call markBlockSuccessors for LPred to achieve the same effect. This must go</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03138" /><CodeLine lineNumber="3138"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// at the end because repeating the tail duplication can increase the number</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03139" /><CodeLine lineNumber="3139"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of unscheduled predecessors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03140" /><CodeLine lineNumber="3140"><Highlight kind="normal">  LPred = &#42;std::prev(<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</Highlight></CodeLine>
<Link id="l03141" /><CodeLine lineNumber="3141"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DuplicatedToOriginalLPred)</Highlight></CodeLine>
<Link id="l03142" /><CodeLine lineNumber="3142"><Highlight kind="normal">    markBlockSuccessors(Chain, LPred, LoopHeaderBB, BlockFilter);</Highlight></CodeLine>
<Link id="l03143" /><CodeLine lineNumber="3143"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03144" /><CodeLine lineNumber="3144"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03145" /><CodeLine lineNumber="3145"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03146" /><CodeLine lineNumber="3146"><Highlight kind="comment">/// Tail duplicate \\p BB into (some) predecessors if profitable.</Highlight></CodeLine>
<Link id="l03147" /><CodeLine lineNumber="3147"><Highlight kind="comment">/// \\p BB    - Basic block that may be duplicated</Highlight></CodeLine>
<Link id="l03148" /><CodeLine lineNumber="3148"><Highlight kind="comment">/// \\p LPred - Chosen layout predecessor of \\p BB</Highlight></CodeLine>
<Link id="l03149" /><CodeLine lineNumber="3149"><Highlight kind="comment">/// \\p Chain - Chain to which \\p LPred belongs, and \\p BB will belong.</Highlight></CodeLine>
<Link id="l03150" /><CodeLine lineNumber="3150"><Highlight kind="comment">/// \\p BlockFilter - Set of blocks that belong to the loop being laid out.</Highlight></CodeLine>
<Link id="l03151" /><CodeLine lineNumber="3151"><Highlight kind="comment">///                  Used to identify which blocks to update predecessor</Highlight></CodeLine>
<Link id="l03152" /><CodeLine lineNumber="3152"><Highlight kind="comment">///                  counts.</Highlight></CodeLine>
<Link id="l03153" /><CodeLine lineNumber="3153"><Highlight kind="comment">/// \\p PrevUnplacedBlockIt - Iterator pointing to the last block that was</Highlight></CodeLine>
<Link id="l03154" /><CodeLine lineNumber="3154"><Highlight kind="comment">///                          chosen in the given order due to unnatural CFG</Highlight></CodeLine>
<Link id="l03155" /><CodeLine lineNumber="3155"><Highlight kind="comment">///                          only needed if \\p BB is removed and</Highlight></CodeLine>
<Link id="l03156" /><CodeLine lineNumber="3156"><Highlight kind="comment">///                          \\p PrevUnplacedBlockIt pointed to \\p BB.</Highlight></CodeLine>
<Link id="l03157" /><CodeLine lineNumber="3157"><Highlight kind="comment">/// \\p DuplicatedToLPred - True if the block was duplicated into LPred.</Highlight></CodeLine>
<Link id="l03158" /><CodeLine lineNumber="3158"><Highlight kind="comment">/// \\return  - True if the block was duplicated into all preds and removed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03159" /><CodeLine lineNumber="3159"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MachineBlockPlacement::maybeTailDuplicateBlock(</Highlight></CodeLine>
<Link id="l03160" /><CodeLine lineNumber="3160"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;LPred, <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &amp;Chain,</Highlight></CodeLine>
<Link id="l03161" /><CodeLine lineNumber="3161"><Highlight kind="normal">    BlockFilterSet &#42;BlockFilter, <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> &amp;PrevUnplacedBlockIt,</Highlight></CodeLine>
<Link id="l03162" /><CodeLine lineNumber="3162"><Highlight kind="normal">    BlockFilterSet::iterator &amp;PrevUnplacedBlockInFilterIt,</Highlight></CodeLine>
<Link id="l03163" /><CodeLine lineNumber="3163"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &amp;DuplicatedToLPred) &#123;</Highlight></CodeLine>
<Link id="l03164" /><CodeLine lineNumber="3164"><Highlight kind="normal">  DuplicatedToLPred = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03165" /><CodeLine lineNumber="3165"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!shouldTailDuplicate(BB))</Highlight></CodeLine>
<Link id="l03166" /><CodeLine lineNumber="3166"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03167" /><CodeLine lineNumber="3167"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03168" /><CodeLine lineNumber="3168"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Redoing tail duplication for Succ#&quot;</Highlight><Highlight kind="normal"> &lt;&lt; BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a3aa22d521bd6a7e6b9f35545dc7b0f1e">getNumber</a>()</Highlight></CodeLine>
<Link id="l03169" /><CodeLine lineNumber="3169"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03170" /><CodeLine lineNumber="3170"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03171" /><CodeLine lineNumber="3171"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This has to be a callback because none of it can be done after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03172" /><CodeLine lineNumber="3172"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// BB is deleted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03173" /><CodeLine lineNumber="3173"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Removed = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03174" /><CodeLine lineNumber="3174"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> RemovalCallback = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;RemBB) &#123;</Highlight></CodeLine>
<Link id="l03175" /><CodeLine lineNumber="3175"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Signal to outer function</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03176" /><CodeLine lineNumber="3176"><Highlight kind="normal">    Removed = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03177" /><CodeLine lineNumber="3177"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03178" /><CodeLine lineNumber="3178"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Conservative default.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03179" /><CodeLine lineNumber="3179"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> InWorkList = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03180" /><CodeLine lineNumber="3180"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remove from the Chain and Chain Map</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03181" /><CodeLine lineNumber="3181"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> It = BlockToChain.find(RemBB); It != BlockToChain.end()) &#123;</Highlight></CodeLine>
<Link id="l03182" /><CodeLine lineNumber="3182"><Highlight kind="normal">      <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;<a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a> = It-&gt;second;</Highlight></CodeLine>
<Link id="l03183" /><CodeLine lineNumber="3183"><Highlight kind="normal">      InWorkList = <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>-&gt;UnscheduledPredecessors == 0;</Highlight></CodeLine>
<Link id="l03184" /><CodeLine lineNumber="3184"><Highlight kind="normal">      <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>-&gt;remove(RemBB);</Highlight></CodeLine>
<Link id="l03185" /><CodeLine lineNumber="3185"><Highlight kind="normal">      BlockToChain.<a href="/docs/api/classes/llvm/smallvectorimpl/#a563ffc2ff61c499b3be2e00100cb72fa">erase</a>(It);</Highlight></CodeLine>
<Link id="l03186" /><CodeLine lineNumber="3186"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03187" /><CodeLine lineNumber="3187"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03188" /><CodeLine lineNumber="3188"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Handle the unplaced block iterator</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03189" /><CodeLine lineNumber="3189"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&amp;(&#42;PrevUnplacedBlockIt) == RemBB) &#123;</Highlight></CodeLine>
<Link id="l03190" /><CodeLine lineNumber="3190"><Highlight kind="normal">      PrevUnplacedBlockIt++;</Highlight></CodeLine>
<Link id="l03191" /><CodeLine lineNumber="3191"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03192" /><CodeLine lineNumber="3192"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03193" /><CodeLine lineNumber="3193"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Handle the Work Lists</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03194" /><CodeLine lineNumber="3194"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InWorkList) &#123;</Highlight></CodeLine>
<Link id="l03195" /><CodeLine lineNumber="3195"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineBasicBlock &#42;&gt;</a> &amp;RemoveList = BlockWorkList;</Highlight></CodeLine>
<Link id="l03196" /><CodeLine lineNumber="3196"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RemBB-&gt;isEHPad())</Highlight></CodeLine>
<Link id="l03197" /><CodeLine lineNumber="3197"><Highlight kind="normal">        RemoveList = EHPadWorkList;</Highlight></CodeLine>
<Link id="l03198" /><CodeLine lineNumber="3198"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a60a348350395aef11d68f58111bcf499">llvm::erase</a>(RemoveList, RemBB);</Highlight></CodeLine>
<Link id="l03199" /><CodeLine lineNumber="3199"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03200" /><CodeLine lineNumber="3200"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03201" /><CodeLine lineNumber="3201"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Handle the filter set</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03202" /><CodeLine lineNumber="3202"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BlockFilter) &#123;</Highlight></CodeLine>
<Link id="l03203" /><CodeLine lineNumber="3203"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> It = <a href="/docs/api/namespaces/llvm/#a086e9fbdb06276db7753101a08a63adf">llvm::find</a>(&#42;BlockFilter, RemBB);</Highlight></CodeLine>
<Link id="l03204" /><CodeLine lineNumber="3204"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Erase RemBB from BlockFilter, and keep PrevUnplacedBlockInFilterIt</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03205" /><CodeLine lineNumber="3205"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// pointing to the same element as before.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03206" /><CodeLine lineNumber="3206"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It != BlockFilter-&gt;end()) &#123;</Highlight></CodeLine>
<Link id="l03207" /><CodeLine lineNumber="3207"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It &lt; PrevUnplacedBlockInFilterIt) &#123;</Highlight></CodeLine>
<Link id="l03208" /><CodeLine lineNumber="3208"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;PrevBB = &#42;PrevUnplacedBlockInFilterIt;</Highlight></CodeLine>
<Link id="l03209" /><CodeLine lineNumber="3209"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// BlockFilter is a SmallVector so all elements after RemBB are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03210" /><CodeLine lineNumber="3210"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// shifted to the front by 1 after its deletion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03211" /><CodeLine lineNumber="3211"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Distance = PrevUnplacedBlockInFilterIt - It - 1;</Highlight></CodeLine>
<Link id="l03212" /><CodeLine lineNumber="3212"><Highlight kind="normal">          PrevUnplacedBlockInFilterIt = BlockFilter-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad26bff839257f220557ce812b2159c72">erase</a>(It) + Distance;</Highlight></CodeLine>
<Link id="l03213" /><CodeLine lineNumber="3213"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(&#42;PrevUnplacedBlockInFilterIt == PrevBB);</Highlight></CodeLine>
<Link id="l03214" /><CodeLine lineNumber="3214"><Highlight kind="normal">          (void)PrevBB;</Highlight></CodeLine>
<Link id="l03215" /><CodeLine lineNumber="3215"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It == PrevUnplacedBlockInFilterIt)</Highlight></CodeLine>
<Link id="l03216" /><CodeLine lineNumber="3216"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// The block pointed by PrevUnplacedBlockInFilterIt is erased, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03217" /><CodeLine lineNumber="3217"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// have to set it to the next element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03218" /><CodeLine lineNumber="3218"><Highlight kind="normal">          PrevUnplacedBlockInFilterIt = BlockFilter-&gt;erase(It);</Highlight></CodeLine>
<Link id="l03219" /><CodeLine lineNumber="3219"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03220" /><CodeLine lineNumber="3220"><Highlight kind="normal">          BlockFilter-&gt;erase(It);</Highlight></CodeLine>
<Link id="l03221" /><CodeLine lineNumber="3221"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03222" /><CodeLine lineNumber="3222"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03223" /><CodeLine lineNumber="3223"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03224" /><CodeLine lineNumber="3224"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remove the block from loop info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03225" /><CodeLine lineNumber="3225"><Highlight kind="normal">    MLI-&gt;removeBlock(RemBB);</Highlight></CodeLine>
<Link id="l03226" /><CodeLine lineNumber="3226"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RemBB == PreferredLoopExit)</Highlight></CodeLine>
<Link id="l03227" /><CodeLine lineNumber="3227"><Highlight kind="normal">      PreferredLoopExit = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03228" /><CodeLine lineNumber="3228"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03229" /><CodeLine lineNumber="3229"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;TailDuplicator deleted block: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="#a8f9ee7f9ffc036496a8663335da175fa">getBlockName</a>(RemBB)</Highlight></CodeLine>
<Link id="l03230" /><CodeLine lineNumber="3230"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03231" /><CodeLine lineNumber="3231"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03232" /><CodeLine lineNumber="3232"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> RemovalCallbackRef =</Highlight></CodeLine>
<Link id="l03233" /><CodeLine lineNumber="3233"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/function-ref">function&#95;ref&lt;void(MachineBasicBlock &#42;)&gt;</a>(RemovalCallback);</Highlight></CodeLine>
<Link id="l03234" /><CodeLine lineNumber="3234"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03235" /><CodeLine lineNumber="3235"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 8&gt;</a> DuplicatedPreds;</Highlight></CodeLine>
<Link id="l03236" /><CodeLine lineNumber="3236"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsSimple = TailDup.isSimpleBB(BB);</Highlight></CodeLine>
<Link id="l03237" /><CodeLine lineNumber="3237"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 8&gt;</a> CandidatePreds;</Highlight></CodeLine>
<Link id="l03238" /><CodeLine lineNumber="3238"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineBasicBlock &#42;&gt;</a> &#42;CandidatePtr = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03239" /><CodeLine lineNumber="3239"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunction().hasProfileData()) &#123;</Highlight></CodeLine>
<Link id="l03240" /><CodeLine lineNumber="3240"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We can do partial duplication with precise profile information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03241" /><CodeLine lineNumber="3241"><Highlight kind="normal">    findDuplicateCandidates(CandidatePreds, BB, BlockFilter);</Highlight></CodeLine>
<Link id="l03242" /><CodeLine lineNumber="3242"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CandidatePreds.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 0)</Highlight></CodeLine>
<Link id="l03243" /><CodeLine lineNumber="3243"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03244" /><CodeLine lineNumber="3244"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CandidatePreds.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &lt; BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#a03936a9b37da541420049422204ab206">pred&#95;size</a>())</Highlight></CodeLine>
<Link id="l03245" /><CodeLine lineNumber="3245"><Highlight kind="normal">      CandidatePtr = &amp;CandidatePreds;</Highlight></CodeLine>
<Link id="l03246" /><CodeLine lineNumber="3246"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03247" /><CodeLine lineNumber="3247"><Highlight kind="normal">  TailDup.tailDuplicateAndUpdate(IsSimple, BB, LPred, &amp;DuplicatedPreds,</Highlight></CodeLine>
<Link id="l03248" /><CodeLine lineNumber="3248"><Highlight kind="normal">                                 &amp;RemovalCallbackRef, CandidatePtr);</Highlight></CodeLine>
<Link id="l03249" /><CodeLine lineNumber="3249"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03250" /><CodeLine lineNumber="3250"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update UnscheduledPredecessors to reflect tail-duplication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03251" /><CodeLine lineNumber="3251"><Highlight kind="normal">  DuplicatedToLPred = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03252" /><CodeLine lineNumber="3252"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred : DuplicatedPreds) &#123;</Highlight></CodeLine>
<Link id="l03253" /><CodeLine lineNumber="3253"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We&#39;re only looking for unscheduled predecessors that match the filter.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03254" /><CodeLine lineNumber="3254"><Highlight kind="normal">    <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;PredChain = BlockToChain&#91;Pred&#93;;</Highlight></CodeLine>
<Link id="l03255" /><CodeLine lineNumber="3255"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred == LPred)</Highlight></CodeLine>
<Link id="l03256" /><CodeLine lineNumber="3256"><Highlight kind="normal">      DuplicatedToLPred = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03257" /><CodeLine lineNumber="3257"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred == LPred || (BlockFilter &amp;&amp; !BlockFilter-&gt;count(Pred)) ||</Highlight></CodeLine>
<Link id="l03258" /><CodeLine lineNumber="3258"><Highlight kind="normal">        PredChain == &amp;Chain)</Highlight></CodeLine>
<Link id="l03259" /><CodeLine lineNumber="3259"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03260" /><CodeLine lineNumber="3260"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;NewSucc : Pred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>()) &#123;</Highlight></CodeLine>
<Link id="l03261" /><CodeLine lineNumber="3261"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BlockFilter &amp;&amp; !BlockFilter-&gt;count(NewSucc))</Highlight></CodeLine>
<Link id="l03262" /><CodeLine lineNumber="3262"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03263" /><CodeLine lineNumber="3263"><Highlight kind="normal">      <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;NewChain = BlockToChain&#91;NewSucc&#93;;</Highlight></CodeLine>
<Link id="l03264" /><CodeLine lineNumber="3264"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewChain != &amp;Chain &amp;&amp; NewChain != PredChain)</Highlight></CodeLine>
<Link id="l03265" /><CodeLine lineNumber="3265"><Highlight kind="normal">        NewChain-&gt;UnscheduledPredecessors++;</Highlight></CodeLine>
<Link id="l03266" /><CodeLine lineNumber="3266"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03267" /><CodeLine lineNumber="3267"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03268" /><CodeLine lineNumber="3268"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Removed;</Highlight></CodeLine>
<Link id="l03269" /><CodeLine lineNumber="3269"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03270" /><CodeLine lineNumber="3270"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03271" /><CodeLine lineNumber="3271"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Count the number of actual machine instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03272" /><CodeLine lineNumber="3272" lineLink="#ac20133598c564acc81e5abadc5a1d637"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> uint64&#95;t <a href="#ac20133598c564acc81e5abadc5a1d637">countMBBInstruction</a>(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</Highlight></CodeLine>
<Link id="l03273" /><CodeLine lineNumber="3273"><Highlight kind="normal">  uint64&#95;t <a href="/docs/api/files/lib/lib/codegen/dfapacketizer-cpp/#acc16edf21eddec420cd4b27adb3111c6">InstrCount</a> = 0;</Highlight></CodeLine>
<Link id="l03274" /><CodeLine lineNumber="3274"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machineinstr">MachineInstr</a> &amp;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a> : &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>) &#123;</Highlight></CodeLine>
<Link id="l03275" /><CodeLine lineNumber="3275"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isPHI() &amp;&amp; !<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/irtranslator-cpp/#abe44dfdea65b4f7e11e0a608ab708b76">MI</a>.isMetaInstruction())</Highlight></CodeLine>
<Link id="l03276" /><CodeLine lineNumber="3276"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/codegen/dfapacketizer-cpp/#acc16edf21eddec420cd4b27adb3111c6">InstrCount</a> += 1;</Highlight></CodeLine>
<Link id="l03277" /><CodeLine lineNumber="3277"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03278" /><CodeLine lineNumber="3278"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/codegen/dfapacketizer-cpp/#acc16edf21eddec420cd4b27adb3111c6">InstrCount</a>;</Highlight></CodeLine>
<Link id="l03279" /><CodeLine lineNumber="3279"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03280" /><CodeLine lineNumber="3280"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03281" /><CodeLine lineNumber="3281"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The size cost of duplication is the instruction size of the duplicated block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03282" /><CodeLine lineNumber="3282"><Highlight kind="normal"></Highlight><Highlight kind="comment">// So we should scale the threshold accordingly. But the instruction size is not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03283" /><CodeLine lineNumber="3283"><Highlight kind="normal"></Highlight><Highlight kind="comment">// available on all targets, so we use the number of instructions instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03284" /><CodeLine lineNumber="3284"><Highlight kind="normal"><a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> MachineBlockPlacement::scaleThreshold(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l03285" /><CodeLine lineNumber="3285"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(DupThreshold.getFrequency() &#42; <a href="#ac20133598c564acc81e5abadc5a1d637">countMBBInstruction</a>(BB));</Highlight></CodeLine>
<Link id="l03286" /><CodeLine lineNumber="3286"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03287" /><CodeLine lineNumber="3287"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03288" /><CodeLine lineNumber="3288"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Returns true if BB is Pred&#39;s best successor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03289" /><CodeLine lineNumber="3289"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MachineBlockPlacement::isBestSuccessor(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l03290" /><CodeLine lineNumber="3290"><Highlight kind="normal">                                            <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred,</Highlight></CodeLine>
<Link id="l03291" /><CodeLine lineNumber="3291"><Highlight kind="normal">                                            BlockFilterSet &#42;BlockFilter) &#123;</Highlight></CodeLine>
<Link id="l03292" /><CodeLine lineNumber="3292"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB == Pred)</Highlight></CodeLine>
<Link id="l03293" /><CodeLine lineNumber="3293"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03294" /><CodeLine lineNumber="3294"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BlockFilter &amp;&amp; !BlockFilter-&gt;count(Pred))</Highlight></CodeLine>
<Link id="l03295" /><CodeLine lineNumber="3295"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03296" /><CodeLine lineNumber="3296"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;PredChain = BlockToChain&#91;Pred&#93;;</Highlight></CodeLine>
<Link id="l03297" /><CodeLine lineNumber="3297"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PredChain &amp;&amp; (Pred != &#42;std::prev(PredChain-&gt;end())))</Highlight></CodeLine>
<Link id="l03298" /><CodeLine lineNumber="3298"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03299" /><CodeLine lineNumber="3299"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03300" /><CodeLine lineNumber="3300"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find the successor with largest probability excluding BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03301" /><CodeLine lineNumber="3301"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> BestProb = <a href="/docs/api/classes/llvm/branchprobability/#afd00958cba7080048a84cccfcef55d71">BranchProbability::getZero</a>();</Highlight></CodeLine>
<Link id="l03302" /><CodeLine lineNumber="3302"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : Pred-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>())</Highlight></CodeLine>
<Link id="l03303" /><CodeLine lineNumber="3303"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Succ != BB) &#123;</Highlight></CodeLine>
<Link id="l03304" /><CodeLine lineNumber="3304"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BlockFilter &amp;&amp; !BlockFilter-&gt;count(Succ))</Highlight></CodeLine>
<Link id="l03305" /><CodeLine lineNumber="3305"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03306" /><CodeLine lineNumber="3306"><Highlight kind="normal">      <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;SuccChain = BlockToChain&#91;Succ&#93;;</Highlight></CodeLine>
<Link id="l03307" /><CodeLine lineNumber="3307"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccChain &amp;&amp; (Succ != &#42;SuccChain-&gt;begin()))</Highlight></CodeLine>
<Link id="l03308" /><CodeLine lineNumber="3308"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03309" /><CodeLine lineNumber="3309"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> SuccProb = MBPI-&gt;getEdgeProbability(Pred, Succ);</Highlight></CodeLine>
<Link id="l03310" /><CodeLine lineNumber="3310"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccProb &gt; BestProb)</Highlight></CodeLine>
<Link id="l03311" /><CodeLine lineNumber="3311"><Highlight kind="normal">        BestProb = SuccProb;</Highlight></CodeLine>
<Link id="l03312" /><CodeLine lineNumber="3312"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03313" /><CodeLine lineNumber="3313"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03314" /><CodeLine lineNumber="3314"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> BBProb = MBPI-&gt;getEdgeProbability(Pred, BB);</Highlight></CodeLine>
<Link id="l03315" /><CodeLine lineNumber="3315"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BBProb &lt;= BestProb)</Highlight></CodeLine>
<Link id="l03316" /><CodeLine lineNumber="3316"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03317" /><CodeLine lineNumber="3317"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03318" /><CodeLine lineNumber="3318"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Compute the number of reduced taken branches if Pred falls through to BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03319" /><CodeLine lineNumber="3319"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instead of another successor. Then compare it with threshold.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03320" /><CodeLine lineNumber="3320"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> PredFreq = getBlockCountOrFrequency(Pred);</Highlight></CodeLine>
<Link id="l03321" /><CodeLine lineNumber="3321"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> Gain = PredFreq &#42; (BBProb - BestProb);</Highlight></CodeLine>
<Link id="l03322" /><CodeLine lineNumber="3322"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Gain &gt; scaleThreshold(BB);</Highlight></CodeLine>
<Link id="l03323" /><CodeLine lineNumber="3323"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03324" /><CodeLine lineNumber="3324"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03325" /><CodeLine lineNumber="3325"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Find out the predecessors of BB and BB can be beneficially duplicated into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03326" /><CodeLine lineNumber="3326"><Highlight kind="normal"></Highlight><Highlight kind="comment">// them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03327" /><CodeLine lineNumber="3327"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::findDuplicateCandidates(</Highlight></CodeLine>
<Link id="l03328" /><CodeLine lineNumber="3328"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;MachineBasicBlock &#42;&gt;</a> &amp;Candidates, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;BB,</Highlight></CodeLine>
<Link id="l03329" /><CodeLine lineNumber="3329"><Highlight kind="normal">    BlockFilterSet &#42;BlockFilter) &#123;</Highlight></CodeLine>
<Link id="l03330" /><CodeLine lineNumber="3330"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Fallthrough = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03331" /><CodeLine lineNumber="3331"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> DefaultBranchProb = <a href="/docs/api/classes/llvm/branchprobability/#afd00958cba7080048a84cccfcef55d71">BranchProbability::getZero</a>();</Highlight></CodeLine>
<Link id="l03332" /><CodeLine lineNumber="3332"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> BBDupThreshold(scaleThreshold(BB));</Highlight></CodeLine>
<Link id="l03333" /><CodeLine lineNumber="3333"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 8&gt;</a> Preds(BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#addd80df79ba902914c7d8a52e3896b79">predecessors</a>());</Highlight></CodeLine>
<Link id="l03334" /><CodeLine lineNumber="3334"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 8&gt;</a> Succs(BB-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#ad88ff1529541fb4e243cc8ed90b11131">successors</a>());</Highlight></CodeLine>
<Link id="l03335" /><CodeLine lineNumber="3335"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03336" /><CodeLine lineNumber="3336"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Sort for highest frequency.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03337" /><CodeLine lineNumber="3337"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CmpSucc = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</Highlight></CodeLine>
<Link id="l03338" /><CodeLine lineNumber="3338"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MBPI-&gt;getEdgeProbability(BB, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>) &gt; MBPI-&gt;getEdgeProbability(BB, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l03339" /><CodeLine lineNumber="3339"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03340" /><CodeLine lineNumber="3340"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CmpPred = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</Highlight></CodeLine>
<Link id="l03341" /><CodeLine lineNumber="3341"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MBFI-&gt;getBlockFreq(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>) &gt; MBFI-&gt;getBlockFreq(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l03342" /><CodeLine lineNumber="3342"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03343" /><CodeLine lineNumber="3343"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable&#95;sort</a>(Succs, CmpSucc);</Highlight></CodeLine>
<Link id="l03344" /><CodeLine lineNumber="3344"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a076f93c387f454f0db13d4bc7d4e7f9c">llvm::stable&#95;sort</a>(Preds, CmpPred);</Highlight></CodeLine>
<Link id="l03345" /><CodeLine lineNumber="3345"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03346" /><CodeLine lineNumber="3346"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SuccIt = Succs.begin();</Highlight></CodeLine>
<Link id="l03347" /><CodeLine lineNumber="3347"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccIt != Succs.end()) &#123;</Highlight></CodeLine>
<Link id="l03348" /><CodeLine lineNumber="3348"><Highlight kind="normal">    DefaultBranchProb = MBPI-&gt;getEdgeProbability(BB, &#42;SuccIt).<a href="/docs/api/classes/llvm/branchprobability/#aaee6034264d5d0782e5d1489360730d9">getCompl</a>();</Highlight></CodeLine>
<Link id="l03349" /><CodeLine lineNumber="3349"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03350" /><CodeLine lineNumber="3350"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03351" /><CodeLine lineNumber="3351"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For each predecessors of BB, compute the benefit of duplicating BB,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03352" /><CodeLine lineNumber="3352"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// if it is larger than the threshold, add it into Candidates.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03353" /><CodeLine lineNumber="3353"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03354" /><CodeLine lineNumber="3354"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we have following control flow.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03355" /><CodeLine lineNumber="3355"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03356" /><CodeLine lineNumber="3356"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     PB1 PB2 PB3 PB4</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03357" /><CodeLine lineNumber="3357"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//      \\   |  /    /\\</Highlight></CodeLine>
<Link id="l03358" /><CodeLine lineNumber="3358"><Highlight kind="comment">  //       \\  | /    /  \\</Highlight></CodeLine>
<Link id="l03359" /><CodeLine lineNumber="3359"><Highlight kind="comment">  //        \\ |/    /    \\</Highlight></CodeLine>
<Link id="l03360" /><CodeLine lineNumber="3360"><Highlight kind="comment">  //         BB----/     OB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03361" /><CodeLine lineNumber="3361"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//         /\\</Highlight></CodeLine>
<Link id="l03362" /><CodeLine lineNumber="3362"><Highlight kind="comment">  //        /  \\</Highlight></CodeLine>
<Link id="l03363" /><CodeLine lineNumber="3363"><Highlight kind="comment">  //      SB1 SB2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03364" /><CodeLine lineNumber="3364"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03365" /><CodeLine lineNumber="3365"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// And it can be partially duplicated as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03366" /><CodeLine lineNumber="3366"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03367" /><CodeLine lineNumber="3367"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   PB2+BB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03368" /><CodeLine lineNumber="3368"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//      |  PB1 PB3 PB4</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03369" /><CodeLine lineNumber="3369"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//      |   |  /    /\\</Highlight></CodeLine>
<Link id="l03370" /><CodeLine lineNumber="3370"><Highlight kind="comment">  //      |   | /    /  \\</Highlight></CodeLine>
<Link id="l03371" /><CodeLine lineNumber="3371"><Highlight kind="comment">  //      |   |/    /    \\</Highlight></CodeLine>
<Link id="l03372" /><CodeLine lineNumber="3372"><Highlight kind="comment">  //      |  BB----/     OB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03373" /><CodeLine lineNumber="3373"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//      |\\ /|</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03374" /><CodeLine lineNumber="3374"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//      | X |</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03375" /><CodeLine lineNumber="3375"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//      |/ \\|</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03376" /><CodeLine lineNumber="3376"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     SB2 SB1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03377" /><CodeLine lineNumber="3377"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03378" /><CodeLine lineNumber="3378"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The benefit of duplicating into a predecessor is defined as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03379" /><CodeLine lineNumber="3379"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//         Orig&#95;taken&#95;branch - Duplicated&#95;taken&#95;branch</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03380" /><CodeLine lineNumber="3380"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03381" /><CodeLine lineNumber="3381"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The Orig&#95;taken&#95;branch is computed with the assumption that predecessor</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03382" /><CodeLine lineNumber="3382"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// jumps to BB and the most possible successor is laid out after BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03383" /><CodeLine lineNumber="3383"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03384" /><CodeLine lineNumber="3384"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The Duplicated&#95;taken&#95;branch is computed with the assumption that BB is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03385" /><CodeLine lineNumber="3385"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// duplicated into PB, and one successor is layout after it (SB1 for PB1 and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03386" /><CodeLine lineNumber="3386"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// SB2 for PB2 in our case). If there is no available successor, the combined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03387" /><CodeLine lineNumber="3387"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block jumps to all BB&#39;s successor, like PB3 in this example.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03388" /><CodeLine lineNumber="3388"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03389" /><CodeLine lineNumber="3389"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If a predecessor has multiple successors, so BB can&#39;t be duplicated into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03390" /><CodeLine lineNumber="3390"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// it. But it can beneficially fall through to BB, and duplicate BB into other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03391" /><CodeLine lineNumber="3391"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// predecessors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03392" /><CodeLine lineNumber="3392"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Pred : Preds) &#123;</Highlight></CodeLine>
<Link id="l03393" /><CodeLine lineNumber="3393"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> PredFreq = getBlockCountOrFrequency(Pred);</Highlight></CodeLine>
<Link id="l03394" /><CodeLine lineNumber="3394"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03395" /><CodeLine lineNumber="3395"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TailDup.canTailDuplicate(BB, Pred)) &#123;</Highlight></CodeLine>
<Link id="l03396" /><CodeLine lineNumber="3396"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// BB can&#39;t be duplicated into Pred, but it is possible to be layout</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03397" /><CodeLine lineNumber="3397"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// below Pred.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03398" /><CodeLine lineNumber="3398"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Fallthrough &amp;&amp; isBestSuccessor(BB, Pred, BlockFilter)) &#123;</Highlight></CodeLine>
<Link id="l03399" /><CodeLine lineNumber="3399"><Highlight kind="normal">        Fallthrough = Pred;</Highlight></CodeLine>
<Link id="l03400" /><CodeLine lineNumber="3400"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccIt != Succs.end())</Highlight></CodeLine>
<Link id="l03401" /><CodeLine lineNumber="3401"><Highlight kind="normal">          SuccIt++;</Highlight></CodeLine>
<Link id="l03402" /><CodeLine lineNumber="3402"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03403" /><CodeLine lineNumber="3403"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03404" /><CodeLine lineNumber="3404"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03405" /><CodeLine lineNumber="3405"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03406" /><CodeLine lineNumber="3406"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> OrigCost = PredFreq + PredFreq &#42; DefaultBranchProb;</Highlight></CodeLine>
<Link id="l03407" /><CodeLine lineNumber="3407"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> DupCost;</Highlight></CodeLine>
<Link id="l03408" /><CodeLine lineNumber="3408"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccIt == Succs.end()) &#123;</Highlight></CodeLine>
<Link id="l03409" /><CodeLine lineNumber="3409"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Jump to all successors;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03410" /><CodeLine lineNumber="3410"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Succs.size() &gt; 0)</Highlight></CodeLine>
<Link id="l03411" /><CodeLine lineNumber="3411"><Highlight kind="normal">        DupCost += PredFreq;</Highlight></CodeLine>
<Link id="l03412" /><CodeLine lineNumber="3412"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03413" /><CodeLine lineNumber="3413"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Fallthrough to &#42;SuccIt, jump to all other successors;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03414" /><CodeLine lineNumber="3414"><Highlight kind="normal">      DupCost += PredFreq;</Highlight></CodeLine>
<Link id="l03415" /><CodeLine lineNumber="3415"><Highlight kind="normal">      DupCost -= PredFreq &#42; MBPI-&gt;getEdgeProbability(BB, &#42;SuccIt);</Highlight></CodeLine>
<Link id="l03416" /><CodeLine lineNumber="3416"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03417" /><CodeLine lineNumber="3417"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03418" /><CodeLine lineNumber="3418"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OrigCost &gt;= DupCost);</Highlight></CodeLine>
<Link id="l03419" /><CodeLine lineNumber="3419"><Highlight kind="normal">    OrigCost -= DupCost;</Highlight></CodeLine>
<Link id="l03420" /><CodeLine lineNumber="3420"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OrigCost &gt; BBDupThreshold) &#123;</Highlight></CodeLine>
<Link id="l03421" /><CodeLine lineNumber="3421"><Highlight kind="normal">      Candidates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Pred);</Highlight></CodeLine>
<Link id="l03422" /><CodeLine lineNumber="3422"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SuccIt != Succs.end())</Highlight></CodeLine>
<Link id="l03423" /><CodeLine lineNumber="3423"><Highlight kind="normal">        SuccIt++;</Highlight></CodeLine>
<Link id="l03424" /><CodeLine lineNumber="3424"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03425" /><CodeLine lineNumber="3425"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03426" /><CodeLine lineNumber="3426"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03427" /><CodeLine lineNumber="3427"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// No predecessors can optimally fallthrough to BB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03428" /><CodeLine lineNumber="3428"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// So we can change one duplication into fallthrough.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03429" /><CodeLine lineNumber="3429"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Fallthrough) &#123;</Highlight></CodeLine>
<Link id="l03430" /><CodeLine lineNumber="3430"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((Candidates.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &lt; Preds.size()) &amp;&amp; (Candidates.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &gt; 0)) &#123;</Highlight></CodeLine>
<Link id="l03431" /><CodeLine lineNumber="3431"><Highlight kind="normal">      Candidates&#91;0&#93; = Candidates.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#acd9e771a3296c6b24146955754620557">back</a>();</Highlight></CodeLine>
<Link id="l03432" /><CodeLine lineNumber="3432"><Highlight kind="normal">      Candidates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#ad97688dfe9cd802e2a0691cbe620218a">pop&#95;back</a>();</Highlight></CodeLine>
<Link id="l03433" /><CodeLine lineNumber="3433"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03434" /><CodeLine lineNumber="3434"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03435" /><CodeLine lineNumber="3435"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03436" /><CodeLine lineNumber="3436"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03437" /><CodeLine lineNumber="3437"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::initTailDupThreshold() &#123;</Highlight></CodeLine>
<Link id="l03438" /><CodeLine lineNumber="3438"><Highlight kind="normal">  DupThreshold = <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0);</Highlight></CodeLine>
<Link id="l03439" /><CodeLine lineNumber="3439"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunction().hasProfileData()) &#123;</Highlight></CodeLine>
<Link id="l03440" /><CodeLine lineNumber="3440"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We prefer to use prifile count.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03441" /><CodeLine lineNumber="3441"><Highlight kind="normal">    uint64&#95;t HotThreshold = PSI-&gt;getOrCompHotCountThreshold();</Highlight></CodeLine>
<Link id="l03442" /><CodeLine lineNumber="3442"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HotThreshold != <a href="/docs/api/files/include/include/llvm-c/datatypes-h/#a30654b4b67d97c42ca3f9b6052dda916">UINT64&#95;MAX</a>) &#123;</Highlight></CodeLine>
<Link id="l03443" /><CodeLine lineNumber="3443"><Highlight kind="normal">      UseProfileCount = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03444" /><CodeLine lineNumber="3444"><Highlight kind="normal">      DupThreshold =</Highlight></CodeLine>
<Link id="l03445" /><CodeLine lineNumber="3445"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(HotThreshold &#42; <a href="#a84dfb254ed1062bc06a43d2365974bd2">TailDupProfilePercentThreshold</a> / 100);</Highlight></CodeLine>
<Link id="l03446" /><CodeLine lineNumber="3446"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03447" /><CodeLine lineNumber="3447"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Profile count is not available, we can use block frequency instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03448" /><CodeLine lineNumber="3448"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> MaxFreq = <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(0);</Highlight></CodeLine>
<Link id="l03449" /><CodeLine lineNumber="3449"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l03450" /><CodeLine lineNumber="3450"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> Freq = MBFI-&gt;getBlockFreq(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</Highlight></CodeLine>
<Link id="l03451" /><CodeLine lineNumber="3451"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Freq &gt; MaxFreq)</Highlight></CodeLine>
<Link id="l03452" /><CodeLine lineNumber="3452"><Highlight kind="normal">          MaxFreq = Freq;</Highlight></CodeLine>
<Link id="l03453" /><CodeLine lineNumber="3453"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03454" /><CodeLine lineNumber="3454"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03455" /><CodeLine lineNumber="3455"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/branchprobability">BranchProbability</a> ThresholdProb(<a href="#a7344284dac6ba9b8e48d9be67c954bfc">TailDupPlacementPenalty</a>, 100);</Highlight></CodeLine>
<Link id="l03456" /><CodeLine lineNumber="3456"><Highlight kind="normal">      DupThreshold = <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a>(MaxFreq &#42; ThresholdProb);</Highlight></CodeLine>
<Link id="l03457" /><CodeLine lineNumber="3457"><Highlight kind="normal">      UseProfileCount = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03458" /><CodeLine lineNumber="3458"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03459" /><CodeLine lineNumber="3459"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03460" /><CodeLine lineNumber="3460"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03461" /><CodeLine lineNumber="3461"><Highlight kind="normal">  TailDupSize = <a href="#a707021480bba6c165b873f9e238859c5">TailDupPlacementThreshold</a>;</Highlight></CodeLine>
<Link id="l03462" /><CodeLine lineNumber="3462"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If only the aggressive threshold is explicitly set, use it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03463" /><CodeLine lineNumber="3463"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#adc8acb8291add6a055468711f701e78d">TailDupPlacementAggressiveThreshold</a>.getNumOccurrences() != 0 &amp;&amp;</Highlight></CodeLine>
<Link id="l03464" /><CodeLine lineNumber="3464"><Highlight kind="normal">      <a href="#a707021480bba6c165b873f9e238859c5">TailDupPlacementThreshold</a>.getNumOccurrences() == 0)</Highlight></CodeLine>
<Link id="l03465" /><CodeLine lineNumber="3465"><Highlight kind="normal">    TailDupSize = <a href="#adc8acb8291add6a055468711f701e78d">TailDupPlacementAggressiveThreshold</a>;</Highlight></CodeLine>
<Link id="l03466" /><CodeLine lineNumber="3466"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03467" /><CodeLine lineNumber="3467"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For aggressive optimization, we can adjust some thresholds to be less</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03468" /><CodeLine lineNumber="3468"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// conservative.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03469" /><CodeLine lineNumber="3469"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PassConfig-&gt;getOptLevel() &gt;= <a href="/docs/api/namespaces/llvm/#a8ec1bf8d7b792ca9fac56f8514db18d2a389a96d0d9b3feb46b8c9d941566a4ae">CodeGenOptLevel::Aggressive</a>) &#123;</Highlight></CodeLine>
<Link id="l03470" /><CodeLine lineNumber="3470"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// At O3 we should be more willing to copy blocks for tail duplication. This</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03471" /><CodeLine lineNumber="3471"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// increases size pressure, so we only do it at O3</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03472" /><CodeLine lineNumber="3472"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Do this unless only the regular threshold is explicitly set.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03473" /><CodeLine lineNumber="3473"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a707021480bba6c165b873f9e238859c5">TailDupPlacementThreshold</a>.getNumOccurrences() == 0 ||</Highlight></CodeLine>
<Link id="l03474" /><CodeLine lineNumber="3474"><Highlight kind="normal">        <a href="#adc8acb8291add6a055468711f701e78d">TailDupPlacementAggressiveThreshold</a>.getNumOccurrences() != 0)</Highlight></CodeLine>
<Link id="l03475" /><CodeLine lineNumber="3475"><Highlight kind="normal">      TailDupSize = <a href="#adc8acb8291add6a055468711f701e78d">TailDupPlacementAggressiveThreshold</a>;</Highlight></CodeLine>
<Link id="l03476" /><CodeLine lineNumber="3476"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03477" /><CodeLine lineNumber="3477"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03478" /><CodeLine lineNumber="3478"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there&#39;s no threshold provided through options, query the target</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03479" /><CodeLine lineNumber="3479"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// information for a threshold instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03480" /><CodeLine lineNumber="3480"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a707021480bba6c165b873f9e238859c5">TailDupPlacementThreshold</a>.getNumOccurrences() == 0 &amp;&amp;</Highlight></CodeLine>
<Link id="l03481" /><CodeLine lineNumber="3481"><Highlight kind="normal">      (PassConfig-&gt;getOptLevel() &lt; <a href="/docs/api/namespaces/llvm/#a8ec1bf8d7b792ca9fac56f8514db18d2a389a96d0d9b3feb46b8c9d941566a4ae">CodeGenOptLevel::Aggressive</a> ||</Highlight></CodeLine>
<Link id="l03482" /><CodeLine lineNumber="3482"><Highlight kind="normal">       <a href="#adc8acb8291add6a055468711f701e78d">TailDupPlacementAggressiveThreshold</a>.getNumOccurrences() == 0))</Highlight></CodeLine>
<Link id="l03483" /><CodeLine lineNumber="3483"><Highlight kind="normal">    TailDupSize = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;getTailDuplicateSize(PassConfig-&gt;getOptLevel());</Highlight></CodeLine>
<Link id="l03484" /><CodeLine lineNumber="3484"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03485" /><CodeLine lineNumber="3485"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03486" /><CodeLine lineNumber="3486" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#a1f0291b83febf5c94491d76bf5236799"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#a1f0291b83febf5c94491d76bf5236799">MachineBlockPlacement::runOnMachineFunction</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;MF) &#123;</Highlight></CodeLine>
<Link id="l03487" /><CodeLine lineNumber="3487"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/functionpass/#af9f5f511d75e16f09a5520cb9444cfa8">skipFunction</a>(MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>()))</Highlight></CodeLine>
<Link id="l03488" /><CodeLine lineNumber="3488"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03489" /><CodeLine lineNumber="3489"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03490" /><CodeLine lineNumber="3490"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check for single-block functions and skip them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03491" /><CodeLine lineNumber="3491"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (std::next(MF.<a href="/docs/api/classes/llvm/machinefunction/#ab0789854909cf47f640a85fa2bac29c7">begin</a>()) == MF.<a href="/docs/api/classes/llvm/machinefunction/#a9d017af749f76484cb9aec9ff6e4330c">end</a>())</Highlight></CodeLine>
<Link id="l03492" /><CodeLine lineNumber="3492"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03493" /><CodeLine lineNumber="3493"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03494" /><CodeLine lineNumber="3494"><Highlight kind="normal">  F = &amp;MF;</Highlight></CodeLine>
<Link id="l03495" /><CodeLine lineNumber="3495"><Highlight kind="normal">  MBPI = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;MachineBranchProbabilityInfoWrapperPass&gt;</a>().getMBPI();</Highlight></CodeLine>
<Link id="l03496" /><CodeLine lineNumber="3496"><Highlight kind="normal">  MBFI = std::make&#95;unique&lt;MBFIWrapper&gt;(</Highlight></CodeLine>
<Link id="l03497" /><CodeLine lineNumber="3497"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;MachineBlockFrequencyInfoWrapperPass&gt;</a>().getMBFI());</Highlight></CodeLine>
<Link id="l03498" /><CodeLine lineNumber="3498"><Highlight kind="normal">  MLI = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;MachineLoopInfoWrapperPass&gt;</a>().getLI();</Highlight></CodeLine>
<Link id="l03499" /><CodeLine lineNumber="3499"><Highlight kind="normal">  TII = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>().<a href="/docs/api/classes/llvm/targetsubtargetinfo/#acd858ed72f11db9444617740c3622608">getInstrInfo</a>();</Highlight></CodeLine>
<Link id="l03500" /><CodeLine lineNumber="3500"><Highlight kind="normal">  TLI = MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>().<a href="/docs/api/classes/llvm/targetsubtargetinfo/#ade3f0d8b35d67c43df9425bb730a9a7c">getTargetLowering</a>();</Highlight></CodeLine>
<Link id="l03501" /><CodeLine lineNumber="3501"><Highlight kind="normal">  MPDT = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03502" /><CodeLine lineNumber="3502"><Highlight kind="normal">  PSI = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;ProfileSummaryInfoWrapperPass&gt;</a>().getPSI();</Highlight></CodeLine>
<Link id="l03503" /><CodeLine lineNumber="3503"><Highlight kind="normal">  PassConfig = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;TargetPassConfig&gt;</a>();</Highlight></CodeLine>
<Link id="l03504" /><CodeLine lineNumber="3504"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03505" /><CodeLine lineNumber="3505"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Initialize PreferredLoopExit to nullptr here since it may never be set if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03506" /><CodeLine lineNumber="3506"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// there are no MachineLoops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03507" /><CodeLine lineNumber="3507"><Highlight kind="normal">  PreferredLoopExit = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03508" /><CodeLine lineNumber="3508"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03509" /><CodeLine lineNumber="3509"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BlockToChain.empty() &amp;&amp;</Highlight></CodeLine>
<Link id="l03510" /><CodeLine lineNumber="3510"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;BlockToChain map should be empty before starting placement.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03511" /><CodeLine lineNumber="3511"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ComputedEdges.empty() &amp;&amp;</Highlight></CodeLine>
<Link id="l03512" /><CodeLine lineNumber="3512"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Computed Edge map should be empty before starting placement.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03513" /><CodeLine lineNumber="3513"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03514" /><CodeLine lineNumber="3514"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Initialize tail duplication thresholds.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03515" /><CodeLine lineNumber="3515"><Highlight kind="normal">  initTailDupThreshold();</Highlight></CodeLine>
<Link id="l03516" /><CodeLine lineNumber="3516"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03517" /><CodeLine lineNumber="3517"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> OptForSize =</Highlight></CodeLine>
<Link id="l03518" /><CodeLine lineNumber="3518"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(&amp;MF, PSI, &amp;MBFI-&gt;getMBFI());</Highlight></CodeLine>
<Link id="l03519" /><CodeLine lineNumber="3519"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Determine whether to use ext-tsp for perf/size optimization. The method</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03520" /><CodeLine lineNumber="3520"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is beneficial only for instances with at least 3 basic blocks and it can be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03521" /><CodeLine lineNumber="3521"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// disabled for huge functions (exceeding a certain size).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03522" /><CodeLine lineNumber="3522"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> UseExtTspForPerf = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03523" /><CodeLine lineNumber="3523"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> UseExtTspForSize = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03524" /><CodeLine lineNumber="3524"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (3 &lt;= MF.<a href="/docs/api/classes/llvm/machinefunction/#a7d2ce2106f9f7cf8f45c7c3c116ef43d">size</a>() &amp;&amp; MF.<a href="/docs/api/classes/llvm/machinefunction/#a7d2ce2106f9f7cf8f45c7c3c116ef43d">size</a>() &lt;= <a href="#a1160412b923427430e8bf4c819d79a93">ExtTspBlockPlacementMaxBlocks</a>) &#123;</Highlight></CodeLine>
<Link id="l03525" /><CodeLine lineNumber="3525"><Highlight kind="normal">    UseExtTspForPerf =</Highlight></CodeLine>
<Link id="l03526" /><CodeLine lineNumber="3526"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ae4599fe5d1385154f1bfbc41a10495c5">EnableExtTspBlockPlacement</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l03527" /><CodeLine lineNumber="3527"><Highlight kind="normal">        (<a href="/docs/api/namespaces/llvm/#a2dee051dfc0746e4fbf6e26175ece121">ApplyExtTspWithoutProfile</a> || MF.<a href="/docs/api/classes/llvm/machinefunction/#a977ddce262de45c645be23d951066351">getFunction</a>().<a href="/docs/api/files/lib/lib/transforms/lib/transforms/ipo/partialinlining-cpp/#a8884a3765a9cdbc730400587d4a3192c">hasProfileData</a>());</Highlight></CodeLine>
<Link id="l03528" /><CodeLine lineNumber="3528"><Highlight kind="normal">    UseExtTspForSize = OptForSize &amp;&amp; <a href="#a956f6faccd85fe2a75302e0ac3ecc606">ApplyExtTspForSize</a>;</Highlight></CodeLine>
<Link id="l03529" /><CodeLine lineNumber="3529"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03530" /><CodeLine lineNumber="3530"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03531" /><CodeLine lineNumber="3531"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Apply tail duplication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03532" /><CodeLine lineNumber="3532"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacement/#ad65badde897b7d4f51fc7c545538a388">allowTailDupPlacement</a>()) &#123;</Highlight></CodeLine>
<Link id="l03533" /><CodeLine lineNumber="3533"><Highlight kind="normal">    MPDT = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;MachinePostDominatorTreeWrapperPass&gt;</a>().getPostDomTree();</Highlight></CodeLine>
<Link id="l03534" /><CodeLine lineNumber="3534"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OptForSize)</Highlight></CodeLine>
<Link id="l03535" /><CodeLine lineNumber="3535"><Highlight kind="normal">      TailDupSize = 1;</Highlight></CodeLine>
<Link id="l03536" /><CodeLine lineNumber="3536"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> PreRegAlloc = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03537" /><CodeLine lineNumber="3537"><Highlight kind="normal">    TailDup.initMF(MF, PreRegAlloc, MBPI, MBFI.get(), PSI,</Highlight></CodeLine>
<Link id="l03538" /><CodeLine lineNumber="3538"><Highlight kind="normal">                   </Highlight><Highlight kind="comment">/&#42; LayoutMode &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, TailDupSize);</Highlight></CodeLine>
<Link id="l03539" /><CodeLine lineNumber="3539"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UseExtTspForSize)</Highlight></CodeLine>
<Link id="l03540" /><CodeLine lineNumber="3540"><Highlight kind="normal">      precomputeTriangleChains();</Highlight></CodeLine>
<Link id="l03541" /><CodeLine lineNumber="3541"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03542" /><CodeLine lineNumber="3542"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03543" /><CodeLine lineNumber="3543"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Run the main block placement.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03544" /><CodeLine lineNumber="3544"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UseExtTspForSize)</Highlight></CodeLine>
<Link id="l03545" /><CodeLine lineNumber="3545"><Highlight kind="normal">    buildCFGChains();</Highlight></CodeLine>
<Link id="l03546" /><CodeLine lineNumber="3546"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03547" /><CodeLine lineNumber="3547"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Changing the layout can create new tail merging opportunities.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03548" /><CodeLine lineNumber="3548"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TailMerge can create jump into if branches that make CFG irreducible for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03549" /><CodeLine lineNumber="3549"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// HW that requires structured CFG.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03550" /><CodeLine lineNumber="3550"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> EnableTailMerge = !MF.<a href="/docs/api/classes/llvm/machinefunction/#af777ff93c9e07a6ff5ffe3226deb3e76">getTarget</a>().<a href="/docs/api/classes/llvm/targetmachine/#aa276e49983e93afa359ec83ad71ccadc">requiresStructuredCFG</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l03551" /><CodeLine lineNumber="3551"><Highlight kind="normal">                               PassConfig-&gt;getEnableTailMerge() &amp;&amp;</Highlight></CodeLine>
<Link id="l03552" /><CodeLine lineNumber="3552"><Highlight kind="normal">                               <a href="#a84ae0b35deb4cbcffc27c3d52a781fca">BranchFoldPlacement</a> &amp;&amp; MF.<a href="/docs/api/classes/llvm/machinefunction/#a7d2ce2106f9f7cf8f45c7c3c116ef43d">size</a>() &gt; 3;</Highlight></CodeLine>
<Link id="l03553" /><CodeLine lineNumber="3553"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// No tail merging opportunities if the block number is less than four.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03554" /><CodeLine lineNumber="3554"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EnableTailMerge) &#123;</Highlight></CodeLine>
<Link id="l03555" /><CodeLine lineNumber="3555"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp/#a73423bf857429f170a6355ae20e1d798">TailMergeSize</a> = TailDupSize + 1;</Highlight></CodeLine>
<Link id="l03556" /><CodeLine lineNumber="3556"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchfolder">BranchFolder</a> BF(</Highlight><Highlight kind="comment">/&#42;DefaultEnableTailMerge=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="comment">/&#42;CommonHoist=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03557" /><CodeLine lineNumber="3557"><Highlight kind="normal">                    &#42;MBFI, &#42;MBPI, PSI, <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp/#a73423bf857429f170a6355ae20e1d798">TailMergeSize</a>);</Highlight></CodeLine>
<Link id="l03558" /><CodeLine lineNumber="3558"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03559" /><CodeLine lineNumber="3559"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BF.<a href="/docs/api/classes/llvm/branchfolder/#aa0d50fee4d0d41ccf591e29de109786f">OptimizeFunction</a>(MF, TII, MF.<a href="/docs/api/classes/llvm/machinefunction/#a3825368aca2bc1550d173660df4da6a6">getSubtarget</a>().<a href="/docs/api/classes/llvm/targetsubtargetinfo/#a43c530c830206ecf5ad3359364634c75">getRegisterInfo</a>(), MLI,</Highlight></CodeLine>
<Link id="l03560" /><CodeLine lineNumber="3560"><Highlight kind="normal">                            </Highlight><Highlight kind="comment">/&#42;AfterPlacement=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">)) &#123;</Highlight></CodeLine>
<Link id="l03561" /><CodeLine lineNumber="3561"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Must redo the post-dominator tree if blocks were changed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03562" /><CodeLine lineNumber="3562"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MPDT)</Highlight></CodeLine>
<Link id="l03563" /><CodeLine lineNumber="3563"><Highlight kind="normal">        MPDT-&gt;recalculate(MF);</Highlight></CodeLine>
<Link id="l03564" /><CodeLine lineNumber="3564"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UseExtTspForSize) &#123;</Highlight></CodeLine>
<Link id="l03565" /><CodeLine lineNumber="3565"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Redo the layout if tail merging creates/removes/moves blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03566" /><CodeLine lineNumber="3566"><Highlight kind="normal">        BlockToChain.clear();</Highlight></CodeLine>
<Link id="l03567" /><CodeLine lineNumber="3567"><Highlight kind="normal">        ComputedEdges.clear();</Highlight></CodeLine>
<Link id="l03568" /><CodeLine lineNumber="3568"><Highlight kind="normal">        ChainAllocator.DestroyAll();</Highlight></CodeLine>
<Link id="l03569" /><CodeLine lineNumber="3569"><Highlight kind="normal">        buildCFGChains();</Highlight></CodeLine>
<Link id="l03570" /><CodeLine lineNumber="3570"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03571" /><CodeLine lineNumber="3571"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03572" /><CodeLine lineNumber="3572"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03573" /><CodeLine lineNumber="3573"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03574" /><CodeLine lineNumber="3574"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Apply a post-processing optimizing block placement:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03575" /><CodeLine lineNumber="3575"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// - find a new placement and modify the layout of the blocks in the function;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03576" /><CodeLine lineNumber="3576"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// - re-create CFG chains so that we can optimizeBranches and alignBlocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03577" /><CodeLine lineNumber="3577"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UseExtTspForPerf || UseExtTspForSize) &#123;</Highlight></CodeLine>
<Link id="l03578" /><CodeLine lineNumber="3578"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l03579" /><CodeLine lineNumber="3579"><Highlight kind="normal">        !(UseExtTspForPerf &amp;&amp; UseExtTspForSize) &amp;&amp;</Highlight></CodeLine>
<Link id="l03580" /><CodeLine lineNumber="3580"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;UseExtTspForPerf and UseExtTspForSize can not be set simultaneously&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03581" /><CodeLine lineNumber="3581"><Highlight kind="normal">    applyExtTsp(</Highlight><Highlight kind="comment">/&#42;OptForSize=&#42;/</Highlight><Highlight kind="normal">UseExtTspForSize);</Highlight></CodeLine>
<Link id="l03582" /><CodeLine lineNumber="3582"><Highlight kind="normal">    createCFGChainExtTsp();</Highlight></CodeLine>
<Link id="l03583" /><CodeLine lineNumber="3583"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03584" /><CodeLine lineNumber="3584"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03585" /><CodeLine lineNumber="3585"><Highlight kind="normal">  optimizeBranches();</Highlight></CodeLine>
<Link id="l03586" /><CodeLine lineNumber="3586"><Highlight kind="normal">  alignBlocks();</Highlight></CodeLine>
<Link id="l03587" /><CodeLine lineNumber="3587"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03588" /><CodeLine lineNumber="3588"><Highlight kind="normal">  BlockToChain.clear();</Highlight></CodeLine>
<Link id="l03589" /><CodeLine lineNumber="3589"><Highlight kind="normal">  ComputedEdges.clear();</Highlight></CodeLine>
<Link id="l03590" /><CodeLine lineNumber="3590"><Highlight kind="normal">  ChainAllocator.DestroyAll();</Highlight></CodeLine>
<Link id="l03591" /><CodeLine lineNumber="3591"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03592" /><CodeLine lineNumber="3592"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// View the function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03593" /><CodeLine lineNumber="3593"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a7cc8a419725f3a9ce1d23c2db21ea143">ViewBlockLayoutWithBFI</a> != <a href="/docs/api/namespaces/llvm/#af0bf055834b973decc2477a8061624ffa49315903a2559d882f356ae28a455556">GVDT&#95;None</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l03594" /><CodeLine lineNumber="3594"><Highlight kind="normal">      (<a href="/docs/api/namespaces/llvm/#a6391a34afa5b4ed1a5e556a8cc4d971b">ViewBlockFreqFuncName</a>.empty() ||</Highlight></CodeLine>
<Link id="l03595" /><CodeLine lineNumber="3595"><Highlight kind="normal">       F-&gt;getFunction().getName() == <a href="/docs/api/namespaces/llvm/#a6391a34afa5b4ed1a5e556a8cc4d971b">ViewBlockFreqFuncName</a>)) &#123;</Highlight></CodeLine>
<Link id="l03596" /><CodeLine lineNumber="3596"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#ad1fed248fc2af534bd094b35c9f0c64b">RenumberBlocksBeforeView</a>)</Highlight></CodeLine>
<Link id="l03597" /><CodeLine lineNumber="3597"><Highlight kind="normal">      MF.<a href="/docs/api/classes/llvm/machinefunction/#ac85349aab432e6b7d8b2e8926048a6de">RenumberBlocks</a>();</Highlight></CodeLine>
<Link id="l03598" /><CodeLine lineNumber="3598"><Highlight kind="normal">    MBFI-&gt;view(</Highlight><Highlight kind="stringliteral">&quot;MBP.&quot;</Highlight><Highlight kind="normal"> + MF.<a href="/docs/api/classes/llvm/machinefunction/#a3d142c9e7c066059e15232c56dec9e2e">getName</a>(), </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03599" /><CodeLine lineNumber="3599"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03600" /><CodeLine lineNumber="3600"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03601" /><CodeLine lineNumber="3601"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We always return true as we have no way to track whether the final order</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03602" /><CodeLine lineNumber="3602"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// differs from the original order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03603" /><CodeLine lineNumber="3603"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03604" /><CodeLine lineNumber="3604"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03605" /><CodeLine lineNumber="3605"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03606" /><CodeLine lineNumber="3606"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::applyExtTsp(</Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> OptForSize) &#123;</Highlight></CodeLine>
<Link id="l03607" /><CodeLine lineNumber="3607"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Prepare data; blocks are indexed by their index in the current ordering.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03608" /><CodeLine lineNumber="3608"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MachineBasicBlock &#42;, uint64&#95;t&gt;</a> BlockIndex;</Highlight></CodeLine>
<Link id="l03609" /><CodeLine lineNumber="3609"><Highlight kind="normal">  BlockIndex.<a href="/docs/api/classes/llvm/densemapbase/#ae292a4b96e7f74eb95a4176ddba7b821">reserve</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;size());</Highlight></CodeLine>
<Link id="l03610" /><CodeLine lineNumber="3610"><Highlight kind="normal">  std::vector&lt;const MachineBasicBlock &#42;&gt; CurrentBlockOrder;</Highlight></CodeLine>
<Link id="l03611" /><CodeLine lineNumber="3611"><Highlight kind="normal">  CurrentBlockOrder.reserve(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;size());</Highlight></CodeLine>
<Link id="l03612" /><CodeLine lineNumber="3612"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">size&#95;t</Highlight><Highlight kind="normal"> NumBlocks = 0;</Highlight></CodeLine>
<Link id="l03613" /><CodeLine lineNumber="3613"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l03614" /><CodeLine lineNumber="3614"><Highlight kind="normal">    BlockIndex&#91;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93; = NumBlocks++;</Highlight></CodeLine>
<Link id="l03615" /><CodeLine lineNumber="3615"><Highlight kind="normal">    CurrentBlockOrder.push&#95;back(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</Highlight></CodeLine>
<Link id="l03616" /><CodeLine lineNumber="3616"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03617" /><CodeLine lineNumber="3617"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03618" /><CodeLine lineNumber="3618"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint64&#95;t, 0&gt;</a> BlockCounts(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;size());</Highlight></CodeLine>
<Link id="l03619" /><CodeLine lineNumber="3619"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;uint64&#95;t, 0&gt;</a> BlockSizes(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;size());</Highlight></CodeLine>
<Link id="l03620" /><CodeLine lineNumber="3620"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;codelayout::EdgeCount, 0&gt;</a> JumpCounts;</Highlight></CodeLine>
<Link id="l03621" /><CodeLine lineNumber="3621"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineOperand, 4&gt;</a> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>; </Highlight><Highlight kind="comment">// For analyzeBranch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03622" /><CodeLine lineNumber="3622"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const MachineBasicBlock &#42;, 4&gt;</a> Succs;</Highlight></CodeLine>
<Link id="l03623" /><CodeLine lineNumber="3623"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l03624" /><CodeLine lineNumber="3624"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Getting the block frequency.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03625" /><CodeLine lineNumber="3625"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> BlockFreq = MBFI-&gt;getBlockFreq(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</Highlight></CodeLine>
<Link id="l03626" /><CodeLine lineNumber="3626"><Highlight kind="normal">    BlockCounts&#91;BlockIndex&#91;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93;&#93; = OptForSize ? 1 : BlockFreq.<a href="/docs/api/classes/llvm/blockfrequency/#a8e9ed6b20c2503f66f1fd0725297aedc">getFrequency</a>();</Highlight></CodeLine>
<Link id="l03627" /><CodeLine lineNumber="3627"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Getting the block size:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03628" /><CodeLine lineNumber="3628"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// - approximate the size of an instruction by 4 bytes, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03629" /><CodeLine lineNumber="3629"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// - ignore debug instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03630" /><CodeLine lineNumber="3630"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Note: getting the exact size of each block is target-dependent and can be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03631" /><CodeLine lineNumber="3631"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// done by extending the interface of MCCodeEmitter. Experimentally we do</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03632" /><CodeLine lineNumber="3632"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// not see a perf improvement with the exact block sizes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03633" /><CodeLine lineNumber="3633"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NonDbgInsts =</Highlight></CodeLine>
<Link id="l03634" /><CodeLine lineNumber="3634"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a90f68a1fc5d44bb06164dc2188b8e486">instructionsWithoutDebug</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.instr&#95;begin(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.instr&#95;end());</Highlight></CodeLine>
<Link id="l03635" /><CodeLine lineNumber="3635"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">size&#95;t</Highlight><Highlight kind="normal"> NumInsts = std::distance(NonDbgInsts.begin(), NonDbgInsts.end());</Highlight></CodeLine>
<Link id="l03636" /><CodeLine lineNumber="3636"><Highlight kind="normal">    BlockSizes&#91;BlockIndex&#91;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93;&#93; = 4 &#42; NumInsts;</Highlight></CodeLine>
<Link id="l03637" /><CodeLine lineNumber="3637"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03638" /><CodeLine lineNumber="3638"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Getting jump frequencies.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03639" /><CodeLine lineNumber="3639"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OptForSize) &#123;</Highlight></CodeLine>
<Link id="l03640" /><CodeLine lineNumber="3640"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>.clear();</Highlight></CodeLine>
<Link id="l03641" /><CodeLine lineNumber="3641"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, &#42;FBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// For analyzeBranch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03642" /><CodeLine lineNumber="3642"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;analyzeBranch(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>))</Highlight></CodeLine>
<Link id="l03643" /><CodeLine lineNumber="3643"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03644" /><CodeLine lineNumber="3644"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03645" /><CodeLine lineNumber="3645"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;FTB = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getFallThrough();</Highlight></CodeLine>
<Link id="l03646" /><CodeLine lineNumber="3646"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Succs is a collection of distinct destinations of the block reachable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03647" /><CodeLine lineNumber="3647"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// from MBB via a jump instruction; initialize the list using the three</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03648" /><CodeLine lineNumber="3648"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// (non-necessarily distinct) blocks, FTB, TBB, and FBB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03649" /><CodeLine lineNumber="3649"><Highlight kind="normal">      Succs.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</Highlight></CodeLine>
<Link id="l03650" /><CodeLine lineNumber="3650"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> != FTB)</Highlight></CodeLine>
<Link id="l03651" /><CodeLine lineNumber="3651"><Highlight kind="normal">        Succs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>);</Highlight></CodeLine>
<Link id="l03652" /><CodeLine lineNumber="3652"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FBB &amp;&amp; FBB != FTB)</Highlight></CodeLine>
<Link id="l03653" /><CodeLine lineNumber="3653"><Highlight kind="normal">        Succs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FBB);</Highlight></CodeLine>
<Link id="l03654" /><CodeLine lineNumber="3654"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FTB)</Highlight></CodeLine>
<Link id="l03655" /><CodeLine lineNumber="3655"><Highlight kind="normal">        Succs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FTB);</Highlight></CodeLine>
<Link id="l03656" /><CodeLine lineNumber="3656"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Absolute magnitude of non-zero counts does not matter for the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03657" /><CodeLine lineNumber="3657"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// optimization; prioritize slightly jumps with a single successor, since</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03658" /><CodeLine lineNumber="3658"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the corresponding jump instruction will be removed from the binary.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03659" /><CodeLine lineNumber="3659"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> uint64&#95;t Freq = Succs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() == 1 ? 110 : 100;</Highlight></CodeLine>
<Link id="l03660" /><CodeLine lineNumber="3660"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : Succs)</Highlight></CodeLine>
<Link id="l03661" /><CodeLine lineNumber="3661"><Highlight kind="normal">        JumpCounts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&#123;BlockIndex&#91;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93;, BlockIndex&#91;Succ&#93;, Freq&#125;);</Highlight></CodeLine>
<Link id="l03662" /><CodeLine lineNumber="3662"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03663" /><CodeLine lineNumber="3663"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.successors()) &#123;</Highlight></CodeLine>
<Link id="l03664" /><CodeLine lineNumber="3664"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> EP = MBPI-&gt;getEdgeProbability(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, Succ);</Highlight></CodeLine>
<Link id="l03665" /><CodeLine lineNumber="3665"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> JumpFreq = BlockFreq &#42; EP;</Highlight></CodeLine>
<Link id="l03666" /><CodeLine lineNumber="3666"><Highlight kind="normal">        JumpCounts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</Highlight></CodeLine>
<Link id="l03667" /><CodeLine lineNumber="3667"><Highlight kind="normal">            &#123;BlockIndex&#91;&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93;, BlockIndex&#91;Succ&#93;, JumpFreq.<a href="/docs/api/classes/llvm/blockfrequency/#a8e9ed6b20c2503f66f1fd0725297aedc">getFrequency</a>()&#125;);</Highlight></CodeLine>
<Link id="l03668" /><CodeLine lineNumber="3668"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03669" /><CodeLine lineNumber="3669"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03670" /><CodeLine lineNumber="3670"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03671" /><CodeLine lineNumber="3671"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03672" /><CodeLine lineNumber="3672"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Applying ext-tsp layout for |V| = &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;size()</Highlight></CodeLine>
<Link id="l03673" /><CodeLine lineNumber="3673"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; with profile = &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunction().hasProfileData()</Highlight></CodeLine>
<Link id="l03674" /><CodeLine lineNumber="3674"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; (&quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;)&quot;</Highlight><Highlight kind="normal"> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03675" /><CodeLine lineNumber="3675"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03676" /><CodeLine lineNumber="3676"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">double</Highlight><Highlight kind="normal"> OrgScore = <a href="/docs/api/namespaces/llvm/codelayout/#a70c3cab5f18ff0a00d4ad43ec3287021">calcExtTspScore</a>(BlockSizes, JumpCounts);</Highlight></CodeLine>
<Link id="l03677" /><CodeLine lineNumber="3677"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/namespaces/llvm/#a939bc2108d47080767f0c06ba56caec7">format</a>(</Highlight><Highlight kind="stringliteral">&quot;  original  layout score: %0.2f\\n&quot;</Highlight><Highlight kind="normal">, OrgScore));</Highlight></CodeLine>
<Link id="l03678" /><CodeLine lineNumber="3678"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03679" /><CodeLine lineNumber="3679"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Run the layout algorithm.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03680" /><CodeLine lineNumber="3680"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NewOrder = <a href="/docs/api/namespaces/llvm/codelayout/#ab265fb35ca9607f01d99dae7a386ef77">computeExtTspLayout</a>(BlockSizes, BlockCounts, JumpCounts);</Highlight></CodeLine>
<Link id="l03681" /><CodeLine lineNumber="3681"><Highlight kind="normal">  std::vector&lt;const MachineBasicBlock &#42;&gt; NewBlockOrder;</Highlight></CodeLine>
<Link id="l03682" /><CodeLine lineNumber="3682"><Highlight kind="normal">  NewBlockOrder.reserve(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;size());</Highlight></CodeLine>
<Link id="l03683" /><CodeLine lineNumber="3683"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (uint64&#95;t <a href="/docs/api/classes/node">Node</a> : NewOrder) &#123;</Highlight></CodeLine>
<Link id="l03684" /><CodeLine lineNumber="3684"><Highlight kind="normal">    NewBlockOrder.push&#95;back(CurrentBlockOrder&#91;<a href="/docs/api/classes/node">Node</a>&#93;);</Highlight></CodeLine>
<Link id="l03685" /><CodeLine lineNumber="3685"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03686" /><CodeLine lineNumber="3686"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">double</Highlight><Highlight kind="normal"> OptScore = <a href="/docs/api/namespaces/llvm/codelayout/#a70c3cab5f18ff0a00d4ad43ec3287021">calcExtTspScore</a>(NewOrder, BlockSizes, JumpCounts);</Highlight></CodeLine>
<Link id="l03687" /><CodeLine lineNumber="3687"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/namespaces/llvm/#a939bc2108d47080767f0c06ba56caec7">format</a>(</Highlight><Highlight kind="stringliteral">&quot;  optimized layout score: %0.2f\\n&quot;</Highlight><Highlight kind="normal">, OptScore));</Highlight></CodeLine>
<Link id="l03688" /><CodeLine lineNumber="3688"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03689" /><CodeLine lineNumber="3689"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the optimization is unsuccessful, fall back to the original block order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03690" /><CodeLine lineNumber="3690"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OptForSize &amp;&amp; OrgScore &gt; OptScore)</Highlight></CodeLine>
<Link id="l03691" /><CodeLine lineNumber="3691"><Highlight kind="normal">    assignBlockOrder(CurrentBlockOrder);</Highlight></CodeLine>
<Link id="l03692" /><CodeLine lineNumber="3692"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03693" /><CodeLine lineNumber="3693"><Highlight kind="normal">    assignBlockOrder(NewBlockOrder);</Highlight></CodeLine>
<Link id="l03694" /><CodeLine lineNumber="3694"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03695" /><CodeLine lineNumber="3695"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03696" /><CodeLine lineNumber="3696"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::assignBlockOrder(</Highlight></CodeLine>
<Link id="l03697" /><CodeLine lineNumber="3697"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::vector&lt;const MachineBasicBlock &#42;&gt; &amp;NewBlockOrder) &#123;</Highlight></CodeLine>
<Link id="l03698" /><CodeLine lineNumber="3698"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;size() == NewBlockOrder.size() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Incorrect size of block order&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03699" /><CodeLine lineNumber="3699"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;RenumberBlocks();</Highlight></CodeLine>
<Link id="l03700" /><CodeLine lineNumber="3700"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// At this point, we possibly removed blocks from the function, so we can&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03701" /><CodeLine lineNumber="3701"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// renumber the domtree. At this point, we don&#39;t need it anymore, though.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03702" /><CodeLine lineNumber="3702"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: move this to the point where the dominator tree is actually</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03703" /><CodeLine lineNumber="3703"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// invalidated (i.e., where blocks are removed without updating the domtree).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03704" /><CodeLine lineNumber="3704"><Highlight kind="normal">  MPDT = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03705" /><CodeLine lineNumber="3705"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03706" /><CodeLine lineNumber="3706"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasChanges = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03707" /><CodeLine lineNumber="3707"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">size&#95;t</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NewBlockOrder.size(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) &#123;</Highlight></CodeLine>
<Link id="l03708" /><CodeLine lineNumber="3708"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewBlockOrder&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; != <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getBlockNumbered(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l03709" /><CodeLine lineNumber="3709"><Highlight kind="normal">      HasChanges = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03710" /><CodeLine lineNumber="3710"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03711" /><CodeLine lineNumber="3711"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03712" /><CodeLine lineNumber="3712"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03713" /><CodeLine lineNumber="3713"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Stop early if the new block order is identical to the existing one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03714" /><CodeLine lineNumber="3714"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!HasChanges)</Highlight></CodeLine>
<Link id="l03715" /><CodeLine lineNumber="3715"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03716" /><CodeLine lineNumber="3716"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03717" /><CodeLine lineNumber="3717"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineBasicBlock &#42;, 4&gt;</a> PrevFallThroughs(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getNumBlockIDs());</Highlight></CodeLine>
<Link id="l03718" /><CodeLine lineNumber="3718"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l03719" /><CodeLine lineNumber="3719"><Highlight kind="normal">    PrevFallThroughs&#91;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getNumber()&#93; = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getFallThrough();</Highlight></CodeLine>
<Link id="l03720" /><CodeLine lineNumber="3720"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03721" /><CodeLine lineNumber="3721"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03722" /><CodeLine lineNumber="3722"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Sort basic blocks in the function according to the computed order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03723" /><CodeLine lineNumber="3723"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MachineBasicBlock &#42;, size&#95;t&gt;</a> NewIndex;</Highlight></CodeLine>
<Link id="l03724" /><CodeLine lineNumber="3724"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : NewBlockOrder) &#123;</Highlight></CodeLine>
<Link id="l03725" /><CodeLine lineNumber="3725"><Highlight kind="normal">    NewIndex&#91;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>&#93; = NewIndex.<a href="/docs/api/classes/llvm/densemapbase/#a3d95cc2d359b8d9ed5bd9504b44930b5">size</a>();</Highlight></CodeLine>
<Link id="l03726" /><CodeLine lineNumber="3726"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03727" /><CodeLine lineNumber="3727"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;sort(&#91;&amp;&#93;(<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;L, <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;R) &#123;</Highlight></CodeLine>
<Link id="l03728" /><CodeLine lineNumber="3728"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NewIndex&#91;&amp;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ead20caec3b48a1eef164cb4ca81ba2587">L</a>&#93; &lt; NewIndex&#91;&amp;<a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>&#93;;</Highlight></CodeLine>
<Link id="l03729" /><CodeLine lineNumber="3729"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l03730" /><CodeLine lineNumber="3730"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03731" /><CodeLine lineNumber="3731"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update basic block branches by inserting explicit fallthrough branches</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03732" /><CodeLine lineNumber="3732"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// when required and re-optimize branches when possible.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03733" /><CodeLine lineNumber="3733"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetinstrinfo">TargetInstrInfo</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getSubtarget().getInstrInfo();</Highlight></CodeLine>
<Link id="l03734" /><CodeLine lineNumber="3734"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;MachineOperand, 4&gt;</a> <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>;</Highlight></CodeLine>
<Link id="l03735" /><CodeLine lineNumber="3735"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l03736" /><CodeLine lineNumber="3736"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> NextMBB = std::next(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getIterator());</Highlight></CodeLine>
<Link id="l03737" /><CodeLine lineNumber="3737"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinefunction/#aaba82c71ffdca966cad10eae0992fff9">MachineFunction::iterator</a> EndIt = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getParent()-&gt;end();</Highlight></CodeLine>
<Link id="l03738" /><CodeLine lineNumber="3738"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;FTMBB = PrevFallThroughs&#91;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.getNumber()&#93;;</Highlight></CodeLine>
<Link id="l03739" /><CodeLine lineNumber="3739"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this block had a fallthrough before we need an explicit unconditional</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03740" /><CodeLine lineNumber="3740"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// branch to that block if the fallthrough block is not adjacent to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03741" /><CodeLine lineNumber="3741"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// block in the new order.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03742" /><CodeLine lineNumber="3742"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FTMBB &amp;&amp; (NextMBB == EndIt || &amp;&#42;NextMBB != FTMBB)) &#123;</Highlight></CodeLine>
<Link id="l03743" /><CodeLine lineNumber="3743"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;insertUnconditionalBranch(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, FTMBB, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.findBranchDebugLoc());</Highlight></CodeLine>
<Link id="l03744" /><CodeLine lineNumber="3744"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03745" /><CodeLine lineNumber="3745"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03746" /><CodeLine lineNumber="3746"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// It might be possible to optimize branches by flipping the condition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03747" /><CodeLine lineNumber="3747"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>.clear();</Highlight></CodeLine>
<Link id="l03748" /><CodeLine lineNumber="3748"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, &#42;FBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03749" /><CodeLine lineNumber="3749"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncopytocombine-cpp/#a1d40004718218dbdf06b496766299101">TII</a>-&gt;analyzeBranch(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a1441f79530bc7f3a89118bb8067eac69">TBB</a>, FBB, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>))</Highlight></CodeLine>
<Link id="l03750" /><CodeLine lineNumber="3750"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03751" /><CodeLine lineNumber="3751"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.updateTerminator(FTMBB);</Highlight></CodeLine>
<Link id="l03752" /><CodeLine lineNumber="3752"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03753" /><CodeLine lineNumber="3753"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03754" /><CodeLine lineNumber="3754"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03755" /><CodeLine lineNumber="3755"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> MachineBlockPlacement::createCFGChainExtTsp() &#123;</Highlight></CodeLine>
<Link id="l03756" /><CodeLine lineNumber="3756"><Highlight kind="normal">  BlockToChain.clear();</Highlight></CodeLine>
<Link id="l03757" /><CodeLine lineNumber="3757"><Highlight kind="normal">  ComputedEdges.clear();</Highlight></CodeLine>
<Link id="l03758" /><CodeLine lineNumber="3758"><Highlight kind="normal">  ChainAllocator.DestroyAll();</Highlight></CodeLine>
<Link id="l03759" /><CodeLine lineNumber="3759"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03760" /><CodeLine lineNumber="3760"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;HeadBB = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;front();</Highlight></CodeLine>
<Link id="l03761" /><CodeLine lineNumber="3761"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a> &#42;FunctionChain =</Highlight></CodeLine>
<Link id="l03762" /><CodeLine lineNumber="3762"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> (ChainAllocator.Allocate()) <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/blockchain/#ab486c9a0a0c5124ad4709ca49b910ec9">BlockChain</a>(BlockToChain, HeadBB);</Highlight></CodeLine>
<Link id="l03763" /><CodeLine lineNumber="3763"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03764" /><CodeLine lineNumber="3764"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l03765" /><CodeLine lineNumber="3765"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HeadBB == &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>)</Highlight></CodeLine>
<Link id="l03766" /><CodeLine lineNumber="3766"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// Ignore head of the chain</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03767" /><CodeLine lineNumber="3767"><Highlight kind="normal">    FunctionChain-&gt;merge(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03768" /><CodeLine lineNumber="3768"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03769" /><CodeLine lineNumber="3769"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03770" /><CodeLine lineNumber="3770"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03771" /><CodeLine lineNumber="3771"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03772" /><CodeLine lineNumber="3772"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03773" /><CodeLine lineNumber="3773"><Highlight kind="comment">/// A pass to compute block placement statistics.</Highlight></CodeLine>
<Link id="l03774" /><CodeLine lineNumber="3774"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l03775" /><CodeLine lineNumber="3775"><Highlight kind="comment">/// A separate pass to compute interesting statistics for evaluating block</Highlight></CodeLine>
<Link id="l03776" /><CodeLine lineNumber="3776"><Highlight kind="comment">/// placement. This is separate from the actual placement pass so that they can</Highlight></CodeLine>
<Link id="l03777" /><CodeLine lineNumber="3777"><Highlight kind="comment">/// be computed in the absence of any placement transformations or when using</Highlight></CodeLine>
<Link id="l03778" /><CodeLine lineNumber="3778"><Highlight kind="comment">/// alternative placement strategies.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03779" /><CodeLine lineNumber="3779" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#ab048335b4f8ed04dfd6d34baa1881a9c">MachineBlockPlacementStats</a> : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a> &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03780" /><CodeLine lineNumber="3780"><Highlight kind="comment">  /// A handle to the branch probability pass.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03781" /><CodeLine lineNumber="3781"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machinebranchprobabilityinfo">MachineBranchProbabilityInfo</a> &#42;MBPI;</Highlight></CodeLine>
<Link id="l03782" /><CodeLine lineNumber="3782"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l03783" /><CodeLine lineNumber="3783"><Highlight kind="comment">  /// A handle to the function-wide block frequency pass.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03784" /><CodeLine lineNumber="3784"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/machineblockfrequencyinfo">MachineBlockFrequencyInfo</a> &#42;MBFI;</Highlight></CodeLine>
<Link id="l03785" /><CodeLine lineNumber="3785"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03786" /><CodeLine lineNumber="3786"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l03787" /><CodeLine lineNumber="3787" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#abe0ba94dc7c9cf225a968cb9f3fc5043"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#abe0ba94dc7c9cf225a968cb9f3fc5043">ID</a>; </Highlight><Highlight kind="comment">// Pass identification, replacement for typeid</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03788" /><CodeLine lineNumber="3788"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03789" /><CodeLine lineNumber="3789" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#ab048335b4f8ed04dfd6d34baa1881a9c"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#ab048335b4f8ed04dfd6d34baa1881a9c">MachineBlockPlacementStats</a>() : <a href="/docs/api/classes/llvm/machinefunctionpass/#a29c81d2386f4a727c6d33413807530c8">MachineFunctionPass</a>(<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#abe0ba94dc7c9cf225a968cb9f3fc5043">ID</a>) &#123;</Highlight></CodeLine>
<Link id="l03790" /><CodeLine lineNumber="3790"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a44d0c54f06e770c47e8d36af9f09b4af">initializeMachineBlockPlacementStatsPass</a>(&#42;<a href="/docs/api/classes/llvm/passregistry/#a05a729900b76c89e808c6c3094921b2f">PassRegistry::getPassRegistry</a>());</Highlight></CodeLine>
<Link id="l03791" /><CodeLine lineNumber="3791"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03792" /><CodeLine lineNumber="3792"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03793" /><CodeLine lineNumber="3793"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> runOnMachineFunction(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) </Highlight><Highlight kind="keyword">override</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03794" /><CodeLine lineNumber="3794"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03795" /><CodeLine lineNumber="3795" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#af6fdd4aa0d9c5af936fea8be657b7c7a"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#af6fdd4aa0d9c5af936fea8be657b7c7a">getAnalysisUsage</a>(<a href="/docs/api/classes/llvm/analysisusage">AnalysisUsage</a> &amp;AU)</Highlight><Highlight kind="keyword"> const override </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03796" /><CodeLine lineNumber="3796"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machinebranchprobabilityinfowrapperpass">MachineBranchProbabilityInfoWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l03797" /><CodeLine lineNumber="3797"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#ae0adcccca08fb686c9ce00f9397b660c">addRequired</a>&lt;<a href="/docs/api/classes/llvm/machineblockfrequencyinfowrapperpass">MachineBlockFrequencyInfoWrapperPass</a>&gt;();</Highlight></CodeLine>
<Link id="l03798" /><CodeLine lineNumber="3798"><Highlight kind="normal">    AU.<a href="/docs/api/classes/llvm/analysisusage/#af22b06a6a4f9df80454071685a0d6a02">setPreservesAll</a>();</Highlight></CodeLine>
<Link id="l03799" /><CodeLine lineNumber="3799"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/machinefunctionpass/#a864fd57b4304ef933b3281d0ef85a88e">MachineFunctionPass::getAnalysisUsage</a>(AU);</Highlight></CodeLine>
<Link id="l03800" /><CodeLine lineNumber="3800"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03801" /><CodeLine lineNumber="3801"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l03802" /><CodeLine lineNumber="3802"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03803" /><CodeLine lineNumber="3803"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// end anonymous namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03804" /><CodeLine lineNumber="3804"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03805" /><CodeLine lineNumber="3805"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#abe0ba94dc7c9cf225a968cb9f3fc5043">MachineBlockPlacementStats::ID</a> = 0;</Highlight></CodeLine>
<Link id="l03806" /><CodeLine lineNumber="3806"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03807" /><CodeLine lineNumber="3807" lineLink="/docs/api/namespaces/llvm/#aed6261eb88354cb0f52273e9fdcce729"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/#aed6261eb88354cb0f52273e9fdcce729">llvm::MachineBlockPlacementStatsID</a> = <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#abe0ba94dc7c9cf225a968cb9f3fc5043">MachineBlockPlacementStats::ID</a>;</Highlight></CodeLine>
<Link id="l03808" /><CodeLine lineNumber="3808"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03809" /><CodeLine lineNumber="3809" lineLink="#ace73c7d6fee046409626ebb1799d0454"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#aaa970fc931c1c63037a8182e028d04b1">INITIALIZE&#95;PASS&#95;BEGIN</a>(<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#ab048335b4f8ed04dfd6d34baa1881a9c">MachineBlockPlacementStats</a>, </Highlight><Highlight kind="stringliteral">&quot;block-placement-stats&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03810" /><CodeLine lineNumber="3810"><Highlight kind="normal">                      </Highlight><Highlight kind="stringliteral">&quot;Basic Block Placement Stats&quot;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l03811" /><CodeLine lineNumber="3811"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/machinebranchprobabilityinfowrapperpass">MachineBranchProbabilityInfoWrapperPass</a>)</Highlight></CodeLine>
<Link id="l03812" /><CodeLine lineNumber="3812"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a14724f1ccf528e73bb29bc9230737967">INITIALIZE&#95;PASS&#95;DEPENDENCY</a>(<a href="/docs/api/classes/llvm/machineblockfrequencyinfowrapperpass">MachineBlockFrequencyInfoWrapperPass</a>)</Highlight></CodeLine>
<Link id="l03813" /><CodeLine lineNumber="3813" lineLink="#a971b2fc3751cade0a6b2f76c92774317"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/passsupport-h/#a74ce8276b89067e806f67c45a6d92575">INITIALIZE&#95;PASS&#95;END</a>(<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#ab048335b4f8ed04dfd6d34baa1881a9c">MachineBlockPlacementStats</a>, </Highlight><Highlight kind="stringliteral">&quot;block-placement-stats&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03814" /><CodeLine lineNumber="3814" lineLink="#a086f939e29b718dc5a01e4bcfe6af2a1"><Highlight kind="normal">                    </Highlight><Highlight kind="stringliteral">&quot;Basic Block Placement Stats&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/false">false</a>, <a href="/docs/api/namespaces/false">false</a>)</Highlight></CodeLine>
<Link id="l03815" /><CodeLine lineNumber="3815"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03816" /><CodeLine lineNumber="3816" lineLink="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#a8305613a915321631b70e8f26e2d55d6"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#ab048335b4f8ed04dfd6d34baa1881a9c">MachineBlockPlacementStats</a>::<a href="/docs/api/classes/anonymous-namespace-machineblockplacement-cpp-/machineblockplacementstats/#a8305613a915321631b70e8f26e2d55d6">runOnMachineFunction</a>(<a href="/docs/api/classes/llvm/machinefunction">MachineFunction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l03817" /><CodeLine lineNumber="3817"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check for single-block functions and skip them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03818" /><CodeLine lineNumber="3818"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (std::next(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.begin()) == <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.end())</Highlight></CodeLine>
<Link id="l03819" /><CodeLine lineNumber="3819"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03820" /><CodeLine lineNumber="3820"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03821" /><CodeLine lineNumber="3821"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#acdfbcf188e2d4a80837e89de2ccdffab">if</a> (!<a href="/docs/api/namespaces/llvm/#a7d104c3a6510178d34b2d3f0ae67b4d5">isFunctionInPrintList</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getName()))</Highlight></CodeLine>
<Link id="l03822" /><CodeLine lineNumber="3822"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03823" /><CodeLine lineNumber="3823"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03824" /><CodeLine lineNumber="3824"><Highlight kind="normal">  MBPI = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;MachineBranchProbabilityInfoWrapperPass&gt;</a>().getMBPI();</Highlight></CodeLine>
<Link id="l03825" /><CodeLine lineNumber="3825"><Highlight kind="normal">  MBFI = &amp;<a href="/docs/api/classes/llvm/pass/#a4863e5e463fb79955269fbf7fbf52b80">getAnalysis&lt;MachineBlockFrequencyInfoWrapperPass&gt;</a>().getMBFI();</Highlight></CodeLine>
<Link id="l03826" /><CodeLine lineNumber="3826"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03827" /><CodeLine lineNumber="3827"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l03828" /><CodeLine lineNumber="3828"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> BlockFreq = MBFI-&gt;getBlockFreq(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>);</Highlight></CodeLine>
<Link id="l03829" /><CodeLine lineNumber="3829"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a6412c3ea6550f1aeab7571b6d38a2bf3">Statistic</a> &amp;NumBranches =</Highlight></CodeLine>
<Link id="l03830" /><CodeLine lineNumber="3830"><Highlight kind="normal">        (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.succ&#95;size() &gt; 1) ? NumCondBranches : NumUncondBranches;</Highlight></CodeLine>
<Link id="l03831" /><CodeLine lineNumber="3831"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a6412c3ea6550f1aeab7571b6d38a2bf3">Statistic</a> &amp;BranchTakenFreq =</Highlight></CodeLine>
<Link id="l03832" /><CodeLine lineNumber="3832"><Highlight kind="normal">        (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.succ&#95;size() &gt; 1) ? CondBranchTakenFreq : UncondBranchTakenFreq;</Highlight></CodeLine>
<Link id="l03833" /><CodeLine lineNumber="3833"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/machinebasicblock">MachineBasicBlock</a> &#42;Succ : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.successors()) &#123;</Highlight></CodeLine>
<Link id="l03834" /><CodeLine lineNumber="3834"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Skip if this successor is a fallthrough.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03835" /><CodeLine lineNumber="3835"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>.isLayoutSuccessor(Succ))</Highlight></CodeLine>
<Link id="l03836" /><CodeLine lineNumber="3836"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03837" /><CodeLine lineNumber="3837"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03838" /><CodeLine lineNumber="3838"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> EdgeFreq =</Highlight></CodeLine>
<Link id="l03839" /><CodeLine lineNumber="3839"><Highlight kind="normal">          BlockFreq &#42; MBPI-&gt;getEdgeProbability(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#a5958512eae2979bd2eb383977996a600">MBB</a>, Succ);</Highlight></CodeLine>
<Link id="l03840" /><CodeLine lineNumber="3840"><Highlight kind="normal">      ++NumBranches;</Highlight></CodeLine>
<Link id="l03841" /><CodeLine lineNumber="3841"><Highlight kind="normal">      BranchTakenFreq += EdgeFreq.<a href="/docs/api/classes/llvm/blockfrequency/#a8e9ed6b20c2503f66f1fd0725297aedc">getFrequency</a>();</Highlight></CodeLine>
<Link id="l03842" /><CodeLine lineNumber="3842"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03843" /><CodeLine lineNumber="3843"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03844" /><CodeLine lineNumber="3844"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03845" /><CodeLine lineNumber="3845"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03846" /><CodeLine lineNumber="3846"><Highlight kind="normal">&#125;</Highlight></CodeLine>

</ProgramListing>


</DoxygenPage>
