---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'
import SectionUser from '@xpack/docusaurus-plugin-doxygen/components/SectionUser'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `VPlanTransforms.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>

This file implements a set of utility <a href="/docs/api/classes/llvm/vplan">VPlan</a> to <a href="/docs/api/classes/llvm/vplan">VPlan</a> transformations. <a href="#details">More...</a>

## Included Headers

<IncludesList>
<IncludesListItem
  filePath="VPlanTransforms.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPRecipeBuilder.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vprecipebuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlan.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplan-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanAnalysis.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplananalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanCFG.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplancfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanDominatorTree.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplandominatortree-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanPatternMatch.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanpatternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanUtils.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/PostOrderIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/postorderiterator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/TypeSwitch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/typeswitch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/IVDescriptors.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/ivdescriptors-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/VectorUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Intrinsics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
</IncludesList>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a6e46200e5b228c903356e02904987051">addReplicateRegions</a> (VPlan &amp;Plan)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpactivelanemaskphirecipe">VPActiveLaneMaskPHIRecipe</a> &#42;</>}
  name={<><a href="#a5a9cb34d61fa4930ff585649d1d5b2ed">addVPLaneMaskPhiAndUpdateExitBranch</a> (VPlan &amp;Plan, bool DataAndControlFlowWithoutRuntimeCheck)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; &gt;</>}
  name={<><a href="#a8d0c6052d21638f0a385e226db3bd92f">collectAllHeaderMasks</a> (VPlan &amp;Plan)</>}>
Collect all VPValues representing a header mask through the (ICMP&#95;ULE, WideCanonicalIV, backedge-taken-count) pattern. <a href="#a8d0c6052d21638f0a385e226db3bd92f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42; &gt;</>}
  name={<><a href="#aa70c8f392e8295a96bfd493337e122fa">collectUsersRecursively</a> (VPValue &#42;V)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;</>}
  name={<><a href="#ad0faf4b8ff1cf3306958d056dcb2fde2">createEVLRecipe</a> (VPValue &#42;HeaderMask, VPRecipeBase &amp;CurRecipe, VPTypeAnalysis &amp;TypeInfo, VPValue &amp;AllOneMask, VPValue &amp;EVL)</>}>
Try to convert <code>CurRecipe</code> to a corresponding EVL-based recipe. <a href="#ad0faf4b8ff1cf3306958d056dcb2fde2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;</>}
  name={<><a href="#ac967ad551e77554a15e20cac14877ac7">createReplicateRegion</a> (VPReplicateRecipe &#42;PredRecipe, VPlan &amp;Plan)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpscalarivstepsrecipe">VPScalarIVStepsRecipe</a> &#42;</>}
  name={<><a href="#a3c91ec836b0d1e340e17bff8eec31390">createScalarIVSteps</a> (VPlan &amp;Plan, InductionDescriptor::InductionKind Kind, Instruction::BinaryOps InductionOpcode, FPMathOperator &#42;FPBinOp, Instruction &#42;TruncI, VPValue &#42;StartV, VPValue &#42;Step, DebugLoc DL, VPBuilder &amp;Builder)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpwideninductionrecipe">VPWidenInductionRecipe</a> &#42;</>}
  name={<><a href="#aa35433def455d3f76738769247678052">getOptimizableIVOf</a> (VPValue &#42;VPV)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if <code>VPV</code> is an untruncated wide induction, either before or after the increment. <a href="#aa35433def455d3f76738769247678052">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;</>}
  name={<><a href="#ae50d60234bec0a277dc087edad8901e1">getPredicatedMask</a> (VPRegionBlock &#42;R)</>}>
If <code>R</code> is a region with a <a href="/docs/api/classes/llvm/vpbranchonmaskrecipe">VPBranchOnMaskRecipe</a> in the entry block, return the mask. <a href="#ae50d60234bec0a277dc087edad8901e1">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;</>}
  name={<><a href="#ac99a45549c3cc25c2540f1bffd99944c">getPredicatedThenBlock</a> (VPRegionBlock &#42;R)</>}>
If <code>R</code> is a triangle region, return the &#39;then&#39; block of the triangle. <a href="#ac99a45549c3cc25c2540f1bffd99944c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9396319801f74828cfbd94177f38eabc">hoistPreviousBeforeFORUsers</a> (VPFirstOrderRecurrencePHIRecipe &#42;FOR, VPRecipeBase &#42;Previous, VPDominatorTree &amp;VPDT)</>}>
Try to hoist <code>Previous</code> and its operands before all users of <code>FOR</code>. <a href="#a9396319801f74828cfbd94177f38eabc">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a6ba2ffb17342f2a0c54adaba2344cab0">isDeadRecipe</a> (VPRecipeBase &amp;R)</>}>
Returns true if <code>R</code> is dead and can be removed. <a href="#a6ba2ffb17342f2a0c54adaba2344cab0">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a6bc9d4e47e8a41e60f4bedae712f0c03">legalizeAndOptimizeInductions</a> (VPlan &amp;Plan)</>}>
Legalize <a href="/docs/api/classes/llvm/vpwidenpointerinductionrecipe">VPWidenPointerInductionRecipe</a>, by replacing it with a PtrAdd (IndStart, ScalarIVSteps (0, Step)) if only its scalar values are used, as <a href="/docs/api/classes/llvm/vpwidenpointerinductionrecipe">VPWidenPointerInductionRecipe</a> will generate vectors only. <a href="#a6bc9d4e47e8a41e60f4bedae712f0c03">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#afd081c92500bd333555e7bd6102b4d3e">licm</a> (VPlan &amp;Plan)</>}>
Move loop-invariant recipes out of the vector loop region in <code>Plan</code>. <a href="#afd081c92500bd333555e7bd6102b4d3e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a528aff11b730581c8d7cfae0e5fb6254">mergeBlocksIntoPredecessors</a> (VPlan &amp;Plan)</>}>
Remove redundant VPBasicBlocks by merging them into their predecessor if the predecessor has a single successor. <a href="#a528aff11b730581c8d7cfae0e5fb6254">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a4b251734aba716917922f4ab216436c1">mergeReplicateRegionsIntoSuccessors</a> (VPlan &amp;Plan)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ab5d43362c1fefd60d9bfcc1e28ba4688">recursivelyDeleteDeadRecipes</a> (VPValue &#42;V)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aefd03ef5fc77c520e27fe794e8ec93e9">removeRedundantCanonicalIVs</a> (VPlan &amp;Plan)</>}>
Try to replace VPWidenCanonicalIVRecipes with a widened canonical IV recipe, if it exists. <a href="#aefd03ef5fc77c520e27fe794e8ec93e9">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8a0202a443a527ba17fcd111497feb7d">removeRedundantExpandSCEVRecipes</a> (VPlan &amp;Plan)</>}>
Remove redundant EpxandSCEVRecipes in <code>Plan&#39;s</code> entry block by replacing them with already existing recipes expanding the same <a href="/docs/api/classes/llvm/scev">SCEV</a> expression. <a href="#a8a0202a443a527ba17fcd111497feb7d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a2ff7a57c84a06ee83b0a28763db85c3f">removeRedundantInductionCasts</a> (VPlan &amp;Plan)</>}>
Remove redundant casts of inductions. <a href="#a2ff7a57c84a06ee83b0a28763db85c3f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a842c12e686e91a515dfd30a4bf70d740">simplifyRecipe</a> (VPRecipeBase &amp;R, VPTypeAnalysis &amp;TypeInfo)</>}>
Try to simplify recipe <code>R</code>. <a href="#a842c12e686e91a515dfd30a4bf70d740">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a74cb3294789bc24526bcadbf6b466714">simplifyRecipes</a> (VPlan &amp;Plan, Type &#42;CanonicalIVTy)</>}>
Try to simplify the recipes in <code>Plan</code>. <a href="#a74cb3294789bc24526bcadbf6b466714">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a4a5b1db18197a65d0f6a487f2e236921">sinkRecurrenceUsersAfterPrevious</a> (VPFirstOrderRecurrencePHIRecipe &#42;FOR, VPRecipeBase &#42;Previous, VPDominatorTree &amp;VPDT)</>}>
Sink users of <code>FOR</code> after the recipe defining the previous value <code>Previous</code> of the recurrence. <a href="#a4a5b1db18197a65d0f6a487f2e236921">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a1536feae2abb3570ac032768a53ddd00">sinkScalarOperands</a> (VPlan &amp;Plan)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a5f39858b5d6d72b92c138916c64c90ba">transformRecipestoEVLRecipes</a> (VPlan &amp;Plan, VPValue &amp;EVL)</>}>
Replace recipes with their EVL variants. <a href="#a5f39858b5d6d72b92c138916c64c90ba">More...</a>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

This file implements a set of utility <a href="/docs/api/classes/llvm/vplan">VPlan</a> to <a href="/docs/api/classes/llvm/vplan">VPlan</a> transformations.

<SectionDefinition>

## Functions

### addReplicateRegions() {#a6e46200e5b228c903356e02904987051}

<MemberDefinition
  prototype={<>static void addReplicateRegions (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>

Definition at line <a href="#l00344">344</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### addVPLaneMaskPhiAndUpdateExitBranch() {#a5a9cb34d61fa4930ff585649d1d5b2ed}

<MemberDefinition
  prototype={<>static VPActiveLaneMaskPHIRecipe &#42; addVPLaneMaskPhiAndUpdateExitBranch (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, bool DataAndControlFlowWithoutRuntimeCheck)</>}
  labels = {["static"]}>

Definition at line <a href="#l01490">1490</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### collectAllHeaderMasks() {#a8d0c6052d21638f0a385e226db3bd92f}

<MemberDefinition
  prototype={<>static SmallVector&lt; VPValue &#42; &gt; collectAllHeaderMasks (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>
Collect all VPValues representing a header mask through the (ICMP&#95;ULE, WideCanonicalIV, backedge-taken-count) pattern.

TODO: Introduce explicit recipe for header-mask instead of searching for the header-mask pattern manually.

Definition at line <a href="#l01565">1565</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### collectUsersRecursively() {#aa70c8f392e8295a96bfd493337e122fa}

<MemberDefinition
  prototype={<>static SmallVector&lt; VPUser &#42; &gt; collectUsersRecursively (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; V)</>}
  labels = {["static"]}>

Definition at line <a href="#l00565">565</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### createEVLRecipe() {#ad0faf4b8ff1cf3306958d056dcb2fde2}

<MemberDefinition
  prototype={<>static VPRecipeBase &#42; createEVLRecipe (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; HeaderMask, <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp; CurRecipe, <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> &amp; TypeInfo, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &amp; AllOneMask, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &amp; EVL)</>}
  labels = {["static"]}>
Try to convert <code>CurRecipe</code> to a corresponding EVL-based recipe.

Returns nullptr if no EVL-based recipe could be created. <code>HeaderMask</code> Header Mask. <code>CurRecipe</code> Recipe to be transform. <code>TypeInfo</code> VPlan-based type analysis. <code>AllOneMask</code> The vector mask parameter of vector-predication intrinsics. <code>EVL</code> The explicit vector length parameter of vector-predication intrinsics.

Definition at line <a href="#l01647">1647</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### createReplicateRegion() {#ac967ad551e77554a15e20cac14877ac7}

<MemberDefinition
  prototype={<>static VPRegionBlock &#42; createReplicateRegion (<a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a> &#42; PredRecipe, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>

Definition at line <a href="#l00303">303</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### createScalarIVSteps() {#a3c91ec836b0d1e340e17bff8eec31390}

<MemberDefinition
  prototype={<>static VPScalarIVStepsRecipe &#42; createScalarIVSteps (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabcc">InductionDescriptor::InductionKind</a> Kind, <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> InductionOpcode, <a href="/docs/api/classes/llvm/fpmathoperator">FPMathOperator</a> &#42; FPBinOp, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; TruncI, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; StartV, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; Step, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> DL, <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> &amp; Builder)</>}
  labels = {["static"]}>

Definition at line <a href="#l00527">527</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### getOptimizableIVOf() {#aa35433def455d3f76738769247678052}

<MemberDefinition
  prototype={<>static VPWidenInductionRecipe &#42; getOptimizableIVOf (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; VPV)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if <code>VPV</code> is an untruncated wide induction, either before or after the increment.

If so return the header IV (before the increment), otherwise return null.

Definition at line <a href="#l00673">673</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### getPredicatedMask() {#ae50d60234bec0a277dc087edad8901e1}

<MemberDefinition
  prototype={<>VPValue &#42; getPredicatedMask (<a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42; R)</>}>
If <code>R</code> is a region with a <a href="/docs/api/classes/llvm/vpbranchonmaskrecipe">VPBranchOnMaskRecipe</a> in the entry block, return the mask.

Definition at line <a href="#l00187">187</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### getPredicatedThenBlock() {#ac99a45549c3cc25c2540f1bffd99944c}

<MemberDefinition
  prototype={<>static VPBasicBlock &#42; getPredicatedThenBlock (<a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42; R)</>}
  labels = {["static"]}>
If <code>R</code> is a triangle region, return the &#39;then&#39; block of the triangle.

Definition at line <a href="#l00197">197</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### hoistPreviousBeforeFORUsers() {#a9396319801f74828cfbd94177f38eabc}

<MemberDefinition
  prototype={<>static bool hoistPreviousBeforeFORUsers (<a href="/docs/api/structs/llvm/vpfirstorderrecurrencephirecipe">VPFirstOrderRecurrencePHIRecipe</a> &#42; FOR, <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42; Previous, <a href="/docs/api/classes/llvm/vpdominatortree">VPDominatorTree</a> &amp; VPDT)</>}
  labels = {["static"]}>
Try to hoist <code>Previous</code> and its operands before all users of <code>FOR</code>.

Definition at line <a href="#l01112">1112</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### isDeadRecipe() {#a6ba2ffb17342f2a0c54adaba2344cab0}

<MemberDefinition
  prototype={<>static bool isDeadRecipe (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp; R)</>}
  labels = {["static"]}>
Returns true if <code>R</code> is dead and can be removed.

Definition at line <a href="#l00493">493</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### legalizeAndOptimizeInductions() {#a6bc9d4e47e8a41e60f4bedae712f0c03}

<MemberDefinition
  prototype={<>static void legalizeAndOptimizeInductions (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>
Legalize <a href="/docs/api/classes/llvm/vpwidenpointerinductionrecipe">VPWidenPointerInductionRecipe</a>, by replacing it with a PtrAdd (IndStart, ScalarIVSteps (0, Step)) if only its scalar values are used, as <a href="/docs/api/classes/llvm/vpwidenpointerinductionrecipe">VPWidenPointerInductionRecipe</a> will generate vectors only.

If some users require vectors while other require scalars, the scalar uses need to extract the scalars from the generated vectors (Note that this is different to how int/fp inductions are handled). Legalize extract-from-ends using uniform <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a> of wide inductions to use regular <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a>, so the correct end value is available. Also optimize <a href="/docs/api/classes/llvm/vpwidenintorfpinductionrecipe">VPWidenIntOrFpInductionRecipe</a>, if any of its users needs scalar values, by providing them scalar steps built on the canonical scalar IV and update the original IV&#39;s users. This is an optional optimization to reduce the needs of vector extracts.

Definition at line <a href="#l00589">589</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### licm() {#afd081c92500bd333555e7bd6102b4d3e}

<MemberDefinition
  prototype={<>static void licm (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>
Move loop-invariant recipes out of the vector loop region in <code>Plan</code>.

Definition at line <a href="#l01275">1275</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### mergeBlocksIntoPredecessors() {#a528aff11b730581c8d7cfae0e5fb6254}

<MemberDefinition
  prototype={<>static bool mergeBlocksIntoPredecessors (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>
Remove redundant VPBasicBlocks by merging them into their predecessor if the predecessor has a single successor.

Definition at line <a href="#l00372">372</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### mergeReplicateRegionsIntoSuccessors() {#a4b251734aba716917922f4ab216436c1}

<MemberDefinition
  prototype={<>static bool mergeReplicateRegionsIntoSuccessors (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>

Definition at line <a href="#l00219">219</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### recursivelyDeleteDeadRecipes() {#ab5d43362c1fefd60d9bfcc1e28ba4688}

<MemberDefinition
  prototype={<>static void recursivelyDeleteDeadRecipes (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; V)</>}
  labels = {["static"]}>

Definition at line <a href="#l00814">814</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### removeRedundantCanonicalIVs() {#aefd03ef5fc77c520e27fe794e8ec93e9}

<MemberDefinition
  prototype={<>static void removeRedundantCanonicalIVs (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>
Try to replace VPWidenCanonicalIVRecipes with a widened canonical IV recipe, if it exists.

Definition at line <a href="#l00457">457</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### removeRedundantExpandSCEVRecipes() {#a8a0202a443a527ba17fcd111497feb7d}

<MemberDefinition
  prototype={<>static void removeRedundantExpandSCEVRecipes (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>
Remove redundant EpxandSCEVRecipes in <code>Plan&#39;s</code> entry block by replacing them with already existing recipes expanding the same <a href="/docs/api/classes/llvm/scev">SCEV</a> expression.

Definition at line <a href="#l00797">797</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### removeRedundantInductionCasts() {#a2ff7a57c84a06ee83b0a28763db85c3f}

<MemberDefinition
  prototype={<>static void removeRedundantInductionCasts (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>
Remove redundant casts of inductions.

Such redundant casts are casts of induction variables that can be ignored, because we already proved that the casted phi is equal to the uncasted phi in the vectorized loop. There is no need to vectorize the cast - the same value can be used for both the phi and casts in the vector loop.

Definition at line <a href="#l00424">424</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### simplifyRecipe() {#a842c12e686e91a515dfd30a4bf70d740}

<MemberDefinition
  prototype={<>static void simplifyRecipe (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp; R, <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> &amp; TypeInfo)</>}
  labels = {["static"]}>
Try to simplify recipe <code>R</code>.

Definition at line <a href="#l00834">834</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### simplifyRecipes() {#a74cb3294789bc24526bcadbf6b466714}

<MemberDefinition
  prototype={<>static void simplifyRecipes (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/type">Type</a> &#42; CanonicalIVTy)</>}
  labels = {["static"]}>
Try to simplify the recipes in <code>Plan</code>.

<a href="/docs/api/classes/llvm/use">Use</a> <code>CanonicalIVTy</code> as type for all un-typed live-ins in <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a>.

Definition at line <a href="#l00967">967</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### sinkRecurrenceUsersAfterPrevious() {#a4a5b1db18197a65d0f6a487f2e236921}

<MemberDefinition
  prototype={<>static bool sinkRecurrenceUsersAfterPrevious (<a href="/docs/api/structs/llvm/vpfirstorderrecurrencephirecipe">VPFirstOrderRecurrencePHIRecipe</a> &#42; FOR, <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42; Previous, <a href="/docs/api/classes/llvm/vpdominatortree">VPDominatorTree</a> &amp; VPDT)</>}
  labels = {["static"]}>
Sink users of <code>FOR</code> after the recipe defining the previous value <code>Previous</code> of the recurrence.

<SectionUser title="Returns">
true if all users of <code>FOR</code> could be re-arranged as needed or false if it is not possible.
</SectionUser>

Definition at line <a href="#l01057">1057</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### sinkScalarOperands() {#a1536feae2abb3570ac032768a53ddd00}

<MemberDefinition
  prototype={<>static bool sinkScalarOperands (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>

Definition at line <a href="#l00109">109</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### transformRecipestoEVLRecipes() {#a5f39858b5d6d72b92c138916c64c90ba}

<MemberDefinition
  prototype={<>static void transformRecipestoEVLRecipes (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &amp; EVL)</>}
  labels = {["static"]}>
Replace recipes with their EVL variants.

Definition at line <a href="#l01726">1726</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><Highlight kind="comment">//===-- VPlanTransforms.cpp - Utility VPlan to VPlan transforms -----------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><Highlight kind="normal"></Highlight><Highlight kind="comment">// See https://llvm.org/LICENSE.txt for license information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><Highlight kind="comment">/// \\file</Highlight></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><Highlight kind="comment">/// This file implements a set of utility VPlan to VPlan transformations.</Highlight></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><Highlight kind="comment">///</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-h">VPlanTransforms.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vprecipebuilder-h">VPRecipeBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplan-h">VPlan.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplananalysis-h">VPlanAnalysis.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplancfg-h">VPlanCFG.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplandominatortree-h">VPlanDominatorTree.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanpatternmatch-h">VPlanPatternMatch.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanutils-h">VPlanUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/postorderiterator-h">llvm/ADT/PostOrderIterator.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h">llvm/ADT/SetVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/typeswitch-h">llvm/ADT/TypeSwitch.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/ivdescriptors-h">llvm/Analysis/IVDescriptors.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h">llvm/Analysis/VectorUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h">llvm/IR/Intrinsics.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a>;</Highlight></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33" lineLink="/docs/api/structs/llvm/vplantransforms/#ad210afaefb4884ac5008dd5fbaf1cbf8"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#ad210afaefb4884ac5008dd5fbaf1cbf8">VPlanTransforms::VPInstructionsToVPRecipes</a>(</Highlight></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#aefc42f3cefc5a839ca925b4cb3ae4a7b">VPlanPtr</a> &amp;Plan,</Highlight></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &#42;(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;)&gt;</Highlight></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><Highlight kind="normal">        GetIntOrFpInductionDescriptor,</Highlight></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;TLI) &#123;</Highlight></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/reversepostordertraversal">ReversePostOrderTraversal&lt;VPBlockDeepTraversalWrapper&lt;VPBlockBase &#42;&gt;</a>&gt; RPOT(</Highlight></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><Highlight kind="normal">      Plan-&gt;getVectorLoopRegion());</Highlight></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(RPOT)) &#123;</Highlight></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Skip blocks outside region</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VPBB-&gt;getParent())</Highlight></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Term = VPBB-&gt;getTerminator();</Highlight></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> EndIter = Term ? Term-&gt;getIterator() : VPBB-&gt;end();</Highlight></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Introduce each ingredient into VPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;Ingredient :</Highlight></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><Highlight kind="normal">         <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(VPBB-&gt;begin(), EndIter))) &#123;</Highlight></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;VPV = Ingredient.getVPSingleValue();</Highlight></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(VPV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#a5fe7dd2466300bd8747d81384a7ced5d">getUnderlyingValue</a>());</Highlight></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;NewRecipe = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VPPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenPHIRecipe&gt;</a>(&amp;Ingredient)) &#123;</Highlight></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(VPPhi-&gt;getUnderlyingValue());</Highlight></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = GetIntOrFpInductionDescriptor(Phi);</Highlight></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)</Highlight></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Start = Plan-&gt;getOrAddLiveIn(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getStartValue());</Highlight></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Step =</Highlight></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/vputils/#a064976a6c7458b10c24021b7334cec2a">vputils::getOrCreateVPValueForSCEVExpr</a>(&#42;Plan, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getStep(), SE);</Highlight></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><Highlight kind="normal">        NewRecipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidenintorfpinductionrecipe">VPWidenIntOrFpInductionRecipe</a>(</Highlight></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><Highlight kind="normal">            Phi, Start, Step, &amp;Plan-&gt;getVF(), &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, Ingredient.getDebugLoc());</Highlight></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPInstruction&gt;</a>(&amp;Ingredient) &amp;&amp;</Highlight></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;only VPInstructions expected here&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(Inst) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;phis should be handled above&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Create VPWidenMemoryRecipe for loads and stores.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;Load = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(Inst)) &#123;</Highlight></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><Highlight kind="normal">          NewRecipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vpwidenloadrecipe">VPWidenLoadRecipe</a>(</Highlight></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><Highlight kind="normal">              &#42;Load, Ingredient.getOperand(0), </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42;Mask&#42;/</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><Highlight kind="normal">              </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42;Consecutive&#42;/</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42;Reverse&#42;/</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><Highlight kind="normal">              Ingredient.getDebugLoc());</Highlight></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;Store = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(Inst)) &#123;</Highlight></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><Highlight kind="normal">          NewRecipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vpwidenstorerecipe">VPWidenStoreRecipe</a>(</Highlight></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><Highlight kind="normal">              &#42;Store, Ingredient.getOperand(1), Ingredient.getOperand(0),</Highlight></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><Highlight kind="normal">              </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42;Mask&#42;/</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42;Consecutive&#42;/</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42;Reverse&#42;/</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><Highlight kind="normal">              Ingredient.getDebugLoc());</Highlight></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(Inst)) &#123;</Highlight></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><Highlight kind="normal">          NewRecipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidengeprecipe">VPWidenGEPRecipe</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, Ingredient.operands());</Highlight></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(Inst)) &#123;</Highlight></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><Highlight kind="normal">          NewRecipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidenintrinsicrecipe">VPWidenIntrinsicRecipe</a>(</Highlight></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><Highlight kind="normal">              &#42;CI, <a href="/docs/api/namespaces/llvm/#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, &amp;TLI),</Highlight></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><Highlight kind="normal">              &#123;Ingredient.op&#95;begin(), Ingredient.op&#95;end() - 1&#125;, CI-&gt;getType(),</Highlight></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><Highlight kind="normal">              CI-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(Inst)) &#123;</Highlight></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><Highlight kind="normal">          NewRecipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vpwidenselectrecipe">VPWidenSelectRecipe</a>(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, Ingredient.operands());</Highlight></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(Inst)) &#123;</Highlight></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><Highlight kind="normal">          NewRecipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>(</Highlight></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><Highlight kind="normal">              CI-&gt;getOpcode(), Ingredient.getOperand(0), CI-&gt;getType(), &#42;CI);</Highlight></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><Highlight kind="normal">          NewRecipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidenrecipe">VPWidenRecipe</a>(&#42;Inst, Ingredient.<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>());</Highlight></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><Highlight kind="normal">      NewRecipe-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a8859e5e8cad5653b278964f47414fd84">insertBefore</a>(&amp;Ingredient);</Highlight></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NewRecipe-&gt;<a href="/docs/api/classes/llvm/vpdef/#a31492b9d8412415c2dae85e33e2748fd">getNumDefinedValues</a>() == 1)</Highlight></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><Highlight kind="normal">        VPV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(NewRecipe-&gt;<a href="/docs/api/classes/llvm/vpdef/#a76a983b694720483a3dd9fe57314e39b">getVPSingleValue</a>());</Highlight></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewRecipe-&gt;<a href="/docs/api/classes/llvm/vpdef/#a31492b9d8412415c2dae85e33e2748fd">getNumDefinedValues</a>() == 0 &amp;&amp;</Highlight></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;Only recpies with zero or one defined values expected&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><Highlight kind="normal">      Ingredient.eraseFromParent();</Highlight></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109" lineLink="#a1536feae2abb3570ac032768a53ddd00"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a1536feae2abb3570ac032768a53ddd00">sinkScalarOperands</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Iter = <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>());</Highlight></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// First, collect the operands of all recipes in replicate blocks as seeds for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// sinking.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;std::pair&lt;VPBasicBlock &#42;, VPSingleDefRecipe &#42;&gt;</a>&gt; WorkList;</Highlight></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;VPR : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPRegionBlock&gt;</a>(Iter)) &#123;</Highlight></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;EntryVPBB = VPR-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</Highlight></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VPR-&gt;isReplicator() || EntryVPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aeccf6a036968755c6d86e2d2bb17673a">getSuccessors</a>().<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() != 2)</Highlight></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPBasicBlock&gt;</a>(EntryVPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aeccf6a036968755c6d86e2d2bb17673a">getSuccessors</a>()&#91;0&#93;);</Highlight></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VPBB || VPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>() != VPR-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a28da654f916bf44da5513b6f1788835c">getExitingBasicBlock</a>())</Highlight></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Recipe : &#42;VPBB) &#123;</Highlight></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : Recipe.operands())</Highlight></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Def =</Highlight></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><Highlight kind="normal">                <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;VPSingleDefRecipe&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getDefiningRecipe()))</Highlight></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><Highlight kind="normal">          WorkList.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(std::make&#95;pair(VPBB, Def));</Highlight></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ScalarVFOnly = Plan.<a href="/docs/api/classes/llvm/vplan/#ad30bf062f18fd6e56e36bfecefbbb386">hasScalarVFOnly</a>();</Highlight></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to sink each replicate or scalar IV steps recipe in the worklist.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != WorkList.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;SinkTo;</Highlight></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpsingledefrecipe">VPSingleDefRecipe</a> &#42;SinkCandidate;</Highlight></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><Highlight kind="normal">    std::tie(SinkTo, SinkCandidate) = WorkList&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>() == SinkTo ||</Highlight></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><Highlight kind="normal">        SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a2408a88276528d80adefefa00995705a">mayHaveSideEffects</a>() ||</Highlight></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><Highlight kind="normal">        SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a15ab200cb0259f0c13b4e068acfd7fc6">mayReadOrWriteMemory</a>())</Highlight></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RepR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReplicateRecipe&gt;</a>(SinkCandidate)) &#123;</Highlight></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ScalarVFOnly &amp;&amp; RepR-&gt;isUniform())</Highlight></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPScalarIVStepsRecipe&gt;</a>(SinkCandidate))</Highlight></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> NeedsDuplicating = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// All recipe users of the sink candidate must be in the same block SinkTo</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// or all users outside of SinkTo must be uniform-after-vectorization (</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// i.e., only first lane is used) . In the latter case, we need to duplicate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// SinkCandidate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CanSinkWithUser = &#91;SinkTo, &amp;NeedsDuplicating,</Highlight></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><Highlight kind="normal">                            SinkCandidate&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(U);</Highlight></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UI-&gt;getParent() == SinkTo)</Highlight></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><Highlight kind="normal">      NeedsDuplicating = UI-&gt;onlyFirstLaneUsed(SinkCandidate);</Highlight></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We only know how to duplicate VPRecipeRecipes for now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NeedsDuplicating &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPReplicateRecipe&gt;</a>(SinkCandidate);</Highlight></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>(), CanSinkWithUser))</Highlight></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NeedsDuplicating) &#123;</Highlight></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ScalarVFOnly)</Highlight></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vpsingledefrecipe/#a12b12fbdf160f2cf70973e09adbf97d4">getUnderlyingInstr</a>();</Highlight></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Clone = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vpuser/#a11d83265a9e4ff6c6ecd3cf222ad0208">operands</a>(), </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: add &quot;.cloned&quot; suffix to name of Clone&#39;s VPValue.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><Highlight kind="normal">      Clone-&gt;insertBefore(SinkCandidate);</Highlight></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><Highlight kind="normal">      SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ae3773dd8f9c831f0dde091319b2ff7d0">replaceUsesWithIf</a>(Clone, &#91;SinkTo&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &amp;U, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(&amp;U)-&gt;getParent() != SinkTo;</Highlight></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><Highlight kind="normal">    SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a83c9341e2d36f67d5cad25ba91e862e1">moveBefore</a>(&#42;SinkTo, SinkTo-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>());</Highlight></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vpuser/#a11d83265a9e4ff6c6ecd3cf222ad0208">operands</a>())</Highlight></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Def =</Highlight></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;VPSingleDefRecipe&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getDefiningRecipe()))</Highlight></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><Highlight kind="normal">        WorkList.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(std::make&#95;pair(SinkTo, Def));</Highlight></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><Highlight kind="comment">/// If \\p R is a region with a VPBranchOnMaskRecipe in the entry block, return</Highlight></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><Highlight kind="comment">/// the mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187" lineLink="#ae50d60234bec0a277dc087edad8901e1"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="#ae50d60234bec0a277dc087edad8901e1">getPredicatedMask</a>(<a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;R) &#123;</Highlight></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;EntryBB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPBasicBlock&gt;</a>(R-&gt;getEntry());</Highlight></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!EntryBB || EntryBB-&gt;size() != 1 ||</Highlight></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPBranchOnMaskRecipe&gt;</a>(EntryBB-&gt;begin()))</Highlight></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBranchOnMaskRecipe&gt;</a>(&amp;&#42;EntryBB-&gt;begin())-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><Highlight kind="comment">/// If \\p R is a triangle region, return the &#39;then&#39; block of the triangle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197" lineLink="#ac99a45549c3cc25c2540f1bffd99944c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;<a href="#ac99a45549c3cc25c2540f1bffd99944c">getPredicatedThenBlock</a>(<a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;R) &#123;</Highlight></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;EntryBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(R-&gt;getEntry());</Highlight></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EntryBB-&gt;getNumSuccessors() != 2)</Highlight></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Succ0 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPBasicBlock&gt;</a>(EntryBB-&gt;getSuccessors()&#91;0&#93;);</Highlight></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Succ1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPBasicBlock&gt;</a>(EntryBB-&gt;getSuccessors()&#91;1&#93;);</Highlight></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Succ0 || !Succ1)</Highlight></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Succ0-&gt;getNumSuccessors() + Succ1-&gt;getNumSuccessors() != 1)</Highlight></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Succ0-&gt;getSingleSuccessor() == Succ1)</Highlight></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Succ0;</Highlight></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Succ1-&gt;getSingleSuccessor() == Succ0)</Highlight></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Succ1;</Highlight></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Merge replicate regions in their successor region, if a replicate region</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><Highlight kind="normal"></Highlight><Highlight kind="comment">// is connected to a successor replicate region with the same predicate by a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><Highlight kind="normal"></Highlight><Highlight kind="comment">// single, empty VPBasicBlock.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219" lineLink="#a4b251734aba716917922f4ab216436c1"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a4b251734aba716917922f4ab216436c1">mergeReplicateRegionsIntoSuccessors</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;VPRegionBlock &#42;, 4&gt;</a> TransformedRegions;</Highlight></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect replicate regions followed by an empty block, followed by another</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// replicate region with matching masks to process front. This is to avoid</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// iterator invalidation issues while merging regions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPRegionBlock &#42;, 8&gt;</a> WorkList;</Highlight></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;Region1 : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPRegionBlock&gt;</a>(</Highlight></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()))) &#123;</Highlight></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Region1-&gt;isReplicator())</Highlight></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MiddleBasicBlock =</Highlight></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;VPBasicBlock&gt;</a>(Region1-&gt;getSingleSuccessor());</Highlight></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MiddleBasicBlock || !MiddleBasicBlock-&gt;empty())</Highlight></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Region2 =</Highlight></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;VPRegionBlock&gt;</a>(MiddleBasicBlock-&gt;getSingleSuccessor());</Highlight></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Region2 || !Region2-&gt;isReplicator())</Highlight></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Mask1 = <a href="#ae50d60234bec0a277dc087edad8901e1">getPredicatedMask</a>(Region1);</Highlight></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Mask2 = <a href="#ae50d60234bec0a277dc087edad8901e1">getPredicatedMask</a>(Region2);</Highlight></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Mask1 || Mask1 != Mask2)</Highlight></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Mask1 &amp;&amp; Mask2 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;both region must have conditions&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><Highlight kind="normal">    WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Region1);</Highlight></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Move recipes from Region1 to its successor region, if both are triangles.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;Region1 : WorkList) &#123;</Highlight></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TransformedRegions.<a href="/docs/api/classes/llvm/smallptrsetimpl/#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(Region1))</Highlight></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MiddleBasicBlock = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(Region1-&gt;getSingleSuccessor());</Highlight></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Region2 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRegionBlock&gt;</a>(MiddleBasicBlock-&gt;getSingleSuccessor());</Highlight></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;Then1 = <a href="#ac99a45549c3cc25c2540f1bffd99944c">getPredicatedThenBlock</a>(Region1);</Highlight></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;Then2 = <a href="#ac99a45549c3cc25c2540f1bffd99944c">getPredicatedThenBlock</a>(Region2);</Highlight></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Then1 || !Then2)</Highlight></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Note: No fusion-preventing memory dependencies are expected in either</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// region. Such dependencies should be rejected during earlier dependence</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// checks, which guarantee accesses can be re-ordered for vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Move recipes to the successor region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;ToMove : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(&#42;Then1)))</Highlight></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><Highlight kind="normal">      ToMove.moveBefore(&#42;Then2, Then2-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>());</Highlight></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Merge1 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(Then1-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>());</Highlight></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Merge2 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(Then2-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>());</Highlight></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Move VPPredInstPHIRecipes from the merge block to the successor region&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// merge block. Update all users inside the successor region to use the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// original values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;Phi1ToMove : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(&#42;Merge1))) &#123;</Highlight></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;PredInst1 =</Highlight></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPPredInstPHIRecipe&gt;</a>(&amp;Phi1ToMove)-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Phi1ToMoveV = Phi1ToMove.getVPSingleValue();</Highlight></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><Highlight kind="normal">      Phi1ToMoveV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ae3773dd8f9c831f0dde091319b2ff7d0">replaceUsesWithIf</a>(PredInst1, &#91;Then2&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &amp;U, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(&amp;U)-&gt;getParent() == Then2;</Highlight></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Remove phi recipes that are unused after merging the regions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Phi1ToMove.getVPSingleValue()-&gt;getNumUsers() == 0) &#123;</Highlight></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><Highlight kind="normal">        Phi1ToMove.eraseFromParent();</Highlight></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><Highlight kind="normal">      Phi1ToMove.moveBefore(&#42;Merge2, Merge2-&gt;begin());</Highlight></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Finally, remove the first region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(Region1-&gt;getPredecessors())) &#123;</Highlight></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpblockutils/#a61f1451694a3638db85170c7f55d5581">VPBlockUtils::disconnectBlocks</a>(Pred, Region1);</Highlight></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpblockutils/#a40bc7fec35d7093efcdbadf566d6b5ee">VPBlockUtils::connectBlocks</a>(Pred, MiddleBasicBlock);</Highlight></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpblockutils/#a61f1451694a3638db85170c7f55d5581">VPBlockUtils::disconnectBlocks</a>(Region1, MiddleBasicBlock);</Highlight></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><Highlight kind="normal">    TransformedRegions.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Region1);</Highlight></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !TransformedRegions.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#af8a50544090e81ac83601aff8f4b0142">empty</a>();</Highlight></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303" lineLink="#ac967ad551e77554a15e20cac14877ac7"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;<a href="#ac967ad551e77554a15e20cac14877ac7">createReplicateRegion</a>(<a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a> &#42;PredRecipe,</Highlight></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><Highlight kind="normal">                                            <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr = PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpsingledefrecipe/#a12b12fbdf160f2cf70973e09adbf97d4">getUnderlyingInstr</a>();</Highlight></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Build the triangular if-then region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><Highlight kind="normal">  std::string RegionName = (<a href="/docs/api/classes/llvm/twine">Twine</a>(</Highlight><Highlight kind="stringliteral">&quot;pred.&quot;</Highlight><Highlight kind="normal">) + Instr-&gt;getOpcodeName()).str();</Highlight></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Instr-&gt;getParent() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Predicated instruction not in any basic block&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BlockInMask = PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpreplicaterecipe/#aec678e1ae306c61d14f856a3eb0d6bac">getMask</a>();</Highlight></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BOMRecipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpbranchonmaskrecipe">VPBranchOnMaskRecipe</a>(BlockInMask);</Highlight></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Entry =</Highlight></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><Highlight kind="normal">      Plan.<a href="/docs/api/classes/llvm/vplan/#aa1202b66a60b632b7adbdee13a20ad7e">createVPBasicBlock</a>(<a href="/docs/api/classes/llvm/twine">Twine</a>(RegionName) + </Highlight><Highlight kind="stringliteral">&quot;.entry&quot;</Highlight><Highlight kind="normal">, BOMRecipe);</Highlight></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace predicated replicate recipe with a replicate recipe without a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// mask but in the replicate region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RecipeWithoutMask = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a>(</Highlight></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><Highlight kind="normal">      PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpsingledefrecipe/#a12b12fbdf160f2cf70973e09adbf97d4">getUnderlyingInstr</a>(),</Highlight></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpuser/#a6b1fcd7575eca39b654ed96202958e14">op&#95;begin</a>(), std::prev(PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpuser/#a634b1fa5443baf5d70ede2f674c46e54">op&#95;end</a>())),</Highlight></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><Highlight kind="normal">      PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpreplicaterecipe/#a8bb23947220a946748e3f1e6e6825155">isUniform</a>());</Highlight></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Pred =</Highlight></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><Highlight kind="normal">      Plan.<a href="/docs/api/classes/llvm/vplan/#aa1202b66a60b632b7adbdee13a20ad7e">createVPBasicBlock</a>(<a href="/docs/api/classes/llvm/twine">Twine</a>(RegionName) + </Highlight><Highlight kind="stringliteral">&quot;.if&quot;</Highlight><Highlight kind="normal">, RecipeWithoutMask);</Highlight></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vppredinstphirecipe">VPPredInstPHIRecipe</a> &#42;PHIRecipe = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ac3acda1aa682fbb8f8b95b0816eea879">getNumUsers</a>() != 0) &#123;</Highlight></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><Highlight kind="normal">    PHIRecipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vppredinstphirecipe">VPPredInstPHIRecipe</a>(RecipeWithoutMask,</Highlight></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><Highlight kind="normal">                                        RecipeWithoutMask-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><Highlight kind="normal">    PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(PHIRecipe);</Highlight></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><Highlight kind="normal">    PHIRecipe-&gt;<a href="/docs/api/classes/llvm/vpuser/#a19c3591dc1eeb5648552b33f70e04b65">setOperand</a>(0, RecipeWithoutMask);</Highlight></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><Highlight kind="normal">  PredRecipe-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#aac9dfb61b37082dca00de284bb3309e8">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Exiting =</Highlight></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><Highlight kind="normal">      Plan.<a href="/docs/api/classes/llvm/vplan/#aa1202b66a60b632b7adbdee13a20ad7e">createVPBasicBlock</a>(<a href="/docs/api/classes/llvm/twine">Twine</a>(RegionName) + </Highlight><Highlight kind="stringliteral">&quot;.continue&quot;</Highlight><Highlight kind="normal">, PHIRecipe);</Highlight></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;<a href="/docs/api/classes/llvm/region">Region</a> =</Highlight></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><Highlight kind="normal">      Plan.<a href="/docs/api/classes/llvm/vplan/#a229a878bb15506314b99639e3d6dca41">createVPRegionBlock</a>(Entry, Exiting, RegionName, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note: first set Entry as region entry and then connect successors starting</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// from it in order, to propagate the &quot;parent&quot; of each VPBasicBlock.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpblockutils/#a3a43b6445802190031bda62347e97453">VPBlockUtils::insertTwoBlocksAfter</a>(Pred, Exiting, Entry);</Highlight></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpblockutils/#a40bc7fec35d7093efcdbadf566d6b5ee">VPBlockUtils::connectBlocks</a>(Pred, Exiting);</Highlight></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/region">Region</a>;</Highlight></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344" lineLink="#a6e46200e5b228c903356e02904987051"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a6e46200e5b228c903356e02904987051">addReplicateRegions</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPReplicateRecipe &#42;&gt;</a> WorkList;</Highlight></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(</Highlight></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()))) &#123;</Highlight></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : &#42;VPBB)</Highlight></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RepR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReplicateRecipe&gt;</a>(&amp;R)) &#123;</Highlight></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RepR-&gt;isPredicated())</Highlight></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><Highlight kind="normal">          WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(RepR);</Highlight></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> BBNum = 0;</Highlight></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a> &#42;RepR : WorkList) &#123;</Highlight></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;CurrentBlock = RepR-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a09de70cbaf2f15aa3b0697b5f378cc9d">getParent</a>();</Highlight></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a> = CurrentBlock-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a9b75fcd70de89596b8f04904aa42e2cd">splitAt</a>(RepR-&gt;getIterator());</Highlight></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OrigBB = RepR-&gt;getUnderlyingInstr()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>-&gt;setName(</Highlight></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><Highlight kind="normal">        OrigBB-&gt;<a href="/docs/api/classes/llvm/value/#ad9d88ae321b98d8a3b7f394977ae6d7f">hasName</a>() ? OrigBB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.&quot;</Highlight><Highlight kind="normal"> + <a href="/docs/api/classes/llvm/twine">Twine</a>(BBNum++) : </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Record predicated instructions for above packing optimizations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;<a href="/docs/api/classes/llvm/region">Region</a> = <a href="#ac967ad551e77554a15e20cac14877ac7">createReplicateRegion</a>(RepR, Plan);</Highlight></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/region">Region</a>-&gt;setParent(CurrentBlock-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a09de70cbaf2f15aa3b0697b5f378cc9d">getParent</a>());</Highlight></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpblockutils/#a2057d0749eedf6749f9e1cc6694eb1fd">VPBlockUtils::insertOnEdge</a>(CurrentBlock, <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>, <a href="/docs/api/classes/llvm/region">Region</a>);</Highlight></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><Highlight kind="comment">/// Remove redundant VPBasicBlocks by merging them into their predecessor if</Highlight></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><Highlight kind="comment">/// the predecessor has a single successor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372" lineLink="#a528aff11b730581c8d7cfae0e5fb6254"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopsimplifycfg-cpp/#a5a5d8a7a6d46886bfb6350ed47c0f225">mergeBlocksIntoPredecessors</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPBasicBlock &#42;&gt;</a> WorkList;</Highlight></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(</Highlight></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()))) &#123;</Highlight></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t fold the blocks in the skeleton of the Plan into their single</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// predecessors for now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Remove restriction once more of the skeleton is modeled in VPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VPBB-&gt;getParent())</Highlight></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PredVPBB =</Highlight></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;VPBasicBlock&gt;</a>(VPBB-&gt;getSinglePredecessor());</Highlight></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PredVPBB || PredVPBB-&gt;getNumSuccessors() != 1 ||</Highlight></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPIRBasicBlock&gt;</a>(PredVPBB))</Highlight></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><Highlight kind="normal">    WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VPBB);</Highlight></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : WorkList) &#123;</Highlight></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;PredVPBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(VPBB-&gt;getSinglePredecessor());</Highlight></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;VPBB))</Highlight></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><Highlight kind="normal">      R.moveBefore(&#42;PredVPBB, PredVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a4a7f4b8433e9a788149ffd94a0a07051">end</a>());</Highlight></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpblockutils/#a61f1451694a3638db85170c7f55d5581">VPBlockUtils::disconnectBlocks</a>(PredVPBB, VPBB);</Highlight></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ParentRegion = <a href="/docs/api/namespaces/llvm/#a3e627c32543ca70720c4270a8b11da3f">cast&#95;or&#95;null&lt;VPRegionBlock&gt;</a>(VPBB-&gt;getParent());</Highlight></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ParentRegion &amp;&amp; ParentRegion-&gt;getExiting() == VPBB)</Highlight></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><Highlight kind="normal">      ParentRegion-&gt;setExiting(PredVPBB);</Highlight></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a886094eaed7ce32029ea52a641142b88">to&#95;vector</a>(VPBB-&gt;successors())) &#123;</Highlight></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpblockutils/#a61f1451694a3638db85170c7f55d5581">VPBlockUtils::disconnectBlocks</a>(VPBB, Succ);</Highlight></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpblockutils/#a40bc7fec35d7093efcdbadf566d6b5ee">VPBlockUtils::connectBlocks</a>(PredVPBB, Succ);</Highlight></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// VPBB is now dead and will be cleaned up when the plan gets destroyed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>();</Highlight></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406" lineLink="/docs/api/structs/llvm/vplantransforms/#a42d43068c576be2a1cd514f620246004"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#a42d43068c576be2a1cd514f620246004">VPlanTransforms::createAndOptimizeReplicateRegions</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Convert masked VPReplicateRecipes to if-then region blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><Highlight kind="normal">  <a href="#a6e46200e5b228c903356e02904987051">addReplicateRegions</a>(Plan);</Highlight></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ShouldSimplify = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (ShouldSimplify) &#123;</Highlight></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><Highlight kind="normal">    ShouldSimplify = <a href="#a1536feae2abb3570ac032768a53ddd00">sinkScalarOperands</a>(Plan);</Highlight></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><Highlight kind="normal">    ShouldSimplify |= <a href="#a4b251734aba716917922f4ab216436c1">mergeReplicateRegionsIntoSuccessors</a>(Plan);</Highlight></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><Highlight kind="normal">    ShouldSimplify |= <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopsimplifycfg-cpp/#a5a5d8a7a6d46886bfb6350ed47c0f225">mergeBlocksIntoPredecessors</a>(Plan);</Highlight></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><Highlight kind="comment">/// Remove redundant casts of inductions.</Highlight></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><Highlight kind="comment">/// Such redundant casts are casts of induction variables that can be ignored,</Highlight></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><Highlight kind="comment">/// because we already proved that the casted phi is equal to the uncasted phi</Highlight></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><Highlight kind="comment">/// in the vectorized loop. There is no need to vectorize the cast - the same</Highlight></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><Highlight kind="comment">/// value can be used for both the phi and casts in the vector loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424" lineLink="#a2ff7a57c84a06ee83b0a28763db85c3f"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a2ff7a57c84a06ee83b0a28763db85c3f">removeRedundantInductionCasts</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Phi : Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenIntOrFpInductionRecipe&gt;</a>(&amp;Phi);</Highlight></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> || <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getTruncInst())</Highlight></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// A sequence of IR Casts has potentially been recorded for IV, which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#42;must be bypassed&#42; when the IV is vectorized, because the vectorized IV</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// will produce the desired casted value. This sequence forms a def-use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// chain and is provided in reverse order, ending with the cast that uses</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the IV phi. Search for the recipe of the last cast in the chain and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// replace it with the original IV. Note that only the final cast is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// expected to have users outside the cast-chain and the dead casts left</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// over will be cleaned up later.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Casts = <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getInductionDescriptor().getCastInsts();</Highlight></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;FindMyCast = <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>;</Highlight></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IRCast : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(Casts)) &#123;</Highlight></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpsingledefrecipe">VPSingleDefRecipe</a> &#42;FoundUserCast = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : FindMyCast-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UserCast = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPSingleDefRecipe&gt;</a>(U);</Highlight></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserCast &amp;&amp; UserCast-&gt;getUnderlyingValue() == IRCast) &#123;</Highlight></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><Highlight kind="normal">          FoundUserCast = UserCast;</Highlight></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><Highlight kind="normal">      FindMyCast = FoundUserCast;</Highlight></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><Highlight kind="normal">    FindMyCast-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>);</Highlight></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><Highlight kind="comment">/// Try to replace VPWidenCanonicalIVRecipes with a widened canonical IV</Highlight></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><Highlight kind="comment">/// recipe, if it exists.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457" lineLink="#aefd03ef5fc77c520e27fe794e8ec93e9"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#aefd03ef5fc77c520e27fe794e8ec93e9">removeRedundantCanonicalIVs</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpcanonicalivphirecipe">VPCanonicalIVPHIRecipe</a> &#42;CanonicalIV = Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>();</Highlight></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpwidencanonicalivrecipe">VPWidenCanonicalIVRecipe</a> &#42;WidenNewIV = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : CanonicalIV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><Highlight kind="normal">    WidenNewIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenCanonicalIVRecipe&gt;</a>(U);</Highlight></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (WidenNewIV)</Highlight></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!WidenNewIV)</Highlight></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;HeaderVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</Highlight></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;Phi : HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WidenOriginalIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenIntOrFpInductionRecipe&gt;</a>(&amp;Phi);</Highlight></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!WidenOriginalIV || !WidenOriginalIV-&gt;isCanonical())</Highlight></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Replace WidenNewIV with WidenOriginalIV if WidenOriginalIV provides</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// everything WidenNewIV&#39;s users need. That is, WidenOriginalIV will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// generate a vector phi or all users of WidenNewIV demand the first lane</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// only.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(WidenOriginalIV-&gt;users(),</Highlight></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><Highlight kind="normal">               &#91;WidenOriginalIV&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><Highlight kind="normal">                 return !U-&gt;usesScalars(WidenOriginalIV);</Highlight></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><Highlight kind="normal">               &#125;) ||</Highlight></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/vputils/#a5e3c306be8d629a994f3644765421d5f">vputils::onlyFirstLaneUsed</a>(WidenNewIV)) &#123;</Highlight></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><Highlight kind="normal">      WidenNewIV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(WidenOriginalIV);</Highlight></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><Highlight kind="normal">      WidenNewIV-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#aac9dfb61b37082dca00de284bb3309e8">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><Highlight kind="comment">/// Returns true if \\p R is dead and can be removed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493" lineLink="#a6ba2ffb17342f2a0c54adaba2344cab0"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a6ba2ffb17342f2a0c54adaba2344cab0">isDeadRecipe</a>(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R) &#123;</Highlight></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</Highlight></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do remove conditional assume instructions as their conditions may be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// flattened.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RepR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReplicateRecipe&gt;</a>(&amp;R);</Highlight></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsConditionalAssume =</Highlight></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><Highlight kind="normal">      RepR &amp;&amp; RepR-&gt;isPredicated() &amp;&amp;</Highlight></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RepR-&gt;getUnderlyingInstr(), <a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::assume&gt;</a>());</Highlight></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsConditionalAssume)</Highlight></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (R.mayHaveSideEffects())</Highlight></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Recipe is dead if no user keeps the recipe alive.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(R.definedValues(),</Highlight></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><Highlight kind="normal">                &#91;&#93;(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;V) &#123; return V-&gt;getNumUsers() == 0; &#125;);</Highlight></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512" lineLink="/docs/api/structs/llvm/vplantransforms/#aaca9dd97d4c523d8c65274654abe4eb9"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#aaca9dd97d4c523d8c65274654abe4eb9">VPlanTransforms::removeDeadRecipes</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/reversepostordertraversal">ReversePostOrderTraversal&lt;VPBlockDeepTraversalWrapper&lt;VPBlockBase &#42;&gt;</a>&gt; RPOT(</Highlight></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><Highlight kind="normal">      Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>());</Highlight></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(<a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(RPOT))) &#123;</Highlight></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The recipes in the block are processed in reverse order, to catch chains</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// of dead recipes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(&#42;VPBB))) &#123;</Highlight></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a6ba2ffb17342f2a0c54adaba2344cab0">isDeadRecipe</a>(R))</Highlight></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><Highlight kind="normal">        R.eraseFromParent();</Highlight></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpscalarivstepsrecipe">VPScalarIVStepsRecipe</a> &#42;</Highlight></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527" lineLink="#a3c91ec836b0d1e340e17bff8eec31390"><Highlight kind="normal"><a href="#a3c91ec836b0d1e340e17bff8eec31390">createScalarIVSteps</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabcc">InductionDescriptor::InductionKind</a> Kind,</Highlight></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><Highlight kind="normal">                    <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> InductionOpcode,</Highlight></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><Highlight kind="normal">                    <a href="/docs/api/classes/llvm/fpmathoperator">FPMathOperator</a> &#42;FPBinOp, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TruncI,</Highlight></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><Highlight kind="normal">                    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;StartV, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Step, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><Highlight kind="normal">                    <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> &amp;Builder) &#123;</Highlight></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;HeaderVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</Highlight></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpcanonicalivphirecipe">VPCanonicalIVPHIRecipe</a> &#42;CanonicalIV = Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>();</Highlight></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpsingledefrecipe">VPSingleDefRecipe</a> &#42;BaseIV = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#a3d75b91bc4016f3078bab29877d8b68e">createDerivedIV</a>(</Highlight></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><Highlight kind="normal">      Kind, FPBinOp, StartV, CanonicalIV, Step, </Highlight><Highlight kind="stringliteral">&quot;offset.idx&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Truncate base induction if needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CanonicalIVType = CanonicalIV-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>();</Highlight></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo(CanonicalIVType);</Highlight></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ResultTy = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(BaseIV);</Highlight></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TruncI) &#123;</Highlight></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;TruncTy = TruncI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ResultTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &gt; TruncTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Not truncating.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ResultTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Truncation requires an integer type&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><Highlight kind="normal">    BaseIV = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#a7651e884685052147f007e0e0fe0c774">createScalarCast</a>(Instruction::Trunc, BaseIV, TruncTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><Highlight kind="normal">    ResultTy = TruncTy;</Highlight></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Truncate step if needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;StepTy = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(Step);</Highlight></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ResultTy != StepTy) &#123;</Highlight></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StepTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &gt; ResultTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Not truncating.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StepTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Truncation requires an integer type&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VecPreheader =</Highlight></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aeb7f03f5f68b01423a16a5dd469ddc71">getSingleHierarchicalPredecessor</a>());</Highlight></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpbuilder/insertpointguard">VPBuilder::InsertPointGuard</a> Guard(Builder);</Highlight></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><Highlight kind="normal">    Builder.<a href="/docs/api/classes/llvm/vpbuilder/#afc190306945dd17129c24477566099ce">setInsertPoint</a>(VecPreheader);</Highlight></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><Highlight kind="normal">    Step = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#a7651e884685052147f007e0e0fe0c774">createScalarCast</a>(Instruction::Trunc, Step, ResultTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Builder.<a href="/docs/api/classes/llvm/vpbuilder/#a9bdebe594005618b27255ea3ea2d2cdb">createScalarIVSteps</a>(InductionOpcode, FPBinOp, BaseIV, Step);</Highlight></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565" lineLink="#aa70c8f392e8295a96bfd493337e122fa"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPUser &#42;&gt;</a> <a href="#aa70c8f392e8295a96bfd493337e122fa">collectUsersRecursively</a>(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;VPUser &#42;&gt;</a> <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>(V-&gt;user&#95;begin(), V-&gt;user&#95;end());</Highlight></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.size(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Cur = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</Highlight></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPHeaderPHIRecipe&gt;</a>(Cur))</Highlight></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;V : Cur-&gt;<a href="/docs/api/classes/llvm/vpdef/#a5b7aa8b207f721cee2e80ebd99682563">definedValues</a>())</Highlight></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.insert(V-&gt;user&#95;begin(), V-&gt;user&#95;end());</Highlight></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.takeVector();</Highlight></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><Highlight kind="comment">/// Legalize VPWidenPointerInductionRecipe, by replacing it with a PtrAdd</Highlight></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><Highlight kind="comment">/// (IndStart, ScalarIVSteps (0, Step)) if only its scalar values are used, as</Highlight></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><Highlight kind="comment">/// VPWidenPointerInductionRecipe will generate vectors only. If some users</Highlight></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><Highlight kind="comment">/// require vectors while other require scalars, the scalar uses need to extract</Highlight></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><Highlight kind="comment">/// the scalars from the generated vectors (Note that this is different to how</Highlight></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><Highlight kind="comment">/// int/fp inductions are handled). Legalize extract-from-ends using uniform</Highlight></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><Highlight kind="comment">/// VPReplicateRecipe of wide inductions to use regular VPReplicateRecipe, so</Highlight></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><Highlight kind="comment">/// the correct end value is available. Also optimize</Highlight></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><Highlight kind="comment">/// VPWidenIntOrFpInductionRecipe, if any of its users needs scalar values, by</Highlight></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><Highlight kind="comment">/// providing them scalar steps built on the canonical scalar IV and update the</Highlight></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><Highlight kind="comment">/// original IV&#39;s users. This is an optional optimization to reduce the needs of</Highlight></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><Highlight kind="comment">/// vector extracts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589" lineLink="#a6bc9d4e47e8a41e60f4bedae712f0c03"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a6bc9d4e47e8a41e60f4bedae712f0c03">legalizeAndOptimizeInductions</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">llvm::VPlanPatternMatch</a>;</Highlight></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;HeaderVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</Highlight></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasOnlyVectorVFs = !Plan.<a href="/docs/api/classes/llvm/vplan/#a633dd97e642c10e8aa1dff2bd2874edb">hasVF</a>(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1));</Highlight></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> Builder(HeaderVPBB, HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>());</Highlight></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;Phi : HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PhiR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenInductionRecipe&gt;</a>(&amp;Phi);</Highlight></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PhiR)</Highlight></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Try to narrow wide and replicating recipes to uniform recipes, based on</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// VPlan analysis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Apply to all recipes in the future, to replace legacy uniformity</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// analysis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a> = <a href="#aa70c8f392e8295a96bfd493337e122fa">collectUsersRecursively</a>(PhiR);</Highlight></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(<a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>)) &#123;</Highlight></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Def = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPSingleDefRecipe&gt;</a>(U);</Highlight></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RepR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReplicateRecipe&gt;</a>(U);</Highlight></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Skip recipes that shouldn&#39;t be narrowed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Def || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPReplicateRecipe, VPWidenRecipe&gt;</a>(Def) ||</Highlight></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><Highlight kind="normal">          Def-&gt;getNumUsers() == 0 || !Def-&gt;getUnderlyingValue() ||</Highlight></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><Highlight kind="normal">          (RepR &amp;&amp; (RepR-&gt;isUniform() || RepR-&gt;isPredicated())))</Highlight></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Skip recipes that may have other lanes than their first used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/vputils/#a002a77cdbc23293b8f7a8458ffd0f905">vputils::isUniformAfterVectorization</a>(Def) &amp;&amp;</Highlight></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><Highlight kind="normal">          !<a href="/docs/api/namespaces/llvm/vputils/#a5e3c306be8d629a994f3644765421d5f">vputils::onlyFirstLaneUsed</a>(Def))</Highlight></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Clone = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a>(Def-&gt;getUnderlyingInstr(),</Highlight></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><Highlight kind="normal">                                          Def-&gt;operands(), </Highlight><Highlight kind="comment">/&#42;IsUniform&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><Highlight kind="normal">      Clone-&gt;insertAfter(Def);</Highlight></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><Highlight kind="normal">      Def-&gt;replaceAllUsesWith(Clone);</Highlight></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Replace wide pointer inductions which have only their scalars used by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// PtrAdd(IndStart, ScalarIVSteps (0, Step)).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PtrIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenPointerInductionRecipe&gt;</a>(&amp;Phi)) &#123;</Highlight></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PtrIV-&gt;onlyScalarsGenerated(Plan.<a href="/docs/api/classes/llvm/vplan/#a18b96ac619241bd2248a355af718a192">hasScalableVF</a>()))</Highlight></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> = PtrIV-&gt;getInductionDescriptor();</Highlight></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;StartV =</Highlight></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><Highlight kind="normal">          Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(ConstantInt::get(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getStep()-&gt;getType(), 0));</Highlight></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;StepV = PtrIV-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpscalarivstepsrecipe">VPScalarIVStepsRecipe</a> &#42;Steps = <a href="#a3c91ec836b0d1e340e17bff8eec31390">createScalarIVSteps</a>(</Highlight></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><Highlight kind="normal">          Plan, <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabccaf0191e822c9708e106d7bb58aa9ec947">InductionDescriptor::IK&#95;IntInduction</a>, Instruction::Add, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, StartV, StepV, PtrIV-&gt;getDebugLoc(), Builder);</Highlight></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;PtrAdd = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#a4098fdd65180c4601108d663dc6618c9">createPtrAdd</a>(PtrIV-&gt;getStartValue(), Steps,</Highlight></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><Highlight kind="normal">                                             PtrIV-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a733c4c530159a8b86223376c0696430e">getDebugLoc</a>(), </Highlight><Highlight kind="stringliteral">&quot;next.gep&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><Highlight kind="normal">      PtrIV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(PtrAdd);</Highlight></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Replace widened induction with scalar steps for users that only use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// scalars.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WideIV = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenIntOrFpInductionRecipe&gt;</a>(&amp;Phi);</Highlight></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasOnlyVectorVFs &amp;&amp; <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(WideIV-&gt;users(), &#91;WideIV&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><Highlight kind="normal">          return U-&gt;usesScalars(WideIV);</Highlight></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><Highlight kind="normal">        &#125;))</Highlight></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> = WideIV-&gt;getInductionDescriptor();</Highlight></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpscalarivstepsrecipe">VPScalarIVStepsRecipe</a> &#42;Steps = <a href="#a3c91ec836b0d1e340e17bff8eec31390">createScalarIVSteps</a>(</Highlight></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><Highlight kind="normal">        Plan, <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getKind(), <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getInductionOpcode(),</Highlight></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;FPMathOperator&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getInductionBinOp()),</Highlight></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><Highlight kind="normal">        WideIV-&gt;getTruncInst(), WideIV-&gt;getStartValue(), WideIV-&gt;getStepValue(),</Highlight></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><Highlight kind="normal">        WideIV-&gt;getDebugLoc(), Builder);</Highlight></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Update scalar users of IV to use Step instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!HasOnlyVectorVFs)</Highlight></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><Highlight kind="normal">      WideIV-&gt;replaceAllUsesWith(Steps);</Highlight></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><Highlight kind="normal">      WideIV-&gt;replaceUsesWithIf(Steps, &#91;WideIV&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &amp;U, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> U.usesScalars(WideIV);</Highlight></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><Highlight kind="comment">/// Check if \\p VPV is an untruncated wide induction, either before or after the</Highlight></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><Highlight kind="comment">/// increment. If so return the header IV (before the increment), otherwise</Highlight></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><Highlight kind="comment">/// return null.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673" lineLink="#aa35433def455d3f76738769247678052"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwideninductionrecipe">VPWidenInductionRecipe</a> &#42;<a href="#aa35433def455d3f76738769247678052">getOptimizableIVOf</a>(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;VPV) &#123;</Highlight></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WideIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenInductionRecipe&gt;</a>(VPV);</Highlight></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (WideIV) &#123;</Highlight></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// VPV itself is a wide induction, separately compute the end value for exit</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// users if it is not a truncated IV.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IntOrFpIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenIntOrFpInductionRecipe&gt;</a>(WideIV);</Highlight></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> (IntOrFpIV &amp;&amp; IntOrFpIV-&gt;getTruncInst()) ? nullptr : WideIV;</Highlight></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if VPV is an optimizable induction increment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Def = VPV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#a3be8d7833df422f3538ddb13af69bd70">getDefiningRecipe</a>();</Highlight></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Def || Def-&gt;getNumOperands() != 2)</Highlight></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><Highlight kind="normal">  WideIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenInductionRecipe&gt;</a>(Def-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!WideIV)</Highlight></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><Highlight kind="normal">    WideIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenInductionRecipe&gt;</a>(Def-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!WideIV)</Highlight></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsWideIVInc = &#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">VPlanPatternMatch</a>;</Highlight></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> = WideIV-&gt;getInductionDescriptor();</Highlight></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if VPV increments the induction by the induction step.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;IVStep = WideIV-&gt;getStepValue();</Highlight></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getInductionOpcode()) &#123;</Highlight></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Add:</Highlight></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VPV, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#afd2774999cdb5e105b5de1910aadc21a">m&#95;c&#95;Binary&lt;Instruction::Add&gt;</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(WideIV),</Highlight></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><Highlight kind="normal">                                                     <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(IVStep)));</Highlight></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FAdd:</Highlight></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VPV, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#afd2774999cdb5e105b5de1910aadc21a">m&#95;c&#95;Binary&lt;Instruction::FAdd&gt;</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(WideIV),</Highlight></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><Highlight kind="normal">                                                      <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(IVStep)));</Highlight></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FSub:</Highlight></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VPV, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a5693223ba55481975ccee9dbaa716d6f">m&#95;Binary&lt;Instruction::FSub&gt;</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(WideIV),</Highlight></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><Highlight kind="normal">                                                    <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(IVStep)));</Highlight></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Sub: &#123;</Highlight></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// IVStep will be the negated step of the subtraction. Check if Step == -1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// &#42; IVStep.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Step;</Highlight></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VPV,</Highlight></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><Highlight kind="normal">                 <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a5693223ba55481975ccee9dbaa716d6f">m&#95;Binary&lt;Instruction::Sub&gt;</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(Step))) ||</Highlight></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><Highlight kind="normal">          !Step-&gt;<a href="/docs/api/classes/llvm/vpvalue/#add6179d3564ac5ea4736366b93d23829">isLiveIn</a>() || !IVStep-&gt;<a href="/docs/api/classes/llvm/vpvalue/#add6179d3564ac5ea4736366b93d23829">isLiveIn</a>())</Highlight></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;StepCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Step-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ac6f0bd9ed63fe4a784697d73ae3b6fa0">getLiveInIRValue</a>());</Highlight></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IVStepCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(IVStep-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ac6f0bd9ed63fe4a784697d73ae3b6fa0">getLiveInIRValue</a>());</Highlight></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> StepCI &amp;&amp; IVStepCI &amp;&amp;</Highlight></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><Highlight kind="normal">             StepCI-&gt;getValue() == (-1 &#42; IVStepCI-&gt;getValue());</Highlight></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getKind() == <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabccab61689ca7d0a024fc4ff52a74d691ae2">InductionDescriptor::IK&#95;PtrInduction</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VPV, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a48b3e852725673dc15409c7048803b14">m&#95;GetElementPtr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(WideIV),</Highlight></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><Highlight kind="normal">                                        <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(WideIV-&gt;getStepValue())));</Highlight></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;should have been covered by switch above&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> IsWideIVInc() ? WideIV : </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731" lineLink="/docs/api/structs/llvm/vplantransforms/#a3a573419fed83f23b6bf70ac6731dbfa"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#a3a573419fed83f23b6bf70ac6731dbfa">VPlanTransforms::optimizeInductionExitUsers</a>(</Highlight></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;VPValue &#42;, VPValue &#42;&gt;</a> &amp;EndValues) &#123;</Highlight></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">VPlanPatternMatch</a>;</Highlight></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPIRBasicBlock &#42;&gt;</a> ExitVPBBs(Plan.<a href="/docs/api/classes/llvm/vplan/#a85800ca7a821f540ad2d6d4d3c2d4208">getExitBlocks</a>());</Highlight></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExitVPBBs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() != 1)</Highlight></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> &#42;ExitVPBB = ExitVPBBs&#91;0&#93;;</Highlight></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;PredVPBB = ExitVPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aa1bb4808c7a5db9f8ed3f479c78c4b5e">getSinglePredecessor</a>();</Highlight></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PredVPBB)</Highlight></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PredVPBB == Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;predecessor must be the middle block&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>());</Highlight></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#ac98e46fa8ff66b24ce678ddea88a23ac">getTerminator</a>());</Highlight></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : &#42;ExitVPBB) &#123;</Highlight></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExitIRI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPIRInstruction&gt;</a>(&amp;R);</Highlight></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(ExitIRI-&gt;getInstruction()))</Highlight></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/structs/llvm/incoming">Incoming</a>;</Highlight></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ExitIRI-&gt;getOperand(0),</Highlight></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a5438a63c52f3576904c86e1bf0c7a9ab">m&#95;VPInstruction&lt;VPInstruction::ExtractFromEnd&gt;</a>(</Highlight></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><Highlight kind="normal">                   <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(1))))</Highlight></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WideIV = <a href="#aa35433def455d3f76738769247678052">getOptimizableIVOf</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</Highlight></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!WideIV)</Highlight></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;EndValue = EndValues.<a href="/docs/api/classes/llvm/densemapbase/#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(WideIV);</Highlight></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndValue &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;end value must have been pre-computed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/incoming">Incoming</a> != WideIV) &#123;</Highlight></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><Highlight kind="normal">      ExitIRI-&gt;setOperand(0, EndValue);</Highlight></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Escape = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Step = WideIV-&gt;getStepValue();</Highlight></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarTy = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(WideIV);</Highlight></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ScalarTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>()) &#123;</Highlight></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><Highlight kind="normal">      Escape =</Highlight></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.createNaryOp(Instruction::Sub, &#123;EndValue, Step&#125;, &#123;&#125;, </Highlight><Highlight kind="stringliteral">&quot;ind.escape&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ScalarTy-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) &#123;</Highlight></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Zero = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(</Highlight></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><Highlight kind="normal">          ConstantInt::get(Step-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ac6f0bd9ed63fe4a784697d73ae3b6fa0">getLiveInIRValue</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 0));</Highlight></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><Highlight kind="normal">      Escape = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.createPtrAdd(EndValue,</Highlight></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><Highlight kind="normal">                              <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.createNaryOp(Instruction::Sub, &#123;Zero, Step&#125;),</Highlight></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><Highlight kind="normal">                              &#123;&#125;, </Highlight><Highlight kind="stringliteral">&quot;ind.escape&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ScalarTy-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>()) &#123;</Highlight></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> = WideIV-&gt;getInductionDescriptor();</Highlight></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><Highlight kind="normal">      Escape = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.createNaryOp(</Highlight></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getInductionBinOp()-&gt;getOpcode() == Instruction::FAdd</Highlight></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><Highlight kind="normal">              ? Instruction::FSub</Highlight></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><Highlight kind="normal">              : Instruction::FAdd,</Highlight></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><Highlight kind="normal">          &#123;EndValue, Step&#125;, &#123;ID.getInductionBinOp()-&gt;getFastMathFlags()&#125;);</Highlight></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;all possible induction types must be handled&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><Highlight kind="normal">    ExitIRI-&gt;setOperand(0, Escape);</Highlight></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><Highlight kind="comment">/// Remove redundant EpxandSCEVRecipes in \\p Plan&#39;s entry block by replacing</Highlight></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><Highlight kind="comment">/// them with already existing recipes expanding the same SCEV expression.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797" lineLink="#a8a0202a443a527ba17fcd111497feb7d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a8a0202a443a527ba17fcd111497feb7d">removeRedundantExpandSCEVRecipes</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const SCEV &#42;, VPValue &#42;&gt;</a> SCEV2VPV;</Highlight></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R :</Highlight></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><Highlight kind="normal">       <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>())) &#123;</Highlight></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExpR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPExpandSCEVRecipe&gt;</a>(&amp;R);</Highlight></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ExpR)</Highlight></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = SCEV2VPV.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;ExpR-&gt;getSCEV(), ExpR&#125;);</Highlight></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second)</Highlight></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><Highlight kind="normal">    ExpR-&gt;replaceAllUsesWith(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.first-&gt;second);</Highlight></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><Highlight kind="normal">    ExpR-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814" lineLink="#ab5d43362c1fefd60d9bfcc1e28ba4688"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#ab5d43362c1fefd60d9bfcc1e28ba4688">recursivelyDeleteDeadRecipes</a>(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;&gt;</a> WorkList;</Highlight></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;VPValue &#42;, 8&gt;</a> Seen;</Highlight></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><Highlight kind="normal">  WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(V);</Highlight></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Cur = WorkList.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Seen.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Cur).second)</Highlight></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;R = Cur-&gt;<a href="/docs/api/classes/llvm/vpvalue/#a3be8d7833df422f3538ddb13af69bd70">getDefiningRecipe</a>();</Highlight></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!R)</Highlight></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a6ba2ffb17342f2a0c54adaba2344cab0">isDeadRecipe</a>(&#42;R))</Highlight></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><Highlight kind="normal">    WorkList.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(R-&gt;op&#95;begin(), R-&gt;op&#95;end());</Highlight></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><Highlight kind="normal">    R-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><Highlight kind="comment">/// Try to simplify recipe \\p R.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834" lineLink="#a842c12e686e91a515dfd30a4bf70d740"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a842c12e686e91a515dfd30a4bf70d740">simplifyRecipe</a>(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R, <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> &amp;TypeInfo) &#123;</Highlight></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">llvm::VPlanPatternMatch</a>;</Highlight></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Blend = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPBlendRecipe&gt;</a>(&amp;R)) &#123;</Highlight></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Try to remove redundant blend recipes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;VPValue &#42;, 4&gt;</a> UniqueValues;</Highlight></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blend-&gt;isNormalized() || !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Blend-&gt;getMask(0), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a857db44d5e19818efc62c9ed25e6b4ea">m&#95;False</a>()))</Highlight></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><Highlight kind="normal">      UniqueValues.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Blend-&gt;getIncomingValue(0));</Highlight></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 1; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != Blend-&gt;getNumIncomingValues(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Blend-&gt;getMask(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a857db44d5e19818efc62c9ed25e6b4ea">m&#95;False</a>()))</Highlight></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><Highlight kind="normal">        UniqueValues.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Blend-&gt;getIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UniqueValues.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() == 1) &#123;</Highlight></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><Highlight kind="normal">      Blend-&gt;replaceAllUsesWith(&#42;UniqueValues.<a href="/docs/api/classes/llvm/smallptrsetimpl/#abf73a826b5d6f739eb4af48ddf14c5b4">begin</a>());</Highlight></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><Highlight kind="normal">      Blend-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blend-&gt;isNormalized())</Highlight></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Normalize the blend so its first incoming value is used as the initial</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// value with the others blended into it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> StartIndex = 0;</Highlight></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != Blend-&gt;getNumIncomingValues(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If a value&#39;s mask is used only by the blend then is can be deadcoded.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: Find the most expensive mask that can be deadcoded, or a mask</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// that&#39;s used by multiple blends where it can be removed from them all.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Mask = Blend-&gt;getMask(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Mask-&gt;getNumUsers() == 1 &amp;&amp; !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Mask, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a857db44d5e19818efc62c9ed25e6b4ea">m&#95;False</a>())) &#123;</Highlight></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><Highlight kind="normal">        StartIndex = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;, 4&gt;</a> OperandsWithMask;</Highlight></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><Highlight kind="normal">    OperandsWithMask.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Blend-&gt;getIncomingValue(StartIndex));</Highlight></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != Blend-&gt;getNumIncomingValues(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == StartIndex)</Highlight></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><Highlight kind="normal">      OperandsWithMask.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Blend-&gt;getIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><Highlight kind="normal">      OperandsWithMask.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Blend-&gt;getMask(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewBlend = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpblendrecipe">VPBlendRecipe</a>(</Highlight></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(Blend-&gt;getUnderlyingValue()), OperandsWithMask);</Highlight></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><Highlight kind="normal">    NewBlend-&gt;insertBefore(&amp;R);</Highlight></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;DeadMask = Blend-&gt;getMask(StartIndex);</Highlight></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><Highlight kind="normal">    Blend-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(NewBlend);</Highlight></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><Highlight kind="normal">    Blend-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><Highlight kind="normal">    <a href="#ab5d43362c1fefd60d9bfcc1e28ba4688">recursivelyDeleteDeadRecipes</a>(DeadMask);</Highlight></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>;</Highlight></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R, <a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>))))) &#123;</Highlight></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Trunc = R.getVPSingleValue();</Highlight></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;TruncTy = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(Trunc);</Highlight></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ATy = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</Highlight></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TruncTy == ATy) &#123;</Highlight></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><Highlight kind="normal">      Trunc-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</Highlight></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Don&#39;t replace a scalarizing recipe with a widened cast.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPReplicateRecipe&gt;</a>(&amp;R))</Highlight></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ATy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &lt; TruncTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>()) &#123;</Highlight></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ExtOpcode = <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(R.getOperand(0), <a href="/docs/api/namespaces/llvm/patternmatch/#ae5cf2b09af0c75d08cf9e5e8f2818a66">m&#95;SExt</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>()))</Highlight></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><Highlight kind="normal">                                 ? Instruction::SExt</Highlight></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><Highlight kind="normal">                                 : Instruction::ZExt;</Highlight></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VPC =</Highlight></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><Highlight kind="normal">            </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>(<a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a>(ExtOpcode), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, TruncTy);</Highlight></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UnderlyingExt = R.getOperand(0)-&gt;getUnderlyingValue()) &#123;</Highlight></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// UnderlyingExt has distinct return type, used to retain legacy cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><Highlight kind="normal">          VPC-&gt;setUnderlyingValue(UnderlyingExt);</Highlight></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><Highlight kind="normal">        VPC-&gt;insertBefore(&amp;R);</Highlight></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><Highlight kind="normal">        Trunc-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(VPC);</Highlight></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ATy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &gt; TruncTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>()) &#123;</Highlight></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VPC = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>(Instruction::Trunc, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, TruncTy);</Highlight></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><Highlight kind="normal">        VPC-&gt;insertBefore(&amp;R);</Highlight></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><Highlight kind="normal">        Trunc-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(VPC);</Highlight></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Verify that the cached type info is for both A and its users is still</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// accurate by comparing it to freshly computed types.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo2(</Highlight></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><Highlight kind="normal">        R.getParent()-&gt;getPlan()-&gt;getCanonicalIV()-&gt;getScalarType());</Highlight></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>) == TypeInfo2.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>));</Highlight></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;R = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(U);</Highlight></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;VPV : R-&gt;definedValues())</Highlight></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(VPV) == TypeInfo2.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(VPV));</Highlight></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Simplify (X &amp;&amp; Y) || (X &amp;&amp; !Y) -&gt; X.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Split up into simpler, modular combines: (X &amp;&amp; Y) || (X &amp;&amp; Z) into X</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &amp;&amp; (Y || Z) and (X || !X) into true. This requires queuing newly created</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// recipes to be visited during simplification.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, &#42;X1, &#42;Y1;</Highlight></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R,</Highlight></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a27cb031d5b7fd1ff6f33a45d823866d7">m&#95;c&#95;BinaryOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>)),</Highlight></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><Highlight kind="normal">                         <a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(X1), <a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(Y1))))) &amp;&amp;</Highlight></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> == X1 &amp;&amp; <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> == Y1) &#123;</Highlight></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><Highlight kind="normal">    R.getVPSingleValue()-&gt;replaceAllUsesWith(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>);</Highlight></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><Highlight kind="normal">    R.eraseFromParent();</Highlight></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R, <a href="/docs/api/namespaces/llvm/patternmatch/#af10813bee5ce9c7b412807aac434deef">m&#95;c&#95;Mul</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(1))))</Highlight></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> R.getVPSingleValue()-&gt;replaceAllUsesWith(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</Highlight></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R, <a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>)))))</Highlight></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> R.getVPSingleValue()-&gt;replaceAllUsesWith(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</Highlight></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove redundant DerviedIVs, that is 0 + A &#42; 1 -&gt; A and 0 + 0 &#42; x -&gt; 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R,</Highlight></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a8a1bf026bda785519069e37d7a7de192">m&#95;DerivedIV</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(0), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(1))) ||</Highlight></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><Highlight kind="normal">       <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R,</Highlight></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a8a1bf026bda785519069e37d7a7de192">m&#95;DerivedIV</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(0), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(0), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>()))) &amp;&amp;</Highlight></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><Highlight kind="normal">      TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(R.getOperand(1)) ==</Highlight></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><Highlight kind="normal">          TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(R.getVPSingleValue()))</Highlight></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> R.getVPSingleValue()-&gt;replaceAllUsesWith(R.getOperand(1));</Highlight></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><Highlight kind="comment">/// Try to simplify the recipes in \\p Plan. Use \\p CanonicalIVTy as type for all</Highlight></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><Highlight kind="comment">/// un-typed live-ins in VPTypeAnalysis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967" lineLink="#a74cb3294789bc24526bcadbf6b466714"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a74cb3294789bc24526bcadbf6b466714">simplifyRecipes</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/type">Type</a> &#42;CanonicalIVTy) &#123;</Highlight></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/reversepostordertraversal">ReversePostOrderTraversal&lt;VPBlockDeepTraversalWrapper&lt;VPBlockBase &#42;&gt;</a>&gt; RPOT(</Highlight></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><Highlight kind="normal">      Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>());</Highlight></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo(CanonicalIVTy);</Highlight></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(RPOT)) &#123;</Highlight></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;VPBB)) &#123;</Highlight></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><Highlight kind="normal">      <a href="#a842c12e686e91a515dfd30a4bf70d740">simplifyRecipe</a>(R, TypeInfo);</Highlight></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978" lineLink="/docs/api/structs/llvm/vplantransforms/#af25d938764b8634e70e95ff3f0c35129"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#af25d938764b8634e70e95ff3f0c35129">VPlanTransforms::optimizeForVFAndUF</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> BestVF,</Highlight></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><Highlight kind="normal">                                         </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> BestUF,</Highlight></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><Highlight kind="normal">                                         <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;PSE) &#123;</Highlight></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a633dd97e642c10e8aa1dff2bd2874edb">hasVF</a>(BestVF) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;BestVF is not available in Plan&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a6e9c2a69cd9bc0e46626f5302a03d3da">hasUF</a>(BestUF) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;BestUF is not available in Plan&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;VectorRegion = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</Highlight></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;ExitingVPBB = VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a28da654f916bf44da5513b6f1788835c">getExitingBasicBlock</a>();</Highlight></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Term = &amp;ExitingVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#ad0efc053a4e5325214b6de6f9f6e49d7">back</a>();</Highlight></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try to simplify the branch condition if TC &lt;= VF &#42; UF when preparing to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// execute the plan for the main vector loop. We only do this if the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// terminator is:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  1 BranchOnCount, or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  2 BranchOnCond where the input is Not(ActiveLaneMask).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">llvm::VPlanPatternMatch</a>;</Highlight></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Term, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a781b43897f427e5c19a39c57259146ed">m&#95;BranchOnCount</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>())) &amp;&amp;</Highlight></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Term,</Highlight></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#ab0e78b42dfbac0cbe15c785c4b815ba4">m&#95;BranchOnCond</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a35cc851a200ea1bb42140e0db2bd3274">m&#95;ActiveLaneMask</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>())))))</Highlight></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE = &#42;PSE.<a href="/docs/api/classes/llvm/predicatedscalarevolution/#a10ca5eacc61b5669880de2f8b0cff33c">getSE</a>();</Highlight></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;TripCount =</Highlight></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/vputils/#a5999b0390c92ee4af2544fe9772454bf">vputils::getSCEVExprForVPValue</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a2f5fc19caa67daeca8a1316c7e055e3c">getTripCount</a>(), SE);</Highlight></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(TripCount) &amp;&amp;</Highlight></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Trip count SCEV must be computable&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> NumElements = BestVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#aa5b3e822013fe51665e9bddc4874cd48">multiplyCoefficientBy</a>(BestUF);</Highlight></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = SE.<a href="/docs/api/classes/llvm/scalarevolution/#adfad3d829fd98014f225d55b4a924819">getElementCount</a>(TripCount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>(), NumElements);</Highlight></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TripCount-&gt;<a href="/docs/api/classes/llvm/scev/#a4541962f9c18aacceb7243520eb15e1f">isZero</a>() ||</Highlight></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><Highlight kind="normal">      !SE.<a href="/docs/api/classes/llvm/scalarevolution/#af74112dae88db73eb5484821b6f0fccd">isKnownPredicate</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">CmpInst::ICMP&#95;ULE</a>, TripCount, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))</Highlight></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The vector loop region only executes once. If possible, completely remove</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the region, otherwise replace the terminator controlling the latch with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (BranchOnCond true).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Header = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#a1ae2cb3c63b4d67324ddc947fb9696fc">getEntry</a>());</Highlight></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CanIVTy = Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>();</Highlight></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(</Highlight></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><Highlight kind="normal">          Header-&gt;phis(),</Highlight></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#af462c722ac0144c995057a2f6e616507">IsaPred&lt;VPCanonicalIVPHIRecipe, VPFirstOrderRecurrencePHIRecipe&gt;</a>)) &#123;</Highlight></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;HeaderR : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(Header-&gt;phis())) &#123;</Highlight></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;HeaderPhiR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPHeaderPHIRecipe&gt;</a>(&amp;HeaderR);</Highlight></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><Highlight kind="normal">      HeaderPhiR-&gt;replaceAllUsesWith(HeaderPhiR-&gt;getStartValue());</Highlight></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><Highlight kind="normal">      HeaderPhiR-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;Preheader = VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aa1bb4808c7a5db9f8ed3f479c78c4b5e">getSinglePredecessor</a>();</Highlight></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;Exit = VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>();</Highlight></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpblockutils/#a61f1451694a3638db85170c7f55d5581">VPBlockUtils::disconnectBlocks</a>(Preheader, VectorRegion);</Highlight></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpblockutils/#a61f1451694a3638db85170c7f55d5581">VPBlockUtils::disconnectBlocks</a>(VectorRegion, Exit);</Highlight></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> : <a href="/docs/api/namespaces/llvm/#a4474bfb1e0ca062e5bfe2a35980e7d19">vp&#95;depth&#95;first&#95;shallow</a>(VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#a1ae2cb3c63b4d67324ddc947fb9696fc">getEntry</a>()))</Highlight></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;setParent(</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpblockutils/#a40bc7fec35d7093efcdbadf566d6b5ee">VPBlockUtils::connectBlocks</a>(Preheader, Header);</Highlight></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpblockutils/#a40bc7fec35d7093efcdbadf566d6b5ee">VPBlockUtils::connectBlocks</a>(ExitingVPBB, Exit);</Highlight></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><Highlight kind="normal">    <a href="#a74cb3294789bc24526bcadbf6b466714">simplifyRecipes</a>(Plan, CanIVTy);</Highlight></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The vector region contains header phis for which we cannot remove the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// loop region yet.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = SE.<a href="/docs/api/classes/llvm/scalarevolution/#aff9e533399d91febd63fa4bfe82a42a7">getContext</a>();</Highlight></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BOC = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a>(</Highlight></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a0062eccdb4956531f7b6a3cf71c3320c">VPInstruction::BranchOnCond</a>,</Highlight></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><Highlight kind="normal">        &#123;Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(<a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(Ctx))&#125;, Term-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><Highlight kind="normal">    ExitingVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a23773e962f9a56c9bdf13f7668b063a5">appendRecipe</a>(BOC);</Highlight></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><Highlight kind="normal">  Term-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vplantransforms/#aaca9dd97d4c523d8c65274654abe4eb9">VPlanTransforms::removeDeadRecipes</a>(Plan);</Highlight></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><Highlight kind="normal">  Plan.<a href="/docs/api/classes/llvm/vplan/#a7ee6ab8541efab3e456a38d6c1fa1be2">setVF</a>(BestVF);</Highlight></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><Highlight kind="normal">  Plan.<a href="/docs/api/classes/llvm/vplan/#af1d539e508015e09e4b9fdb7d020da0e">setUF</a>(BestUF);</Highlight></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Further simplifications are possible</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//      1 Replace inductions with constants.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//      2 Replace vector loop region with VPBasicBlock.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><Highlight kind="comment">/// Sink users of \\p FOR after the recipe defining the previous value \\p</Highlight></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><Highlight kind="comment">/// Previous of the recurrence. \\returns true if all users of \\p FOR could be</Highlight></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><Highlight kind="comment">/// re-arranged as needed or false if it is not possible.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057" lineLink="#a4a5b1db18197a65d0f6a487f2e236921"><Highlight kind="normal"><a href="#a4a5b1db18197a65d0f6a487f2e236921">sinkRecurrenceUsersAfterPrevious</a>(<a href="/docs/api/structs/llvm/vpfirstorderrecurrencephirecipe">VPFirstOrderRecurrencePHIRecipe</a> &#42;FOR,</Highlight></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><Highlight kind="normal">                                 <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Previous,</Highlight></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><Highlight kind="normal">                                 <a href="/docs/api/classes/llvm/vpdominatortree">VPDominatorTree</a> &amp;VPDT) &#123;</Highlight></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect recipes that need sinking.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPRecipeBase &#42;&gt;</a> WorkList;</Highlight></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;VPRecipeBase &#42;, 8&gt;</a> Seen;</Highlight></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><Highlight kind="normal">  Seen.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Previous);</Highlight></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> TryToPushSinkCandidate = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;SinkCandidate) &#123;</Highlight></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The previous value must not depend on the users of the recurrence phi. In</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// that case, FOR is not a fixed order recurrence.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SinkCandidate == Previous)</Highlight></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPHeaderPHIRecipe&gt;</a>(SinkCandidate) ||</Highlight></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><Highlight kind="normal">        !Seen.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(SinkCandidate).second ||</Highlight></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><Highlight kind="normal">        VPDT.<a href="/docs/api/classes/llvm/vpdominatortree/#a044ef784dc6a77995842977a9956013f">properlyDominates</a>(Previous, SinkCandidate))</Highlight></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SinkCandidate-&gt;mayHaveSideEffects())</Highlight></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><Highlight kind="normal">    WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(SinkCandidate);</Highlight></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Recursively sink users of FOR after Previous.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><Highlight kind="normal">  WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FOR);</Highlight></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Current = WorkList&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Current-&gt;<a href="/docs/api/classes/llvm/vpdef/#a31492b9d8412415c2dae85e33e2748fd">getNumDefinedValues</a>() == 1 &amp;&amp;</Highlight></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;only recipes with a single defined value expected&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> : Current-&gt;<a href="/docs/api/classes/llvm/vpdef/#a76a983b694720483a3dd9fe57314e39b">getVPSingleValue</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TryToPushSinkCandidate(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>)))</Highlight></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Keep recipes to sink ordered by dominance so earlier instructions are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// processed first.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">sort</a>(WorkList, &#91;&amp;VPDT&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</Highlight></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> VPDT.<a href="/docs/api/classes/llvm/vpdominatortree/#a044ef784dc6a77995842977a9956013f">properlyDominates</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;SinkCandidate : WorkList) &#123;</Highlight></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SinkCandidate == FOR)</Highlight></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><Highlight kind="normal">    SinkCandidate-&gt;moveAfter(Previous);</Highlight></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><Highlight kind="normal">    Previous = SinkCandidate;</Highlight></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><Highlight kind="comment">/// Try to hoist \\p Previous and its operands before all users of \\p FOR.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112" lineLink="#a9396319801f74828cfbd94177f38eabc"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a9396319801f74828cfbd94177f38eabc">hoistPreviousBeforeFORUsers</a>(<a href="/docs/api/structs/llvm/vpfirstorderrecurrencephirecipe">VPFirstOrderRecurrencePHIRecipe</a> &#42;FOR,</Highlight></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Previous,</Highlight></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/vpdominatortree">VPDominatorTree</a> &amp;VPDT) &#123;</Highlight></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Previous-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a2408a88276528d80adefefa00995705a">mayHaveSideEffects</a>() || Previous-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a00bc7da040562d501bcc0e0635a2b53c">mayReadFromMemory</a>())</Highlight></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect recipes that need hoisting.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPRecipeBase &#42;&gt;</a> HoistCandidates;</Highlight></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;VPRecipeBase &#42;, 8&gt;</a> Visited;</Highlight></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;HoistPoint = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find the closest hoist point by looking at all users of FOR and selecting</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the recipe dominating all other users.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : FOR-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;R = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!HoistPoint || VPDT.<a href="/docs/api/classes/llvm/vpdominatortree/#a044ef784dc6a77995842977a9956013f">properlyDominates</a>(R, HoistPoint))</Highlight></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><Highlight kind="normal">      HoistPoint = R;</Highlight></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(FOR-&gt;users(),</Highlight></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><Highlight kind="normal">                &#91;&amp;VPDT, HoistPoint&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><Highlight kind="normal">                  auto &#42;R = cast&lt;VPRecipeBase&gt;(U);</Highlight></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><Highlight kind="normal">                  return HoistPoint == R ||</Highlight></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><Highlight kind="normal">                         VPDT.properlyDominates(HoistPoint, R);</Highlight></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><Highlight kind="normal">                &#125;) &amp;&amp;</Highlight></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;HoistPoint must dominate all users of FOR&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NeedsHoisting = &#91;HoistPoint, &amp;VPDT,</Highlight></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><Highlight kind="normal">                        &amp;Visited&#93;(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;HoistCandidateV) -&gt; <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;HoistCandidate = HoistCandidateV-&gt;getDefiningRecipe();</Highlight></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!HoistCandidate)</Highlight></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;EnclosingLoopRegion =</Highlight></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><Highlight kind="normal">        HoistCandidate-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a7ce23b4d08f0bd28ea1f676d527ae1d3">getEnclosingLoopRegion</a>();</Highlight></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!HoistCandidate-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a09de70cbaf2f15aa3b0697b5f378cc9d">getParent</a>() ||</Highlight></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><Highlight kind="normal">            HoistCandidate-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a09de70cbaf2f15aa3b0697b5f378cc9d">getParent</a>() == EnclosingLoopRegion) &amp;&amp;</Highlight></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;CFG in VPlan should still be flat, without replicate regions&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Hoist candidate was already visited, no need to hoist.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(HoistCandidate).second)</Highlight></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Candidate is outside loop region or a header phi, dominates FOR users w/o</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// hoisting.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!EnclosingLoopRegion || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPHeaderPHIRecipe&gt;</a>(HoistCandidate))</Highlight></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we reached a recipe that dominates HoistPoint, we don&#39;t need to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// hoist the recipe.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VPDT.<a href="/docs/api/classes/llvm/vpdominatortree/#a044ef784dc6a77995842977a9956013f">properlyDominates</a>(HoistCandidate, HoistPoint))</Highlight></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> HoistCandidate;</Highlight></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CanHoist = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;HoistCandidate) &#123;</Highlight></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Avoid hoisting candidates with side-effects, as we do not yet analyze</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// associated dependencies.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !HoistCandidate-&gt;mayHaveSideEffects();</Highlight></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NeedsHoisting(Previous-&gt;<a href="/docs/api/classes/llvm/vpdef/#a76a983b694720483a3dd9fe57314e39b">getVPSingleValue</a>()))</Highlight></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Recursively try to hoist Previous and its operands before all users of FOR.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><Highlight kind="normal">  HoistCandidates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Previous);</Highlight></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != HoistCandidates.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Current = HoistCandidates&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Current-&gt;<a href="/docs/api/classes/llvm/vpdef/#a31492b9d8412415c2dae85e33e2748fd">getNumDefinedValues</a>() == 1 &amp;&amp;</Highlight></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;only recipes with a single defined value expected&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CanHoist(Current))</Highlight></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : Current-&gt;<a href="/docs/api/classes/llvm/vpuser/#a11d83265a9e4ff6c6ecd3cf222ad0208">operands</a>()) &#123;</Highlight></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we reach FOR, it means the original Previous depends on some other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// recurrence that in turn depends on FOR. If that is the case, we would</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// also need to hoist recipes involving the other FOR, which may break</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// dependencies.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == FOR)</Highlight></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;R = NeedsHoisting(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</Highlight></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><Highlight kind="normal">        HoistCandidates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(R);</Highlight></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Order recipes to hoist by dominance so earlier instructions are processed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// first.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">sort</a>(HoistCandidates, &#91;&amp;VPDT&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</Highlight></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> VPDT.<a href="/docs/api/classes/llvm/vpdominatortree/#a044ef784dc6a77995842977a9956013f">properlyDominates</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;HoistCandidate : HoistCandidates) &#123;</Highlight></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><Highlight kind="normal">    HoistCandidate-&gt;moveBefore(&#42;HoistPoint-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>(),</Highlight></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><Highlight kind="normal">                               HoistPoint-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208" lineLink="/docs/api/structs/llvm/vplantransforms/#ae64d6953a1334207d9e7d9cd2587ee9f"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#ae64d6953a1334207d9e7d9cd2587ee9f">VPlanTransforms::adjustFixedOrderRecurrences</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan,</Highlight></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><Highlight kind="normal">                                                  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> &amp;LoopBuilder) &#123;</Highlight></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpdominatortree">VPDominatorTree</a> VPDT;</Highlight></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><Highlight kind="normal">  VPDT.<a href="/docs/api/classes/llvm/dominatortreebase/#aa0641ae965656ff9988d67a35140e4d9">recalculate</a>(Plan);</Highlight></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPFirstOrderRecurrencePHIRecipe &#42;&gt;</a> RecurrencePhis;</Highlight></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R :</Highlight></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><Highlight kind="normal">       Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#a1ae2cb3c63b4d67324ddc947fb9696fc">getEntry</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>())</Highlight></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;FOR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPFirstOrderRecurrencePHIRecipe&gt;</a>(&amp;R))</Highlight></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><Highlight kind="normal">      RecurrencePhis.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FOR);</Highlight></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/vpfirstorderrecurrencephirecipe">VPFirstOrderRecurrencePHIRecipe</a> &#42;FOR : RecurrencePhis) &#123;</Highlight></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;VPFirstOrderRecurrencePHIRecipe &#42;, 4&gt;</a> SeenPhis;</Highlight></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Previous = FOR-&gt;getBackedgeValue()-&gt;getDefiningRecipe();</Highlight></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Fixed-order recurrences do not contain cycles, so this loop is guaranteed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to terminate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PrevPhi =</Highlight></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;VPFirstOrderRecurrencePHIRecipe&gt;</a>(Previous)) &#123;</Highlight></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PrevPhi-&gt;getParent() == FOR-&gt;getParent());</Highlight></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SeenPhis.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(PrevPhi).second);</Highlight></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><Highlight kind="normal">      Previous = PrevPhi-&gt;getBackedgeValue()-&gt;getDefiningRecipe();</Highlight></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a4a5b1db18197a65d0f6a487f2e236921">sinkRecurrenceUsersAfterPrevious</a>(FOR, Previous, VPDT) &amp;&amp;</Highlight></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><Highlight kind="normal">        !<a href="#a9396319801f74828cfbd94177f38eabc">hoistPreviousBeforeFORUsers</a>(FOR, Previous, VPDT))</Highlight></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Introduce a recipe to combine the incoming and previous values of a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// fixed-order recurrence.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;InsertBlock = Previous-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>();</Highlight></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPHeaderPHIRecipe&gt;</a>(Previous))</Highlight></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><Highlight kind="normal">      LoopBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#afc190306945dd17129c24477566099ce">setInsertPoint</a>(InsertBlock, InsertBlock-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>());</Highlight></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><Highlight kind="normal">      LoopBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#afc190306945dd17129c24477566099ce">setInsertPoint</a>(InsertBlock,</Highlight></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><Highlight kind="normal">                                 std::next(Previous-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>()));</Highlight></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RecurSplice = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPInstruction&gt;</a>(</Highlight></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><Highlight kind="normal">        LoopBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a811727530f9a54b651d638943d34aa61">VPInstruction::FirstOrderRecurrenceSplice</a>,</Highlight></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><Highlight kind="normal">                                 &#123;FOR, FOR-&gt;getBackedgeValue()&#125;));</Highlight></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><Highlight kind="normal">    FOR-&gt;replaceAllUsesWith(RecurSplice);</Highlight></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Set the first operand of RecurSplice to FOR again, after replacing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// all users.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><Highlight kind="normal">    RecurSplice-&gt;setOperand(0, FOR);</Highlight></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256" lineLink="/docs/api/structs/llvm/vplantransforms/#ace9e1e6e7295914973dec18350b382ca"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#ace9e1e6e7295914973dec18350b382ca">VPlanTransforms::clearReductionWrapFlags</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R :</Highlight></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><Highlight kind="normal">       Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PhiR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReductionPHIRecipe&gt;</a>(&amp;R);</Highlight></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PhiR)</Highlight></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc = PhiR-&gt;getRecurrenceDescriptor();</Highlight></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> RK = RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>();</Highlight></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RK != <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">RecurKind::Add</a> &amp;&amp; RK != <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830ea62b6d55816cf737bfc6f42e60df1a3f2">RecurKind::Mul</a>)</Highlight></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : <a href="#aa70c8f392e8295a96bfd493337e122fa">collectUsersRecursively</a>(PhiR))</Highlight></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RecWithFlags = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPRecipeWithIRFlags&gt;</a>(U)) &#123;</Highlight></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><Highlight kind="normal">        RecWithFlags-&gt;dropPoisonGeneratingFlags();</Highlight></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><Highlight kind="comment">/// Move loop-invariant recipes out of the vector loop region in \\p Plan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275" lineLink="#afd081c92500bd333555e7bd6102b4d3e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp/#a9daa918c2c6be9aa9ca401f69cc75302">licm</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;Preheader = Plan.<a href="/docs/api/classes/llvm/vplan/#aee894572833ce02ad06c067d44f65b48">getVectorPreheader</a>();</Highlight></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Return true if we do not know how to (mechanically) hoist a given recipe</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// out of a loop region. Does not address legality concerns such as aliasing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// or speculation safety.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CannotHoistRecipe = &#91;&#93;(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R) &#123;</Highlight></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Allocas cannot be hoisted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RepR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReplicateRecipe&gt;</a>(&amp;R);</Highlight></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> RepR &amp;&amp; RepR-&gt;getOpcode() == Instruction::Alloca;</Highlight></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Hoist any loop invariant recipes from the vector loop region to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// preheader. Preform a shallow traversal of the vector loop region, to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// exclude recipes in replicate regions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;LoopRegion = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</Highlight></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(</Highlight></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#a4474bfb1e0ca062e5bfe2a35980e7d19">vp&#95;depth&#95;first&#95;shallow</a>(LoopRegion-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#a1ae2cb3c63b4d67324ddc947fb9696fc">getEntry</a>()))) &#123;</Highlight></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;VPBB)) &#123;</Highlight></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CannotHoistRecipe(R))</Highlight></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: Relax checks in the future, e.g. we could also hoist reads, if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// their memory location is not modified in the vector loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (R.mayHaveSideEffects() || R.mayReadFromMemory() || R.isPhi() ||</Highlight></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(R.operands(), &#91;&#93;(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123;</Highlight></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><Highlight kind="normal">            return !Op-&gt;isDefinedOutsideLoopRegions();</Highlight></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><Highlight kind="normal">          &#125;))</Highlight></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><Highlight kind="normal">      R.moveBefore(&#42;Preheader, Preheader-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a4a7f4b8433e9a788149ffd94a0a07051">end</a>());</Highlight></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308" lineLink="/docs/api/structs/llvm/vplantransforms/#ae61793492431f138869f097a5f31bd32"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#ae61793492431f138869f097a5f31bd32">VPlanTransforms::truncateToMinimalBitwidths</a>(</Highlight></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;Instruction &#42;, uint64&#95;t&gt;</a> &amp;MinBWs) &#123;</Highlight></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Count the processed recipes and cross check the count later with MinBWs</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// size, to make sure all entries in MinBWs have been handled.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumProcessedRecipes = 0;</Highlight></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Keep track of created truncates, so they can be re-used. Note that we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cannot use RAUW after creating a new truncate, as this would could make</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// other uses have different types for their operands, making them invalidly</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// typed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;VPValue &#42;, VPWidenCastRecipe &#42;&gt;</a> ProcessedTruncs;</Highlight></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CanonicalIVType = Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>();</Highlight></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo(CanonicalIVType);</Highlight></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;PH = Plan.<a href="/docs/api/classes/llvm/vplan/#aee894572833ce02ad06c067d44f65b48">getVectorPreheader</a>();</Highlight></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(</Highlight></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()))) &#123;</Highlight></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;VPBB)) &#123;</Highlight></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa</a>&lt;<a href="/docs/api/classes/llvm/vpwidenrecipe">VPWidenRecipe</a>, <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>, <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a>,</Highlight></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><Highlight kind="normal">               <a href="/docs/api/structs/llvm/vpwidenselectrecipe">VPWidenSelectRecipe</a>, <a href="/docs/api/structs/llvm/vpwidenloadrecipe">VPWidenLoadRecipe</a>&gt;(&amp;R))</Highlight></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;ResultVPV = R.getVPSingleValue();</Highlight></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UI = <a href="/docs/api/namespaces/llvm/#a3e627c32543ca70720c4270a8b11da3f">cast&#95;or&#95;null&lt;Instruction&gt;</a>(ResultVPV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#a5fe7dd2466300bd8747d81384a7ced5d">getUnderlyingValue</a>());</Highlight></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NewResSizeInBits = MinBWs.<a href="/docs/api/classes/llvm/mapvector/#abca23bddf517f69d28c6d30c58a7b6f9">lookup</a>(UI);</Highlight></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewResSizeInBits)</Highlight></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><Highlight kind="normal">      NumProcessedRecipes++;</Highlight></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the value wasn&#39;t vectorized, we must maintain the original scalar</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// type. Skip those here, after incrementing NumProcessedRecipes. Also</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// skip casts which do not need to be handled explicitly here, as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// redundant casts will be removed during recipe simplification.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPReplicateRecipe, VPWidenCastRecipe&gt;</a>(&amp;R)) &#123;</Highlight></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If any of the operands is a live-in and not used by VPWidenRecipe or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// VPWidenSelectRecipe, but in MinBWs, make sure it is counted as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// processed as well. When MinBWs is currently constructed, there is no</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// information about whether recipes are widened or replicated and in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// case they are reciplicated the operands are not truncated. Counting</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// them them here ensures we do not miss any recipes in MinBWs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// TODO: Remove once the analysis is done on VPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : R.operands()) &#123;</Highlight></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;isLiveIn())</Highlight></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UV = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getUnderlyingValue());</Highlight></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UV &amp;&amp; MinBWs.<a href="/docs/api/classes/llvm/mapvector/#a8757ce7071547a0410c82cc096b1ec9a">contains</a>(UV) &amp;&amp; !ProcessedTruncs.<a href="/docs/api/classes/llvm/densemapbase/#a836d9cba6deced0bb1fa7333ce5afd3a">contains</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;users(),</Highlight></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><Highlight kind="normal">                      <a href="/docs/api/namespaces/llvm/#af462c722ac0144c995057a2f6e616507">IsaPred&lt;VPWidenRecipe, VPWidenSelectRecipe&gt;</a>)) &#123;</Highlight></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// Add an entry to ProcessedTruncs to avoid counting the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// operand multiple times.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><Highlight kind="normal">            ProcessedTruncs&#91;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>&#93; = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><Highlight kind="normal">            NumProcessedRecipes += 1;</Highlight></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;OldResTy = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(ResultVPV);</Highlight></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OldResSizeInBits = OldResTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</Highlight></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldResTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;only integer types supported&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><Highlight kind="normal">      (void)OldResSizeInBits;</Highlight></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = CanonicalIVType-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>();</Highlight></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewResTy = <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(Ctx, NewResSizeInBits);</Highlight></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Any wrapping introduced by shrinking this operation shouldn&#39;t be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// considered undefined behavior. So, we can&#39;t unconditionally copy</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// arithmetic wrapping flags to VPW.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VPW = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPRecipeWithIRFlags&gt;</a>(&amp;R))</Highlight></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><Highlight kind="normal">        VPW-&gt;dropPoisonGeneratingFlags();</Highlight></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">llvm::VPlanPatternMatch</a>;</Highlight></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OldResSizeInBits != NewResSizeInBits &amp;&amp;</Highlight></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><Highlight kind="normal">          !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a5693223ba55481975ccee9dbaa716d6f">m&#95;Binary&lt;Instruction::ICmp&gt;</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>()))) &#123;</Highlight></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Extend result to original width.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Ext =</Highlight></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><Highlight kind="normal">            </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>(Instruction::ZExt, ResultVPV, OldResTy);</Highlight></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><Highlight kind="normal">        Ext-&gt;insertAfter(&amp;R);</Highlight></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><Highlight kind="normal">        ResultVPV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(Ext);</Highlight></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><Highlight kind="normal">        Ext-&gt;setOperand(0, ResultVPV);</Highlight></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldResSizeInBits &gt; NewResSizeInBits &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Nothing to shrink?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a5693223ba55481975ccee9dbaa716d6f">m&#95;Binary&lt;Instruction::ICmp&gt;</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>())) &amp;&amp;</Highlight></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><Highlight kind="normal">            </Highlight><Highlight kind="stringliteral">&quot;Only ICmps should not need extending the result.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenStoreRecipe&gt;</a>(&amp;R) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;stores cannot be narrowed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenLoadRecipe&gt;</a>(&amp;R))</Highlight></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Shrink operands by introducing truncates as needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> StartIdx = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenSelectRecipe&gt;</a>(&amp;R) ? 1 : 0;</Highlight></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = StartIdx; Idx != R.getNumOperands(); ++Idx) &#123;</Highlight></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = R.getOperand(Idx);</Highlight></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> OpSizeInBits =</Highlight></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><Highlight kind="normal">            TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</Highlight></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OpSizeInBits == NewResSizeInBits)</Highlight></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OpSizeInBits &gt; NewResSizeInBits &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;nothing to truncate&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#91;ProcessedIter, IterIsEmpty&#93; =</Highlight></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><Highlight kind="normal">            ProcessedTruncs.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">&#125;);</Highlight></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a> &#42;NewOp =</Highlight></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><Highlight kind="normal">            IterIsEmpty</Highlight></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><Highlight kind="normal">                ? </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>(Instruction::Trunc, <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, NewResTy)</Highlight></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><Highlight kind="normal">                : ProcessedIter-&gt;second;</Highlight></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><Highlight kind="normal">        R.setOperand(Idx, NewOp);</Highlight></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IterIsEmpty)</Highlight></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><Highlight kind="normal">        ProcessedIter-&gt;second = NewOp;</Highlight></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;isLiveIn()) &#123;</Highlight></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><Highlight kind="normal">          NewOp-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a8859e5e8cad5653b278964f47414fd84">insertBefore</a>(&amp;R);</Highlight></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><Highlight kind="normal">          PH-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a23773e962f9a56c9bdf13f7668b063a5">appendRecipe</a>(NewOp);</Highlight></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getLiveInIRValue());</Highlight></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><Highlight kind="normal">          </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsContained = MinBWs.<a href="/docs/api/classes/llvm/mapvector/#a8757ce7071547a0410c82cc096b1ec9a">contains</a>(OpInst);</Highlight></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><Highlight kind="normal">          NumProcessedRecipes += IsContained;</Highlight></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MinBWs.<a href="/docs/api/classes/llvm/mapvector/#acf4c09e1f30cdd4e0b5b1b8a236ead34">size</a>() == NumProcessedRecipes &amp;&amp;</Highlight></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;some entries in MinBWs haven&#39;t been processed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441" lineLink="/docs/api/structs/llvm/vplantransforms/#ae3449b993cd1c459995c2fe13ef50892"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#ae3449b993cd1c459995c2fe13ef50892">VPlanTransforms::optimize</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><Highlight kind="normal">  <a href="#aefd03ef5fc77c520e27fe794e8ec93e9">removeRedundantCanonicalIVs</a>(Plan);</Highlight></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><Highlight kind="normal">  <a href="#a2ff7a57c84a06ee83b0a28763db85c3f">removeRedundantInductionCasts</a>(Plan);</Highlight></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><Highlight kind="normal">  <a href="#a74cb3294789bc24526bcadbf6b466714">simplifyRecipes</a>(Plan, Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>());</Highlight></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vplantransforms/#aaca9dd97d4c523d8c65274654abe4eb9">removeDeadRecipes</a>(Plan);</Highlight></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><Highlight kind="normal">  <a href="#a6bc9d4e47e8a41e60f4bedae712f0c03">legalizeAndOptimizeInductions</a>(Plan);</Highlight></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><Highlight kind="normal">  <a href="#a8a0202a443a527ba17fcd111497feb7d">removeRedundantExpandSCEVRecipes</a>(Plan);</Highlight></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><Highlight kind="normal">  <a href="#a74cb3294789bc24526bcadbf6b466714">simplifyRecipes</a>(Plan, Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>());</Highlight></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vplantransforms/#aaca9dd97d4c523d8c65274654abe4eb9">removeDeadRecipes</a>(Plan);</Highlight></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vplantransforms/#a42d43068c576be2a1cd514f620246004">createAndOptimizeReplicateRegions</a>(Plan);</Highlight></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopsimplifycfg-cpp/#a5a5d8a7a6d46886bfb6350ed47c0f225">mergeBlocksIntoPredecessors</a>(Plan);</Highlight></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp/#a9daa918c2c6be9aa9ca401f69cc75302">licm</a>(Plan);</Highlight></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Add a VPActiveLaneMaskPHIRecipe and related recipes to \\p Plan and replace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><Highlight kind="normal"></Highlight><Highlight kind="comment">// the loop terminator with a branch-on-cond recipe with the negated</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><Highlight kind="normal"></Highlight><Highlight kind="comment">// active-lane-mask as operand. Note that this turns the loop into an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><Highlight kind="normal"></Highlight><Highlight kind="comment">// uncountable one. Only the existing terminator is replaced, all other existing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><Highlight kind="normal"></Highlight><Highlight kind="comment">// recipes/users remain unchanged, except for poison-generating flags being</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><Highlight kind="normal"></Highlight><Highlight kind="comment">// dropped from the canonical IV increment. Return the created</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><Highlight kind="normal"></Highlight><Highlight kind="comment">// VPActiveLaneMaskPHIRecipe.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The function uses the following definitions:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  %TripCount = DataWithControlFlowWithoutRuntimeCheck ?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    calculate-trip-count-minus-VF (original TC) : original TC</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  %IncrementValue = DataWithControlFlowWithoutRuntimeCheck ?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><Highlight kind="normal"></Highlight><Highlight kind="comment">//     CanonicalIVPhi : CanonicalIVIncrement</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  %StartV is the canonical induction start value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The function adds the following recipes:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><Highlight kind="normal"></Highlight><Highlight kind="comment">// vector.ph:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %TripCount = calculate-trip-count-minus-VF (original TC)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><Highlight kind="normal"></Highlight><Highlight kind="comment">//       &#91;if DataWithControlFlowWithoutRuntimeCheck&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %EntryInc = canonical-iv-increment-for-part %StartV</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %EntryALM = active-lane-mask %EntryInc, %TripCount</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><Highlight kind="normal"></Highlight><Highlight kind="comment">// vector.body:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %P = active-lane-mask-phi &#91; %EntryALM, %vector.ph &#93;, &#91; %ALM, %vector.body &#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   ...</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %InLoopInc = canonical-iv-increment-for-part %IncrementValue</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %ALM = active-lane-mask %InLoopInc, TripCount</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   %Negated = Not %ALM</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><Highlight kind="normal"></Highlight><Highlight kind="comment">//   branch-on-cond %Negated</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490" lineLink="#a5a9cb34d61fa4930ff585649d1d5b2ed"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpactivelanemaskphirecipe">VPActiveLaneMaskPHIRecipe</a> &#42;<a href="#a5a9cb34d61fa4930ff585649d1d5b2ed">addVPLaneMaskPhiAndUpdateExitBranch</a>(</Highlight></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">DataAndControlFlowWithoutRuntimeCheck</a>) &#123;</Highlight></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;TopRegion = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</Highlight></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;EB = TopRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a28da654f916bf44da5513b6f1788835c">getExitingBasicBlock</a>();</Highlight></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CanonicalIVPHI = Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>();</Highlight></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;StartV = CanonicalIVPHI-&gt;getStartValue();</Highlight></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CanonicalIVIncrement =</Highlight></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPInstruction&gt;</a>(CanonicalIVPHI-&gt;getBackedgeValue());</Highlight></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Check if dropping the flags is needed if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// !DataAndControlFlowWithoutRuntimeCheck.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><Highlight kind="normal">  CanonicalIVIncrement-&gt;dropPoisonGeneratingFlags();</Highlight></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = CanonicalIVIncrement-&gt;getDebugLoc();</Highlight></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We can&#39;t use StartV directly in the ActiveLaneMask VPInstruction, since</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we have to take unrolling into account. Each part needs to start at</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   Part &#42; VF</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VecPreheader = Plan.<a href="/docs/api/classes/llvm/vplan/#aee894572833ce02ad06c067d44f65b48">getVectorPreheader</a>();</Highlight></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> Builder(VecPreheader);</Highlight></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create the ActiveLaneMask instruction using the correct start values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;TC = Plan.<a href="/docs/api/classes/llvm/vplan/#a2f5fc19caa67daeca8a1316c7e055e3c">getTripCount</a>();</Highlight></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;TripCount, &#42;IncrementValue;</Highlight></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">DataAndControlFlowWithoutRuntimeCheck</a>) &#123;</Highlight></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// When the loop is guarded by a runtime overflow check for the loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// induction variable increment by VF, we can increment the value before</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the get.active.lane mask and use the unmodified tripcount.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><Highlight kind="normal">    IncrementValue = CanonicalIVIncrement;</Highlight></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><Highlight kind="normal">    TripCount = TC;</Highlight></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// When avoiding a runtime check, the active.lane.mask inside the loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// uses a modified trip count and the induction variable increment is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// done after the active.lane.mask intrinsic is called.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><Highlight kind="normal">    IncrementValue = CanonicalIVPHI;</Highlight></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><Highlight kind="normal">    TripCount = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2add61254acc7408bb3c3bb55765481418">VPInstruction::CalculateTripCountMinusVF</a>,</Highlight></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><Highlight kind="normal">                                     &#123;TC&#125;, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;EntryIncrement = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#ab3b191f35221f351f77883447fef4019">createOverflowingOp</a>(</Highlight></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2ad271d9d05bf5644dfa1487b3fc42a131">VPInstruction::CanonicalIVIncrementForPart</a>, &#123;StartV&#125;, &#123;</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">&#125;, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;index.part.next&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create the active lane mask instruction in the VPlan preheader.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;EntryALM =</Highlight></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a79a53c84dbac24c496a4c9a6cf70596c">VPInstruction::ActiveLaneMask</a>, &#123;EntryIncrement, TC&#125;,</Highlight></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><Highlight kind="normal">                           <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </Highlight><Highlight kind="stringliteral">&quot;active.lane.mask.entry&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now create the ActiveLaneMaskPhi recipe in the main loop using the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// preheader ActiveLaneMask instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LaneMaskPhi = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpactivelanemaskphirecipe">VPActiveLaneMaskPHIRecipe</a>(EntryALM, <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</Highlight></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><Highlight kind="normal">  LaneMaskPhi-&gt;insertAfter(CanonicalIVPHI);</Highlight></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create the active lane mask for the next iteration of the loop before the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// original terminator.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;OriginalTerminator = EB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#ac98e46fa8ff66b24ce678ddea88a23ac">getTerminator</a>();</Highlight></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/vpbuilder/#afc190306945dd17129c24477566099ce">setInsertPoint</a>(OriginalTerminator);</Highlight></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;InLoopIncrement =</Highlight></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/vpbuilder/#ab3b191f35221f351f77883447fef4019">createOverflowingOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2ad271d9d05bf5644dfa1487b3fc42a131">VPInstruction::CanonicalIVIncrementForPart</a>,</Highlight></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><Highlight kind="normal">                                  &#123;IncrementValue&#125;, &#123;</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">&#125;, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ALM = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a79a53c84dbac24c496a4c9a6cf70596c">VPInstruction::ActiveLaneMask</a>,</Highlight></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><Highlight kind="normal">                                   &#123;InLoopIncrement, TripCount&#125;, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><Highlight kind="normal">                                   </Highlight><Highlight kind="stringliteral">&quot;active.lane.mask.next&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><Highlight kind="normal">  LaneMaskPhi-&gt;<a href="/docs/api/classes/llvm/vpuser/#af4a3b471097ab37b1672a0d88869ea51">addOperand</a>(ALM);</Highlight></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace the original terminator with BranchOnCond. We have to invert the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// mask here because a true condition means jumping to the exit block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NotMask = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#acf2cdb4ec71a22869d4c491e220d6f0b">createNot</a>(ALM, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a0062eccdb4956531f7b6a3cf71c3320c">VPInstruction::BranchOnCond</a>, &#123;NotMask&#125;, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><Highlight kind="normal">  OriginalTerminator-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#aac9dfb61b37082dca00de284bb3309e8">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> LaneMaskPhi;</Highlight></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><Highlight kind="comment">/// Collect all VPValues representing a header mask through the (ICMP&#95;ULE,</Highlight></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><Highlight kind="comment">/// WideCanonicalIV, backedge-taken-count) pattern.</Highlight></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><Highlight kind="comment">/// TODO: Introduce explicit recipe for header-mask instead of searching</Highlight></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><Highlight kind="comment">/// for the header-mask pattern manually.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565" lineLink="#a8d0c6052d21638f0a385e226db3bd92f"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;&gt;</a> <a href="#a8d0c6052d21638f0a385e226db3bd92f">collectAllHeaderMasks</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;&gt;</a> WideCanonicalIVs;</Highlight></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;FoundWidenCanonicalIVUser =</Highlight></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac78c09ae232b2ce188ff590d51e3c268">find&#95;if</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>(),</Highlight></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><Highlight kind="normal">              &#91;&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123; return isa&lt;VPWidenCanonicalIVRecipe&gt;(U); &#125;);</Highlight></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac214df91cdc242f4710ea5a93939c678">count&#95;if</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>(),</Highlight></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><Highlight kind="normal">                  &#91;&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123; return isa&lt;VPWidenCanonicalIVRecipe&gt;(U); &#125;) &lt;=</Highlight></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><Highlight kind="normal">             1 &amp;&amp;</Highlight></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Must have at most one VPWideCanonicalIVRecipe&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FoundWidenCanonicalIVUser != Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>().<a href="/docs/api/classes/llvm/iterator-range/#aa0344673da91896d39f1b35755ee5d4e">end</a>()) &#123;</Highlight></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WideCanonicalIV =</Highlight></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenCanonicalIVRecipe&gt;</a>(&#42;FoundWidenCanonicalIVUser);</Highlight></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><Highlight kind="normal">    WideCanonicalIVs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(WideCanonicalIV);</Highlight></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Also include VPWidenIntOrFpInductionRecipes that represent a widened</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// version of the canonical induction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;HeaderVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</Highlight></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;Phi : HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WidenOriginalIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenIntOrFpInductionRecipe&gt;</a>(&amp;Phi);</Highlight></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (WidenOriginalIV &amp;&amp; WidenOriginalIV-&gt;isCanonical())</Highlight></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><Highlight kind="normal">      WideCanonicalIVs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(WidenOriginalIV);</Highlight></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Walk users of wide canonical IVs and collect to all compares of the form</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (ICMP&#95;ULE, WideCanonicalIV, backedge-taken-count).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;&gt;</a> HeaderMasks;</Highlight></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Wide : WideCanonicalIVs) &#123;</Highlight></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPUser &#42;&gt;</a>(Wide-&gt;users())) &#123;</Highlight></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;HeaderMask = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPInstruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!HeaderMask || !<a href="/docs/api/namespaces/llvm/vputils/#a96c706ef30193e00ac057bf24cf5719d">vputils::isHeaderMask</a>(HeaderMask, Plan))</Highlight></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(HeaderMask-&gt;getOperand(0) == Wide &amp;&amp;</Highlight></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;WidenCanonicalIV must be the first operand of the compare&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><Highlight kind="normal">      HeaderMasks.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(HeaderMask);</Highlight></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> HeaderMasks;</Highlight></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606" lineLink="/docs/api/structs/llvm/vplantransforms/#ae1d2d60cd9edd9f7ca98c50789747c95"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#ae1d2d60cd9edd9f7ca98c50789747c95">VPlanTransforms::addActiveLaneMask</a>(</Highlight></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> UseActiveLaneMaskForControlFlow,</Highlight></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">DataAndControlFlowWithoutRuntimeCheck</a>) &#123;</Highlight></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">DataAndControlFlowWithoutRuntimeCheck</a> ||</Highlight></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><Highlight kind="normal">          UseActiveLaneMaskForControlFlow) &amp;&amp;</Highlight></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;DataAndControlFlowWithoutRuntimeCheck implies &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;UseActiveLaneMaskForControlFlow&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;FoundWidenCanonicalIVUser =</Highlight></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac78c09ae232b2ce188ff590d51e3c268">find&#95;if</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>(),</Highlight></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><Highlight kind="normal">              &#91;&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123; return isa&lt;VPWidenCanonicalIVRecipe&gt;(U); &#125;);</Highlight></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FoundWidenCanonicalIVUser &amp;&amp;</Highlight></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Must have widened canonical IV when tail folding!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WideCanonicalIV =</Highlight></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenCanonicalIVRecipe&gt;</a>(&#42;FoundWidenCanonicalIVUser);</Highlight></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpsingledefrecipe">VPSingleDefRecipe</a> &#42;LaneMask;</Highlight></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UseActiveLaneMaskForControlFlow) &#123;</Highlight></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><Highlight kind="normal">    LaneMask = <a href="#a5a9cb34d61fa4930ff585649d1d5b2ed">addVPLaneMaskPhiAndUpdateExitBranch</a>(</Highlight></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><Highlight kind="normal">        Plan, <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">DataAndControlFlowWithoutRuntimeCheck</a>);</Highlight></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = <a href="/docs/api/classes/llvm/vpbuilder/#a84fe82982cb89a345442baaa710e949a">VPBuilder::getToInsertAfter</a>(WideCanonicalIV);</Highlight></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><Highlight kind="normal">    LaneMask = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.createNaryOp(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a79a53c84dbac24c496a4c9a6cf70596c">VPInstruction::ActiveLaneMask</a>,</Highlight></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><Highlight kind="normal">                              &#123;WideCanonicalIV, Plan.<a href="/docs/api/classes/llvm/vplan/#a2f5fc19caa67daeca8a1316c7e055e3c">getTripCount</a>()&#125;, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><Highlight kind="normal">                              </Highlight><Highlight kind="stringliteral">&quot;active.lane.mask&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Walk users of WideCanonicalIV and replace all compares of the form</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (ICMP&#95;ULE, WideCanonicalIV, backedge-taken-count) with an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// active-lane-mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;HeaderMask : <a href="#a8d0c6052d21638f0a385e226db3bd92f">collectAllHeaderMasks</a>(Plan))</Highlight></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><Highlight kind="normal">    HeaderMask-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(LaneMask);</Highlight></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><Highlight kind="comment">/// Try to convert \\p CurRecipe to a corresponding EVL-based recipe. Returns</Highlight></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><Highlight kind="comment">/// nullptr if no EVL-based recipe could be created.</Highlight></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><Highlight kind="comment">/// \\p HeaderMask  Header Mask.</Highlight></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><Highlight kind="comment">/// \\p CurRecipe   Recipe to be transform.</Highlight></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><Highlight kind="comment">/// \\p TypeInfo    VPlan-based type analysis.</Highlight></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><Highlight kind="comment">/// \\p AllOneMask  The vector mask parameter of vector-predication intrinsics.</Highlight></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><Highlight kind="comment">/// \\p EVL         The explicit vector length parameter of vector-predication</Highlight></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><Highlight kind="comment">/// intrinsics.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647" lineLink="#ad0faf4b8ff1cf3306958d056dcb2fde2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;<a href="#ad0faf4b8ff1cf3306958d056dcb2fde2">createEVLRecipe</a>(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;HeaderMask,</Highlight></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><Highlight kind="normal">                                     <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;CurRecipe,</Highlight></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><Highlight kind="normal">                                     <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> &amp;TypeInfo,</Highlight></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><Highlight kind="normal">                                     <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &amp;AllOneMask, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &amp;EVL) &#123;</Highlight></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">llvm::VPlanPatternMatch</a>;</Highlight></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GetNewMask = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;OrigMask) -&gt; <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OrigMask &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unmasked recipe when folding tail&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> HeaderMask == OrigMask ? nullptr : OrigMask;</Highlight></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/typeswitch">TypeSwitch&lt;VPRecipeBase &#42;, VPRecipeBase &#42;&gt;</a>(&amp;CurRecipe)</Highlight></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><Highlight kind="normal">      .<a href="/docs/api/classes/llvm/typeswitch/#a78c545287cbe57529ce7751e25c815a5">Case</a>&lt;<a href="/docs/api/structs/llvm/vpwidenloadrecipe">VPWidenLoadRecipe</a>&gt;(&#91;&amp;&#93;(<a href="/docs/api/structs/llvm/vpwidenloadrecipe">VPWidenLoadRecipe</a> &#42;L) &#123;</Highlight></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;NewMask = GetNewMask(L-&gt;getMask());</Highlight></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vpwidenloadevlrecipe">VPWidenLoadEVLRecipe</a>(&#42;L, EVL, NewMask);</Highlight></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><Highlight kind="normal">      &#125;)</Highlight></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><Highlight kind="normal">      .Case&lt;VPWidenStoreRecipe&gt;(&#91;&amp;&#93;(<a href="/docs/api/structs/llvm/vpwidenstorerecipe">VPWidenStoreRecipe</a> &#42;S) &#123;</Highlight></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;NewMask = GetNewMask(S-&gt;<a href="/docs/api/classes/llvm/vpwidenmemoryrecipe/#a6dab5a878379d5ee92940853d3feb53d">getMask</a>());</Highlight></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vpwidenstoreevlrecipe">VPWidenStoreEVLRecipe</a>(&#42;S, EVL, NewMask);</Highlight></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><Highlight kind="normal">      &#125;)</Highlight></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><Highlight kind="normal">      .Case&lt;VPWidenRecipe&gt;(&#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vpwidenrecipe">VPWidenRecipe</a> &#42;W) -&gt; <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Opcode = W-&gt;getOpcode();</Highlight></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/instruction/#a5c88132322ca3f46f242f7c023a57010">Instruction::isBinaryOp</a>(Opcode) &amp;&amp; !<a href="/docs/api/classes/llvm/instruction/#ae6249022aded13ad98775c11881bc117">Instruction::isUnaryOp</a>(Opcode))</Highlight></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidenevlrecipe">VPWidenEVLRecipe</a>(&#42;W, EVL);</Highlight></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><Highlight kind="normal">      &#125;)</Highlight></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><Highlight kind="normal">      .Case&lt;VPReductionRecipe&gt;(&#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vpreductionrecipe">VPReductionRecipe</a> &#42;Red) &#123;</Highlight></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;NewMask = GetNewMask(Red-&gt;getCondOp());</Highlight></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpreductionevlrecipe">VPReductionEVLRecipe</a>(&#42;Red, EVL, NewMask);</Highlight></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><Highlight kind="normal">      &#125;)</Highlight></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><Highlight kind="normal">      .Case&lt;VPWidenIntrinsicRecipe, VPWidenCastRecipe&gt;(</Highlight></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><Highlight kind="normal">          &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CR) -&gt; <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> VPID;</Highlight></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CallR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenIntrinsicRecipe&gt;</a>(CR)) &#123;</Highlight></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><Highlight kind="normal">              VPID =</Highlight></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><Highlight kind="normal">                  <a href="/docs/api/classes/llvm/vpintrinsic/#ad05203f409c9382a22a69ba01873f7fd">VPIntrinsic::getForIntrinsic</a>(CallR-&gt;getVectorIntrinsicID());</Highlight></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><Highlight kind="normal">            &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><Highlight kind="normal">              </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CastR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenCastRecipe&gt;</a>(CR);</Highlight></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><Highlight kind="normal">              VPID = <a href="/docs/api/classes/llvm/vpintrinsic/#a9c6880bafe83a767fa4a27bff91db390">VPIntrinsic::getForOpcode</a>(CastR-&gt;getOpcode());</Highlight></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><Highlight kind="normal">            &#125;</Highlight></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// Not all intrinsics have a corresponding VP intrinsic.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VPID == <a href="/docs/api/namespaces/llvm/intrinsic/#a35fedf4db6d756bd82501607f93c1e79aab5fb650050f184fa7c19c26abde5226">Intrinsic::not&#95;intrinsic</a>)</Highlight></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/vpintrinsic/#a15c8605718d066667e36c9dc890ad40a">VPIntrinsic::getMaskParamPos</a>(VPID) &amp;&amp;</Highlight></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><Highlight kind="normal">                   <a href="/docs/api/classes/llvm/vpintrinsic/#a88782f243be6d837a183d7abfe7b1a3c">VPIntrinsic::getVectorLengthParamPos</a>(VPID) &amp;&amp;</Highlight></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><Highlight kind="normal">                   </Highlight><Highlight kind="stringliteral">&quot;Expected VP intrinsic to have mask and EVL&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>(CR-&gt;operands());</Highlight></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><Highlight kind="normal">            <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(&amp;AllOneMask);</Highlight></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><Highlight kind="normal">            <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(&amp;EVL);</Highlight></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidenintrinsicrecipe">VPWidenIntrinsicRecipe</a>(</Highlight></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><Highlight kind="normal">                VPID, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(CR), CR-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><Highlight kind="normal">          &#125;)</Highlight></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><Highlight kind="normal">      .Case&lt;VPWidenSelectRecipe&gt;(&#91;&amp;&#93;(<a href="/docs/api/structs/llvm/vpwidenselectrecipe">VPWidenSelectRecipe</a> &#42;Sel) &#123;</Highlight></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>(Sel-&gt;<a href="/docs/api/classes/llvm/vpuser/#a11d83265a9e4ff6c6ecd3cf222ad0208">operands</a>());</Highlight></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(&amp;EVL);</Highlight></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidenintrinsicrecipe">VPWidenIntrinsicRecipe</a>(Intrinsic::vp&#95;select, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>,</Highlight></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><Highlight kind="normal">                                          TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(Sel),</Highlight></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><Highlight kind="normal">                                          Sel-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a733c4c530159a8b86223376c0696430e">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><Highlight kind="normal">      &#125;)</Highlight></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><Highlight kind="normal">      .Case&lt;VPInstruction&gt;(&#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a> &#42;VPI) -&gt; <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>;</Highlight></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Transform select with a header mask condition</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//   select(header&#95;mask, LHS, RHS)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// into vector predication merge.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><Highlight kind="normal">        </Highlight><Highlight kind="comment">//   vp.merge(all-true, LHS, RHS, EVL)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VPI, <a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(HeaderMask), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>),</Highlight></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><Highlight kind="normal">                                 <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>))))</Highlight></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Use all true as the condition because this transformation is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// limited to selects whose condition is a header mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidenintrinsicrecipe">VPWidenIntrinsicRecipe</a>(</Highlight></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><Highlight kind="normal">            Intrinsic::vp&#95;merge, &#123;&amp;AllOneMask, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, &amp;EVL&#125;,</Highlight></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><Highlight kind="normal">            TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), VPI-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a733c4c530159a8b86223376c0696430e">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><Highlight kind="normal">      &#125;)</Highlight></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><Highlight kind="normal">      .<a href="/docs/api/namespaces/llvm/#ae58c751054b01f206f9b9e34e461d25fa7a1920d61156abc05a60135aefe8bc67">Default</a>(&#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;R) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">; &#125;);</Highlight></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><Highlight kind="comment">/// Replace recipes with their EVL variants.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726" lineLink="#a5f39858b5d6d72b92c138916c64c90ba"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a5f39858b5d6d72b92c138916c64c90ba">transformRecipestoEVLRecipes</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &amp;EVL) &#123;</Highlight></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CanonicalIVType = Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>();</Highlight></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo(CanonicalIVType);</Highlight></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = CanonicalIVType-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>();</Highlight></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;AllOneMask = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(<a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(Ctx));</Highlight></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : <a href="/docs/api/namespaces/llvm/#a886094eaed7ce32029ea52a641142b88">to&#95;vector</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a2dffed680cc551f7ac6d92b3cd365d11">getVF</a>().<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>())) &#123;</Highlight></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;R = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReverseVectorPointerRecipe&gt;</a>(U))</Highlight></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><Highlight kind="normal">      R-&gt;setOperand(1, &amp;EVL);</Highlight></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPRecipeBase &#42;&gt;</a> ToErase;</Highlight></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;HeaderMask : <a href="#a8d0c6052d21638f0a385e226db3bd92f">collectAllHeaderMasks</a>(Plan)) &#123;</Highlight></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : <a href="#aa70c8f392e8295a96bfd493337e122fa">collectUsersRecursively</a>(HeaderMask)) &#123;</Highlight></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CurRecipe = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(U);</Highlight></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;EVLRecipe =</Highlight></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><Highlight kind="normal">          <a href="#ad0faf4b8ff1cf3306958d056dcb2fde2">createEVLRecipe</a>(HeaderMask, &#42;CurRecipe, TypeInfo, &#42;AllOneMask, EVL);</Highlight></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!EVLRecipe)</Highlight></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><Highlight kind="normal">      &#91;&#91;maybe&#95;unused&#93;&#93; </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumDefVal = EVLRecipe-&gt;<a href="/docs/api/classes/llvm/vpdef/#a31492b9d8412415c2dae85e33e2748fd">getNumDefinedValues</a>();</Highlight></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumDefVal == CurRecipe-&gt;getNumDefinedValues() &amp;&amp;</Highlight></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;New recipe must define the same number of values as the &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;original.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><Highlight kind="normal">          NumDefVal &lt;= 1 &amp;&amp;</Highlight></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Only supports recipes with a single definition or without users.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><Highlight kind="normal">      EVLRecipe-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a8859e5e8cad5653b278964f47414fd84">insertBefore</a>(CurRecipe);</Highlight></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPSingleDefRecipe, VPWidenLoadEVLRecipe&gt;</a>(EVLRecipe)) &#123;</Highlight></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;CurVPV = CurRecipe-&gt;getVPSingleValue();</Highlight></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><Highlight kind="normal">        CurVPV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(EVLRecipe-&gt;<a href="/docs/api/classes/llvm/vpdef/#a76a983b694720483a3dd9fe57314e39b">getVPSingleValue</a>());</Highlight></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Defer erasing recipes till the end so that we don&#39;t invalidate the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// VPTypeAnalysis cache.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><Highlight kind="normal">      ToErase.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CurRecipe);</Highlight></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;R : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(ToErase)) &#123;</Highlight></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;&gt;</a> PossiblyDead(R-&gt;operands());</Highlight></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><Highlight kind="normal">    R-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : PossiblyDead)</Highlight></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><Highlight kind="normal">      <a href="#ab5d43362c1fefd60d9bfcc1e28ba4688">recursivelyDeleteDeadRecipes</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><Highlight kind="comment">/// Add a VPEVLBasedIVPHIRecipe and related recipes to \\p Plan and</Highlight></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><Highlight kind="comment">/// replaces all uses except the canonical IV increment of</Highlight></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><Highlight kind="comment">/// VPCanonicalIVPHIRecipe with a VPEVLBasedIVPHIRecipe. VPCanonicalIVPHIRecipe</Highlight></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><Highlight kind="comment">/// is used only for loop iterations counting after this transformation.</Highlight></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><Highlight kind="comment">/// The function uses the following definitions:</Highlight></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><Highlight kind="comment">///  %StartV is the canonical induction start value.</Highlight></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><Highlight kind="comment">/// The function adds the following recipes:</Highlight></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><Highlight kind="comment">/// vector.ph:</Highlight></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><Highlight kind="comment">/// ...</Highlight></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><Highlight kind="comment">/// vector.body:</Highlight></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><Highlight kind="comment">/// ...</Highlight></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><Highlight kind="comment">/// %EVLPhi = EXPLICIT-VECTOR-LENGTH-BASED-IV-PHI &#91; %StartV, %vector.ph &#93;,</Highlight></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><Highlight kind="comment">///                                               &#91; %NextEVLIV, %vector.body &#93;</Highlight></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><Highlight kind="comment">/// %AVL = sub original TC, %EVLPhi</Highlight></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><Highlight kind="comment">/// %VPEVL = EXPLICIT-VECTOR-LENGTH %AVL</Highlight></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><Highlight kind="comment">/// ...</Highlight></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><Highlight kind="comment">/// %NextEVLIV = add IVSize (cast i32 %VPEVVL to IVSize), %EVLPhi</Highlight></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><Highlight kind="comment">/// ...</Highlight></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><Highlight kind="comment">/// If MaxSafeElements is provided, the function adds the following recipes:</Highlight></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><Highlight kind="comment">/// vector.ph:</Highlight></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><Highlight kind="comment">/// ...</Highlight></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><Highlight kind="comment">/// vector.body:</Highlight></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><Highlight kind="comment">/// ...</Highlight></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><Highlight kind="comment">/// %EVLPhi = EXPLICIT-VECTOR-LENGTH-BASED-IV-PHI &#91; %StartV, %vector.ph &#93;,</Highlight></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><Highlight kind="comment">///                                               &#91; %NextEVLIV, %vector.body &#93;</Highlight></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><Highlight kind="comment">/// %AVL = sub original TC, %EVLPhi</Highlight></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><Highlight kind="comment">/// %cmp = cmp ult %AVL, MaxSafeElements</Highlight></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><Highlight kind="comment">/// %SAFE&#95;AVL = select %cmp, %AVL, MaxSafeElements</Highlight></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><Highlight kind="comment">/// %VPEVL = EXPLICIT-VECTOR-LENGTH %SAFE&#95;AVL</Highlight></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><Highlight kind="comment">/// ...</Highlight></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><Highlight kind="comment">/// %NextEVLIV = add IVSize (cast i32 %VPEVL to IVSize), %EVLPhi</Highlight></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><Highlight kind="comment">/// ...</Highlight></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><Highlight kind="comment">///</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812" lineLink="/docs/api/structs/llvm/vplantransforms/#ad16bff9364e25351de81704fe81fd229"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#ad16bff9364e25351de81704fe81fd229">VPlanTransforms::tryAddExplicitVectorLength</a>(</Highlight></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> std::optional&lt;unsigned&gt; &amp;MaxSafeElements) &#123;</Highlight></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;Header = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</Highlight></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The transform updates all users of inductions to work based on EVL, instead</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the VF directly. At the moment, widened inductions cannot be updated, so</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// bail out if the plan contains any.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ContainsWidenInductions = <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(</Highlight></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><Highlight kind="normal">      Header-&gt;phis(),</Highlight></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#af462c722ac0144c995057a2f6e616507">IsaPred&lt;VPWidenIntOrFpInductionRecipe, VPWidenPointerInductionRecipe&gt;</a>);</Highlight></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ContainsWidenInductions)</Highlight></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CanonicalIVPHI = Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>();</Highlight></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;StartV = CanonicalIVPHI-&gt;getStartValue();</Highlight></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create the ExplicitVectorLengthPhi recipe in the main loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;EVLPhi = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpevlbasedivphirecipe">VPEVLBasedIVPHIRecipe</a>(StartV, <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</Highlight></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><Highlight kind="normal">  EVLPhi-&gt;insertAfter(CanonicalIVPHI);</Highlight></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> Builder(Header, Header-&gt;getFirstNonPhi());</Highlight></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Compute original TC - IV as the AVL (application vector length).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;AVL = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(</Highlight></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><Highlight kind="normal">      Instruction::Sub, &#123;Plan.<a href="/docs/api/classes/llvm/vplan/#a2f5fc19caa67daeca8a1316c7e055e3c">getTripCount</a>(), EVLPhi&#125;, <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>(), </Highlight><Highlight kind="stringliteral">&quot;avl&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaxSafeElements) &#123;</Highlight></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Support for MaxSafeDist for correct loop emission.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;AVLSafe = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(</Highlight></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><Highlight kind="normal">        ConstantInt::get(CanonicalIVPHI-&gt;getScalarType(), &#42;MaxSafeElements));</Highlight></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Cmp = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#a0b968ad86013a173bed6701425715dfb">createICmp</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>, AVL, AVLSafe);</Highlight></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><Highlight kind="normal">    AVL = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#aebcef96452964d918ecdf28d1835115e">createSelect</a>(Cmp, AVL, AVLSafe, <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>(), </Highlight><Highlight kind="stringliteral">&quot;safe&#95;avl&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VPEVL = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a8c9deab6571a0b4db0c69c64c0d682eb">VPInstruction::ExplicitVectorLength</a>, AVL,</Highlight></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><Highlight kind="normal">                                     <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</Highlight></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CanonicalIVIncrement =</Highlight></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPInstruction&gt;</a>(CanonicalIVPHI-&gt;getBackedgeValue());</Highlight></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpsingledefrecipe">VPSingleDefRecipe</a> &#42;OpVPEVL = VPEVL;</Highlight></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IVSize = CanonicalIVPHI-&gt;getScalarType()-&gt;getScalarSizeInBits();</Highlight></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><Highlight kind="normal">      IVSize != 32) &#123;</Highlight></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><Highlight kind="normal">    OpVPEVL = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpscalarcastrecipe">VPScalarCastRecipe</a>(</Highlight></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><Highlight kind="normal">        IVSize &lt; 32 ? Instruction::Trunc : Instruction::ZExt, OpVPEVL,</Highlight></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><Highlight kind="normal">        CanonicalIVPHI-&gt;getScalarType(), CanonicalIVIncrement-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a733c4c530159a8b86223376c0696430e">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><Highlight kind="normal">    OpVPEVL-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a8859e5e8cad5653b278964f47414fd84">insertBefore</a>(CanonicalIVIncrement);</Highlight></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NextEVLIV =</Highlight></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a>(Instruction::Add, &#123;OpVPEVL, EVLPhi&#125;,</Highlight></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><Highlight kind="normal">                        &#123;CanonicalIVIncrement-&gt;hasNoUnsignedWrap(),</Highlight></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><Highlight kind="normal">                         CanonicalIVIncrement-&gt;hasNoSignedWrap()&#125;,</Highlight></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><Highlight kind="normal">                        CanonicalIVIncrement-&gt;getDebugLoc(), </Highlight><Highlight kind="stringliteral">&quot;index.evl.next&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><Highlight kind="normal">  NextEVLIV-&gt;insertBefore(CanonicalIVIncrement);</Highlight></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><Highlight kind="normal">  EVLPhi-&gt;addOperand(NextEVLIV);</Highlight></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><Highlight kind="normal">  <a href="#a5f39858b5d6d72b92c138916c64c90ba">transformRecipestoEVLRecipes</a>(Plan, &#42;VPEVL);</Highlight></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace all uses of VPCanonicalIVPHIRecipe by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// VPEVLBasedIVPHIRecipe except for the canonical IV increment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><Highlight kind="normal">  CanonicalIVPHI-&gt;replaceAllUsesWith(EVLPhi);</Highlight></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><Highlight kind="normal">  CanonicalIVIncrement-&gt;setOperand(0, CanonicalIVPHI);</Highlight></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: support unroll factor &gt; 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><Highlight kind="normal">  Plan.<a href="/docs/api/classes/llvm/vplan/#af1d539e508015e09e4b9fdb7d020da0e">setUF</a>(1);</Highlight></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873" lineLink="/docs/api/structs/llvm/vplantransforms/#aa0f143b8d4693978b984f0639c90e508"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#aa0f143b8d4693978b984f0639c90e508">VPlanTransforms::dropPoisonGeneratingRecipes</a>(</Highlight></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal">(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;)&gt; BlockNeedsPredication) &#123;</Highlight></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect recipes in the backward slice of &#96;Root&#96; that may generate a poison</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// value that is used after vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;VPRecipeBase &#42;, 16&gt;</a> Visited;</Highlight></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CollectPoisonGeneratingInstrsInBackwardSlice(&#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Root) &#123;</Highlight></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPRecipeBase &#42;, 16&gt;</a> Worklist;</Highlight></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><Highlight kind="normal">    Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Root);</Highlight></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Traverse the backward slice of Root through its use-def chain.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;CurRec = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(CurRec).second)</Highlight></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Prune search if we find another recipe generating a widen memory</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// instruction. Widen memory instructions involved in address computation</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// will lead to gather/scatter instructions, which don&#39;t need to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// handled.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa</a>&lt;<a href="/docs/api/classes/llvm/vpwidenmemoryrecipe">VPWidenMemoryRecipe</a>, <a href="/docs/api/classes/llvm/vpinterleaverecipe">VPInterleaveRecipe</a>, <a href="/docs/api/classes/llvm/vpscalarivstepsrecipe">VPScalarIVStepsRecipe</a>,</Highlight></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><Highlight kind="normal">              <a href="/docs/api/classes/llvm/vpheaderphirecipe">VPHeaderPHIRecipe</a>&gt;(CurRec))</Highlight></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This recipe contributes to the address computation of a widen</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// load/store. If the underlying instruction has poison-generating flags,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// drop them directly.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RecWithFlags = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPRecipeWithIRFlags&gt;</a>(CurRec)) &#123;</Highlight></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>;</Highlight></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">llvm::VPlanPatternMatch</a>;</Highlight></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Dropping disjoint from an OR may yield incorrect results, as some</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// analysis may have converted it to an Add implicitly (e.g. SCEV used</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// for dependence analysis). Instead, replace it with an equivalent Add.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// This is possible as all users of the disjoint OR only access lanes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// where the operands are disjoint or poison otherwise.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RecWithFlags, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a146cd384ae370a9b6de9cd181ad4ec14">m&#95;BinaryOr</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))) &amp;&amp;</Highlight></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><Highlight kind="normal">            RecWithFlags-&gt;isDisjoint()) &#123;</Highlight></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> Builder(RecWithFlags);</Highlight></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a> &#42;New = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#ab3b191f35221f351f77883447fef4019">createOverflowingOp</a>(</Highlight></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><Highlight kind="normal">              Instruction::Add, &#123;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>&#125;, &#123;</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">&#125;,</Highlight></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><Highlight kind="normal">              RecWithFlags-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><Highlight kind="normal">          New-&gt;setUnderlyingValue(RecWithFlags-&gt;getUnderlyingValue());</Highlight></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><Highlight kind="normal">          RecWithFlags-&gt;replaceAllUsesWith(New);</Highlight></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><Highlight kind="normal">          RecWithFlags-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><Highlight kind="normal">          CurRec = New;</Highlight></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><Highlight kind="normal">          RecWithFlags-&gt;dropPoisonGeneratingFlags();</Highlight></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(</Highlight></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><Highlight kind="normal">            CurRec-&gt;<a href="/docs/api/classes/llvm/vpdef/#a76a983b694720483a3dd9fe57314e39b">getVPSingleValue</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#a5fe7dd2466300bd8747d81384a7ced5d">getUnderlyingValue</a>());</Highlight></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><Highlight kind="normal">        (void)Instr;</Highlight></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!Instr || !Instr-&gt;hasPoisonGeneratingFlags()) &amp;&amp;</Highlight></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;found instruction with poison generating flags not covered by &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;VPRecipeWithIRFlags&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Add new definitions to the worklist.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Operand : CurRec-&gt;<a href="/docs/api/classes/llvm/vpuser/#a11d83265a9e4ff6c6ecd3cf222ad0208">operands</a>())</Highlight></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;OpDef = Operand-&gt;getDefiningRecipe())</Highlight></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><Highlight kind="normal">          Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpDef);</Highlight></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Traverse all the recipes in the VPlan and collect the poison-generating</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// recipes in the backward slice starting at the address of a VPWidenRecipe or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// VPInterleaveRecipe.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Iter = <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>());</Highlight></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(Iter)) &#123;</Highlight></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;Recipe : &#42;VPBB) &#123;</Highlight></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WidenRec = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenMemoryRecipe&gt;</a>(&amp;Recipe)) &#123;</Highlight></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;UnderlyingInstr = WidenRec-&gt;getIngredient();</Highlight></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;AddrDef = WidenRec-&gt;getAddr()-&gt;getDefiningRecipe();</Highlight></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddrDef &amp;&amp; WidenRec-&gt;isConsecutive() &amp;&amp;</Highlight></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><Highlight kind="normal">            BlockNeedsPredication(UnderlyingInstr.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()))</Highlight></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><Highlight kind="normal">          CollectPoisonGeneratingInstrsInBackwardSlice(AddrDef);</Highlight></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;InterleaveRec = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPInterleaveRecipe&gt;</a>(&amp;Recipe)) &#123;</Highlight></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;AddrDef = InterleaveRec-&gt;getAddr()-&gt;getDefiningRecipe();</Highlight></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddrDef) &#123;</Highlight></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Check if any member of the interleave group needs predication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/interleavegroup">InterleaveGroup&lt;Instruction&gt;</a> &#42;InterGroup =</Highlight></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><Highlight kind="normal">              InterleaveRec-&gt;getInterleaveGroup();</Highlight></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><Highlight kind="normal">          </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> NeedPredication = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, NumMembers = InterGroup-&gt;<a href="/docs/api/classes/llvm/interleavegroup/#af81c826ee51addc3321e4ef1c1934696">getNumMembers</a>();</Highlight></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><Highlight kind="normal">               <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumMembers; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Member = InterGroup-&gt;<a href="/docs/api/classes/llvm/interleavegroup/#a5085afe1fa721f3ef5bf09ca7fc7537c">getMember</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Member)</Highlight></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><Highlight kind="normal">              NeedPredication |= BlockNeedsPredication(Member-&gt;getParent());</Highlight></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NeedPredication)</Highlight></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><Highlight kind="normal">            CollectPoisonGeneratingInstrsInBackwardSlice(AddrDef);</Highlight></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970" lineLink="/docs/api/structs/llvm/vplantransforms/#aa88371693bc18186386b04e8c45a30e4"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#aa88371693bc18186386b04e8c45a30e4">VPlanTransforms::createInterleaveGroups</a>(</Highlight></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan,</Highlight></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/interleavegroup">InterleaveGroup&lt;Instruction&gt;</a> &#42;&gt;</Highlight></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><Highlight kind="normal">        &amp;InterleaveGroups,</Highlight></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vprecipebuilder">VPRecipeBuilder</a> &amp;RecipeBuilder, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ScalarEpilogueAllowed) &#123;</Highlight></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InterleaveGroups.empty())</Highlight></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Interleave memory: for each Interleave Group we marked earlier as relevant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// for this VPlan, replace the Recipes widening its memory instructions with a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// single VPInterleaveRecipe at its insertion point.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpdominatortree">VPDominatorTree</a> VPDT;</Highlight></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><Highlight kind="normal">  VPDT.<a href="/docs/api/classes/llvm/dominatortreebase/#aa0641ae965656ff9988d67a35140e4d9">recalculate</a>(Plan);</Highlight></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IG : InterleaveGroups) &#123;</Highlight></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;, 4&gt;</a> StoredValues;</Highlight></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i &lt; IG-&gt;getFactor(); ++i)</Highlight></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;StoreInst&gt;</a>(IG-&gt;getMember(i))) &#123;</Highlight></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;StoreR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenStoreRecipe&gt;</a>(RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#af5f874dc688e86699e648825bfcbf495">getRecipe</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>));</Highlight></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><Highlight kind="normal">        StoredValues.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(StoreR-&gt;getStoredValue());</Highlight></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> NeedsMaskForGaps =</Highlight></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><Highlight kind="normal">        IG-&gt;requiresScalarEpilogue() &amp;&amp; !ScalarEpilogueAllowed;</Highlight></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IRInsertPos = IG-&gt;getInsertPos();</Highlight></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;InsertPos =</Highlight></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenMemoryRecipe&gt;</a>(RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#af5f874dc688e86699e648825bfcbf495">getRecipe</a>(IRInsertPos));</Highlight></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Get or create the start address for the interleave group.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Start =</Highlight></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenMemoryRecipe&gt;</a>(RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#af5f874dc688e86699e648825bfcbf495">getRecipe</a>(IG-&gt;getMember(0)));</Highlight></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Addr = Start-&gt;getAddr();</Highlight></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;AddrDef = Addr-&gt;<a href="/docs/api/classes/llvm/vpvalue/#a3be8d7833df422f3538ddb13af69bd70">getDefiningRecipe</a>();</Highlight></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddrDef &amp;&amp; !VPDT.<a href="/docs/api/classes/llvm/vpdominatortree/#a044ef784dc6a77995842977a9956013f">properlyDominates</a>(AddrDef, InsertPos)) &#123;</Highlight></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: Hoist Addr&#39;s defining recipe (and any operands as needed) to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// InsertPos or sink loads above zero members to join it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> InBounds = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Gep = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(</Highlight></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(IRInsertPos)-&gt;stripPointerCasts()))</Highlight></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><Highlight kind="normal">        InBounds = Gep-&gt;isInBounds();</Highlight></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We cannot re-use the address of member zero because it does not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// dominate the insert position. Instead, use the address of the insert</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// position and create a PtrAdd adjusting it to the address of member</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// zero.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IG-&gt;getIndex(IRInsertPos) != 0 &amp;&amp;</Highlight></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;index of insert position shouldn&#39;t be zero&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = IRInsertPos-&gt;<a href="/docs/api/classes/llvm/instruction/#af65afd02332c4f21c2fab7d217d6600f">getDataLayout</a>();</Highlight></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/apint">APInt</a> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>(32,</Highlight></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><Highlight kind="normal">                   <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(<a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(IRInsertPos)) &#42;</Highlight></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><Highlight kind="normal">                       IG-&gt;getIndex(IRInsertPos),</Highlight></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><Highlight kind="normal">                   </Highlight><Highlight kind="comment">/&#42;IsSigned=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;OffsetVPV = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(</Highlight></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><Highlight kind="normal">          ConstantInt::get(IRInsertPos-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getContext(), -<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>));</Highlight></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>(InsertPos);</Highlight></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><Highlight kind="normal">      Addr = InBounds ? <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.createInBoundsPtrAdd(InsertPos-&gt;getAddr(), OffsetVPV)</Highlight></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><Highlight kind="normal">                      : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.createPtrAdd(InsertPos-&gt;getAddr(), OffsetVPV);</Highlight></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VPIG = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpinterleaverecipe">VPInterleaveRecipe</a>(IG, Addr, StoredValues,</Highlight></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><Highlight kind="normal">                                        InsertPos-&gt;getMask(), NeedsMaskForGaps);</Highlight></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><Highlight kind="normal">    VPIG-&gt;insertBefore(InsertPos);</Highlight></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> J = 0;</Highlight></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i &lt; IG-&gt;getFactor(); ++i)</Highlight></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Member = IG-&gt;getMember(i)) &#123;</Highlight></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;MemberR = RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#af5f874dc688e86699e648825bfcbf495">getRecipe</a>(Member);</Highlight></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Member-&gt;getType()-&gt;isVoidTy()) &#123;</Highlight></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;OriginalV = MemberR-&gt;<a href="/docs/api/classes/llvm/vpdef/#a76a983b694720483a3dd9fe57314e39b">getVPSingleValue</a>();</Highlight></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><Highlight kind="normal">          OriginalV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(VPIG-&gt;getVPValue(J));</Highlight></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><Highlight kind="normal">          J++;</Highlight></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><Highlight kind="normal">        MemberR-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#aac9dfb61b37082dca00de284bb3309e8">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046" lineLink="/docs/api/structs/llvm/vplantransforms/#a63e564d621011fac5978d18138121e5c"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#a63e564d621011fac5978d18138121e5c">VPlanTransforms::convertToConcreteRecipes</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(</Highlight></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()))) &#123;</Highlight></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(VPBB-&gt;phis())) &#123;</Highlight></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPCanonicalIVPHIRecipe, VPEVLBasedIVPHIRecipe&gt;</a>(&amp;R))</Highlight></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PhiR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPHeaderPHIRecipe&gt;</a>(&amp;R);</Highlight></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name =</Highlight></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPCanonicalIVPHIRecipe&gt;</a>(PhiR) ? </Highlight><Highlight kind="stringliteral">&quot;index&quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;evl.based.iv&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ScalarR =</Highlight></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpscalarphirecipe">VPScalarPHIRecipe</a>(PhiR-&gt;getStartValue(), PhiR-&gt;getBackedgeValue(),</Highlight></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><Highlight kind="normal">                                PhiR-&gt;getDebugLoc(), Name);</Highlight></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><Highlight kind="normal">      ScalarR-&gt;insertBefore(PhiR);</Highlight></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><Highlight kind="normal">      PhiR-&gt;replaceAllUsesWith(ScalarR);</Highlight></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><Highlight kind="normal">      PhiR-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065" lineLink="/docs/api/structs/llvm/vplantransforms/#ac2fcd61c17c94d7e9d10b24b718c812e"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vplantransforms/#ac2fcd61c17c94d7e9d10b24b718c812e">VPlanTransforms::handleUncountableEarlyExit</a>(</Highlight></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;OrigLoop,</Highlight></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UncountableExitingBlock, <a href="/docs/api/classes/llvm/vprecipebuilder">VPRecipeBuilder</a> &amp;RecipeBuilder) &#123;</Highlight></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;LoopRegion = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</Highlight></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LatchVPBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(LoopRegion-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#add3be1d1d9e5b1ee2014c32d21bf2b5b">getExiting</a>());</Highlight></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> Builder(LatchVPBB-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MiddleVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>();</Highlight></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;IsEarlyExitTaken = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Process the uncountable exiting block. Update IsEarlyExitTaken, which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// tracks if the uncountable early exit has been taken. Also split the middle</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block and have it conditionally branch to the early exit block if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// EarlyExitTaken.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;EarlyExitingBranch =</Highlight></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(UncountableExitingBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueSucc = EarlyExitingBranch-&gt;getSuccessor(0);</Highlight></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FalseSucc = EarlyExitingBranch-&gt;getSuccessor(1);</Highlight></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The early exit block may or may not be the same as the &quot;countable&quot; exit</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block. Creates a new VPIRBB for the early exit block in case it is distinct</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// from the countable exit block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Introduce both exit blocks during VPlan skeleton construction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> &#42;VPEarlyExitBlock;</Highlight></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#afd50c2de451ac9fc0865dc747dd2d485">getUniqueExitBlock</a>()) &#123;</Highlight></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><Highlight kind="normal">    VPEarlyExitBlock = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPIRBasicBlock&gt;</a>(MiddleVPBB-&gt;getSuccessors()&#91;0&#93;);</Highlight></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><Highlight kind="normal">    VPEarlyExitBlock = Plan.<a href="/docs/api/classes/llvm/vplan/#aa12c0d3acb3f625ee09d2919907d4067">createVPIRBasicBlock</a>(</Highlight></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><Highlight kind="normal">        !OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(TrueSucc) ? TrueSucc : FalseSucc);</Highlight></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;EarlyExitNotTakenCond = RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(</Highlight></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><Highlight kind="normal">      OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(TrueSucc) ? TrueSucc : FalseSucc);</Highlight></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;EarlyExitTakenCond = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#acf2cdb4ec71a22869d4c491e220d6f0b">createNot</a>(EarlyExitNotTakenCond);</Highlight></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><Highlight kind="normal">  IsEarlyExitTaken =</Highlight></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2aeb4304c45f6343ca9188dbe52456a969">VPInstruction::AnyOf</a>, &#123;EarlyExitTakenCond&#125;);</Highlight></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;NewMiddle = Plan.<a href="/docs/api/classes/llvm/vplan/#aa1202b66a60b632b7adbdee13a20ad7e">createVPBasicBlock</a>(</Highlight><Highlight kind="stringliteral">&quot;middle.split&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpblockutils/#a2057d0749eedf6749f9e1cc6694eb1fd">VPBlockUtils::insertOnEdge</a>(LoopRegion, MiddleVPBB, NewMiddle);</Highlight></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpblockutils/#a40bc7fec35d7093efcdbadf566d6b5ee">VPBlockUtils::connectBlocks</a>(NewMiddle, VPEarlyExitBlock);</Highlight></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><Highlight kind="normal">  NewMiddle-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a43f7e15ac1a813112684effc1e5593a4">swapSuccessors</a>();</Highlight></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update the exit phis in the early exit block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> MiddleBuilder(NewMiddle);</Highlight></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : &#42;VPEarlyExitBlock) &#123;</Highlight></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExitIRI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPIRInstruction&gt;</a>(&amp;R);</Highlight></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExitPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;ExitIRI-&gt;getInstruction());</Highlight></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ExitPhi)</Highlight></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;IncomingFromEarlyExit = RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(</Highlight></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><Highlight kind="normal">        ExitPhi-&gt;getIncomingValueForBlock(UncountableExitingBlock));</Highlight></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The incoming value from the early exit must be a live-in for now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IncomingFromEarlyExit-&gt;<a href="/docs/api/classes/llvm/vpvalue/#add6179d3564ac5ea4736366b93d23829">isLiveIn</a>())</Highlight></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#afd50c2de451ac9fc0865dc747dd2d485">getUniqueExitBlock</a>()) &#123;</Highlight></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If there&#39;s a unique exit block, VPEarlyExitBlock has 2 predecessors</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// (MiddleVPBB and NewMiddle). Add the incoming value from MiddleVPBB</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// which is coming from the original latch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;IncomingFromLatch = RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(</Highlight></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><Highlight kind="normal">          ExitPhi-&gt;getIncomingValueForBlock(OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a1230fd674d2609b96527fe65eaf40b1b">getLoopLatch</a>()));</Highlight></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><Highlight kind="normal">      ExitIRI-&gt;addOperand(IncomingFromLatch);</Highlight></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><Highlight kind="normal">      ExitIRI-&gt;extractLastLaneOfOperand(MiddleBuilder);</Highlight></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add the incoming value from the early exit.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><Highlight kind="normal">    ExitIRI-&gt;addOperand(IncomingFromEarlyExit);</Highlight></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><Highlight kind="normal">  MiddleBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a0062eccdb4956531f7b6a3cf71c3320c">VPInstruction::BranchOnCond</a>, &#123;IsEarlyExitTaken&#125;);</Highlight></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace the condition controlling the non-early exit from the vector loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// with one exiting if either the original condition of the vector latch is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// true or the early exit has been taken.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LatchExitingBranch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPInstruction&gt;</a>(LatchVPBB-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LatchExitingBranch-&gt;getOpcode() == <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a49dcace93798ddd457a9d4e584bbc9a2">VPInstruction::BranchOnCount</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Unexpected terminator&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IsLatchExitTaken =</Highlight></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><Highlight kind="normal">      Builder.<a href="/docs/api/classes/llvm/vpbuilder/#a0b968ad86013a173bed6701425715dfb">createICmp</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP&#95;EQ</a>, LatchExitingBranch-&gt;getOperand(0),</Highlight></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><Highlight kind="normal">                         LatchExitingBranch-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AnyExitTaken = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(</Highlight></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><Highlight kind="normal">      Instruction::Or, &#123;IsEarlyExitTaken, IsLatchExitTaken&#125;);</Highlight></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a0062eccdb4956531f7b6a3cf71c3320c">VPInstruction::BranchOnCond</a>, AnyExitTaken);</Highlight></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><Highlight kind="normal">  LatchExitingBranch-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#aac9dfb61b37082dca00de284bb3309e8">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><Highlight kind="normal">&#125;</Highlight></CodeLine>

</ProgramListing>

</DoxygenPage>
