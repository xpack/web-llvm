---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'
import SectionUser from '@xpack/docusaurus-plugin-doxygen/components/SectionUser'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `VPlanTransforms.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>

This file implements a set of utility <a href="/docs/api/classes/llvm/vplan">VPlan</a> to <a href="/docs/api/classes/llvm/vplan">VPlan</a> transformations. <a href="#details">More...</a>

## Included Headers

<IncludesList>
<IncludesListItem
  filePath="VPlanTransforms.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPRecipeBuilder.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vprecipebuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlan.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplan-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanAnalysis.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplananalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanCFG.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplancfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanDominatorTree.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplandominatortree-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanPatternMatch.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanpatternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanUtils.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/PostOrderIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/postorderiterator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/TypeSwitch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/typeswitch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/IVDescriptors.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/ivdescriptors-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/VectorUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Intrinsics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
</IncludesList>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a6e46200e5b228c903356e02904987051">addReplicateRegions</a> (VPlan &amp;Plan)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpactivelanemaskphirecipe">VPActiveLaneMaskPHIRecipe</a> &#42;</>}
  name={<><a href="#a5a9cb34d61fa4930ff585649d1d5b2ed">addVPLaneMaskPhiAndUpdateExitBranch</a> (VPlan &amp;Plan, bool DataAndControlFlowWithoutRuntimeCheck)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; &gt;</>}
  name={<><a href="#a8d0c6052d21638f0a385e226db3bd92f">collectAllHeaderMasks</a> (VPlan &amp;Plan)</>}>
Collect all VPValues representing a header mask through the (ICMP&#95;ULE, WideCanonicalIV, backedge-taken-count) pattern. <a href="#a8d0c6052d21638f0a385e226db3bd92f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/smallvector">SmallVector</a>&lt; <a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42; &gt;</>}
  name={<><a href="#aa70c8f392e8295a96bfd493337e122fa">collectUsersRecursively</a> (VPValue &#42;V)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;</>}
  name={<><a href="#ad0faf4b8ff1cf3306958d056dcb2fde2">createEVLRecipe</a> (VPValue &#42;HeaderMask, VPRecipeBase &amp;CurRecipe, VPTypeAnalysis &amp;TypeInfo, VPValue &amp;AllOneMask, VPValue &amp;EVL)</>}>
Try to convert <code>CurRecipe</code> to a corresponding EVL-based recipe. <a href="#ad0faf4b8ff1cf3306958d056dcb2fde2">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;</>}
  name={<><a href="#ac967ad551e77554a15e20cac14877ac7">createReplicateRegion</a> (VPReplicateRecipe &#42;PredRecipe, VPlan &amp;Plan)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpscalarivstepsrecipe">VPScalarIVStepsRecipe</a> &#42;</>}
  name={<><a href="#a3c91ec836b0d1e340e17bff8eec31390">createScalarIVSteps</a> (VPlan &amp;Plan, InductionDescriptor::InductionKind Kind, Instruction::BinaryOps InductionOpcode, FPMathOperator &#42;FPBinOp, Instruction &#42;TruncI, VPValue &#42;StartV, VPValue &#42;Step, DebugLoc DL, VPBuilder &amp;Builder)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpwideninductionrecipe">VPWidenInductionRecipe</a> &#42;</>}
  name={<><a href="#aa35433def455d3f76738769247678052">getOptimizableIVOf</a> (VPValue &#42;VPV)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if <code>VPV</code> is an untruncated wide induction, either before or after the increment. <a href="#aa35433def455d3f76738769247678052">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;</>}
  name={<><a href="#ae50d60234bec0a277dc087edad8901e1">getPredicatedMask</a> (VPRegionBlock &#42;R)</>}>
If <code>R</code> is a region with a <a href="/docs/api/classes/llvm/vpbranchonmaskrecipe">VPBranchOnMaskRecipe</a> in the entry block, return the mask. <a href="#ae50d60234bec0a277dc087edad8901e1">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;</>}
  name={<><a href="#ac99a45549c3cc25c2540f1bffd99944c">getPredicatedThenBlock</a> (VPRegionBlock &#42;R)</>}>
If <code>R</code> is a triangle region, return the &#39;then&#39; block of the triangle. <a href="#ac99a45549c3cc25c2540f1bffd99944c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a9396319801f74828cfbd94177f38eabc">hoistPreviousBeforeFORUsers</a> (VPFirstOrderRecurrencePHIRecipe &#42;FOR, VPRecipeBase &#42;Previous, VPDominatorTree &amp;VPDT)</>}>
Try to hoist <code>Previous</code> and its operands before all users of <code>FOR</code>. <a href="#a9396319801f74828cfbd94177f38eabc">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a6ba2ffb17342f2a0c54adaba2344cab0">isDeadRecipe</a> (VPRecipeBase &amp;R)</>}>
Returns true if <code>R</code> is dead and can be removed. <a href="#a6ba2ffb17342f2a0c54adaba2344cab0">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a6bc9d4e47e8a41e60f4bedae712f0c03">legalizeAndOptimizeInductions</a> (VPlan &amp;Plan)</>}>
Legalize <a href="/docs/api/classes/llvm/vpwidenpointerinductionrecipe">VPWidenPointerInductionRecipe</a>, by replacing it with a PtrAdd (IndStart, ScalarIVSteps (0, Step)) if only its scalar values are used, as <a href="/docs/api/classes/llvm/vpwidenpointerinductionrecipe">VPWidenPointerInductionRecipe</a> will generate vectors only. <a href="#a6bc9d4e47e8a41e60f4bedae712f0c03">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#afd081c92500bd333555e7bd6102b4d3e">licm</a> (VPlan &amp;Plan)</>}>
Move loop-invariant recipes out of the vector loop region in <code>Plan</code>. <a href="#afd081c92500bd333555e7bd6102b4d3e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a528aff11b730581c8d7cfae0e5fb6254">mergeBlocksIntoPredecessors</a> (VPlan &amp;Plan)</>}>
Remove redundant VPBasicBlocks by merging them into their predecessor if the predecessor has a single successor. <a href="#a528aff11b730581c8d7cfae0e5fb6254">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a4b251734aba716917922f4ab216436c1">mergeReplicateRegionsIntoSuccessors</a> (VPlan &amp;Plan)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ab5d43362c1fefd60d9bfcc1e28ba4688">recursivelyDeleteDeadRecipes</a> (VPValue &#42;V)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aefd03ef5fc77c520e27fe794e8ec93e9">removeRedundantCanonicalIVs</a> (VPlan &amp;Plan)</>}>
Try to replace VPWidenCanonicalIVRecipes with a widened canonical IV recipe, if it exists. <a href="#aefd03ef5fc77c520e27fe794e8ec93e9">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a8a0202a443a527ba17fcd111497feb7d">removeRedundantExpandSCEVRecipes</a> (VPlan &amp;Plan)</>}>
Remove redundant EpxandSCEVRecipes in <code>Plan&#39;s</code> entry block by replacing them with already existing recipes expanding the same <a href="/docs/api/classes/llvm/scev">SCEV</a> expression. <a href="#a8a0202a443a527ba17fcd111497feb7d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a2ff7a57c84a06ee83b0a28763db85c3f">removeRedundantInductionCasts</a> (VPlan &amp;Plan)</>}>
Remove redundant casts of inductions. <a href="#a2ff7a57c84a06ee83b0a28763db85c3f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a842c12e686e91a515dfd30a4bf70d740">simplifyRecipe</a> (VPRecipeBase &amp;R, VPTypeAnalysis &amp;TypeInfo)</>}>
Try to simplify recipe <code>R</code>. <a href="#a842c12e686e91a515dfd30a4bf70d740">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a74cb3294789bc24526bcadbf6b466714">simplifyRecipes</a> (VPlan &amp;Plan, Type &#42;CanonicalIVTy)</>}>
Try to simplify the recipes in <code>Plan</code>. <a href="#a74cb3294789bc24526bcadbf6b466714">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a4a5b1db18197a65d0f6a487f2e236921">sinkRecurrenceUsersAfterPrevious</a> (VPFirstOrderRecurrencePHIRecipe &#42;FOR, VPRecipeBase &#42;Previous, VPDominatorTree &amp;VPDT)</>}>
Sink users of <code>FOR</code> after the recipe defining the previous value <code>Previous</code> of the recurrence. <a href="#a4a5b1db18197a65d0f6a487f2e236921">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a1536feae2abb3570ac032768a53ddd00">sinkScalarOperands</a> (VPlan &amp;Plan)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a5f39858b5d6d72b92c138916c64c90ba">transformRecipestoEVLRecipes</a> (VPlan &amp;Plan, VPValue &amp;EVL)</>}>
Replace recipes with their EVL variants. <a href="#a5f39858b5d6d72b92c138916c64c90ba">More...</a>
</MembersIndexItem>

</MembersIndex>

## Description {#details}

This file implements a set of utility <a href="/docs/api/classes/llvm/vplan">VPlan</a> to <a href="/docs/api/classes/llvm/vplan">VPlan</a> transformations.

<SectionDefinition>

## Functions

### addReplicateRegions() {#a6e46200e5b228c903356e02904987051}

<MemberDefinition
  prototype={<>static void addReplicateRegions (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>

Definition at line <a href="#l00344">344</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### addVPLaneMaskPhiAndUpdateExitBranch() {#a5a9cb34d61fa4930ff585649d1d5b2ed}

<MemberDefinition
  prototype={<>static VPActiveLaneMaskPHIRecipe &#42; addVPLaneMaskPhiAndUpdateExitBranch (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, bool DataAndControlFlowWithoutRuntimeCheck)</>}
  labels = {["static"]}>

Definition at line <a href="#l01490">1490</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### collectAllHeaderMasks() {#a8d0c6052d21638f0a385e226db3bd92f}

<MemberDefinition
  prototype={<>static SmallVector&lt; VPValue &#42; &gt; collectAllHeaderMasks (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>
Collect all VPValues representing a header mask through the (ICMP&#95;ULE, WideCanonicalIV, backedge-taken-count) pattern.

TODO: Introduce explicit recipe for header-mask instead of searching for the header-mask pattern manually.

Definition at line <a href="#l01565">1565</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### collectUsersRecursively() {#aa70c8f392e8295a96bfd493337e122fa}

<MemberDefinition
  prototype={<>static SmallVector&lt; VPUser &#42; &gt; collectUsersRecursively (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; V)</>}
  labels = {["static"]}>

Definition at line <a href="#l00565">565</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### createEVLRecipe() {#ad0faf4b8ff1cf3306958d056dcb2fde2}

<MemberDefinition
  prototype={<>static VPRecipeBase &#42; createEVLRecipe (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; HeaderMask, <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp; CurRecipe, <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> &amp; TypeInfo, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &amp; AllOneMask, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &amp; EVL)</>}
  labels = {["static"]}>
Try to convert <code>CurRecipe</code> to a corresponding EVL-based recipe.

Returns nullptr if no EVL-based recipe could be created. <code>HeaderMask</code> Header Mask. <code>CurRecipe</code> Recipe to be transform. <code>TypeInfo</code> VPlan-based type analysis. <code>AllOneMask</code> The vector mask parameter of vector-predication intrinsics. <code>EVL</code> The explicit vector length parameter of vector-predication intrinsics.

Definition at line <a href="#l01647">1647</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### createReplicateRegion() {#ac967ad551e77554a15e20cac14877ac7}

<MemberDefinition
  prototype={<>static VPRegionBlock &#42; createReplicateRegion (<a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a> &#42; PredRecipe, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>

Definition at line <a href="#l00303">303</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### createScalarIVSteps() {#a3c91ec836b0d1e340e17bff8eec31390}

<MemberDefinition
  prototype={<>static VPScalarIVStepsRecipe &#42; createScalarIVSteps (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabcc">InductionDescriptor::InductionKind</a> Kind, <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> InductionOpcode, <a href="/docs/api/classes/llvm/fpmathoperator">FPMathOperator</a> &#42; FPBinOp, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; TruncI, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; StartV, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; Step, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> DL, <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> &amp; Builder)</>}
  labels = {["static"]}>

Definition at line <a href="#l00527">527</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### getOptimizableIVOf() {#aa35433def455d3f76738769247678052}

<MemberDefinition
  prototype={<>static VPWidenInductionRecipe &#42; getOptimizableIVOf (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; VPV)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if <code>VPV</code> is an untruncated wide induction, either before or after the increment.

If so return the header IV (before the increment), otherwise return null.

Definition at line <a href="#l00673">673</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### getPredicatedMask() {#ae50d60234bec0a277dc087edad8901e1}

<MemberDefinition
  prototype={<>VPValue &#42; getPredicatedMask (<a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42; R)</>}>
If <code>R</code> is a region with a <a href="/docs/api/classes/llvm/vpbranchonmaskrecipe">VPBranchOnMaskRecipe</a> in the entry block, return the mask.

Definition at line <a href="#l00187">187</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### getPredicatedThenBlock() {#ac99a45549c3cc25c2540f1bffd99944c}

<MemberDefinition
  prototype={<>static VPBasicBlock &#42; getPredicatedThenBlock (<a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42; R)</>}
  labels = {["static"]}>
If <code>R</code> is a triangle region, return the &#39;then&#39; block of the triangle.

Definition at line <a href="#l00197">197</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### hoistPreviousBeforeFORUsers() {#a9396319801f74828cfbd94177f38eabc}

<MemberDefinition
  prototype={<>static bool hoistPreviousBeforeFORUsers (<a href="/docs/api/structs/llvm/vpfirstorderrecurrencephirecipe">VPFirstOrderRecurrencePHIRecipe</a> &#42; FOR, <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42; Previous, <a href="/docs/api/classes/llvm/vpdominatortree">VPDominatorTree</a> &amp; VPDT)</>}
  labels = {["static"]}>
Try to hoist <code>Previous</code> and its operands before all users of <code>FOR</code>.

Definition at line <a href="#l01112">1112</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### isDeadRecipe() {#a6ba2ffb17342f2a0c54adaba2344cab0}

<MemberDefinition
  prototype={<>static bool isDeadRecipe (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp; R)</>}
  labels = {["static"]}>
Returns true if <code>R</code> is dead and can be removed.

Definition at line <a href="#l00493">493</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### legalizeAndOptimizeInductions() {#a6bc9d4e47e8a41e60f4bedae712f0c03}

<MemberDefinition
  prototype={<>static void legalizeAndOptimizeInductions (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>
Legalize <a href="/docs/api/classes/llvm/vpwidenpointerinductionrecipe">VPWidenPointerInductionRecipe</a>, by replacing it with a PtrAdd (IndStart, ScalarIVSteps (0, Step)) if only its scalar values are used, as <a href="/docs/api/classes/llvm/vpwidenpointerinductionrecipe">VPWidenPointerInductionRecipe</a> will generate vectors only.

If some users require vectors while other require scalars, the scalar uses need to extract the scalars from the generated vectors (Note that this is different to how int/fp inductions are handled). Legalize extract-from-ends using uniform <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a> of wide inductions to use regular <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a>, so the correct end value is available. Also optimize <a href="/docs/api/classes/llvm/vpwidenintorfpinductionrecipe">VPWidenIntOrFpInductionRecipe</a>, if any of its users needs scalar values, by providing them scalar steps built on the canonical scalar IV and update the original IV&#39;s users. This is an optional optimization to reduce the needs of vector extracts.

Definition at line <a href="#l00589">589</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### licm() {#afd081c92500bd333555e7bd6102b4d3e}

<MemberDefinition
  prototype={<>static void licm (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>
Move loop-invariant recipes out of the vector loop region in <code>Plan</code>.

Definition at line <a href="#l01275">1275</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### mergeBlocksIntoPredecessors() {#a528aff11b730581c8d7cfae0e5fb6254}

<MemberDefinition
  prototype={<>static bool mergeBlocksIntoPredecessors (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>
Remove redundant VPBasicBlocks by merging them into their predecessor if the predecessor has a single successor.

Definition at line <a href="#l00372">372</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### mergeReplicateRegionsIntoSuccessors() {#a4b251734aba716917922f4ab216436c1}

<MemberDefinition
  prototype={<>static bool mergeReplicateRegionsIntoSuccessors (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>

Definition at line <a href="#l00219">219</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### recursivelyDeleteDeadRecipes() {#ab5d43362c1fefd60d9bfcc1e28ba4688}

<MemberDefinition
  prototype={<>static void recursivelyDeleteDeadRecipes (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; V)</>}
  labels = {["static"]}>

Definition at line <a href="#l00814">814</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### removeRedundantCanonicalIVs() {#aefd03ef5fc77c520e27fe794e8ec93e9}

<MemberDefinition
  prototype={<>static void removeRedundantCanonicalIVs (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>
Try to replace VPWidenCanonicalIVRecipes with a widened canonical IV recipe, if it exists.

Definition at line <a href="#l00457">457</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### removeRedundantExpandSCEVRecipes() {#a8a0202a443a527ba17fcd111497feb7d}

<MemberDefinition
  prototype={<>static void removeRedundantExpandSCEVRecipes (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>
Remove redundant EpxandSCEVRecipes in <code>Plan&#39;s</code> entry block by replacing them with already existing recipes expanding the same <a href="/docs/api/classes/llvm/scev">SCEV</a> expression.

Definition at line <a href="#l00797">797</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### removeRedundantInductionCasts() {#a2ff7a57c84a06ee83b0a28763db85c3f}

<MemberDefinition
  prototype={<>static void removeRedundantInductionCasts (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>
Remove redundant casts of inductions.

Such redundant casts are casts of induction variables that can be ignored, because we already proved that the casted phi is equal to the uncasted phi in the vectorized loop. There is no need to vectorize the cast - the same value can be used for both the phi and casts in the vector loop.

Definition at line <a href="#l00424">424</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### simplifyRecipe() {#a842c12e686e91a515dfd30a4bf70d740}

<MemberDefinition
  prototype={<>static void simplifyRecipe (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp; R, <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> &amp; TypeInfo)</>}
  labels = {["static"]}>
Try to simplify recipe <code>R</code>.

Definition at line <a href="#l00834">834</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### simplifyRecipes() {#a74cb3294789bc24526bcadbf6b466714}

<MemberDefinition
  prototype={<>static void simplifyRecipes (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/type">Type</a> &#42; CanonicalIVTy)</>}
  labels = {["static"]}>
Try to simplify the recipes in <code>Plan</code>.

<a href="/docs/api/classes/llvm/use">Use</a> <code>CanonicalIVTy</code> as type for all un-typed live-ins in <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a>.

Definition at line <a href="#l00967">967</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### sinkRecurrenceUsersAfterPrevious() {#a4a5b1db18197a65d0f6a487f2e236921}

<MemberDefinition
  prototype={<>static bool sinkRecurrenceUsersAfterPrevious (<a href="/docs/api/structs/llvm/vpfirstorderrecurrencephirecipe">VPFirstOrderRecurrencePHIRecipe</a> &#42; FOR, <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42; Previous, <a href="/docs/api/classes/llvm/vpdominatortree">VPDominatorTree</a> &amp; VPDT)</>}
  labels = {["static"]}>
Sink users of <code>FOR</code> after the recipe defining the previous value <code>Previous</code> of the recurrence.

<SectionUser title="Returns">
true if all users of <code>FOR</code> could be re-arranged as needed or false if it is not possible.
</SectionUser>

Definition at line <a href="#l01057">1057</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### sinkScalarOperands() {#a1536feae2abb3570ac032768a53ddd00}

<MemberDefinition
  prototype={<>static bool sinkScalarOperands (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>

Definition at line <a href="#l00109">109</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

### transformRecipestoEVLRecipes() {#a5f39858b5d6d72b92c138916c64c90ba}

<MemberDefinition
  prototype={<>static void transformRecipestoEVLRecipes (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &amp; EVL)</>}
  labels = {["static"]}>
Replace recipes with their EVL variants.

Definition at line <a href="#l01726">1726</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-cpp">VPlanTransforms.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===-- VPlanTransforms.cpp - Utility VPlan to VPlan transforms -----------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">/// \\file</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">/// This file implements a set of utility VPlan to VPlan transformations.</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-h">VPlanTransforms.h</a>&quot;</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vprecipebuilder-h">VPRecipeBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplan-h">VPlan.h</a>&quot;</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplananalysis-h">VPlanAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplancfg-h">VPlanCFG.h</a>&quot;</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplandominatortree-h">VPlanDominatorTree.h</a>&quot;</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanpatternmatch-h">VPlanPatternMatch.h</a>&quot;</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanutils-h">VPlanUtils.h</a>&quot;</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/postorderiterator-h">llvm/ADT/PostOrderIterator.h</a>&quot;</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h">llvm/ADT/SetVector.h</a>&quot;</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/typeswitch-h">llvm/ADT/TypeSwitch.h</a>&quot;</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/ivdescriptors-h">llvm/Analysis/IVDescriptors.h</a>&quot;</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h">llvm/Analysis/VectorUtils.h</a>&quot;</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h">llvm/IR/Intrinsics.h</a>&quot;</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33" lineLink="/docs/api/structs/llvm/vplantransforms/#ad210afaefb4884ac5008dd5fbaf1cbf8"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#ad210afaefb4884ac5008dd5fbaf1cbf8">VPlanTransforms::VPInstructionsToVPRecipes</a>(</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aefc42f3cefc5a839ca925b4cb3ae4a7b">VPlanPtr</a> &amp;Plan,</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &#42;(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;)&gt;</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlight">        GetIntOrFpInductionDescriptor,</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &amp;TLI) &#123;</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/reversepostordertraversal">ReversePostOrderTraversal&lt;VPBlockDeepTraversalWrapper&lt;VPBlockBase &#42;&gt;</a>&gt; RPOT(</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlight">      Plan-&gt;getVectorLoopRegion());</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(RPOT)) &#123;</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip blocks outside region</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VPBB-&gt;getParent())</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Term = VPBB-&gt;getTerminator();</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EndIter = Term ? Term-&gt;getIterator() : VPBB-&gt;end();</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Introduce each ingredient into VPlan.</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;Ingredient :</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(VPBB-&gt;begin(), EndIter))) &#123;</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;VPV = Ingredient.getVPSingleValue();</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Inst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(VPV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#a5fe7dd2466300bd8747d81384a7ced5d">getUnderlyingValue</a>());</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;NewRecipe = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VPPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenPHIRecipe&gt;</a>(&amp;Ingredient)) &#123;</span></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(VPPhi-&gt;getUnderlyingValue());</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = GetIntOrFpInductionDescriptor(Phi);</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Start = Plan-&gt;getOrAddLiveIn(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getStartValue());</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Step =</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/vputils/#a064976a6c7458b10c24021b7334cec2a">vputils::getOrCreateVPValueForSCEVExpr</a>(&#42;Plan, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getStep(), SE);</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlight">        NewRecipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidenintorfpinductionrecipe">VPWidenIntOrFpInductionRecipe</a>(</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlight">            Phi, Start, Step, &amp;Plan-&gt;getVF(), &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, Ingredient.getDebugLoc());</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPInstruction&gt;</a>(&amp;Ingredient) &amp;&amp;</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;only VPInstructions expected here&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(Inst) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;phis should be handled above&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Create VPWidenMemoryRecipe for loads and stores.</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;Load = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(Inst)) &#123;</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlight">          NewRecipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vpwidenloadrecipe">VPWidenLoadRecipe</a>(</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlight">              &#42;Load, Ingredient.getOperand(0), </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;Mask&#42;/</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlight">              </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;Consecutive&#42;/</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;Reverse&#42;/</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlight">              Ingredient.getDebugLoc());</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;Store = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(Inst)) &#123;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlight">          NewRecipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vpwidenstorerecipe">VPWidenStoreRecipe</a>(</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlight">              &#42;Store, Ingredient.getOperand(1), Ingredient.getOperand(0),</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlight">              </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;Mask&#42;/</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;Consecutive&#42;/</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;Reverse&#42;/</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlight">              Ingredient.getDebugLoc());</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/getelementptrinst">GetElementPtrInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(Inst)) &#123;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlight">          NewRecipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidengeprecipe">VPWidenGEPRecipe</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, Ingredient.operands());</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(Inst)) &#123;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlight">          NewRecipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidenintrinsicrecipe">VPWidenIntrinsicRecipe</a>(</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlight">              &#42;CI, <a href="/docs/api/namespaces/llvm/#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, &amp;TLI),</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlight">              &#123;Ingredient.op&#95;begin(), Ingredient.op&#95;end() - 1&#125;, CI-&gt;getType(),</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlight">              CI-&gt;getDebugLoc());</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(Inst)) &#123;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlight">          NewRecipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vpwidenselectrecipe">VPWidenSelectRecipe</a>(&#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, Ingredient.operands());</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(Inst)) &#123;</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlight">          NewRecipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>(</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlight">              CI-&gt;getOpcode(), Ingredient.getOperand(0), CI-&gt;getType(), &#42;CI);</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlight">          NewRecipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidenrecipe">VPWidenRecipe</a>(&#42;Inst, Ingredient.<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>());</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlight">      NewRecipe-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a8859e5e8cad5653b278964f47414fd84">insertBefore</a>(&amp;Ingredient);</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NewRecipe-&gt;<a href="/docs/api/classes/llvm/vpdef/#a31492b9d8412415c2dae85e33e2748fd">getNumDefinedValues</a>() == 1)</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlight">        VPV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(NewRecipe-&gt;<a href="/docs/api/classes/llvm/vpdef/#a76a983b694720483a3dd9fe57314e39b">getVPSingleValue</a>());</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewRecipe-&gt;<a href="/docs/api/classes/llvm/vpdef/#a31492b9d8412415c2dae85e33e2748fd">getNumDefinedValues</a>() == 0 &amp;&amp;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;Only recpies with zero or one defined values expected&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlight">      Ingredient.eraseFromParent();</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109" lineLink="#a1536feae2abb3570ac032768a53ddd00"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a1536feae2abb3570ac032768a53ddd00">sinkScalarOperands</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Iter = <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>());</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First, collect the operands of all recipes in replicate blocks as seeds for</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sinking.</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;std::pair&lt;VPBasicBlock &#42;, VPSingleDefRecipe &#42;&gt;</a>&gt; WorkList;</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;VPR : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPRegionBlock&gt;</a>(Iter)) &#123;</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;EntryVPBB = VPR-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VPR-&gt;isReplicator() || EntryVPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aeccf6a036968755c6d86e2d2bb17673a">getSuccessors</a>().<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() != 2)</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPBasicBlock&gt;</a>(EntryVPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aeccf6a036968755c6d86e2d2bb17673a">getSuccessors</a>()&#91;0&#93;);</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VPBB || VPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>() != VPR-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a28da654f916bf44da5513b6f1788835c">getExitingBasicBlock</a>())</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Recipe : &#42;VPBB) &#123;</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : Recipe.operands())</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Def =</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlight">                <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;VPSingleDefRecipe&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getDefiningRecipe()))</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlight">          WorkList.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(std::make&#95;pair(VPBB, Def));</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ScalarVFOnly = Plan.<a href="/docs/api/classes/llvm/vplan/#ad30bf062f18fd6e56e36bfecefbbb386">hasScalarVFOnly</a>();</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to sink each replicate or scalar IV steps recipe in the worklist.</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != WorkList.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;SinkTo;</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpsingledefrecipe">VPSingleDefRecipe</a> &#42;SinkCandidate;</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlight">    std::tie(SinkTo, SinkCandidate) = WorkList&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>() == SinkTo ||</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlight">        SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a2408a88276528d80adefefa00995705a">mayHaveSideEffects</a>() ||</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlight">        SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a15ab200cb0259f0c13b4e068acfd7fc6">mayReadOrWriteMemory</a>())</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RepR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReplicateRecipe&gt;</a>(SinkCandidate)) &#123;</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ScalarVFOnly &amp;&amp; RepR-&gt;isUniform())</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPScalarIVStepsRecipe&gt;</a>(SinkCandidate))</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsDuplicating = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// All recipe users of the sink candidate must be in the same block SinkTo</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// or all users outside of SinkTo must be uniform-after-vectorization (</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// i.e., only first lane is used) . In the latter case, we need to duplicate</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// SinkCandidate.</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CanSinkWithUser = &#91;SinkTo, &amp;NeedsDuplicating,</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlight">                            SinkCandidate&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123;</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(U);</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UI-&gt;getParent() == SinkTo)</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlight">      NeedsDuplicating = UI-&gt;onlyFirstLaneUsed(SinkCandidate);</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We only know how to duplicate VPRecipeRecipes for now.</span></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NeedsDuplicating &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPReplicateRecipe&gt;</a>(SinkCandidate);</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>(), CanSinkWithUser))</span></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsDuplicating) &#123;</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ScalarVFOnly)</span></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vpsingledefrecipe/#a12b12fbdf160f2cf70973e09adbf97d4">getUnderlyingInstr</a>();</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Clone = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vpuser/#a11d83265a9e4ff6c6ecd3cf222ad0208">operands</a>(), </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: add &quot;.cloned&quot; suffix to name of Clone&#39;s VPValue.</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><span class="doxyHighlight">      Clone-&gt;insertBefore(SinkCandidate);</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">      SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ae3773dd8f9c831f0dde091319b2ff7d0">replaceUsesWithIf</a>(Clone, &#91;SinkTo&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &amp;U, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(&amp;U)-&gt;getParent() != SinkTo;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><span class="doxyHighlight">    SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a83c9341e2d36f67d5cad25ba91e862e1">moveBefore</a>(&#42;SinkTo, SinkTo-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>());</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : SinkCandidate-&gt;<a href="/docs/api/classes/llvm/vpuser/#a11d83265a9e4ff6c6ecd3cf222ad0208">operands</a>())</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Def =</span></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;VPSingleDefRecipe&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getDefiningRecipe()))</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">        WorkList.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(std::make&#95;pair(SinkTo, Def));</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlightComment">/// If \\p R is a region with a VPBranchOnMaskRecipe in the entry block, return</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlightComment">/// the mask.</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187" lineLink="#ae50d60234bec0a277dc087edad8901e1"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="#ae50d60234bec0a277dc087edad8901e1">getPredicatedMask</a>(<a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;R) &#123;</span></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EntryBB = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPBasicBlock&gt;</a>(R-&gt;getEntry());</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!EntryBB || EntryBB-&gt;size() != 1 ||</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPBranchOnMaskRecipe&gt;</a>(EntryBB-&gt;begin()))</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBranchOnMaskRecipe&gt;</a>(&amp;&#42;EntryBB-&gt;begin())-&gt;getOperand(0);</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195"></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlightComment">/// If \\p R is a triangle region, return the &#39;then&#39; block of the triangle.</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197" lineLink="#ac99a45549c3cc25c2540f1bffd99944c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;<a href="#ac99a45549c3cc25c2540f1bffd99944c">getPredicatedThenBlock</a>(<a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;R) &#123;</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EntryBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(R-&gt;getEntry());</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EntryBB-&gt;getNumSuccessors() != 2)</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Succ0 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPBasicBlock&gt;</a>(EntryBB-&gt;getSuccessors()&#91;0&#93;);</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Succ1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPBasicBlock&gt;</a>(EntryBB-&gt;getSuccessors()&#91;1&#93;);</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Succ0 || !Succ1)</span></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ0-&gt;getNumSuccessors() + Succ1-&gt;getNumSuccessors() != 1)</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ0-&gt;getSingleSuccessor() == Succ1)</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Succ0;</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Succ1-&gt;getSingleSuccessor() == Succ0)</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Succ1;</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlightComment">// Merge replicate regions in their successor region, if a replicate region</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><span class="doxyHighlightComment">// is connected to a successor replicate region with the same predicate by a</span></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><span class="doxyHighlightComment">// single, empty VPBasicBlock.</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219" lineLink="#a4b251734aba716917922f4ab216436c1"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a4b251734aba716917922f4ab216436c1">mergeReplicateRegionsIntoSuccessors</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;VPRegionBlock &#42;, 4&gt;</a> TransformedRegions;</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect replicate regions followed by an empty block, followed by another</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// replicate region with matching masks to process front. This is to avoid</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// iterator invalidation issues while merging regions.</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPRegionBlock &#42;, 8&gt;</a> WorkList;</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;Region1 : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPRegionBlock&gt;</a>(</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()))) &#123;</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Region1-&gt;isReplicator())</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MiddleBasicBlock =</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;VPBasicBlock&gt;</a>(Region1-&gt;getSingleSuccessor());</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MiddleBasicBlock || !MiddleBasicBlock-&gt;empty())</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Region2 =</span></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;VPRegionBlock&gt;</a>(MiddleBasicBlock-&gt;getSingleSuccessor());</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Region2 || !Region2-&gt;isReplicator())</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Mask1 = <a href="#ae50d60234bec0a277dc087edad8901e1">getPredicatedMask</a>(Region1);</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Mask2 = <a href="#ae50d60234bec0a277dc087edad8901e1">getPredicatedMask</a>(Region2);</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Mask1 || Mask1 != Mask2)</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Mask1 &amp;&amp; Mask2 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;both region must have conditions&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">    WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Region1);</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Move recipes from Region1 to its successor region, if both are triangles.</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;Region1 : WorkList) &#123;</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TransformedRegions.<a href="/docs/api/classes/llvm/smallptrsetimpl/#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(Region1))</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MiddleBasicBlock = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(Region1-&gt;getSingleSuccessor());</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Region2 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRegionBlock&gt;</a>(MiddleBasicBlock-&gt;getSingleSuccessor());</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;Then1 = <a href="#ac99a45549c3cc25c2540f1bffd99944c">getPredicatedThenBlock</a>(Region1);</span></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;Then2 = <a href="#ac99a45549c3cc25c2540f1bffd99944c">getPredicatedThenBlock</a>(Region2);</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Then1 || !Then2)</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note: No fusion-preventing memory dependencies are expected in either</span></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// region. Such dependencies should be rejected during earlier dependence</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// checks, which guarantee accesses can be re-ordered for vectorization.</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Move recipes to the successor region.</span></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;ToMove : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(&#42;Then1)))</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlight">      ToMove.moveBefore(&#42;Then2, Then2-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>());</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Merge1 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(Then1-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>());</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Merge2 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(Then2-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>());</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Move VPPredInstPHIRecipes from the merge block to the successor region&#39;s</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// merge block. Update all users inside the successor region to use the</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// original values.</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;Phi1ToMove : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(&#42;Merge1))) &#123;</span></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;PredInst1 =</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPPredInstPHIRecipe&gt;</a>(&amp;Phi1ToMove)-&gt;getOperand(0);</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Phi1ToMoveV = Phi1ToMove.getVPSingleValue();</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><span class="doxyHighlight">      Phi1ToMoveV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ae3773dd8f9c831f0dde091319b2ff7d0">replaceUsesWithIf</a>(PredInst1, &#91;Then2&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &amp;U, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(&amp;U)-&gt;getParent() == Then2;</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Remove phi recipes that are unused after merging the regions.</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Phi1ToMove.getVPSingleValue()-&gt;getNumUsers() == 0) &#123;</span></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><span class="doxyHighlight">        Phi1ToMove.eraseFromParent();</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">      Phi1ToMove.moveBefore(&#42;Merge2, Merge2-&gt;begin());</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Finally, remove the first region.</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(Region1-&gt;getPredecessors())) &#123;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpblockutils/#a61f1451694a3638db85170c7f55d5581">VPBlockUtils::disconnectBlocks</a>(Pred, Region1);</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpblockutils/#a40bc7fec35d7093efcdbadf566d6b5ee">VPBlockUtils::connectBlocks</a>(Pred, MiddleBasicBlock);</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpblockutils/#a61f1451694a3638db85170c7f55d5581">VPBlockUtils::disconnectBlocks</a>(Region1, MiddleBasicBlock);</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">    TransformedRegions.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Region1);</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !TransformedRegions.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#af8a50544090e81ac83601aff8f4b0142">empty</a>();</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303" lineLink="#ac967ad551e77554a15e20cac14877ac7"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;<a href="#ac967ad551e77554a15e20cac14877ac7">createReplicateRegion</a>(<a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a> &#42;PredRecipe,</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">                                            <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr = PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpsingledefrecipe/#a12b12fbdf160f2cf70973e09adbf97d4">getUnderlyingInstr</a>();</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build the triangular if-then region.</span></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><span class="doxyHighlight">  std::string RegionName = (<a href="/docs/api/classes/llvm/twine">Twine</a>(</span><span class="doxyHighlightStringLiteral">&quot;pred.&quot;</span><span class="doxyHighlight">) + Instr-&gt;getOpcodeName()).str();</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Instr-&gt;getParent() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Predicated instruction not in any basic block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BlockInMask = PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpreplicaterecipe/#aec678e1ae306c61d14f856a3eb0d6bac">getMask</a>();</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BOMRecipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpbranchonmaskrecipe">VPBranchOnMaskRecipe</a>(BlockInMask);</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Entry =</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><span class="doxyHighlight">      Plan.<a href="/docs/api/classes/llvm/vplan/#aa1202b66a60b632b7adbdee13a20ad7e">createVPBasicBlock</a>(<a href="/docs/api/classes/llvm/twine">Twine</a>(RegionName) + </span><span class="doxyHighlightStringLiteral">&quot;.entry&quot;</span><span class="doxyHighlight">, BOMRecipe);</span></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace predicated replicate recipe with a replicate recipe without a</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// mask but in the replicate region.</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RecipeWithoutMask = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a>(</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">      PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpsingledefrecipe/#a12b12fbdf160f2cf70973e09adbf97d4">getUnderlyingInstr</a>(),</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpuser/#a6b1fcd7575eca39b654ed96202958e14">op&#95;begin</a>(), std::prev(PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpuser/#a634b1fa5443baf5d70ede2f674c46e54">op&#95;end</a>())),</span></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlight">      PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpreplicaterecipe/#a8bb23947220a946748e3f1e6e6825155">isUniform</a>());</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Pred =</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">      Plan.<a href="/docs/api/classes/llvm/vplan/#aa1202b66a60b632b7adbdee13a20ad7e">createVPBasicBlock</a>(<a href="/docs/api/classes/llvm/twine">Twine</a>(RegionName) + </span><span class="doxyHighlightStringLiteral">&quot;.if&quot;</span><span class="doxyHighlight">, RecipeWithoutMask);</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vppredinstphirecipe">VPPredInstPHIRecipe</a> &#42;PHIRecipe = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ac3acda1aa682fbb8f8b95b0816eea879">getNumUsers</a>() != 0) &#123;</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">    PHIRecipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vppredinstphirecipe">VPPredInstPHIRecipe</a>(RecipeWithoutMask,</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">                                        RecipeWithoutMask-&gt;getDebugLoc());</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><span class="doxyHighlight">    PredRecipe-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(PHIRecipe);</span></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><span class="doxyHighlight">    PHIRecipe-&gt;<a href="/docs/api/classes/llvm/vpuser/#a19c3591dc1eeb5648552b33f70e04b65">setOperand</a>(0, RecipeWithoutMask);</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">  PredRecipe-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#aac9dfb61b37082dca00de284bb3309e8">eraseFromParent</a>();</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Exiting =</span></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><span class="doxyHighlight">      Plan.<a href="/docs/api/classes/llvm/vplan/#aa1202b66a60b632b7adbdee13a20ad7e">createVPBasicBlock</a>(<a href="/docs/api/classes/llvm/twine">Twine</a>(RegionName) + </span><span class="doxyHighlightStringLiteral">&quot;.continue&quot;</span><span class="doxyHighlight">, PHIRecipe);</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;<a href="/docs/api/classes/llvm/region">Region</a> =</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">      Plan.<a href="/docs/api/classes/llvm/vplan/#a229a878bb15506314b99639e3d6dca41">createVPRegionBlock</a>(Entry, Exiting, RegionName, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note: first set Entry as region entry and then connect successors starting</span></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// from it in order, to propagate the &quot;parent&quot; of each VPBasicBlock.</span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpblockutils/#a3a43b6445802190031bda62347e97453">VPBlockUtils::insertTwoBlocksAfter</a>(Pred, Exiting, Entry);</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpblockutils/#a40bc7fec35d7093efcdbadf566d6b5ee">VPBlockUtils::connectBlocks</a>(Pred, Exiting);</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/region">Region</a>;</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344" lineLink="#a6e46200e5b228c903356e02904987051"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a6e46200e5b228c903356e02904987051">addReplicateRegions</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPReplicateRecipe &#42;&gt;</a> WorkList;</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()))) &#123;</span></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : &#42;VPBB)</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RepR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReplicateRecipe&gt;</a>(&amp;R)) &#123;</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RepR-&gt;isPredicated())</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">          WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(RepR);</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BBNum = 0;</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a> &#42;RepR : WorkList) &#123;</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;CurrentBlock = RepR-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a09de70cbaf2f15aa3b0697b5f378cc9d">getParent</a>();</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a> = CurrentBlock-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a9b75fcd70de89596b8f04904aa42e2cd">splitAt</a>(RepR-&gt;getIterator());</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OrigBB = RepR-&gt;getUnderlyingInstr()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>-&gt;setName(</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlight">        OrigBB-&gt;<a href="/docs/api/classes/llvm/value/#ad9d88ae321b98d8a3b7f394977ae6d7f">hasName</a>() ? OrigBB-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.&quot;</span><span class="doxyHighlight"> + <a href="/docs/api/classes/llvm/twine">Twine</a>(BBNum++) : </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Record predicated instructions for above packing optimizations.</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;<a href="/docs/api/classes/llvm/region">Region</a> = <a href="#ac967ad551e77554a15e20cac14877ac7">createReplicateRegion</a>(RepR, Plan);</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/region">Region</a>-&gt;setParent(CurrentBlock-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a09de70cbaf2f15aa3b0697b5f378cc9d">getParent</a>());</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpblockutils/#a2057d0749eedf6749f9e1cc6694eb1fd">VPBlockUtils::insertOnEdge</a>(CurrentBlock, <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>, <a href="/docs/api/classes/llvm/region">Region</a>);</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><span class="doxyHighlightComment">/// Remove redundant VPBasicBlocks by merging them into their predecessor if</span></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlightComment">/// the predecessor has a single successor.</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372" lineLink="#a528aff11b730581c8d7cfae0e5fb6254"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopsimplifycfg-cpp/#a5a5d8a7a6d46886bfb6350ed47c0f225">mergeBlocksIntoPredecessors</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPBasicBlock &#42;&gt;</a> WorkList;</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()))) &#123;</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t fold the blocks in the skeleton of the Plan into their single</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predecessors for now.</span></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Remove restriction once more of the skeleton is modeled in VPlan.</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VPBB-&gt;getParent())</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PredVPBB =</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;VPBasicBlock&gt;</a>(VPBB-&gt;getSinglePredecessor());</span></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredVPBB || PredVPBB-&gt;getNumSuccessors() != 1 ||</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPIRBasicBlock&gt;</a>(PredVPBB))</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">    WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VPBB);</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : WorkList) &#123;</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;PredVPBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(VPBB-&gt;getSinglePredecessor());</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;VPBB))</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><span class="doxyHighlight">      R.moveBefore(&#42;PredVPBB, PredVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a4a7f4b8433e9a788149ffd94a0a07051">end</a>());</span></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpblockutils/#a61f1451694a3638db85170c7f55d5581">VPBlockUtils::disconnectBlocks</a>(PredVPBB, VPBB);</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ParentRegion = <a href="/docs/api/namespaces/llvm/#a3e627c32543ca70720c4270a8b11da3f">cast&#95;or&#95;null&lt;VPRegionBlock&gt;</a>(VPBB-&gt;getParent());</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ParentRegion &amp;&amp; ParentRegion-&gt;getExiting() == VPBB)</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlight">      ParentRegion-&gt;setExiting(PredVPBB);</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a886094eaed7ce32029ea52a641142b88">to&#95;vector</a>(VPBB-&gt;successors())) &#123;</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpblockutils/#a61f1451694a3638db85170c7f55d5581">VPBlockUtils::disconnectBlocks</a>(VPBB, Succ);</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpblockutils/#a40bc7fec35d7093efcdbadf566d6b5ee">VPBlockUtils::connectBlocks</a>(PredVPBB, Succ);</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// VPBB is now dead and will be cleaned up when the plan gets destroyed.</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>();</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406" lineLink="/docs/api/structs/llvm/vplantransforms/#a42d43068c576be2a1cd514f620246004"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#a42d43068c576be2a1cd514f620246004">VPlanTransforms::createAndOptimizeReplicateRegions</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Convert masked VPReplicateRecipes to if-then region blocks.</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">  <a href="#a6e46200e5b228c903356e02904987051">addReplicateRegions</a>(Plan);</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ShouldSimplify = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (ShouldSimplify) &#123;</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><span class="doxyHighlight">    ShouldSimplify = <a href="#a1536feae2abb3570ac032768a53ddd00">sinkScalarOperands</a>(Plan);</span></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlight">    ShouldSimplify |= <a href="#a4b251734aba716917922f4ab216436c1">mergeReplicateRegionsIntoSuccessors</a>(Plan);</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlight">    ShouldSimplify |= <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopsimplifycfg-cpp/#a5a5d8a7a6d46886bfb6350ed47c0f225">mergeBlocksIntoPredecessors</a>(Plan);</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlightComment">/// Remove redundant casts of inductions.</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><span class="doxyHighlightComment">/// Such redundant casts are casts of induction variables that can be ignored,</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlightComment">/// because we already proved that the casted phi is equal to the uncasted phi</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlightComment">/// in the vectorized loop. There is no need to vectorize the cast - the same</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlightComment">/// value can be used for both the phi and casts in the vector loop.</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424" lineLink="#a2ff7a57c84a06ee83b0a28763db85c3f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a2ff7a57c84a06ee83b0a28763db85c3f">removeRedundantInductionCasts</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Phi : Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>()) &#123;</span></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenIntOrFpInductionRecipe&gt;</a>(&amp;Phi);</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> || <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getTruncInst())</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// A sequence of IR Casts has potentially been recorded for IV, which</span></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &#42;must be bypassed&#42; when the IV is vectorized, because the vectorized IV</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// will produce the desired casted value. This sequence forms a def-use</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// chain and is provided in reverse order, ending with the cast that uses</span></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the IV phi. Search for the recipe of the last cast in the chain and</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// replace it with the original IV. Note that only the final cast is</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// expected to have users outside the cast-chain and the dead casts left</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// over will be cleaned up later.</span></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Casts = <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getInductionDescriptor().getCastInsts();</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;FindMyCast = <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>;</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IRCast : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(Casts)) &#123;</span></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpsingledefrecipe">VPSingleDefRecipe</a> &#42;FoundUserCast = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U : FindMyCast-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>()) &#123;</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UserCast = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPSingleDefRecipe&gt;</a>(U);</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserCast &amp;&amp; UserCast-&gt;getUnderlyingValue() == IRCast) &#123;</span></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><span class="doxyHighlight">          FoundUserCast = UserCast;</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><span class="doxyHighlight">      FindMyCast = FoundUserCast;</span></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><span class="doxyHighlight">    FindMyCast-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>);</span></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlightComment">/// Try to replace VPWidenCanonicalIVRecipes with a widened canonical IV</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlightComment">/// recipe, if it exists.</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457" lineLink="#aefd03ef5fc77c520e27fe794e8ec93e9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#aefd03ef5fc77c520e27fe794e8ec93e9">removeRedundantCanonicalIVs</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpcanonicalivphirecipe">VPCanonicalIVPHIRecipe</a> &#42;CanonicalIV = Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>();</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpwidencanonicalivrecipe">VPWidenCanonicalIVRecipe</a> &#42;WidenNewIV = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : CanonicalIV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>()) &#123;</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlight">    WidenNewIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenCanonicalIVRecipe&gt;</a>(U);</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WidenNewIV)</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!WidenNewIV)</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;HeaderVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;Phi : HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>()) &#123;</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WidenOriginalIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenIntOrFpInductionRecipe&gt;</a>(&amp;Phi);</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!WidenOriginalIV || !WidenOriginalIV-&gt;isCanonical())</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace WidenNewIV with WidenOriginalIV if WidenOriginalIV provides</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// everything WidenNewIV&#39;s users need. That is, WidenOriginalIV will</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// generate a vector phi or all users of WidenNewIV demand the first lane</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// only.</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(WidenOriginalIV-&gt;users(),</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">               &#91;WidenOriginalIV&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123;</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">                 return !U-&gt;usesScalars(WidenOriginalIV);</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">               &#125;) ||</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/vputils/#a5e3c306be8d629a994f3644765421d5f">vputils::onlyFirstLaneUsed</a>(WidenNewIV)) &#123;</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">      WidenNewIV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(WidenOriginalIV);</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">      WidenNewIV-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#aac9dfb61b37082dca00de284bb3309e8">eraseFromParent</a>();</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlightComment">/// Returns true if \\p R is dead and can be removed.</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493" lineLink="#a6ba2ffb17342f2a0c54adaba2344cab0"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a6ba2ffb17342f2a0c54adaba2344cab0">isDeadRecipe</a>(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R) &#123;</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do remove conditional assume instructions as their conditions may be</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// flattened.</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RepR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReplicateRecipe&gt;</a>(&amp;R);</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsConditionalAssume =</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlight">      RepR &amp;&amp; RepR-&gt;isPredicated() &amp;&amp;</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RepR-&gt;getUnderlyingInstr(), <a href="/docs/api/namespaces/llvm/patternmatch/#a3c0adc1054838f4498e0e860b637a22b">m&#95;Intrinsic&lt;Intrinsic::assume&gt;</a>());</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsConditionalAssume)</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (R.mayHaveSideEffects())</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Recipe is dead if no user keeps the recipe alive.</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(R.definedValues(),</span></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlight">                &#91;&#93;(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;V) &#123; return V-&gt;getNumUsers() == 0; &#125;);</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512" lineLink="/docs/api/structs/llvm/vplantransforms/#aaca9dd97d4c523d8c65274654abe4eb9"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#aaca9dd97d4c523d8c65274654abe4eb9">VPlanTransforms::removeDeadRecipes</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/reversepostordertraversal">ReversePostOrderTraversal&lt;VPBlockDeepTraversalWrapper&lt;VPBlockBase &#42;&gt;</a>&gt; RPOT(</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">      Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>());</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(<a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(RPOT))) &#123;</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The recipes in the block are processed in reverse order, to catch chains</span></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of dead recipes.</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(&#42;VPBB))) &#123;</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a6ba2ffb17342f2a0c54adaba2344cab0">isDeadRecipe</a>(R))</span></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlight">        R.eraseFromParent();</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpscalarivstepsrecipe">VPScalarIVStepsRecipe</a> &#42;</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527" lineLink="#a3c91ec836b0d1e340e17bff8eec31390"><span class="doxyHighlight"><a href="#a3c91ec836b0d1e340e17bff8eec31390">createScalarIVSteps</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabcc">InductionDescriptor::InductionKind</a> Kind,</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/instruction/#ac26154a24f393f523c87cc5f8239f36c">Instruction::BinaryOps</a> InductionOpcode,</span></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/fpmathoperator">FPMathOperator</a> &#42;FPBinOp, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TruncI,</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;StartV, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Step, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> &amp;Builder) &#123;</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;HeaderVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpcanonicalivphirecipe">VPCanonicalIVPHIRecipe</a> &#42;CanonicalIV = Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>();</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpsingledefrecipe">VPSingleDefRecipe</a> &#42;BaseIV = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#a3d75b91bc4016f3078bab29877d8b68e">createDerivedIV</a>(</span></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlight">      Kind, FPBinOp, StartV, CanonicalIV, Step, </span><span class="doxyHighlightStringLiteral">&quot;offset.idx&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Truncate base induction if needed.</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CanonicalIVType = CanonicalIV-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>();</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo(CanonicalIVType);</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ResultTy = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(BaseIV);</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TruncI) &#123;</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;TruncTy = TruncI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ResultTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &gt; TruncTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &amp;&amp;</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Not truncating.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ResultTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Truncation requires an integer type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlight">    BaseIV = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#a7651e884685052147f007e0e0fe0c774">createScalarCast</a>(Instruction::Trunc, BaseIV, TruncTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlight">    ResultTy = TruncTy;</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Truncate step if needed.</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;StepTy = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(Step);</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ResultTy != StepTy) &#123;</span></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StepTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &gt; ResultTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &amp;&amp;</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Not truncating.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(StepTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Truncation requires an integer type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VecPreheader =</span></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aeb7f03f5f68b01423a16a5dd469ddc71">getSingleHierarchicalPredecessor</a>());</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpbuilder/insertpointguard">VPBuilder::InsertPointGuard</a> Guard(Builder);</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlight">    Builder.<a href="/docs/api/classes/llvm/vpbuilder/#afc190306945dd17129c24477566099ce">setInsertPoint</a>(VecPreheader);</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">    Step = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#a7651e884685052147f007e0e0fe0c774">createScalarCast</a>(Instruction::Trunc, Step, ResultTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Builder.<a href="/docs/api/classes/llvm/vpbuilder/#a9bdebe594005618b27255ea3ea2d2cdb">createScalarIVSteps</a>(InductionOpcode, FPBinOp, BaseIV, Step);</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565" lineLink="#aa70c8f392e8295a96bfd493337e122fa"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPUser &#42;&gt;</a> <a href="#aa70c8f392e8295a96bfd493337e122fa">collectUsersRecursively</a>(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;V) &#123;</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;VPUser &#42;&gt;</a> <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>(V-&gt;user&#95;begin(), V-&gt;user&#95;end());</span></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.size(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Cur = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPHeaderPHIRecipe&gt;</a>(Cur))</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;V : Cur-&gt;<a href="/docs/api/classes/llvm/vpdef/#a5b7aa8b207f721cee2e80ebd99682563">definedValues</a>())</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.insert(V-&gt;user&#95;begin(), V-&gt;user&#95;end());</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>.takeVector();</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlightComment">/// Legalize VPWidenPointerInductionRecipe, by replacing it with a PtrAdd</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><span class="doxyHighlightComment">/// (IndStart, ScalarIVSteps (0, Step)) if only its scalar values are used, as</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><span class="doxyHighlightComment">/// VPWidenPointerInductionRecipe will generate vectors only. If some users</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><span class="doxyHighlightComment">/// require vectors while other require scalars, the scalar uses need to extract</span></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlightComment">/// the scalars from the generated vectors (Note that this is different to how</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlightComment">/// int/fp inductions are handled). Legalize extract-from-ends using uniform</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlightComment">/// VPReplicateRecipe of wide inductions to use regular VPReplicateRecipe, so</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlightComment">/// the correct end value is available. Also optimize</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><span class="doxyHighlightComment">/// VPWidenIntOrFpInductionRecipe, if any of its users needs scalar values, by</span></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlightComment">/// providing them scalar steps built on the canonical scalar IV and update the</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><span class="doxyHighlightComment">/// original IV&#39;s users. This is an optional optimization to reduce the needs of</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><span class="doxyHighlightComment">/// vector extracts.</span></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589" lineLink="#a6bc9d4e47e8a41e60f4bedae712f0c03"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a6bc9d4e47e8a41e60f4bedae712f0c03">legalizeAndOptimizeInductions</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">llvm::VPlanPatternMatch</a>;</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;HeaderVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasOnlyVectorVFs = !Plan.<a href="/docs/api/classes/llvm/vplan/#a633dd97e642c10e8aa1dff2bd2874edb">hasVF</a>(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1));</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> Builder(HeaderVPBB, HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>());</span></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;Phi : HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>()) &#123;</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PhiR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenInductionRecipe&gt;</a>(&amp;Phi);</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PhiR)</span></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Try to narrow wide and replicating recipes to uniform recipes, based on</span></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// VPlan analysis.</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Apply to all recipes in the future, to replace legacy uniformity</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// analysis.</span></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a> = <a href="#aa70c8f392e8295a96bfd493337e122fa">collectUsersRecursively</a>(PhiR);</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(<a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>)) &#123;</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Def = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPSingleDefRecipe&gt;</a>(U);</span></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RepR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReplicateRecipe&gt;</a>(U);</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Skip recipes that shouldn&#39;t be narrowed.</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Def || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPReplicateRecipe, VPWidenRecipe&gt;</a>(Def) ||</span></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlight">          Def-&gt;getNumUsers() == 0 || !Def-&gt;getUnderlyingValue() ||</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><span class="doxyHighlight">          (RepR &amp;&amp; (RepR-&gt;isUniform() || RepR-&gt;isPredicated())))</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Skip recipes that may have other lanes than their first used.</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/vputils/#a002a77cdbc23293b8f7a8458ffd0f905">vputils::isUniformAfterVectorization</a>(Def) &amp;&amp;</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><span class="doxyHighlight">          !<a href="/docs/api/namespaces/llvm/vputils/#a5e3c306be8d629a994f3644765421d5f">vputils::onlyFirstLaneUsed</a>(Def))</span></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Clone = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a>(Def-&gt;getUnderlyingInstr(),</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlight">                                          Def-&gt;operands(), </span><span class="doxyHighlightComment">/&#42;IsUniform&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><span class="doxyHighlight">      Clone-&gt;insertAfter(Def);</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><span class="doxyHighlight">      Def-&gt;replaceAllUsesWith(Clone);</span></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace wide pointer inductions which have only their scalars used by</span></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// PtrAdd(IndStart, ScalarIVSteps (0, Step)).</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PtrIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenPointerInductionRecipe&gt;</a>(&amp;Phi)) &#123;</span></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PtrIV-&gt;onlyScalarsGenerated(Plan.<a href="/docs/api/classes/llvm/vplan/#a18b96ac619241bd2248a355af718a192">hasScalableVF</a>()))</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> = PtrIV-&gt;getInductionDescriptor();</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;StartV =</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><span class="doxyHighlight">          Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(ConstantInt::get(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getStep()-&gt;getType(), 0));</span></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;StepV = PtrIV-&gt;getOperand(1);</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpscalarivstepsrecipe">VPScalarIVStepsRecipe</a> &#42;Steps = <a href="#a3c91ec836b0d1e340e17bff8eec31390">createScalarIVSteps</a>(</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><span class="doxyHighlight">          Plan, <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabccaf0191e822c9708e106d7bb58aa9ec947">InductionDescriptor::IK&#95;IntInduction</a>, Instruction::Add, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, StartV, StepV, PtrIV-&gt;getDebugLoc(), Builder);</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;PtrAdd = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#a4098fdd65180c4601108d663dc6618c9">createPtrAdd</a>(PtrIV-&gt;getStartValue(), Steps,</span></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlight">                                             PtrIV-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a733c4c530159a8b86223376c0696430e">getDebugLoc</a>(), </span><span class="doxyHighlightStringLiteral">&quot;next.gep&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><span class="doxyHighlight">      PtrIV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(PtrAdd);</span></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Replace widened induction with scalar steps for users that only use</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scalars.</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WideIV = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenIntOrFpInductionRecipe&gt;</a>(&amp;Phi);</span></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasOnlyVectorVFs &amp;&amp; <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(WideIV-&gt;users(), &#91;WideIV&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123;</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><span class="doxyHighlight">          return U-&gt;usesScalars(WideIV);</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><span class="doxyHighlight">        &#125;))</span></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> = WideIV-&gt;getInductionDescriptor();</span></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpscalarivstepsrecipe">VPScalarIVStepsRecipe</a> &#42;Steps = <a href="#a3c91ec836b0d1e340e17bff8eec31390">createScalarIVSteps</a>(</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><span class="doxyHighlight">        Plan, <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getKind(), <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getInductionOpcode(),</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;FPMathOperator&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getInductionBinOp()),</span></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlight">        WideIV-&gt;getTruncInst(), WideIV-&gt;getStartValue(), WideIV-&gt;getStepValue(),</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><span class="doxyHighlight">        WideIV-&gt;getDebugLoc(), Builder);</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update scalar users of IV to use Step instead.</span></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HasOnlyVectorVFs)</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">      WideIV-&gt;replaceAllUsesWith(Steps);</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><span class="doxyHighlight">      WideIV-&gt;replaceUsesWithIf(Steps, &#91;WideIV&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &amp;U, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> U.usesScalars(WideIV);</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlightComment">/// Check if \\p VPV is an untruncated wide induction, either before or after the</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlightComment">/// increment. If so return the header IV (before the increment), otherwise</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><span class="doxyHighlightComment">/// return null.</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673" lineLink="#aa35433def455d3f76738769247678052"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwideninductionrecipe">VPWidenInductionRecipe</a> &#42;<a href="#aa35433def455d3f76738769247678052">getOptimizableIVOf</a>(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;VPV) &#123;</span></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WideIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenInductionRecipe&gt;</a>(VPV);</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WideIV) &#123;</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// VPV itself is a wide induction, separately compute the end value for exit</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// users if it is not a truncated IV.</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IntOrFpIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenIntOrFpInductionRecipe&gt;</a>(WideIV);</span></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (IntOrFpIV &amp;&amp; IntOrFpIV-&gt;getTruncInst()) ? nullptr : WideIV;</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if VPV is an optimizable induction increment.</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Def = VPV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#a3be8d7833df422f3538ddb13af69bd70">getDefiningRecipe</a>();</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Def || Def-&gt;getNumOperands() != 2)</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlight">  WideIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenInductionRecipe&gt;</a>(Def-&gt;getOperand(0));</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!WideIV)</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlight">    WideIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenInductionRecipe&gt;</a>(Def-&gt;getOperand(1));</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!WideIV)</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsWideIVInc = &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">VPlanPatternMatch</a>;</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> = WideIV-&gt;getInductionDescriptor();</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if VPV increments the induction by the induction step.</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;IVStep = WideIV-&gt;getStepValue();</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getInductionOpcode()) &#123;</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Add:</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VPV, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#afd2774999cdb5e105b5de1910aadc21a">m&#95;c&#95;Binary&lt;Instruction::Add&gt;</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(WideIV),</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><span class="doxyHighlight">                                                     <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(IVStep)));</span></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FAdd:</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VPV, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#afd2774999cdb5e105b5de1910aadc21a">m&#95;c&#95;Binary&lt;Instruction::FAdd&gt;</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(WideIV),</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">                                                      <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(IVStep)));</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FSub:</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VPV, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a5693223ba55481975ccee9dbaa716d6f">m&#95;Binary&lt;Instruction::FSub&gt;</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(WideIV),</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">                                                    <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(IVStep)));</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Sub: &#123;</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// IVStep will be the negated step of the subtraction. Check if Step == -1</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// &#42; IVStep.</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Step;</span></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VPV,</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlight">                 <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a5693223ba55481975ccee9dbaa716d6f">m&#95;Binary&lt;Instruction::Sub&gt;</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(Step))) ||</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlight">          !Step-&gt;<a href="/docs/api/classes/llvm/vpvalue/#add6179d3564ac5ea4736366b93d23829">isLiveIn</a>() || !IVStep-&gt;<a href="/docs/api/classes/llvm/vpvalue/#add6179d3564ac5ea4736366b93d23829">isLiveIn</a>())</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;StepCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(Step-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ac6f0bd9ed63fe4a784697d73ae3b6fa0">getLiveInIRValue</a>());</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IVStepCI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(IVStep-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ac6f0bd9ed63fe4a784697d73ae3b6fa0">getLiveInIRValue</a>());</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> StepCI &amp;&amp; IVStepCI &amp;&amp;</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><span class="doxyHighlight">             StepCI-&gt;getValue() == (-1 &#42; IVStepCI-&gt;getValue());</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getKind() == <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabccab61689ca7d0a024fc4ff52a74d691ae2">InductionDescriptor::IK&#95;PtrInduction</a> &amp;&amp;</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VPV, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a48b3e852725673dc15409c7048803b14">m&#95;GetElementPtr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(WideIV),</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">                                        <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(WideIV-&gt;getStepValue())));</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;should have been covered by switch above&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IsWideIVInc() ? WideIV : </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731" lineLink="/docs/api/structs/llvm/vplantransforms/#a3a573419fed83f23b6bf70ac6731dbfa"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#a3a573419fed83f23b6bf70ac6731dbfa">VPlanTransforms::optimizeInductionExitUsers</a>(</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;VPValue &#42;, VPValue &#42;&gt;</a> &amp;EndValues) &#123;</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">VPlanPatternMatch</a>;</span></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPIRBasicBlock &#42;&gt;</a> ExitVPBBs(Plan.<a href="/docs/api/classes/llvm/vplan/#a85800ca7a821f540ad2d6d4d3c2d4208">getExitBlocks</a>());</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExitVPBBs.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() != 1)</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> &#42;ExitVPBB = ExitVPBBs&#91;0&#93;;</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;PredVPBB = ExitVPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aa1bb4808c7a5db9f8ed3f479c78c4b5e">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredVPBB)</span></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PredVPBB == Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>() &amp;&amp;</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;predecessor must be the middle block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>());</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#ac98e46fa8ff66b24ce678ddea88a23ac">getTerminator</a>());</span></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : &#42;ExitVPBB) &#123;</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExitIRI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPIRInstruction&gt;</a>(&amp;R);</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(ExitIRI-&gt;getInstruction()))</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/structs/llvm/incoming">Incoming</a>;</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(ExitIRI-&gt;getOperand(0),</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a5438a63c52f3576904c86e1bf0c7a9ab">m&#95;VPInstruction&lt;VPInstruction::ExtractFromEnd&gt;</a>(</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><span class="doxyHighlight">                   <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(1))))</span></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WideIV = <a href="#aa35433def455d3f76738769247678052">getOptimizableIVOf</a>(<a href="/docs/api/structs/llvm/incoming">Incoming</a>);</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!WideIV)</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;EndValue = EndValues.<a href="/docs/api/classes/llvm/densemapbase/#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(WideIV);</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EndValue &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;end value must have been pre-computed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/incoming">Incoming</a> != WideIV) &#123;</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">      ExitIRI-&gt;setOperand(0, EndValue);</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Escape = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Step = WideIV-&gt;getStepValue();</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarTy = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(WideIV);</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ScalarTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>()) &#123;</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">      Escape =</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.createNaryOp(Instruction::Sub, &#123;EndValue, Step&#125;, &#123;&#125;, </span><span class="doxyHighlightStringLiteral">&quot;ind.escape&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ScalarTy-&gt;<a href="/docs/api/classes/llvm/type/#a3b996fbf8458aafffc86cb98a68d0a47">isPointerTy</a>()) &#123;</span></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Zero = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlight">          ConstantInt::get(Step-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ac6f0bd9ed63fe4a784697d73ae3b6fa0">getLiveInIRValue</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 0));</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlight">      Escape = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.createPtrAdd(EndValue,</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlight">                              <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.createNaryOp(Instruction::Sub, &#123;Zero, Step&#125;),</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">                              &#123;&#125;, </span><span class="doxyHighlightStringLiteral">&quot;ind.escape&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ScalarTy-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>()) &#123;</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> = WideIV-&gt;getInductionDescriptor();</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">      Escape = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.createNaryOp(</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getInductionBinOp()-&gt;getOpcode() == Instruction::FAdd</span></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlight">              ? Instruction::FSub</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlight">              : Instruction::FAdd,</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlight">          &#123;EndValue, Step&#125;, &#123;ID.getInductionBinOp()-&gt;getFastMathFlags()&#125;);</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;all possible induction types must be handled&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">    ExitIRI-&gt;setOperand(0, Escape);</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlightComment">/// Remove redundant EpxandSCEVRecipes in \\p Plan&#39;s entry block by replacing</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlightComment">/// them with already existing recipes expanding the same SCEV expression.</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797" lineLink="#a8a0202a443a527ba17fcd111497feb7d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a8a0202a443a527ba17fcd111497feb7d">removeRedundantExpandSCEVRecipes</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const SCEV &#42;, VPValue &#42;&gt;</a> SCEV2VPV;</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R :</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">       <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>())) &#123;</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExpR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPExpandSCEVRecipe&gt;</a>(&amp;R);</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExpR)</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = SCEV2VPV.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;ExpR-&gt;getSCEV(), ExpR&#125;);</span></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.second)</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlight">    ExpR-&gt;replaceAllUsesWith(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.first-&gt;second);</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlight">    ExpR-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814" lineLink="#ab5d43362c1fefd60d9bfcc1e28ba4688"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#ab5d43362c1fefd60d9bfcc1e28ba4688">recursivelyDeleteDeadRecipes</a>(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;V) &#123;</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;&gt;</a> WorkList;</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;VPValue &#42;, 8&gt;</a> Seen;</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">  WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(V);</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Cur = WorkList.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Seen.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Cur).second)</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;R = Cur-&gt;<a href="/docs/api/classes/llvm/vpvalue/#a3be8d7833df422f3538ddb13af69bd70">getDefiningRecipe</a>();</span></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!R)</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a6ba2ffb17342f2a0c54adaba2344cab0">isDeadRecipe</a>(&#42;R))</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">    WorkList.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(R-&gt;op&#95;begin(), R-&gt;op&#95;end());</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">    R-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><span class="doxyHighlightComment">/// Try to simplify recipe \\p R.</span></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834" lineLink="#a842c12e686e91a515dfd30a4bf70d740"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a842c12e686e91a515dfd30a4bf70d740">simplifyRecipe</a>(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R, <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> &amp;TypeInfo) &#123;</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">llvm::VPlanPatternMatch</a>;</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Blend = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPBlendRecipe&gt;</a>(&amp;R)) &#123;</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Try to remove redundant blend recipes.</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;VPValue &#42;, 4&gt;</a> UniqueValues;</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Blend-&gt;isNormalized() || !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Blend-&gt;getMask(0), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a857db44d5e19818efc62c9ed25e6b4ea">m&#95;False</a>()))</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">      UniqueValues.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Blend-&gt;getIncomingValue(0));</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 1; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != Blend-&gt;getNumIncomingValues(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Blend-&gt;getMask(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a857db44d5e19818efc62c9ed25e6b4ea">m&#95;False</a>()))</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">        UniqueValues.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Blend-&gt;getIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UniqueValues.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() == 1) &#123;</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">      Blend-&gt;replaceAllUsesWith(&#42;UniqueValues.<a href="/docs/api/classes/llvm/smallptrsetimpl/#abf73a826b5d6f739eb4af48ddf14c5b4">begin</a>());</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">      Blend-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Blend-&gt;isNormalized())</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Normalize the blend so its first incoming value is used as the initial</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value with the others blended into it.</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> StartIndex = 0;</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != Blend-&gt;getNumIncomingValues(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If a value&#39;s mask is used only by the blend then is can be deadcoded.</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: Find the most expensive mask that can be deadcoded, or a mask</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// that&#39;s used by multiple blends where it can be removed from them all.</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Mask = Blend-&gt;getMask(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Mask-&gt;getNumUsers() == 1 &amp;&amp; !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Mask, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a857db44d5e19818efc62c9ed25e6b4ea">m&#95;False</a>())) &#123;</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">        StartIndex = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;, 4&gt;</a> OperandsWithMask;</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">    OperandsWithMask.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Blend-&gt;getIncomingValue(StartIndex));</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != Blend-&gt;getNumIncomingValues(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == StartIndex)</span></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><span class="doxyHighlight">      OperandsWithMask.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Blend-&gt;getIncomingValue(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">      OperandsWithMask.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Blend-&gt;getMask(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewBlend = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpblendrecipe">VPBlendRecipe</a>(</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(Blend-&gt;getUnderlyingValue()), OperandsWithMask);</span></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlight">    NewBlend-&gt;insertBefore(&amp;R);</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;DeadMask = Blend-&gt;getMask(StartIndex);</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">    Blend-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(NewBlend);</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><span class="doxyHighlight">    Blend-&gt;eraseFromParent();</span></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><span class="doxyHighlight">    <a href="#ab5d43362c1fefd60d9bfcc1e28ba4688">recursivelyDeleteDeadRecipes</a>(DeadMask);</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>;</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R, <a href="/docs/api/namespaces/llvm/patternmatch/#a1b8442c10c9ed6e0e07160b54541450e">m&#95;Trunc</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>))))) &#123;</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Trunc = R.getVPSingleValue();</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;TruncTy = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(Trunc);</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ATy = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TruncTy == ATy) &#123;</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><span class="doxyHighlight">      Trunc-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</span></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t replace a scalarizing recipe with a widened cast.</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPReplicateRecipe&gt;</a>(&amp;R))</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ATy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &lt; TruncTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>()) &#123;</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ExtOpcode = <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(R.getOperand(0), <a href="/docs/api/namespaces/llvm/patternmatch/#ae5cf2b09af0c75d08cf9e5e8f2818a66">m&#95;SExt</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>()))</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">                                 ? Instruction::SExt</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">                                 : Instruction::ZExt;</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VPC =</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>(<a href="/docs/api/classes/llvm/instruction/#afa0b2fa29ba074f2b6ec9ac11163f2d9">Instruction::CastOps</a>(ExtOpcode), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, TruncTy);</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UnderlyingExt = R.getOperand(0)-&gt;getUnderlyingValue()) &#123;</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// UnderlyingExt has distinct return type, used to retain legacy cost.</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">          VPC-&gt;setUnderlyingValue(UnderlyingExt);</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlight">        VPC-&gt;insertBefore(&amp;R);</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlight">        Trunc-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(VPC);</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ATy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &gt; TruncTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>()) &#123;</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VPC = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>(Instruction::Trunc, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, TruncTy);</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">        VPC-&gt;insertBefore(&amp;R);</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">        Trunc-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(VPC);</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Verify that the cached type info is for both A and its users is still</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// accurate by comparing it to freshly computed types.</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo2(</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">        R.getParent()-&gt;getPlan()-&gt;getCanonicalIV()-&gt;getScalarType());</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>) == TypeInfo2.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>));</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;users()) &#123;</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;R = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(U);</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;VPV : R-&gt;definedValues())</span></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(VPV) == TypeInfo2.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(VPV));</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Simplify (X &amp;&amp; Y) || (X &amp;&amp; !Y) -&gt; X.</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Split up into simpler, modular combines: (X &amp;&amp; Y) || (X &amp;&amp; Z) into X</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &amp;&amp; (Y || Z) and (X || !X) into true. This requires queuing newly created</span></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// recipes to be visited during simplification.</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>, &#42;X1, &#42;Y1;</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R,</span></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a27cb031d5b7fd1ff6f33a45d823866d7">m&#95;c&#95;BinaryOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>)),</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><span class="doxyHighlight">                         <a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(X1), <a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(Y1))))) &amp;&amp;</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a> == X1 &amp;&amp; <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> == Y1) &#123;</span></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">    R.getVPSingleValue()-&gt;replaceAllUsesWith(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>);</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">    R.eraseFromParent();</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R, <a href="/docs/api/namespaces/llvm/patternmatch/#af10813bee5ce9c7b412807aac434deef">m&#95;c&#95;Mul</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(1))))</span></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> R.getVPSingleValue()-&gt;replaceAllUsesWith(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R, <a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>)))))</span></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> R.getVPSingleValue()-&gt;replaceAllUsesWith(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>);</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove redundant DerviedIVs, that is 0 + A &#42; 1 -&gt; A and 0 + 0 &#42; x -&gt; 0</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R,</span></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a8a1bf026bda785519069e37d7a7de192">m&#95;DerivedIV</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(0), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(1))) ||</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><span class="doxyHighlight">       <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R,</span></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a8a1bf026bda785519069e37d7a7de192">m&#95;DerivedIV</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(0), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(0), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>()))) &amp;&amp;</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlight">      TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(R.getOperand(1)) ==</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlight">          TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(R.getVPSingleValue()))</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> R.getVPSingleValue()-&gt;replaceAllUsesWith(R.getOperand(1));</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlightComment">/// Try to simplify the recipes in \\p Plan. Use \\p CanonicalIVTy as type for all</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><span class="doxyHighlightComment">/// un-typed live-ins in VPTypeAnalysis.</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967" lineLink="#a74cb3294789bc24526bcadbf6b466714"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a74cb3294789bc24526bcadbf6b466714">simplifyRecipes</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/type">Type</a> &#42;CanonicalIVTy) &#123;</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/reversepostordertraversal">ReversePostOrderTraversal&lt;VPBlockDeepTraversalWrapper&lt;VPBlockBase &#42;&gt;</a>&gt; RPOT(</span></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlight">      Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>());</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo(CanonicalIVTy);</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(RPOT)) &#123;</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;VPBB)) &#123;</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">      <a href="#a842c12e686e91a515dfd30a4bf70d740">simplifyRecipe</a>(R, TypeInfo);</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978" lineLink="/docs/api/structs/llvm/vplantransforms/#af25d938764b8634e70e95ff3f0c35129"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#af25d938764b8634e70e95ff3f0c35129">VPlanTransforms::optimizeForVFAndUF</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> BestVF,</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">                                         </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BestUF,</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;PSE) &#123;</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a633dd97e642c10e8aa1dff2bd2874edb">hasVF</a>(BestVF) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;BestVF is not available in Plan&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a6e9c2a69cd9bc0e46626f5302a03d3da">hasUF</a>(BestUF) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;BestUF is not available in Plan&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;VectorRegion = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;ExitingVPBB = VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a28da654f916bf44da5513b6f1788835c">getExitingBasicBlock</a>();</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Term = &amp;ExitingVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#ad0efc053a4e5325214b6de6f9f6e49d7">back</a>();</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try to simplify the branch condition if TC &lt;= VF &#42; UF when preparing to</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// execute the plan for the main vector loop. We only do this if the</span></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// terminator is:</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  1 BranchOnCount, or</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  2 BranchOnCond where the input is Not(ActiveLaneMask).</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">llvm::VPlanPatternMatch</a>;</span></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Term, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a781b43897f427e5c19a39c57259146ed">m&#95;BranchOnCount</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>())) &amp;&amp;</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Term,</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#ab0e78b42dfbac0cbe15c785c4b815ba4">m&#95;BranchOnCond</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#ae28f9cbf5b5e3fbeb69d1414285c1760">m&#95;Not</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a35cc851a200ea1bb42140e0db2bd3274">m&#95;ActiveLaneMask</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>())))))</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE = &#42;PSE.<a href="/docs/api/classes/llvm/predicatedscalarevolution/#a10ca5eacc61b5669880de2f8b0cff33c">getSE</a>();</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;TripCount =</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/vputils/#a5999b0390c92ee4af2544fe9772454bf">vputils::getSCEVExprForVPValue</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a2f5fc19caa67daeca8a1316c7e055e3c">getTripCount</a>(), SE);</span></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(TripCount) &amp;&amp;</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Trip count SCEV must be computable&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> NumElements = BestVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#aa5b3e822013fe51665e9bddc4874cd48">multiplyCoefficientBy</a>(BestUF);</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = SE.<a href="/docs/api/classes/llvm/scalarevolution/#adfad3d829fd98014f225d55b4a924819">getElementCount</a>(TripCount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>(), NumElements);</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TripCount-&gt;<a href="/docs/api/classes/llvm/scev/#a4541962f9c18aacceb7243520eb15e1f">isZero</a>() ||</span></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlight">      !SE.<a href="/docs/api/classes/llvm/scalarevolution/#af74112dae88db73eb5484821b6f0fccd">isKnownPredicate</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">CmpInst::ICMP&#95;ULE</a>, TripCount, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>))</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The vector loop region only executes once. If possible, completely remove</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the region, otherwise replace the terminator controlling the latch with</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (BranchOnCond true).</span></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Header = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#a1ae2cb3c63b4d67324ddc947fb9696fc">getEntry</a>());</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CanIVTy = Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>();</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlight">          Header-&gt;phis(),</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#af462c722ac0144c995057a2f6e616507">IsaPred&lt;VPCanonicalIVPHIRecipe, VPFirstOrderRecurrencePHIRecipe&gt;</a>)) &#123;</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;HeaderR : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(Header-&gt;phis())) &#123;</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;HeaderPhiR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPHeaderPHIRecipe&gt;</a>(&amp;HeaderR);</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">      HeaderPhiR-&gt;replaceAllUsesWith(HeaderPhiR-&gt;getStartValue());</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><span class="doxyHighlight">      HeaderPhiR-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;Preheader = VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aa1bb4808c7a5db9f8ed3f479c78c4b5e">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;Exit = VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>();</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpblockutils/#a61f1451694a3638db85170c7f55d5581">VPBlockUtils::disconnectBlocks</a>(Preheader, VectorRegion);</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpblockutils/#a61f1451694a3638db85170c7f55d5581">VPBlockUtils::disconnectBlocks</a>(VectorRegion, Exit);</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> : <a href="/docs/api/namespaces/llvm/#a4474bfb1e0ca062e5bfe2a35980e7d19">vp&#95;depth&#95;first&#95;shallow</a>(VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#a1ae2cb3c63b4d67324ddc947fb9696fc">getEntry</a>()))</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;setParent(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpblockutils/#a40bc7fec35d7093efcdbadf566d6b5ee">VPBlockUtils::connectBlocks</a>(Preheader, Header);</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpblockutils/#a40bc7fec35d7093efcdbadf566d6b5ee">VPBlockUtils::connectBlocks</a>(ExitingVPBB, Exit);</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><span class="doxyHighlight">    <a href="#a74cb3294789bc24526bcadbf6b466714">simplifyRecipes</a>(Plan, CanIVTy);</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The vector region contains header phis for which we cannot remove the</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// loop region yet.</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = SE.<a href="/docs/api/classes/llvm/scalarevolution/#aff9e533399d91febd63fa4bfe82a42a7">getContext</a>();</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BOC = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a>(</span></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a0062eccdb4956531f7b6a3cf71c3320c">VPInstruction::BranchOnCond</a>,</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlight">        &#123;Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(<a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(Ctx))&#125;, Term-&gt;getDebugLoc());</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">    ExitingVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a23773e962f9a56c9bdf13f7668b063a5">appendRecipe</a>(BOC);</span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlight">  Term-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vplantransforms/#aaca9dd97d4c523d8c65274654abe4eb9">VPlanTransforms::removeDeadRecipes</a>(Plan);</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlight">  Plan.<a href="/docs/api/classes/llvm/vplan/#a7ee6ab8541efab3e456a38d6c1fa1be2">setVF</a>(BestVF);</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">  Plan.<a href="/docs/api/classes/llvm/vplan/#af1d539e508015e09e4b9fdb7d020da0e">setUF</a>(BestUF);</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Further simplifications are possible</span></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      1 Replace inductions with constants.</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      2 Replace vector loop region with VPBasicBlock.</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlightComment">/// Sink users of \\p FOR after the recipe defining the previous value \\p</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlightComment">/// Previous of the recurrence. \\returns true if all users of \\p FOR could be</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlightComment">/// re-arranged as needed or false if it is not possible.</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057" lineLink="#a4a5b1db18197a65d0f6a487f2e236921"><span class="doxyHighlight"><a href="#a4a5b1db18197a65d0f6a487f2e236921">sinkRecurrenceUsersAfterPrevious</a>(<a href="/docs/api/structs/llvm/vpfirstorderrecurrencephirecipe">VPFirstOrderRecurrencePHIRecipe</a> &#42;FOR,</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Previous,</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/vpdominatortree">VPDominatorTree</a> &amp;VPDT) &#123;</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect recipes that need sinking.</span></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPRecipeBase &#42;&gt;</a> WorkList;</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;VPRecipeBase &#42;, 8&gt;</a> Seen;</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlight">  Seen.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Previous);</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> TryToPushSinkCandidate = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;SinkCandidate) &#123;</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The previous value must not depend on the users of the recurrence phi. In</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that case, FOR is not a fixed order recurrence.</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SinkCandidate == Previous)</span></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPHeaderPHIRecipe&gt;</a>(SinkCandidate) ||</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">        !Seen.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(SinkCandidate).second ||</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">        VPDT.<a href="/docs/api/classes/llvm/vpdominatortree/#a044ef784dc6a77995842977a9956013f">properlyDominates</a>(Previous, SinkCandidate))</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SinkCandidate-&gt;mayHaveSideEffects())</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">    WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(SinkCandidate);</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Recursively sink users of FOR after Previous.</span></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlight">  WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FOR);</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != WorkList.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Current = WorkList&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Current-&gt;<a href="/docs/api/classes/llvm/vpdef/#a31492b9d8412415c2dae85e33e2748fd">getNumDefinedValues</a>() == 1 &amp;&amp;</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;only recipes with a single defined value expected&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;<a href="/docs/api/classes/llvm/user">User</a> : Current-&gt;<a href="/docs/api/classes/llvm/vpdef/#a76a983b694720483a3dd9fe57314e39b">getVPSingleValue</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>()) &#123;</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!TryToPushSinkCandidate(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(<a href="/docs/api/classes/llvm/user">User</a>)))</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Keep recipes to sink ordered by dominance so earlier instructions are</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// processed first.</span></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">sort</a>(WorkList, &#91;&amp;VPDT&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> VPDT.<a href="/docs/api/classes/llvm/vpdominatortree/#a044ef784dc6a77995842977a9956013f">properlyDominates</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;SinkCandidate : WorkList) &#123;</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SinkCandidate == FOR)</span></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">    SinkCandidate-&gt;moveAfter(Previous);</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">    Previous = SinkCandidate;</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlightComment">/// Try to hoist \\p Previous and its operands before all users of \\p FOR.</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112" lineLink="#a9396319801f74828cfbd94177f38eabc"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a9396319801f74828cfbd94177f38eabc">hoistPreviousBeforeFORUsers</a>(<a href="/docs/api/structs/llvm/vpfirstorderrecurrencephirecipe">VPFirstOrderRecurrencePHIRecipe</a> &#42;FOR,</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Previous,</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/vpdominatortree">VPDominatorTree</a> &amp;VPDT) &#123;</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Previous-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a2408a88276528d80adefefa00995705a">mayHaveSideEffects</a>() || Previous-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a00bc7da040562d501bcc0e0635a2b53c">mayReadFromMemory</a>())</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect recipes that need hoisting.</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPRecipeBase &#42;&gt;</a> HoistCandidates;</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;VPRecipeBase &#42;, 8&gt;</a> Visited;</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;HoistPoint = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find the closest hoist point by looking at all users of FOR and selecting</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the recipe dominating all other users.</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : FOR-&gt;users()) &#123;</span></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;R = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(U);</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HoistPoint || VPDT.<a href="/docs/api/classes/llvm/vpdominatortree/#a044ef784dc6a77995842977a9956013f">properlyDominates</a>(R, HoistPoint))</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><span class="doxyHighlight">      HoistPoint = R;</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(FOR-&gt;users(),</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><span class="doxyHighlight">                &#91;&amp;VPDT, HoistPoint&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123;</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><span class="doxyHighlight">                  auto &#42;R = cast&lt;VPRecipeBase&gt;(U);</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><span class="doxyHighlight">                  return HoistPoint == R ||</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><span class="doxyHighlight">                         VPDT.properlyDominates(HoistPoint, R);</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><span class="doxyHighlight">                &#125;) &amp;&amp;</span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;HoistPoint must dominate all users of FOR&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> NeedsHoisting = &#91;HoistPoint, &amp;VPDT,</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlight">                        &amp;Visited&#93;(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;HoistCandidateV) -&gt; <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42; &#123;</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;HoistCandidate = HoistCandidateV-&gt;getDefiningRecipe();</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HoistCandidate)</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;EnclosingLoopRegion =</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">        HoistCandidate-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a7ce23b4d08f0bd28ea1f676d527ae1d3">getEnclosingLoopRegion</a>();</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!HoistCandidate-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a09de70cbaf2f15aa3b0697b5f378cc9d">getParent</a>() ||</span></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlight">            HoistCandidate-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a09de70cbaf2f15aa3b0697b5f378cc9d">getParent</a>() == EnclosingLoopRegion) &amp;&amp;</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;CFG in VPlan should still be flat, without replicate regions&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Hoist candidate was already visited, no need to hoist.</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(HoistCandidate).second)</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Candidate is outside loop region or a header phi, dominates FOR users w/o</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// hoisting.</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!EnclosingLoopRegion || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPHeaderPHIRecipe&gt;</a>(HoistCandidate))</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we reached a recipe that dominates HoistPoint, we don&#39;t need to</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// hoist the recipe.</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VPDT.<a href="/docs/api/classes/llvm/vpdominatortree/#a044ef784dc6a77995842977a9956013f">properlyDominates</a>(HoistCandidate, HoistPoint))</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> HoistCandidate;</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CanHoist = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;HoistCandidate) &#123;</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Avoid hoisting candidates with side-effects, as we do not yet analyze</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// associated dependencies.</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !HoistCandidate-&gt;mayHaveSideEffects();</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NeedsHoisting(Previous-&gt;<a href="/docs/api/classes/llvm/vpdef/#a76a983b694720483a3dd9fe57314e39b">getVPSingleValue</a>()))</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Recursively try to hoist Previous and its operands before all users of FOR.</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><span class="doxyHighlight">  HoistCandidates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Previous);</span></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != HoistCandidates.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Current = HoistCandidates&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Current-&gt;<a href="/docs/api/classes/llvm/vpdef/#a31492b9d8412415c2dae85e33e2748fd">getNumDefinedValues</a>() == 1 &amp;&amp;</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;only recipes with a single defined value expected&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CanHoist(Current))</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : Current-&gt;<a href="/docs/api/classes/llvm/vpuser/#a11d83265a9e4ff6c6ecd3cf222ad0208">operands</a>()) &#123;</span></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we reach FOR, it means the original Previous depends on some other</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// recurrence that in turn depends on FOR. If that is the case, we would</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// also need to hoist recipes involving the other FOR, which may break</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// dependencies.</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == FOR)</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;R = NeedsHoisting(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</span></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlight">        HoistCandidates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(R);</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Order recipes to hoist by dominance so earlier instructions are processed</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// first.</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">sort</a>(HoistCandidates, &#91;&amp;VPDT&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> VPDT.<a href="/docs/api/classes/llvm/vpdominatortree/#a044ef784dc6a77995842977a9956013f">properlyDominates</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;HoistCandidate : HoistCandidates) &#123;</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><span class="doxyHighlight">    HoistCandidate-&gt;moveBefore(&#42;HoistPoint-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>(),</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><span class="doxyHighlight">                               HoistPoint-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208" lineLink="/docs/api/structs/llvm/vplantransforms/#ae64d6953a1334207d9e7d9cd2587ee9f"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#ae64d6953a1334207d9e7d9cd2587ee9f">VPlanTransforms::adjustFixedOrderRecurrences</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan,</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">                                                  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> &amp;LoopBuilder) &#123;</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpdominatortree">VPDominatorTree</a> VPDT;</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">  VPDT.<a href="/docs/api/classes/llvm/dominatortreebase/#aa0641ae965656ff9988d67a35140e4d9">recalculate</a>(Plan);</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPFirstOrderRecurrencePHIRecipe &#42;&gt;</a> RecurrencePhis;</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R :</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><span class="doxyHighlight">       Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#a1ae2cb3c63b4d67324ddc947fb9696fc">getEntry</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>())</span></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FOR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPFirstOrderRecurrencePHIRecipe&gt;</a>(&amp;R))</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">      RecurrencePhis.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(FOR);</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/vpfirstorderrecurrencephirecipe">VPFirstOrderRecurrencePHIRecipe</a> &#42;FOR : RecurrencePhis) &#123;</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;VPFirstOrderRecurrencePHIRecipe &#42;, 4&gt;</a> SeenPhis;</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Previous = FOR-&gt;getBackedgeValue()-&gt;getDefiningRecipe();</span></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Fixed-order recurrences do not contain cycles, so this loop is guaranteed</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to terminate.</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PrevPhi =</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;VPFirstOrderRecurrencePHIRecipe&gt;</a>(Previous)) &#123;</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PrevPhi-&gt;getParent() == FOR-&gt;getParent());</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SeenPhis.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(PrevPhi).second);</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">      Previous = PrevPhi-&gt;getBackedgeValue()-&gt;getDefiningRecipe();</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a4a5b1db18197a65d0f6a487f2e236921">sinkRecurrenceUsersAfterPrevious</a>(FOR, Previous, VPDT) &amp;&amp;</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">        !<a href="#a9396319801f74828cfbd94177f38eabc">hoistPreviousBeforeFORUsers</a>(FOR, Previous, VPDT))</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Introduce a recipe to combine the incoming and previous values of a</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// fixed-order recurrence.</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;InsertBlock = Previous-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>();</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPHeaderPHIRecipe&gt;</a>(Previous))</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">      LoopBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#afc190306945dd17129c24477566099ce">setInsertPoint</a>(InsertBlock, InsertBlock-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>());</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">      LoopBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#afc190306945dd17129c24477566099ce">setInsertPoint</a>(InsertBlock,</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">                                 std::next(Previous-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>()));</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RecurSplice = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPInstruction&gt;</a>(</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">        LoopBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a811727530f9a54b651d638943d34aa61">VPInstruction::FirstOrderRecurrenceSplice</a>,</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">                                 &#123;FOR, FOR-&gt;getBackedgeValue()&#125;));</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlight">    FOR-&gt;replaceAllUsesWith(RecurSplice);</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Set the first operand of RecurSplice to FOR again, after replacing</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// all users.</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><span class="doxyHighlight">    RecurSplice-&gt;setOperand(0, FOR);</span></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256" lineLink="/docs/api/structs/llvm/vplantransforms/#ace9e1e6e7295914973dec18350b382ca"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#ace9e1e6e7295914973dec18350b382ca">VPlanTransforms::clearReductionWrapFlags</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R :</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><span class="doxyHighlight">       Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>()) &#123;</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PhiR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReductionPHIRecipe&gt;</a>(&amp;R);</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PhiR)</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc = PhiR-&gt;getRecurrenceDescriptor();</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> RK = RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>();</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RK != <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaec211f7c20af43e742bf2570c3cb84f9">RecurKind::Add</a> &amp;&amp; RK != <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830ea62b6d55816cf737bfc6f42e60df1a3f2">RecurKind::Mul</a>)</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : <a href="#aa70c8f392e8295a96bfd493337e122fa">collectUsersRecursively</a>(PhiR))</span></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RecWithFlags = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPRecipeWithIRFlags&gt;</a>(U)) &#123;</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlight">        RecWithFlags-&gt;dropPoisonGeneratingFlags();</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><span class="doxyHighlightComment">/// Move loop-invariant recipes out of the vector loop region in \\p Plan.</span></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275" lineLink="#afd081c92500bd333555e7bd6102b4d3e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp/#a9daa918c2c6be9aa9ca401f69cc75302">licm</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;Preheader = Plan.<a href="/docs/api/classes/llvm/vplan/#aee894572833ce02ad06c067d44f65b48">getVectorPreheader</a>();</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Return true if we do not know how to (mechanically) hoist a given recipe</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// out of a loop region. Does not address legality concerns such as aliasing</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// or speculation safety.</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CannotHoistRecipe = &#91;&#93;(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R) &#123;</span></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Allocas cannot be hoisted.</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RepR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReplicateRecipe&gt;</a>(&amp;R);</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RepR &amp;&amp; RepR-&gt;getOpcode() == Instruction::Alloca;</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Hoist any loop invariant recipes from the vector loop region to the</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// preheader. Preform a shallow traversal of the vector loop region, to</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// exclude recipes in replicate regions.</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;LoopRegion = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#a4474bfb1e0ca062e5bfe2a35980e7d19">vp&#95;depth&#95;first&#95;shallow</a>(LoopRegion-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#a1ae2cb3c63b4d67324ddc947fb9696fc">getEntry</a>()))) &#123;</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;VPBB)) &#123;</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CannotHoistRecipe(R))</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: Relax checks in the future, e.g. we could also hoist reads, if</span></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// their memory location is not modified in the vector loop.</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (R.mayHaveSideEffects() || R.mayReadFromMemory() || R.isPhi() ||</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(R.operands(), &#91;&#93;(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123;</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">            return !Op-&gt;isDefinedOutsideLoopRegions();</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">          &#125;))</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">      R.moveBefore(&#42;Preheader, Preheader-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a4a7f4b8433e9a788149ffd94a0a07051">end</a>());</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308" lineLink="/docs/api/structs/llvm/vplantransforms/#ae61793492431f138869f097a5f31bd32"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#ae61793492431f138869f097a5f31bd32">VPlanTransforms::truncateToMinimalBitwidths</a>(</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;Instruction &#42;, uint64&#95;t&gt;</a> &amp;MinBWs) &#123;</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Count the processed recipes and cross check the count later with MinBWs</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// size, to make sure all entries in MinBWs have been handled.</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumProcessedRecipes = 0;</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Keep track of created truncates, so they can be re-used. Note that we</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cannot use RAUW after creating a new truncate, as this would could make</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// other uses have different types for their operands, making them invalidly</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// typed.</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;VPValue &#42;, VPWidenCastRecipe &#42;&gt;</a> ProcessedTruncs;</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CanonicalIVType = Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>();</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo(CanonicalIVType);</span></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;PH = Plan.<a href="/docs/api/classes/llvm/vplan/#aee894572833ce02ad06c067d44f65b48">getVectorPreheader</a>();</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()))) &#123;</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;VPBB)) &#123;</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa</a>&lt;<a href="/docs/api/classes/llvm/vpwidenrecipe">VPWidenRecipe</a>, <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>, <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a>,</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><span class="doxyHighlight">               <a href="/docs/api/structs/llvm/vpwidenselectrecipe">VPWidenSelectRecipe</a>, <a href="/docs/api/structs/llvm/vpwidenloadrecipe">VPWidenLoadRecipe</a>&gt;(&amp;R))</span></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;ResultVPV = R.getVPSingleValue();</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UI = <a href="/docs/api/namespaces/llvm/#a3e627c32543ca70720c4270a8b11da3f">cast&#95;or&#95;null&lt;Instruction&gt;</a>(ResultVPV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#a5fe7dd2466300bd8747d81384a7ced5d">getUnderlyingValue</a>());</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NewResSizeInBits = MinBWs.<a href="/docs/api/classes/llvm/mapvector/#abca23bddf517f69d28c6d30c58a7b6f9">lookup</a>(UI);</span></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NewResSizeInBits)</span></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">      NumProcessedRecipes++;</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the value wasn&#39;t vectorized, we must maintain the original scalar</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// type. Skip those here, after incrementing NumProcessedRecipes. Also</span></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// skip casts which do not need to be handled explicitly here, as</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// redundant casts will be removed during recipe simplification.</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPReplicateRecipe, VPWidenCastRecipe&gt;</a>(&amp;R)) &#123;</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If any of the operands is a live-in and not used by VPWidenRecipe or</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// VPWidenSelectRecipe, but in MinBWs, make sure it is counted as</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// processed as well. When MinBWs is currently constructed, there is no</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// information about whether recipes are widened or replicated and in</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// case they are reciplicated the operands are not truncated. Counting</span></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// them them here ensures we do not miss any recipes in MinBWs.</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// TODO: Remove once the analysis is done on VPlan.</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : R.operands()) &#123;</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;isLiveIn())</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UV = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getUnderlyingValue());</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UV &amp;&amp; MinBWs.<a href="/docs/api/classes/llvm/mapvector/#a8757ce7071547a0410c82cc096b1ec9a">contains</a>(UV) &amp;&amp; !ProcessedTruncs.<a href="/docs/api/classes/llvm/densemapbase/#a836d9cba6deced0bb1fa7333ce5afd3a">contains</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &amp;&amp;</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;users(),</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">                      <a href="/docs/api/namespaces/llvm/#af462c722ac0144c995057a2f6e616507">IsaPred&lt;VPWidenRecipe, VPWidenSelectRecipe&gt;</a>)) &#123;</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Add an entry to ProcessedTruncs to avoid counting the same</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// operand multiple times.</span></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlight">            ProcessedTruncs&#91;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>&#93; = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlight">            NumProcessedRecipes += 1;</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;OldResTy = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(ResultVPV);</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OldResSizeInBits = OldResTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldResTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;only integer types supported&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">      (void)OldResSizeInBits;</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = CanonicalIVType-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>();</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewResTy = <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(Ctx, NewResSizeInBits);</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Any wrapping introduced by shrinking this operation shouldn&#39;t be</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// considered undefined behavior. So, we can&#39;t unconditionally copy</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// arithmetic wrapping flags to VPW.</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VPW = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPRecipeWithIRFlags&gt;</a>(&amp;R))</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">        VPW-&gt;dropPoisonGeneratingFlags();</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">llvm::VPlanPatternMatch</a>;</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OldResSizeInBits != NewResSizeInBits &amp;&amp;</span></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlight">          !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a5693223ba55481975ccee9dbaa716d6f">m&#95;Binary&lt;Instruction::ICmp&gt;</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>()))) &#123;</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Extend result to original width.</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Ext =</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>(Instruction::ZExt, ResultVPV, OldResTy);</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><span class="doxyHighlight">        Ext-&gt;insertAfter(&amp;R);</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">        ResultVPV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(Ext);</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">        Ext-&gt;setOperand(0, ResultVPV);</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldResSizeInBits &gt; NewResSizeInBits &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Nothing to shrink?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a5693223ba55481975ccee9dbaa716d6f">m&#95;Binary&lt;Instruction::ICmp&gt;</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>())) &amp;&amp;</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">            </span><span class="doxyHighlightStringLiteral">&quot;Only ICmps should not need extending the result.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenStoreRecipe&gt;</a>(&amp;R) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;stores cannot be narrowed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenLoadRecipe&gt;</a>(&amp;R))</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Shrink operands by introducing truncates as needed.</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> StartIdx = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenSelectRecipe&gt;</a>(&amp;R) ? 1 : 0;</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = StartIdx; Idx != R.getNumOperands(); ++Idx) &#123;</span></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = R.getOperand(Idx);</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> OpSizeInBits =</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">            TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>();</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpSizeInBits == NewResSizeInBits)</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OpSizeInBits &gt; NewResSizeInBits &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;nothing to truncate&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;ProcessedIter, IterIsEmpty&#93; =</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><span class="doxyHighlight">            ProcessedTruncs.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(&#123;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">&#125;);</span></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a> &#42;NewOp =</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlight">            IterIsEmpty</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlight">                ? </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>(Instruction::Trunc, <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, NewResTy)</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlight">                : ProcessedIter-&gt;second;</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><span class="doxyHighlight">        R.setOperand(Idx, NewOp);</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IterIsEmpty)</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">        ProcessedIter-&gt;second = NewOp;</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;isLiveIn()) &#123;</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlight">          NewOp-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a8859e5e8cad5653b278964f47414fd84">insertBefore</a>(&amp;R);</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><span class="doxyHighlight">          PH-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a23773e962f9a56c9bdf13f7668b063a5">appendRecipe</a>(NewOp);</span></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getLiveInIRValue());</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsContained = MinBWs.<a href="/docs/api/classes/llvm/mapvector/#a8757ce7071547a0410c82cc096b1ec9a">contains</a>(OpInst);</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">          NumProcessedRecipes += IsContained;</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MinBWs.<a href="/docs/api/classes/llvm/mapvector/#acf4c09e1f30cdd4e0b5b1b8a236ead34">size</a>() == NumProcessedRecipes &amp;&amp;</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;some entries in MinBWs haven&#39;t been processed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441" lineLink="/docs/api/structs/llvm/vplantransforms/#ae3449b993cd1c459995c2fe13ef50892"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#ae3449b993cd1c459995c2fe13ef50892">VPlanTransforms::optimize</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">  <a href="#aefd03ef5fc77c520e27fe794e8ec93e9">removeRedundantCanonicalIVs</a>(Plan);</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">  <a href="#a2ff7a57c84a06ee83b0a28763db85c3f">removeRedundantInductionCasts</a>(Plan);</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">  <a href="#a74cb3294789bc24526bcadbf6b466714">simplifyRecipes</a>(Plan, Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>());</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vplantransforms/#aaca9dd97d4c523d8c65274654abe4eb9">removeDeadRecipes</a>(Plan);</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">  <a href="#a6bc9d4e47e8a41e60f4bedae712f0c03">legalizeAndOptimizeInductions</a>(Plan);</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">  <a href="#a8a0202a443a527ba17fcd111497feb7d">removeRedundantExpandSCEVRecipes</a>(Plan);</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">  <a href="#a74cb3294789bc24526bcadbf6b466714">simplifyRecipes</a>(Plan, Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>());</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vplantransforms/#aaca9dd97d4c523d8c65274654abe4eb9">removeDeadRecipes</a>(Plan);</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vplantransforms/#a42d43068c576be2a1cd514f620246004">createAndOptimizeReplicateRegions</a>(Plan);</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopsimplifycfg-cpp/#a5a5d8a7a6d46886bfb6350ed47c0f225">mergeBlocksIntoPredecessors</a>(Plan);</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/licm-cpp/#a9daa918c2c6be9aa9ca401f69cc75302">licm</a>(Plan);</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlightComment">// Add a VPActiveLaneMaskPHIRecipe and related recipes to \\p Plan and replace</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlightComment">// the loop terminator with a branch-on-cond recipe with the negated</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlightComment">// active-lane-mask as operand. Note that this turns the loop into an</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlightComment">// uncountable one. Only the existing terminator is replaced, all other existing</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlightComment">// recipes/users remain unchanged, except for poison-generating flags being</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><span class="doxyHighlightComment">// dropped from the canonical IV increment. Return the created</span></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlightComment">// VPActiveLaneMaskPHIRecipe.</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlightComment">// The function uses the following definitions:</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlightComment">//  %TripCount = DataWithControlFlowWithoutRuntimeCheck ?</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlightComment">//    calculate-trip-count-minus-VF (original TC) : original TC</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><span class="doxyHighlightComment">//  %IncrementValue = DataWithControlFlowWithoutRuntimeCheck ?</span></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlightComment">//     CanonicalIVPhi : CanonicalIVIncrement</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlightComment">//  %StartV is the canonical induction start value.</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlightComment">// The function adds the following recipes:</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlightComment">// vector.ph:</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlightComment">//   %TripCount = calculate-trip-count-minus-VF (original TC)</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><span class="doxyHighlightComment">//       &#91;if DataWithControlFlowWithoutRuntimeCheck&#93;</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><span class="doxyHighlightComment">//   %EntryInc = canonical-iv-increment-for-part %StartV</span></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlightComment">//   %EntryALM = active-lane-mask %EntryInc, %TripCount</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlightComment">// vector.body:</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlightComment">//   %P = active-lane-mask-phi &#91; %EntryALM, %vector.ph &#93;, &#91; %ALM, %vector.body &#93;</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlightComment">//   ...</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><span class="doxyHighlightComment">//   %InLoopInc = canonical-iv-increment-for-part %IncrementValue</span></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlightComment">//   %ALM = active-lane-mask %InLoopInc, TripCount</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlightComment">//   %Negated = Not %ALM</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><span class="doxyHighlightComment">//   branch-on-cond %Negated</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490" lineLink="#a5a9cb34d61fa4930ff585649d1d5b2ed"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpactivelanemaskphirecipe">VPActiveLaneMaskPHIRecipe</a> &#42;<a href="#a5a9cb34d61fa4930ff585649d1d5b2ed">addVPLaneMaskPhiAndUpdateExitBranch</a>(</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">DataAndControlFlowWithoutRuntimeCheck</a>) &#123;</span></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;TopRegion = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;EB = TopRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a28da654f916bf44da5513b6f1788835c">getExitingBasicBlock</a>();</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CanonicalIVPHI = Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>();</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;StartV = CanonicalIVPHI-&gt;getStartValue();</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CanonicalIVIncrement =</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPInstruction&gt;</a>(CanonicalIVPHI-&gt;getBackedgeValue());</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Check if dropping the flags is needed if</span></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// !DataAndControlFlowWithoutRuntimeCheck.</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">  CanonicalIVIncrement-&gt;dropPoisonGeneratingFlags();</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = CanonicalIVIncrement-&gt;getDebugLoc();</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We can&#39;t use StartV directly in the ActiveLaneMask VPInstruction, since</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we have to take unrolling into account. Each part needs to start at</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   Part &#42; VF</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VecPreheader = Plan.<a href="/docs/api/classes/llvm/vplan/#aee894572833ce02ad06c067d44f65b48">getVectorPreheader</a>();</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> Builder(VecPreheader);</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create the ActiveLaneMask instruction using the correct start values.</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;TC = Plan.<a href="/docs/api/classes/llvm/vplan/#a2f5fc19caa67daeca8a1316c7e055e3c">getTripCount</a>();</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;TripCount, &#42;IncrementValue;</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">DataAndControlFlowWithoutRuntimeCheck</a>) &#123;</span></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// When the loop is guarded by a runtime overflow check for the loop</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// induction variable increment by VF, we can increment the value before</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the get.active.lane mask and use the unmodified tripcount.</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">    IncrementValue = CanonicalIVIncrement;</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><span class="doxyHighlight">    TripCount = TC;</span></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// When avoiding a runtime check, the active.lane.mask inside the loop</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// uses a modified trip count and the induction variable increment is</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// done after the active.lane.mask intrinsic is called.</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">    IncrementValue = CanonicalIVPHI;</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">    TripCount = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2add61254acc7408bb3c3bb55765481418">VPInstruction::CalculateTripCountMinusVF</a>,</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">                                     &#123;TC&#125;, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EntryIncrement = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#ab3b191f35221f351f77883447fef4019">createOverflowingOp</a>(</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2ad271d9d05bf5644dfa1487b3fc42a131">VPInstruction::CanonicalIVIncrementForPart</a>, &#123;StartV&#125;, &#123;</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">&#125;, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;index.part.next&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create the active lane mask instruction in the VPlan preheader.</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EntryALM =</span></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a79a53c84dbac24c496a4c9a6cf70596c">VPInstruction::ActiveLaneMask</a>, &#123;EntryIncrement, TC&#125;,</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><span class="doxyHighlight">                           <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightStringLiteral">&quot;active.lane.mask.entry&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now create the ActiveLaneMaskPhi recipe in the main loop using the</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// preheader ActiveLaneMask instruction.</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LaneMaskPhi = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpactivelanemaskphirecipe">VPActiveLaneMaskPHIRecipe</a>(EntryALM, <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlight">  LaneMaskPhi-&gt;insertAfter(CanonicalIVPHI);</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create the active lane mask for the next iteration of the loop before the</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// original terminator.</span></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;OriginalTerminator = EB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#ac98e46fa8ff66b24ce678ddea88a23ac">getTerminator</a>();</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/vpbuilder/#afc190306945dd17129c24477566099ce">setInsertPoint</a>(OriginalTerminator);</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;InLoopIncrement =</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/vpbuilder/#ab3b191f35221f351f77883447fef4019">createOverflowingOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2ad271d9d05bf5644dfa1487b3fc42a131">VPInstruction::CanonicalIVIncrementForPart</a>,</span></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlight">                                  &#123;IncrementValue&#125;, &#123;</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">&#125;, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ALM = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a79a53c84dbac24c496a4c9a6cf70596c">VPInstruction::ActiveLaneMask</a>,</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">                                   &#123;InLoopIncrement, TripCount&#125;, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">                                   </span><span class="doxyHighlightStringLiteral">&quot;active.lane.mask.next&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">  LaneMaskPhi-&gt;<a href="/docs/api/classes/llvm/vpuser/#af4a3b471097ab37b1672a0d88869ea51">addOperand</a>(ALM);</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace the original terminator with BranchOnCond. We have to invert the</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// mask here because a true condition means jumping to the exit block.</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NotMask = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#acf2cdb4ec71a22869d4c491e220d6f0b">createNot</a>(ALM, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a0062eccdb4956531f7b6a3cf71c3320c">VPInstruction::BranchOnCond</a>, &#123;NotMask&#125;, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlight">  OriginalTerminator-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#aac9dfb61b37082dca00de284bb3309e8">eraseFromParent</a>();</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LaneMaskPhi;</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlightComment">/// Collect all VPValues representing a header mask through the (ICMP&#95;ULE,</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><span class="doxyHighlightComment">/// WideCanonicalIV, backedge-taken-count) pattern.</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlightComment">/// TODO: Introduce explicit recipe for header-mask instead of searching</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlightComment">/// for the header-mask pattern manually.</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565" lineLink="#a8d0c6052d21638f0a385e226db3bd92f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;&gt;</a> <a href="#a8d0c6052d21638f0a385e226db3bd92f">collectAllHeaderMasks</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;&gt;</a> WideCanonicalIVs;</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FoundWidenCanonicalIVUser =</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac78c09ae232b2ce188ff590d51e3c268">find&#95;if</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>(),</span></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlight">              &#91;&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123; return isa&lt;VPWidenCanonicalIVRecipe&gt;(U); &#125;);</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac214df91cdc242f4710ea5a93939c678">count&#95;if</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>(),</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlight">                  &#91;&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123; return isa&lt;VPWidenCanonicalIVRecipe&gt;(U); &#125;) &lt;=</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">             1 &amp;&amp;</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Must have at most one VPWideCanonicalIVRecipe&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FoundWidenCanonicalIVUser != Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>().<a href="/docs/api/classes/llvm/iterator-range/#aa0344673da91896d39f1b35755ee5d4e">end</a>()) &#123;</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WideCanonicalIV =</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenCanonicalIVRecipe&gt;</a>(&#42;FoundWidenCanonicalIVUser);</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><span class="doxyHighlight">    WideCanonicalIVs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(WideCanonicalIV);</span></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Also include VPWidenIntOrFpInductionRecipes that represent a widened</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// version of the canonical induction.</span></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;HeaderVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;Phi : HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>()) &#123;</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WidenOriginalIV = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenIntOrFpInductionRecipe&gt;</a>(&amp;Phi);</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WidenOriginalIV &amp;&amp; WidenOriginalIV-&gt;isCanonical())</span></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlight">      WideCanonicalIVs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(WidenOriginalIV);</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Walk users of wide canonical IVs and collect to all compares of the form</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (ICMP&#95;ULE, WideCanonicalIV, backedge-taken-count).</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;&gt;</a> HeaderMasks;</span></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Wide : WideCanonicalIVs) &#123;</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPUser &#42;&gt;</a>(Wide-&gt;users())) &#123;</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;HeaderMask = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPInstruction&gt;</a>(U);</span></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!HeaderMask || !<a href="/docs/api/namespaces/llvm/vputils/#a96c706ef30193e00ac057bf24cf5719d">vputils::isHeaderMask</a>(HeaderMask, Plan))</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(HeaderMask-&gt;getOperand(0) == Wide &amp;&amp;</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;WidenCanonicalIV must be the first operand of the compare&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">      HeaderMasks.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(HeaderMask);</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> HeaderMasks;</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606" lineLink="/docs/api/structs/llvm/vplantransforms/#ae1d2d60cd9edd9f7ca98c50789747c95"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#ae1d2d60cd9edd9f7ca98c50789747c95">VPlanTransforms::addActiveLaneMask</a>(</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseActiveLaneMaskForControlFlow,</span></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">DataAndControlFlowWithoutRuntimeCheck</a>) &#123;</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">DataAndControlFlowWithoutRuntimeCheck</a> ||</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">          UseActiveLaneMaskForControlFlow) &amp;&amp;</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;DataAndControlFlowWithoutRuntimeCheck implies &quot;</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;UseActiveLaneMaskForControlFlow&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FoundWidenCanonicalIVUser =</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac78c09ae232b2ce188ff590d51e3c268">find&#95;if</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>(),</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><span class="doxyHighlight">              &#91;&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123; return isa&lt;VPWidenCanonicalIVRecipe&gt;(U); &#125;);</span></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(FoundWidenCanonicalIVUser &amp;&amp;</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Must have widened canonical IV when tail folding!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WideCanonicalIV =</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenCanonicalIVRecipe&gt;</a>(&#42;FoundWidenCanonicalIVUser);</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpsingledefrecipe">VPSingleDefRecipe</a> &#42;LaneMask;</span></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseActiveLaneMaskForControlFlow) &#123;</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlight">    LaneMask = <a href="#a5a9cb34d61fa4930ff585649d1d5b2ed">addVPLaneMaskPhiAndUpdateExitBranch</a>(</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlight">        Plan, <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">DataAndControlFlowWithoutRuntimeCheck</a>);</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a> = <a href="/docs/api/classes/llvm/vpbuilder/#a84fe82982cb89a345442baaa710e949a">VPBuilder::getToInsertAfter</a>(WideCanonicalIV);</span></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlight">    LaneMask = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.createNaryOp(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a79a53c84dbac24c496a4c9a6cf70596c">VPInstruction::ActiveLaneMask</a>,</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlight">                              &#123;WideCanonicalIV, Plan.<a href="/docs/api/classes/llvm/vplan/#a2f5fc19caa67daeca8a1316c7e055e3c">getTripCount</a>()&#125;, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">                              </span><span class="doxyHighlightStringLiteral">&quot;active.lane.mask&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Walk users of WideCanonicalIV and replace all compares of the form</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (ICMP&#95;ULE, WideCanonicalIV, backedge-taken-count) with an</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// active-lane-mask.</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;HeaderMask : <a href="#a8d0c6052d21638f0a385e226db3bd92f">collectAllHeaderMasks</a>(Plan))</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlight">    HeaderMask-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(LaneMask);</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlightComment">/// Try to convert \\p CurRecipe to a corresponding EVL-based recipe. Returns</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><span class="doxyHighlightComment">/// nullptr if no EVL-based recipe could be created.</span></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlightComment">/// \\p HeaderMask  Header Mask.</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlightComment">/// \\p CurRecipe   Recipe to be transform.</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlightComment">/// \\p TypeInfo    VPlan-based type analysis.</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlightComment">/// \\p AllOneMask  The vector mask parameter of vector-predication intrinsics.</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><span class="doxyHighlightComment">/// \\p EVL         The explicit vector length parameter of vector-predication</span></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlightComment">/// intrinsics.</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647" lineLink="#ad0faf4b8ff1cf3306958d056dcb2fde2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;<a href="#ad0faf4b8ff1cf3306958d056dcb2fde2">createEVLRecipe</a>(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;HeaderMask,</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;CurRecipe,</span></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> &amp;TypeInfo,</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &amp;AllOneMask, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &amp;EVL) &#123;</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">llvm::VPlanPatternMatch</a>;</span></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GetNewMask = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;OrigMask) -&gt; <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; &#123;</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OrigMask &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unmasked recipe when folding tail&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> HeaderMask == OrigMask ? nullptr : OrigMask;</span></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/typeswitch">TypeSwitch&lt;VPRecipeBase &#42;, VPRecipeBase &#42;&gt;</a>(&amp;CurRecipe)</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlight">      .<a href="/docs/api/classes/llvm/typeswitch/#a78c545287cbe57529ce7751e25c815a5">Case</a>&lt;<a href="/docs/api/structs/llvm/vpwidenloadrecipe">VPWidenLoadRecipe</a>&gt;(&#91;&amp;&#93;(<a href="/docs/api/structs/llvm/vpwidenloadrecipe">VPWidenLoadRecipe</a> &#42;L) &#123;</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;NewMask = GetNewMask(L-&gt;getMask());</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vpwidenloadevlrecipe">VPWidenLoadEVLRecipe</a>(&#42;L, EVL, NewMask);</span></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlight">      &#125;)</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlight">      .Case&lt;VPWidenStoreRecipe&gt;(&#91;&amp;&#93;(<a href="/docs/api/structs/llvm/vpwidenstorerecipe">VPWidenStoreRecipe</a> &#42;S) &#123;</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;NewMask = GetNewMask(S-&gt;<a href="/docs/api/classes/llvm/vpwidenmemoryrecipe/#a6dab5a878379d5ee92940853d3feb53d">getMask</a>());</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vpwidenstoreevlrecipe">VPWidenStoreEVLRecipe</a>(&#42;S, EVL, NewMask);</span></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlight">      &#125;)</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlight">      .Case&lt;VPWidenRecipe&gt;(&#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vpwidenrecipe">VPWidenRecipe</a> &#42;W) -&gt; <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42; &#123;</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opcode = W-&gt;getOpcode();</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/instruction/#a5c88132322ca3f46f242f7c023a57010">Instruction::isBinaryOp</a>(Opcode) &amp;&amp; !<a href="/docs/api/classes/llvm/instruction/#ae6249022aded13ad98775c11881bc117">Instruction::isUnaryOp</a>(Opcode))</span></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidenevlrecipe">VPWidenEVLRecipe</a>(&#42;W, EVL);</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlight">      &#125;)</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><span class="doxyHighlight">      .Case&lt;VPReductionRecipe&gt;(&#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vpreductionrecipe">VPReductionRecipe</a> &#42;Red) &#123;</span></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;NewMask = GetNewMask(Red-&gt;getCondOp());</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpreductionevlrecipe">VPReductionEVLRecipe</a>(&#42;Red, EVL, NewMask);</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><span class="doxyHighlight">      &#125;)</span></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlight">      .Case&lt;VPWidenIntrinsicRecipe, VPWidenCastRecipe&gt;(</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlight">          &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CR) -&gt; <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42; &#123;</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> VPID;</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CallR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenIntrinsicRecipe&gt;</a>(CR)) &#123;</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><span class="doxyHighlight">              VPID =</span></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/vpintrinsic/#ad05203f409c9382a22a69ba01873f7fd">VPIntrinsic::getForIntrinsic</a>(CallR-&gt;getVectorIntrinsicID());</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlight">            &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlight">              </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CastR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenCastRecipe&gt;</a>(CR);</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlight">              VPID = <a href="/docs/api/classes/llvm/vpintrinsic/#a9c6880bafe83a767fa4a27bff91db390">VPIntrinsic::getForOpcode</a>(CastR-&gt;getOpcode());</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Not all intrinsics have a corresponding VP intrinsic.</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VPID == <a href="/docs/api/namespaces/llvm/intrinsic/#a35fedf4db6d756bd82501607f93c1e79aab5fb650050f184fa7c19c26abde5226">Intrinsic::not&#95;intrinsic</a>)</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/vpintrinsic/#a15c8605718d066667e36c9dc890ad40a">VPIntrinsic::getMaskParamPos</a>(VPID) &amp;&amp;</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlight">                   <a href="/docs/api/classes/llvm/vpintrinsic/#a88782f243be6d837a183d7abfe7b1a3c">VPIntrinsic::getVectorLengthParamPos</a>(VPID) &amp;&amp;</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;Expected VP intrinsic to have mask and EVL&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>(CR-&gt;operands());</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(&amp;AllOneMask);</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(&amp;EVL);</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidenintrinsicrecipe">VPWidenIntrinsicRecipe</a>(</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlight">                VPID, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(CR), CR-&gt;getDebugLoc());</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlight">          &#125;)</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><span class="doxyHighlight">      .Case&lt;VPWidenSelectRecipe&gt;(&#91;&amp;&#93;(<a href="/docs/api/structs/llvm/vpwidenselectrecipe">VPWidenSelectRecipe</a> &#42;Sel) &#123;</span></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>(Sel-&gt;<a href="/docs/api/classes/llvm/vpuser/#a11d83265a9e4ff6c6ecd3cf222ad0208">operands</a>());</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(&amp;EVL);</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidenintrinsicrecipe">VPWidenIntrinsicRecipe</a>(Intrinsic::vp&#95;select, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>,</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlight">                                          TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(Sel),</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlight">                                          Sel-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a733c4c530159a8b86223376c0696430e">getDebugLoc</a>());</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlight">      &#125;)</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlight">      .Case&lt;VPInstruction&gt;(&#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a> &#42;VPI) -&gt; <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42; &#123;</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>;</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Transform select with a header mask condition</span></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//   select(header&#95;mask, LHS, RHS)</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// into vector predication merge.</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">//   vp.merge(all-true, LHS, RHS, EVL)</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(VPI, <a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(HeaderMask), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>),</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><span class="doxyHighlight">                                 <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>))))</span></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Use all true as the condition because this transformation is</span></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// limited to selects whose condition is a header mask.</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidenintrinsicrecipe">VPWidenIntrinsicRecipe</a>(</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><span class="doxyHighlight">            Intrinsic::vp&#95;merge, &#123;&amp;AllOneMask, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>, <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>, &amp;EVL&#125;,</span></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">            TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>), VPI-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a733c4c530159a8b86223376c0696430e">getDebugLoc</a>());</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><span class="doxyHighlight">      &#125;)</span></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlight">      .<a href="/docs/api/namespaces/llvm/#ae58c751054b01f206f9b9e34e461d25fa7a1920d61156abc05a60135aefe8bc67">Default</a>(&#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;R) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">; &#125;);</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlightComment">/// Replace recipes with their EVL variants.</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726" lineLink="#a5f39858b5d6d72b92c138916c64c90ba"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a5f39858b5d6d72b92c138916c64c90ba">transformRecipestoEVLRecipes</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &amp;EVL) &#123;</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CanonicalIVType = Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>();</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo(CanonicalIVType);</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = CanonicalIVType-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>();</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;AllOneMask = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(<a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(Ctx));</span></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : <a href="/docs/api/namespaces/llvm/#a886094eaed7ce32029ea52a641142b88">to&#95;vector</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a2dffed680cc551f7ac6d92b3cd365d11">getVF</a>().<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>())) &#123;</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;R = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReverseVectorPointerRecipe&gt;</a>(U))</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">      R-&gt;setOperand(1, &amp;EVL);</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPRecipeBase &#42;&gt;</a> ToErase;</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;HeaderMask : <a href="#a8d0c6052d21638f0a385e226db3bd92f">collectAllHeaderMasks</a>(Plan)) &#123;</span></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U : <a href="#aa70c8f392e8295a96bfd493337e122fa">collectUsersRecursively</a>(HeaderMask)) &#123;</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CurRecipe = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(U);</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;EVLRecipe =</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">          <a href="#ad0faf4b8ff1cf3306958d056dcb2fde2">createEVLRecipe</a>(HeaderMask, &#42;CurRecipe, TypeInfo, &#42;AllOneMask, EVL);</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!EVLRecipe)</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlight">      &#91;&#91;maybe&#95;unused&#93;&#93; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumDefVal = EVLRecipe-&gt;<a href="/docs/api/classes/llvm/vpdef/#a31492b9d8412415c2dae85e33e2748fd">getNumDefinedValues</a>();</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NumDefVal == CurRecipe-&gt;getNumDefinedValues() &amp;&amp;</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;New recipe must define the same number of values as the &quot;</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;original.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><span class="doxyHighlight">          NumDefVal &lt;= 1 &amp;&amp;</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Only supports recipes with a single definition or without users.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlight">      EVLRecipe-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a8859e5e8cad5653b278964f47414fd84">insertBefore</a>(CurRecipe);</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPSingleDefRecipe, VPWidenLoadEVLRecipe&gt;</a>(EVLRecipe)) &#123;</span></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;CurVPV = CurRecipe-&gt;getVPSingleValue();</span></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlight">        CurVPV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(EVLRecipe-&gt;<a href="/docs/api/classes/llvm/vpdef/#a76a983b694720483a3dd9fe57314e39b">getVPSingleValue</a>());</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Defer erasing recipes till the end so that we don&#39;t invalidate the</span></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// VPTypeAnalysis cache.</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><span class="doxyHighlight">      ToErase.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CurRecipe);</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;R : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(ToErase)) &#123;</span></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;&gt;</a> PossiblyDead(R-&gt;operands());</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><span class="doxyHighlight">    R-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : PossiblyDead)</span></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlight">      <a href="#ab5d43362c1fefd60d9bfcc1e28ba4688">recursivelyDeleteDeadRecipes</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><span class="doxyHighlightComment">/// Add a VPEVLBasedIVPHIRecipe and related recipes to \\p Plan and</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><span class="doxyHighlightComment">/// replaces all uses except the canonical IV increment of</span></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><span class="doxyHighlightComment">/// VPCanonicalIVPHIRecipe with a VPEVLBasedIVPHIRecipe. VPCanonicalIVPHIRecipe</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><span class="doxyHighlightComment">/// is used only for loop iterations counting after this transformation.</span></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><span class="doxyHighlightComment">/// The function uses the following definitions:</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><span class="doxyHighlightComment">///  %StartV is the canonical induction start value.</span></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlightComment">/// The function adds the following recipes:</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><span class="doxyHighlightComment">/// vector.ph:</span></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlightComment">/// ...</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><span class="doxyHighlightComment">/// vector.body:</span></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlightComment">/// ...</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><span class="doxyHighlightComment">/// %EVLPhi = EXPLICIT-VECTOR-LENGTH-BASED-IV-PHI &#91; %StartV, %vector.ph &#93;,</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><span class="doxyHighlightComment">///                                               &#91; %NextEVLIV, %vector.body &#93;</span></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlightComment">/// %AVL = sub original TC, %EVLPhi</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><span class="doxyHighlightComment">/// %VPEVL = EXPLICIT-VECTOR-LENGTH %AVL</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><span class="doxyHighlightComment">/// ...</span></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlightComment">/// %NextEVLIV = add IVSize (cast i32 %VPEVVL to IVSize), %EVLPhi</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><span class="doxyHighlightComment">/// ...</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><span class="doxyHighlightComment">/// If MaxSafeElements is provided, the function adds the following recipes:</span></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><span class="doxyHighlightComment">/// vector.ph:</span></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlightComment">/// ...</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlightComment">/// vector.body:</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlightComment">/// ...</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlightComment">/// %EVLPhi = EXPLICIT-VECTOR-LENGTH-BASED-IV-PHI &#91; %StartV, %vector.ph &#93;,</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlightComment">///                                               &#91; %NextEVLIV, %vector.body &#93;</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlightComment">/// %AVL = sub original TC, %EVLPhi</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><span class="doxyHighlightComment">/// %cmp = cmp ult %AVL, MaxSafeElements</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlightComment">/// %SAFE&#95;AVL = select %cmp, %AVL, MaxSafeElements</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlightComment">/// %VPEVL = EXPLICIT-VECTOR-LENGTH %SAFE&#95;AVL</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><span class="doxyHighlightComment">/// ...</span></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlightComment">/// %NextEVLIV = add IVSize (cast i32 %VPEVL to IVSize), %EVLPhi</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlightComment">/// ...</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812" lineLink="/docs/api/structs/llvm/vplantransforms/#ad16bff9364e25351de81704fe81fd229"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#ad16bff9364e25351de81704fe81fd229">VPlanTransforms::tryAddExplicitVectorLength</a>(</span></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> std::optional&lt;unsigned&gt; &amp;MaxSafeElements) &#123;</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;Header = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The transform updates all users of inductions to work based on EVL, instead</span></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the VF directly. At the moment, widened inductions cannot be updated, so</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// bail out if the plan contains any.</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ContainsWidenInductions = <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">      Header-&gt;phis(),</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#af462c722ac0144c995057a2f6e616507">IsaPred&lt;VPWidenIntOrFpInductionRecipe, VPWidenPointerInductionRecipe&gt;</a>);</span></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ContainsWidenInductions)</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CanonicalIVPHI = Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>();</span></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;StartV = CanonicalIVPHI-&gt;getStartValue();</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create the ExplicitVectorLengthPhi recipe in the main loop.</span></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EVLPhi = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpevlbasedivphirecipe">VPEVLBasedIVPHIRecipe</a>(StartV, <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">  EVLPhi-&gt;insertAfter(CanonicalIVPHI);</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> Builder(Header, Header-&gt;getFirstNonPhi());</span></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute original TC - IV as the AVL (application vector length).</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;AVL = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(</span></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">      Instruction::Sub, &#123;Plan.<a href="/docs/api/classes/llvm/vplan/#a2f5fc19caa67daeca8a1316c7e055e3c">getTripCount</a>(), EVLPhi&#125;, <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>(), </span><span class="doxyHighlightStringLiteral">&quot;avl&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaxSafeElements) &#123;</span></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Support for MaxSafeDist for correct loop emission.</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;AVLSafe = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><span class="doxyHighlight">        ConstantInt::get(CanonicalIVPHI-&gt;getScalarType(), &#42;MaxSafeElements));</span></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Cmp = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#a0b968ad86013a173bed6701425715dfb">createICmp</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>, AVL, AVLSafe);</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><span class="doxyHighlight">    AVL = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#aebcef96452964d918ecdf28d1835115e">createSelect</a>(Cmp, AVL, AVLSafe, <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>(), </span><span class="doxyHighlightStringLiteral">&quot;safe&#95;avl&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VPEVL = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a8c9deab6571a0b4db0c69c64c0d682eb">VPInstruction::ExplicitVectorLength</a>, AVL,</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">                                     <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CanonicalIVIncrement =</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPInstruction&gt;</a>(CanonicalIVPHI-&gt;getBackedgeValue());</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpsingledefrecipe">VPSingleDefRecipe</a> &#42;OpVPEVL = VPEVL;</span></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IVSize = CanonicalIVPHI-&gt;getScalarType()-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlight">      IVSize != 32) &#123;</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlight">    OpVPEVL = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpscalarcastrecipe">VPScalarCastRecipe</a>(</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlight">        IVSize &lt; 32 ? Instruction::Trunc : Instruction::ZExt, OpVPEVL,</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlight">        CanonicalIVPHI-&gt;getScalarType(), CanonicalIVIncrement-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a733c4c530159a8b86223376c0696430e">getDebugLoc</a>());</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><span class="doxyHighlight">    OpVPEVL-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a8859e5e8cad5653b278964f47414fd84">insertBefore</a>(CanonicalIVIncrement);</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NextEVLIV =</span></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a>(Instruction::Add, &#123;OpVPEVL, EVLPhi&#125;,</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">                        &#123;CanonicalIVIncrement-&gt;hasNoUnsignedWrap(),</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">                         CanonicalIVIncrement-&gt;hasNoSignedWrap()&#125;,</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">                        CanonicalIVIncrement-&gt;getDebugLoc(), </span><span class="doxyHighlightStringLiteral">&quot;index.evl.next&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">  NextEVLIV-&gt;insertBefore(CanonicalIVIncrement);</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">  EVLPhi-&gt;addOperand(NextEVLIV);</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">  <a href="#a5f39858b5d6d72b92c138916c64c90ba">transformRecipestoEVLRecipes</a>(Plan, &#42;VPEVL);</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace all uses of VPCanonicalIVPHIRecipe by</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// VPEVLBasedIVPHIRecipe except for the canonical IV increment.</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><span class="doxyHighlight">  CanonicalIVPHI-&gt;replaceAllUsesWith(EVLPhi);</span></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">  CanonicalIVIncrement-&gt;setOperand(0, CanonicalIVPHI);</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: support unroll factor &gt; 1</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">  Plan.<a href="/docs/api/classes/llvm/vplan/#af1d539e508015e09e4b9fdb7d020da0e">setUF</a>(1);</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873" lineLink="/docs/api/structs/llvm/vplantransforms/#aa0f143b8d4693978b984f0639c90e508"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#aa0f143b8d4693978b984f0639c90e508">VPlanTransforms::dropPoisonGeneratingRecipes</a>(</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight">(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;)&gt; BlockNeedsPredication) &#123;</span></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect recipes in the backward slice of &#96;Root&#96; that may generate a poison</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// value that is used after vectorization.</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;VPRecipeBase &#42;, 16&gt;</a> Visited;</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CollectPoisonGeneratingInstrsInBackwardSlice(&#91;&amp;&#93;(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Root) &#123;</span></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPRecipeBase &#42;, 16&gt;</a> Worklist;</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">    Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Root);</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Traverse the backward slice of Root through its use-def chain.</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;CurRec = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(CurRec).second)</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Prune search if we find another recipe generating a widen memory</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// instruction. Widen memory instructions involved in address computation</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// will lead to gather/scatter instructions, which don&#39;t need to be</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// handled.</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa</a>&lt;<a href="/docs/api/classes/llvm/vpwidenmemoryrecipe">VPWidenMemoryRecipe</a>, <a href="/docs/api/classes/llvm/vpinterleaverecipe">VPInterleaveRecipe</a>, <a href="/docs/api/classes/llvm/vpscalarivstepsrecipe">VPScalarIVStepsRecipe</a>,</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">              <a href="/docs/api/classes/llvm/vpheaderphirecipe">VPHeaderPHIRecipe</a>&gt;(CurRec))</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// This recipe contributes to the address computation of a widen</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// load/store. If the underlying instruction has poison-generating flags,</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// drop them directly.</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RecWithFlags = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPRecipeWithIRFlags&gt;</a>(CurRec)) &#123;</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>;</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">llvm::VPlanPatternMatch</a>;</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Dropping disjoint from an OR may yield incorrect results, as some</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// analysis may have converted it to an Add implicitly (e.g. SCEV used</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// for dependence analysis). Instead, replace it with an equivalent Add.</span></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// This is possible as all users of the disjoint OR only access lanes</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// where the operands are disjoint or poison otherwise.</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RecWithFlags, <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#a146cd384ae370a9b6de9cd181ad4ec14">m&#95;BinaryOr</a>(<a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>), <a href="/docs/api/namespaces/llvm/vplanpatternmatch/#abce81cbd0e36ab26b74909f7d9135bf5">m&#95;VPValue</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))) &amp;&amp;</span></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">            RecWithFlags-&gt;isDisjoint()) &#123;</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> Builder(RecWithFlags);</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a> &#42;New = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#ab3b191f35221f351f77883447fef4019">createOverflowingOp</a>(</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">              Instruction::Add, &#123;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>&#125;, &#123;</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">&#125;,</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">              RecWithFlags-&gt;getDebugLoc());</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">          New-&gt;setUnderlyingValue(RecWithFlags-&gt;getUnderlyingValue());</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><span class="doxyHighlight">          RecWithFlags-&gt;replaceAllUsesWith(New);</span></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">          RecWithFlags-&gt;eraseFromParent();</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">          CurRec = New;</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">          RecWithFlags-&gt;dropPoisonGeneratingFlags();</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">            CurRec-&gt;<a href="/docs/api/classes/llvm/vpdef/#a76a983b694720483a3dd9fe57314e39b">getVPSingleValue</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#a5fe7dd2466300bd8747d81384a7ced5d">getUnderlyingValue</a>());</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">        (void)Instr;</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!Instr || !Instr-&gt;hasPoisonGeneratingFlags()) &amp;&amp;</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;found instruction with poison generating flags not covered by &quot;</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;VPRecipeWithIRFlags&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add new definitions to the worklist.</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Operand : CurRec-&gt;<a href="/docs/api/classes/llvm/vpuser/#a11d83265a9e4ff6c6ecd3cf222ad0208">operands</a>())</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;OpDef = Operand-&gt;getDefiningRecipe())</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">          Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpDef);</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Traverse all the recipes in the VPlan and collect the poison-generating</span></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// recipes in the backward slice starting at the address of a VPWidenRecipe or</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// VPInterleaveRecipe.</span></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Iter = <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>());</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(Iter)) &#123;</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;Recipe : &#42;VPBB) &#123;</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WidenRec = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenMemoryRecipe&gt;</a>(&amp;Recipe)) &#123;</span></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;UnderlyingInstr = WidenRec-&gt;getIngredient();</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;AddrDef = WidenRec-&gt;getAddr()-&gt;getDefiningRecipe();</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddrDef &amp;&amp; WidenRec-&gt;isConsecutive() &amp;&amp;</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><span class="doxyHighlight">            BlockNeedsPredication(UnderlyingInstr.<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()))</span></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">          CollectPoisonGeneratingInstrsInBackwardSlice(AddrDef);</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;InterleaveRec = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPInterleaveRecipe&gt;</a>(&amp;Recipe)) &#123;</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;AddrDef = InterleaveRec-&gt;getAddr()-&gt;getDefiningRecipe();</span></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddrDef) &#123;</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Check if any member of the interleave group needs predication.</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/interleavegroup">InterleaveGroup&lt;Instruction&gt;</a> &#42;InterGroup =</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><span class="doxyHighlight">              InterleaveRec-&gt;getInterleaveGroup();</span></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedPredication = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, NumMembers = InterGroup-&gt;<a href="/docs/api/classes/llvm/interleavegroup/#af81c826ee51addc3321e4ef1c1934696">getNumMembers</a>();</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">               <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; NumMembers; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Member = InterGroup-&gt;<a href="/docs/api/classes/llvm/interleavegroup/#a5085afe1fa721f3ef5bf09ca7fc7537c">getMember</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Member)</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">              NeedPredication |= BlockNeedsPredication(Member-&gt;getParent());</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedPredication)</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">            CollectPoisonGeneratingInstrsInBackwardSlice(AddrDef);</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970" lineLink="/docs/api/structs/llvm/vplantransforms/#aa88371693bc18186386b04e8c45a30e4"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#aa88371693bc18186386b04e8c45a30e4">VPlanTransforms::createInterleaveGroups</a>(</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan,</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/interleavegroup">InterleaveGroup&lt;Instruction&gt;</a> &#42;&gt;</span></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">        &amp;InterleaveGroups,</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vprecipebuilder">VPRecipeBuilder</a> &amp;RecipeBuilder, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ScalarEpilogueAllowed) &#123;</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InterleaveGroups.empty())</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Interleave memory: for each Interleave Group we marked earlier as relevant</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for this VPlan, replace the Recipes widening its memory instructions with a</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// single VPInterleaveRecipe at its insertion point.</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpdominatortree">VPDominatorTree</a> VPDT;</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><span class="doxyHighlight">  VPDT.<a href="/docs/api/classes/llvm/dominatortreebase/#aa0641ae965656ff9988d67a35140e4d9">recalculate</a>(Plan);</span></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IG : InterleaveGroups) &#123;</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;VPValue &#42;, 4&gt;</a> StoredValues;</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i &lt; IG-&gt;getFactor(); ++i)</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;StoreInst&gt;</a>(IG-&gt;getMember(i))) &#123;</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;StoreR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenStoreRecipe&gt;</a>(RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#af5f874dc688e86699e648825bfcbf495">getRecipe</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>));</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">        StoredValues.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(StoreR-&gt;getStoredValue());</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsMaskForGaps =</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">        IG-&gt;requiresScalarEpilogue() &amp;&amp; !ScalarEpilogueAllowed;</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IRInsertPos = IG-&gt;getInsertPos();</span></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;InsertPos =</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenMemoryRecipe&gt;</a>(RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#af5f874dc688e86699e648825bfcbf495">getRecipe</a>(IRInsertPos));</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Get or create the start address for the interleave group.</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Start =</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenMemoryRecipe&gt;</a>(RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#af5f874dc688e86699e648825bfcbf495">getRecipe</a>(IG-&gt;getMember(0)));</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Addr = Start-&gt;getAddr();</span></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;AddrDef = Addr-&gt;<a href="/docs/api/classes/llvm/vpvalue/#a3be8d7833df422f3538ddb13af69bd70">getDefiningRecipe</a>();</span></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddrDef &amp;&amp; !VPDT.<a href="/docs/api/classes/llvm/vpdominatortree/#a044ef784dc6a77995842977a9956013f">properlyDominates</a>(AddrDef, InsertPos)) &#123;</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: Hoist Addr&#39;s defining recipe (and any operands as needed) to</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// InsertPos or sink loads above zero members to join it.</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InBounds = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Gep = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(</span></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(IRInsertPos)-&gt;stripPointerCasts()))</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">        InBounds = Gep-&gt;isInBounds();</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We cannot re-use the address of member zero because it does not</span></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// dominate the insert position. Instead, use the address of the insert</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// position and create a PtrAdd adjusting it to the address of member</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// zero.</span></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IG-&gt;getIndex(IRInsertPos) != 0 &amp;&amp;</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;index of insert position shouldn&#39;t be zero&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = IRInsertPos-&gt;<a href="/docs/api/classes/llvm/instruction/#af65afd02332c4f21c2fab7d217d6600f">getDataLayout</a>();</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/apint">APInt</a> <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>(32,</span></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">                   <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSize(<a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(IRInsertPos)) &#42;</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlight">                       IG-&gt;getIndex(IRInsertPos),</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><span class="doxyHighlight">                   </span><span class="doxyHighlightComment">/&#42;IsSigned=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;OffsetVPV = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlight">          ConstantInt::get(IRInsertPos-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getContext(), -<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>));</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>(InsertPos);</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><span class="doxyHighlight">      Addr = InBounds ? <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.createInBoundsPtrAdd(InsertPos-&gt;getAddr(), OffsetVPV)</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">                      : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.createPtrAdd(InsertPos-&gt;getAddr(), OffsetVPV);</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VPIG = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpinterleaverecipe">VPInterleaveRecipe</a>(IG, Addr, StoredValues,</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><span class="doxyHighlight">                                        InsertPos-&gt;getMask(), NeedsMaskForGaps);</span></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">    VPIG-&gt;insertBefore(InsertPos);</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> J = 0;</span></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> i = 0; i &lt; IG-&gt;getFactor(); ++i)</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Member = IG-&gt;getMember(i)) &#123;</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;MemberR = RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#af5f874dc688e86699e648825bfcbf495">getRecipe</a>(Member);</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Member-&gt;getType()-&gt;isVoidTy()) &#123;</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;OriginalV = MemberR-&gt;<a href="/docs/api/classes/llvm/vpdef/#a76a983b694720483a3dd9fe57314e39b">getVPSingleValue</a>();</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">          OriginalV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(VPIG-&gt;getVPValue(J));</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">          J++;</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">        MemberR-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#aac9dfb61b37082dca00de284bb3309e8">eraseFromParent</a>();</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046" lineLink="/docs/api/structs/llvm/vplantransforms/#a63e564d621011fac5978d18138121e5c"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#a63e564d621011fac5978d18138121e5c">VPlanTransforms::convertToConcreteRecipes</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()))) &#123;</span></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(VPBB-&gt;phis())) &#123;</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPCanonicalIVPHIRecipe, VPEVLBasedIVPHIRecipe&gt;</a>(&amp;R))</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PhiR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPHeaderPHIRecipe&gt;</a>(&amp;R);</span></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name =</span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPCanonicalIVPHIRecipe&gt;</a>(PhiR) ? </span><span class="doxyHighlightStringLiteral">&quot;index&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;evl.based.iv&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ScalarR =</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpscalarphirecipe">VPScalarPHIRecipe</a>(PhiR-&gt;getStartValue(), PhiR-&gt;getBackedgeValue(),</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">                                PhiR-&gt;getDebugLoc(), Name);</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">      ScalarR-&gt;insertBefore(PhiR);</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">      PhiR-&gt;replaceAllUsesWith(ScalarR);</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><span class="doxyHighlight">      PhiR-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065" lineLink="/docs/api/structs/llvm/vplantransforms/#ac2fcd61c17c94d7e9d10b24b718c812e"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vplantransforms/#ac2fcd61c17c94d7e9d10b24b718c812e">VPlanTransforms::handleUncountableEarlyExit</a>(</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;OrigLoop,</span></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;UncountableExitingBlock, <a href="/docs/api/classes/llvm/vprecipebuilder">VPRecipeBuilder</a> &amp;RecipeBuilder) &#123;</span></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;LoopRegion = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LatchVPBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(LoopRegion-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#add3be1d1d9e5b1ee2014c32d21bf2b5b">getExiting</a>());</span></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> Builder(LatchVPBB-&gt;getTerminator());</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MiddleVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>();</span></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;IsEarlyExitTaken = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Process the uncountable exiting block. Update IsEarlyExitTaken, which</span></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// tracks if the uncountable early exit has been taken. Also split the middle</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block and have it conditionally branch to the early exit block if</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// EarlyExitTaken.</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EarlyExitingBranch =</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(UncountableExitingBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;TrueSucc = EarlyExitingBranch-&gt;getSuccessor(0);</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;FalseSucc = EarlyExitingBranch-&gt;getSuccessor(1);</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The early exit block may or may not be the same as the &quot;countable&quot; exit</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block. Creates a new VPIRBB for the early exit block in case it is distinct</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// from the countable exit block.</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Introduce both exit blocks during VPlan skeleton construction.</span></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> &#42;VPEarlyExitBlock;</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#afd50c2de451ac9fc0865dc747dd2d485">getUniqueExitBlock</a>()) &#123;</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><span class="doxyHighlight">    VPEarlyExitBlock = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPIRBasicBlock&gt;</a>(MiddleVPBB-&gt;getSuccessors()&#91;0&#93;);</span></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><span class="doxyHighlight">    VPEarlyExitBlock = Plan.<a href="/docs/api/classes/llvm/vplan/#aa12c0d3acb3f625ee09d2919907d4067">createVPIRBasicBlock</a>(</span></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlight">        !OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(TrueSucc) ? TrueSucc : FalseSucc);</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;EarlyExitNotTakenCond = RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">      OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(TrueSucc) ? TrueSucc : FalseSucc);</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EarlyExitTakenCond = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#acf2cdb4ec71a22869d4c491e220d6f0b">createNot</a>(EarlyExitNotTakenCond);</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><span class="doxyHighlight">  IsEarlyExitTaken =</span></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2aeb4304c45f6343ca9188dbe52456a969">VPInstruction::AnyOf</a>, &#123;EarlyExitTakenCond&#125;);</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;NewMiddle = Plan.<a href="/docs/api/classes/llvm/vplan/#aa1202b66a60b632b7adbdee13a20ad7e">createVPBasicBlock</a>(</span><span class="doxyHighlightStringLiteral">&quot;middle.split&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpblockutils/#a2057d0749eedf6749f9e1cc6694eb1fd">VPBlockUtils::insertOnEdge</a>(LoopRegion, MiddleVPBB, NewMiddle);</span></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpblockutils/#a40bc7fec35d7093efcdbadf566d6b5ee">VPBlockUtils::connectBlocks</a>(NewMiddle, VPEarlyExitBlock);</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">  NewMiddle-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a43f7e15ac1a813112684effc1e5593a4">swapSuccessors</a>();</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update the exit phis in the early exit block.</span></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> MiddleBuilder(NewMiddle);</span></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : &#42;VPEarlyExitBlock) &#123;</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExitIRI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPIRInstruction&gt;</a>(&amp;R);</span></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExitPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;ExitIRI-&gt;getInstruction());</span></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExitPhi)</span></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;IncomingFromEarlyExit = RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(</span></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlight">        ExitPhi-&gt;getIncomingValueForBlock(UncountableExitingBlock));</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The incoming value from the early exit must be a live-in for now.</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IncomingFromEarlyExit-&gt;<a href="/docs/api/classes/llvm/vpvalue/#add6179d3564ac5ea4736366b93d23829">isLiveIn</a>())</span></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#afd50c2de451ac9fc0865dc747dd2d485">getUniqueExitBlock</a>()) &#123;</span></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If there&#39;s a unique exit block, VPEarlyExitBlock has 2 predecessors</span></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// (MiddleVPBB and NewMiddle). Add the incoming value from MiddleVPBB</span></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// which is coming from the original latch.</span></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;IncomingFromLatch = RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><span class="doxyHighlight">          ExitPhi-&gt;getIncomingValueForBlock(OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a1230fd674d2609b96527fe65eaf40b1b">getLoopLatch</a>()));</span></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126"><span class="doxyHighlight">      ExitIRI-&gt;addOperand(IncomingFromLatch);</span></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><span class="doxyHighlight">      ExitIRI-&gt;extractLastLaneOfOperand(MiddleBuilder);</span></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add the incoming value from the early exit.</span></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><span class="doxyHighlight">    ExitIRI-&gt;addOperand(IncomingFromEarlyExit);</span></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132"><span class="doxyHighlight">  MiddleBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a0062eccdb4956531f7b6a3cf71c3320c">VPInstruction::BranchOnCond</a>, &#123;IsEarlyExitTaken&#125;);</span></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace the condition controlling the non-early exit from the vector loop</span></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with one exiting if either the original condition of the vector latch is</span></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// true or the early exit has been taken.</span></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LatchExitingBranch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPInstruction&gt;</a>(LatchVPBB-&gt;getTerminator());</span></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LatchExitingBranch-&gt;getOpcode() == <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a49dcace93798ddd457a9d4e584bbc9a2">VPInstruction::BranchOnCount</a> &amp;&amp;</span></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected terminator&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IsLatchExitTaken =</span></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><span class="doxyHighlight">      Builder.<a href="/docs/api/classes/llvm/vpbuilder/#a0b968ad86013a173bed6701425715dfb">createICmp</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP&#95;EQ</a>, LatchExitingBranch-&gt;getOperand(0),</span></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlight">                         LatchExitingBranch-&gt;getOperand(1));</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;AnyExitTaken = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(</span></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlight">      Instruction::Or, &#123;IsEarlyExitTaken, IsLatchExitTaken&#125;);</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a0062eccdb4956531f7b6a3cf71c3320c">VPInstruction::BranchOnCond</a>, AnyExitTaken);</span></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlight">  LatchExitingBranch-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#aac9dfb61b37082dca00de284bb3309e8">eraseFromParent</a>();</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
