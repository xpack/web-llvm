---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'
import SectionUser from '@xpack/docusaurus-plugin-doxygen/components/SectionUser'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `LoopVectorize.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/Vectorize/LoopVectorize.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/vectorize/loopvectorize-h"
  isLocal="true" />
<IncludesListItem
  filePath="LoopVectorizationPlanner.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationplanner-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPRecipeBuilder.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vprecipebuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlan.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplan-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanAnalysis.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplananalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanHCFGBuilder.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanhcfgbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanPatternMatch.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanpatternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanTransforms.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanUtils.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanVerifier.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanverifier-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/APInt.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMapInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemapinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Hashing.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/hashing-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/MapVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/StringRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Twine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/twine-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/TypeSwitch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/typeswitch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/iterator_range.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/iterator-range-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AssumptionCache.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BasicAliasAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/basicaliasanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BlockFrequencyInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CodeMetrics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/codemetrics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/DemandedBits.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/demandedbits-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/GlobalsModRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/globalsmodref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopAccessAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopaccessanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopAnalysisManager.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopanalysismanager-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopiterator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/OptimizationRemarkEmitter.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ProfileSummaryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ScalarEvolution.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolution-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ScalarEvolutionExpressions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolutionexpressions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetLibraryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/VectorUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Attributes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugLoc.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debugloc-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DiagnosticInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/diagnosticinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Intrinsics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/MDBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Metadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Operator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ProfDataUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/profdatautils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Use.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/use-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Verifier.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/verifier-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/InstructionCost.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/instructioncost-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/MathExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/mathextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/NativeFormatting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/nativeformatting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/InjectTLIMappings.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/injecttlimappings-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/LoopSimplify.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/loopsimplify-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/LoopUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looputils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/LoopVersioning.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/loopversioning-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/ScalarEvolutionExpander.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/scalarevolutionexpander-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/SizeOpts.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/sizeopts-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Vectorize/LoopVectorizationLegality.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/vectorize/loopvectorizationlegality-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="functional"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="limits"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="memory"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="string"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="tuple"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/preferpredicatety">PreferPredicateTy</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/llvm">llvm</a></>}>
This is an optimization pass for GlobalISel generic memory operations. <a href="/docs/api/namespaces/llvm/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-loopvectorize-cpp-">anonymous&#123;LoopVectorize.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/llvm/innerloopvectorizer">InnerLoopVectorizer</a></>}>
<a href="/docs/api/classes/llvm/innerloopvectorizer">InnerLoopVectorizer</a> vectorizes loops which contain only one basic block to a specified vectorization factor (VF). <a href="/docs/api/classes/llvm/innerloopvectorizer/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a></>}>
Encapsulate information regarding vectorization of a loop and its epilogue. <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer">InnerLoopAndEpilogueVectorizer</a></>}>
An extension of the inner loop vectorizer that creates a skeleton for a vectorized loop that has its epilogue (residual) also vectorized. <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/llvm/epiloguevectorizermainloop">EpilogueVectorizerMainLoop</a></>}>
A specialized derived class of inner loop vectorizer that performs vectorization of <em>main</em> loops in the process of vectorizing loops and their epilogues. <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop">EpilogueVectorizerEpilogueLoop</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a></>}>
<a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> - estimates the expected speedups due to vectorization. <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage">RegisterUsage</a></>}>
A struct that represents some properties of the register usage of a loop. <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision">CallWideningDecision</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks">GeneratedRTChecks</a></>}>
Helper struct to manage generating runtime checks for vectorization. <a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo">CSEDenseMapInfo</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a4d2a943e39c98ccce6fd53e8df9c5c2b">addCanonicalIVRecipes</a> (VPlan &amp;Plan, Type &#42;IdxTy, bool HasNUW, DebugLoc DL)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a453563e4ed7e249a7f3e92b98b9052df">addExitUsersForFirstOrderRecurrences</a> (VPlan &amp;Plan, SetVector&lt; VPIRInstruction &#42; &gt; &amp;ExitUsersToFix)</>}>
Handle users in the exit block for first order reductions in the original exit block. <a href="#a453563e4ed7e249a7f3e92b98b9052df">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ababcaf6e2e00fc3fc8791ea2c3acbda5">addFullyUnrolledInstructionsToIgnore</a> (Loop &#42;L, const LoopVectorizationLegality::InductionList &amp;IL, SmallPtrSetImpl&lt; Instruction &#42; &gt; &amp;InstsToIgnore)</>}>
Knowing that loop <code>L</code> executes a single vector iteration, add instructions that will get simplified and thus should not have any cost to <code>InstsToIgnore</code>. <a href="#ababcaf6e2e00fc3fc8791ea2c3acbda5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a> &#42;</>}
  name={<><a href="#a20c2e870e2c105fbf0945df09a9a5c4d">addResumePhiRecipeForInduction</a> (VPWidenInductionRecipe &#42;WideIV, VPBuilder &amp;VectorPHBuilder, VPBuilder &amp;ScalarPHBuilder, VPTypeAnalysis &amp;TypeInfo, VPValue &#42;VectorTC)</>}>
Create and return a ResumePhi for <code>WideIV</code>, unless it is truncated. <a href="#a20c2e870e2c105fbf0945df09a9a5c4d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a033bb363914fbd3c2cd990330959036c">addRuntimeUnrollDisableMetaData</a> (Loop &#42;L)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a02106664ead4e0c4e755457dbac7f7b3">addScalarResumePhis</a> (VPRecipeBuilder &amp;Builder, VPlan &amp;Plan, DenseMap&lt; VPValue &#42;, VPValue &#42; &gt; &amp;IVEndValues)</>}>
Create resume phis in the scalar preheader for first-order recurrences, reductions and inductions, and update the VPIRInstructions wrapping the original phis in the scalar header. <a href="#a02106664ead4e0c4e755457dbac7f7b3">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#af34d746d08a380c672cae45176f9df87">addUsersInExitBlocks</a> (VPlan &amp;Plan, const SetVector&lt; VPIRInstruction &#42; &gt; &amp;ExitUsersToFix)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a362f793f3254317c698e3560548788a5">areRuntimeChecksProfitable</a> (GeneratedRTChecks &amp;Checks, VectorizationFactor &amp;VF, Loop &#42;L, const TargetTransformInfo &amp;TTI, PredicatedScalarEvolution &amp;PSE, ScalarEpilogueLowering SEL)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#af1fba45879c49d4839b11ec30afd7532">checkMixedPrecision</a> (Loop &#42;L, OptimizationRemarkEmitter &#42;ORE)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a00315ff11c9068aab97e5780bdfa5eef">collectSupportedLoops</a> (Loop &amp;L, LoopInfo &#42;LI, OptimizationRemarkEmitter &#42;ORE, SmallVectorImpl&lt; Loop &#42; &gt; &amp;V)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/vpirinstruction">VPIRInstruction</a> &#42; &gt;</>}
  name={<><a href="#a435b95efad7ea03299bd527b55b4708a">collectUsersInExitBlocks</a> (Loop &#42;OrigLoop, VPRecipeBuilder &amp;Builder, VPlan &amp;Plan)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a></>}
  name={<><a href="#afec6951f3043e25ada2b61437bd60725">createLVAnalysis</a> (const char &#42;PassName, StringRef RemarkName, Loop &#42;TheLoop, Instruction &#42;I, DebugLoc DL=&#123;&#125;)</>}>
Create an analysis remark that explains why vectorization failed. <a href="#afec6951f3043e25ada2b61437bd60725">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpwidenintorfpinductionrecipe">VPWidenIntOrFpInductionRecipe</a> &#42;</>}
  name={<><a href="#a9336eb7b4fbcee561dbb8c52d9eabe64">createWidenInductionRecipes</a> (PHINode &#42;Phi, Instruction &#42;PhiOrTrunc, VPValue &#42;Start, const InductionDescriptor &amp;IndDesc, VPlan &amp;Plan, ScalarEvolution &amp;SE, Loop &amp;OrigLoop)</>}>
Creates a VPWidenIntOrFpInductionRecpipe for <code>Phi</code>. <a href="#a9336eb7b4fbcee561dbb8c52d9eabe64">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#acc13ee8b8985399901ac09b51822e21a">cse</a> (BasicBlock &#42;BB)</>}>
Perform cse of induction variable instructions. <a href="#acc13ee8b8985399901ac09b51822e21a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a1a861c376095fff2ee736b0a743cc44e">debugVectorizationMessage</a> (const StringRef Prefix, const StringRef DebugMsg, Instruction &#42;I)</>}>
Write a <code>DebugMsg</code> about vectorization to the debug output stream. <a href="#a1a861c376095fff2ee736b0a743cc44e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/elementcount">ElementCount</a></>}
  name={<><a href="#a0b91e092434338369b2e1995b87f0c5b">determineVPlanVF</a> (const TargetTransformInfo &amp;TTI, LoopVectorizationCostModel &amp;CM)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a23f5821d9ac264ae25dd087747e2c181">emitTransformedIndex</a> (IRBuilderBase &amp;B, Value &#42;Index, Value &#42;StartValue, Value &#42;Step, InductionDescriptor::InductionKind InductionKind, const BinaryOperator &#42;InductionBinOp)</>}>
Compute the transformed value of Index at offset StartValue using step StepValue. <a href="#a23f5821d9ac264ae25dd087747e2c181">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a90ad8ccd396152c749068f986f2b751a">fixReductionScalarResumeWhenVectorizingEpilog</a> (VPRecipeBase &#42;R, VPTransformState &amp;State, BasicBlock &#42;LoopMiddleBlock, BasicBlock &#42;BypassBlock)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;</>}
  name={<><a href="#ad27a81251d238dbfdc4d0253a64d6267">getAddressAccessSCEV</a> (Value &#42;Ptr, LoopVectorizationLegality &#42;Legal, PredicatedScalarEvolution &amp;PSE, const Loop &#42;TheLoop)</>}>
Gets Address Access <a href="/docs/api/classes/llvm/scev">SCEV</a> after verifying that the access pattern is loop invariant except the induction variable dependence. <a href="#ad27a81251d238dbfdc4d0253a64d6267">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/debugloc">DebugLoc</a></>}
  name={<><a href="#a29c708de8e758ac420523c94c797b501">getDebugLocFromInstOrOperands</a> (Instruction &#42;I)</>}>
Look for a meaningful debug location on the instruction or its operands. <a href="#a29c708de8e758ac420523c94c797b501">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a> (const Loop &#42;L, const TargetTransformInfo &amp;TTI, ElementCount VF)</>}>
This function attempts to return a value that represents the vectorization factor at runtime. <a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#aa8d4cfce02b245d616238ce8eed74718">getExpandedStep</a> (const InductionDescriptor &amp;ID, const SCEV2ValueTy &amp;ExpandedSCEVs)</>}>
Return the expanded step for <code><a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a></code> using <code>ExpandedSCEVs</code> to look up <a href="/docs/api/classes/llvm/scev">SCEV</a> expansion results. <a href="#aa8d4cfce02b245d616238ce8eed74718">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; unsigned &gt;</>}
  name={<><a href="#a604c96744d2e46447f11e2d3aab9a9b2">getMaxVScale</a> (const Function &amp;F, const TargetTransformInfo &amp;TTI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a></>}
  name={<><a href="#a8cde912cc23c18f493e4e5005c85748b">getScalarEpilogueLowering</a> (Function &#42;F, Loop &#42;L, LoopVectorizeHints &amp;Hints, ProfileSummaryInfo &#42;PSI, BlockFrequencyInfo &#42;BFI, TargetTransformInfo &#42;TTI, TargetLibraryInfo &#42;TLI, LoopVectorizationLegality &amp;LVL, InterleavedAccessInfo &#42;IAI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; unsigned &gt;</>}
  name={<><a href="#a84375e6536d9214c7895013078055aff">getSmallBestKnownTC</a> (PredicatedScalarEvolution &amp;PSE, Loop &#42;L, bool CanUseConstantMax=true)</>}>
Returns &quot;best known&quot; trip count for the specified loop <code>L</code> as defined by the following procedure: 1) Returns exact trip count if it is known. <a href="#a84375e6536d9214c7895013078055aff">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; unsigned &gt;</>}
  name={<><a href="#a4e108201f94f2fe89865e7868390bbf6">getVScaleForTuning</a> (const Loop &#42;L, const TargetTransformInfo &amp;TTI)</>}>
Convenience function that returns the value of vscale&#95;range iff vscale&#95;range.min == vscale&#95;range.max or otherwise returns the value returned by the corresponding <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> method. <a href="#a4e108201f94f2fe89865e7868390bbf6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aa407c2e7d895ed29af8cc68563c03065">hasIrregularType</a> (Type &#42;Ty, const DataLayout &amp;DL)</>}>
A helper function that returns true if the given type is irregular. <a href="#aa407c2e7d895ed29af8cc68563c03065">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a806ec23d6f44b02ad8cf3b1e61c05495">isExplicitVecOuterLoop</a> (Loop &#42;OuterLp, OptimizationRemarkEmitter &#42;ORE)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ab7edde995b7986f98c3f59788b960eba">isIndvarOverflowCheckKnownFalse</a> (const LoopVectorizationCostModel &#42;Cost, ElementCount VF, std::optional&lt; unsigned &gt; UF=std::nullopt)</>}>
For the given VF and UF and maximum trip count computed for the loop, return whether the induction variable might overflow in the vectorized loop. <a href="#ab7edde995b7986f98c3f59788b960eba">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/type">Type</a> &#42;</>}
  name={<><a href="#a83114915b4f7fec94a20efa3834a8250">maybeVectorizeType</a> (Type &#42;Elt, ElementCount VF)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a696283c30308704d020a9d86065aa3ae">planContainsAdditionalSimplifications</a> (VPlan &amp;Plan, VPCostContext &amp;CostCtx, Loop &#42;TheLoop)</>}>
Return true if the original loop \\ TheLoop contains any instructions that do not have corresponding recipes in <code>Plan</code> and are not marked to be ignored in <code>CostCtx</code>. <a href="#a696283c30308704d020a9d86065aa3ae">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aae23f7e6fc37b0f1bb756f938023512c">preparePlanForEpilogueVectorLoop</a> (VPlan &amp;Plan, Loop &#42;L, const SCEV2ValueTy &amp;ExpandedSCEVs, const EpilogueLoopVectorizationInfo &amp;EPI)</>}>
Prepare <code>Plan</code> for vectorizing the epilogue loop. <a href="#aae23f7e6fc37b0f1bb756f938023512c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a13368acf4fbb5816c3d82099b11519b1">preparePlanForMainVectorLoop</a> (VPlan &amp;MainPlan, VPlan &amp;EpiPlan)</>}>
Prepare <code>MainPlan</code> for vectorizing the main vector loop during epilogue vectorization. <a href="#a13368acf4fbb5816c3d82099b11519b1">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#adeb41c907ebde15846bc643325909f95">processLoopInVPlanNativePath</a> (Loop &#42;L, PredicatedScalarEvolution &amp;PSE, LoopInfo &#42;LI, DominatorTree &#42;DT, LoopVectorizationLegality &#42;LVL, TargetTransformInfo &#42;TTI, TargetLibraryInfo &#42;TLI, DemandedBits &#42;DB, AssumptionCache &#42;AC, OptimizationRemarkEmitter &#42;ORE, BlockFrequencyInfo &#42;BFI, ProfileSummaryInfo &#42;PSI, LoopVectorizeHints &amp;Hints, LoopVectorizationRequirements &amp;Requirements)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a3a8743a69fac5e7fa9c2b02604b2cf2f">replaceVPBBWithIRVPBB</a> (VPBasicBlock &#42;VPBB, BasicBlock &#42;IRBB)</>}>
Replace <code>VPBB</code> with a <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> wrapping <code>IRBB</code>. <a href="#a3a8743a69fac5e7fa9c2b02604b2cf2f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ad8318a653242df10df04853e090cc21f">STATISTIC</a> (LoopsVectorized, &quot;Number of loops vectorized&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aefd85537796668463b24d5ab5b225407">STATISTIC</a> (LoopsAnalyzed, &quot;Number of loops analyzed for vectorization&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a683da38156d0f59a8d6a0cc83dc7ae14">STATISTIC</a> (LoopsEpilogueVectorized, &quot;Number of epilogues vectorized&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aae88a50a9a37f9a745939e3e726837e6">useActiveLaneMask</a> (TailFoldingStyle Style)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a4e445204e48d57b1e23e55869146b7ce">useActiveLaneMaskForControlFlow</a> (TailFoldingStyle Style)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#adf8d8fb6f39b9c0cf21d55b7229d35e2">useMaskedInterleavedAccesses</a> (const TargetTransformInfo &amp;TTI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#af378bb1e037306d9cfd4bb0b49ba55f9">willGenerateVectors</a> (VPlan &amp;Plan, ElementCount VF, const TargetTransformInfo &amp;TTI)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if any recipe of <code>Plan</code> will generate a vector value, which will be assigned a vector register. <a href="#af378bb1e037306d9cfd4bb0b49ba55f9">More...</a>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a1b67aba558e56b48dbb2891b6e5fe5b8">EnableCondStoresVectorization</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#af7af1b4bf03205c80dcba0a6324c4f21">EnableEarlyExitVectorization</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a8bb0da83afffaf803b396b1d055ba5e0">EnableEpilogueVectorization</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a8122656ed2c776067b43d9ae34ccecb6">EnableIndVarRegisterHeur</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ac3af17aa5bce5ef8c3aa82faeacfc456">EnableInterleavedMemAccesses</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a99a396adb2c0f9fb93b7ff8ea8b2e2ef">EnableLoadStoreRuntimeInterleave</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ac68ad295befb7187ae293cc0faaa3ac3">EnableMaskedInterleavedMemAccesses</a></>}>
An interleave-group may need masking if it resides in a block that needs predication, or in order to mask away gaps. <a href="#ac68ad295befb7187ae293cc0faaa3ac3">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a01340df86c9d26b281ff1ab9288c28ce">EpilogueVectorizationForceVF</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a01070590fdc156c181654c2db7b9ddcc">EpilogueVectorizationMinVF</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#acb0b374f69dc6867357f0aa5e93ab33d">ForceOrderedReductions</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; <a href="/docs/api/namespaces/llvm/cl/#a9241f2e42b7587b123c885d7a659ad44">cl::boolOrDefault</a> &gt;</>}
  name={<><a href="#ad69cf8bf5c6b79c5642327ecb6be38cd">ForceSafeDivisor</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> &gt;</>}
  name={<><a href="#a8959791a22c7d3cfb4136777fd244535">ForceTailFoldingStyle</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a5eae6074e6a1bb62e365ef65f3e26196">ForceTargetInstructionCost</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#aee1082071c43958a6ef5e6e9f665ae4a">ForceTargetMaxScalarInterleaveFactor</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#ade5aad46b91dc51c831acf1e69ee9863">ForceTargetMaxVectorInterleaveFactor</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a62baadf3a5bf03eddf58bf048724acb1">ForceTargetNumScalarRegs</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a7d952aa72676eecd8065aa2c29ea458c">ForceTargetNumVectorRegs</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a48035e22b43c905a2961c90e5470b2f0">ForceTargetSupportsScalableVectors</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> char</>}
  name={<><a href="#a3bf55ccbbeedcfb8cd2a1bd62c0ad91a">LLVMLoopVectorizeFollowupAll</a> = &quot;llvm.loop.vectorize.followup&#95;all&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> char</>}
  name={<><a href="#aadedae9de069f3bcef6fa7a90ce4a630">LLVMLoopVectorizeFollowupEpilogue</a> =
    &quot;llvm.loop.vectorize.followup&#95;epilogue&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> char</>}
  name={<><a href="#a99050b417d193e1cc1117e5bbd4bfbce">LLVMLoopVectorizeFollowupVectorized</a> =
    &quot;llvm.loop.vectorize.followup&#95;vectorized&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aa5a50c0ac98e2ed63da85783ca102cf8">LoopVectorizeWithBlockFrequency</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#afe9b34c22ec9e2cc84d61d437f82936d">MaximizeBandwidth</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#ae75965df4671fa34c6ffc5a6e404843a">MaxNestedScalarReductionIC</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>uint32&#95;t</>}
  name={<><a href="#a502070b20fa467fb54ba49d6736cf2d3">MemCheckBypassWeights</a> = &#123;1, 127&#125;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>uint32&#95;t</>}
  name={<><a href="#a629884e9a99a9f49106db9e5e6252fcb">MinItersBypassWeights</a> = &#123;1, 127&#125;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#ae11c08aa35785a118bda788836cab423">NumberOfStoresToPredicate</a></>}>
The number of stores in a loop that are allowed to need predication. <a href="#ae11c08aa35785a118bda788836cab423">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a96ef6bd4742763bf1b85aaf1a4150620">PreferInLoopReductions</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a927ef1cfd7c981c5b9b9e8c67b1d13c3">PreferPredicatedReductionSelect</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cda">PreferPredicateTy::Option</a> &gt;</>}
  name={<><a href="#abe3c68238712d04bbe3a70f3a8f483f5">PreferPredicateOverEpilogue</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>uint32&#95;t</>}
  name={<><a href="#a968a5c2971ffa9e8ef81ff86eebaf514">SCEVCheckBypassWeights</a> = &#123;1, 127&#125;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a71899f6c73fcc8e2fc977dadc1fb1520">SmallLoopCost</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a15320a2d7ced6e62766048ae7b6f8b13">TinyTripCountVectorThreshold</a></>}>
Loops with a known constant trip count below this number are vectorized only if no scalar iteration overheads are incurred. <a href="#a15320a2d7ced6e62766048ae7b6f8b13">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a639c83322f3d5f0e24e9bde998a516fd">UseWiderVFIfCallVariantsPresent</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a1293f02da7fffb33096a44f1b1768b3f">VectorizeMemoryCheckThreshold</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> char</>}
  name={<><a href="#a8eba8b6f7c3e69bf4d4efd92cd74b5a6">VerboseDebug</a> = <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> &quot;-verbose&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a9f30855a6efcd4a12875deb88880b510">VPlanBuildStressTest</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="#define"
  name={<><a href="#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>&nbsp;&nbsp;&nbsp;&quot;loop-vectorize&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### addCanonicalIVRecipes() {#a4d2a943e39c98ccce6fd53e8df9c5c2b}

<MemberDefinition
  prototype={<>static void addCanonicalIVRecipes (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/type">Type</a> &#42; IdxTy, bool HasNUW, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> DL)</>}
  labels = {["static"]}>

Definition at line <a href="#l08930">8930</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### addExitUsersForFirstOrderRecurrences() {#a453563e4ed7e249a7f3e92b98b9052df}

<MemberDefinition
  prototype={<>static void addExitUsersForFirstOrderRecurrences (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/vpirinstruction">VPIRInstruction</a> &#42; &gt; &amp; ExitUsersToFix)</>}
  labels = {["static"]}>
Handle users in the exit block for first order reductions in the original exit block.

The penultimate value of recurrences is fed to their LCSSA phi users in the original exit block using the <a href="/docs/api/classes/llvm/vpirinstruction">VPIRInstruction</a> wrapping to the LCSSA phi.

Definition at line <a href="#l09112">9112</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### addFullyUnrolledInstructionsToIgnore() {#ababcaf6e2e00fc3fc8791ea2c3acbda5}

<MemberDefinition
  prototype={<>static void addFullyUnrolledInstructionsToIgnore (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopvectorizationlegality/#a063c4d98febe7ef90dddbfedcfc59d16">LoopVectorizationLegality::InductionList</a> &amp; IL, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &gt; &amp; InstsToIgnore)</>}
  labels = {["static"]}>
Knowing that loop <code>L</code> executes a single vector iteration, add instructions that will get simplified and thus should not have any cost to <code>InstsToIgnore</code>.

Definition at line <a href="#l02662">2662</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### addResumePhiRecipeForInduction() {#a20c2e870e2c105fbf0945df09a9a5c4d}

<MemberDefinition
  prototype={<>static VPInstruction &#42; addResumePhiRecipeForInduction (<a href="/docs/api/classes/llvm/vpwideninductionrecipe">VPWidenInductionRecipe</a> &#42; WideIV, <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> &amp; VectorPHBuilder, <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> &amp; ScalarPHBuilder, <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> &amp; TypeInfo, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; VectorTC)</>}
  labels = {["static"]}>
Create and return a ResumePhi for <code>WideIV</code>, unless it is truncated.

If the induction recipe is not canonical, creates a <a href="/docs/api/classes/llvm/vpderivedivrecipe">VPDerivedIVRecipe</a> to compute the end value of the induction.

Definition at line <a href="#l08956">8956</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### addRuntimeUnrollDisableMetaData() {#a033bb363914fbd3c2cd990330959036c}

<MemberDefinition
  prototype={<>static void addRuntimeUnrollDisableMetaData (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L)</>}
  labels = {["static"]}>

Definition at line <a href="#l07545">7545</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### addScalarResumePhis() {#a02106664ead4e0c4e755457dbac7f7b3}

<MemberDefinition
  prototype={<>static void addScalarResumePhis (<a href="/docs/api/classes/llvm/vprecipebuilder">VPRecipeBuilder</a> &amp; Builder, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; &gt; &amp; IVEndValues)</>}
  labels = {["static"]}>
Create resume phis in the scalar preheader for first-order recurrences, reductions and inductions, and update the VPIRInstructions wrapping the original phis in the scalar header.

End values for inductions are added to <code>IVEndValues</code>.

Definition at line <a href="#l08994">8994</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### addUsersInExitBlocks() {#af34d746d08a380c672cae45176f9df87}

<MemberDefinition
  prototype={<>static void addUsersInExitBlocks (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/vpirinstruction">VPIRInstruction</a> &#42; &gt; &amp; ExitUsersToFix)</>}
  labels = {["static"]}>

Definition at line <a href="#l09089">9089</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### areRuntimeChecksProfitable() {#a362f793f3254317c698e3560548788a5}

<MemberDefinition
  prototype={<>static bool areRuntimeChecksProfitable (GeneratedRTChecks &amp; Checks, <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> &amp; VF, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp; PSE, <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> SEL)</>}
  labels = {["static"]}>

Definition at line <a href="#l10054">10054</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### checkMixedPrecision() {#af1fba45879c49d4839b11ec30afd7532}

<MemberDefinition
  prototype={<>static void checkMixedPrecision (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42; ORE)</>}
  labels = {["static"]}>

Definition at line <a href="#l10013">10013</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### collectSupportedLoops() {#a00315ff11c9068aab97e5780bdfa5eef}

<MemberDefinition
  prototype={<>static void collectSupportedLoops (<a href="/docs/api/classes/llvm/loop">Loop</a> &amp; L, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42; ORE, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; &gt; &amp; V)</>}
  labels = {["static"]}>

Definition at line <a href="#l02179">2179</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### collectUsersInExitBlocks() {#a435b95efad7ea03299bd527b55b4708a}

<MemberDefinition
  prototype={<>static SetVector&lt; VPIRInstruction &#42; &gt; collectUsersInExitBlocks (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; OrigLoop, <a href="/docs/api/classes/llvm/vprecipebuilder">VPRecipeBuilder</a> &amp; Builder, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>

Definition at line <a href="#l09055">9055</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### createLVAnalysis() {#afec6951f3043e25ada2b61437bd60725}

<MemberDefinition
  prototype={<>static OptimizationRemarkAnalysis createLVAnalysis (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> char &#42; PassName, <a href="/docs/api/classes/llvm/stringref">StringRef</a> RemarkName, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; TheLoop, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> DL=&#123;&#125;)</>}
  labels = {["static"]}>
Create an analysis remark that explains why vectorization failed.

<code>PassName</code> is the name of the pass (e.g. can be AlwaysPrint). <code>RemarkName</code> is the identifier for the remark. If <code>I</code> is passed it is an instruction that prevents vectorization. Otherwise <code>TheLoop</code> is used for the location of the remark. If <code>DL</code> is passed, use it as debug location for the remark. 
<SectionUser title="Returns">
the remark object that can be streamed to.
</SectionUser>

Definition at line <a href="#l00860">860</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### createWidenInductionRecipes() {#a9336eb7b4fbcee561dbb8c52d9eabe64}

<MemberDefinition
  prototype={<>static VPWidenIntOrFpInductionRecipe &#42; createWidenInductionRecipes (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; Phi, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; PhiOrTrunc, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; Start, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp; IndDesc, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp; SE, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp; OrigLoop)</>}
  labels = {["static"]}>
Creates a VPWidenIntOrFpInductionRecpipe for <code>Phi</code>.

If needed, it will also insert a recipe to expand the step for the induction recipe.

Definition at line <a href="#l08317">8317</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### cse() {#acc13ee8b8985399901ac09b51822e21a}

<MemberDefinition
  prototype={<>static void cse (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB)</>}
  labels = {["static"]}>
Perform cse of induction variable instructions.

Definition at line <a href="#l02811">2811</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### debugVectorizationMessage() {#a1a861c376095fff2ee736b0a743cc44e}

<MemberDefinition
  prototype={<>static void debugVectorizationMessage (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/stringref">StringRef</a> Prefix, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/stringref">StringRef</a> DebugMsg, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I)</>}
  labels = {["static"]}>
Write a <code>DebugMsg</code> about vectorization to the debug output stream.

If <code>I</code> is passed, the message relates to that particular instruction.

Definition at line <a href="#l00840">840</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### determineVPlanVF() {#a0b91e092434338369b2e1995b87f0c5b}

<MemberDefinition
  prototype={<>static ElementCount determineVPlanVF (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> &amp; CM)</>}
  labels = {["static"]}>

Definition at line <a href="#l07027">7027</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### emitTransformedIndex() {#a23f5821d9ac264ae25dd087747e2c181}

<MemberDefinition
  prototype={<>static Value &#42; emitTransformedIndex (<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp; B, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Index, <a href="/docs/api/classes/llvm/value">Value</a> &#42; StartValue, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Step, <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabcc">InductionDescriptor::InductionKind</a> InductionKind, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42; InductionBinOp)</>}
  labels = {["static"]}>
Compute the transformed value of Index at offset StartValue using step StepValue.

For integer induction, returns StartValue + Index &#42; StepValue. For pointer induction, returns StartValue&#91;Index &#42; StepValue&#93;. FIXME: The newly created binary instructions should contain nsw/nuw flags, which can be found from the original scalar operations.

Definition at line <a href="#l02216">2216</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### fixReductionScalarResumeWhenVectorizingEpilog() {#a90ad8ccd396152c749068f986f2b751a}

<MemberDefinition
  prototype={<>static void fixReductionScalarResumeWhenVectorizingEpilog (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42; R, <a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp; State, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; LoopMiddleBlock, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BypassBlock)</>}
  labels = {["static"]}>

Definition at line <a href="#l07582">7582</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getAddressAccessSCEV() {#ad27a81251d238dbfdc4d0253a64d6267}

<MemberDefinition
  prototype={<>static const SCEV &#42; getAddressAccessSCEV (<a href="/docs/api/classes/llvm/value">Value</a> &#42; Ptr, <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42; Legal, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp; PSE, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; TheLoop)</>}
  labels = {["static"]}>
Gets Address Access <a href="/docs/api/classes/llvm/scev">SCEV</a> after verifying that the access pattern is loop invariant except the induction variable dependence.

This <a href="/docs/api/classes/llvm/scev">SCEV</a> can be sent to the <a href="/docs/api/classes/llvm/target">Target</a> in order to estimate the address calculation cost.

Definition at line <a href="#l05587">5587</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getDebugLocFromInstOrOperands() {#a29c708de8e758ac420523c94c797b501}

<MemberDefinition
  prototype={<>static DebugLoc getDebugLocFromInstOrOperands (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I)</>}
  labels = {["static"]}>
Look for a meaningful debug location on the instruction or its operands.

Definition at line <a href="#l00820">820</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getEstimatedRuntimeVF() {#ab3df41ae1ed3978e3b825bc4dd50ae8d}

<MemberDefinition
  prototype={<>static unsigned getEstimatedRuntimeVF (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</>}
  labels = {["static"]}>
This function attempts to return a value that represents the vectorization factor at runtime.

For fixed-width VFs we know this precisely at compile time, but for scalable VFs we calculate it based on an estimate of the vscale value.

Definition at line <a href="#l04255">4255</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getExpandedStep() {#aa8d4cfce02b245d616238ce8eed74718}

<MemberDefinition
  prototype={<>static Value &#42; getExpandedStep (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp; ID, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> SCEV2ValueTy &amp; ExpandedSCEVs)</>}
  labels = {["static"]}>
Return the expanded step for <code><a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a></code> using <code>ExpandedSCEVs</code> to look up <a href="/docs/api/classes/llvm/scev">SCEV</a> expansion results.

Definition at line <a href="#l02647">2647</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getMaxVScale() {#a604c96744d2e46447f11e2d3aab9a9b2}

<MemberDefinition
  prototype={<>std::optional&lt; unsigned &gt; getMaxVScale (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}>

Definition at line <a href="#l02295">2295</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getScalarEpilogueLowering() {#a8cde912cc23c18f493e4e5005c85748b}

<MemberDefinition
  prototype={<>static ScalarEpilogueLowering getScalarEpilogueLowering (<a href="/docs/api/classes/llvm/function">Function</a> &#42; F, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> &amp; Hints, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42; PSI, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42; BFI, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42; TLI, <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &amp; LVL, <a href="/docs/api/classes/llvm/interleavedaccessinfo">InterleavedAccessInfo</a> &#42; IAI)</>}
  labels = {["static"]}>

Definition at line <a href="#l09897">9897</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getSmallBestKnownTC() {#a84375e6536d9214c7895013078055aff}

<MemberDefinition
  prototype={<>static std::optional&lt; unsigned &gt; getSmallBestKnownTC (<a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp; PSE, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, bool CanUseConstantMax=<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#af6d5cafbdfc5313e65d990120021a3ec">true</a>)</>}
  labels = {["static"]}>
Returns &quot;best known&quot; trip count for the specified loop <code>L</code> as defined by the following procedure: 1) Returns exact trip count if it is known.

2) Returns expected trip count according to profile data if any. 3) Returns upper bound estimate if known, and if <code>CanUseConstantMax</code>. 4) Returns std::nullopt if all of the above failed.

Definition at line <a href="#l00420">420</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getVScaleForTuning() {#a4e108201f94f2fe89865e7868390bbf6}

<MemberDefinition
  prototype={<>static std::optional&lt; unsigned &gt; getVScaleForTuning (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
Convenience function that returns the value of vscale&#95;range iff vscale&#95;range.min == vscale&#95;range.max or otherwise returns the value returned by the corresponding <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> method.

Definition at line <a href="#l04238">4238</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### hasIrregularType() {#aa407c2e7d895ed29af8cc68563c03065}

<MemberDefinition
  prototype={<>static bool hasIrregularType (<a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
A helper function that returns true if the given type is irregular.

The type is irregular if its allocated size doesn&#39;t equal the store size of an element of the corresponding vector type.

Definition at line <a href="#l00406">406</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### isExplicitVecOuterLoop() {#a806ec23d6f44b02ad8cf3b1e61c05495}

<MemberDefinition
  prototype={<>static bool isExplicitVecOuterLoop (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; OuterLp, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42; ORE)</>}
  labels = {["static"]}>

Definition at line <a href="#l02151">2151</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### isIndvarOverflowCheckKnownFalse() {#ab7edde995b7986f98c3f59788b960eba}

<MemberDefinition
  prototype={<>static bool isIndvarOverflowCheckKnownFalse (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> &#42; Cost, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, std::optional&lt; unsigned &gt; UF=std::nullopt)</>}
  labels = {["static"]}>
For the given VF and UF and maximum trip count computed for the loop, return whether the induction variable might overflow in the vectorized loop.

If not, then we know a runtime overflow check always evaluates to false and can be removed.

Definition at line <a href="#l02310">2310</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### maybeVectorizeType() {#a83114915b4f7fec94a20efa3834a8250}

<MemberDefinition
  prototype={<>static Type &#42; maybeVectorizeType (<a href="/docs/api/classes/llvm/type">Type</a> &#42; Elt, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</>}
  labels = {["static"]}>

Definition at line <a href="#l02858">2858</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### planContainsAdditionalSimplifications() {#a696283c30308704d020a9d86065aa3ae}

<MemberDefinition
  prototype={<>static bool planContainsAdditionalSimplifications (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/structs/llvm/vpcostcontext">VPCostContext</a> &amp; CostCtx, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; TheLoop)</>}
  labels = {["static"]}>
Return true if the original loop \\ TheLoop contains any instructions that do not have corresponding recipes in <code>Plan</code> and are not marked to be ignored in <code>CostCtx</code>.

This means the <a href="/docs/api/classes/llvm/vplan">VPlan</a> contains simplification that the legacy cost-model did not account for.

Definition at line <a href="#l07409">7409</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### preparePlanForEpilogueVectorLoop() {#aae23f7e6fc37b0f1bb756f938023512c}

<MemberDefinition
  prototype={<>static void preparePlanForEpilogueVectorLoop (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> SCEV2ValueTy &amp; ExpandedSCEVs, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a> &amp; EPI)</>}
  labels = {["static"]}>
Prepare <code>Plan</code> for vectorizing the epilogue loop.

That is, re-use expanded SCEVs from <code>ExpandedSCEVs</code> and set resume values for header recipes.

Definition at line <a href="#l10210">10210</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### preparePlanForMainVectorLoop() {#a13368acf4fbb5816c3d82099b11519b1}

<MemberDefinition
  prototype={<>static void preparePlanForMainVectorLoop (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; MainPlan, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; EpiPlan)</>}
  labels = {["static"]}>
Prepare <code>MainPlan</code> for vectorizing the main vector loop during epilogue vectorization.

Remove ResumePhis from <code>MainPlan</code> for inductions that don&#39;t have a corresponding wide induction in <code>EpiPlan</code>.

Definition at line <a href="#l10159">10159</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### processLoopInVPlanNativePath() {#adeb41c907ebde15846bc643325909f95}

<MemberDefinition
  prototype={<>static bool processLoopInVPlanNativePath (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp; PSE, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT, <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42; LVL, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42; TLI, <a href="/docs/api/classes/llvm/demandedbits">DemandedBits</a> &#42; DB, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42; ORE, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42; BFI, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42; PSI, <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> &amp; Hints, <a href="/docs/api/classes/llvm/loopvectorizationrequirements">LoopVectorizationRequirements</a> &amp; Requirements)</>}
  labels = {["static"]}>

Definition at line <a href="#l09946">9946</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### replaceVPBBWithIRVPBB() {#a3a8743a69fac5e7fa9c2b02604b2cf2f}

<MemberDefinition
  prototype={<>static void replaceVPBBWithIRVPBB (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42; VPBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; IRBB)</>}
  labels = {["static"]}>
Replace <code>VPBB</code> with a <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> wrapping <code>IRBB</code>.

All recipes from <code>VPBB</code> are moved to the end of the newly created <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a>. VPBB must have a single predecessor, which is rewired to the new <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a>. All successors of VPBB, if any, are rewired to the new <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a>.

Definition at line <a href="#l02617">2617</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ad8318a653242df10df04853e090cc21f}

<MemberDefinition
  prototype={<>STATISTIC (LoopsVectorized, &quot;Number of <a href="/docs/api/files/lib/lib/analysis/loopinfo-cpp/#a49ae40a9c91d665793aaed656c26ca30">loops</a> vectorized&quot;)</>}>

Definition at line <a href="#l00174">174</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aefd85537796668463b24d5ab5b225407}

<MemberDefinition
  prototype={<>STATISTIC (LoopsAnalyzed, &quot;Number of <a href="/docs/api/files/lib/lib/analysis/loopinfo-cpp/#a49ae40a9c91d665793aaed656c26ca30">loops</a> analyzed <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> vectorization&quot;)</>}>

Definition at line <a href="#l00175">175</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a683da38156d0f59a8d6a0cc83dc7ae14}

<MemberDefinition
  prototype={<>STATISTIC (LoopsEpilogueVectorized, &quot;Number of epilogues vectorized&quot;)</>}>

Definition at line <a href="#l00176">176</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### useActiveLaneMask() {#aae88a50a9a37f9a745939e3e726837e6}

<MemberDefinition
  prototype={<>static bool useActiveLaneMask (<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> Style)</>}
  labels = {["static"]}>

Definition at line <a href="#l02126">2126</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### useActiveLaneMaskForControlFlow() {#a4e445204e48d57b1e23e55869146b7ce}

<MemberDefinition
  prototype={<>static bool useActiveLaneMaskForControlFlow (<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> Style)</>}
  labels = {["static"]}>

Definition at line <a href="#l02132">2132</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### useMaskedInterleavedAccesses() {#adf8d8fb6f39b9c0cf21d55b7229d35e2}

<MemberDefinition
  prototype={<>static bool useMaskedInterleavedAccesses (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>

Definition at line <a href="#l02341">2341</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### willGenerateVectors() {#af378bb1e037306d9cfd4bb0b49ba55f9}

<MemberDefinition
  prototype={<>static bool willGenerateVectors (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if any recipe of <code>Plan</code> will generate a vector value, which will be assigned a vector register.

Definition at line <a href="#l04439">4439</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### EnableCondStoresVectorization {#a1b67aba558e56b48dbb2891b6e5fe5b8}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableCondStoresVectorization(&quot;enable-cond-stores-vec&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Enable if predication of stores during vectorization.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00328">328</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EnableEarlyExitVectorization {#af7af1b4bf03205c80dcba0a6324c4f21}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableEarlyExitVectorization(&quot;enable-early-exit-vectorization&quot;, cl::init(false), cl::Hidden, cl::desc( &quot;Enable vectorization of early exit loops with uncountable exits.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00388">388</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EnableEpilogueVectorization {#a8bb0da83afffaf803b396b1d055ba5e0}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableEpilogueVectorization(&quot;enable-epilogue-vectorization&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Enable vectorization of epilogue loops.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00178">178</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EnableIndVarRegisterHeur {#a8122656ed2c776067b43d9ae34ccecb6}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableIndVarRegisterHeur(&quot;enable-ind-var-reg-heur&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Count the induction variable only once when interleaving&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00324">324</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EnableInterleavedMemAccesses {#ac3af17aa5bce5ef8c3aa82faeacfc456}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableInterleavedMemAccesses(&quot;enable-interleaved-mem-accesses&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Enable vectorization on interleaved memory accesses in a loop&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00262">262</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EnableLoadStoreRuntimeInterleave {#a99a396adb2c0f9fb93b7ff8ea8b2e2ef}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableLoadStoreRuntimeInterleave(&quot;enable-loadstore-runtime-interleave&quot;, cl::init(true), cl::Hidden, cl::desc( &quot;Enable runtime interleaving until load/store ports are saturated&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00314">314</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EnableMaskedInterleavedMemAccesses {#ac68ad295befb7187ae293cc0faaa3ac3}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableMaskedInterleavedMemAccesses(&quot;enable-masked-interleaved-mem-accesses&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Enable vectorization on masked interleaved memory accesses in a loop&quot;))</>}
  labels = {["static"]}>
An interleave-group may need masking if it resides in a block that needs predication, or in order to mask away gaps.

Definition at line <a href="#l00268">268</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EpilogueVectorizationForceVF {#a01340df86c9d26b281ff1ab9288c28ce}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; EpilogueVectorizationForceVF(&quot;epilogue-vectorization-force-VF&quot;, cl::init(1), cl::Hidden, cl::desc(&quot;When epilogue vectorization is enabled, and a value greater than &quot; &quot;1 is specified, forces the given VF for all applicable epilogue &quot; &quot;loops.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00182">182</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EpilogueVectorizationMinVF {#a01070590fdc156c181654c2db7b9ddcc}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; EpilogueVectorizationMinVF(&quot;epilogue-vectorization-minimum-VF&quot;, cl::Hidden, cl::desc(&quot;Only loops with vectorization factor equal to or larger than &quot; &quot;the specified value are considered for epilogue vectorization.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00188">188</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceOrderedReductions {#acb0b374f69dc6867357f0aa5e93ab33d}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ForceOrderedReductions(&quot;force-ordered-reductions&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Enable the vectorisation of loops with in-order (strict) &quot; &quot;FP reductions&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00343">343</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceSafeDivisor {#ad69cf8bf5c6b79c5642327ecb6be38cd}

<MemberDefinition
  prototype={<>cl::opt&lt; cl::boolOrDefault &gt; ForceSafeDivisor(&quot;force-widen-divrem-via-safe-divisor&quot;, cl::Hidden, cl::desc( &quot;Override cost based safe divisor widening for div/rem instructions&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00378">378</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceTailFoldingStyle {#a8959791a22c7d3cfb4136777fd244535}

<MemberDefinition
  prototype={<>cl::opt&lt; TailFoldingStyle &gt; ForceTailFoldingStyle(&quot;force-tail-folding-style&quot;, cl::desc(&quot;Force the tail folding style&quot;), cl::init(TailFoldingStyle::None), cl::values( clEnumValN(TailFoldingStyle::None, &quot;none&quot;, &quot;Disable tail folding&quot;), clEnumValN( TailFoldingStyle::Data, &quot;data&quot;, &quot;Create lane mask for data only, using active.lane.mask intrinsic&quot;), clEnumValN(TailFoldingStyle::DataWithoutLaneMask, &quot;data-without-lane-mask&quot;, &quot;Create lane mask with compare/stepvector&quot;), clEnumValN(TailFoldingStyle::DataAndControlFlow, &quot;data-and-control&quot;, &quot;Create lane mask using active.lane.mask intrinsic, and use &quot; &quot;it for both data and control flow&quot;), clEnumValN(TailFoldingStyle::DataAndControlFlowWithoutRuntimeCheck, &quot;data-and-control-without-rt-check&quot;, &quot;Similar to data-and-control, but remove the runtime check&quot;), clEnumValN(TailFoldingStyle::DataWithEVL, &quot;data-with-evl&quot;, &quot;Use predicated EVL instructions for tail folding. If EVL &quot; &quot;is unsupported, fallback to data-without-lane-mask.&quot;)))</>}
  labels = {["static"]}>

Definition at line <a href="#l00236">236</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceTargetInstructionCost {#a5eae6074e6a1bb62e365ef65f3e26196}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; ForceTargetInstructionCost(&quot;force-target-instruction-cost&quot;, cl::init(0), cl::Hidden, cl::desc(&quot;A flag that overrides the target&#39;s expected cost for &quot; &quot;an instruction to a single constant value. Mostly &quot; &quot;useful for getting consistent testing.&quot;))</>}>

Definition at line <a href="#l00290">290</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceTargetMaxScalarInterleaveFactor {#aee1082071c43958a6ef5e6e9f665ae4a}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; ForceTargetMaxScalarInterleaveFactor(&quot;force-target-max-scalar-interleave&quot;, cl::init(0), cl::Hidden, cl::desc(&quot;A flag that overrides the target&#39;s max interleave factor for &quot; &quot;scalar loops.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00280">280</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceTargetMaxVectorInterleaveFactor {#ade5aad46b91dc51c831acf1e69ee9863}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; ForceTargetMaxVectorInterleaveFactor(&quot;force-target-max-vector-interleave&quot;, cl::init(0), cl::Hidden, cl::desc(&quot;A flag that overrides the target&#39;s max interleave factor for &quot; &quot;vectorized loops.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00285">285</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceTargetNumScalarRegs {#a62baadf3a5bf03eddf58bf048724acb1}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; ForceTargetNumScalarRegs(&quot;force-target-num-scalar-regs&quot;, cl::init(0), cl::Hidden, cl::desc(&quot;A flag that overrides the target&#39;s number of scalar registers.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00272">272</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceTargetNumVectorRegs {#a7d952aa72676eecd8065aa2c29ea458c}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; ForceTargetNumVectorRegs(&quot;force-target-num-vector-regs&quot;, cl::init(0), cl::Hidden, cl::desc(&quot;A flag that overrides the target&#39;s number of vector registers.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00276">276</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceTargetSupportsScalableVectors {#a48035e22b43c905a2961c90e5470b2f0}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ForceTargetSupportsScalableVectors(&quot;force-target-supports-scalable-vectors&quot;, cl::init(false), cl::Hidden, cl::desc( &quot;Pretend that scalable vectors are supported, even if the target does &quot; &quot;not support them. This flag should only be used for testing.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00296">296</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### LLVMLoopVectorizeFollowupAll {#a3bf55ccbbeedcfb8cd2a1bd62c0ad91a}

<MemberDefinition
  prototype={<>const char LLVMLoopVectorizeFollowupAll&#91;&#93; = &quot;llvm.loop.vectorize.followup&#95;all&quot;</>}>

<a href="/docs/api/classes/llvm/metadata">Metadata</a> attribute names

Definition at line <a href="#l00167">167</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### LLVMLoopVectorizeFollowupEpilogue {#aadedae9de069f3bcef6fa7a90ce4a630}

<MemberDefinition
  prototype={<>const char LLVMLoopVectorizeFollowupEpilogue&#91;&#93; =
    &quot;llvm.loop.vectorize.followup&#95;epilogue&quot;</>}>

Definition at line <a href="#l00170">170</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### LLVMLoopVectorizeFollowupVectorized {#a99050b417d193e1cc1117e5bbd4bfbce}

<MemberDefinition
  prototype={<>const char LLVMLoopVectorizeFollowupVectorized&#91;&#93; =
    &quot;llvm.loop.vectorize.followup&#95;vectorized&quot;</>}>

Definition at line <a href="#l00168">168</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### LoopVectorizeWithBlockFrequency {#aa5a50c0ac98e2ed63da85783ca102cf8}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; LoopVectorizeWithBlockFrequency(&quot;loop-vectorize-with-block-frequency&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Enable the use of the block frequency analysis to access PGO &quot; &quot;heuristics minimizing code growth in cold regions and being more &quot; &quot;aggressive in hot regions.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00307">307</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### MaximizeBandwidth {#afe9b34c22ec9e2cc84d61d437f82936d}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; MaximizeBandwidth(&quot;vectorizer-maximize-bandwidth&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Maximize bandwidth when selecting vectorization factor which &quot; &quot;will be determined by the smallest type in loop.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00257">257</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### MaxNestedScalarReductionIC {#ae75965df4671fa34c6ffc5a6e404843a}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; MaxNestedScalarReductionIC(&quot;max-nested-scalar-reduction-interleave&quot;, cl::init(2), cl::Hidden, cl::desc(&quot;The maximum interleave count to use when interleaving a scalar &quot; &quot;reduction in a nested loop.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00332">332</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### MemCheckBypassWeights {#a502070b20fa467fb54ba49d6736cf2d3}

<MemberDefinition
  prototype={<>uint32&#95;t MemCheckBypassWeights&#91;&#93; = &#123;1, 127&#125;</>}
  labels = {["constexpr", "static"]}>

Definition at line <a href="#l00398">398</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### MinItersBypassWeights {#a629884e9a99a9f49106db9e5e6252fcb}

<MemberDefinition
  prototype={<>uint32&#95;t MinItersBypassWeights&#91;&#93; = &#123;1, 127&#125;</>}
  labels = {["constexpr", "static"]}>

Definition at line <a href="#l00401">401</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### NumberOfStoresToPredicate {#ae11c08aa35785a118bda788836cab423}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; NumberOfStoresToPredicate(&quot;vectorize-num-stores-pred&quot;, cl::init(1), cl::Hidden, cl::desc(&quot;Max number of stores to be predicated behind an if.&quot;))</>}
  labels = {["static"]}>
The number of stores in a loop that are allowed to need predication.

Definition at line <a href="#l00320">320</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### PreferInLoopReductions {#a96ef6bd4742763bf1b85aaf1a4150620}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; PreferInLoopReductions(&quot;prefer-inloop-reductions&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Prefer in-loop vector reductions, &quot; &quot;overriding the targets preference.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00338">338</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### PreferPredicatedReductionSelect {#a927ef1cfd7c981c5b9b9e8c67b1d13c3}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; PreferPredicatedReductionSelect(&quot;prefer-predicated-reduction-select&quot;, cl::init(false), cl::Hidden, cl::desc( &quot;Prefer predicating a reduction operation over an after loop select.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00348">348</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### PreferPredicateOverEpilogue {#abe3c68238712d04bbe3a70f3a8f483f5}

<MemberDefinition
  prototype={<>cl::opt&lt; PreferPredicateTy::Option &gt; PreferPredicateOverEpilogue(&quot;prefer-predicate-over-epilogue&quot;, cl::init(PreferPredicateTy::ScalarEpilogue), cl::Hidden, cl::desc(&quot;Tail-folding and predication preferences over creating a scalar &quot; &quot;epilogue loop.&quot;), cl::values(clEnumValN(PreferPredicateTy::ScalarEpilogue, &quot;scalar-epilogue&quot;, &quot;Don&#39;t tail-predicate loops, create scalar epilogue&quot;), clEnumValN(PreferPredicateTy::PredicateElseScalarEpilogue, &quot;predicate-else-scalar-epilogue&quot;, &quot;prefer tail-folding, create scalar epilogue if tail &quot; &quot;folding fails.&quot;), clEnumValN(PreferPredicateTy::PredicateOrDontVectorize, &quot;predicate-dont-vectorize&quot;, &quot;prefers tail-folding, don&#39;t attempt vectorization if &quot; &quot;tail-folding fails.&quot;)))</>}
  labels = {["static"]}>

Definition at line <a href="#l00218">218</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### SCEVCheckBypassWeights {#a968a5c2971ffa9e8ef81ff86eebaf514}

<MemberDefinition
  prototype={<>uint32&#95;t SCEVCheckBypassWeights&#91;&#93; = &#123;1, 127&#125;</>}
  labels = {["constexpr", "static"]}>

Definition at line <a href="#l00395">395</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### SmallLoopCost {#a71899f6c73fcc8e2fc977dadc1fb1520}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; SmallLoopCost(&quot;small-loop-cost&quot;, cl::init(20), cl::Hidden, cl::desc( &quot;The cost of a loop that is considered &#39;small&#39; by the interleaver.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00302">302</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### TinyTripCountVectorThreshold {#a15320a2d7ced6e62766048ae7b6f8b13}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; TinyTripCountVectorThreshold(&quot;vectorizer-min-trip-count&quot;, cl::init(16), cl::Hidden, cl::desc(&quot;Loops with a constant trip count that is smaller than this &quot; &quot;value are vectorized only if no scalar iteration overheads &quot; &quot;are incurred.&quot;))</>}
  labels = {["static"]}>
Loops with a known constant trip count below this number are vectorized only if no scalar iteration overheads are incurred.

Definition at line <a href="#l00195">195</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### UseWiderVFIfCallVariantsPresent {#a639c83322f3d5f0e24e9bde998a516fd}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; UseWiderVFIfCallVariantsPresent(&quot;vectorizer-maximize-bandwidth-for-vector-calls&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Try wider VFs if they enable the use of vector variants&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00383">383</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### VectorizeMemoryCheckThreshold {#a1293f02da7fffb33096a44f1b1768b3f}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; VectorizeMemoryCheckThreshold(&quot;vectorize-memory-check-threshold&quot;, cl::init(128), cl::Hidden, cl::desc(&quot;The maximum allowed number of runtime memory checks&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00201">201</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### VerboseDebug {#a8eba8b6f7c3e69bf4d4efd92cd74b5a6}

<MemberDefinition
  prototype={<>const char VerboseDebug&#91;&#93; = <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> &quot;-verbose&quot;</>}>

Definition at line <a href="#l00162">162</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### VPlanBuildStressTest {#a9f30855a6efcd4a12875deb88880b510}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; VPlanBuildStressTest(&quot;vplan-build-stress-test&quot;, cl::init(false), cl::Hidden, cl::desc( &quot;Build VPlan for every supported loop nest in the function and bail &quot; &quot;out right after the build (stress test the VPlan H-CFG construction &quot; &quot;in the VPlan-native vectorization path).&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00364">364</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a></>}>

Definition at line <a href="#l00159">159</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### LV&#95;NAME {#a0eff4a8bccb143ae91e197e6a59d4692}

<MemberDefinition
  prototype={<>#define LV&#95;NAME&nbsp;&nbsp;&nbsp;&quot;loop-vectorize&quot;</>}>

Definition at line <a href="#l00158">158</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><span class="doxyHighlightComment">//===- LoopVectorize.cpp - A Loop Vectorizer ------------------------------===//</span></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><span class="doxyHighlightComment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</span></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><span class="doxyHighlightComment">// See https://llvm.org/LICENSE.txt for license information.</span></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><span class="doxyHighlightComment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</span></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><span class="doxyHighlightComment">// This is the LLVM loop vectorizer. This pass modifies &#39;vectorizable&#39; loops</span></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><span class="doxyHighlightComment">// and generates target-independent LLVM-IR.</span></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><span class="doxyHighlightComment">// The vectorizer uses the TargetTransformInfo analysis to estimate the costs</span></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><span class="doxyHighlightComment">// of instructions in order to estimate the profitability of vectorization.</span></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><span class="doxyHighlightComment">// The loop vectorizer combines consecutive loop iterations into a single</span></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><span class="doxyHighlightComment">// &#39;wide&#39; iteration. After this transformation the index is incremented</span></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><span class="doxyHighlightComment">// by the SIMD vector width, and not by one.</span></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><span class="doxyHighlightComment">// This pass has three parts:</span></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><span class="doxyHighlightComment">// 1 The main loop pass that drives the different parts.</span></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><span class="doxyHighlightComment">// 2 LoopVectorizationLegality - A unit that checks for the legality</span></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><span class="doxyHighlightComment">//    of the vectorization.</span></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><span class="doxyHighlightComment">// 3 InnerLoopVectorizer - A unit that performs the actual</span></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><span class="doxyHighlightComment">//    widening of instructions.</span></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><span class="doxyHighlightComment">// 4 LoopVectorizationCostModel - A unit that checks for the profitability</span></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><span class="doxyHighlightComment">//    of vectorization. It decides on the optimal vector width, which</span></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><span class="doxyHighlightComment">//    can be one, if vectorization is not profitable.</span></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><span class="doxyHighlightComment">// There is a development effort going on to migrate loop vectorizer to the</span></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><span class="doxyHighlightComment">// VPlan infrastructure and to introduce outer loop vectorization support (see</span></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><span class="doxyHighlightComment">// docs/VectorizationPlan.rst and</span></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><span class="doxyHighlightComment">// http://lists.llvm.org/pipermail/llvm-dev/2017-December/119523.html). For this</span></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><span class="doxyHighlightComment">// purpose, we temporarily introduced the VPlan-native vectorization path: an</span></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><span class="doxyHighlightComment">// alternative vectorization path that is natively implemented on top of the</span></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><span class="doxyHighlightComment">// VPlan infrastructure. See EnableVPlanNativePath for enabling.</span></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><span class="doxyHighlightComment">// The reduction-variable vectorization is based on the paper:</span></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><span class="doxyHighlightComment">//  D. Nuzman and R. Henderson. Multi-platform Auto-vectorization.</span></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><span class="doxyHighlightComment">// Variable uniformity checks are inspired by:</span></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><span class="doxyHighlightComment">//  Karrenberg, R. and Hack, S. Whole Function Vectorization.</span></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><span class="doxyHighlightComment">// The interleaved access vectorization is based on the paper:</span></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><span class="doxyHighlightComment">//  Dorit Nuzman, Ira Rosen and Ayal Zaks.  Auto-Vectorization of Interleaved</span></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><span class="doxyHighlightComment">//  Data for SIMD</span></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><span class="doxyHighlightComment">// Other ideas/concepts are from:</span></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><span class="doxyHighlightComment">//  A. Zaks and D. Nuzman. Autovectorization in GCC-two years later.</span></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><span class="doxyHighlightComment">//  S. Maleki, Y. Gao, M. Garzaran, T. Wong and D. Padua.  An Evaluation of</span></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><span class="doxyHighlightComment">//  Vectorizing Compilers.</span></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/vectorize/loopvectorize-h">llvm/Transforms/Vectorize/LoopVectorize.h</a>&quot;</span></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationplanner-h">LoopVectorizationPlanner.h</a>&quot;</span></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vprecipebuilder-h">VPRecipeBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplan-h">VPlan.h</a>&quot;</span></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplananalysis-h">VPlanAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanhcfgbuilder-h">VPlanHCFGBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanpatternmatch-h">VPlanPatternMatch.h</a>&quot;</span></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-h">VPlanTransforms.h</a>&quot;</span></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanutils-h">VPlanUtils.h</a>&quot;</span></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanverifier-h">VPlanVerifier.h</a>&quot;</span></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h">llvm/ADT/APInt.h</a>&quot;</span></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</span></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</span></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemapinfo-h">llvm/ADT/DenseMapInfo.h</a>&quot;</span></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/hashing-h">llvm/ADT/Hashing.h</a>&quot;</span></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h">llvm/ADT/MapVector.h</a>&quot;</span></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</span></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</span></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</span></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</span></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h">llvm/ADT/StringRef.h</a>&quot;</span></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/twine-h">llvm/ADT/Twine.h</a>&quot;</span></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/typeswitch-h">llvm/ADT/TypeSwitch.h</a>&quot;</span></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/iterator-range-h">llvm/ADT/iterator&#95;range.h</a>&quot;</span></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h">llvm/Analysis/AssumptionCache.h</a>&quot;</span></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/basicaliasanalysis-h">llvm/Analysis/BasicAliasAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h">llvm/Analysis/BlockFrequencyInfo.h</a>&quot;</span></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/cfg-h">llvm/Analysis/CFG.h</a>&quot;</span></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/codemetrics-h">llvm/Analysis/CodeMetrics.h</a>&quot;</span></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/demandedbits-h">llvm/Analysis/DemandedBits.h</a>&quot;</span></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/globalsmodref-h">llvm/Analysis/GlobalsModRef.h</a>&quot;</span></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopaccessanalysis-h">llvm/Analysis/LoopAccessAnalysis.h</a>&quot;</span></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopanalysismanager-h">llvm/Analysis/LoopAnalysisManager.h</a>&quot;</span></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h">llvm/Analysis/LoopInfo.h</a>&quot;</span></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopiterator-h">llvm/Analysis/LoopIterator.h</a>&quot;</span></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h">llvm/Analysis/OptimizationRemarkEmitter.h</a>&quot;</span></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h">llvm/Analysis/ProfileSummaryInfo.h</a>&quot;</span></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolution-h">llvm/Analysis/ScalarEvolution.h</a>&quot;</span></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolutionexpressions-h">llvm/Analysis/ScalarEvolutionExpressions.h</a>&quot;</span></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</span></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</span></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</span></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h">llvm/Analysis/VectorUtils.h</a>&quot;</span></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h">llvm/IR/Attributes.h</a>&quot;</span></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</span></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h">llvm/IR/CFG.h</a>&quot;</span></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</span></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</span></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</span></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</span></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debugloc-h">llvm/IR/DebugLoc.h</a>&quot;</span></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</span></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/diagnosticinfo-h">llvm/IR/DiagnosticInfo.h</a>&quot;</span></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</span></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</span></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</span></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</span></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</span></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</span></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h">llvm/IR/Intrinsics.h</a>&quot;</span></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h">llvm/IR/MDBuilder.h</a>&quot;</span></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h">llvm/IR/Metadata.h</a>&quot;</span></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</span></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h">llvm/IR/Operator.h</a>&quot;</span></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</span></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/profdatautils-h">llvm/IR/ProfDataUtils.h</a>&quot;</span></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</span></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/use-h">llvm/IR/Use.h</a>&quot;</span></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</span></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</span></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/verifier-h">llvm/IR/Verifier.h</a>&quot;</span></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</span></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</span></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</span></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</span></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/instructioncost-h">llvm/Support/InstructionCost.h</a>&quot;</span></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/mathextras-h">llvm/Support/MathExtras.h</a>&quot;</span></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/nativeformatting-h">llvm/Support/NativeFormatting.h</a>&quot;</span></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</span></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</span></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/injecttlimappings-h">llvm/Transforms/Utils/InjectTLIMappings.h</a>&quot;</span></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</span></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/loopsimplify-h">llvm/Transforms/Utils/LoopSimplify.h</a>&quot;</span></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looputils-h">llvm/Transforms/Utils/LoopUtils.h</a>&quot;</span></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/loopversioning-h">llvm/Transforms/Utils/LoopVersioning.h</a>&quot;</span></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/scalarevolutionexpander-h">llvm/Transforms/Utils/ScalarEvolutionExpander.h</a>&quot;</span></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/sizeopts-h">llvm/Transforms/Utils/SizeOpts.h</a>&quot;</span></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><span class="doxyHighlightPreprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/vectorize/loopvectorizationlegality-h">llvm/Transforms/Vectorize/LoopVectorizationLegality.h</a>&quot;</span></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><span class="doxyHighlightPreprocessor">#include &lt;algorithm&gt;</span></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><span class="doxyHighlightPreprocessor">#include &lt;cassert&gt;</span></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><span class="doxyHighlightPreprocessor">#include &lt;cstdint&gt;</span></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><span class="doxyHighlightPreprocessor">#include &lt;functional&gt;</span></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><span class="doxyHighlightPreprocessor">#include &lt;iterator&gt;</span></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><span class="doxyHighlightPreprocessor">#include &lt;limits&gt;</span></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><span class="doxyHighlightPreprocessor">#include &lt;memory&gt;</span></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><span class="doxyHighlightPreprocessor">#include &lt;string&gt;</span></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><span class="doxyHighlightPreprocessor">#include &lt;tuple&gt;</span></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><span class="doxyHighlightPreprocessor">#include &lt;utility&gt;</span></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a>;</span></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158" lineLink="#a0eff4a8bccb143ae91e197e6a59d4692"><span class="doxyHighlightPreprocessor">#define LV&#95;NAME &quot;loop-vectorize&quot;</span></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><span class="doxyHighlightPreprocessor">#define DEBUG&#95;TYPE LV&#95;NAME</span></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162" lineLink="#a8eba8b6f7c3e69bf4d4efd92cd74b5a6"><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/analysis/loopnestanalysis-cpp/#ab3595005ef7c117f30d4c18201190bbb">VerboseDebug</a>&#91;&#93; = <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </span><span class="doxyHighlightStringLiteral">&quot;-verbose&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><span class="doxyHighlightComment">/// @&#123;</span></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><span class="doxyHighlightComment">/// Metadata attribute names</span></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167" lineLink="#a3bf55ccbbeedcfb8cd2a1bd62c0ad91a"><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="#a3bf55ccbbeedcfb8cd2a1bd62c0ad91a">LLVMLoopVectorizeFollowupAll</a>&#91;&#93; = </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.vectorize.followup&#95;all&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168" lineLink="#a99050b417d193e1cc1117e5bbd4bfbce"><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="#a99050b417d193e1cc1117e5bbd4bfbce">LLVMLoopVectorizeFollowupVectorized</a>&#91;&#93; =</span></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.vectorize.followup&#95;vectorized&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170" lineLink="#aadedae9de069f3bcef6fa7a90ce4a630"><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> <a href="#aadedae9de069f3bcef6fa7a90ce4a630">LLVMLoopVectorizeFollowupEpilogue</a>&#91;&#93; =</span></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.vectorize.followup&#95;epilogue&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><span class="doxyHighlightComment">/// @&#125;</span></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174" lineLink="#ad8318a653242df10df04853e090cc21f"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(LoopsVectorized, </span><span class="doxyHighlightStringLiteral">&quot;Number of loops vectorized&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175" lineLink="#aefd85537796668463b24d5ab5b225407"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(LoopsAnalyzed, </span><span class="doxyHighlightStringLiteral">&quot;Number of loops analyzed for vectorization&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176" lineLink="#a683da38156d0f59a8d6a0cc83dc7ae14"><span class="doxyHighlight"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(LoopsEpilogueVectorized, </span><span class="doxyHighlightStringLiteral">&quot;Number of epilogues vectorized&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178" lineLink="#a8bb0da83afffaf803b396b1d055ba5e0"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a8bb0da83afffaf803b396b1d055ba5e0">EnableEpilogueVectorization</a>(</span></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;enable-epilogue-vectorization&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable vectorization of epilogue loops.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182" lineLink="#a01340df86c9d26b281ff1ab9288c28ce"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a01340df86c9d26b281ff1ab9288c28ce">EpilogueVectorizationForceVF</a>(</span></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;epilogue-vectorization-force-VF&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(1), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;When epilogue vectorization is enabled, and a value greater than &quot;</span></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;1 is specified, forces the given VF for all applicable epilogue &quot;</span></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;loops.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188" lineLink="#a01070590fdc156c181654c2db7b9ddcc"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a01070590fdc156c181654c2db7b9ddcc">EpilogueVectorizationMinVF</a>(</span></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;epilogue-vectorization-minimum-VF&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Only loops with vectorization factor equal to or larger than &quot;</span></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;the specified value are considered for epilogue vectorization.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><span class="doxyHighlightComment">/// Loops with a known constant trip count below this number are vectorized only</span></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><span class="doxyHighlightComment">/// if no scalar iteration overheads are incurred.</span></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195" lineLink="#a15320a2d7ced6e62766048ae7b6f8b13"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a15320a2d7ced6e62766048ae7b6f8b13">TinyTripCountVectorThreshold</a>(</span></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;vectorizer-min-trip-count&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(16), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Loops with a constant trip count that is smaller than this &quot;</span></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;value are vectorized only if no scalar iteration overheads &quot;</span></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;are incurred.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201" lineLink="#a1293f02da7fffb33096a44f1b1768b3f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a1293f02da7fffb33096a44f1b1768b3f">VectorizeMemoryCheckThreshold</a>(</span></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;vectorize-memory-check-threshold&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(128), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;The maximum allowed number of runtime memory checks&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><span class="doxyHighlightComment">// Option prefer-predicate-over-epilogue indicates that an epilogue is undesired,</span></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><span class="doxyHighlightComment">// that predication is preferred, and this lists all options. I.e., the</span></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><span class="doxyHighlightComment">// vectorizer will try to fold the tail-loop (epilogue) into the vector body</span></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><span class="doxyHighlightComment">// and predicate the instructions accordingly. If tail-folding fails, there are</span></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><span class="doxyHighlightComment">// different fallback strategies depending on these values:</span></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210" lineLink="/docs/api/namespaces/preferpredicatety"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/preferpredicatety">PreferPredicateTy</a> &#123;</span></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211" lineLink="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cda"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cda">Option</a> &#123;</span></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212" lineLink="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa114bc9020d046f551b06f41f6f4539f7"><span class="doxyHighlight">    <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa114bc9020d046f551b06f41f6f4539f7">ScalarEpilogue</a> = 0,</span></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213" lineLink="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa3111b239a92c1674cea87d025e818091"><span class="doxyHighlight">    <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa3111b239a92c1674cea87d025e818091">PredicateElseScalarEpilogue</a>,</span></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214" lineLink="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa5e6f0abe1c426939c61d8924cfa02e5a"><span class="doxyHighlight">    <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa5e6f0abe1c426939c61d8924cfa02e5a">PredicateOrDontVectorize</a></span></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace PreferPredicateTy</span></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218" lineLink="#abe3c68238712d04bbe3a70f3a8f483f5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;PreferPredicateTy::Option&gt;</a> <a href="#abe3c68238712d04bbe3a70f3a8f483f5">PreferPredicateOverEpilogue</a>(</span></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;prefer-predicate-over-epilogue&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa114bc9020d046f551b06f41f6f4539f7">PreferPredicateTy::ScalarEpilogue</a>),</span></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Tail-folding and predication preferences over creating a scalar &quot;</span></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;epilogue loop.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#a8fa743aa76b6902028f8a643dfb87171">cl::values</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa114bc9020d046f551b06f41f6f4539f7">PreferPredicateTy::ScalarEpilogue</a>,</span></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;scalar-epilogue&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;Don&#39;t tail-predicate loops, create scalar epilogue&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><span class="doxyHighlight">              <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa3111b239a92c1674cea87d025e818091">PreferPredicateTy::PredicateElseScalarEpilogue</a>,</span></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;predicate-else-scalar-epilogue&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;prefer tail-folding, create scalar epilogue if tail &quot;</span></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;folding fails.&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><span class="doxyHighlight">              <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa5e6f0abe1c426939c61d8924cfa02e5a">PreferPredicateTy::PredicateOrDontVectorize</a>,</span></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;predicate-dont-vectorize&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;prefers tail-folding, don&#39;t attempt vectorization if &quot;</span></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;tail-folding fails.&quot;</span><span class="doxyHighlight">)));</span></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236" lineLink="#a8959791a22c7d3cfb4136777fd244535"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;TailFoldingStyle&gt;</a> <a href="#a8959791a22c7d3cfb4136777fd244535">ForceTailFoldingStyle</a>(</span></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;force-tail-folding-style&quot;</span><span class="doxyHighlight">, <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Force the tail folding style&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>),</span></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#a8fa743aa76b6902028f8a643dfb87171">cl::values</a>(</span></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>, </span><span class="doxyHighlightStringLiteral">&quot;none&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;Disable tail folding&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(</span></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddaf6068daa29dbb05a7ead1e3b5a48bbee">TailFoldingStyle::Data</a>, </span><span class="doxyHighlightStringLiteral">&quot;data&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><span class="doxyHighlight">            </span><span class="doxyHighlightStringLiteral">&quot;Create lane mask for data only, using active.lane.mask intrinsic&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddadfca60932ecfe430f86d4ecde04e13ab">TailFoldingStyle::DataWithoutLaneMask</a>,</span></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;data-without-lane-mask&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;Create lane mask with compare/stepvector&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddad817e2199b89933da1a3cd7e130cd782">TailFoldingStyle::DataAndControlFlow</a>, </span><span class="doxyHighlightStringLiteral">&quot;data-and-control&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;Create lane mask using active.lane.mask intrinsic, and use &quot;</span></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;it for both data and control flow&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">TailFoldingStyle::DataAndControlFlowWithoutRuntimeCheck</a>,</span></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;data-and-control-without-rt-check&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;Similar to data-and-control, but remove the runtime check&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6ae67872a709ea2e3175802518fc4e71">TailFoldingStyle::DataWithEVL</a>, </span><span class="doxyHighlightStringLiteral">&quot;data-with-evl&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;Use predicated EVL instructions for tail folding. If EVL &quot;</span></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;is unsupported, fallback to data-without-lane-mask.&quot;</span><span class="doxyHighlight">)));</span></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257" lineLink="#afe9b34c22ec9e2cc84d61d437f82936d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#afe9b34c22ec9e2cc84d61d437f82936d">MaximizeBandwidth</a>(</span></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;vectorizer-maximize-bandwidth&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Maximize bandwidth when selecting vectorization factor which &quot;</span></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;will be determined by the smallest type in loop.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262" lineLink="#ac3af17aa5bce5ef8c3aa82faeacfc456"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#ac3af17aa5bce5ef8c3aa82faeacfc456">EnableInterleavedMemAccesses</a>(</span></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;enable-interleaved-mem-accesses&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable vectorization on interleaved memory accesses in a loop&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><span class="doxyHighlightComment">/// An interleave-group may need masking if it resides in a block that needs</span></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><span class="doxyHighlightComment">/// predication, or in order to mask away gaps.</span></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268" lineLink="#ac68ad295befb7187ae293cc0faaa3ac3"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#ac68ad295befb7187ae293cc0faaa3ac3">EnableMaskedInterleavedMemAccesses</a>(</span></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;enable-masked-interleaved-mem-accesses&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable vectorization on masked interleaved memory accesses in a loop&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272" lineLink="#a62baadf3a5bf03eddf58bf048724acb1"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a62baadf3a5bf03eddf58bf048724acb1">ForceTargetNumScalarRegs</a>(</span></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;force-target-num-scalar-regs&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;A flag that overrides the target&#39;s number of scalar registers.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276" lineLink="#a7d952aa72676eecd8065aa2c29ea458c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a7d952aa72676eecd8065aa2c29ea458c">ForceTargetNumVectorRegs</a>(</span></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;force-target-num-vector-regs&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;A flag that overrides the target&#39;s number of vector registers.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280" lineLink="#aee1082071c43958a6ef5e6e9f665ae4a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#aee1082071c43958a6ef5e6e9f665ae4a">ForceTargetMaxScalarInterleaveFactor</a>(</span></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;force-target-max-scalar-interleave&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;A flag that overrides the target&#39;s max interleave factor for &quot;</span></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;scalar loops.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285" lineLink="#ade5aad46b91dc51c831acf1e69ee9863"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#ade5aad46b91dc51c831acf1e69ee9863">ForceTargetMaxVectorInterleaveFactor</a>(</span></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;force-target-max-vector-interleave&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;A flag that overrides the target&#39;s max interleave factor for &quot;</span></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;vectorized loops.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290" lineLink="#a5eae6074e6a1bb62e365ef65f3e26196"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a5eae6074e6a1bb62e365ef65f3e26196">ForceTargetInstructionCost</a>(</span></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;force-target-instruction-cost&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;A flag that overrides the target&#39;s expected cost for &quot;</span></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;an instruction to a single constant value. Mostly &quot;</span></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;useful for getting consistent testing.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296" lineLink="#a48035e22b43c905a2961c90e5470b2f0"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a48035e22b43c905a2961c90e5470b2f0">ForceTargetSupportsScalableVectors</a>(</span></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;force-target-supports-scalable-vectors&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Pretend that scalable vectors are supported, even if the target does &quot;</span></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;not support them. This flag should only be used for testing.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302" lineLink="#a71899f6c73fcc8e2fc977dadc1fb1520"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a71899f6c73fcc8e2fc977dadc1fb1520">SmallLoopCost</a>(</span></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;small-loop-cost&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(20), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;The cost of a loop that is considered &#39;small&#39; by the interleaver.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307" lineLink="#aa5a50c0ac98e2ed63da85783ca102cf8"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#aa5a50c0ac98e2ed63da85783ca102cf8">LoopVectorizeWithBlockFrequency</a>(</span></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;loop-vectorize-with-block-frequency&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable the use of the block frequency analysis to access PGO &quot;</span></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;heuristics minimizing code growth in cold regions and being more &quot;</span></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;aggressive in hot regions.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><span class="doxyHighlightComment">// Runtime interleave loops for load/store throughput.</span></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314" lineLink="#a99a396adb2c0f9fb93b7ff8ea8b2e2ef"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a99a396adb2c0f9fb93b7ff8ea8b2e2ef">EnableLoadStoreRuntimeInterleave</a>(</span></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;enable-loadstore-runtime-interleave&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Enable runtime interleaving until load/store ports are saturated&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><span class="doxyHighlightComment">/// The number of stores in a loop that are allowed to need predication.</span></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320" lineLink="#ae11c08aa35785a118bda788836cab423"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#ae11c08aa35785a118bda788836cab423">NumberOfStoresToPredicate</a>(</span></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;vectorize-num-stores-pred&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(1), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Max number of stores to be predicated behind an if.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324" lineLink="#a8122656ed2c776067b43d9ae34ccecb6"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a8122656ed2c776067b43d9ae34ccecb6">EnableIndVarRegisterHeur</a>(</span></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;enable-ind-var-reg-heur&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Count the induction variable only once when interleaving&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328" lineLink="#a1b67aba558e56b48dbb2891b6e5fe5b8"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a1b67aba558e56b48dbb2891b6e5fe5b8">EnableCondStoresVectorization</a>(</span></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;enable-cond-stores-vec&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable if predication of stores during vectorization.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332" lineLink="#ae75965df4671fa34c6ffc5a6e404843a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#ae75965df4671fa34c6ffc5a6e404843a">MaxNestedScalarReductionIC</a>(</span></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;max-nested-scalar-reduction-interleave&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(2), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;The maximum interleave count to use when interleaving a scalar &quot;</span></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;reduction in a nested loop.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></span></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338" lineLink="#a96ef6bd4742763bf1b85aaf1a4150620"><span class="doxyHighlight">    <a href="#a96ef6bd4742763bf1b85aaf1a4150620">PreferInLoopReductions</a>(</span><span class="doxyHighlightStringLiteral">&quot;prefer-inloop-reductions&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><span class="doxyHighlight">                           <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><span class="doxyHighlight">                           <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Prefer in-loop vector reductions, &quot;</span></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><span class="doxyHighlight">                                    </span><span class="doxyHighlightStringLiteral">&quot;overriding the targets preference.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343" lineLink="#acb0b374f69dc6867357f0aa5e93ab33d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#acb0b374f69dc6867357f0aa5e93ab33d">ForceOrderedReductions</a>(</span></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;force-ordered-reductions&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable the vectorisation of loops with in-order (strict) &quot;</span></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;FP reductions&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348" lineLink="#a927ef1cfd7c981c5b9b9e8c67b1d13c3"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a927ef1cfd7c981c5b9b9e8c67b1d13c3">PreferPredicatedReductionSelect</a>(</span></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;prefer-predicated-reduction-select&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Prefer predicating a reduction operation over an after loop select.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</span></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a>(</span></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;enable-vplan-native-path&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable VPlan-native vectorization path with &quot;</span></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;support for outer loop vectorization.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace llvm</span></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><span class="doxyHighlightComment">// This flag enables the stress testing of the VPlan H-CFG construction in the</span></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><span class="doxyHighlightComment">// VPlan-native vectorization path. It must be used in conjuction with</span></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><span class="doxyHighlightComment">// -enable-vplan-native-path. -vplan-verify-hcfg can also be used to enable the</span></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><span class="doxyHighlightComment">// verification of the H-CFGs built.</span></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364" lineLink="#a9f30855a6efcd4a12875deb88880b510"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a9f30855a6efcd4a12875deb88880b510">VPlanBuildStressTest</a>(</span></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;vplan-build-stress-test&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Build VPlan for every supported loop nest in the function and bail &quot;</span></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;out right after the build (stress test the VPlan H-CFG construction &quot;</span></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;in the VPlan-native vectorization path).&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#af98e93062e9f33018307ffc64d4b009e">llvm::EnableLoopInterleaving</a>(</span></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;interleave-loops&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Enable loop interleaving in Loop vectorization passes&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#a7f386d38a2c6c22a343243e9e48f7532">llvm::EnableLoopVectorization</a>(</span></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;vectorize-loops&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Run the Loop vectorization passes&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378" lineLink="#ad69cf8bf5c6b79c5642327ecb6be38cd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;cl::boolOrDefault&gt;</a> <a href="#ad69cf8bf5c6b79c5642327ecb6be38cd">ForceSafeDivisor</a>(</span></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;force-widen-divrem-via-safe-divisor&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Override cost based safe divisor widening for div/rem instructions&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383" lineLink="#a639c83322f3d5f0e24e9bde998a516fd"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a639c83322f3d5f0e24e9bde998a516fd">UseWiderVFIfCallVariantsPresent</a>(</span></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;vectorizer-maximize-bandwidth-for-vector-calls&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span><span class="doxyHighlightStringLiteral">&quot;Try wider VFs if they enable the use of vector variants&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388" lineLink="#af7af1b4bf03205c80dcba0a6324c4f21"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#af7af1b4bf03205c80dcba0a6324c4f21">EnableEarlyExitVectorization</a>(</span></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><span class="doxyHighlight">    </span><span class="doxyHighlightStringLiteral">&quot;enable-early-exit-vectorization&quot;</span><span class="doxyHighlight">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</span></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</span></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Enable vectorization of early exit loops with uncountable exits.&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><span class="doxyHighlightComment">// Likelyhood of bypassing the vectorized loop because assumptions about SCEV</span></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><span class="doxyHighlightComment">// variables not overflowing do not hold. See &#96;emitSCEVChecks&#96;.</span></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395" lineLink="#a968a5c2971ffa9e8ef81ff86eebaf514"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">constexpr</span><span class="doxyHighlight"> uint32&#95;t <a href="#a968a5c2971ffa9e8ef81ff86eebaf514">SCEVCheckBypassWeights</a>&#91;&#93; = &#123;1, 127&#125;;</span></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><span class="doxyHighlightComment">// Likelyhood of bypassing the vectorized loop because pointers overlap. See</span></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><span class="doxyHighlightComment">// &#96;emitMemRuntimeChecks&#96;.</span></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398" lineLink="#a502070b20fa467fb54ba49d6736cf2d3"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">constexpr</span><span class="doxyHighlight"> uint32&#95;t <a href="#a502070b20fa467fb54ba49d6736cf2d3">MemCheckBypassWeights</a>&#91;&#93; = &#123;1, 127&#125;;</span></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><span class="doxyHighlightComment">// Likelyhood of bypassing the vectorized loop because there are zero trips left</span></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><span class="doxyHighlightComment">// after prolog. See &#96;emitIterationCountCheck&#96;.</span></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401" lineLink="#a629884e9a99a9f49106db9e5e6252fcb"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">constexpr</span><span class="doxyHighlight"> uint32&#95;t <a href="#a629884e9a99a9f49106db9e5e6252fcb">MinItersBypassWeights</a>&#91;&#93; = &#123;1, 127&#125;;</span></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><span class="doxyHighlightComment">/// A helper function that returns true if the given type is irregular. The</span></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><span class="doxyHighlightComment">/// type is irregular if its allocated size doesn&#39;t equal the store size of an</span></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><span class="doxyHighlightComment">/// element of the corresponding vector type.</span></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406" lineLink="#aa407c2e7d895ed29af8cc68563c03065"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aa407c2e7d895ed29af8cc68563c03065">hasIrregularType</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Determine if an array of N elements of type Ty is &quot;bitcast compatible&quot;</span></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with a &lt;N x Ty&gt; vector.</span></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is only true if there is no padding between the array elements.</span></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSizeInBits(Ty) != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(Ty);</span></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><span class="doxyHighlightComment">/// Returns &quot;best known&quot; trip count for the specified loop \\p L as defined by</span></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><span class="doxyHighlightComment">/// the following procedure:</span></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><span class="doxyHighlightComment">///   1) Returns exact trip count if it is known.</span></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><span class="doxyHighlightComment">///   2) Returns expected trip count according to profile data if any.</span></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><span class="doxyHighlightComment">///   3) Returns upper bound estimate if known, and if \\p CanUseConstantMax.</span></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><span class="doxyHighlightComment">///   4) Returns std::nullopt if all of the above failed.</span></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::optional&lt;unsigned&gt;</span></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420" lineLink="#a84375e6536d9214c7895013078055aff"><span class="doxyHighlight"><a href="#a84375e6536d9214c7895013078055aff">getSmallBestKnownTC</a>(<a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;PSE, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</span></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CanUseConstantMax = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if exact trip count is known.</span></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ExpectedTC = PSE.<a href="/docs/api/classes/llvm/predicatedscalarevolution/#a10ca5eacc61b5669880de2f8b0cff33c">getSE</a>()-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#abec0c616087c002528fcf80c6583eadd">getSmallConstantTripCount</a>(L))</span></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ExpectedTC;</span></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if there is an expected trip count available from profile data.</span></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aa5a50c0ac98e2ed63da85783ca102cf8">LoopVectorizeWithBlockFrequency</a>)</span></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EstimatedTC = <a href="/docs/api/namespaces/llvm/#a0b3c6dc8e7df65d2385acfe9657abd03">getLoopEstimatedTripCount</a>(L))</span></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;EstimatedTC;</span></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CanUseConstantMax)</span></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if upper bound estimate is known.</span></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ExpectedTC = PSE.<a href="/docs/api/classes/llvm/predicatedscalarevolution/#aacf376f9963d73732052a7362c5afabd">getSmallConstantMaxTripCount</a>())</span></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ExpectedTC;</span></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441" lineLink="/docs/api/namespaces/anonymous-loopvectorize-cpp-"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><span class="doxyHighlightComment">// Forward declare GeneratedRTChecks.</span></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks">GeneratedRTChecks</a>;</span></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445" lineLink="/docs/api/namespaces/anonymous-loopvectorize-cpp-/#aad9655f266100ed4a64d9aeea1e4f4b6"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/anonymous-loopvectorize-cpp-/#aad9655f266100ed4a64d9aeea1e4f4b6">SCEV2ValueTy</a> = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const SCEV &#42;, Value &#42;&gt;</a>;</span></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</span></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/analysiskey">AnalysisKey</a> <a href="/docs/api/structs/llvm/shouldrunextravectorpasses/#a42f51564a150e5ecd40230fad2368ee9">ShouldRunExtraVectorPasses::Key</a>;</span></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><span class="doxyHighlightComment">/// InnerLoopVectorizer vectorizes loops which contain only one basic</span></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><span class="doxyHighlightComment">/// block to a specified vectorization factor (VF).</span></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><span class="doxyHighlightComment">/// This class performs the widening of scalars into vectors, or multiple</span></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><span class="doxyHighlightComment">/// scalars. This class also implements the following features:</span></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><span class="doxyHighlightComment">/// &#42; It inserts an epilogue loop for handling loops that don&#39;t have iteration</span></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><span class="doxyHighlightComment">///   counts that are known to be a multiple of the vectorization factor.</span></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><span class="doxyHighlightComment">/// &#42; It handles the code generation for reduction variables.</span></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><span class="doxyHighlightComment">/// &#42; Scalarization (implementation using scalars) of un-vectorizable</span></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><span class="doxyHighlightComment">///   instructions.</span></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><span class="doxyHighlightComment">/// InnerLoopVectorizer does not perform any vectorization-legality</span></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><span class="doxyHighlightComment">/// checks, and relies on the caller to check for the different legality</span></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><span class="doxyHighlightComment">/// aspects. The InnerLoopVectorizer relies on the</span></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><span class="doxyHighlightComment">/// LoopVectorizationLegality class to provide information about the induction</span></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><span class="doxyHighlightComment">/// and reduction variables that were found to a given vectorization factor.</span></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466" lineLink="/docs/api/classes/llvm/innerloopvectorizer"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/innerloopvectorizer/#a6c7095217b0d803a65548373bd4db3cf">InnerLoopVectorizer</a> &#123;</span></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a6c7095217b0d803a65548373bd4db3cf"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6c7095217b0d803a65548373bd4db3cf">InnerLoopVectorizer</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>,</span></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>,</span></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><span class="doxyHighlight">                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>,</span></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><span class="doxyHighlight">                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a238e95d82d095fec9241f2f5b81db3c5">TTI</a>, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>,</span></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VecWidth,</span></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a1f52585230b8a3cb8bf4a30f8e51bfb4">MinProfitableTripCount</a>,</span></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><span class="doxyHighlight">                      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> UnrollFactor, <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;LVL,</span></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> &#42;CM, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>,</span></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>, GeneratedRTChecks &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#ae9880a8edd20b3b9b1527ecd5a03ac8c">RTChecks</a>,</span></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><span class="doxyHighlight">                      <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>)</span></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><span class="doxyHighlight">      : <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a238e95d82d095fec9241f2f5b81db3c5">TTI</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a238e95d82d095fec9241f2f5b81db3c5">TTI</a>),</span></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>(VecWidth),</span></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/innerloopvectorizer/#a1f52585230b8a3cb8bf4a30f8e51bfb4">MinProfitableTripCount</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a1f52585230b8a3cb8bf4a30f8e51bfb4">MinProfitableTripCount</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>(UnrollFactor),</span></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>.getSE()-&gt;getContext()), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6bb946cd99f8c37f0145265914aea778">Legal</a>(LVL), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>(CM), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>),</span></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae9880a8edd20b3b9b1527ecd5a03ac8c">RTChecks</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#ae9880a8edd20b3b9b1527ecd5a03ac8c">RTChecks</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>),</span></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6b18db1093ed5460e67e9058b89e385b">VectorPHVPB</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.getEntry()-&gt;getSingleSuccessor()) &#123;</span></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Query this against the original loop and save it here because the profile</span></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of the original loop header may change as the transformation happens.</span></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#a93a8f97a1e57c3bce2e7c3473d592c01">OptForSizeBasedOnProfile</a> = <a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(</span></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getHeader(), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>, <a href="/docs/api/namespaces/llvm/#aec7c967a5416fa6e154433965357a50ea089e7eb4db258e05f70eef4ed5aa10bb">PGSOQueryType::IRPass</a>);</span></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#aecacb69b3a2334317cce2a7856f7d30d"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">virtual</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#aecacb69b3a2334317cce2a7856f7d30d">~InnerLoopVectorizer</a>() = </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><span class="doxyHighlightComment">  /// Create a new empty loop that will contain vectorized instructions later</span></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><span class="doxyHighlightComment">  /// on, while the old loop will be used as the scalar remainder. Control flow</span></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><span class="doxyHighlightComment">  /// is generated around the vectorized (and scalar epilogue) loops consisting</span></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><span class="doxyHighlightComment">  /// of various checks and bypasses. Return the pre-header block of the new</span></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><span class="doxyHighlightComment">  /// loop. In the case of epilogue vectorization, this function is overriden to</span></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><span class="doxyHighlightComment">  /// handle the more complex control flow around the loops. \\p ExpandedSCEVs is</span></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><span class="doxyHighlightComment">  /// used to look up SCEV expansions for expressions needed during skeleton</span></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><span class="doxyHighlightComment">  /// creation.</span></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">virtual</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a31f933a6eada9926c9e320db27dfb775">createVectorizedLoopSkeleton</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV2ValueTy &amp;ExpandedSCEVs);</span></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><span class="doxyHighlightComment">  /// Fix the vectorized code, taking care of header phi&#39;s, and more.</span></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a9484786140efebf774cde8f072894246">fixVectorizedLoop</a>(<a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State);</span></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Return true if any runtime check is added.</span></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a2e066ef7bc9673cbb2a825189491577d"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a2e066ef7bc9673cbb2a825189491577d">areSafetyChecksAdded</a>() &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a645c5c5c1e89cb56be66db8db877001d">AddedSafetyChecks</a>; &#125;</span></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><span class="doxyHighlightComment">  /// A helper function to scalarize a single Instruction in the innermost loop.</span></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><span class="doxyHighlightComment">  /// Generates a sequence of scalar instances for each lane between \\p MinLane</span></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><span class="doxyHighlightComment">  /// and \\p MaxLane, times each part between \\p MinPart and \\p MaxPart,</span></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><span class="doxyHighlightComment">  /// inclusive. Uses the VPValue operands from \\p RepRecipe instead of \\p</span></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><span class="doxyHighlightComment">  /// Instr&#39;s operands.</span></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a4690286163882c35068b1908f4d752fd">scalarizeInstruction</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr,</span></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a> &#42;RepRecipe, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vplane">VPLane</a> &amp;Lane,</span></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><span class="doxyHighlight">                            <a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State);</span></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><span class="doxyHighlightComment">  /// Fix the non-induction PHIs in \\p Plan.</span></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#accb5ce221150790c36b2d96af1be821c">fixNonInductionPHIs</a>(<a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State);</span></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><span class="doxyHighlightComment">  /// Returns the original loop trip count.</span></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696">getTripCount</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0937fe0c707a3cd1198cea4467fa37c0">TripCount</a>; &#125;</span></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><span class="doxyHighlightComment">  /// Used to set the trip count after ILV&#39;s construction and after the</span></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><span class="doxyHighlightComment">  /// preheader block has been executed. Note that this always holds the trip</span></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><span class="doxyHighlightComment">  /// count of the original loop for both main loop and epilogue vectorization.</span></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a9160ed9f749a9c4df711061181288e13"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a9160ed9f749a9c4df711061181288e13">setTripCount</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;TC) &#123; <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0937fe0c707a3cd1198cea4467fa37c0">TripCount</a> = TC; &#125;</span></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Retrieve the additional bypass value associated with an original</span></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><span class="doxyHighlightComment">  /// induction header phi.</span></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a86acbbb5785d46e5a10d2ed34c779dd9"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a86acbbb5785d46e5a10d2ed34c779dd9">getInductionAdditionalBypassValue</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;OrigPhi)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a48c4aed6852a39d4dcc584ac75cc1055">Induction2AdditionalBypassValue</a>.at(OrigPhi);</span></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><span class="doxyHighlightComment">  /// Return the additional bypass block which targets the scalar loop by</span></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><span class="doxyHighlightComment">  /// skipping the epilogue loop after completing the main loop.</span></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a8f2e87f456c35fdad0ec24e7c71a92a5"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a8f2e87f456c35fdad0ec24e7c71a92a5">getAdditionalBypassBlock</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a329ce2a6185c5e632406d1d2fc75610e">AdditionalBypassBlock</a> &amp;&amp;</span></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Trying to access AdditionalBypassBlock but it has not been set&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a329ce2a6185c5e632406d1d2fc75610e">AdditionalBypassBlock</a>;</span></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><span class="doxyHighlightKeyword">protected</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a409249e01d3e65716e4c76fa3369a4e0"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/innerloopvectorizer/#a409249e01d3e65716e4c76fa3369a4e0">LoopVectorizationPlanner</a>;</span></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><span class="doxyHighlightComment">  /// Iteratively sink the scalarized operands of a predicated instruction into</span></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><span class="doxyHighlightComment">  /// the block that was created for it.</span></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0a5c60e5cebd520f95b9813fd9807016">sinkScalarOperands</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PredInst);</span></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><span class="doxyHighlightComment">  /// Returns (and creates if needed) the trip count of the widened loop.</span></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa83b181aa14d5afe1390faad388f91a4">getOrCreateVectorTripCount</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InsertBlock);</span></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><span class="doxyHighlightComment">  /// Emit a bypass check to see if the vector trip count is zero, including if</span></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><span class="doxyHighlightComment">  /// it overflows.</span></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a72c491cdf8cf0283d87008831431f917">emitIterationCountCheck</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass);</span></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><span class="doxyHighlightComment">  /// Emit a bypass check to see if all of the SCEV assumptions we&#39;ve</span></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><span class="doxyHighlightComment">  /// had to make are correct. Returns the block containing the checks or</span></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><span class="doxyHighlightComment">  /// nullptr if no checks have been added.</span></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a30c4bcea7beb42c7eb075a578bc3bc3e">emitSCEVChecks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass);</span></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><span class="doxyHighlightComment">  /// Emit bypass checks to check any memory assumptions we may have made.</span></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><span class="doxyHighlightComment">  /// Returns the block containing the checks or nullptr if no checks have been</span></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><span class="doxyHighlightComment">  /// added.</span></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a625caa931f0d8ef201041febbfe42cca">emitMemRuntimeChecks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass);</span></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><span class="doxyHighlightComment">  /// Emit basic blocks (prefixed with \\p Prefix) for the iteration check,</span></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><span class="doxyHighlightComment">  /// vector loop preheader, middle block and scalar preheader.</span></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5e719da4709193fd5b4632da4bc69795">createVectorLoopSkeleton</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a> Prefix);</span></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><span class="doxyHighlightComment">  /// Create and record the values for induction variables to resume coming from</span></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><span class="doxyHighlightComment">  /// the additional bypass block.</span></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a69c116deda6ae831a71558a4630323cb">createInductionAdditionalBypassValues</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV2ValueTy &amp;ExpandedSCEVs,</span></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/value">Value</a> &#42;MainVectorTripCount);</span></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><span class="doxyHighlightComment">  /// Allow subclasses to override and print debug traces before/after vplan</span></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><span class="doxyHighlightComment">  /// execution, when trace information is requested.</span></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a00579d597c88e5f3c51754bcd9ec5658"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">virtual</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a00579d597c88e5f3c51754bcd9ec5658">printDebugTracesAtStart</a>() &#123;&#125;</span></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a9e275f16680d4f09dbcc0dd7d323a075"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">virtual</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a9e275f16680d4f09dbcc0dd7d323a075">printDebugTracesAtEnd</a>() &#123;&#125;</span></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><span class="doxyHighlightComment">  /// Introduces a new VPIRBasicBlock for \\p CheckIRBB to Plan between the</span></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><span class="doxyHighlightComment">  /// vector preheader and its predecessor, also connecting the new block to the</span></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><span class="doxyHighlightComment">  /// scalar preheader.</span></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9">introduceCheckBlockInVPlan</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CheckIRBB);</span></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><span class="doxyHighlightComment">  /// The original loop.</span></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>;</span></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><span class="doxyHighlightComment">  /// A wrapper around ScalarEvolution used to add runtime SCEV checks. Applies</span></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><span class="doxyHighlightComment">  /// dynamic knowledge to simplify SCEV expressions and converts them to a</span></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><span class="doxyHighlightComment">  /// more usable form.</span></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>;</span></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><span class="doxyHighlightComment">  /// Loop Info.</span></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>;</span></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><span class="doxyHighlightComment">  /// Dominator Tree.</span></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>;</span></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><span class="doxyHighlightComment">  /// Target Library Info.</span></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>;</span></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><span class="doxyHighlightComment">  /// Target Transform Info.</span></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a238e95d82d095fec9241f2f5b81db3c5"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a238e95d82d095fec9241f2f5b81db3c5">TTI</a>;</span></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><span class="doxyHighlightComment">  /// Assumption Cache.</span></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>;</span></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><span class="doxyHighlightComment">  /// Interface to emit optimization remarks.</span></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>;</span></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><span class="doxyHighlightComment">  /// The vectorization SIMD factor to use. Each vector will have this many</span></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><span class="doxyHighlightComment">  /// vector elements.</span></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>;</span></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a1f52585230b8a3cb8bf4a30f8e51bfb4"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a1f52585230b8a3cb8bf4a30f8e51bfb4">MinProfitableTripCount</a>;</span></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><span class="doxyHighlightComment">  /// The vectorization unroll factor to use. Each scalar is vectorized to this</span></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><span class="doxyHighlightComment">  /// many different vector instructions.</span></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>;</span></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><span class="doxyHighlightComment">  /// The builder that we use</span></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>;</span></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// --- Vectorization state ---</span></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><span class="doxyHighlightComment">  /// The vector-loop preheader.</span></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>;</span></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><span class="doxyHighlightComment">  /// The scalar-loop preheader.</span></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>;</span></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><span class="doxyHighlightComment">  /// Middle Block between the vector and the scalar.</span></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a38e6f65b6ccbdebbf2c7a8b078936115"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a38e6f65b6ccbdebbf2c7a8b078936115">LoopMiddleBlock</a>;</span></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><span class="doxyHighlightComment">  /// A list of all bypass blocks. The first block is the entry of the loop.</span></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 4&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>;</span></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><span class="doxyHighlightComment">  /// Store instructions that were predicated.</span></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a47eab9fa7cfa73af0b164da3fca49a0f"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a47eab9fa7cfa73af0b164da3fca49a0f">PredicatedInstructions</a>;</span></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><span class="doxyHighlightComment">  /// Trip count of the original loop.</span></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a0937fe0c707a3cd1198cea4467fa37c0"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a0937fe0c707a3cd1198cea4467fa37c0">TripCount</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><span class="doxyHighlightComment">  /// Trip count of the widened loop (TripCount - TripCount % (VF&#42;UF))</span></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a2c95f95757d9c56b7a89d7f8b3278581"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a2c95f95757d9c56b7a89d7f8b3278581">VectorTripCount</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><span class="doxyHighlightComment">  /// The legality analysis.</span></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a6bb946cd99f8c37f0145265914aea778"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a6bb946cd99f8c37f0145265914aea778">Legal</a>;</span></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><span class="doxyHighlightComment">  /// The profitablity analysis.</span></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>;</span></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Record whether runtime checks are added.</span></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a645c5c5c1e89cb56be66db8db877001d"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a645c5c5c1e89cb56be66db8db877001d">AddedSafetyChecks</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><span class="doxyHighlightComment">  /// BFI and PSI are used to check for profile guided size optimizations.</span></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>;</span></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>;</span></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Whether this loop should be optimized for size based on profile guided size</span></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optimizatios.</span></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a93a8f97a1e57c3bce2e7c3473d592c01"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a93a8f97a1e57c3bce2e7c3473d592c01">OptForSizeBasedOnProfile</a>;</span></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><span class="doxyHighlightComment">  /// Structure to hold information about generated runtime checks, responsible</span></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><span class="doxyHighlightComment">  /// for cleaning the checks, if vectorization turns out unprofitable.</span></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#ae9880a8edd20b3b9b1527ecd5a03ac8c"><span class="doxyHighlight">  GeneratedRTChecks &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#ae9880a8edd20b3b9b1527ecd5a03ac8c">RTChecks</a>;</span></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><span class="doxyHighlightComment">  /// Mapping of induction phis to their additional bypass values. They</span></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><span class="doxyHighlightComment">  /// need to be added as operands to phi nodes in the scalar loop preheader</span></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><span class="doxyHighlightComment">  /// after the epilogue skeleton has been created.</span></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a48c4aed6852a39d4dcc584ac75cc1055"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;PHINode &#42;, Value &#42;&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a48c4aed6852a39d4dcc584ac75cc1055">Induction2AdditionalBypassValue</a>;</span></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><span class="doxyHighlightComment">  /// The additional bypass block which conditionally skips over the epilogue</span></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><span class="doxyHighlightComment">  /// loop after executing the main loop. Needed to resume inductions and</span></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><span class="doxyHighlightComment">  /// reductions during epilogue vectorization.</span></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a329ce2a6185c5e632406d1d2fc75610e"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a329ce2a6185c5e632406d1d2fc75610e">AdditionalBypassBlock</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>;</span></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><span class="doxyHighlightComment">  /// The vector preheader block of \\p Plan, used as target for check blocks</span></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><span class="doxyHighlightComment">  /// introduced during skeleton creation.</span></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a6b18db1093ed5460e67e9058b89e385b"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a6b18db1093ed5460e67e9058b89e385b">VectorPHVPB</a>;</span></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><span class="doxyHighlightComment">/// Encapsulate information regarding vectorization of a loop and its epilogue.</span></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><span class="doxyHighlightComment">/// This information is meant to be updated and used across two stages of</span></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><span class="doxyHighlightComment">/// epilogue vectorization.</span></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d7d09b3f7c32cf03cf05ee57020ad4f">EpilogueLoopVectorizationInfo</a> &#123;</span></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d536d11651c11a778ea9fe9332a4a2e"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d536d11651c11a778ea9fe9332a4a2e">MainLoopVF</a> = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(0);</span></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a18939d452d993dd7ddd465c5c11535a4"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a18939d452d993dd7ddd465c5c11535a4">MainLoopUF</a> = 0;</span></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a529385ab333b24f1f2c2dd8525ad52a8"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a529385ab333b24f1f2c2dd8525ad52a8">EpilogueVF</a> = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(0);</span></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6ec74a5afe1cfb93444b9f8988ed4c12"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6ec74a5afe1cfb93444b9f8988ed4c12">EpilogueUF</a> = 0;</span></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a854358d393ec8943df9757b4e5e6c388"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a854358d393ec8943df9757b4e5e6c388">MainLoopIterationCountCheck</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#af7e8a35e9864ca6848ceeac1a326df93"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#af7e8a35e9864ca6848ceeac1a326df93">EpilogueIterationCountCheck</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a33f0a5678a72641d093734ca31ec43d2"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a33f0a5678a72641d093734ca31ec43d2">SCEVSafetyCheck</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a74facc922f5c9b96ee958fff171c02cf"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a74facc922f5c9b96ee958fff171c02cf">MemSafetyCheck</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a20f8969b812a491714c8181ff736e000"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a20f8969b812a491714c8181ff736e000">TripCount</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a63a7b18fae2eec1be9b81d461dc7ebe8"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a63a7b18fae2eec1be9b81d461dc7ebe8">VectorTripCount</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#af0f96a1e05dadf7e03047494b47be046"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#af0f96a1e05dadf7e03047494b47be046">EpiloguePlan</a>;</span></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d7d09b3f7c32cf03cf05ee57020ad4f"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d7d09b3f7c32cf03cf05ee57020ad4f">EpilogueLoopVectorizationInfo</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MVF, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MUF,</span></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> EVF, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EUF,</span></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#af0f96a1e05dadf7e03047494b47be046">EpiloguePlan</a>)</span></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><span class="doxyHighlight">      : <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d536d11651c11a778ea9fe9332a4a2e">MainLoopVF</a>(MVF), <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a18939d452d993dd7ddd465c5c11535a4">MainLoopUF</a>(MUF), <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a529385ab333b24f1f2c2dd8525ad52a8">EpilogueVF</a>(EVF), <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6ec74a5afe1cfb93444b9f8988ed4c12">EpilogueUF</a>(EUF),</span></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><span class="doxyHighlight">        <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#af0f96a1e05dadf7e03047494b47be046">EpiloguePlan</a>(<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#af0f96a1e05dadf7e03047494b47be046">EpiloguePlan</a>) &#123;</span></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EUF == 1 &amp;&amp;</span></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;A high UF for the epilogue loop is likely not beneficial.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><span class="doxyHighlightComment">/// An extension of the inner loop vectorizer that creates a skeleton for a</span></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><span class="doxyHighlightComment">/// vectorized loop that has its epilogue (residual) also vectorized.</span></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><span class="doxyHighlightComment">/// The idea is to run the vplan on a given loop twice, firstly to setup the</span></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><span class="doxyHighlightComment">/// skeleton and vectorize the main loop, and secondly to complete the skeleton</span></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><span class="doxyHighlightComment">/// from the first step and vectorize the epilogue.  This is achieved by</span></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><span class="doxyHighlightComment">/// deriving two concrete strategy classes from this base class and invoking</span></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><span class="doxyHighlightComment">/// them in succession from the loop vectorizer planner.</span></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719" lineLink="/docs/api/classes/llvm/innerloopandepiloguevectorizer"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a0a9465c209525e66b0e00ff32fe4495d">InnerLoopAndEpilogueVectorizer</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6c7095217b0d803a65548373bd4db3cf">InnerLoopVectorizer</a> &#123;</span></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721" lineLink="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a0a9465c209525e66b0e00ff32fe4495d"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a0a9465c209525e66b0e00ff32fe4495d">InnerLoopAndEpilogueVectorizer</a>(</span></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>,</span></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>,</span></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a238e95d82d095fec9241f2f5b81db3c5">TTI</a>, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>,</span></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>, <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a> &amp;<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>,</span></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;LVL, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">llvm::LoopVectorizationCostModel</a> &#42;CM,</span></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>,</span></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><span class="doxyHighlight">      GeneratedRTChecks &amp;Checks, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>)</span></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><span class="doxyHighlight">      : <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6c7095217b0d803a65548373bd4db3cf">InnerLoopVectorizer</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a238e95d82d095fec9241f2f5b81db3c5">TTI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>,</span></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopVF, <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopVF, <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopUF, LVL,</span></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><span class="doxyHighlight">                            CM, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>, Checks, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>),</span></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>) &#123;&#125;</span></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Override this function to handle the more complex control flow around the</span></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// three loops.</span></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737" lineLink="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a513e6b49c17c28104aab6dc635ce86b3"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a513e6b49c17c28104aab6dc635ce86b3">createVectorizedLoopSkeleton</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV2ValueTy &amp;ExpandedSCEVs) </span><span class="doxyHighlightKeyword">final</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a89ba81e424489963bac21757a4687fe7">createEpilogueVectorizedLoopSkeleton</a>(ExpandedSCEVs);</span></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><span class="doxyHighlightComment">  /// The interface for creating a vectorized skeleton using one of two</span></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><span class="doxyHighlightComment">  /// different strategies, each corresponding to one execution of the vplan</span></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><span class="doxyHighlightComment">  /// as described above.</span></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">virtual</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745" lineLink="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a89ba81e424489963bac21757a4687fe7"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a89ba81e424489963bac21757a4687fe7">createEpilogueVectorizedLoopSkeleton</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV2ValueTy &amp;ExpandedSCEVs) = 0;</span></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><span class="doxyHighlightComment">  /// Holds and updates state information required to vectorize the main loop</span></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><span class="doxyHighlightComment">  /// and its epilogue in two separate passes. This setup helps us avoid</span></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><span class="doxyHighlightComment">  /// regenerating and recomputing runtime safety checks. It also helps us to</span></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><span class="doxyHighlightComment">  /// shorten the iteration-count-check path length for the cases where the</span></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><span class="doxyHighlightComment">  /// iteration count of the loop is so small that the main vector loop is</span></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><span class="doxyHighlightComment">  /// completely skipped.</span></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753" lineLink="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a> &amp;<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>;</span></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><span class="doxyHighlightComment">/// A specialized derived class of inner loop vectorizer that performs</span></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><span class="doxyHighlightComment">/// vectorization of &#42;main&#42; loops in the process of vectorizing loops and their</span></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><span class="doxyHighlightComment">/// epilogues.</span></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759" lineLink="/docs/api/classes/llvm/epiloguevectorizermainloop"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aacb166cc55976b03684f0d3671cf1179">EpilogueVectorizerMainLoop</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a0a9465c209525e66b0e00ff32fe4495d">InnerLoopAndEpilogueVectorizer</a> &#123;</span></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761" lineLink="/docs/api/classes/llvm/epiloguevectorizermainloop/#aacb166cc55976b03684f0d3671cf1179"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aacb166cc55976b03684f0d3671cf1179">EpilogueVectorizerMainLoop</a>(</span></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>,</span></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>,</span></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>,</span></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>, <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a> &amp;<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>,</span></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;LVL, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">llvm::LoopVectorizationCostModel</a> &#42;CM,</span></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>,</span></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><span class="doxyHighlight">      GeneratedRTChecks &amp;<a href="/docs/api/namespaces/llvm/check">Check</a>, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>)</span></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><span class="doxyHighlight">      : <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a0a9465c209525e66b0e00ff32fe4495d">InnerLoopAndEpilogueVectorizer</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>,</span></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>, LVL, CM, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>, <a href="/docs/api/namespaces/llvm/check">Check</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>) &#123;&#125;</span></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><span class="doxyHighlightComment">  /// Implements the interface for creating a vectorized skeleton using the</span></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><span class="doxyHighlightComment">  /// &#42;main loop&#42; strategy (ie the first pass of vplan execution).</span></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aa8b67f13fbf902634ecd95060a1cd85f">createEpilogueVectorizedLoopSkeleton</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV2ValueTy &amp;ExpandedSCEVs) </span><span class="doxyHighlightKeyword">final</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><span class="doxyHighlightKeyword">protected</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><span class="doxyHighlightComment">  /// Emits an iteration count bypass check once for the main loop (when \\p</span></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><span class="doxyHighlightComment">  /// ForEpilogue is false) and once for the epilogue loop (when \\p</span></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><span class="doxyHighlightComment">  /// ForEpilogue is true).</span></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aeeb47f904372b9e25b9f7ba606158b25">emitIterationCountCheck</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ForEpilogue);</span></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aad9eb57dcbd9a2c3fd1993685783d7f7">printDebugTracesAtStart</a>() </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#a87a0c8bda4e9e23e896e46d0a2208c17">printDebugTracesAtEnd</a>() </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><span class="doxyHighlightComment">// A specialized derived class of inner loop vectorizer that performs</span></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><span class="doxyHighlightComment">// vectorization of &#42;epilogue&#42; loops in the process of vectorizing loops and</span></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><span class="doxyHighlightComment">// their epilogues.</span></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788" lineLink="/docs/api/classes/llvm/epiloguevectorizerepilogueloop"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a2e73500e74115783c3ab0282829aee26">EpilogueVectorizerEpilogueLoop</a> : </span><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a0a9465c209525e66b0e00ff32fe4495d">InnerLoopAndEpilogueVectorizer</a> &#123;</span></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790" lineLink="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a2e73500e74115783c3ab0282829aee26"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a2e73500e74115783c3ab0282829aee26">EpilogueVectorizerEpilogueLoop</a>(</span></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>,</span></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>,</span></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>,</span></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>, <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a> &amp;<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>,</span></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;LVL, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">llvm::LoopVectorizationCostModel</a> &#42;CM,</span></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>,</span></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><span class="doxyHighlight">      GeneratedRTChecks &amp;Checks, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>)</span></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><span class="doxyHighlight">      : <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a0a9465c209525e66b0e00ff32fe4495d">InnerLoopAndEpilogueVectorizer</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>,</span></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>, LVL, CM, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>, Checks, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>) &#123;</span></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0937fe0c707a3cd1198cea4467fa37c0">TripCount</a> = <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.TripCount;</span></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><span class="doxyHighlightComment">  /// Implements the interface for creating a vectorized skeleton using the</span></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><span class="doxyHighlightComment">  /// &#42;epilogue loop&#42; strategy (ie the second pass of vplan execution).</span></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#ad1b4c0caba0fac3a1486890cd2445040">createEpilogueVectorizedLoopSkeleton</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV2ValueTy &amp;ExpandedSCEVs) </span><span class="doxyHighlightKeyword">final</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><span class="doxyHighlightKeyword">protected</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><span class="doxyHighlightComment">  /// Emits an iteration count bypass check after the main vector loop has</span></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><span class="doxyHighlightComment">  /// finished to see if there are any iterations left to execute by either</span></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><span class="doxyHighlightComment">  /// the vector epilogue or the scalar epilogue.</span></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a04c0081718b0f5113134aa563e1a56ca">emitMinimumVectorEpilogueIterCountCheck</a>(</span></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><span class="doxyHighlight">                                                      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass,</span></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><span class="doxyHighlight">                                                      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Insert);</span></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a9d4052b05414daf596711bada5c5e94b">printDebugTracesAtStart</a>() </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a07454ac2b11a89ba60771243779a58e4">printDebugTracesAtEnd</a>() </span><span class="doxyHighlightKeyword">override</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end namespace llvm</span></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><span class="doxyHighlightComment">/// Look for a meaningful debug location on the instruction or its operands.</span></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820" lineLink="#a29c708de8e758ac420523c94c797b501"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="#a29c708de8e758ac420523c94c797b501">getDebugLocFromInstOrOperands</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>();</span></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/codeview/typehashing-cpp/#a066f917f4a73ce07260b0e4262be92ba">Empty</a>;</span></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc() != <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/codeview/typehashing-cpp/#a066f917f4a73ce07260b0e4262be92ba">Empty</a>)</span></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc();</span></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands()) &#123;</span></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OpInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</span></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OpInst-&gt;getDebugLoc() != <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/codeview/typehashing-cpp/#a066f917f4a73ce07260b0e4262be92ba">Empty</a>)</span></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OpInst-&gt;getDebugLoc();</span></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc();</span></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><span class="doxyHighlightComment">/// Write a \\p DebugMsg about vectorization to the debug output stream. If \\p I</span></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><span class="doxyHighlightComment">/// is passed, the message relates to that particular instruction.</span></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840" lineLink="#a1a861c376095fff2ee736b0a743cc44e"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a1a861c376095fff2ee736b0a743cc44e">debugVectorizationMessage</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> Prefix,</span></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> DebugMsg,</span></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: &quot;</span><span class="doxyHighlight"> &lt;&lt; Prefix &lt;&lt; DebugMsg;</span></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;.&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><span class="doxyHighlightComment">/// Create an analysis remark that explains why vectorization failed</span></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><span class="doxyHighlightComment">/// \\p PassName is the name of the pass (e.g. can be AlwaysPrint).  \\p</span></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><span class="doxyHighlightComment">/// RemarkName is the identifier for the remark.  If \\p I is passed it is an</span></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><span class="doxyHighlightComment">/// instruction that prevents vectorization.  Otherwise \\p TheLoop is used for</span></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><span class="doxyHighlightComment">/// the location of the remark. If \\p DL is passed, use it as debug location for</span></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><span class="doxyHighlightComment">/// the remark. \\return the remark object that can be streamed to.</span></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a></span></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860" lineLink="#afec6951f3043e25ada2b61437bd60725"><span class="doxyHighlight"><a href="#afec6951f3043e25ada2b61437bd60725">createLVAnalysis</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86loweramxintrinsics-cpp/#adb9257105a403ef9d0773b87693f7779">PassName</a>, <a href="/docs/api/classes/llvm/stringref">StringRef</a> RemarkName, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;TheLoop,</span></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = &#123;&#125;) &#123;</span></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CodeRegion = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> ? <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() : TheLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>();</span></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If debug location is attached to the instruction, use it. Otherwise if DL</span></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// was not provided, use the loop&#39;s.</span></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc())</span></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc();</span></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)</span></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = TheLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a615131659002c10601eef598d42d025e">getStartLoc</a>();</span></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86loweramxintrinsics-cpp/#adb9257105a403ef9d0773b87693f7779">PassName</a>, RemarkName, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CodeRegion);</span></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</span></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><span class="doxyHighlightComment">/// Return a value for Step multiplied by VF.</span></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876" lineLink="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e">createStepForVF</a>(<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF,</span></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><span class="doxyHighlight">                       int64&#95;t Step) &#123;</span></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ty-&gt;isIntegerTy() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected an integer step&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateElementCount(Ty, VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#aa5b3e822013fe51665e9bddc4874cd48">multiplyCoefficientBy</a>(Step));</span></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><span class="doxyHighlightComment">/// Return the runtime value for VF.</span></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883" lineLink="/docs/api/namespaces/llvm/#a2f777e2b1044ba7971766097fdd56579"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a2f777e2b1044ba7971766097fdd56579">getRuntimeVF</a>(<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateElementCount(Ty, VF);</span></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887" lineLink="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> DebugMsg,</span></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> OREMsg, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> ORETag,</span></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;TheLoop,</span></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="#a1a861c376095fff2ee736b0a743cc44e">debugVectorizationMessage</a>(</span><span class="doxyHighlightStringLiteral">&quot;Not vectorizing: &quot;</span><span class="doxyHighlight">, DebugMsg, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> Hints(TheLoop, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42; doesn&#39;t matter &#42;/</span><span class="doxyHighlight">, &#42;ORE);</span></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><span class="doxyHighlight">  ORE-&gt;<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(</span></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><span class="doxyHighlight">      <a href="#afec6951f3043e25ada2b61437bd60725">createLVAnalysis</a>(Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#abcf8c2b35316773f1ab0ba70aeb2a6de">vectorizeAnalysisPassName</a>(), ORETag, TheLoop, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><span class="doxyHighlight">      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;loop not vectorized: &quot;</span><span class="doxyHighlight"> &lt;&lt; OREMsg);</span></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><span class="doxyHighlightComment">/// Reports an informative message: print \\p Msg for debugging purposes as well</span></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><span class="doxyHighlightComment">/// as an optimization remark. Uses either \\p I as location of the remark, or</span></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><span class="doxyHighlightComment">/// otherwise \\p TheLoop. If \\p DL is passed, use it as debug location for the</span></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><span class="doxyHighlightComment">/// remark. If \\p DL is passed, use it as debug location for the remark.</span></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902" lineLink="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> Msg, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> ORETag,</span></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE,</span></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;TheLoop, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = &#123;&#125;) &#123;</span></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="#a1a861c376095fff2ee736b0a743cc44e">debugVectorizationMessage</a>(</span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, Msg, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> Hints(TheLoop, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42; doesn&#39;t matter &#42;/</span><span class="doxyHighlight">, &#42;ORE);</span></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><span class="doxyHighlight">  ORE-&gt;<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(<a href="#afec6951f3043e25ada2b61437bd60725">createLVAnalysis</a>(Hints.vectorizeAnalysisPassName(), ORETag, TheLoop,</span></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><span class="doxyHighlight">                             <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)</span></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><span class="doxyHighlight">            &lt;&lt; Msg);</span></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><span class="doxyHighlightComment">/// Report successful vectorization of the loop. In case an outer loop is</span></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><span class="doxyHighlightComment">/// vectorized, prepend &quot;outer&quot; to the vectorization remark.</span></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915" lineLink="/docs/api/namespaces/llvm/#a0c19b37908311872f655348755e8d003"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a0c19b37908311872f655348755e8d003">reportVectorization</a>(<a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;TheLoop,</span></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><span class="doxyHighlight">                                <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> VF, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IC) &#123;</span></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="#a1a861c376095fff2ee736b0a743cc44e">debugVectorizationMessage</a>(</span></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;Vectorizing: &quot;</span><span class="doxyHighlight">, TheLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a16165c1e5da45acaa086c3a54a188d34">isInnermost</a>() ? </span><span class="doxyHighlightStringLiteral">&quot;innermost loop&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;outer loop&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> LoopType = TheLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a16165c1e5da45acaa086c3a54a188d34">isInnermost</a>() ? </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;outer &quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><span class="doxyHighlight">  ORE-&gt;<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremark">OptimizationRemark</a>(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>, </span><span class="doxyHighlightStringLiteral">&quot;Vectorized&quot;</span><span class="doxyHighlight">, TheLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a615131659002c10601eef598d42d025e">getStartLoc</a>(),</span></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><span class="doxyHighlight">                              TheLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>())</span></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;vectorized &quot;</span><span class="doxyHighlight"> &lt;&lt; LoopType &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;loop (vectorization width: &quot;</span></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><span class="doxyHighlight">           &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;VectorizationFactor&quot;</span><span class="doxyHighlight">, VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>)</span></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, interleaved count: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;InterleaveCount&quot;</span><span class="doxyHighlight">, IC) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;)&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end namespace llvm</span></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</span></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><span class="doxyHighlightComment">// Loop vectorization cost-model hints how the scalar epilogue loop should be</span></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><span class="doxyHighlightComment">// lowered.</span></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936" lineLink="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d"><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> &#123;</span></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The default: allowing scalar epilogues.</span></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939" lineLink="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>,</span></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Vectorization with OptForSize: don&#39;t allow epilogues.</span></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942" lineLink="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da4f61afe29426363c5cf62d4ee93199b7"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da4f61afe29426363c5cf62d4ee93199b7">CM&#95;ScalarEpilogueNotAllowedOptSize</a>,</span></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A special case of vectorisation with OptForSize: loops with a very small</span></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// trip count are considered for vectorization under OptForSize, thereby</span></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// making sure the cost of their loop body is dominant, free of runtime</span></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// guards and scalar iteration overheads.</span></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948" lineLink="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da0a5c3a3ea2de39aa77f3e6da8de4d5bd"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da0a5c3a3ea2de39aa77f3e6da8de4d5bd">CM&#95;ScalarEpilogueNotAllowedLowTripLoop</a>,</span></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Loop hint predicate indicating an epilogue is undesired.</span></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951" lineLink="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>,</span></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Directive indicating we must either tail fold or not vectorize</span></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954" lineLink="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9dab8edd8f39c728bd8b0045b64768ef206"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9dab8edd8f39c728bd8b0045b64768ef206">CM&#95;ScalarEpilogueNotAllowedUsePredicate</a></span></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957" lineLink="/docs/api/namespaces/llvm/#a9e0841f36570b2d07c1c1d7b3e059dad"><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/#a9e0841f36570b2d07c1c1d7b3e059dad">InstructionVFPair</a> = std::pair&lt;Instruction &#42;, ElementCount&gt;;</span></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><span class="doxyHighlightComment">/// LoopVectorizationCostModel - estimates the expected speedups due to</span></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><span class="doxyHighlightComment">/// vectorization.</span></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><span class="doxyHighlightComment">/// In many cases vectorization is not profitable. This can happen because of</span></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><span class="doxyHighlightComment">/// a number of reasons. In this class we mainly attempt to predict the</span></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><span class="doxyHighlightComment">/// expected speedup/slowdowns due to the supported instruction set. We use the</span></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><span class="doxyHighlightComment">/// TargetTransformInfo to query the different backends for the cost of</span></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><span class="doxyHighlightComment">/// different operations.</span></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a405e73f32c9044b8b14648b62cb2ef30">LoopVectorizationCostModel</a> &#123;</span></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a409249e01d3e65716e4c76fa3369a4e0"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">friend</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a409249e01d3e65716e4c76fa3369a4e0">LoopVectorizationPlanner</a>;</span></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a405e73f32c9044b8b14648b62cb2ef30"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a405e73f32c9044b8b14648b62cb2ef30">LoopVectorizationCostModel</a>(<a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> </span><span class="doxyHighlightKeywordType">SEL</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</span></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a>,</span></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>,</span></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><span class="doxyHighlight">                             </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>,</span></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><span class="doxyHighlight">                             </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>, <a href="/docs/api/classes/llvm/demandedbits">DemandedBits</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a58fd764accfd06df487cc6ec43d4f5fc">DB</a>,</span></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aba357162dc28acb3a399731e1e397614">AC</a>,</span></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><span class="doxyHighlight">                             </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35e67974daa692cfd961904c151ad33d">Hints</a>,</span></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/interleavedaccessinfo">InterleavedAccessInfo</a> &amp;IAI)</span></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><span class="doxyHighlight">      : ScalarEpilogueStatus(SEL), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>(L), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>),</span></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a58fd764accfd06df487cc6ec43d4f5fc">DB</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a58fd764accfd06df487cc6ec43d4f5fc">DB</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aba357162dc28acb3a399731e1e397614">AC</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aba357162dc28acb3a399731e1e397614">AC</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>),</span></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35e67974daa692cfd961904c151ad33d">Hints</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35e67974daa692cfd961904c151ad33d">Hints</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7a98f0c17229446d76997f158d896aad">InterleaveInfo</a>(IAI), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>::TCK&#95;RecipThroughput) &#123;&#125;</span></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><span class="doxyHighlightComment">  /// \\return An upper bound for the vectorization factors (both fixed and</span></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><span class="doxyHighlightComment">  /// scalable). If the factors are 0, vectorization and interleaving should be</span></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><span class="doxyHighlightComment">  /// avoided up front.</span></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/fixedscalablevfpair">FixedScalableVFPair</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a65ab4267c6c132d06451b5d97bc9ee83">computeMaxVF</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> UserIC);</span></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><span class="doxyHighlightComment">  /// \\return True if runtime checks are required for vectorization, and false</span></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><span class="doxyHighlightComment">  /// otherwise.</span></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aad6239ca8b51657f5ebdbd6e51e6ea90">runtimeChecksRequired</a>();</span></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><span class="doxyHighlightComment">  /// Setup cost-based decisions for user vectorization factor.</span></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><span class="doxyHighlightComment">  /// \\return true if the UserVF is a feasible VF to be chosen.</span></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a885ad9ea73b97e3154433e5c37fefa99"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a885ad9ea73b97e3154433e5c37fefa99">selectUserVectorizationFactor</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF) &#123;</span></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab4a3f06ac8f2aff57b864c2d8ace97d8">collectUniformsAndScalars</a>(UserVF);</span></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#afcbf4a19be078644e784b539379d59b7">collectInstsToScalarize</a>(UserVF);</span></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae4c50e6300599d50ba706c0d2b780502">expectedCost</a>(UserVF).<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>();</span></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><span class="doxyHighlightComment">  /// \\return The size (in bits) of the smallest and widest types in the code</span></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><span class="doxyHighlightComment">  /// that needs to be vectorized. We ignore values that remain scalar such as</span></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><span class="doxyHighlightComment">  /// 64 bit loop indices.</span></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><span class="doxyHighlight">  std::pair&lt;unsigned, unsigned&gt; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a1fa63b37ad2ac06f289e9962a3703e9e">getSmallestAndWidestTypes</a>();</span></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><span class="doxyHighlightComment">  /// \\return The desired interleave count.</span></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><span class="doxyHighlightComment">  /// If interleave count has been specified by metadata it will be returned.</span></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><span class="doxyHighlightComment">  /// Otherwise, the interleave count is computed and returned. VF and LoopCost</span></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><span class="doxyHighlightComment">  /// are the selected vectorization factor and the cost of the selected VF.</span></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af9f62350ccdebd24858be552f3fc051c">selectInterleaveCount</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> LoopCost);</span></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><span class="doxyHighlightComment">  /// Memory access instruction may be vectorized in more than one way.</span></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><span class="doxyHighlightComment">  /// Form of instruction after vectorization depends on cost.</span></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><span class="doxyHighlightComment">  /// This function takes cost-based decisions for Load/Store instructions</span></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><span class="doxyHighlightComment">  /// and collects them in a map. This decisions map is used for building</span></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><span class="doxyHighlightComment">  /// the lists of loop-uniform and loop-scalar instructions.</span></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><span class="doxyHighlightComment">  /// The calculated cost is saved with widening decision in order to</span></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><span class="doxyHighlightComment">  /// avoid redundant calculations.</span></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae8d11752355845a0e271111de7be7d3a">setCostBasedWideningDecision</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><span class="doxyHighlightComment">  /// A call may be vectorized in different ways depending on whether we have</span></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><span class="doxyHighlightComment">  /// vectorized variants available and whether the target supports masking.</span></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><span class="doxyHighlightComment">  /// This function analyzes all calls in the function at the supplied VF,</span></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><span class="doxyHighlightComment">  /// makes a decision based on the costs of available options, and stores that</span></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><span class="doxyHighlightComment">  /// decision in a map for use in planning and plan execution.</span></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8178cc5e49d5251d7ca3413b8a434f8f">setVectorizedCallDecision</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><span class="doxyHighlightComment">  /// A struct that represents some properties of the register usage</span></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><span class="doxyHighlightComment">  /// of a loop.</span></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage">RegisterUsage</a> &#123;</span></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><span class="doxyHighlightComment">    /// Holds the number of loop invariant values that are used in the loop.</span></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><span class="doxyHighlightComment">    /// The key is ClassID of target-provided register class.</span></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage/#a12f1d225b87b9cb583e78478d9ef3b9c"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/smallmapvector">SmallMapVector&lt;unsigned, unsigned, 4&gt;</a> <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage/#a12f1d225b87b9cb583e78478d9ef3b9c">LoopInvariantRegs</a>;</span></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><span class="doxyHighlightComment">    /// Holds the maximum number of concurrent live intervals in the loop.</span></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><span class="doxyHighlightComment">    /// The key is ClassID of target-provided register class.</span></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage/#a0ae3b197ca92417681a2865b605e56a9"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/smallmapvector">SmallMapVector&lt;unsigned, unsigned, 4&gt;</a> <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage/#a0ae3b197ca92417681a2865b605e56a9">MaxLocalUsers</a>;</span></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><span class="doxyHighlightComment">  /// \\return Returns information about the register usages of the loop for the</span></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><span class="doxyHighlightComment">  /// given vectorization factors.</span></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;RegisterUsage, 8&gt;</a></span></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91466f7a82e967ed765e6d876415a3b7">calculateRegisterUsage</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ElementCount&gt;</a> VFs);</span></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><span class="doxyHighlightComment">  /// Collect values we want to ignore in the cost model.</span></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0ac5df8f0304981180d602dacb13512c">collectValuesToIgnore</a>();</span></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><span class="doxyHighlightComment">  /// Collect all element types in the loop for which widening is needed.</span></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a06f5d9725a2b1f7b06e8bf51f7d31417">collectElementTypesForWidening</a>();</span></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><span class="doxyHighlightComment">  /// Split reductions into those that happen in the loop, and those that happen</span></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><span class="doxyHighlightComment">  /// outside. In loop reductions are collected into InLoopReductions.</span></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a12d2850f420726c4acb262b626e95b7d">collectInLoopReductions</a>();</span></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><span class="doxyHighlightComment">  /// Returns true if we should use strict in-order reductions for the given</span></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><span class="doxyHighlightComment">  /// RdxDesc. This is true if the -enable-strict-reductions flag is passed,</span></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><span class="doxyHighlightComment">  /// the IsOrdered flag of RdxDesc is set and we do not allow reordering</span></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><span class="doxyHighlightComment">  /// of FP operations.</span></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad508b8cfa31c0e7a1ac8f9d733bb8eed"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad508b8cfa31c0e7a1ac8f9d733bb8eed">useOrderedReductions</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35e67974daa692cfd961904c151ad33d">Hints</a>-&gt;allowReordering() &amp;&amp; RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a8dad5abc2bd929acd8391643b2dbe4c5">isOrdered</a>();</span></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><span class="doxyHighlightComment">  /// \\returns The smallest bitwidth each instruction can be represented with.</span></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><span class="doxyHighlightComment">  /// The vector equivalents of these instructions should be truncated to this</span></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><span class="doxyHighlightComment">  /// type.</span></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9fe7595d60ab8e1f3ee1da0846838113"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;Instruction &#42;, uint64&#95;t&gt;</a> &amp;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9fe7595d60ab8e1f3ee1da0846838113">getMinimalBitwidths</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MinBWs;</span></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><span class="doxyHighlightComment">  /// \\returns True if it is more profitable to scalarize instruction \\p I for</span></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><span class="doxyHighlightComment">  /// vectorization factor \\p VF.</span></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9a6fbca8c965adeb8016a03ca3de2cac"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9a6fbca8c965adeb8016a03ca3de2cac">isProfitableToScalarize</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp;</span></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Profitable to scalarize relevant only for VF &gt; 1.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isInnermost() &amp;&amp;</span></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;cost-model should not be used for outer loops (in VPlan-native path)&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Scalars = InstsToScalarize.find(VF);</span></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Scalars != InstsToScalarize.end() &amp;&amp;</span></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;VF not yet analyzed for scalarization profitability&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Scalars-&gt;second.contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><span class="doxyHighlightComment">  /// Returns true if \\p I is known to be uniform after vectorization.</span></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a20d7c96738b8f59692aec029895f8eb9"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a20d7c96738b8f59692aec029895f8eb9">isUniformAfterVectorization</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isInnermost() &amp;&amp;</span></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;cost-model should not be used for outer loops (in VPlan-native path)&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Pseudo probe needs to be duplicated for each unrolled iteration and</span></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// vector lane so that profiled loop trip count can be accurately</span></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// accumulated instead of being under counted.</span></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PseudoProbeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</span></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> UniformsPerVF = Uniforms.find(VF);</span></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UniformsPerVF != Uniforms.end() &amp;&amp;</span></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;VF not yet analyzed for uniformity&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> UniformsPerVF-&gt;second.count(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><span class="doxyHighlightComment">  /// Returns true if \\p I is known to be scalar after vectorization.</span></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isInnermost() &amp;&amp;</span></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;cost-model should not be used for outer loops (in VPlan-native path)&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</span></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ScalarsPerVF = Scalars.find(VF);</span></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ScalarsPerVF != Scalars.end() &amp;&amp;</span></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Scalar values are not calculated for VF&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ScalarsPerVF-&gt;second.count(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><span class="doxyHighlightComment">  /// \\returns True if instruction \\p I can be truncated to a smaller bitwidth</span></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><span class="doxyHighlightComment">  /// for vectorization factor \\p VF.</span></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa8c00664c6be2042407f13e4fcad950b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa8c00664c6be2042407f13e4fcad950b">canTruncateToMinimalBitwidth</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; MinBWs.contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><span class="doxyHighlight">           !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9a6fbca8c965adeb8016a03ca3de2cac">isProfitableToScalarize</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) &amp;&amp;</span></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><span class="doxyHighlight">           !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><span class="doxyHighlightComment">  /// Decision that was taken during cost calculation for memory instruction.</span></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">enum</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> &#123;</span></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">CM&#95;Unknown</a>,</span></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260adc468760c02910f77bad7525bc66c334"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260adc468760c02910f77bad7525bc66c334">CM&#95;Widen</a>,         </span><span class="doxyHighlightComment">// For consecutive accesses with stride 1</span></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a058eacbd3c28e2ecec2af7db726ce527"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a058eacbd3c28e2ecec2af7db726ce527">CM&#95;Widen&#95;Reverse</a>, </span><span class="doxyHighlightComment">// For consecutive accesses with stride -1</span></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971">CM&#95;Interleave</a>,</span></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ae849d400780f51424bc4e4c26ddf3000"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ae849d400780f51424bc4e4c26ddf3000">CM&#95;GatherScatter</a>,</span></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>,</span></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ab6fd5f45ab6e363de6c3f42472d439ac"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ab6fd5f45ab6e363de6c3f42472d439ac">CM&#95;VectorCall</a>,</span></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a679b46cebdf2f87b9efd0413c960314a"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a679b46cebdf2f87b9efd0413c960314a">CM&#95;IntrinsicCall</a></span></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><span class="doxyHighlightComment">  /// Save vectorization decision \\p W and \\p Cost taken by the cost model for</span></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><span class="doxyHighlightComment">  /// instruction \\p I and vector width \\p VF.</span></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> W,</span></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>) &#123;</span></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected VF &gt;=2&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><span class="doxyHighlight">    WideningDecisions&#91;std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)&#93; = std::make&#95;pair(W, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>);</span></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><span class="doxyHighlightComment">  /// Save vectorization decision \\p W and \\p Cost taken by the cost model for</span></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><span class="doxyHighlightComment">  /// interleaving group \\p Grp and vector width \\p VF.</span></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9c44a42299ed9e7e97200271b00e0c7a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9c44a42299ed9e7e97200271b00e0c7a">setWideningDecision</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/interleavegroup">InterleaveGroup&lt;Instruction&gt;</a> &#42;Grp,</span></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> W,</span></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>) &#123;</span></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected VF &gt;=2&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><span class="doxyHighlightComment">    /// Broadcast this decicion to all instructions inside the group.</span></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><span class="doxyHighlightComment">    /// When interleaving, the cost will only be assigned one instruction, the</span></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><span class="doxyHighlightComment">    /// insert position. For other cases, add the appropriate fraction of the</span></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><span class="doxyHighlightComment">    /// total cost to each instruction. This ensures accurate costs are used,</span></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><span class="doxyHighlightComment">    /// even if the insert position instruction is not used.</span></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> InsertPosCost = <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</span></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> OtherMemberCost = 0;</span></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (W != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971">CM&#95;Interleave</a>)</span></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><span class="doxyHighlight">      OtherMemberCost = InsertPosCost = <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> / Grp-&gt;<a href="/docs/api/classes/llvm/interleavegroup/#af81c826ee51addc3321e4ef1c1934696">getNumMembers</a>();</span></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><span class="doxyHighlight">    ;</span></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0; Idx &lt; Grp-&gt;<a href="/docs/api/classes/llvm/interleavegroup/#a46f3b431a3121fdf53608a283bf4efec">getFactor</a>(); ++Idx) &#123;</span></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Grp-&gt;<a href="/docs/api/classes/llvm/interleavegroup/#a5085afe1fa721f3ef5bf09ca7fc7537c">getMember</a>(Idx)) &#123;</span></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Grp-&gt;<a href="/docs/api/classes/llvm/interleavegroup/#a8ceaf9f0ed35c1a277261b29c97e4c95">getInsertPos</a>() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><span class="doxyHighlight">          WideningDecisions&#91;std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)&#93; =</span></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><span class="doxyHighlight">              std::make&#95;pair(W, InsertPosCost);</span></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><span class="doxyHighlight">          WideningDecisions&#91;std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)&#93; =</span></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><span class="doxyHighlight">              std::make&#95;pair(W, OtherMemberCost);</span></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><span class="doxyHighlightComment">  /// Return the cost model decision for the given instruction \\p I and vector</span></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><span class="doxyHighlightComment">  /// width \\p VF. Return CM&#95;Unknown if this instruction did not pass</span></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><span class="doxyHighlightComment">  /// through the cost modeling.</span></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected VF to be a vector VF&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isInnermost() &amp;&amp;</span></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;cost-model should not be used for outer loops (in VPlan-native path)&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><span class="doxyHighlight">    std::pair&lt;Instruction &#42;, ElementCount&gt; InstOnVF = std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Itr = WideningDecisions.find(InstOnVF);</span></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Itr == WideningDecisions.end())</span></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">CM&#95;Unknown</a>;</span></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Itr-&gt;second.first;</span></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><span class="doxyHighlightComment">  /// Return the vectorization cost for the given instruction \\p I and vector</span></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><span class="doxyHighlightComment">  /// width \\p VF.</span></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#af7844564539b9f0f917e8f2380a064b3"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af7844564539b9f0f917e8f2380a064b3">getWideningCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected VF &gt;=2&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><span class="doxyHighlight">    std::pair&lt;Instruction &#42;, ElementCount&gt; InstOnVF = std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(WideningDecisions.contains(InstOnVF) &amp;&amp;</span></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;The cost is not calculated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> WideningDecisions&#91;InstOnVF&#93;.second;</span></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision">CallWideningDecision</a> &#123;</span></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a970379530706280ef592e3e752195707"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a970379530706280ef592e3e752195707">Kind</a>;</span></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a7d0c66f91e19821438f6111292e4988a"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a7d0c66f91e19821438f6111292e4988a">Variant</a>;</span></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#af305adc2c4ab529c377feef10f4786ca"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#af305adc2c4ab529c377feef10f4786ca">IID</a>;</span></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#acf57054d7a0afa002650a5f94c4a7432"><span class="doxyHighlight">    std::optional&lt;unsigned&gt; <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#acf57054d7a0afa002650a5f94c4a7432">MaskPos</a>;</span></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a0e22ef86d37967eea1816774c457a516"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a0e22ef86d37967eea1816774c457a516">Cost</a>;</span></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8e5bf6d340d3b3f704b6398996ae51c"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8e5bf6d340d3b3f704b6398996ae51c">setCallWideningDecision</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> Kind,</span></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/function">Function</a> &#42;Variant, <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID,</span></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><span class="doxyHighlight">                               std::optional&lt;unsigned&gt; MaskPos,</span></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>) &#123;</span></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected vector VF&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><span class="doxyHighlight">    CallWideningDecisions&#91;std::make&#95;pair(CI, VF)&#93; = &#123;Kind, Variant, IID,</span></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><span class="doxyHighlight">                                                     MaskPos, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>&#125;;</span></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa29e19b06aa800d1289048b54c58e8c6"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision">CallWideningDecision</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa29e19b06aa800d1289048b54c58e8c6">getCallWideningDecision</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI,</span></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected vector VF&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CallWideningDecisions.at(std::make&#95;pair(CI, VF));</span></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><span class="doxyHighlightComment">  /// Return True if instruction \\p I is an optimizable truncate whose operand</span></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><span class="doxyHighlightComment">  /// is an induction variable. Such a truncate will be removed by adding a new</span></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><span class="doxyHighlightComment">  /// induction variable with the destination type.</span></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a61375f5189558cc261186f388d31fe92"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a61375f5189558cc261186f388d31fe92">isOptimizableIVTruncate</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the instruction is not a truncate, return false.</span></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Trunc = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;TruncInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Trunc)</span></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Get the source and destination types of the truncate.</span></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getSrcTy(), VF);</span></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getDestTy(), VF);</span></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the truncate is free for the given types, return false. Replacing a</span></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// free truncate with an induction variable would add an induction variable</span></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// update instruction to each iteration of the loop. We exclude from this</span></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// check the primary induction variable since it will need an update</span></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instruction regardless.</span></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = Trunc-&gt;getOperand(0);</span></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getPrimaryInduction() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isTruncateFree(SrcTy, DestTy))</span></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the truncated value is not an induction variable, return false.</span></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInductionPhi(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><span class="doxyHighlightComment">  /// Collects the instructions to scalarize for each predicated instruction in</span></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><span class="doxyHighlightComment">  /// the loop.</span></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#afcbf4a19be078644e784b539379d59b7">collectInstsToScalarize</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><span class="doxyHighlightComment">  /// Collect Uniform and Scalar values for the given \\p VF.</span></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><span class="doxyHighlightComment">  /// The sets depend on CM decision for Load/Store instructions</span></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><span class="doxyHighlightComment">  /// that may be vectorized as interleave, gather-scatter or scalarized.</span></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><span class="doxyHighlightComment">  /// Also make a decision on what to do about call instructions in the loop</span></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><span class="doxyHighlightComment">  /// at that VF -- scalarize, call a known vector routine, or call a</span></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><span class="doxyHighlightComment">  /// vector intrinsic.</span></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab4a3f06ac8f2aff57b864c2d8ace97d8"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab4a3f06ac8f2aff57b864c2d8ace97d8">collectUniformsAndScalars</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do the analysis once.</span></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || Uniforms.contains(VF))</span></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae8d11752355845a0e271111de7be7d3a">setCostBasedWideningDecision</a>(VF);</span></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><span class="doxyHighlight">    collectLoopUniforms(VF);</span></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8178cc5e49d5251d7ca3413b8a434f8f">setVectorizedCallDecision</a>(VF);</span></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><span class="doxyHighlight">    collectLoopScalars(VF);</span></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><span class="doxyHighlightComment">  /// Returns true if the target machine supports masked store operation</span></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><span class="doxyHighlightComment">  /// for the given \\p DataType and kind of access to \\p Ptr.</span></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c25146329f69e026508656cfb1280fa"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c25146329f69e026508656cfb1280fa">isLegalMaskedStore</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;DataType, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/structs/llvm/align">Align</a> Alignment)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isConsecutivePtr(DataType, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &amp;&amp;</span></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><span class="doxyHighlight">           <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedStore(DataType, Alignment);</span></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><span class="doxyHighlightComment">  /// Returns true if the target machine supports masked load operation</span></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><span class="doxyHighlightComment">  /// for the given \\p DataType and kind of access to \\p Ptr.</span></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a472c49074b0d81970f8eea07de4d7ad4"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a472c49074b0d81970f8eea07de4d7ad4">isLegalMaskedLoad</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;DataType, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/structs/llvm/align">Align</a> Alignment)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isConsecutivePtr(DataType, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &amp;&amp;</span></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><span class="doxyHighlight">           <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedLoad(DataType, Alignment);</span></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><span class="doxyHighlightComment">  /// Returns true if the target machine can represent \\p V as a masked gather</span></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><span class="doxyHighlightComment">  /// or scatter operation.</span></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa650124eefba1fd45866d05306385129"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa650124eefba1fd45866d05306385129">isLegalGatherOrScatter</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a> = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(V);</span></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(V);</span></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a> &amp;&amp; !<a href="/docs/api/namespaces/llvm/si">SI</a>)</span></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Ty = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(V);</span></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/align">Align</a> <a href="/docs/api/structs/llvm/align">Align</a> = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(V);</span></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>())</span></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><span class="doxyHighlight">      Ty = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Ty, VF);</span></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a> &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedGather(Ty, <a href="/docs/api/structs/llvm/align">Align</a>)) ||</span></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><span class="doxyHighlight">           (<a href="/docs/api/namespaces/llvm/si">SI</a> &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedScatter(Ty, <a href="/docs/api/structs/llvm/align">Align</a>));</span></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><span class="doxyHighlightComment">  /// Returns true if the target machine supports all of the reduction</span></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><span class="doxyHighlightComment">  /// variables found for the given VF.</span></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a07515d0542b797be2d1c87d4359ff8f6"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a07515d0542b797be2d1c87d4359ff8f6">canVectorizeReductions</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars(), &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><span class="doxyHighlight">      const RecurrenceDescriptor &amp;RdxDesc = Reduction.second;</span></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><span class="doxyHighlight">      return TTI.isLegalToVectorizeReduction(RdxDesc, VF);</span></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><span class="doxyHighlight">    &#125;));</span></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><span class="doxyHighlightComment">  /// Given costs for both strategies, return true if the scalar predication</span></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><span class="doxyHighlightComment">  /// lowering should be used for div/rem.  This incorporates an override</span></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><span class="doxyHighlightComment">  /// option so it is not simply a cost comparison.</span></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#add43c346a11ae1deb49142ba968eb07e"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#add43c346a11ae1deb49142ba968eb07e">isDivRemScalarWithPredication</a>(<a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarCost,</span></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> SafeDivisorCost)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="#ad69cf8bf5c6b79c5642327ecb6be38cd">ForceSafeDivisor</a>) &#123;</span></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/cl/#a9241f2e42b7587b123c885d7a659ad44aa5bd521ebe67ddf0e90f1a9e540a6d43">cl::BOU&#95;UNSET</a>:</span></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ScalarCost &lt; SafeDivisorCost;</span></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/cl/#a9241f2e42b7587b123c885d7a659ad44ad7c4bd83c337c86d34f6c2d8eba1e736">cl::BOU&#95;TRUE</a>:</span></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/cl/#a9241f2e42b7587b123c885d7a659ad44a4e55599a5b5277382b14e6e8eb1f63ef">cl::BOU&#95;FALSE</a>:</span></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;impossible case value&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><span class="doxyHighlightComment">  /// Returns true if \\p I is an instruction which requires predication and</span></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><span class="doxyHighlightComment">  /// for which our chosen predication strategy is scalarization (i.e. we</span></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><span class="doxyHighlightComment">  /// don&#39;t have an alternate strategy such as masking available).</span></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><span class="doxyHighlightComment">  /// \\p VF is the vectorization factor that will be used to vectorize \\p I.</span></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8">isScalarWithPredication</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><span class="doxyHighlightComment">  /// Returns true if \\p I is an instruction that needs to be predicated</span></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><span class="doxyHighlightComment">  /// at runtime.  The result is independent of the predication mechanism.</span></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><span class="doxyHighlightComment">  /// Superset of instructions that return true for isScalarWithPredication.</span></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">isPredicatedInst</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><span class="doxyHighlightComment">  /// Return the costs for our two available strategies for lowering a</span></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><span class="doxyHighlightComment">  /// div/rem operation which requires speculating at least one lane.</span></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><span class="doxyHighlightComment">  /// First result is for scalarization (will be invalid for scalable</span></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><span class="doxyHighlightComment">  /// vectors); second is for the safe-divisor strategy.</span></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><span class="doxyHighlight">  std::pair&lt;InstructionCost, InstructionCost&gt;</span></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad8398a35cd187d6a75b460fcf54b5236">getDivRemSpeculationCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><span class="doxyHighlight">                           <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><span class="doxyHighlightComment">  /// Returns true if \\p I is a memory instruction with consecutive memory</span></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><span class="doxyHighlightComment">  /// access that can be widened.</span></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a59a6dd7531c8683174f886ff7698cc63">memoryInstructionCanBeWidened</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><span class="doxyHighlightComment">  /// Returns true if \\p I is a memory instruction in an interleaved-group</span></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><span class="doxyHighlightComment">  /// of memory accesses that can be vectorized with wide vector loads/stores</span></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><span class="doxyHighlightComment">  /// and shuffles.</span></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5964ce9ba38fe5a4d372242ac39e3f1d">interleavedAccessCanBeWidened</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><span class="doxyHighlightComment">  /// Check if \\p Instr belongs to any interleaved access group.</span></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85e3110b9fe54caf00fe4297d1b4f0b6"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85e3110b9fe54caf00fe4297d1b4f0b6">isAccessInterleaved</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7a98f0c17229446d76997f158d896aad">InterleaveInfo</a>.isInterleaved(Instr);</span></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><span class="doxyHighlightComment">  /// Get the interleaved access group that \\p Instr belongs to.</span></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/interleavegroup">InterleaveGroup&lt;Instruction&gt;</a> &#42;</span></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c">getInterleavedAccessGroup</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7a98f0c17229446d76997f158d896aad">InterleaveInfo</a>.getInterleaveGroup(Instr);</span></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><span class="doxyHighlightComment">  /// Returns true if we&#39;re required to use a scalar epilogue for at least</span></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><span class="doxyHighlightComment">  /// the final iteration of the original loop.</span></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a913ab9c8291000dd3a1c3739194b03e4"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a913ab9c8291000dd3a1c3739194b03e4">requiresScalarEpilogue</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsVectorizing)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af67062c22dbf5e0ab35164a778768476">isScalarEpilogueAllowed</a>()) &#123;</span></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Loop does not require scalar epilogue\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we might exit from anywhere but the latch and early exit vectorization</span></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is disabled, we must run the exiting iteration in scalar form.</span></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getExitingBlock() != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getLoopLatch() &amp;&amp;</span></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><span class="doxyHighlight">        !(<a href="#af7af1b4bf03205c80dcba0a6324c4f21">EnableEarlyExitVectorization</a> &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;hasUncountableEarlyExit())) &#123;</span></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Loop requires scalar epilogue: not exiting &quot;</span></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><span class="doxyHighlight">                           </span><span class="doxyHighlightStringLiteral">&quot;from latch block\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsVectorizing &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7a98f0c17229446d76997f158d896aad">InterleaveInfo</a>.requiresScalarEpilogue()) &#123;</span></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Loop requires scalar epilogue: &quot;</span></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><span class="doxyHighlight">                           </span><span class="doxyHighlightStringLiteral">&quot;interleaved group requires scalar epilogue\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Loop does not require scalar epilogue\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><span class="doxyHighlightComment">  /// Returns true if we&#39;re required to use a scalar epilogue for at least</span></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><span class="doxyHighlightComment">  /// the final iteration of the original loop for all VFs in \\p Range.</span></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><span class="doxyHighlightComment">  /// A scalar epilogue must either be required for all VFs in \\p Range or for</span></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><span class="doxyHighlightComment">  /// none.</span></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a08599d322c8160c0412192455bbfb3c2"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a08599d322c8160c0412192455bbfb3c2">requiresScalarEpilogue</a>(<a href="/docs/api/structs/llvm/vfrange">VFRange</a> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RequiresScalarEpilogue = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a913ab9c8291000dd3a1c3739194b03e4">requiresScalarEpilogue</a>(VF.isVector());</span></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsRequired = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>, RequiresScalarEpilogue);</span></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><span class="doxyHighlight">        (IsRequired || <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>, RequiresScalarEpilogue)) &amp;&amp;</span></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;all VFs in range must agree on whether a scalar epilogue is required&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IsRequired;</span></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><span class="doxyHighlightComment">  /// Returns true if a scalar epilogue is not allowed due to optsize or a</span></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><span class="doxyHighlightComment">  /// loop hint annotation.</span></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#af67062c22dbf5e0ab35164a778768476"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af67062c22dbf5e0ab35164a778768476">isScalarEpilogueAllowed</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ScalarEpilogueStatus == <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>;</span></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><span class="doxyHighlightComment">  /// Returns the TailFoldingStyle that is best for the current loop.</span></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a738b994c87e0e816cf5f323e0e2b6c07"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a738b994c87e0e816cf5f323e0e2b6c07">getTailFoldingStyle</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IVUpdateMayOverflow = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ChosenTailFoldingStyle)</span></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>;</span></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IVUpdateMayOverflow ? ChosenTailFoldingStyle-&gt;first</span></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><span class="doxyHighlight">                               : ChosenTailFoldingStyle-&gt;second;</span></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><span class="doxyHighlightComment">  /// Selects and saves TailFoldingStyle for 2 options - if IV update may</span></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><span class="doxyHighlightComment">  /// overflow or not.</span></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><span class="doxyHighlightComment">  /// \\param IsScalableVF true if scalable vector factors enabled.</span></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><span class="doxyHighlightComment">  /// \\param UserIC User specific interleave count.</span></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8eb89837d2853e4853ea14379ae3972"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8eb89837d2853e4853ea14379ae3972">setTailFoldingStyles</a>(</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsScalableVF, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> UserIC) &#123;</span></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!ChosenTailFoldingStyle &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Tail folding must not be selected yet.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;canFoldTailByMasking()) &#123;</span></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><span class="doxyHighlight">      ChosenTailFoldingStyle =</span></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><span class="doxyHighlight">          std::make&#95;pair(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>, <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>);</span></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a8959791a22c7d3cfb4136777fd244535">ForceTailFoldingStyle</a>.getNumOccurrences()) &#123;</span></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><span class="doxyHighlight">      ChosenTailFoldingStyle = std::make&#95;pair(</span></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getPreferredTailFoldingStyle(</span><span class="doxyHighlightComment">/&#42;IVUpdateMayOverflow=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getPreferredTailFoldingStyle(</span><span class="doxyHighlightComment">/&#42;IVUpdateMayOverflow=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Set styles when forced.</span></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><span class="doxyHighlight">    ChosenTailFoldingStyle = std::make&#95;pair(<a href="#a8959791a22c7d3cfb4136777fd244535">ForceTailFoldingStyle</a>.getValue(),</span></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><span class="doxyHighlight">                                            <a href="#a8959791a22c7d3cfb4136777fd244535">ForceTailFoldingStyle</a>.getValue());</span></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a8959791a22c7d3cfb4136777fd244535">ForceTailFoldingStyle</a> != <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6ae67872a709ea2e3175802518fc4e71">TailFoldingStyle::DataWithEVL</a>)</span></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Override forced styles if needed.</span></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: use actual opcode/data type for analysis here.</span></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: Investigate opportunity for fixed vector factor.</span></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FIXME: support fixed-order recurrences by fixing splice of non VFxUF</span></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// penultimate EVL.</span></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> EVLIsLegal =</span></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><span class="doxyHighlight">        UserIC &lt;= 1 &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.hasActiveVectorLength(0, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/structs/llvm/align">Align</a>()) &amp;&amp;</span></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><span class="doxyHighlight">        !<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a> &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getFixedOrderRecurrences().empty();</span></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!EVLIsLegal) &#123;</span></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If for some reason EVL mode is unsupported, fallback to</span></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// DataWithoutLaneMask to try to vectorize the loop with folded tail</span></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// in a generic way.</span></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><span class="doxyHighlight">      ChosenTailFoldingStyle =</span></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><span class="doxyHighlight">          std::make&#95;pair(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddadfca60932ecfe430f86d4ecde04e13ab">TailFoldingStyle::DataWithoutLaneMask</a>,</span></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><span class="doxyHighlight">                         <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddadfca60932ecfe430f86d4ecde04e13ab">TailFoldingStyle::DataWithoutLaneMask</a>);</span></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><span class="doxyHighlight">          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Preference for VP intrinsics indicated. Will &quot;</span></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;not try to generate VP Intrinsics &quot;</span></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><span class="doxyHighlight">          &lt;&lt; (UserIC &gt; 1</span></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><span class="doxyHighlight">                  ? </span><span class="doxyHighlightStringLiteral">&quot;since interleave count specified is greater than 1.\\n&quot;</span></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><span class="doxyHighlight">                  : </span><span class="doxyHighlightStringLiteral">&quot;due to non-interleaving reasons.\\n&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><span class="doxyHighlightComment">  /// Returns true if all loop blocks should be masked to fold tail loop.</span></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba">foldTailByMasking</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: check if it is possible to check for None style independent of</span></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// IVUpdateMayOverflow flag in getTailFoldingStyle.</span></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a738b994c87e0e816cf5f323e0e2b6c07">getTailFoldingStyle</a>() != <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>;</span></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><span class="doxyHighlightComment">  /// Return maximum safe number of elements to be processed per vector</span></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><span class="doxyHighlightComment">  /// iteration, which do not prevent store-load forwarding and are safe with</span></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><span class="doxyHighlightComment">  /// regard to the memory dependencies. Required for EVL-based VPlans to</span></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><span class="doxyHighlightComment">  /// correctly calculate AVL (application vector length) as min(remaining AVL,</span></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><span class="doxyHighlightComment">  /// MaxSafeElements).</span></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><span class="doxyHighlightComment">  /// TODO: need to consider adjusting cost model to use this value as a</span></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><span class="doxyHighlightComment">  /// vectorization factor for EVL-based vectorization.</span></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a36ed7dfdcdc1bca9eea99fc741511590"><span class="doxyHighlight">  std::optional&lt;unsigned&gt; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a36ed7dfdcdc1bca9eea99fc741511590">getMaxSafeElements</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MaxSafeElements; &#125;</span></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><span class="doxyHighlightComment">  /// Returns true if the instructions in this block requires predication</span></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><span class="doxyHighlightComment">  /// for any reason, e.g. because tail folding now requires a predicate</span></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><span class="doxyHighlightComment">  /// or because the block in the original loop was predicated.</span></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8c8de8f62b5d2b27c4878d3effd7273"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8c8de8f62b5d2b27c4878d3effd7273">blockNeedsPredicationForAnyReason</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba">foldTailByMasking</a>() || <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;blockNeedsPredication(BB);</span></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><span class="doxyHighlightComment">  /// Returns true if VP intrinsics with explicit vector length support should</span></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><span class="doxyHighlightComment">  /// be generated in the tail folded loop.</span></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab0c7e793ca1b6b8a4f8c00a1bc1cb32f"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab0c7e793ca1b6b8a4f8c00a1bc1cb32f">foldTailWithEVL</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a738b994c87e0e816cf5f323e0e2b6c07">getTailFoldingStyle</a>() == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6ae67872a709ea2e3175802518fc4e71">TailFoldingStyle::DataWithEVL</a>;</span></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><span class="doxyHighlightComment">  /// Returns true if the Phi is part of an inloop reduction.</span></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9819226a3ff242635fd99bf22b50bd97"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9819226a3ff242635fd99bf22b50bd97">isInLoopReduction</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> InLoopReductions.contains(Phi);</span></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><span class="doxyHighlightComment">  /// Returns true if the predicated reduction select should be used to set the</span></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><span class="doxyHighlightComment">  /// incoming value for the reduction phi.</span></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a23c31233960bfc62d1cc93bb4a5f5148"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a23c31233960bfc62d1cc93bb4a5f5148">usePredicatedReductionSelect</a>(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opcode, <a href="/docs/api/classes/llvm/type">Type</a> &#42;PhiTy)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Force to use predicated reduction select since the EVL of the</span></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// second-to-last iteration might not be VF&#42;UF.</span></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab0c7e793ca1b6b8a4f8c00a1bc1cb32f">foldTailWithEVL</a>())</span></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a927ef1cfd7c981c5b9b9e8c67b1d13c3">PreferPredicatedReductionSelect</a> ||</span></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><span class="doxyHighlight">           <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.preferPredicatedReductionSelect(</span></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><span class="doxyHighlight">               Opcode, PhiTy, <a href="/docs/api/structs/llvm/targettransforminfo/reductionflags">TargetTransformInfo::ReductionFlags</a>());</span></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><span class="doxyHighlightComment">  /// Estimate cost of an intrinsic call instruction CI if it were vectorized</span></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><span class="doxyHighlightComment">  /// with factor VF.  Return the cost of the instruction, including</span></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><span class="doxyHighlightComment">  /// scalarization overhead if it&#39;s needed.</span></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5abced3ab870d7abf57f2b35a02cd041">getVectorIntrinsicCost</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><span class="doxyHighlightComment">  /// Estimate cost of a call instruction CI if it were vectorized with factor</span></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><span class="doxyHighlightComment">  /// VF. Return the cost of the instruction, including scalarization overhead</span></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><span class="doxyHighlightComment">  /// if it&#39;s needed.</span></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad1f0755693a05c2b008e9a576c3b162b">getVectorCallCost</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><span class="doxyHighlightComment">  /// Invalidates decisions already taken by the cost model.</span></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85afe07533e500a31222b17f80b540fe"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85afe07533e500a31222b17f80b540fe">invalidateCostModelingDecisions</a>() &#123;</span></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><span class="doxyHighlight">    WideningDecisions.clear();</span></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><span class="doxyHighlight">    CallWideningDecisions.clear();</span></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><span class="doxyHighlight">    Uniforms.clear();</span></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><span class="doxyHighlight">    Scalars.clear();</span></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><span class="doxyHighlightComment">  /// Returns the expected execution cost. The unit of the cost does</span></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><span class="doxyHighlightComment">  /// not matter because we use the &#39;cost&#39; units to compare different</span></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><span class="doxyHighlightComment">  /// vector widths. The cost that is returned is &#42;not&#42; normalized by</span></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><span class="doxyHighlightComment">  /// the factor width.</span></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae4c50e6300599d50ba706c0d2b780502">expectedCost</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0aa9aa5d09f2f30c5a62a4692e5a21e3"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0aa9aa5d09f2f30c5a62a4692e5a21e3">hasPredStores</a>()</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NumPredStores &gt; 0; &#125;</span></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><span class="doxyHighlightComment">  /// Returns true if epilogue vectorization is considered profitable, and</span></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><span class="doxyHighlightComment">  /// false otherwise.</span></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><span class="doxyHighlightComment">  /// \\p VF is the vectorization factor chosen for the original loop.</span></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><span class="doxyHighlightComment">  /// \\p Multiplier is an aditional scaling factor applied to VF before</span></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><span class="doxyHighlightComment">  /// comparing to EpilogueVectorizationMinVF.</span></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a07db8a5919c9879e3327549f20cda2f9">isEpilogueVectorizationProfitable</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF,</span></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><span class="doxyHighlight">                                         </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IC) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><span class="doxyHighlightComment">  /// Returns the execution time cost of an instruction for a given vector</span></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><span class="doxyHighlightComment">  /// width. Vector width of one means scalar.</span></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a556ec90a0fa1e168a9f22db1deb1fee6">getInstructionCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><span class="doxyHighlightComment">  /// Return the cost of instructions in an inloop reduction pattern, if I is</span></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><span class="doxyHighlightComment">  /// part of that pattern.</span></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><span class="doxyHighlight">  std::optional&lt;InstructionCost&gt; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4e307866e6d65e87d1e6884b0d13306c">getReductionPatternCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><span class="doxyHighlight">                                                         <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF,</span></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><span class="doxyHighlight">                                                         <a href="/docs/api/classes/llvm/type">Type</a> &#42;VectorTy) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><span class="doxyHighlightComment">  /// Returns true if \\p Op should be considered invariant and if it is</span></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><span class="doxyHighlightComment">  /// trivially hoistable.</span></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aadd9a9d699ede62468422c7cfab66e99">shouldConsiderInvariant</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><span class="doxyHighlightKeyword">private</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumPredStores = 0;</span></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><span class="doxyHighlightComment">  /// \\return An upper bound for the vectorization factors for both</span></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><span class="doxyHighlightComment">  /// fixed and scalable vectorization, where the minimum-known number of</span></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><span class="doxyHighlightComment">  /// elements is a power-of-2 larger than zero. If scalable vectorization is</span></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><span class="doxyHighlightComment">  /// disabled or unsupported, then the scalable part will be equal to</span></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><span class="doxyHighlightComment">  /// ElementCount::getScalable(0).</span></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/fixedscalablevfpair">FixedScalableVFPair</a> computeFeasibleMaxVF(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxTripCount,</span></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF,</span></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><span class="doxyHighlight">                                           </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FoldTailByMasking);</span></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><span class="doxyHighlightComment">  /// \\return the maximized element count based on the targets vector</span></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><span class="doxyHighlightComment">  /// registers and the loop trip-count, but limited to a maximum safe VF.</span></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><span class="doxyHighlightComment">  /// This is a helper function of computeFeasibleMaxVF.</span></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> getMaximizedVFForTarget(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxTripCount,</span></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><span class="doxyHighlight">                                       </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SmallestType,</span></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><span class="doxyHighlight">                                       </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> WidestType,</span></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MaxSafeVF,</span></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><span class="doxyHighlight">                                       </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FoldTailByMasking);</span></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><span class="doxyHighlightComment">  /// Checks if scalable vectorization is supported and enabled. Caches the</span></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><span class="doxyHighlightComment">  /// result to avoid repeated debug dumps for repeated queries.</span></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> isScalableVectorizationAllowed();</span></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><span class="doxyHighlightComment">  /// \\return the maximum legal scalable VF, based on the safe max number</span></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><span class="doxyHighlightComment">  /// of elements.</span></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> getMaxLegalScalableVF(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxSafeElements);</span></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><span class="doxyHighlightComment">  /// Calculate vectorization cost of memory instruction \\p I.</span></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> getMemoryInstructionCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><span class="doxyHighlightComment">  /// The cost computation for scalarized memory instruction.</span></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> getMemInstScalarizationCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><span class="doxyHighlightComment">  /// The cost computation for interleaving group of memory instructions.</span></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> getInterleaveGroupCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><span class="doxyHighlightComment">  /// The cost computation for Gather/Scatter instruction.</span></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> getGatherScatterCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><span class="doxyHighlightComment">  /// The cost computation for widening instruction \\p I with consecutive</span></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><span class="doxyHighlightComment">  /// memory access.</span></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> getConsecutiveMemOpCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><span class="doxyHighlightComment">  /// The cost calculation for Load/Store instruction \\p I with uniform pointer -</span></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><span class="doxyHighlightComment">  /// Load: scalar load + broadcast.</span></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><span class="doxyHighlightComment">  /// Store: scalar store + (loop invariant value stored? 0 : extract of last</span></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><span class="doxyHighlightComment">  /// element)</span></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> getUniformMemOpCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><span class="doxyHighlightComment">  /// Estimate the overhead of scalarizing an instruction. This is a</span></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><span class="doxyHighlightComment">  /// convenience wrapper for the type-based getScalarizationOverhead API.</span></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> getScalarizationOverhead(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><span class="doxyHighlightComment">  /// Returns true if an artificially high cost for emulated masked memrefs</span></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><span class="doxyHighlightComment">  /// should be used.</span></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> useEmulatedMaskMemRefHack(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><span class="doxyHighlightComment">  /// Map of scalar integer values to the smallest bitwidth they can be legally</span></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><span class="doxyHighlightComment">  /// represented as. The vector equivalents of these values should be truncated</span></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><span class="doxyHighlightComment">  /// to this type.</span></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;Instruction &#42;, uint64&#95;t&gt;</a> MinBWs;</span></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><span class="doxyHighlightComment">  /// A type representing the costs for instructions if they were to be</span></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><span class="doxyHighlightComment">  /// scalarized rather than vectorized. The entries are Instruction-Cost</span></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><span class="doxyHighlightComment">  /// pairs.</span></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">ScalarCostsTy = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Instruction &#42;, InstructionCost&gt;</a>;</span></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><span class="doxyHighlightComment">  /// A set containing all BasicBlocks that are known to present after</span></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><span class="doxyHighlightComment">  /// vectorization as a predicated block.</span></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;ElementCount, SmallPtrSet&lt;BasicBlock &#42;, 4&gt;</a>&gt;</span></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><span class="doxyHighlight">      PredicatedBBsAfterVectorization;</span></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><span class="doxyHighlightComment">  /// Records whether it is allowed to have the original scalar loop execute at</span></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><span class="doxyHighlightComment">  /// least once. This may be needed as a fallback loop in case runtime</span></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><span class="doxyHighlightComment">  /// aliasing/dependence checks fail, or to handle the tail/remainder</span></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><span class="doxyHighlightComment">  /// iterations when the trip count is unknown or doesn&#39;t divide by the VF,</span></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><span class="doxyHighlightComment">  /// or as a peel-loop to handle gaps in interleave-groups.</span></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><span class="doxyHighlightComment">  /// Under optsize and when the trip count is very small we don&#39;t allow any</span></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><span class="doxyHighlightComment">  /// iterations to execute in the scalar loop.</span></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> ScalarEpilogueStatus = <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>;</span></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><span class="doxyHighlightComment">  /// Control finally chosen tail folding style. The first element is used if</span></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><span class="doxyHighlightComment">  /// the IV update may overflow, the second element - if it does not.</span></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><span class="doxyHighlight">  std::optional&lt;std::pair&lt;TailFoldingStyle, TailFoldingStyle&gt;&gt;</span></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><span class="doxyHighlight">      ChosenTailFoldingStyle;</span></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><span class="doxyHighlightComment">  /// true if scalable vectorization is supported and enabled.</span></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><span class="doxyHighlight">  std::optional&lt;bool&gt; IsScalableVectorizationAllowed;</span></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><span class="doxyHighlightComment">  /// Maximum safe number of elements to be processed per vector iteration,</span></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><span class="doxyHighlightComment">  /// which do not prevent store-load forwarding and are safe with regard to the</span></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><span class="doxyHighlightComment">  /// memory dependencies. Required for EVL-based veectorization, where this</span></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><span class="doxyHighlightComment">  /// value is used as the upper bound of the safe AVL.</span></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><span class="doxyHighlight">  std::optional&lt;unsigned&gt; MaxSafeElements;</span></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><span class="doxyHighlightComment">  /// A map holding scalar costs for different vectorization factors. The</span></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><span class="doxyHighlightComment">  /// presence of a cost for an instruction in the mapping indicates that the</span></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><span class="doxyHighlightComment">  /// instruction will be scalarized when vectorizing with the associated</span></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><span class="doxyHighlightComment">  /// vectorization factor. The entries are VF-ScalarCostTy pairs.</span></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;ElementCount, ScalarCostsTy&gt;</a> InstsToScalarize;</span></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><span class="doxyHighlightComment">  /// Holds the instructions known to be uniform after vectorization.</span></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><span class="doxyHighlightComment">  /// The data is collected per VF.</span></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;ElementCount, SmallPtrSet&lt;Instruction &#42;, 4&gt;</a>&gt; Uniforms;</span></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><span class="doxyHighlightComment">  /// Holds the instructions known to be scalar after vectorization.</span></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><span class="doxyHighlightComment">  /// The data is collected per VF.</span></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;ElementCount, SmallPtrSet&lt;Instruction &#42;, 4&gt;</a>&gt; Scalars;</span></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><span class="doxyHighlightComment">  /// Holds the instructions (address computations) that are forced to be</span></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><span class="doxyHighlightComment">  /// scalarized.</span></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;ElementCount, SmallPtrSet&lt;Instruction &#42;, 4&gt;</a>&gt; ForcedScalars;</span></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><span class="doxyHighlightComment">  /// PHINodes of the reductions that should be expanded in-loop.</span></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;PHINode &#42;, 4&gt;</a> InLoopReductions;</span></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><span class="doxyHighlightComment">  /// A Map of inloop reduction operations and their immediate chain operand.</span></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><span class="doxyHighlightComment">  /// FIXME: This can be removed once reductions can be costed correctly in</span></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><span class="doxyHighlightComment">  /// VPlan. This was added to allow quick lookup of the inloop operations.</span></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Instruction &#42;, Instruction &#42;&gt;</a> InLoopReductionImmediateChains;</span></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><span class="doxyHighlightComment">  /// Returns the expected difference in cost from scalarizing the expression</span></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><span class="doxyHighlightComment">  /// feeding a predicated instruction \\p PredInst. The instructions to</span></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><span class="doxyHighlightComment">  /// scalarize and their scalar costs are collected in \\p ScalarCosts. A</span></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><span class="doxyHighlightComment">  /// non-negative return value implies the expression will be scalarized.</span></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><span class="doxyHighlightComment">  /// Currently, only single-use chains are considered for scalarization.</span></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> computePredInstDiscount(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PredInst,</span></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><span class="doxyHighlight">                                          ScalarCostsTy &amp;ScalarCosts,</span></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><span class="doxyHighlightComment">  /// Collect the instructions that are uniform after vectorization. An</span></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><span class="doxyHighlightComment">  /// instruction is uniform if we represent it with a single scalar value in</span></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><span class="doxyHighlightComment">  /// the vectorized loop corresponding to each vector iteration. Examples of</span></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><span class="doxyHighlightComment">  /// uniform instructions include pointer operands of consecutive or</span></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><span class="doxyHighlightComment">  /// interleaved memory accesses. Note that although uniformity implies an</span></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><span class="doxyHighlightComment">  /// instruction will be scalar, the reverse is not true. In general, a</span></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><span class="doxyHighlightComment">  /// scalarized instruction will be represented by VF scalar values in the</span></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><span class="doxyHighlightComment">  /// vectorized loop, each corresponding to an iteration of the original</span></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><span class="doxyHighlightComment">  /// scalar loop.</span></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> collectLoopUniforms(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><span class="doxyHighlightComment">  /// Collect the instructions that are scalar after vectorization. An</span></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><span class="doxyHighlightComment">  /// instruction is scalar if it is known to be uniform or will be scalarized</span></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><span class="doxyHighlightComment">  /// during vectorization. collectLoopScalars should only add non-uniform nodes</span></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><span class="doxyHighlightComment">  /// to the list if they are used by a load/store instruction that is marked as</span></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><span class="doxyHighlightComment">  /// CM&#95;Scalarize. Non-uniform scalarized instructions will be represented by</span></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><span class="doxyHighlightComment">  /// VF values in the vectorized loop, each corresponding to an iteration of</span></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><span class="doxyHighlightComment">  /// the original scalar loop.</span></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> collectLoopScalars(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</span></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><span class="doxyHighlightComment">  /// Keeps cost model vectorization decision and cost for instructions.</span></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><span class="doxyHighlightComment">  /// Right now it is used for memory instructions only.</span></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">DecisionList = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;std::pair&lt;Instruction &#42;, ElementCount&gt;</a>,</span></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><span class="doxyHighlight">                                std::pair&lt;InstWidening, InstructionCost&gt;&gt;;</span></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><span class="doxyHighlight">  DecisionList WideningDecisions;</span></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">CallDecisionList =</span></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;std::pair&lt;CallInst &#42;, ElementCount&gt;</a>, CallWideningDecision&gt;;</span></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><span class="doxyHighlight">  CallDecisionList CallWideningDecisions;</span></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><span class="doxyHighlightComment">  /// Returns true if \\p V is expected to be vectorized and it needs to be</span></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><span class="doxyHighlightComment">  /// extracted.</span></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> needsExtract(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;<a href="/docs/api/classes/llvm/loop/#a6cb6a58fb0ded82b4c7755fc4c27c86d">isLoopInvariant</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>)</span></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Assume we can vectorize V (and hence we need extraction) if the</span></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scalars are not computed yet. This can happen, because it is called</span></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// via getScalarizationOverhead from setCostBasedWideningDecision, before</span></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the scalars are collected. That should be a safe assumption in most</span></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cases, because we check if the operands have vectorizable types</span></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// beforehand in LoopVectorizationLegality.</span></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Scalars.<a href="/docs/api/classes/llvm/densemapbase/#a836d9cba6deced0bb1fa7333ce5afd3a">contains</a>(VF) || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><span class="doxyHighlightComment">  /// Returns a range containing only operands needing to be extracted.</span></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> filterExtractingOperands(<a href="/docs/api/classes/llvm/user/#a917548288129e24325af275795e4622f">Instruction::op&#95;range</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>,</span></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><span class="doxyHighlight">                                                   <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a>(<a href="/docs/api/namespaces/llvm/#a898e9304cf2baf908f4e9b8e32a5f6c3">make&#95;filter&#95;range</a>(</span></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, VF&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> this-&gt;needsExtract(V, VF); &#125;));</span></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><span class="doxyHighlightComment">  /// The loop that we evaluate.</span></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>;</span></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><span class="doxyHighlightComment">  /// Predicated scalar evolution analysis.</span></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>;</span></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><span class="doxyHighlightComment">  /// Loop Info analysis.</span></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a>;</span></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><span class="doxyHighlightComment">  /// Vectorization legality.</span></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>;</span></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><span class="doxyHighlightComment">  /// Vector target information.</span></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>;</span></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><span class="doxyHighlightComment">  /// Target Library Info.</span></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>;</span></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><span class="doxyHighlightComment">  /// Demanded bits analysis.</span></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a58fd764accfd06df487cc6ec43d4f5fc"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/demandedbits">DemandedBits</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a58fd764accfd06df487cc6ec43d4f5fc">DB</a>;</span></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><span class="doxyHighlightComment">  /// Assumption cache.</span></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#aba357162dc28acb3a399731e1e397614"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aba357162dc28acb3a399731e1e397614">AC</a>;</span></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><span class="doxyHighlightComment">  /// Interface to emit optimization remarks.</span></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>;</span></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>;</span></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><span class="doxyHighlightComment">  /// Loop Vectorize Hint.</span></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35e67974daa692cfd961904c151ad33d"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35e67974daa692cfd961904c151ad33d">Hints</a>;</span></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><span class="doxyHighlightComment">  /// The interleave access information contains groups of interleaved accesses</span></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><span class="doxyHighlightComment">  /// with the same stride and close to each other.</span></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7a98f0c17229446d76997f158d896aad"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/interleavedaccessinfo">InterleavedAccessInfo</a> &amp;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7a98f0c17229446d76997f158d896aad">InterleaveInfo</a>;</span></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><span class="doxyHighlightComment">  /// Values to ignore in the cost model.</span></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 16&gt;</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>;</span></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><span class="doxyHighlightComment">  /// Values to ignore in the cost model when VF &gt; 1</span></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 16&gt;</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>;</span></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><span class="doxyHighlightComment">  /// All element types found in the loop.</span></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a00a28a503636abdbedf080f3896b937c"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Type &#42;, 16&gt;</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a00a28a503636abdbedf080f3896b937c">ElementTypesInLoop</a>;</span></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><span class="doxyHighlightComment">  /// The kind of cost that we are calculating</span></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bb">TTI::TargetCostKind</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>;</span></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end namespace llvm</span></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><span class="doxyHighlightComment">/// Helper struct to manage generating runtime checks for vectorization.</span></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><span class="doxyHighlightComment">/// The runtime checks are created up-front in temporary blocks to allow better</span></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><span class="doxyHighlightComment">/// estimating the cost and un-linked from the existing IR. After deciding to</span></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><span class="doxyHighlightComment">/// vectorize, the checks are moved back. If deciding not to vectorize, the</span></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><span class="doxyHighlightComment">/// temporary blocks are completely removed.</span></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805" lineLink="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks"><span class="doxyHighlightKeyword">class </span><span class="doxyHighlight"><a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#a2139ed08d8dfd3185f12ff7ffb7f0f3e">GeneratedRTChecks</a> &#123;</span></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><span class="doxyHighlightComment">  /// Basic block which contains the generated SCEV checks, if any.</span></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SCEVCheckBlock = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><span class="doxyHighlightComment">  /// The value representing the result of the generated SCEV checks. If it is</span></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><span class="doxyHighlightComment">  /// nullptr, either no SCEV checks have been generated or they have been used.</span></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;SCEVCheckCond = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><span class="doxyHighlightComment">  /// Basic block which contains the generated memory runtime checks, if any.</span></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;MemCheckBlock = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><span class="doxyHighlightComment">  /// The value representing the result of the generated memory runtime checks.</span></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><span class="doxyHighlightComment">  /// If it is nullptr, either no memory runtime checks have been generated or</span></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><span class="doxyHighlightComment">  /// they have been used.</span></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;MemRuntimeCheckCond = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT;</span></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI;</span></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI;</span></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> SCEVExp;</span></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> MemCheckExp;</span></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> CostTooHigh = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AddBranchWeights;</span></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;OuterLoop = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;PSE;</span></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><span class="doxyHighlightComment">  /// The kind of cost that we are calculating</span></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bb">TTI::TargetCostKind</a> CostKind;</span></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><span class="doxyHighlightKeyword">public</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839" lineLink="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#a2139ed08d8dfd3185f12ff7ffb7f0f3e"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#a2139ed08d8dfd3185f12ff7ffb7f0f3e">GeneratedRTChecks</a>(<a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;PSE, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</span></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI,</span></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><span class="doxyHighlight">                    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AddBranchWeights,</span></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><span class="doxyHighlight">                    <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bb">TTI::TargetCostKind</a> CostKind)</span></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><span class="doxyHighlight">      : DT(DT), LI(LI), TTI(TTI), SCEVExp(&#42;PSE.getSE(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightStringLiteral">&quot;scev.check&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><span class="doxyHighlight">        MemCheckExp(&#42;PSE.getSE(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </span><span class="doxyHighlightStringLiteral">&quot;scev.check&quot;</span><span class="doxyHighlight">),</span></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><span class="doxyHighlight">        AddBranchWeights(AddBranchWeights), PSE(PSE), CostKind(CostKind) &#123;&#125;</span></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><span class="doxyHighlightComment">  /// Generate runtime checks in SCEVCheckBlock and MemCheckBlock, so we can</span></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><span class="doxyHighlightComment">  /// accurately estimate the cost of the runtime checks. The blocks are</span></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><span class="doxyHighlightComment">  /// un-linked from the IR and are added back during vector code generation. If</span></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><span class="doxyHighlightComment">  /// there is no vector code generation, the check blocks are removed</span></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><span class="doxyHighlightComment">  /// completely.</span></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852" lineLink="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#aae3714d6fe11a1e8c559880caf67fbc7"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#aae3714d6fe11a1e8c559880caf67fbc7">create</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopaccessinfo">LoopAccessInfo</a> &amp;LAI,</span></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><span class="doxyHighlight">              </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevpredicate">SCEVPredicate</a> &amp;UnionPred, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IC) &#123;</span></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Hard cutoff to limit compile-time increase in case a very large number of</span></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// runtime checks needs to be generated.</span></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Skip cutoff if the loop is guaranteed to execute, e.g. due to</span></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// profile info.</span></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><span class="doxyHighlight">    CostTooHigh =</span></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><span class="doxyHighlight">        LAI.<a href="/docs/api/classes/llvm/loopaccessinfo/#a76ffc71fcd432b9a2a15b11c3144397d">getNumRuntimePointerChecks</a>() &gt; <a href="#a1293f02da7fffb33096a44f1b1768b3f">VectorizeMemoryCheckThreshold</a>;</span></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CostTooHigh)</span></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopHeader = L-&gt;getHeader();</span></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader = L-&gt;getLoopPreheader();</span></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Use SplitBlock to create blocks for SCEV &amp; memory runtime checks to</span></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ensure the blocks are properly added to LoopInfo &amp; DominatorTree. Those</span></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// may be used by SCEVExpander. The blocks will be un-linked from their</span></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predecessors and removed from LI &amp; DT at the end of the function.</span></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UnionPred.<a href="/docs/api/classes/llvm/scevpredicate/#ac43f5102232a1e1819b0763536f2937a">isAlwaysTrue</a>()) &#123;</span></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><span class="doxyHighlight">      SCEVCheckBlock = <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(Preheader, Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), DT, LI,</span></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><span class="doxyHighlight">                                  </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;vector.scevcheck&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><span class="doxyHighlight">      SCEVCheckCond = SCEVExp.expandCodeForPredicate(</span></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><span class="doxyHighlight">          &amp;UnionPred, SCEVCheckBlock-&gt;getTerminator());</span></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;RtPtrChecking = &#42;LAI.<a href="/docs/api/classes/llvm/loopaccessinfo/#a3aedf5694dc5b1e81a79658b126a9b43">getRuntimePointerChecking</a>();</span></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RtPtrChecking.Need) &#123;</span></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Pred = SCEVCheckBlock ? SCEVCheckBlock : Preheader;</span></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><span class="doxyHighlight">      MemCheckBlock = <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(Pred, Pred-&gt;getTerminator(), DT, LI, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><span class="doxyHighlight">                                 </span><span class="doxyHighlightStringLiteral">&quot;vector.memcheck&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> DiffChecks = RtPtrChecking.getDiffChecks();</span></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DiffChecks) &#123;</span></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;RuntimeVF = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><span class="doxyHighlight">        MemRuntimeCheckCond = <a href="/docs/api/namespaces/llvm/#ad4f572b4f4bf6aa2dbf10a0bd160280d">addDiffRuntimeChecks</a>(</span></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><span class="doxyHighlight">            MemCheckBlock-&gt;getTerminator(), &#42;DiffChecks, MemCheckExp,</span></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><span class="doxyHighlight">            &#91;VF, &amp;RuntimeVF&#93;(<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Bits) &#123;</span></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><span class="doxyHighlight">              if (!RuntimeVF)</span></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><span class="doxyHighlight">                RuntimeVF = getRuntimeVF(B, B.getIntNTy(Bits), VF);</span></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><span class="doxyHighlight">              return RuntimeVF;</span></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><span class="doxyHighlight">            &#125;,</span></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><span class="doxyHighlight">            IC);</span></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><span class="doxyHighlight">        MemRuntimeCheckCond = <a href="/docs/api/namespaces/llvm/#a076304d81553bb834b6d64f72e0fe055">addRuntimeChecks</a>(</span></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><span class="doxyHighlight">            MemCheckBlock-&gt;getTerminator(), L, RtPtrChecking.getChecks(),</span></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><span class="doxyHighlight">            MemCheckExp, <a href="/docs/api/structs/llvm/vectorizerparams/#af0d74538c9c155e8b7899a962e12a68f">VectorizerParams::HoistRuntimeChecks</a>);</span></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MemRuntimeCheckCond &amp;&amp;</span></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;no RT checks generated although RtPtrChecking &quot;</span></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;claimed checks are required&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MemCheckBlock &amp;&amp; !SCEVCheckBlock)</span></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Unhook the temporary block with the checks, update various places</span></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// accordingly.</span></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SCEVCheckBlock)</span></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><span class="doxyHighlight">      SCEVCheckBlock-&gt;replaceAllUsesWith(Preheader);</span></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MemCheckBlock)</span></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><span class="doxyHighlight">      MemCheckBlock-&gt;replaceAllUsesWith(Preheader);</span></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SCEVCheckBlock) &#123;</span></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><span class="doxyHighlight">      SCEVCheckBlock-&gt;getTerminator()-&gt;moveBefore(</span></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><span class="doxyHighlight">          Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a>(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), SCEVCheckBlock);</span></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><span class="doxyHighlight">      Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MemCheckBlock) &#123;</span></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><span class="doxyHighlight">      MemCheckBlock-&gt;getTerminator()-&gt;moveBefore(</span></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><span class="doxyHighlight">          Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</span></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a>(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), MemCheckBlock);</span></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><span class="doxyHighlight">      Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</span></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><span class="doxyHighlight">    DT-&gt;changeImmediateDominator(LoopHeader, Preheader);</span></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MemCheckBlock) &#123;</span></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><span class="doxyHighlight">      DT-&gt;eraseNode(MemCheckBlock);</span></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><span class="doxyHighlight">      LI-&gt;removeBlock(MemCheckBlock);</span></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SCEVCheckBlock) &#123;</span></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><span class="doxyHighlight">      DT-&gt;eraseNode(SCEVCheckBlock);</span></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><span class="doxyHighlight">      LI-&gt;removeBlock(SCEVCheckBlock);</span></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Outer loop is used as part of the later cost calculations.</span></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><span class="doxyHighlight">    OuterLoop = L-&gt;getParentLoop();</span></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943" lineLink="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#ad7b44d9befce70f070d4355d10ffc419"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#ad7b44d9befce70f070d4355d10ffc419">getCost</a>() &#123;</span></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SCEVCheckBlock || MemCheckBlock)</span></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Calculating cost of runtime checks:\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CostTooHigh) &#123;</span></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</span></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>.setInvalid();</span></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  number of checks exceeded threshold\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</span></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> RTCheckCost = 0;</span></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SCEVCheckBlock)</span></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;SCEVCheckBlock) &#123;</span></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SCEVCheckBlock-&gt;getTerminator() == &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = TTI-&gt;getInstructionCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, CostKind);</span></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  for &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><span class="doxyHighlight">        RTCheckCost += <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MemCheckBlock) &#123;</span></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> MemCheckCost = 0;</span></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;MemCheckBlock) &#123;</span></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MemCheckBlock-&gt;getTerminator() == &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = TTI-&gt;getInstructionCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, CostKind);</span></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;  for &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><span class="doxyHighlight">        MemCheckCost += <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the runtime memory checks are being created inside an outer loop</span></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// we should find out if these checks are outer loop invariant. If so,</span></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the checks will likely be hoisted out and so the effective cost will</span></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// reduce according to the outer loop trip count.</span></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OuterLoop) &#123;</span></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE = MemCheckExp.getSE();</span></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// TODO: If profitable, we could refine this further by analysing every</span></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// individual memory check, since there could be a mixture of loop</span></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// variant and invariant checks that mean the final condition is</span></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// variant.</span></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(MemRuntimeCheckCond);</span></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a5a19768af81df7e5fe571bc08dcd48b3">isLoopInvariant</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, OuterLoop)) &#123;</span></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// It seems reasonable to assume that we can reduce the effective</span></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// cost of the checks even when we know nothing about the trip</span></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// count. Assume that the outer loop executes at least twice.</span></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BestTripCount = 2;</span></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Get the best known TC estimate.</span></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EstimatedTC = <a href="#a84375e6536d9214c7895013078055aff">getSmallBestKnownTC</a>(</span></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><span class="doxyHighlight">                  PSE, OuterLoop, </span><span class="doxyHighlightComment">/&#42; CanUseConstantMax = &#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><span class="doxyHighlight">            BestTripCount = &#42;EstimatedTC;</span></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><span class="doxyHighlight">          BestTripCount = std::max(BestTripCount, 1U);</span></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> NewMemCheckCost = MemCheckCost / BestTripCount;</span></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Let&#39;s ensure the cost is always at least 1</span></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><span class="doxyHighlight">          NewMemCheckCost = std::max(&#42;NewMemCheckCost.<a href="/docs/api/classes/llvm/instructioncost/#a9b642067999075ba996ecdee40b52b68">getValue</a>(),</span></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><span class="doxyHighlight">                                     (<a href="/docs/api/classes/llvm/instructioncost/#a5dbf65370a0656ea05a0aa97380c15cc">InstructionCost::CostType</a>)1);</span></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BestTripCount &gt; 1)</span></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><span class="doxyHighlight">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><span class="doxyHighlight">                       &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;We expect runtime memory checks to be hoisted &quot;</span></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><span class="doxyHighlight">                       &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;out of the outer loop. Cost reduced from &quot;</span></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><span class="doxyHighlight">                       &lt;&lt; MemCheckCost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to &quot;</span><span class="doxyHighlight"> &lt;&lt; NewMemCheckCost &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><span class="doxyHighlight">          MemCheckCost = NewMemCheckCost;</span></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><span class="doxyHighlight">      RTCheckCost += MemCheckCost;</span></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SCEVCheckBlock || MemCheckBlock)</span></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Total cost of runtime checks: &quot;</span><span class="doxyHighlight"> &lt;&lt; RTCheckCost</span></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RTCheckCost;</span></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><span class="doxyHighlightComment">  /// Remove the created SCEV &amp; memory runtime check blocks &amp; instructions, if</span></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><span class="doxyHighlightComment">  /// unused.</span></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024" lineLink="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#a13b83b5242219a4536c997c7dc2062c4"><span class="doxyHighlight">  <a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#a13b83b5242219a4536c997c7dc2062c4">~GeneratedRTChecks</a>() &#123;</span></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/scevexpandercleaner">SCEVExpanderCleaner</a> SCEVCleaner(SCEVExp);</span></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/scevexpandercleaner">SCEVExpanderCleaner</a> MemCheckCleaner(MemCheckExp);</span></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SCEVCheckCond)</span></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><span class="doxyHighlight">      SCEVCleaner.<a href="/docs/api/classes/llvm/scevexpandercleaner/#adebccfabab3d98cd238936760a34a15d">markResultUsed</a>();</span></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MemRuntimeCheckCond)</span></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><span class="doxyHighlight">      MemCheckCleaner.<a href="/docs/api/classes/llvm/scevexpandercleaner/#adebccfabab3d98cd238936760a34a15d">markResultUsed</a>();</span></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MemRuntimeCheckCond) &#123;</span></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;SE = &#42;MemCheckExp.getSE();</span></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Memory runtime check generation creates compares that use expanded</span></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// values. Remove them before running the SCEVExpanderCleaners.</span></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(&#42;MemCheckBlock))) &#123;</span></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MemCheckExp.isInsertedInstruction(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><span class="doxyHighlight">        SE.forgetValue(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.eraseFromParent();</span></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><span class="doxyHighlight">    MemCheckCleaner.<a href="/docs/api/classes/llvm/scevexpandercleaner/#ab714e94c2ba068bbd6882e560cef94e2">cleanup</a>();</span></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><span class="doxyHighlight">    SCEVCleaner.<a href="/docs/api/classes/llvm/scevexpandercleaner/#ab714e94c2ba068bbd6882e560cef94e2">cleanup</a>();</span></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SCEVCheckCond)</span></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><span class="doxyHighlight">      SCEVCheckBlock-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MemRuntimeCheckCond)</span></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><span class="doxyHighlight">      MemCheckBlock-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><span class="doxyHighlightComment">  /// Adds the generated SCEVCheckBlock before \\p LoopVectorPreHeader and</span></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><span class="doxyHighlightComment">  /// adjusts the branches to branch to the vector preheader or \\p Bypass,</span></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><span class="doxyHighlightComment">  /// depending on the generated condition.</span></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056" lineLink="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#aa55563b1c40f6c6c94622a87dd7b5dcb"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#aa55563b1c40f6c6c94622a87dd7b5dcb">emitSCEVChecks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass,</span></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopVectorPreHeader) &#123;</span></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SCEVCheckCond)</span></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = SCEVCheckCond;</span></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Mark the check as used, to prevent it from being removed during cleanup.</span></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><span class="doxyHighlight">    SCEVCheckCond = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>))</span></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isZero())</span></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Pred = LoopVectorPreHeader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(LoopVectorPreHeader, SCEVCheckBlock);</span></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create new preheader for vector loop.</span></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OuterLoop)</span></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><span class="doxyHighlight">      OuterLoop-&gt;addBasicBlockToLoop(SCEVCheckBlock, &#42;LI);</span></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><span class="doxyHighlight">    SCEVCheckBlock-&gt;getTerminator()-&gt;eraseFromParent();</span></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><span class="doxyHighlight">    SCEVCheckBlock-&gt;moveBefore(LoopVectorPreHeader);</span></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><span class="doxyHighlight">    Pred-&gt;getTerminator()-&gt;replaceSuccessorWith(LoopVectorPreHeader,</span></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><span class="doxyHighlight">                                                SCEVCheckBlock);</span></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><span class="doxyHighlight">    DT-&gt;addNewBlock(SCEVCheckBlock, Pred);</span></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><span class="doxyHighlight">    DT-&gt;changeImmediateDominator(LoopVectorPreHeader, SCEVCheckBlock);</span></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &amp;BI = &#42;<a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(Bypass, LoopVectorPreHeader, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</span></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddBranchWeights)</span></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(BI, <a href="#a968a5c2971ffa9e8ef81ff86eebaf514">SCEVCheckBypassWeights</a>, </span><span class="doxyHighlightComment">/&#42;IsExpected=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a016a85f7487f995fe80141e102a7a5ae">ReplaceInstWithInst</a>(SCEVCheckBlock-&gt;getTerminator(), &amp;BI);</span></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SCEVCheckBlock;</span></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><span class="doxyHighlightComment">  /// Adds the generated MemCheckBlock before \\p LoopVectorPreHeader and adjusts</span></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><span class="doxyHighlightComment">  /// the branches to branch to the vector preheader or \\p Bypass, depending on</span></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><span class="doxyHighlightComment">  /// the generated condition.</span></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093" lineLink="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#af15e3fefdfa2f5ea86ef5b8eacfa3517"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#af15e3fefdfa2f5ea86ef5b8eacfa3517">emitMemRuntimeChecks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass,</span></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopVectorPreHeader) &#123;</span></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if we generated code that checks in runtime if arrays overlap.</span></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MemRuntimeCheckCond)</span></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Pred = LoopVectorPreHeader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</span></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><span class="doxyHighlight">    Pred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a657e5d1f0907b46daf10219e2b9b5ae5">replaceSuccessorWith</a>(LoopVectorPreHeader,</span></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><span class="doxyHighlight">                                                MemCheckBlock);</span></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><span class="doxyHighlight">    DT-&gt;addNewBlock(MemCheckBlock, Pred);</span></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><span class="doxyHighlight">    DT-&gt;changeImmediateDominator(LoopVectorPreHeader, MemCheckBlock);</span></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><span class="doxyHighlight">    MemCheckBlock-&gt;moveBefore(LoopVectorPreHeader);</span></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OuterLoop)</span></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><span class="doxyHighlight">      OuterLoop-&gt;addBasicBlockToLoop(MemCheckBlock, &#42;LI);</span></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &amp;BI =</span></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><span class="doxyHighlight">        &#42;<a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(Bypass, LoopVectorPreHeader, MemRuntimeCheckCond);</span></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AddBranchWeights) &#123;</span></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(BI, <a href="#a502070b20fa467fb54ba49d6736cf2d3">MemCheckBypassWeights</a>, </span><span class="doxyHighlightComment">/&#42;IsExpected=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a016a85f7487f995fe80141e102a7a5ae">ReplaceInstWithInst</a>(MemCheckBlock-&gt;getTerminator(), &amp;BI);</span></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><span class="doxyHighlight">    MemCheckBlock-&gt;getTerminator()-&gt;setDebugLoc(</span></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><span class="doxyHighlight">        Pred-&gt;getTerminator()-&gt;getDebugLoc());</span></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Mark the check as used, to prevent it from being removed during cleanup.</span></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><span class="doxyHighlight">    MemRuntimeCheckCond = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MemCheckBlock;</span></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// namespace</span></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126" lineLink="#aae88a50a9a37f9a745939e3e726837e6"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#aae88a50a9a37f9a745939e3e726837e6">useActiveLaneMask</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> Style) &#123;</span></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Style == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddaf6068daa29dbb05a7ead1e3b5a48bbee">TailFoldingStyle::Data</a> ||</span></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><span class="doxyHighlight">         Style == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddad817e2199b89933da1a3cd7e130cd782">TailFoldingStyle::DataAndControlFlow</a> ||</span></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><span class="doxyHighlight">         Style == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">TailFoldingStyle::DataAndControlFlowWithoutRuntimeCheck</a>;</span></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132" lineLink="#a4e445204e48d57b1e23e55869146b7ce"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a4e445204e48d57b1e23e55869146b7ce">useActiveLaneMaskForControlFlow</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> Style) &#123;</span></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Style == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddad817e2199b89933da1a3cd7e130cd782">TailFoldingStyle::DataAndControlFlow</a> ||</span></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><span class="doxyHighlight">         Style == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">TailFoldingStyle::DataAndControlFlowWithoutRuntimeCheck</a>;</span></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><span class="doxyHighlightComment">// Return true if \\p OuterLp is an outer loop annotated with hints for explicit</span></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><span class="doxyHighlightComment">// vectorization. The loop needs to be annotated with #pragma omp simd</span></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><span class="doxyHighlightComment">// simdlen(#) or #pragma clang vectorize(enable) vectorize&#95;width(#). If the</span></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><span class="doxyHighlightComment">// vector length information is not provided, vectorization is not considered</span></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><span class="doxyHighlightComment">// explicit. Interleave hints are not allowed either. These limitations will be</span></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><span class="doxyHighlightComment">// relaxed in the future.</span></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><span class="doxyHighlightComment">// Please, note that we are currently forced to abuse the pragma &#39;clang</span></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><span class="doxyHighlightComment">// vectorize&#39; semantics. This pragma provides &#42;auto-vectorization hints&#42;</span></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><span class="doxyHighlightComment">// (i.e., LV must check that vectorization is legal) whereas pragma &#39;omp simd&#39;</span></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><span class="doxyHighlightComment">// provides &#42;explicit vectorization hints&#42; (LV can bypass legal checks and</span></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><span class="doxyHighlightComment">// assume that vectorization is legal). However, both hints are implemented</span></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><span class="doxyHighlightComment">// using the same metadata (llvm.loop.vectorize, processed by</span></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><span class="doxyHighlightComment">// LoopVectorizeHints). This will be fixed in the future when the native IR</span></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><span class="doxyHighlightComment">// representation for pragma &#39;omp simd&#39; is introduced.</span></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151" lineLink="#a806ec23d6f44b02ad8cf3b1e61c05495"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a806ec23d6f44b02ad8cf3b1e61c05495">isExplicitVecOuterLoop</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;OuterLp,</span></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE) &#123;</span></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!OuterLp-&gt;<a href="/docs/api/classes/llvm/loopbase/#a16165c1e5da45acaa086c3a54a188d34">isInnermost</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;This is not an outer loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> Hints(OuterLp, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;DisableInterleaving&#42;/</span><span class="doxyHighlight">, &#42;ORE);</span></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only outer loops with an explicit vectorization hint are supported.</span></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Unannotated outer loops are ignored.</span></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a20ecacbd54e401685d798d86161af6cf">getForce</a>() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea8914fe2dbf82d457456e8e4faa201b87">LoopVectorizeHints::FK&#95;Undefined</a>)</span></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Fn = OuterLp-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a21b6d9e2aa12c8c68d8e2f122ec7ecec">allowVectorization</a>(Fn, OuterLp,</span></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42;VectorizeOnlyWhenForced&#42;/</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Loop hints prevent outer loop vectorization.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#ad98353127dbeb649d41ca07da5074b49">getInterleave</a>() &gt; 1) &#123;</span></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Interleave support is future work.</span></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Not vectorizing: Interleave is not supported for &quot;</span></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;outer loops.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><span class="doxyHighlight">    Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a440979b6103588bef39bd2d62065d5ff">emitRemarkWithHints</a>();</span></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179" lineLink="#a00315ff11c9068aab97e5780bdfa5eef"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a00315ff11c9068aab97e5780bdfa5eef">collectSupportedLoops</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI,</span></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE,</span></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Loop &#42;&gt;</a> &amp;V) &#123;</span></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect inner loops and outer loops without irreducible control flow. For</span></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// now, only collect outer loops that have explicit vectorization hints. If we</span></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are stress testing the VPlan H-CFG construction, we collect the outermost</span></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop of every loop nest.</span></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (L.isInnermost() || <a href="#a9f30855a6efcd4a12875deb88880b510">VPlanBuildStressTest</a> ||</span></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><span class="doxyHighlight">      (<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a> &amp;&amp; <a href="#a806ec23d6f44b02ad8cf3b1e61c05495">isExplicitVecOuterLoop</a>(&amp;L, ORE))) &#123;</span></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopblocksrpo">LoopBlocksRPO</a> RPOT(&amp;L);</span></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><span class="doxyHighlight">    RPOT.<a href="/docs/api/classes/llvm/loopblocksrpo/#aeab06fd248333b13725e55754883b570">perform</a>(LI);</span></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a6dadcd5de1248b4d9893c409e7398c21">containsIrreducibleCFG&lt;const BasicBlock &#42;&gt;</a>(RPOT, &#42;LI)) &#123;</span></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><span class="doxyHighlight">      V.push&#95;back(&amp;L);</span></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: Collect inner loops inside marked outer loops in case</span></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// vectorization fails for the outer loop. Do not invoke</span></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// &#39;containsIrreducibleCFG&#39; again for inner loops when the outer loop is</span></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// already known to be reducible. We can use an inherited attribute for</span></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// that.</span></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;InnerL : L)</span></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><span class="doxyHighlight">    <a href="#a00315ff11c9068aab97e5780bdfa5eef">collectSupportedLoops</a>(&#42;InnerL, LI, ORE, V);</span></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><span class="doxyHighlightComment">// Implementation of LoopVectorizationLegality, InnerLoopVectorizer and</span></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><span class="doxyHighlightComment">// LoopVectorizationCostModel and LoopVectorizationPlanner.</span></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><span class="doxyHighlightComment">//===----------------------------------------------------------------------===//</span></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><span class="doxyHighlightComment">/// Compute the transformed value of Index at offset StartValue using step</span></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><span class="doxyHighlightComment">/// StepValue.</span></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><span class="doxyHighlightComment">/// For integer induction, returns StartValue + Index &#42; StepValue.</span></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><span class="doxyHighlightComment">/// For pointer induction, returns StartValue&#91;Index &#42; StepValue&#93;.</span></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><span class="doxyHighlightComment">/// FIXME: The newly created binary instructions should contain nsw/nuw</span></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><span class="doxyHighlightComment">/// flags, which can be found from the original scalar operations.</span></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;</span></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216" lineLink="#a23f5821d9ac264ae25dd087747e2c181"><span class="doxyHighlight"><a href="#a23f5821d9ac264ae25dd087747e2c181">emitTransformedIndex</a>(<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Index, <a href="/docs/api/classes/llvm/value">Value</a> &#42;StartValue,</span></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/value">Value</a> &#42;Step,</span></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><span class="doxyHighlight">                     <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabcc">InductionDescriptor::InductionKind</a> InductionKind,</span></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><span class="doxyHighlight">                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;InductionBinOp) &#123;</span></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;StepTy = Step-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastedIndex = StepTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>()</span></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><span class="doxyHighlight">                           ? <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateSExtOrTrunc(Index, StepTy)</span></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><span class="doxyHighlight">                           : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateCast(Instruction::SIToFP, Index, StepTy);</span></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CastedIndex != Index) &#123;</span></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><span class="doxyHighlight">    CastedIndex-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(CastedIndex-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </span><span class="doxyHighlightStringLiteral">&quot;.cast&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><span class="doxyHighlight">    Index = CastedIndex;</span></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note: the IR at this point is broken. We cannot use SE to create any new</span></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// SCEV and then expand it, hoping that SCEV&#39;s simplification will give us</span></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a more optimal code. Unfortunately, attempt of doing so on invalid IR may</span></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// lead to various SCEV crashes. So all we can do is to use builder and rely</span></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// on InstCombine for future simplifications. Here we handle some trivial</span></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cases only.</span></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/reassociate-cpp/#a4b946333b7fb96fec126f22534cf3794">CreateAdd</a> = &#91;&amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>) &#123;</span></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Types don&#39;t match!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CX = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))</span></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CX-&gt;isZero())</span></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</span></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CY = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))</span></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CY-&gt;isZero())</span></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</span></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateAdd(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</span></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We allow X to be a vector type, in which case Y will potentially be</span></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// splatted into a vector with the same element count.</span></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/reassociate-cpp/#a3621b702ef72b987959cdd7242c13d47">CreateMul</a> = &#91;&amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>) &#123;</span></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType()-&gt;getScalarType() == <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType() &amp;&amp;</span></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Types don&#39;t match!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CX = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))</span></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CX-&gt;isOne())</span></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</span></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CY = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))</span></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CY-&gt;isOne())</span></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</span></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><span class="doxyHighlight">    <a href="/docs/api/classes/vectortype">VectorType</a> &#42;XVTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VectorType&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType());</span></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (XVTy &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType()))</span></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateVectorSplat(XVTy-&gt;getElementCount(), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</span></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateMul(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</span></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (InductionKind) &#123;</span></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabccaf0191e822c9708e106d7bb58aa9ec947">InductionDescriptor::IK&#95;IntInduction</a>: &#123;</span></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(Index-&gt;getType()) &amp;&amp;</span></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Vector indices not supported for integer inductions yet&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Index-&gt;getType() == StartValue-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() &amp;&amp;</span></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Index type does not match StartValue type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Step) &amp;&amp; <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(Step)-&gt;isMinusOne())</span></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateSub(StartValue, Index);</span></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/reassociate-cpp/#a3621b702ef72b987959cdd7242c13d47">CreateMul</a>(Index, Step);</span></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/reassociate-cpp/#a4b946333b7fb96fec126f22534cf3794">CreateAdd</a>(StartValue, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</span></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabccab61689ca7d0a024fc4ff52a74d691ae2">InductionDescriptor::IK&#95;PtrInduction</a>:</span></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreatePtrAdd(StartValue, <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/reassociate-cpp/#a3621b702ef72b987959cdd7242c13d47">CreateMul</a>(Index, Step));</span></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabccab0b71801de025f26b088a8cb22825f79">InductionDescriptor::IK&#95;FpInduction</a>: &#123;</span></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(Index-&gt;getType()) &amp;&amp;</span></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Vector indices not supported for FP inductions yet&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Step-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected FP Step value&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InductionBinOp &amp;&amp;</span></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><span class="doxyHighlight">           (InductionBinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::FAdd ||</span></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><span class="doxyHighlight">            InductionBinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::FSub) &amp;&amp;</span></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Original bin op should be defined for FP induction&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;MulExp = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateFMul(Step, Index);</span></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateBinOp(InductionBinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), StartValue, MulExp,</span></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;induction&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabcca85d6fca1e5ba292e9d884797aa73f545">InductionDescriptor::IK&#95;NoInduction</a>:</span></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;invalid enum&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295" lineLink="#a604c96744d2e46447f11e2d3aab9a9b2"><span class="doxyHighlight">std::optional&lt;unsigned&gt; <a href="#a604c96744d2e46447f11e2d3aab9a9b2">getMaxVScale</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><span class="doxyHighlight">                                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (std::optional&lt;unsigned&gt; MaxVScale = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getMaxVScale())</span></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MaxVScale;</span></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(Attribute::VScaleRange))</span></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getFnAttribute(Attribute::VScaleRange).getVScaleRangeMax();</span></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><span class="doxyHighlightComment">/// For the given VF and UF and maximum trip count computed for the loop, return</span></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><span class="doxyHighlightComment">/// whether the induction variable might overflow in the vectorized loop. If not,</span></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><span class="doxyHighlightComment">/// then we know a runtime overflow check always evaluates to false and can be</span></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><span class="doxyHighlightComment">/// removed.</span></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310" lineLink="#ab7edde995b7986f98c3f59788b960eba"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#ab7edde995b7986f98c3f59788b960eba">isIndvarOverflowCheckKnownFalse</a>(</span></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> &#42;<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>,</span></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, std::optional&lt;unsigned&gt; UF = std::nullopt) &#123;</span></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Always be conservative if we don&#39;t know the exact unroll factor.</span></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxUF = UF ? &#42;UF : <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>-&gt;TTI.getMaxInterleaveFactor(VF);</span></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;IdxTy = <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>-&gt;Legal-&gt;getWidestInductionType();</span></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/apint">APInt</a> MaxUIntTripCount = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(IdxTy)-&gt;getMask();</span></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We know the runtime overflow check is known false iff the (max) trip-count</span></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is known and (max) trip-count + (VF &#42; UF) does not overflow in the type of</span></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the vector loop induction variable.</span></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TC = <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>-&gt;PSE.getSmallConstantMaxTripCount()) &#123;</span></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><span class="doxyHighlight">    uint64&#95;t MaxVF = VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>();</span></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>()) &#123;</span></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><span class="doxyHighlight">      std::optional&lt;unsigned&gt; MaxVScale =</span></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><span class="doxyHighlight">          <a href="#a604c96744d2e46447f11e2d3aab9a9b2">getMaxVScale</a>(&#42;<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>-&gt;TheFunction, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>-&gt;TTI);</span></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MaxVScale)</span></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><span class="doxyHighlight">      MaxVF &#42;= &#42;MaxVScale;</span></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (MaxUIntTripCount - TC).ugt(MaxVF &#42; MaxUF);</span></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><span class="doxyHighlightComment">// Return whether we allow using masked interleave-groups (for dealing with</span></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><span class="doxyHighlightComment">// strided loads/stores that reside in predicated blocks, or for dealing</span></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><span class="doxyHighlightComment">// with gaps).</span></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341" lineLink="#adf8d8fb6f39b9c0cf21d55b7229d35e2"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#adf8d8fb6f39b9c0cf21d55b7229d35e2">useMaskedInterleavedAccesses</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If an override option has been passed in for interleaved accesses, use it.</span></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ac68ad295befb7187ae293cc0faaa3ac3">EnableMaskedInterleavedMemAccesses</a>.getNumOccurrences() &gt; 0)</span></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#ac68ad295befb7187ae293cc0faaa3ac3">EnableMaskedInterleavedMemAccesses</a>;</span></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.enableMaskedInterleavedAccessVectorization();</span></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a4690286163882c35068b1908f4d752fd"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a4690286163882c35068b1908f4d752fd">InnerLoopVectorizer::scalarizeInstruction</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr,</span></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a> &#42;RepRecipe,</span></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><span class="doxyHighlight">                                               </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vplane">VPLane</a> &amp;Lane,</span></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><span class="doxyHighlight">                                               <a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State) &#123;</span></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Instr-&gt;getType()-&gt;isAggregateType() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t handle vectors&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Does this instruction return a value ?</span></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsVoidRetTy = Instr-&gt;getType()-&gt;isVoidTy();</span></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Cloned = Instr-&gt;clone();</span></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsVoidRetTy) &#123;</span></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><span class="doxyHighlight">    Cloned-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(Instr-&gt;getName() + </span><span class="doxyHighlightStringLiteral">&quot;.cloned&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><span class="doxyHighlightPreprocessor">#if !defined(NDEBUG)</span></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Verify that VPlan type inference results agree with the type of the</span></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// generated values.</span></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(State.TypeAnalysis.inferScalarType(RepRecipe) == Cloned-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() &amp;&amp;</span></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;inferred type and type from generated instructions do not match&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><span class="doxyHighlight">  RepRecipe-&gt;<a href="/docs/api/classes/llvm/vprecipewithirflags/#a3864f5d4ddd326182fa0499094807f2a">setFlags</a>(Cloned);</span></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = Instr-&gt;getDebugLoc())</span></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><span class="doxyHighlight">    State.setDebugLocFrom(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace the operands of the cloned instructions with their scalar</span></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// equivalents in the new loop.</span></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(RepRecipe-&gt;<a href="/docs/api/classes/llvm/vpuser/#a11d83265a9e4ff6c6ecd3cf222ad0208">operands</a>())) &#123;</span></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InputLane = Lane;</span></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Operand = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.value();</span></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/vputils/#a002a77cdbc23293b8f7a8458ffd0f905">vputils::isUniformAfterVectorization</a>(Operand))</span></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><span class="doxyHighlight">      InputLane = <a href="/docs/api/classes/llvm/vplane/#af6be7b0459911799a13a8174138c7020">VPLane::getFirstLane</a>();</span></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><span class="doxyHighlight">    Cloned-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.index(), State.get(Operand, InputLane));</span></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><span class="doxyHighlight">  State.addNewMetadata(Cloned, Instr);</span></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Place the cloned scalar in the new loop.</span></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><span class="doxyHighlight">  State.Builder.Insert(Cloned);</span></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><span class="doxyHighlight">  State.set(RepRecipe, Cloned, Lane);</span></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we just cloned a new assumption, add it the assumption cache.</span></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AssumeInst&gt;</a>(Cloned))</span></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>-&gt;registerAssumption(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</span></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// End if-block.</span></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;Parent = RepRecipe-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a09de70cbaf2f15aa3b0697b5f378cc9d">getParent</a>();</span></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IfPredicateInstr = Parent ? Parent-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#a24555c6ed92715d80348f0991a6d55df">isReplicator</a>() : </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><span class="doxyHighlight">      (Parent || !RepRecipe-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a8d57e2fe646928a51e97714005eefdc7">getPlan</a>()-&gt;<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>() ||</span></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><span class="doxyHighlight">       <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(RepRecipe-&gt;<a href="/docs/api/classes/llvm/vpuser/#a11d83265a9e4ff6c6ecd3cf222ad0208">operands</a>(),</span></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><span class="doxyHighlight">              &#91;&#93;(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123; return Op-&gt;isDefinedOutsideLoopRegions(); &#125;)) &amp;&amp;</span></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;Expected a recipe is either within a region or all of its operands &quot;</span></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;are defined outside the vectorized region.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IfPredicateInstr)</span></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#a47eab9fa7cfa73af0b164da3fca49a0f">PredicatedInstructions</a>.push&#95;back(Cloned);</span></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/value">Value</a> &#42;</span></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#aa83b181aa14d5afe1390faad388f91a4"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/innerloopvectorizer/#aa83b181aa14d5afe1390faad388f91a4">InnerLoopVectorizer::getOrCreateVectorTripCount</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InsertBlock) &#123;</span></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/innerloopvectorizer/#a2c95f95757d9c56b7a89d7f8b3278581">VectorTripCount</a>)</span></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a2c95f95757d9c56b7a89d7f8b3278581">VectorTripCount</a>;</span></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;TC = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696">getTripCount</a>();</span></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>(InsertBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = TC-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is where we can make the step a runtime constant.</span></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Step = <a href="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e">createStepForVF</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>, Ty, <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>);</span></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the tail is to be folded by masking, round the number of iterations N</span></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// up to a multiple of Step instead of rounding down. This is done by first</span></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// adding Step-1 and then rounding down. Note that it&#39;s ok if this addition</span></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// overflows: the vector induction variable will eventually wrap to zero given</span></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that it starts at zero and its Step is a power of two; the loop will then</span></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// exit, with the last early-exit vector comparison also producing all-true.</span></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For scalable vectors the VF is not guaranteed to be a power of 2, but this</span></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is accounted for in emitIterationCountCheck that adds an overflow check.</span></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>-&gt;foldTailByMasking()) &#123;</span></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.getKnownMinValue() &#42; <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>) &amp;&amp;</span></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;VF&#42;UF must be a power of 2 when folding tail by masking&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><span class="doxyHighlight">    TC = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateAdd(TC, <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateSub(Step, ConstantInt::get(Ty, 1)),</span></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><span class="doxyHighlight">                           </span><span class="doxyHighlightStringLiteral">&quot;n.rnd.up&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now we need to generate the expression for the part of the loop that the</span></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorized body will execute. This is equal to N - (N % Step) if scalar</span></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// iterations are not required for correctness, or N - Step, otherwise. Step</span></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is equal to the vectorization factor (number of SIMD elements) times the</span></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// unroll factor (number of SIMD instructions).</span></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;R = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateURem(TC, Step, </span><span class="doxyHighlightStringLiteral">&quot;n.mod.vf&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// There are cases where we &#42;must&#42; run at least one iteration in the remainder</span></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop.  See the cost model for when this can happen.  If the step evenly</span></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// divides the trip count, we set the remainder to be equal to the step. If</span></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the step does not evenly divide the trip count, no adjustment is necessary</span></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// since there will already be scalar iterations. Note that the minimum</span></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// iterations check ensures that N &gt;= Step.</span></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>-&gt;requiresScalarEpilogue(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.isVector())) &#123;</span></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IsZero = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateICmpEQ(R, ConstantInt::get(R-&gt;getType(), 0));</span></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><span class="doxyHighlight">    R = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateSelect(IsZero, Step, R);</span></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a2c95f95757d9c56b7a89d7f8b3278581">VectorTripCount</a> = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateSub(TC, R, </span><span class="doxyHighlightStringLiteral">&quot;n.vec&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a2c95f95757d9c56b7a89d7f8b3278581">VectorTripCount</a>;</span></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9">InnerLoopVectorizer::introduceCheckBlockInVPlan</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CheckIRBB) &#123;</span></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;ScalarPH = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.getScalarPreheader();</span></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;PreVectorPH = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6b18db1093ed5460e67e9058b89e385b">VectorPHVPB</a>-&gt;getSinglePredecessor();</span></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PreVectorPH-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a2c13ffed8c55e1b8dd38fedc7e71e7a8">getNumSuccessors</a>() != 1) &#123;</span></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PreVectorPH-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a2c13ffed8c55e1b8dd38fedc7e71e7a8">getNumSuccessors</a>() == 2 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected 2 successors&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PreVectorPH-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aeccf6a036968755c6d86e2d2bb17673a">getSuccessors</a>()&#91;0&#93; == ScalarPH &amp;&amp;</span></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Unexpected successor&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> &#42;CheckVPIRBB = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.createVPIRBasicBlock(CheckIRBB);</span></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpblockutils/#a2057d0749eedf6749f9e1cc6694eb1fd">VPBlockUtils::insertOnEdge</a>(PreVectorPH, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6b18db1093ed5460e67e9058b89e385b">VectorPHVPB</a>, CheckVPIRBB);</span></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><span class="doxyHighlight">    PreVectorPH = CheckVPIRBB;</span></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpblockutils/#a40bc7fec35d7093efcdbadf566d6b5ee">VPBlockUtils::connectBlocks</a>(PreVectorPH, ScalarPH);</span></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><span class="doxyHighlight">  PreVectorPH-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a43f7e15ac1a813112684effc1e5593a4">swapSuccessors</a>();</span></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a72c491cdf8cf0283d87008831431f917"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a72c491cdf8cf0283d87008831431f917">InnerLoopVectorizer::emitIterationCountCheck</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass) &#123;</span></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696">getTripCount</a>();</span></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reuse existing vector loop preheader for TC checks.</span></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that new preheader block is generated for vector loop.</span></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> TCCheckBlock = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>;</span></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>(TCCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate code to check if the loop&#39;s trip count is less than VF &#42; UF, or</span></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// equal to it in case a scalar epilogue is required; this implies that the</span></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vector trip count is zero. This check also covers the case where adding one</span></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to the backedge-taken count overflowed leading to an incorrect trip count</span></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of zero. In this case we will also jump to the scalar loop.</span></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>-&gt;requiresScalarEpilogue(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.isVector()) ? <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">ICmpInst::ICMP&#95;ULE</a></span></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><span class="doxyHighlight">                                                       : <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>;</span></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If tail is to be folded, vector loop takes care of all iterations.</span></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CountTy = <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>-&gt;getType();</span></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CheckMinIters = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.getFalse();</span></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CreateStep = &#91;&amp;&#93;() -&gt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &#123;</span></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Create step with max(MinProTripCount, UF &#42; VF).</span></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a> &#42; <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.getKnownMinValue() &gt;= <a href="/docs/api/classes/llvm/innerloopvectorizer/#a1f52585230b8a3cb8bf4a30f8e51bfb4">MinProfitableTripCount</a>.getKnownMinValue())</span></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e">createStepForVF</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>, CountTy, <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>);</span></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;MinProfTC =</span></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e">createStepForVF</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>, CountTy, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a1f52585230b8a3cb8bf4a30f8e51bfb4">MinProfitableTripCount</a>, 1);</span></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.isScalable())</span></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MinProfTC;</span></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateBinaryIntrinsic(</span></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><span class="doxyHighlight">        Intrinsic::umax, MinProfTC, <a href="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e">createStepForVF</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>, CountTy, <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>));</span></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> Style = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>-&gt;getTailFoldingStyle();</span></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Style == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>) &#123;</span></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Step = CreateStep();</span></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE = &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>.getSE();</span></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Emit unconditional branch to vector preheader instead of</span></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// conditional branch with known condition.</span></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;TripCountSCEV = SE.<a href="/docs/api/classes/llvm/scalarevolution/#ad146072469181af4ccb7ef03c28999ba">applyLoopGuards</a>(SE.<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>);</span></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if the trip count is &lt; the step.</span></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE.<a href="/docs/api/classes/llvm/scalarevolution/#af74112dae88db73eb5484821b6f0fccd">isKnownPredicate</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, TripCountSCEV, SE.<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Step))) &#123;</span></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: Ensure step is at most the trip count when determining max VF and</span></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// UF, w/o tail folding.</span></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><span class="doxyHighlight">      CheckMinIters = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.getTrue();</span></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE.<a href="/docs/api/classes/llvm/scalarevolution/#af74112dae88db73eb5484821b6f0fccd">isKnownPredicate</a>(<a href="/docs/api/classes/llvm/cmpinst/#aa2a54b545d237ecfe450fd1292f7675e">CmpInst::getInversePredicate</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>),</span></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><span class="doxyHighlight">                                    TripCountSCEV, SE.<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Step))) &#123;</span></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Generate the minimum iteration check only if we cannot prove the</span></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// check is known to be true, or known to be false.</span></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><span class="doxyHighlight">      CheckMinIters = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateICmp(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>, Step, </span><span class="doxyHighlightStringLiteral">&quot;min.iters.check&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightComment">// else step known to be &lt; trip count, use CheckMinIters preset to false.</span></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.isScalable() &amp;&amp;</span></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><span class="doxyHighlight">             !<a href="#ab7edde995b7986f98c3f59788b960eba">isIndvarOverflowCheckKnownFalse</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>) &amp;&amp;</span></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><span class="doxyHighlight">             Style != <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">TailFoldingStyle::DataAndControlFlowWithoutRuntimeCheck</a>) &#123;</span></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// vscale is not necessarily a power-of-2, which means we cannot guarantee</span></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// an overflow to zero when updating induction variables and so an</span></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// additional overflow check is required before entering the vector loop.</span></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Get the maximum unsigned value for the type.</span></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;MaxUIntTripCount =</span></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><span class="doxyHighlight">        ConstantInt::get(CountTy, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(CountTy)-&gt;getMask());</span></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateSub(MaxUIntTripCount, <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>);</span></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t execute the vector loop if (UMax - n) &lt; (VF &#42; UF).</span></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><span class="doxyHighlight">    CheckMinIters = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateICmp(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>, LHS, CreateStep());</span></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create new preheader for vector loop.</span></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a> =</span></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(TCCheckBlock, TCCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;vector.ph&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;properlyDominates(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;getNode(TCCheckBlock),</span></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;getNode(Bypass)-&gt;getIDom()) &amp;&amp;</span></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;TC check is expected to dominate Bypass&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &amp;BI =</span></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><span class="doxyHighlight">      &#42;<a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(Bypass, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>, CheckMinIters);</span></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getLoopLatch()-&gt;getTerminator()))</span></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(BI, <a href="#a629884e9a99a9f49106db9e5e6252fcb">MinItersBypassWeights</a>, </span><span class="doxyHighlightComment">/&#42;IsExpected=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a016a85f7487f995fe80141e102a7a5ae">ReplaceInstWithInst</a>(TCCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), &amp;BI);</span></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(TCCheckBlock);</span></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Wrap LoopVectorPreHeader in VPIRBasicBlock here.</span></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9">introduceCheckBlockInVPlan</a>(TCCheckBlock);</span></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a30c4bcea7beb42c7eb075a578bc3bc3e"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a30c4bcea7beb42c7eb075a578bc3bc3e">InnerLoopVectorizer::emitSCEVChecks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass) &#123;</span></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEVCheckBlock =</span></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae9880a8edd20b3b9b1527ecd5a03ac8c">RTChecks</a>.emitSCEVChecks(Bypass, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>);</span></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SCEVCheckBlock)</span></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!(SCEVCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a1c455e007178a24dfb18ac0e200ea02c">hasOptSize</a>() ||</span></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><span class="doxyHighlight">           (<a href="/docs/api/classes/llvm/innerloopvectorizer/#a93a8f97a1e57c3bce2e7c3473d592c01">OptForSizeBasedOnProfile</a> &amp;&amp;</span></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>-&gt;Hints-&gt;getForce() != <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a>)) &amp;&amp;</span></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Cannot SCEV check stride or overflow when optimizing for size&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.empty() &amp;&amp;</span></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Should already be a bypass block due to iteration count check&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(SCEVCheckBlock);</span></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a645c5c5c1e89cb56be66db8db877001d">AddedSafetyChecks</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9">introduceCheckBlockInVPlan</a>(SCEVCheckBlock);</span></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SCEVCheckBlock;</span></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a625caa931f0d8ef201041febbfe42cca"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a625caa931f0d8ef201041febbfe42cca">InnerLoopVectorizer::emitMemRuntimeChecks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass) &#123;</span></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// VPlan-native path does not do any analysis for runtime checks currently.</span></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a>)</span></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> MemCheckBlock =</span></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae9880a8edd20b3b9b1527ecd5a03ac8c">RTChecks</a>.emitMemRuntimeChecks(Bypass, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>);</span></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if we generated code that checks in runtime if arrays overlap. We put</span></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the checks into a separate block to make the more common case of few</span></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// elements faster.</span></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MemCheckBlock)</span></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MemCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a1c455e007178a24dfb18ac0e200ea02c">hasOptSize</a>() || <a href="/docs/api/classes/llvm/innerloopvectorizer/#a93a8f97a1e57c3bce2e7c3473d592c01">OptForSizeBasedOnProfile</a>) &#123;</span></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>-&gt;Hints-&gt;getForce() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a> &amp;&amp;</span></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Cannot emit memory checks when optimizing for size, unless forced &quot;</span></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;to vectorize.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;VectorizationCodeSize&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getStartLoc(),</span></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getHeader())</span></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Code-size may be reduced by not forcing &quot;</span></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><span class="doxyHighlight">                </span><span class="doxyHighlightStringLiteral">&quot;vectorization, or by source-code modifications &quot;</span></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><span class="doxyHighlight">                </span><span class="doxyHighlightStringLiteral">&quot;eliminating the need for runtime checks &quot;</span></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><span class="doxyHighlight">                </span><span class="doxyHighlightStringLiteral">&quot;(e.g., adding &#39;restrict&#39;).&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(MemCheckBlock);</span></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a645c5c5c1e89cb56be66db8db877001d">AddedSafetyChecks</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9">introduceCheckBlockInVPlan</a>(MemCheckBlock);</span></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MemCheckBlock;</span></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><span class="doxyHighlightComment">/// Replace \\p VPBB with a VPIRBasicBlock wrapping \\p IRBB. All recipes from \\p</span></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><span class="doxyHighlightComment">/// VPBB are moved to the end of the newly created VPIRBasicBlock. VPBB must</span></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><span class="doxyHighlightComment">/// have a single predecessor, which is rewired to the new VPIRBasicBlock. All</span></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><span class="doxyHighlightComment">/// successors of VPBB, if any, are rewired to the new VPIRBasicBlock.</span></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617" lineLink="#a3a8743a69fac5e7fa9c2b02604b2cf2f"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a3a8743a69fac5e7fa9c2b02604b2cf2f">replaceVPBBWithIRVPBB</a>(<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IRBB) &#123;</span></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> &#42;IRVPBB = VPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a8d57e2fe646928a51e97714005eefdc7">getPlan</a>()-&gt;<a href="/docs/api/classes/llvm/vplan/#aa12c0d3acb3f625ee09d2919907d4067">createVPIRBasicBlock</a>(IRBB);</span></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;VPBB)) &#123;</span></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!R.isPhi() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Tried to move phi recipe to end of block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><span class="doxyHighlight">    R.moveBefore(&#42;IRVPBB, IRVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a4a7f4b8433e9a788149ffd94a0a07051">end</a>());</span></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpblockutils/#a63345282cd67ea46202fb33523be1408">VPBlockUtils::reassociateBlocks</a>(VPBB, IRVPBB);</span></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// VPBB is now dead and will be cleaned up when the plan gets destroyed.</span></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a5e719da4709193fd5b4632da4bc69795"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5e719da4709193fd5b4632da4bc69795">InnerLoopVectorizer::createVectorLoopSkeleton</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a> Prefix) &#123;</span></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a> = <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getLoopPreheader();</span></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Invalid loop structure&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getUniqueLatchExitBlock() ||</span></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>-&gt;requiresScalarEpilogue(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.isVector())) &amp;&amp;</span></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;loops not exiting via the latch without required epilogue?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a38e6f65b6ccbdebbf2c7a8b078936115">LoopMiddleBlock</a> =</span></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>-&gt;getTerminator(), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>,</span></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/twine">Twine</a>(Prefix) + </span><span class="doxyHighlightStringLiteral">&quot;middle.block&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><span class="doxyHighlight">  <a href="#a3a8743a69fac5e7fa9c2b02604b2cf2f">replaceVPBBWithIRVPBB</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.getMiddleBlock(), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a38e6f65b6ccbdebbf2c7a8b078936115">LoopMiddleBlock</a>);</span></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a> =</span></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a38e6f65b6ccbdebbf2c7a8b078936115">LoopMiddleBlock</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a38e6f65b6ccbdebbf2c7a8b078936115">LoopMiddleBlock</a>-&gt;getTerminator(), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>,</span></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><span class="doxyHighlight">                 </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/twine">Twine</a>(Prefix) + </span><span class="doxyHighlightStringLiteral">&quot;scalar.ph&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><span class="doxyHighlight">  <a href="#a3a8743a69fac5e7fa9c2b02604b2cf2f">replaceVPBBWithIRVPBB</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.getScalarPreheader(), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</span></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><span class="doxyHighlightComment">/// Return the expanded step for \\p ID using \\p ExpandedSCEVs to look up SCEV</span></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><span class="doxyHighlightComment">/// expansion results.</span></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647" lineLink="#aa8d4cfce02b245d616238ce8eed74718"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#aa8d4cfce02b245d616238ce8eed74718">getExpandedStep</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>,</span></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><span class="doxyHighlight">                              </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV2ValueTy &amp;ExpandedSCEVs) &#123;</span></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;Step = <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getStep();</span></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(Step))</span></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getValue();</span></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;U = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVUnknown&gt;</a>(Step))</span></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> U-&gt;getValue();</span></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ExpandedSCEVs.find(Step);</span></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ExpandedSCEVs.end() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;SCEV must be expanded at this point&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</span></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><span class="doxyHighlightComment">/// Knowing that loop \\p L executes a single vector iteration, add instructions</span></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><span class="doxyHighlightComment">/// that will get simplified and thus should not have any cost to \\p</span></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><span class="doxyHighlightComment">/// InstsToIgnore.</span></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662" lineLink="#ababcaf6e2e00fc3fc8791ea2c3acbda5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#ababcaf6e2e00fc3fc8791ea2c3acbda5">addFullyUnrolledInstructionsToIgnore</a>(</span></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationlegality/#a063c4d98febe7ef90dddbfedcfc59d16">LoopVectorizationLegality::InductionList</a> &amp;IL,</span></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;Instruction &#42;&gt;</a> &amp;InstsToIgnore) &#123;</span></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Cmp = L-&gt;getLatchCmpInst();</span></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Cmp)</span></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><span class="doxyHighlight">    InstsToIgnore.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Cmp);</span></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;KV : IL) &#123;</span></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Extract the key by hand so that it can be used in the lambda below.  Note</span></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that captured structured bindings are a C++20 extension.</span></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = KV.first;</span></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Get next iteration value of the induction variable.</span></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVInst =</span></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getIncomingValueForBlock(L-&gt;getLoopLatch()));</span></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(IVInst-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>(),</span></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><span class="doxyHighlight">               &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123; return U == IV || U == Cmp; &#125;))</span></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><span class="doxyHighlight">      InstsToIgnore.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(IVInst);</span></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a69c116deda6ae831a71558a4630323cb"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a69c116deda6ae831a71558a4630323cb">InnerLoopVectorizer::createInductionAdditionalBypassValues</a>(</span></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV2ValueTy &amp;ExpandedSCEVs, <a href="/docs/api/classes/llvm/value">Value</a> &#42;MainVectorTripCount) &#123;</span></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MainVectorTripCount &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Must have bypass information&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OldInduction = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6bb946cd99f8c37f0145265914aea778">Legal</a>-&gt;getPrimaryInduction();</span></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> BypassBuilder(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a8f2e87f456c35fdad0ec24e7c71a92a5">getAdditionalBypassBlock</a>(),</span></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/innerloopvectorizer/#a8f2e87f456c35fdad0ec24e7c71a92a5">getAdditionalBypassBlock</a>()-&gt;getFirstInsertionPt());</span></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;InductionEntry : <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6bb946cd99f8c37f0145265914aea778">Legal</a>-&gt;getInductionVars()) &#123;</span></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;OrigPhi = InductionEntry.first;</span></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = InductionEntry.second;</span></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Step = <a href="#aa8d4cfce02b245d616238ce8eed74718">getExpandedStep</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, ExpandedSCEVs);</span></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For the primary induction the additional bypass end value is known.</span></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise it is computed.</span></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;EndValueFromAdditionalBypass = MainVectorTripCount;</span></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OrigPhi != OldInduction) &#123;</span></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BinOp = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getInductionBinOp();</span></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Fast-math-flags propagate from the original induction instruction.</span></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a4956305191cdba7f9995569d011a5ab7">isa&#95;and&#95;nonnull&lt;FPMathOperator&gt;</a>(BinOp))</span></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><span class="doxyHighlight">        BypassBuilder.<a href="/docs/api/classes/llvm/irbuilderbase/#a6370e29617c71c8081bbbc68d6058403">setFastMathFlags</a>(BinOp-&gt;getFastMathFlags());</span></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Compute the end value for the additional bypass.</span></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><span class="doxyHighlight">      EndValueFromAdditionalBypass =</span></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><span class="doxyHighlight">          <a href="#a23f5821d9ac264ae25dd087747e2c181">emitTransformedIndex</a>(BypassBuilder, MainVectorTripCount,</span></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><span class="doxyHighlight">                               <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getStartValue(), Step, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getKind(), BinOp);</span></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><span class="doxyHighlight">      EndValueFromAdditionalBypass-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</span><span class="doxyHighlightStringLiteral">&quot;ind.end&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Store the bypass value here, as it needs to be added as operand to its</span></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scalar preheader phi node after the epilogue skeleton has been created.</span></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Directly add as extra operand to the VPResumePHI recipe.</span></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/classes/llvm/innerloopvectorizer/#a48c4aed6852a39d4dcc584ac75cc1055">Induction2AdditionalBypassValue</a>.contains(OrigPhi) &amp;&amp;</span></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;entry for OrigPhi already exits&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#a48c4aed6852a39d4dcc584ac75cc1055">Induction2AdditionalBypassValue</a>&#91;OrigPhi&#93; = EndValueFromAdditionalBypass;</span></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a31f933a6eada9926c9e320db27dfb775"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a31f933a6eada9926c9e320db27dfb775">InnerLoopVectorizer::createVectorizedLoopSkeleton</a>(</span></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV2ValueTy &amp;ExpandedSCEVs) &#123;</span></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">/&#42;</span></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><span class="doxyHighlightComment">   In this function we generate a new loop. The new loop will contain</span></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><span class="doxyHighlightComment">   the vectorized instructions while the old loop will continue to run the</span></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><span class="doxyHighlightComment">   scalar remainder.</span></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><span class="doxyHighlightComment">       &#91; &#93; &lt;-- old preheader - loop iteration number check and SCEVs in Plan&#39;s</span></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><span class="doxyHighlightComment">     /  |      preheader are expanded here. Eventually all required SCEV</span></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><span class="doxyHighlightComment">    /   |      expansion should happen here.</span></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><span class="doxyHighlightComment">   /    v</span></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><span class="doxyHighlightComment">  |    &#91; &#93; &lt;-- vector loop bypass (may consist of multiple blocks).</span></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><span class="doxyHighlightComment">  |  /  |</span></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><span class="doxyHighlightComment">  | /   v</span></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><span class="doxyHighlightComment">  ||   &#91; &#93;     &lt;-- vector pre header.</span></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><span class="doxyHighlightComment">  |/    |</span></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><span class="doxyHighlightComment">  |     v</span></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><span class="doxyHighlightComment">  |    &#91;  &#93; \\</span></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><span class="doxyHighlightComment">  |    &#91;  &#93;&#95;|   &lt;-- vector loop (created during VPlan execution).</span></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><span class="doxyHighlightComment">  |     |</span></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><span class="doxyHighlightComment">  |     v</span></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><span class="doxyHighlightComment">  \\   -&#91; &#93;   &lt;--- middle-block (wrapped in VPIRBasicBlock with the branch to</span></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><span class="doxyHighlightComment">   |    |                       successors created during VPlan execution)</span></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><span class="doxyHighlightComment">   \\/   |</span></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><span class="doxyHighlightComment">   /\\   v</span></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><span class="doxyHighlightComment">   | -&gt;&#91; &#93;     &lt;--- new preheader (wrapped in VPIRBasicBlock).</span></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><span class="doxyHighlightComment">   |    |</span></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><span class="doxyHighlightComment"> (opt)  v      &lt;-- edge from middle to exit iff epilogue is not required.</span></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><span class="doxyHighlightComment">   |   &#91; &#93; \\</span></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><span class="doxyHighlightComment">   |   &#91; &#93;&#95;|   &lt;-- old scalar loop to handle remainder (scalar epilogue, header</span></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><span class="doxyHighlightComment">   |    |          wrapped in VPIRBasicBlock).</span></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><span class="doxyHighlightComment">    \\   |</span></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><span class="doxyHighlightComment">     \\  v</span></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><span class="doxyHighlightComment">      &gt;&#91; &#93;     &lt;-- exit block(s). (wrapped in VPIRBasicBlock)</span></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><span class="doxyHighlightComment">   ...</span></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><span class="doxyHighlightComment">   &#42;/</span></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create an empty vector loop, and prepare basic blocks for the runtime</span></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// checks.</span></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5e719da4709193fd5b4632da4bc69795">createVectorLoopSkeleton</a>(</span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now, compare the new count to zero. If it is zero skip the vector loop and</span></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// jump to the scalar loop. This check also covers the case where the</span></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// backedge-taken count is uint##&#95;max: adding one to it will overflow leading</span></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to an incorrect trip count of zero. In this (rare) case we will also jump</span></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to the scalar loop.</span></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a72c491cdf8cf0283d87008831431f917">emitIterationCountCheck</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</span></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate the code to check any assumptions that we&#39;ve made for SCEV</span></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// expressions.</span></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a30c4bcea7beb42c7eb075a578bc3bc3e">emitSCEVChecks</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</span></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate the code that checks in runtime if arrays overlap. We put the</span></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// checks into a separate block to make the more common case of few elements</span></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// faster.</span></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a625caa931f0d8ef201041febbfe42cca">emitMemRuntimeChecks</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</span></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>;</span></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><span class="doxyHighlightKeyword">namespace </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780" lineLink="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo"><span class="doxyHighlightKeyword">struct </span><span class="doxyHighlight"><a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo">CSEDenseMapInfo</a> &#123;</span></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781" lineLink="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a64e393e021291b440c6638be61fe249b"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a64e393e021291b440c6638be61fe249b">canHandle</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InsertElementInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ExtractElementInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ShuffleVectorInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786" lineLink="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a658190e47d719896a310288b63b7e67c"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">inline</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a658190e47d719896a310288b63b7e67c">getEmptyKey</a>() &#123;</span></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-gvnsink-cpp-/densemapinfo/#a1423601a8e4ec304e0756df4e761ebbb">DenseMapInfo&lt;Instruction &#42;&gt;::getEmptyKey</a>();</span></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790" lineLink="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a08a2129253b9049a133a8e83c54022ee"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">inline</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a08a2129253b9049a133a8e83c54022ee">getTombstoneKey</a>() &#123;</span></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-gvnsink-cpp-/densemapinfo/#a9571e26b946751eaf015a9b8dc508be9">DenseMapInfo&lt;Instruction &#42;&gt;::getTombstoneKey</a>();</span></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794" lineLink="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a125ba060ad3c925017ab248aeac66703"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a125ba060ad3c925017ab248aeac66703">getHashValue</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a64e393e021291b440c6638be61fe249b">canHandle</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unknown instruction!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#add71474638430694c84640146383fc44">hash&#95;combine</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), <a href="/docs/api/namespaces/llvm/#af80edfc5e42059e045aa7bf7fe42bee3">hash&#95;combine&#95;range</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;value&#95;op&#95;begin(),</span></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><span class="doxyHighlight">                                                           <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;value&#95;op&#95;end()));</span></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800" lineLink="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a622c00e10772021ab1a0f6ea243e9942"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a622c00e10772021ab1a0f6ea243e9942">isEqual</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;LHS, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;RHS) &#123;</span></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LHS == <a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a658190e47d719896a310288b63b7e67c">getEmptyKey</a>() || RHS == <a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a658190e47d719896a310288b63b7e67c">getEmptyKey</a>() ||</span></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><span class="doxyHighlight">        LHS == <a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a08a2129253b9049a133a8e83c54022ee">getTombstoneKey</a>() || RHS == <a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a08a2129253b9049a133a8e83c54022ee">getTombstoneKey</a>())</span></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LHS == RHS;</span></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LHS-&gt;isIdenticalTo(RHS);</span></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><span class="doxyHighlight">&#125; </span><span class="doxyHighlightComment">// end anonymous namespace</span></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><span class="doxyHighlightComment">///Perform cse of induction variable instructions.</span></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811" lineLink="#acc13ee8b8985399901ac09b51822e21a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#acc13ee8b8985399901ac09b51822e21a">cse</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Perform simple cse.</span></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Instruction &#42;, Instruction &#42;, 4, CSEDenseMapInfo&gt;</a> CSEMap;</span></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;In : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(&#42;BB)) &#123;</span></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a64e393e021291b440c6638be61fe249b">CSEDenseMapInfo::canHandle</a>(&amp;In))</span></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if we can replace this instruction with any of the</span></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// visited instructions.</span></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;V = CSEMap.<a href="/docs/api/classes/llvm/densemapbase/#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(&amp;In)) &#123;</span></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><span class="doxyHighlight">      In.replaceAllUsesWith(V);</span></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><span class="doxyHighlight">      In.eraseFromParent();</span></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><span class="doxyHighlight">    CSEMap&#91;&amp;In&#93; = &amp;In;</span></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></span></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad1f0755693a05c2b008e9a576c3b162b"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad1f0755693a05c2b008e9a576c3b162b">LoopVectorizationCostModel::getVectorCallCost</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI,</span></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><span class="doxyHighlight">                                              <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We only need to calculate a cost if the VF is scalar; for actual vectors</span></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we should already have a pre-calculated cost at each VF.</span></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</span></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CallWideningDecisions.at(std::make&#95;pair(CI, VF)).Cost;</span></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy = CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a08416fb970e8c177c7d78452d927c606">RecurrenceDescriptor::isFMulAddIntrinsic</a>(CI))</span></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4e307866e6d65e87d1e6884b0d13306c">getReductionPatternCost</a>(CI, VF, RetTy))</span></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;RedCost;</span></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Type &#42;, 4&gt;</a> Tys;</span></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;ArgOp : CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>())</span></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><span class="doxyHighlight">    Tys.push&#95;back(ArgOp-&gt;getType());</span></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarCallCost =</span></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCallInstrCost(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>(), RetTy, Tys, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If this is an intrinsic we may have a lower cost for it.</span></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>)) &#123;</span></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> IntrinsicCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5abced3ab870d7abf57f2b35a02cd041">getVectorIntrinsicCost</a>(CI, VF);</span></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::min(ScalarCallCost, IntrinsicCost);</span></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ScalarCallCost;</span></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858" lineLink="#a83114915b4f7fec94a20efa3834a8250"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="#a83114915b4f7fec94a20efa3834a8250">maybeVectorizeType</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Elt, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || (!Elt-&gt;<a href="/docs/api/classes/llvm/type/#abf313eff420b7c6c8e322a2e9c53cd90">isIntOrPtrTy</a>() &amp;&amp; !Elt-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>()))</span></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Elt;</span></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Elt, VF);</span></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></span></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5abced3ab870d7abf57f2b35a02cd041"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5abced3ab870d7abf57f2b35a02cd041">LoopVectorizationCostModel::getVectorIntrinsicCost</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI,</span></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><span class="doxyHighlight">                                                   <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> = <a href="/docs/api/namespaces/llvm/#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>);</span></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected intrinsic call!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy = <a href="#a83114915b4f7fec94a20efa3834a8250">maybeVectorizeType</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), VF);</span></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/fastmathflags">FastMathFlags</a> FMF;</span></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FPMO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FPMathOperator&gt;</a>(CI))</span></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><span class="doxyHighlight">    FMF = FPMO-&gt;getFastMathFlags();</span></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;&gt;</a> <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowerkernelarguments-cpp/#a1161e5a4e753384aaba3a8e4533c4261">Arguments</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>());</span></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;FTy = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a21075305f0e463b24aafc2fb99514ace">getFunctionType</a>();</span></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Type &#42;&gt;</a> ParamTys;</span></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><span class="doxyHighlight">  std::transform(FTy-&gt;<a href="/docs/api/classes/llvm/functiontype/#a05d5616e1422394b4d350c008b0cc5e0">param&#95;begin</a>(), FTy-&gt;<a href="/docs/api/classes/llvm/functiontype/#aeae69a459419ec0bb738cdc73f4fc2a1">param&#95;end</a>(),</span></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><span class="doxyHighlight">                 std::back&#95;inserter(ParamTys),</span></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><span class="doxyHighlight">                 &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123; return maybeVectorizeType(Ty, VF); &#125;);</span></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/intrinsiccostattributes">IntrinsicCostAttributes</a> CostAttrs(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>, RetTy, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowerkernelarguments-cpp/#a1161e5a4e753384aaba3a8e4533c4261">Arguments</a>, ParamTys, FMF,</span></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><span class="doxyHighlight">                                    <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(CI));</span></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getIntrinsicInstrCost(CostAttrs, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a9484786140efebf774cde8f072894246"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a9484786140efebf774cde8f072894246">InnerLoopVectorizer::fixVectorizedLoop</a>(<a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State) &#123;</span></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Fix widened non-induction PHIs by setting up the PHI operands.</span></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a>)</span></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#accb5ce221150790c36b2d96af1be821c">fixNonInductionPHIs</a>(State);</span></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// After vectorization, the exit blocks of the original loop will have</span></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// additional predecessors. Invalidate SCEVs for the exit phis in case SE</span></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// looked through single-entry phis.</span></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;&gt;</a> ExitBlocks;</span></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getExitBlocks(ExitBlocks);</span></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Exit : ExitBlocks)</span></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : Exit-&gt;phis())</span></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>.getSE()-&gt;forgetLcssaPhiWithNewPredecessor(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, &amp;PN);</span></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Forget the original basic block.</span></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>.getSE()-&gt;forgetLoop(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>);</span></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>.getSE()-&gt;forgetBlockAndLoopDispositions();</span></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t apply optimizations below when no vector region remains, as they all</span></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// require a vector loop at the moment.</span></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!State.Plan-&gt;getVectorLoopRegion())</span></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PI : <a href="/docs/api/classes/llvm/innerloopvectorizer/#a47eab9fa7cfa73af0b164da3fca49a0f">PredicatedInstructions</a>)</span></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0a5c60e5cebd520f95b9813fd9807016">sinkScalarOperands</a>(&amp;&#42;PI);</span></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;VectorRegion = State.Plan-&gt;getVectorLoopRegion();</span></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;HeaderVPBB = VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</span></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;HeaderBB = State.CFG.VPBB2IRBB&#91;HeaderVPBB&#93;;</span></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Remove redundant induction instructions.</span></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><span class="doxyHighlight">  <a href="#acc13ee8b8985399901ac09b51822e21a">cse</a>(HeaderBB);</span></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set/update profile weights for the vector and remainder loops as original</span></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop iterations are now distributed among them. Note that original loop</span></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// becomes the scalar remainder loop after vectorization.</span></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For cases like foldTailByMasking() and requiresScalarEpiloque() we may</span></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// end up getting slightly roughened result but that should be OK since</span></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// profile is not inherently precise anyway. Note also possible bypass of</span></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vector code caused by legality checks is ignored, assigning all the weight</span></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to the vector loop, optimistically.</span></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For scalable vectorization we can&#39;t know at compile time how many</span></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// iterations of the loop are handled in one vector iteration, so instead</span></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// assume a pessimistic vscale of &#39;1&#39;.</span></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;VectorLoop = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>-&gt;getLoopFor(HeaderBB);</span></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aaf345c258e6fd97a551e4d5b41607e32">setProfileInfoAfterUnrolling</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, VectorLoop, <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>,</span></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.getKnownMinValue() &#42; <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>);</span></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a0a5c60e5cebd520f95b9813fd9807016"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0a5c60e5cebd520f95b9813fd9807016">InnerLoopVectorizer::sinkScalarOperands</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PredInst) &#123;</span></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The basic block and loop containing the predicated instruction.</span></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PredBB = PredInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VectorLoop = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>-&gt;getLoopFor(PredBB);</span></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Initialize a worklist with the operands of the predicated instruction.</span></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> Worklist(PredInst-&gt;<a href="/docs/api/classes/llvm/user/#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op&#95;begin</a>(), PredInst-&gt;<a href="/docs/api/classes/llvm/user/#af41f58e730804d10b91fcff39b035f74">op&#95;end</a>());</span></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Holds instructions that we need to analyze again. An instruction may be</span></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reanalyzed if we don&#39;t yet know if we can sink it or not.</span></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 8&gt;</a> InstsToReanalyze;</span></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Returns true if a given use occurs in the predicated block. Phi nodes use</span></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// their operands in their corresponding predecessor blocks.</span></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsBlockOfUsePredicated = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/use">Use</a> &amp;U) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser());</span></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</span></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><span class="doxyHighlight">      BB = Phi-&gt;getIncomingBlock(</span></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/phinode/#aca414c43a6d42c13998208463637a20d">PHINode::getIncomingValueNumForOperand</a>(U.getOperandNo()));</span></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BB == PredBB;</span></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Iteratively sink the scalarized operands of the predicated instruction</span></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// into the block we created for it. When an instruction is sunk, it&#39;s</span></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// operands are then added to the worklist. The algorithm ends after one pass</span></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// through the worklist doesn&#39;t sink a single instruction.</span></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</span></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add the instructions that need to be reanalyzed to the worklist, and</span></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// reset the changed indicator.</span></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><span class="doxyHighlight">    Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(InstsToReanalyze.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), InstsToReanalyze.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</span></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><span class="doxyHighlight">    InstsToReanalyze.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</span></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>()) &#123;</span></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Worklist.<a href="/docs/api/classes/llvm/setvector/#af9880d625c506aacc716ee1c9a29ff8b">pop&#95;back&#95;val</a>());</span></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We can&#39;t sink an instruction if it is a phi node, is not in the loop,</span></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// may have side effects or may read from memory.</span></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: Could do more granular checking to allow sinking</span></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// a load past non-store instructions.</span></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || !VectorLoop-&gt;contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayHaveSideEffects() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayReadFromMemory())</span></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the instruction is already in PredBB, check if we can sink its</span></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// operands. In that case, VPlan&#39;s sinkScalarOperands() succeeded in</span></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// sinking the scalar instruction I, hence it appears in PredBB; but it</span></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// may have failed to sink I&#39;s operands (recursively), which we try</span></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// (again) here.</span></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == PredBB) &#123;</span></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"><span class="doxyHighlight">        Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;op&#95;begin(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;op&#95;end());</span></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// It&#39;s legal to sink the instruction if all its uses occur in the</span></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// predicated block. Otherwise, there&#39;s nothing to do yet, and we may</span></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// need to reanalyze the instruction.</span></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;uses(), IsBlockOfUsePredicated)) &#123;</span></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><span class="doxyHighlight">        InstsToReanalyze.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Move the instruction to the beginning of the predicated block, and add</span></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// it&#39;s operands to the worklist.</span></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;moveBefore(PredBB-&gt;getFirstInsertionPt());</span></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;op&#95;begin(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;op&#95;end());</span></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The sinking may have enabled other instructions to be sunk, so we will</span></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// need to iterate.</span></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><span class="doxyHighlight">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>);</span></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#accb5ce221150790c36b2d96af1be821c"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#accb5ce221150790c36b2d96af1be821c">InnerLoopVectorizer::fixNonInductionPHIs</a>(<a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State) &#123;</span></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Iter = <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.getEntry());</span></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(Iter)) &#123;</span></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : VPBB-&gt;phis()) &#123;</span></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpwidenphirecipe">VPWidenPHIRecipe</a> &#42;VPPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenPHIRecipe&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</span></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VPPhi)</span></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPhi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(State.get(VPPhi));</span></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Make sure the builder has a valid insert point.</span></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.SetInsertPoint(NewPhi);</span></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0; Idx &lt; VPPhi-&gt;<a href="/docs/api/classes/llvm/vpuser/#a5b21038d9b822b20c59e7ce5b12582e1">getNumOperands</a>(); ++Idx) &#123;</span></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Inc = VPPhi-&gt;<a href="/docs/api/classes/llvm/vpwidenphirecipe/#a48a84a2d77d942f724c87bc7657c4355">getIncomingValue</a>(Idx);</span></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB = VPPhi-&gt;<a href="/docs/api/classes/llvm/vpwidenphirecipe/#afbde244c417036adb55cbc687de70971">getIncomingBlock</a>(Idx);</span></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><span class="doxyHighlight">        NewPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(State.get(Inc), State.CFG.VPBB2IRBB&#91;VPBB&#93;);</span></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> LoopVectorizationCostModel::collectLoopScalars(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We should not collect Scalars more than once per VF. Right now, this</span></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// function is called from collectUniformsAndScalars(), which already does</span></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// this check. Collecting Scalars for VF=1 does not make any sense.</span></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; !Scalars.<a href="/docs/api/classes/llvm/densemapbase/#a836d9cba6deced0bb1fa7333ce5afd3a">contains</a>(VF) &amp;&amp;</span></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;This function should not be visited twice for the same VF&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This avoids any chances of creating a REPLICATE recipe during planning</span></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// since that would result in generation of scalarized code during execution,</span></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which is not supported for scalable vectors.</span></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>()) &#123;</span></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><span class="doxyHighlight">    Scalars&#91;VF&#93;.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(Uniforms&#91;VF&#93;.begin(), Uniforms&#91;VF&#93;.end());</span></CodeLine>
<Link id="l03044" /><CodeLine lineNumber="3044"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03045" /><CodeLine lineNumber="3045"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03046" /><CodeLine lineNumber="3046"></CodeLine>
<Link id="l03047" /><CodeLine lineNumber="3047"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;Instruction &#42;, 8&gt;</a> Worklist;</span></CodeLine>
<Link id="l03048" /><CodeLine lineNumber="3048"></CodeLine>
<Link id="l03049" /><CodeLine lineNumber="3049"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// These sets are used to seed the analysis with pointers used by memory</span></CodeLine>
<Link id="l03050" /><CodeLine lineNumber="3050"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// accesses that will remain scalar.</span></CodeLine>
<Link id="l03051" /><CodeLine lineNumber="3051"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;Instruction &#42;, 8&gt;</a> ScalarPtrs;</span></CodeLine>
<Link id="l03052" /><CodeLine lineNumber="3052"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 8&gt;</a> PossibleNonScalarPtrs;</span></CodeLine>
<Link id="l03053" /><CodeLine lineNumber="3053"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Latch = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;<a href="/docs/api/classes/llvm/loopbase/#a1230fd674d2609b96527fe65eaf40b1b">getLoopLatch</a>();</span></CodeLine>
<Link id="l03054" /><CodeLine lineNumber="3054"></CodeLine>
<Link id="l03055" /><CodeLine lineNumber="3055"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A helper that returns true if the use of Ptr by MemAccess will be scalar.</span></CodeLine>
<Link id="l03056" /><CodeLine lineNumber="3056"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The pointer operands of loads and stores will be scalar as long as the</span></CodeLine>
<Link id="l03057" /><CodeLine lineNumber="3057"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// memory access is not a gather or scatter operation. The value operand of a</span></CodeLine>
<Link id="l03058" /><CodeLine lineNumber="3058"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// store will remain scalar if the store is scalarized.</span></CodeLine>
<Link id="l03059" /><CodeLine lineNumber="3059"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsScalarUse = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;MemAccess, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &#123;</span></CodeLine>
<Link id="l03060" /><CodeLine lineNumber="3060"><span class="doxyHighlight">    InstWidening WideningDecision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(MemAccess, VF);</span></CodeLine>
<Link id="l03061" /><CodeLine lineNumber="3061"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(WideningDecision != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">CM&#95;Unknown</a> &amp;&amp;</span></CodeLine>
<Link id="l03062" /><CodeLine lineNumber="3062"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Widening decision should be ready at this moment&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03063" /><CodeLine lineNumber="3063"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Store = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(MemAccess))</span></CodeLine>
<Link id="l03064" /><CodeLine lineNumber="3064"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> == Store-&gt;getValueOperand())</span></CodeLine>
<Link id="l03065" /><CodeLine lineNumber="3065"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> WideningDecision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>;</span></CodeLine>
<Link id="l03066" /><CodeLine lineNumber="3066"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> == <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(MemAccess) &amp;&amp;</span></CodeLine>
<Link id="l03067" /><CodeLine lineNumber="3067"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Ptr is neither a value or pointer operand&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03068" /><CodeLine lineNumber="3068"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> WideningDecision != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ae849d400780f51424bc4e4c26ddf3000">CM&#95;GatherScatter</a>;</span></CodeLine>
<Link id="l03069" /><CodeLine lineNumber="3069"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03070" /><CodeLine lineNumber="3070"></CodeLine>
<Link id="l03071" /><CodeLine lineNumber="3071"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A helper that returns true if the given value is a getelementptr</span></CodeLine>
<Link id="l03072" /><CodeLine lineNumber="3072"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction contained in the loop.</span></CodeLine>
<Link id="l03073" /><CodeLine lineNumber="3073"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsLoopVaryingGEP = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>) &#123;</span></CodeLine>
<Link id="l03074" /><CodeLine lineNumber="3074"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(V) &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(V);</span></CodeLine>
<Link id="l03075" /><CodeLine lineNumber="3075"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03076" /><CodeLine lineNumber="3076"></CodeLine>
<Link id="l03077" /><CodeLine lineNumber="3077"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A helper that evaluates a memory access&#39;s use of a pointer. If the use will</span></CodeLine>
<Link id="l03078" /><CodeLine lineNumber="3078"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be a scalar use and the pointer is only used by memory accesses, we place</span></CodeLine>
<Link id="l03079" /><CodeLine lineNumber="3079"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the pointer in ScalarPtrs. Otherwise, the pointer is placed in</span></CodeLine>
<Link id="l03080" /><CodeLine lineNumber="3080"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PossibleNonScalarPtrs.</span></CodeLine>
<Link id="l03081" /><CodeLine lineNumber="3081"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> EvaluatePtrUse = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;MemAccess, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &#123;</span></CodeLine>
<Link id="l03082" /><CodeLine lineNumber="3082"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We only care about bitcast and getelementptr instructions contained in</span></CodeLine>
<Link id="l03083" /><CodeLine lineNumber="3083"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the loop.</span></CodeLine>
<Link id="l03084" /><CodeLine lineNumber="3084"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsLoopVaryingGEP(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>))</span></CodeLine>
<Link id="l03085" /><CodeLine lineNumber="3085"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03086" /><CodeLine lineNumber="3086"></CodeLine>
<Link id="l03087" /><CodeLine lineNumber="3087"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the pointer has already been identified as scalar (e.g., if it was</span></CodeLine>
<Link id="l03088" /><CodeLine lineNumber="3088"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// also identified as uniform), there&#39;s nothing to do.</span></CodeLine>
<Link id="l03089" /><CodeLine lineNumber="3089"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</span></CodeLine>
<Link id="l03090" /><CodeLine lineNumber="3090"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Worklist.<a href="/docs/api/classes/llvm/setvector/#abb03e3b6c4fd937936a13afe4f60d291">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l03091" /><CodeLine lineNumber="3091"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03092" /><CodeLine lineNumber="3092"></CodeLine>
<Link id="l03093" /><CodeLine lineNumber="3093"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the use of the pointer will be a scalar use, and all users of the</span></CodeLine>
<Link id="l03094" /><CodeLine lineNumber="3094"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pointer are memory accesses, place the pointer in ScalarPtrs. Otherwise,</span></CodeLine>
<Link id="l03095" /><CodeLine lineNumber="3095"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// place the pointer in PossibleNonScalarPtrs.</span></CodeLine>
<Link id="l03096" /><CodeLine lineNumber="3096"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsScalarUse(MemAccess, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &amp;&amp;</span></CodeLine>
<Link id="l03097" /><CodeLine lineNumber="3097"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users(), <a href="/docs/api/namespaces/llvm/#af462c722ac0144c995057a2f6e616507">IsaPred&lt;LoadInst, StoreInst&gt;</a>))</span></CodeLine>
<Link id="l03098" /><CodeLine lineNumber="3098"><span class="doxyHighlight">      ScalarPtrs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03099" /><CodeLine lineNumber="3099"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03100" /><CodeLine lineNumber="3100"><span class="doxyHighlight">      PossibleNonScalarPtrs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03101" /><CodeLine lineNumber="3101"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03102" /><CodeLine lineNumber="3102"></CodeLine>
<Link id="l03103" /><CodeLine lineNumber="3103"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We seed the scalars analysis with three classes of instructions: (1)</span></CodeLine>
<Link id="l03104" /><CodeLine lineNumber="3104"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions marked uniform-after-vectorization and (2) bitcast,</span></CodeLine>
<Link id="l03105" /><CodeLine lineNumber="3105"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// getelementptr and (pointer) phi instructions used by memory accesses</span></CodeLine>
<Link id="l03106" /><CodeLine lineNumber="3106"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// requiring a scalar use.</span></CodeLine>
<Link id="l03107" /><CodeLine lineNumber="3107"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l03108" /><CodeLine lineNumber="3108"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (1) Add to the worklist all instructions that have been identified as</span></CodeLine>
<Link id="l03109" /><CodeLine lineNumber="3109"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// uniform-after-vectorization.</span></CodeLine>
<Link id="l03110" /><CodeLine lineNumber="3110"><span class="doxyHighlight">  Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Uniforms&#91;VF&#93;.<a href="/docs/api/namespaces/llvm/sandboxir/#a2fdb10193ae65fe59b4d8df288044864">begin</a>(), Uniforms&#91;VF&#93;.<a href="/docs/api/namespaces/llvm/sandboxir/#a64ac61287490361f2183faf1d7639ee9">end</a>());</span></CodeLine>
<Link id="l03111" /><CodeLine lineNumber="3111"></CodeLine>
<Link id="l03112" /><CodeLine lineNumber="3112"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (2) Add to the worklist all bitcast and getelementptr instructions used by</span></CodeLine>
<Link id="l03113" /><CodeLine lineNumber="3113"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// memory accesses requiring a scalar use. The pointer operands of loads and</span></CodeLine>
<Link id="l03114" /><CodeLine lineNumber="3114"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stores will be scalar unless the operation is a gather or scatter.</span></CodeLine>
<Link id="l03115" /><CodeLine lineNumber="3115"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The value operand of a store will remain scalar if the store is scalarized.</span></CodeLine>
<Link id="l03116" /><CodeLine lineNumber="3116"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks())</span></CodeLine>
<Link id="l03117" /><CodeLine lineNumber="3117"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l03118" /><CodeLine lineNumber="3118"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Load = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l03119" /><CodeLine lineNumber="3119"><span class="doxyHighlight">        EvaluatePtrUse(Load, <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getPointerOperand());</span></CodeLine>
<Link id="l03120" /><CodeLine lineNumber="3120"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Store = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l03121" /><CodeLine lineNumber="3121"><span class="doxyHighlight">        EvaluatePtrUse(Store, <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getPointerOperand());</span></CodeLine>
<Link id="l03122" /><CodeLine lineNumber="3122"><span class="doxyHighlight">        EvaluatePtrUse(Store, <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getValueOperand());</span></CodeLine>
<Link id="l03123" /><CodeLine lineNumber="3123"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03124" /><CodeLine lineNumber="3124"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03125" /><CodeLine lineNumber="3125"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : ScalarPtrs)</span></CodeLine>
<Link id="l03126" /><CodeLine lineNumber="3126"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PossibleNonScalarPtrs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l03127" /><CodeLine lineNumber="3127"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found scalar instruction: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03128" /><CodeLine lineNumber="3128"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03129" /><CodeLine lineNumber="3129"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03130" /><CodeLine lineNumber="3130"></CodeLine>
<Link id="l03131" /><CodeLine lineNumber="3131"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Insert the forced scalars.</span></CodeLine>
<Link id="l03132" /><CodeLine lineNumber="3132"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Currently VPWidenPHIRecipe() often creates a dead vector</span></CodeLine>
<Link id="l03133" /><CodeLine lineNumber="3133"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// induction variable when the PHI user is scalarized.</span></CodeLine>
<Link id="l03134" /><CodeLine lineNumber="3134"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ForcedScalar = ForcedScalars.find(VF);</span></CodeLine>
<Link id="l03135" /><CodeLine lineNumber="3135"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ForcedScalar != ForcedScalars.end())</span></CodeLine>
<Link id="l03136" /><CodeLine lineNumber="3136"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : ForcedScalar-&gt;second) &#123;</span></CodeLine>
<Link id="l03137" /><CodeLine lineNumber="3137"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found (forced) scalar instruction: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03138" /><CodeLine lineNumber="3138"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03139" /><CodeLine lineNumber="3139"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03140" /><CodeLine lineNumber="3140"></CodeLine>
<Link id="l03141" /><CodeLine lineNumber="3141"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Expand the worklist by looking through any bitcasts and getelementptr</span></CodeLine>
<Link id="l03142" /><CodeLine lineNumber="3142"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions we&#39;ve already identified as scalar. This is similar to the</span></CodeLine>
<Link id="l03143" /><CodeLine lineNumber="3143"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// expansion step in collectLoopUniforms(); however, here we&#39;re only</span></CodeLine>
<Link id="l03144" /><CodeLine lineNumber="3144"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// expanding to include additional bitcasts and getelementptr instructions.</span></CodeLine>
<Link id="l03145" /><CodeLine lineNumber="3145"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0;</span></CodeLine>
<Link id="l03146" /><CodeLine lineNumber="3146"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (Idx != Worklist.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>()) &#123;</span></CodeLine>
<Link id="l03147" /><CodeLine lineNumber="3147"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a1448a68418666ed85e07646744af82ef">Dst</a> = Worklist&#91;Idx++&#93;;</span></CodeLine>
<Link id="l03148" /><CodeLine lineNumber="3148"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsLoopVaryingGEP(<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a1448a68418666ed85e07646744af82ef">Dst</a>-&gt;getOperand(0)))</span></CodeLine>
<Link id="l03149" /><CodeLine lineNumber="3149"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03150" /><CodeLine lineNumber="3150"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a1448a68418666ed85e07646744af82ef">Dst</a>-&gt;getOperand(0));</span></CodeLine>
<Link id="l03151" /><CodeLine lineNumber="3151"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>-&gt;users(), &#91;&amp;&#93;(User &#42;U) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03152" /><CodeLine lineNumber="3152"><span class="doxyHighlight">          auto &#42;J = cast&lt;Instruction&gt;(U);</span></CodeLine>
<Link id="l03153" /><CodeLine lineNumber="3153"><span class="doxyHighlight">          return !TheLoop-&gt;contains(J) || Worklist.count(J) ||</span></CodeLine>
<Link id="l03154" /><CodeLine lineNumber="3154"><span class="doxyHighlight">                 ((isa&lt;LoadInst&gt;(J) || isa&lt;StoreInst&gt;(J)) &amp;&amp;</span></CodeLine>
<Link id="l03155" /><CodeLine lineNumber="3155"><span class="doxyHighlight">                  IsScalarUse(J, Src));</span></CodeLine>
<Link id="l03156" /><CodeLine lineNumber="3156"><span class="doxyHighlight">        &#125;)) &#123;</span></CodeLine>
<Link id="l03157" /><CodeLine lineNumber="3157"><span class="doxyHighlight">      Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Src);</span></CodeLine>
<Link id="l03158" /><CodeLine lineNumber="3158"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found scalar instruction: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Src &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03159" /><CodeLine lineNumber="3159"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03160" /><CodeLine lineNumber="3160"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03161" /><CodeLine lineNumber="3161"></CodeLine>
<Link id="l03162" /><CodeLine lineNumber="3162"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// An induction variable will remain scalar if all users of the induction</span></CodeLine>
<Link id="l03163" /><CodeLine lineNumber="3163"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// variable and induction variable update remain scalar.</span></CodeLine>
<Link id="l03164" /><CodeLine lineNumber="3164"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Induction : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getInductionVars()) &#123;</span></CodeLine>
<Link id="l03165" /><CodeLine lineNumber="3165"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Ind = Induction.first;</span></CodeLine>
<Link id="l03166" /><CodeLine lineNumber="3166"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IndUpdate = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Ind-&gt;getIncomingValueForBlock(Latch));</span></CodeLine>
<Link id="l03167" /><CodeLine lineNumber="3167"></CodeLine>
<Link id="l03168" /><CodeLine lineNumber="3168"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If tail-folding is applied, the primary induction variable will be used</span></CodeLine>
<Link id="l03169" /><CodeLine lineNumber="3169"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to feed a vector compare.</span></CodeLine>
<Link id="l03170" /><CodeLine lineNumber="3170"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ind == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getPrimaryInduction() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba">foldTailByMasking</a>())</span></CodeLine>
<Link id="l03171" /><CodeLine lineNumber="3171"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03172" /><CodeLine lineNumber="3172"></CodeLine>
<Link id="l03173" /><CodeLine lineNumber="3173"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Returns true if \\p Indvar is a pointer induction that is used directly by</span></CodeLine>
<Link id="l03174" /><CodeLine lineNumber="3174"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// load/store instruction \\p I.</span></CodeLine>
<Link id="l03175" /><CodeLine lineNumber="3175"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsDirectLoadStoreFromPtrIndvar = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;Indvar,</span></CodeLine>
<Link id="l03176" /><CodeLine lineNumber="3176"><span class="doxyHighlight">                                              <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l03177" /><CodeLine lineNumber="3177"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Induction.second.getKind() ==</span></CodeLine>
<Link id="l03178" /><CodeLine lineNumber="3178"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabccab61689ca7d0a024fc4ff52a74d691ae2">InductionDescriptor::IK&#95;PtrInduction</a> &amp;&amp;</span></CodeLine>
<Link id="l03179" /><CodeLine lineNumber="3179"><span class="doxyHighlight">             (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</span></CodeLine>
<Link id="l03180" /><CodeLine lineNumber="3180"><span class="doxyHighlight">             Indvar == <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; IsScalarUse(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Indvar);</span></CodeLine>
<Link id="l03181" /><CodeLine lineNumber="3181"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l03182" /><CodeLine lineNumber="3182"></CodeLine>
<Link id="l03183" /><CodeLine lineNumber="3183"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Determine if all users of the induction variable are scalar after</span></CodeLine>
<Link id="l03184" /><CodeLine lineNumber="3184"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// vectorization.</span></CodeLine>
<Link id="l03185" /><CodeLine lineNumber="3185"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ScalarInd = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(Ind-&gt;users(), &#91;&amp;&#93;(User &#42;U) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03186" /><CodeLine lineNumber="3186"><span class="doxyHighlight">      auto &#42;I = cast&lt;Instruction&gt;(U);</span></CodeLine>
<Link id="l03187" /><CodeLine lineNumber="3187"><span class="doxyHighlight">      return I == IndUpdate || !TheLoop-&gt;contains(I) || Worklist.count(I) ||</span></CodeLine>
<Link id="l03188" /><CodeLine lineNumber="3188"><span class="doxyHighlight">             IsDirectLoadStoreFromPtrIndvar(Ind, I);</span></CodeLine>
<Link id="l03189" /><CodeLine lineNumber="3189"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l03190" /><CodeLine lineNumber="3190"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ScalarInd)</span></CodeLine>
<Link id="l03191" /><CodeLine lineNumber="3191"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03192" /><CodeLine lineNumber="3192"></CodeLine>
<Link id="l03193" /><CodeLine lineNumber="3193"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the induction variable update is a fixed-order recurrence, neither the</span></CodeLine>
<Link id="l03194" /><CodeLine lineNumber="3194"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// induction variable or its update should be marked scalar after</span></CodeLine>
<Link id="l03195" /><CodeLine lineNumber="3195"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// vectorization.</span></CodeLine>
<Link id="l03196" /><CodeLine lineNumber="3196"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IndUpdatePhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(IndUpdate);</span></CodeLine>
<Link id="l03197" /><CodeLine lineNumber="3197"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IndUpdatePhi &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isFixedOrderRecurrence(IndUpdatePhi))</span></CodeLine>
<Link id="l03198" /><CodeLine lineNumber="3198"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03199" /><CodeLine lineNumber="3199"></CodeLine>
<Link id="l03200" /><CodeLine lineNumber="3200"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Determine if all users of the induction variable update instruction are</span></CodeLine>
<Link id="l03201" /><CodeLine lineNumber="3201"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scalar after vectorization.</span></CodeLine>
<Link id="l03202" /><CodeLine lineNumber="3202"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ScalarIndUpdate = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(IndUpdate-&gt;users(), &#91;&amp;&#93;(User &#42;U) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03203" /><CodeLine lineNumber="3203"><span class="doxyHighlight">      auto &#42;I = cast&lt;Instruction&gt;(U);</span></CodeLine>
<Link id="l03204" /><CodeLine lineNumber="3204"><span class="doxyHighlight">      return I == Ind || !TheLoop-&gt;contains(I) || Worklist.count(I) ||</span></CodeLine>
<Link id="l03205" /><CodeLine lineNumber="3205"><span class="doxyHighlight">             IsDirectLoadStoreFromPtrIndvar(IndUpdate, I);</span></CodeLine>
<Link id="l03206" /><CodeLine lineNumber="3206"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l03207" /><CodeLine lineNumber="3207"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ScalarIndUpdate)</span></CodeLine>
<Link id="l03208" /><CodeLine lineNumber="3208"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03209" /><CodeLine lineNumber="3209"></CodeLine>
<Link id="l03210" /><CodeLine lineNumber="3210"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The induction variable and its update instruction will remain scalar.</span></CodeLine>
<Link id="l03211" /><CodeLine lineNumber="3211"><span class="doxyHighlight">    Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Ind);</span></CodeLine>
<Link id="l03212" /><CodeLine lineNumber="3212"><span class="doxyHighlight">    Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(IndUpdate);</span></CodeLine>
<Link id="l03213" /><CodeLine lineNumber="3213"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found scalar instruction: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Ind &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03214" /><CodeLine lineNumber="3214"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found scalar instruction: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;IndUpdate</span></CodeLine>
<Link id="l03215" /><CodeLine lineNumber="3215"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03216" /><CodeLine lineNumber="3216"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03217" /><CodeLine lineNumber="3217"></CodeLine>
<Link id="l03218" /><CodeLine lineNumber="3218"><span class="doxyHighlight">  Scalars&#91;VF&#93;.insert(Worklist.<a href="/docs/api/classes/llvm/setvector/#ad0bf95396cec46a41371341460d14a1c">begin</a>(), Worklist.<a href="/docs/api/classes/llvm/setvector/#a889cc0df630d4b01e12d359517e26670">end</a>());</span></CodeLine>
<Link id="l03219" /><CodeLine lineNumber="3219"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03220" /><CodeLine lineNumber="3220"></CodeLine>
<Link id="l03221" /><CodeLine lineNumber="3221" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8">LoopVectorizationCostModel::isScalarWithPredication</a>(</span></CodeLine>
<Link id="l03222" /><CodeLine lineNumber="3222"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03223" /><CodeLine lineNumber="3223"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">isPredicatedInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l03224" /><CodeLine lineNumber="3224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03225" /><CodeLine lineNumber="3225"></CodeLine>
<Link id="l03226" /><CodeLine lineNumber="3226"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do we have a non-scalar lowering for this predicated</span></CodeLine>
<Link id="l03227" /><CodeLine lineNumber="3227"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction? No - it is scalar with predication.</span></CodeLine>
<Link id="l03228" /><CodeLine lineNumber="3228"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight">(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l03229" /><CodeLine lineNumber="3229"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03230" /><CodeLine lineNumber="3230"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03231" /><CodeLine lineNumber="3231"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Call:</span></CodeLine>
<Link id="l03232" /><CodeLine lineNumber="3232"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</span></CodeLine>
<Link id="l03233" /><CodeLine lineNumber="3233"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03234" /><CodeLine lineNumber="3234"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CallWideningDecisions.at(std::make&#95;pair(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), VF))</span></CodeLine>
<Link id="l03235" /><CodeLine lineNumber="3235"><span class="doxyHighlight">               .Kind == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>;</span></CodeLine>
<Link id="l03236" /><CodeLine lineNumber="3236"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Load:</span></CodeLine>
<Link id="l03237" /><CodeLine lineNumber="3237"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Store: &#123;</span></CodeLine>
<Link id="l03238" /><CodeLine lineNumber="3238"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03239" /><CodeLine lineNumber="3239"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Ty = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03240" /><CodeLine lineNumber="3240"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;VTy = Ty;</span></CodeLine>
<Link id="l03241" /><CodeLine lineNumber="3241"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>())</span></CodeLine>
<Link id="l03242" /><CodeLine lineNumber="3242"><span class="doxyHighlight">      VTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Ty, VF);</span></CodeLine>
<Link id="l03243" /><CodeLine lineNumber="3243"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/align">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03244" /><CodeLine lineNumber="3244"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ? !(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a472c49074b0d81970f8eea07de4d7ad4">isLegalMaskedLoad</a>(Ty, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, Alignment) ||</span></CodeLine>
<Link id="l03245" /><CodeLine lineNumber="3245"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedGather(VTy, Alignment))</span></CodeLine>
<Link id="l03246" /><CodeLine lineNumber="3246"><span class="doxyHighlight">                            : !(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c25146329f69e026508656cfb1280fa">isLegalMaskedStore</a>(Ty, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, Alignment) ||</span></CodeLine>
<Link id="l03247" /><CodeLine lineNumber="3247"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedScatter(VTy, Alignment));</span></CodeLine>
<Link id="l03248" /><CodeLine lineNumber="3248"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03249" /><CodeLine lineNumber="3249"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::UDiv:</span></CodeLine>
<Link id="l03250" /><CodeLine lineNumber="3250"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SDiv:</span></CodeLine>
<Link id="l03251" /><CodeLine lineNumber="3251"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SRem:</span></CodeLine>
<Link id="l03252" /><CodeLine lineNumber="3252"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::URem: &#123;</span></CodeLine>
<Link id="l03253" /><CodeLine lineNumber="3253"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We have the option to use the safe-divisor idiom to avoid predication.</span></CodeLine>
<Link id="l03254" /><CodeLine lineNumber="3254"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The cost based decision here will always select safe-divisor for</span></CodeLine>
<Link id="l03255" /><CodeLine lineNumber="3255"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scalable vectors as scalarization isn&#39;t legal.</span></CodeLine>
<Link id="l03256" /><CodeLine lineNumber="3256"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;ScalarCost, SafeDivisorCost&#93; = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad8398a35cd187d6a75b460fcf54b5236">getDivRemSpeculationCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l03257" /><CodeLine lineNumber="3257"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#add43c346a11ae1deb49142ba968eb07e">isDivRemScalarWithPredication</a>(ScalarCost, SafeDivisorCost);</span></CodeLine>
<Link id="l03258" /><CodeLine lineNumber="3258"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03259" /><CodeLine lineNumber="3259"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03260" /><CodeLine lineNumber="3260"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03261" /><CodeLine lineNumber="3261"></CodeLine>
<Link id="l03262" /><CodeLine lineNumber="3262"><span class="doxyHighlightComment">// TODO: Fold into LoopVectorizationLegality::isMaskRequired.</span></CodeLine>
<Link id="l03263" /><CodeLine lineNumber="3263" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">LoopVectorizationCostModel::isPredicatedInst</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03264" /><CodeLine lineNumber="3264"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If predication is not needed, avoid it.</span></CodeLine>
<Link id="l03265" /><CodeLine lineNumber="3265"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: We can use the loop-preheader as context point here and get</span></CodeLine>
<Link id="l03266" /><CodeLine lineNumber="3266"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// context sensitive reasoning for isSafeToSpeculativelyExecute.</span></CodeLine>
<Link id="l03267" /><CodeLine lineNumber="3267"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8c8de8f62b5d2b27c4878d3effd7273">blockNeedsPredicationForAnyReason</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()) ||</span></CodeLine>
<Link id="l03268" /><CodeLine lineNumber="3268"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8601ff0320b6e29a13a2194200853425">isSafeToSpeculativelyExecute</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l03269" /><CodeLine lineNumber="3269"><span class="doxyHighlight">      (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst, StoreInst, CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) ||</span></CodeLine>
<Link id="l03270" /><CodeLine lineNumber="3270"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst, SwitchInst, PHINode, AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l03271" /><CodeLine lineNumber="3271"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03272" /><CodeLine lineNumber="3272"></CodeLine>
<Link id="l03273" /><CodeLine lineNumber="3273"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the instruction was executed conditionally in the original scalar loop,</span></CodeLine>
<Link id="l03274" /><CodeLine lineNumber="3274"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// predication is needed with a mask whose lanes are all possibly inactive.</span></CodeLine>
<Link id="l03275" /><CodeLine lineNumber="3275"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;blockNeedsPredication(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()))</span></CodeLine>
<Link id="l03276" /><CodeLine lineNumber="3276"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03277" /><CodeLine lineNumber="3277"></CodeLine>
<Link id="l03278" /><CodeLine lineNumber="3278"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All that remain are instructions with side-effects originally executed in</span></CodeLine>
<Link id="l03279" /><CodeLine lineNumber="3279"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the loop unconditionally, but now execute under a tail-fold mask (only)</span></CodeLine>
<Link id="l03280" /><CodeLine lineNumber="3280"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// having at least one active lane (the first). If the side-effects of the</span></CodeLine>
<Link id="l03281" /><CodeLine lineNumber="3281"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction are invariant, executing it w/o (the tail-folding) mask is safe</span></CodeLine>
<Link id="l03282" /><CodeLine lineNumber="3282"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// - it will cause the same side-effects as when masked.</span></CodeLine>
<Link id="l03283" /><CodeLine lineNumber="3283"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight">(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l03284" /><CodeLine lineNumber="3284"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03285" /><CodeLine lineNumber="3285"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span></CodeLine>
<Link id="l03286" /><CodeLine lineNumber="3286"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;instruction should have been considered by earlier checks&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03287" /><CodeLine lineNumber="3287"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Call:</span></CodeLine>
<Link id="l03288" /><CodeLine lineNumber="3288"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Side-effects of a Call are assumed to be non-invariant, needing a</span></CodeLine>
<Link id="l03289" /><CodeLine lineNumber="3289"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (fold-tail) mask.</span></CodeLine>
<Link id="l03290" /><CodeLine lineNumber="3290"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l03291" /><CodeLine lineNumber="3291"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;should have returned earlier for calls not needing a mask&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03292" /><CodeLine lineNumber="3292"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03293" /><CodeLine lineNumber="3293"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Load:</span></CodeLine>
<Link id="l03294" /><CodeLine lineNumber="3294"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the address is loop invariant no predication is needed.</span></CodeLine>
<Link id="l03295" /><CodeLine lineNumber="3295"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInvariant(<a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l03296" /><CodeLine lineNumber="3296"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Store: &#123;</span></CodeLine>
<Link id="l03297" /><CodeLine lineNumber="3297"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For stores, we need to prove both speculation safety (which follows from</span></CodeLine>
<Link id="l03298" /><CodeLine lineNumber="3298"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the same argument as loads), but also must prove the value being stored</span></CodeLine>
<Link id="l03299" /><CodeLine lineNumber="3299"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is correct.  The easiest form of the later is to require that all values</span></CodeLine>
<Link id="l03300" /><CodeLine lineNumber="3300"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// stored are the same.</span></CodeLine>
<Link id="l03301" /><CodeLine lineNumber="3301"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInvariant(<a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</span></CodeLine>
<Link id="l03302" /><CodeLine lineNumber="3302"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getValueOperand()));</span></CodeLine>
<Link id="l03303" /><CodeLine lineNumber="3303"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03304" /><CodeLine lineNumber="3304"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::UDiv:</span></CodeLine>
<Link id="l03305" /><CodeLine lineNumber="3305"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SDiv:</span></CodeLine>
<Link id="l03306" /><CodeLine lineNumber="3306"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SRem:</span></CodeLine>
<Link id="l03307" /><CodeLine lineNumber="3307"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::URem:</span></CodeLine>
<Link id="l03308" /><CodeLine lineNumber="3308"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the divisor is loop-invariant no predication is needed.</span></CodeLine>
<Link id="l03309" /><CodeLine lineNumber="3309"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</span></CodeLine>
<Link id="l03310" /><CodeLine lineNumber="3310"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03311" /><CodeLine lineNumber="3311"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03312" /><CodeLine lineNumber="3312"></CodeLine>
<Link id="l03313" /><CodeLine lineNumber="3313"><span class="doxyHighlight">std::pair&lt;InstructionCost, InstructionCost&gt;</span></CodeLine>
<Link id="l03314" /><CodeLine lineNumber="3314" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad8398a35cd187d6a75b460fcf54b5236"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad8398a35cd187d6a75b460fcf54b5236">LoopVectorizationCostModel::getDivRemSpeculationCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l03315" /><CodeLine lineNumber="3315"><span class="doxyHighlight">                                                    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03316" /><CodeLine lineNumber="3316"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::UDiv ||</span></CodeLine>
<Link id="l03317" /><CodeLine lineNumber="3317"><span class="doxyHighlight">         <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::SDiv ||</span></CodeLine>
<Link id="l03318" /><CodeLine lineNumber="3318"><span class="doxyHighlight">         <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::SRem ||</span></CodeLine>
<Link id="l03319" /><CodeLine lineNumber="3319"><span class="doxyHighlight">         <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::URem);</span></CodeLine>
<Link id="l03320" /><CodeLine lineNumber="3320"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a8601ff0320b6e29a13a2194200853425">isSafeToSpeculativelyExecute</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l03321" /><CodeLine lineNumber="3321"></CodeLine>
<Link id="l03322" /><CodeLine lineNumber="3322"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scalarization isn&#39;t legal for scalable vector types</span></CodeLine>
<Link id="l03323" /><CodeLine lineNumber="3323"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarizationCost = <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l03324" /><CodeLine lineNumber="3324"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>()) &#123;</span></CodeLine>
<Link id="l03325" /><CodeLine lineNumber="3325"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Get the scalarization cost and scale this amount by the probability of</span></CodeLine>
<Link id="l03326" /><CodeLine lineNumber="3326"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// executing the predicated block. If the instruction is not predicated,</span></CodeLine>
<Link id="l03327" /><CodeLine lineNumber="3327"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we fall through to the next case.</span></CodeLine>
<Link id="l03328" /><CodeLine lineNumber="3328"><span class="doxyHighlight">    ScalarizationCost = 0;</span></CodeLine>
<Link id="l03329" /><CodeLine lineNumber="3329"></CodeLine>
<Link id="l03330" /><CodeLine lineNumber="3330"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// These instructions have a non-void type, so account for the phi nodes</span></CodeLine>
<Link id="l03331" /><CodeLine lineNumber="3331"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// that we will create. This cost is likely to be zero. The phi node</span></CodeLine>
<Link id="l03332" /><CodeLine lineNumber="3332"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cost, if any, should be scaled by the block probability because it</span></CodeLine>
<Link id="l03333" /><CodeLine lineNumber="3333"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// models a copy at the end of each predicated block.</span></CodeLine>
<Link id="l03334" /><CodeLine lineNumber="3334"><span class="doxyHighlight">    ScalarizationCost += VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42;</span></CodeLine>
<Link id="l03335" /><CodeLine lineNumber="3335"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCFInstrCost(Instruction::PHI, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l03336" /><CodeLine lineNumber="3336"></CodeLine>
<Link id="l03337" /><CodeLine lineNumber="3337"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The cost of the non-predicated instruction.</span></CodeLine>
<Link id="l03338" /><CodeLine lineNumber="3338"><span class="doxyHighlight">    ScalarizationCost += VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42;</span></CodeLine>
<Link id="l03339" /><CodeLine lineNumber="3339"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l03340" /><CodeLine lineNumber="3340"></CodeLine>
<Link id="l03341" /><CodeLine lineNumber="3341"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The cost of insertelement and extractelement instructions needed for</span></CodeLine>
<Link id="l03342" /><CodeLine lineNumber="3342"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scalarization.</span></CodeLine>
<Link id="l03343" /><CodeLine lineNumber="3343"><span class="doxyHighlight">    ScalarizationCost += getScalarizationOverhead(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l03344" /><CodeLine lineNumber="3344"></CodeLine>
<Link id="l03345" /><CodeLine lineNumber="3345"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Scale the cost by the probability of executing the predicated blocks.</span></CodeLine>
<Link id="l03346" /><CodeLine lineNumber="3346"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This assumes the predicated block for each vector lane is equally</span></CodeLine>
<Link id="l03347" /><CodeLine lineNumber="3347"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// likely.</span></CodeLine>
<Link id="l03348" /><CodeLine lineNumber="3348"><span class="doxyHighlight">    ScalarizationCost = ScalarizationCost / <a href="/docs/api/namespaces/llvm/#adb5d7cdf62c5d24e421899cd74c4550d">getReciprocalPredBlockProb</a>();</span></CodeLine>
<Link id="l03349" /><CodeLine lineNumber="3349"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03350" /><CodeLine lineNumber="3350"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> SafeDivisorCost = 0;</span></CodeLine>
<Link id="l03351" /><CodeLine lineNumber="3351"></CodeLine>
<Link id="l03352" /><CodeLine lineNumber="3352"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VecTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), VF);</span></CodeLine>
<Link id="l03353" /><CodeLine lineNumber="3353"></CodeLine>
<Link id="l03354" /><CodeLine lineNumber="3354"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The cost of the select guard to ensure all lanes are well defined</span></CodeLine>
<Link id="l03355" /><CodeLine lineNumber="3355"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// after we speculate above any internal control flow.</span></CodeLine>
<Link id="l03356" /><CodeLine lineNumber="3356"><span class="doxyHighlight">  SafeDivisorCost +=</span></CodeLine>
<Link id="l03357" /><CodeLine lineNumber="3357"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCmpSelInstrCost(Instruction::Select, VecTy,</span></CodeLine>
<Link id="l03358" /><CodeLine lineNumber="3358"><span class="doxyHighlight">                             <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext()), VF),</span></CodeLine>
<Link id="l03359" /><CodeLine lineNumber="3359"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">CmpInst::BAD&#95;ICMP&#95;PREDICATE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l03360" /><CodeLine lineNumber="3360"></CodeLine>
<Link id="l03361" /><CodeLine lineNumber="3361"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Certain instructions can be cheaper to vectorize if they have a constant</span></CodeLine>
<Link id="l03362" /><CodeLine lineNumber="3362"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// second vector operand. One example of this are shifts on x86.</span></CodeLine>
<Link id="l03363" /><CodeLine lineNumber="3363"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op2 = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1);</span></CodeLine>
<Link id="l03364" /><CodeLine lineNumber="3364"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Op2Info = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getOperandInfo(Op2);</span></CodeLine>
<Link id="l03365" /><CodeLine lineNumber="3365"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Op2Info.Kind == <a href="/docs/api/classes/llvm/targettransforminfo/#afa38851d75434d1476444ac93f94cb4ca9c0eecea29e9fa58e4dac7ee32b9b2ac">TargetTransformInfo::OK&#95;AnyValue</a> &amp;&amp;</span></CodeLine>
<Link id="l03366" /><CodeLine lineNumber="3366"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInvariant(Op2))</span></CodeLine>
<Link id="l03367" /><CodeLine lineNumber="3367"><span class="doxyHighlight">    Op2Info.Kind = <a href="/docs/api/classes/llvm/targettransforminfo/#afa38851d75434d1476444ac93f94cb4ca7aa61d9e9d33bdf28478754c69c59640">TargetTransformInfo::OK&#95;UniformValue</a>;</span></CodeLine>
<Link id="l03368" /><CodeLine lineNumber="3368"></CodeLine>
<Link id="l03369" /><CodeLine lineNumber="3369"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;, 4&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operand&#95;values());</span></CodeLine>
<Link id="l03370" /><CodeLine lineNumber="3370"><span class="doxyHighlight">  SafeDivisorCost += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(</span></CodeLine>
<Link id="l03371" /><CodeLine lineNumber="3371"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VecTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>,</span></CodeLine>
<Link id="l03372" /><CodeLine lineNumber="3372"><span class="doxyHighlight">    &#123;TargetTransformInfo::OK&#95;AnyValue, TargetTransformInfo::OP&#95;None&#125;,</span></CodeLine>
<Link id="l03373" /><CodeLine lineNumber="3373"><span class="doxyHighlight">    Op2Info, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03374" /><CodeLine lineNumber="3374"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;ScalarizationCost, SafeDivisorCost&#125;;</span></CodeLine>
<Link id="l03375" /><CodeLine lineNumber="3375"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03376" /><CodeLine lineNumber="3376"></CodeLine>
<Link id="l03377" /><CodeLine lineNumber="3377" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5964ce9ba38fe5a4d372242ac39e3f1d"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5964ce9ba38fe5a4d372242ac39e3f1d">LoopVectorizationCostModel::interleavedAccessCanBeWidened</a>(</span></CodeLine>
<Link id="l03378" /><CodeLine lineNumber="3378"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l03379" /><CodeLine lineNumber="3379"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85e3110b9fe54caf00fe4297d1b4f0b6">isAccessInterleaved</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expecting interleaved access.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03380" /><CodeLine lineNumber="3380"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">CM&#95;Unknown</a> &amp;&amp;</span></CodeLine>
<Link id="l03381" /><CodeLine lineNumber="3381"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Decision should not be set yet.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03382" /><CodeLine lineNumber="3382"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Group = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c">getInterleavedAccessGroup</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03383" /><CodeLine lineNumber="3383"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Group &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Must have a group.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03384" /><CodeLine lineNumber="3384"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> InterleaveFactor = Group-&gt;getFactor();</span></CodeLine>
<Link id="l03385" /><CodeLine lineNumber="3385"></CodeLine>
<Link id="l03386" /><CodeLine lineNumber="3386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the instruction&#39;s allocated size doesn&#39;t equal its type size, it</span></CodeLine>
<Link id="l03387" /><CodeLine lineNumber="3387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// requires padding and will be scalarized.</span></CodeLine>
<Link id="l03388" /><CodeLine lineNumber="3388"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDataLayout();</span></CodeLine>
<Link id="l03389" /><CodeLine lineNumber="3389"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ScalarTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03390" /><CodeLine lineNumber="3390"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aa407c2e7d895ed29af8cc68563c03065">hasIrregularType</a>(ScalarTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l03391" /><CodeLine lineNumber="3391"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03392" /><CodeLine lineNumber="3392"></CodeLine>
<Link id="l03393" /><CodeLine lineNumber="3393"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We currently only know how to emit interleave/deinterleave with</span></CodeLine>
<Link id="l03394" /><CodeLine lineNumber="3394"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Factor=2 for scalable vectors. This is purely an implementation</span></CodeLine>
<Link id="l03395" /><CodeLine lineNumber="3395"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// limit.</span></CodeLine>
<Link id="l03396" /><CodeLine lineNumber="3396"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp; InterleaveFactor != 2)</span></CodeLine>
<Link id="l03397" /><CodeLine lineNumber="3397"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03398" /><CodeLine lineNumber="3398"></CodeLine>
<Link id="l03399" /><CodeLine lineNumber="3399"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the group involves a non-integral pointer, we may not be able to</span></CodeLine>
<Link id="l03400" /><CodeLine lineNumber="3400"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// losslessly cast all values to a common type.</span></CodeLine>
<Link id="l03401" /><CodeLine lineNumber="3401"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ScalarNI = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isNonIntegralPointerType(ScalarTy);</span></CodeLine>
<Link id="l03402" /><CodeLine lineNumber="3402"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0; Idx &lt; InterleaveFactor; Idx++) &#123;</span></CodeLine>
<Link id="l03403" /><CodeLine lineNumber="3403"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Member = Group-&gt;getMember(Idx);</span></CodeLine>
<Link id="l03404" /><CodeLine lineNumber="3404"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Member)</span></CodeLine>
<Link id="l03405" /><CodeLine lineNumber="3405"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03406" /><CodeLine lineNumber="3406"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MemberTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(Member);</span></CodeLine>
<Link id="l03407" /><CodeLine lineNumber="3407"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MemberNI = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isNonIntegralPointerType(MemberTy);</span></CodeLine>
<Link id="l03408" /><CodeLine lineNumber="3408"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t coerce non-integral pointers to integers or vice versa.</span></CodeLine>
<Link id="l03409" /><CodeLine lineNumber="3409"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MemberNI != ScalarNI)</span></CodeLine>
<Link id="l03410" /><CodeLine lineNumber="3410"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: Consider adding special nullptr value case here</span></CodeLine>
<Link id="l03411" /><CodeLine lineNumber="3411"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03412" /><CodeLine lineNumber="3412"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MemberNI &amp;&amp; ScalarNI &amp;&amp;</span></CodeLine>
<Link id="l03413" /><CodeLine lineNumber="3413"><span class="doxyHighlight">        ScalarTy-&gt;getPointerAddressSpace() !=</span></CodeLine>
<Link id="l03414" /><CodeLine lineNumber="3414"><span class="doxyHighlight">            MemberTy-&gt;getPointerAddressSpace())</span></CodeLine>
<Link id="l03415" /><CodeLine lineNumber="3415"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03416" /><CodeLine lineNumber="3416"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03417" /><CodeLine lineNumber="3417"></CodeLine>
<Link id="l03418" /><CodeLine lineNumber="3418"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if masking is required.</span></CodeLine>
<Link id="l03419" /><CodeLine lineNumber="3419"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A Group may need masking for one of two reasons: it resides in a block that</span></CodeLine>
<Link id="l03420" /><CodeLine lineNumber="3420"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// needs predication, or it was decided to use masking to deal with gaps</span></CodeLine>
<Link id="l03421" /><CodeLine lineNumber="3421"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (either a gap at the end of a load-access that may result in a speculative</span></CodeLine>
<Link id="l03422" /><CodeLine lineNumber="3422"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// load, or any gaps in a store-access).</span></CodeLine>
<Link id="l03423" /><CodeLine lineNumber="3423"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PredicatedAccessRequiresMasking =</span></CodeLine>
<Link id="l03424" /><CodeLine lineNumber="3424"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8c8de8f62b5d2b27c4878d3effd7273">blockNeedsPredicationForAnyReason</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()) &amp;&amp;</span></CodeLine>
<Link id="l03425" /><CodeLine lineNumber="3425"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03426" /><CodeLine lineNumber="3426"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoadAccessWithGapsRequiresEpilogMasking =</span></CodeLine>
<Link id="l03427" /><CodeLine lineNumber="3427"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; Group-&gt;requiresScalarEpilogue() &amp;&amp;</span></CodeLine>
<Link id="l03428" /><CodeLine lineNumber="3428"><span class="doxyHighlight">      !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af67062c22dbf5e0ab35164a778768476">isScalarEpilogueAllowed</a>();</span></CodeLine>
<Link id="l03429" /><CodeLine lineNumber="3429"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> StoreAccessWithGapsRequiresMasking =</span></CodeLine>
<Link id="l03430" /><CodeLine lineNumber="3430"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; (Group-&gt;getNumMembers() &lt; Group-&gt;getFactor());</span></CodeLine>
<Link id="l03431" /><CodeLine lineNumber="3431"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PredicatedAccessRequiresMasking &amp;&amp;</span></CodeLine>
<Link id="l03432" /><CodeLine lineNumber="3432"><span class="doxyHighlight">      !LoadAccessWithGapsRequiresEpilogMasking &amp;&amp;</span></CodeLine>
<Link id="l03433" /><CodeLine lineNumber="3433"><span class="doxyHighlight">      !StoreAccessWithGapsRequiresMasking)</span></CodeLine>
<Link id="l03434" /><CodeLine lineNumber="3434"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03435" /><CodeLine lineNumber="3435"></CodeLine>
<Link id="l03436" /><CodeLine lineNumber="3436"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If masked interleaving is required, we expect that the user/target had</span></CodeLine>
<Link id="l03437" /><CodeLine lineNumber="3437"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// enabled it, because otherwise it either wouldn&#39;t have been created or</span></CodeLine>
<Link id="l03438" /><CodeLine lineNumber="3438"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it should have been invalidated by the CostModel.</span></CodeLine>
<Link id="l03439" /><CodeLine lineNumber="3439"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#adf8d8fb6f39b9c0cf21d55b7229d35e2">useMaskedInterleavedAccesses</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>) &amp;&amp;</span></CodeLine>
<Link id="l03440" /><CodeLine lineNumber="3440"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Masked interleave-groups for predicated accesses are not enabled.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03441" /><CodeLine lineNumber="3441"></CodeLine>
<Link id="l03442" /><CodeLine lineNumber="3442"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Group-&gt;isReverse())</span></CodeLine>
<Link id="l03443" /><CodeLine lineNumber="3443"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03444" /><CodeLine lineNumber="3444"></CodeLine>
<Link id="l03445" /><CodeLine lineNumber="3445"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Ty = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03446" /><CodeLine lineNumber="3446"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/align">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03447" /><CodeLine lineNumber="3447"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ? <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedLoad(Ty, Alignment)</span></CodeLine>
<Link id="l03448" /><CodeLine lineNumber="3448"><span class="doxyHighlight">                          : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedStore(Ty, Alignment);</span></CodeLine>
<Link id="l03449" /><CodeLine lineNumber="3449"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03450" /><CodeLine lineNumber="3450"></CodeLine>
<Link id="l03451" /><CodeLine lineNumber="3451" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a59a6dd7531c8683174f886ff7698cc63"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a59a6dd7531c8683174f886ff7698cc63">LoopVectorizationCostModel::memoryInstructionCanBeWidened</a>(</span></CodeLine>
<Link id="l03452" /><CodeLine lineNumber="3452"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l03453" /><CodeLine lineNumber="3453"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get and ensure we have a valid memory instruction.</span></CodeLine>
<Link id="l03454" /><CodeLine lineNumber="3454"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst, StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Invalid memory instruction&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03455" /><CodeLine lineNumber="3455"></CodeLine>
<Link id="l03456" /><CodeLine lineNumber="3456"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03457" /><CodeLine lineNumber="3457"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ScalarTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03458" /><CodeLine lineNumber="3458"></CodeLine>
<Link id="l03459" /><CodeLine lineNumber="3459"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In order to be widened, the pointer should be consecutive, first of all.</span></CodeLine>
<Link id="l03460" /><CodeLine lineNumber="3460"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isConsecutivePtr(ScalarTy, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>))</span></CodeLine>
<Link id="l03461" /><CodeLine lineNumber="3461"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03462" /><CodeLine lineNumber="3462"></CodeLine>
<Link id="l03463" /><CodeLine lineNumber="3463"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the instruction is a store located in a predicated block, it will be</span></CodeLine>
<Link id="l03464" /><CodeLine lineNumber="3464"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// scalarized.</span></CodeLine>
<Link id="l03465" /><CodeLine lineNumber="3465"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8">isScalarWithPredication</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</span></CodeLine>
<Link id="l03466" /><CodeLine lineNumber="3466"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03467" /><CodeLine lineNumber="3467"></CodeLine>
<Link id="l03468" /><CodeLine lineNumber="3468"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the instruction&#39;s allocated size doesn&#39;t equal it&#39;s type size, it</span></CodeLine>
<Link id="l03469" /><CodeLine lineNumber="3469"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// requires padding and will be scalarized.</span></CodeLine>
<Link id="l03470" /><CodeLine lineNumber="3470"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDataLayout();</span></CodeLine>
<Link id="l03471" /><CodeLine lineNumber="3471"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aa407c2e7d895ed29af8cc68563c03065">hasIrregularType</a>(ScalarTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</span></CodeLine>
<Link id="l03472" /><CodeLine lineNumber="3472"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03473" /><CodeLine lineNumber="3473"></CodeLine>
<Link id="l03474" /><CodeLine lineNumber="3474"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03475" /><CodeLine lineNumber="3475"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03476" /><CodeLine lineNumber="3476"></CodeLine>
<Link id="l03477" /><CodeLine lineNumber="3477"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> LoopVectorizationCostModel::collectLoopUniforms(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l03478" /><CodeLine lineNumber="3478"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We should not collect Uniforms more than once per VF. Right now,</span></CodeLine>
<Link id="l03479" /><CodeLine lineNumber="3479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// this function is called from collectUniformsAndScalars(), which</span></CodeLine>
<Link id="l03480" /><CodeLine lineNumber="3480"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// already does this check. Collecting Uniforms for VF=1 does not make any</span></CodeLine>
<Link id="l03481" /><CodeLine lineNumber="3481"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// sense.</span></CodeLine>
<Link id="l03482" /><CodeLine lineNumber="3482"></CodeLine>
<Link id="l03483" /><CodeLine lineNumber="3483"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; !Uniforms.<a href="/docs/api/classes/llvm/densemapbase/#a836d9cba6deced0bb1fa7333ce5afd3a">contains</a>(VF) &amp;&amp;</span></CodeLine>
<Link id="l03484" /><CodeLine lineNumber="3484"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;This function should not be visited twice for the same VF&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03485" /><CodeLine lineNumber="3485"></CodeLine>
<Link id="l03486" /><CodeLine lineNumber="3486"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Visit the list of Uniforms. If we find no uniform value, we won&#39;t</span></CodeLine>
<Link id="l03487" /><CodeLine lineNumber="3487"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// analyze again.  Uniforms.count(VF) will return 1</span></CodeLine>
<Link id="l03488" /><CodeLine lineNumber="3488"><span class="doxyHighlight">  Uniforms&#91;VF&#93;.<a href="/docs/api/classes/llvm/densemapbase/#adf4e7878fc0b3b8dcde545178564190d">clear</a>();</span></CodeLine>
<Link id="l03489" /><CodeLine lineNumber="3489"></CodeLine>
<Link id="l03490" /><CodeLine lineNumber="3490"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now we know that the loop is vectorizable!</span></CodeLine>
<Link id="l03491" /><CodeLine lineNumber="3491"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect instructions inside the loop that will remain uniform after</span></CodeLine>
<Link id="l03492" /><CodeLine lineNumber="3492"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorization.</span></CodeLine>
<Link id="l03493" /><CodeLine lineNumber="3493"></CodeLine>
<Link id="l03494" /><CodeLine lineNumber="3494"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Global values, params and instructions outside of current loop are out of</span></CodeLine>
<Link id="l03495" /><CodeLine lineNumber="3495"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// scope.</span></CodeLine>
<Link id="l03496" /><CodeLine lineNumber="3496"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsOutOfScope = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03497" /><CodeLine lineNumber="3497"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l03498" /><CodeLine lineNumber="3498"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l03499" /><CodeLine lineNumber="3499"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03500" /><CodeLine lineNumber="3500"></CodeLine>
<Link id="l03501" /><CodeLine lineNumber="3501"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Worklist containing uniform instructions demanding lane 0</span></CodeLine>
<Link id="l03502" /><CodeLine lineNumber="3502"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Instruction &#42;&gt;</a> Worklist;</span></CodeLine>
<Link id="l03503" /><CodeLine lineNumber="3503"></CodeLine>
<Link id="l03504" /><CodeLine lineNumber="3504"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add uniform instructions demanding lane 0 to the worklist. Instructions</span></CodeLine>
<Link id="l03505" /><CodeLine lineNumber="3505"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that require predication must not be considered uniform after</span></CodeLine>
<Link id="l03506" /><CodeLine lineNumber="3506"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorization, because that would create an erroneous replicating region</span></CodeLine>
<Link id="l03507" /><CodeLine lineNumber="3507"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// where only a single instance out of VF should be formed.</span></CodeLine>
<Link id="l03508" /><CodeLine lineNumber="3508"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> AddToWorklistIfAllowed = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03509" /><CodeLine lineNumber="3509"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsOutOfScope(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l03510" /><CodeLine lineNumber="3510"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found not uniform due to scope: &quot;</span></CodeLine>
<Link id="l03511" /><CodeLine lineNumber="3511"><span class="doxyHighlight">                        &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03512" /><CodeLine lineNumber="3512"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03513" /><CodeLine lineNumber="3513"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03514" /><CodeLine lineNumber="3514"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">isPredicatedInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l03515" /><CodeLine lineNumber="3515"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l03516" /><CodeLine lineNumber="3516"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found not uniform due to requiring predication: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a></span></CodeLine>
<Link id="l03517" /><CodeLine lineNumber="3517"><span class="doxyHighlight">                 &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03518" /><CodeLine lineNumber="3518"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03519" /><CodeLine lineNumber="3519"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03520" /><CodeLine lineNumber="3520"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found uniform instruction: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03521" /><CodeLine lineNumber="3521"><span class="doxyHighlight">    Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03522" /><CodeLine lineNumber="3522"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03523" /><CodeLine lineNumber="3523"></CodeLine>
<Link id="l03524" /><CodeLine lineNumber="3524"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Start with the conditional branches exiting the loop. If the branch</span></CodeLine>
<Link id="l03525" /><CodeLine lineNumber="3525"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// condition is an instruction contained in the loop that is only used by the</span></CodeLine>
<Link id="l03526" /><CodeLine lineNumber="3526"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branch, it is uniform. Note conditions from uncountable early exits are not</span></CodeLine>
<Link id="l03527" /><CodeLine lineNumber="3527"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// uniform.</span></CodeLine>
<Link id="l03528" /><CodeLine lineNumber="3528"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;BasicBlock &#42;&gt;</a> Exiting;</span></CodeLine>
<Link id="l03529" /><CodeLine lineNumber="3529"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getExitingBlocks(Exiting);</span></CodeLine>
<Link id="l03530" /><CodeLine lineNumber="3530"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (BasicBlock &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> : Exiting) &#123;</span></CodeLine>
<Link id="l03531" /><CodeLine lineNumber="3531"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;hasUncountableEarlyExit() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getLoopLatch() != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>)</span></CodeLine>
<Link id="l03532" /><CodeLine lineNumber="3532"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03533" /><CodeLine lineNumber="3533"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>-&gt;getTerminator()-&gt;getOperand(0));</span></CodeLine>
<Link id="l03534" /><CodeLine lineNumber="3534"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Cmp &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(Cmp) &amp;&amp; <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;hasOneUse())</span></CodeLine>
<Link id="l03535" /><CodeLine lineNumber="3535"><span class="doxyHighlight">      AddToWorklistIfAllowed(Cmp);</span></CodeLine>
<Link id="l03536" /><CodeLine lineNumber="3536"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03537" /><CodeLine lineNumber="3537"></CodeLine>
<Link id="l03538" /><CodeLine lineNumber="3538"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> PrevVF = VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ae7510a639ca53c1bfa1c90c6dfc7eb2e">divideCoefficientBy</a>(2);</span></CodeLine>
<Link id="l03539" /><CodeLine lineNumber="3539"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Return true if all lanes perform the same memory operation, and we can</span></CodeLine>
<Link id="l03540" /><CodeLine lineNumber="3540"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// thus choose to execute only one.</span></CodeLine>
<Link id="l03541" /><CodeLine lineNumber="3541"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsUniformMemOpUse = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l03542" /><CodeLine lineNumber="3542"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the value was already known to not be uniform for the previous</span></CodeLine>
<Link id="l03543" /><CodeLine lineNumber="3543"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (smaller VF), it cannot be uniform for the larger VF.</span></CodeLine>
<Link id="l03544" /><CodeLine lineNumber="3544"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PrevVF.isVector()) &#123;</span></CodeLine>
<Link id="l03545" /><CodeLine lineNumber="3545"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/anonymous-cskyconstantislandpass-cpp-/#a0bd7d621ba8de56e4052df49da823802">Iter</a> = Uniforms.find(PrevVF);</span></CodeLine>
<Link id="l03546" /><CodeLine lineNumber="3546"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Iter != Uniforms.end() &amp;&amp; !<a href="/docs/api/namespaces/anonymous-cskyconstantislandpass-cpp-/#a0bd7d621ba8de56e4052df49da823802">Iter</a>-&gt;second.contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l03547" /><CodeLine lineNumber="3547"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03548" /><CodeLine lineNumber="3548"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03549" /><CodeLine lineNumber="3549"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isUniformMemOp(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</span></CodeLine>
<Link id="l03550" /><CodeLine lineNumber="3550"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03551" /><CodeLine lineNumber="3551"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l03552" /><CodeLine lineNumber="3552"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Loading the same address always produces the same result - at least</span></CodeLine>
<Link id="l03553" /><CodeLine lineNumber="3553"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// assuming aliasing and ordering which have already been checked.</span></CodeLine>
<Link id="l03554" /><CodeLine lineNumber="3554"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03555" /><CodeLine lineNumber="3555"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Storing the same value on every iteration.</span></CodeLine>
<Link id="l03556" /><CodeLine lineNumber="3556"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getValueOperand());</span></CodeLine>
<Link id="l03557" /><CodeLine lineNumber="3557"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03558" /><CodeLine lineNumber="3558"></CodeLine>
<Link id="l03559" /><CodeLine lineNumber="3559"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsUniformDecision = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ElementCount VF) &#123;</span></CodeLine>
<Link id="l03560" /><CodeLine lineNumber="3560"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> WideningDecision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l03561" /><CodeLine lineNumber="3561"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(WideningDecision != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">CM&#95;Unknown</a> &amp;&amp;</span></CodeLine>
<Link id="l03562" /><CodeLine lineNumber="3562"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Widening decision should be ready at this moment&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03563" /><CodeLine lineNumber="3563"></CodeLine>
<Link id="l03564" /><CodeLine lineNumber="3564"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsUniformMemOpUse(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l03565" /><CodeLine lineNumber="3565"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03566" /><CodeLine lineNumber="3566"></CodeLine>
<Link id="l03567" /><CodeLine lineNumber="3567"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (WideningDecision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260adc468760c02910f77bad7525bc66c334">CM&#95;Widen</a> ||</span></CodeLine>
<Link id="l03568" /><CodeLine lineNumber="3568"><span class="doxyHighlight">            WideningDecision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a058eacbd3c28e2ecec2af7db726ce527">CM&#95;Widen&#95;Reverse</a> ||</span></CodeLine>
<Link id="l03569" /><CodeLine lineNumber="3569"><span class="doxyHighlight">            WideningDecision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971">CM&#95;Interleave</a>);</span></CodeLine>
<Link id="l03570" /><CodeLine lineNumber="3570"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03571" /><CodeLine lineNumber="3571"></CodeLine>
<Link id="l03572" /><CodeLine lineNumber="3572"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Returns true if Ptr is the pointer operand of a memory access instruction</span></CodeLine>
<Link id="l03573" /><CodeLine lineNumber="3573"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// I, I is known to not require scalarization, and the pointer is not also</span></CodeLine>
<Link id="l03574" /><CodeLine lineNumber="3574"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stored.</span></CodeLine>
<Link id="l03575" /><CodeLine lineNumber="3575"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsVectorizedMemAccessUse = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03576" /><CodeLine lineNumber="3576"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0) == <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)</span></CodeLine>
<Link id="l03577" /><CodeLine lineNumber="3577"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03578" /><CodeLine lineNumber="3578"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) == <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> &amp;&amp;</span></CodeLine>
<Link id="l03579" /><CodeLine lineNumber="3579"><span class="doxyHighlight">           (IsUniformDecision(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) || <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInvariant(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>));</span></CodeLine>
<Link id="l03580" /><CodeLine lineNumber="3580"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l03581" /><CodeLine lineNumber="3581"></CodeLine>
<Link id="l03582" /><CodeLine lineNumber="3582"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Holds a list of values which are known to have at least one uniform use.</span></CodeLine>
<Link id="l03583" /><CodeLine lineNumber="3583"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that there may be other uses which aren&#39;t uniform.  A &quot;uniform use&quot;</span></CodeLine>
<Link id="l03584" /><CodeLine lineNumber="3584"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// here is something which only demands lane 0 of the unrolled iterations;</span></CodeLine>
<Link id="l03585" /><CodeLine lineNumber="3585"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it does not imply that all lanes produce the same value (e.g. this is not</span></CodeLine>
<Link id="l03586" /><CodeLine lineNumber="3586"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the usual meaning of uniform)</span></CodeLine>
<Link id="l03587" /><CodeLine lineNumber="3587"><span class="doxyHighlight">  SetVector&lt;Value &#42;&gt; HasUniformUse;</span></CodeLine>
<Link id="l03588" /><CodeLine lineNumber="3588"></CodeLine>
<Link id="l03589" /><CodeLine lineNumber="3589"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan the loop for instructions which are either a) known to have only</span></CodeLine>
<Link id="l03590" /><CodeLine lineNumber="3590"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// lane 0 demanded or b) are uses which demand only lane 0 of their operand.</span></CodeLine>
<Link id="l03591" /><CodeLine lineNumber="3591"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks())</span></CodeLine>
<Link id="l03592" /><CodeLine lineNumber="3592"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l03593" /><CodeLine lineNumber="3593"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IntrinsicInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l03594" /><CodeLine lineNumber="3594"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID()) &#123;</span></CodeLine>
<Link id="l03595" /><CodeLine lineNumber="3595"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::sideeffect:</span></CodeLine>
<Link id="l03596" /><CodeLine lineNumber="3596"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::experimental&#95;noalias&#95;scope&#95;decl:</span></CodeLine>
<Link id="l03597" /><CodeLine lineNumber="3597"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::assume:</span></CodeLine>
<Link id="l03598" /><CodeLine lineNumber="3598"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::lifetime&#95;start:</span></CodeLine>
<Link id="l03599" /><CodeLine lineNumber="3599"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::lifetime&#95;end:</span></CodeLine>
<Link id="l03600" /><CodeLine lineNumber="3600"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;hasLoopInvariantOperands(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l03601" /><CodeLine lineNumber="3601"><span class="doxyHighlight">            AddToWorklistIfAllowed(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03602" /><CodeLine lineNumber="3602"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03603" /><CodeLine lineNumber="3603"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l03604" /><CodeLine lineNumber="3604"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03605" /><CodeLine lineNumber="3605"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l03606" /><CodeLine lineNumber="3606"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03607" /><CodeLine lineNumber="3607"></CodeLine>
<Link id="l03608" /><CodeLine lineNumber="3608"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// ExtractValue instructions must be uniform, because the operands are</span></CodeLine>
<Link id="l03609" /><CodeLine lineNumber="3609"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// known to be loop-invariant.</span></CodeLine>
<Link id="l03610" /><CodeLine lineNumber="3610"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EVI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ExtractValueInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l03611" /><CodeLine lineNumber="3611"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IsOutOfScope(EVI-&gt;getAggregateOperand()) &amp;&amp;</span></CodeLine>
<Link id="l03612" /><CodeLine lineNumber="3612"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;Expected aggregate value to be loop invariant&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03613" /><CodeLine lineNumber="3613"><span class="doxyHighlight">        AddToWorklistIfAllowed(EVI);</span></CodeLine>
<Link id="l03614" /><CodeLine lineNumber="3614"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03615" /><CodeLine lineNumber="3615"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l03616" /><CodeLine lineNumber="3616"></CodeLine>
<Link id="l03617" /><CodeLine lineNumber="3617"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If there&#39;s no pointer operand, there&#39;s nothing to do.</span></CodeLine>
<Link id="l03618" /><CodeLine lineNumber="3618"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03619" /><CodeLine lineNumber="3619"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)</span></CodeLine>
<Link id="l03620" /><CodeLine lineNumber="3620"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03621" /><CodeLine lineNumber="3621"></CodeLine>
<Link id="l03622" /><CodeLine lineNumber="3622"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsUniformMemOpUse(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l03623" /><CodeLine lineNumber="3623"><span class="doxyHighlight">        AddToWorklistIfAllowed(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03624" /><CodeLine lineNumber="3624"></CodeLine>
<Link id="l03625" /><CodeLine lineNumber="3625"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsVectorizedMemAccessUse(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>))</span></CodeLine>
<Link id="l03626" /><CodeLine lineNumber="3626"><span class="doxyHighlight">        HasUniformUse.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</span></CodeLine>
<Link id="l03627" /><CodeLine lineNumber="3627"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03628" /><CodeLine lineNumber="3628"></CodeLine>
<Link id="l03629" /><CodeLine lineNumber="3629"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add to the worklist any operands which have &#42;only&#42; uniform (e.g. lane 0</span></CodeLine>
<Link id="l03630" /><CodeLine lineNumber="3630"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// demanding) users.  Since loops are assumed to be in LCSSA form, this</span></CodeLine>
<Link id="l03631" /><CodeLine lineNumber="3631"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// disallows uses outside the loop as well.</span></CodeLine>
<Link id="l03632" /><CodeLine lineNumber="3632"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;V : HasUniformUse) &#123;</span></CodeLine>
<Link id="l03633" /><CodeLine lineNumber="3633"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsOutOfScope(V))</span></CodeLine>
<Link id="l03634" /><CodeLine lineNumber="3634"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03635" /><CodeLine lineNumber="3635"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V);</span></CodeLine>
<Link id="l03636" /><CodeLine lineNumber="3636"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UsersAreMemAccesses = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users(), &#91;&amp;&#93;(User &#42;U) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03637" /><CodeLine lineNumber="3637"><span class="doxyHighlight">      auto &#42;UI = cast&lt;Instruction&gt;(U);</span></CodeLine>
<Link id="l03638" /><CodeLine lineNumber="3638"><span class="doxyHighlight">      return TheLoop-&gt;contains(UI) &amp;&amp; IsVectorizedMemAccessUse(UI, V);</span></CodeLine>
<Link id="l03639" /><CodeLine lineNumber="3639"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l03640" /><CodeLine lineNumber="3640"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UsersAreMemAccesses)</span></CodeLine>
<Link id="l03641" /><CodeLine lineNumber="3641"><span class="doxyHighlight">      AddToWorklistIfAllowed(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l03642" /><CodeLine lineNumber="3642"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03643" /><CodeLine lineNumber="3643"></CodeLine>
<Link id="l03644" /><CodeLine lineNumber="3644"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Expand Worklist in topological order: whenever a new instruction</span></CodeLine>
<Link id="l03645" /><CodeLine lineNumber="3645"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is added , its users should be already inside Worklist.  It ensures</span></CodeLine>
<Link id="l03646" /><CodeLine lineNumber="3646"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a uniform instruction will only be used by uniform instructions.</span></CodeLine>
<Link id="l03647" /><CodeLine lineNumber="3647"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0;</span></CodeLine>
<Link id="l03648" /><CodeLine lineNumber="3648"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (Idx != Worklist.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>()) &#123;</span></CodeLine>
<Link id="l03649" /><CodeLine lineNumber="3649"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Worklist&#91;Idx++&#93;;</span></CodeLine>
<Link id="l03650" /><CodeLine lineNumber="3650"></CodeLine>
<Link id="l03651" /><CodeLine lineNumber="3651"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OV : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operand&#95;values()) &#123;</span></CodeLine>
<Link id="l03652" /><CodeLine lineNumber="3652"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// isOutOfScope operands cannot be uniform instructions.</span></CodeLine>
<Link id="l03653" /><CodeLine lineNumber="3653"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsOutOfScope(OV))</span></CodeLine>
<Link id="l03654" /><CodeLine lineNumber="3654"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03655" /><CodeLine lineNumber="3655"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// First order recurrence Phi&#39;s should typically be considered</span></CodeLine>
<Link id="l03656" /><CodeLine lineNumber="3656"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// non-uniform.</span></CodeLine>
<Link id="l03657" /><CodeLine lineNumber="3657"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/include/include/llvm/include/llvm/sandboxir/instruction-h/#a0b0cd724f4b7f8589a602b17d6caa1fb">OP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(OV);</span></CodeLine>
<Link id="l03658" /><CodeLine lineNumber="3658"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/include/include/llvm/include/llvm/sandboxir/instruction-h/#a0b0cd724f4b7f8589a602b17d6caa1fb">OP</a> &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isFixedOrderRecurrence(<a href="/docs/api/files/include/include/llvm/include/llvm/sandboxir/instruction-h/#a0b0cd724f4b7f8589a602b17d6caa1fb">OP</a>))</span></CodeLine>
<Link id="l03659" /><CodeLine lineNumber="3659"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03660" /><CodeLine lineNumber="3660"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If all the users of the operand are uniform, then add the</span></CodeLine>
<Link id="l03661" /><CodeLine lineNumber="3661"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// operand into the uniform worklist.</span></CodeLine>
<Link id="l03662" /><CodeLine lineNumber="3662"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(OV);</span></CodeLine>
<Link id="l03663" /><CodeLine lineNumber="3663"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(OI-&gt;users(), &#91;&amp;&#93;(User &#42;U) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03664" /><CodeLine lineNumber="3664"><span class="doxyHighlight">            auto &#42;J = cast&lt;Instruction&gt;(U);</span></CodeLine>
<Link id="l03665" /><CodeLine lineNumber="3665"><span class="doxyHighlight">            return Worklist.count(J) || IsVectorizedMemAccessUse(J, OI);</span></CodeLine>
<Link id="l03666" /><CodeLine lineNumber="3666"><span class="doxyHighlight">          &#125;))</span></CodeLine>
<Link id="l03667" /><CodeLine lineNumber="3667"><span class="doxyHighlight">        AddToWorklistIfAllowed(OI);</span></CodeLine>
<Link id="l03668" /><CodeLine lineNumber="3668"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03669" /><CodeLine lineNumber="3669"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03670" /><CodeLine lineNumber="3670"></CodeLine>
<Link id="l03671" /><CodeLine lineNumber="3671"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For an instruction to be added into Worklist above, all its users inside</span></CodeLine>
<Link id="l03672" /><CodeLine lineNumber="3672"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the loop should also be in Worklist. However, this condition cannot be</span></CodeLine>
<Link id="l03673" /><CodeLine lineNumber="3673"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// true for phi nodes that form a cyclic dependence. We must process phi</span></CodeLine>
<Link id="l03674" /><CodeLine lineNumber="3674"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// nodes separately. An induction variable will remain uniform if all users</span></CodeLine>
<Link id="l03675" /><CodeLine lineNumber="3675"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the induction variable and induction variable update remain uniform.</span></CodeLine>
<Link id="l03676" /><CodeLine lineNumber="3676"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The code below handles both pointer and non-pointer induction variables.</span></CodeLine>
<Link id="l03677" /><CodeLine lineNumber="3677"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;Latch = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getLoopLatch();</span></CodeLine>
<Link id="l03678" /><CodeLine lineNumber="3678"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Induction : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getInductionVars()) &#123;</span></CodeLine>
<Link id="l03679" /><CodeLine lineNumber="3679"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Ind = Induction.first;</span></CodeLine>
<Link id="l03680" /><CodeLine lineNumber="3680"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IndUpdate = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Ind-&gt;getIncomingValueForBlock(Latch));</span></CodeLine>
<Link id="l03681" /><CodeLine lineNumber="3681"></CodeLine>
<Link id="l03682" /><CodeLine lineNumber="3682"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Determine if all users of the induction variable are uniform after</span></CodeLine>
<Link id="l03683" /><CodeLine lineNumber="3683"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// vectorization.</span></CodeLine>
<Link id="l03684" /><CodeLine lineNumber="3684"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UniformInd = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(Ind-&gt;users(), &#91;&amp;&#93;(User &#42;U) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03685" /><CodeLine lineNumber="3685"><span class="doxyHighlight">      auto &#42;I = cast&lt;Instruction&gt;(U);</span></CodeLine>
<Link id="l03686" /><CodeLine lineNumber="3686"><span class="doxyHighlight">      return I == IndUpdate || !TheLoop-&gt;contains(I) || Worklist.count(I) ||</span></CodeLine>
<Link id="l03687" /><CodeLine lineNumber="3687"><span class="doxyHighlight">             IsVectorizedMemAccessUse(I, Ind);</span></CodeLine>
<Link id="l03688" /><CodeLine lineNumber="3688"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l03689" /><CodeLine lineNumber="3689"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UniformInd)</span></CodeLine>
<Link id="l03690" /><CodeLine lineNumber="3690"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03691" /><CodeLine lineNumber="3691"></CodeLine>
<Link id="l03692" /><CodeLine lineNumber="3692"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Determine if all users of the induction variable update instruction are</span></CodeLine>
<Link id="l03693" /><CodeLine lineNumber="3693"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// uniform after vectorization.</span></CodeLine>
<Link id="l03694" /><CodeLine lineNumber="3694"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UniformIndUpdate = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(IndUpdate-&gt;users(), &#91;&amp;&#93;(User &#42;U) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03695" /><CodeLine lineNumber="3695"><span class="doxyHighlight">      auto &#42;I = cast&lt;Instruction&gt;(U);</span></CodeLine>
<Link id="l03696" /><CodeLine lineNumber="3696"><span class="doxyHighlight">      return I == Ind || Worklist.count(I) ||</span></CodeLine>
<Link id="l03697" /><CodeLine lineNumber="3697"><span class="doxyHighlight">             IsVectorizedMemAccessUse(I, IndUpdate);</span></CodeLine>
<Link id="l03698" /><CodeLine lineNumber="3698"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l03699" /><CodeLine lineNumber="3699"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UniformIndUpdate)</span></CodeLine>
<Link id="l03700" /><CodeLine lineNumber="3700"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03701" /><CodeLine lineNumber="3701"></CodeLine>
<Link id="l03702" /><CodeLine lineNumber="3702"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The induction variable and its update instruction will remain uniform.</span></CodeLine>
<Link id="l03703" /><CodeLine lineNumber="3703"><span class="doxyHighlight">    AddToWorklistIfAllowed(Ind);</span></CodeLine>
<Link id="l03704" /><CodeLine lineNumber="3704"><span class="doxyHighlight">    AddToWorklistIfAllowed(IndUpdate);</span></CodeLine>
<Link id="l03705" /><CodeLine lineNumber="3705"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03706" /><CodeLine lineNumber="3706"></CodeLine>
<Link id="l03707" /><CodeLine lineNumber="3707"><span class="doxyHighlight">  Uniforms&#91;VF&#93;.insert(Worklist.<a href="/docs/api/classes/llvm/setvector/#ad0bf95396cec46a41371341460d14a1c">begin</a>(), Worklist.<a href="/docs/api/classes/llvm/setvector/#a889cc0df630d4b01e12d359517e26670">end</a>());</span></CodeLine>
<Link id="l03708" /><CodeLine lineNumber="3708"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03709" /><CodeLine lineNumber="3709"></CodeLine>
<Link id="l03710" /><CodeLine lineNumber="3710" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#aad6239ca8b51657f5ebdbd6e51e6ea90"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aad6239ca8b51657f5ebdbd6e51e6ea90">LoopVectorizationCostModel::runtimeChecksRequired</a>() &#123;</span></CodeLine>
<Link id="l03711" /><CodeLine lineNumber="3711"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Performing code size checks.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03712" /><CodeLine lineNumber="3712"></CodeLine>
<Link id="l03713" /><CodeLine lineNumber="3713"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getRuntimePointerChecking()-&gt;Need) &#123;</span></CodeLine>
<Link id="l03714" /><CodeLine lineNumber="3714"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span><span class="doxyHighlightStringLiteral">&quot;Runtime ptr check is required with -Os/-Oz&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03715" /><CodeLine lineNumber="3715"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;runtime pointer checks needed. Enable vectorization of this &quot;</span></CodeLine>
<Link id="l03716" /><CodeLine lineNumber="3716"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;loop with &#39;#pragma clang loop vectorize(enable)&#39; when &quot;</span></CodeLine>
<Link id="l03717" /><CodeLine lineNumber="3717"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;compiling with -Os/-Oz&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03718" /><CodeLine lineNumber="3718"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;CantVersionLoopWithOptForSize&quot;</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l03719" /><CodeLine lineNumber="3719"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03720" /><CodeLine lineNumber="3720"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03721" /><CodeLine lineNumber="3721"></CodeLine>
<Link id="l03722" /><CodeLine lineNumber="3722"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getPredicate().isAlwaysTrue()) &#123;</span></CodeLine>
<Link id="l03723" /><CodeLine lineNumber="3723"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span><span class="doxyHighlightStringLiteral">&quot;Runtime SCEV check is required with -Os/-Oz&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03724" /><CodeLine lineNumber="3724"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;runtime SCEV checks needed. Enable vectorization of this &quot;</span></CodeLine>
<Link id="l03725" /><CodeLine lineNumber="3725"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;loop with &#39;#pragma clang loop vectorize(enable)&#39; when &quot;</span></CodeLine>
<Link id="l03726" /><CodeLine lineNumber="3726"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;compiling with -Os/-Oz&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03727" /><CodeLine lineNumber="3727"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;CantVersionLoopWithOptForSize&quot;</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l03728" /><CodeLine lineNumber="3728"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03729" /><CodeLine lineNumber="3729"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03730" /><CodeLine lineNumber="3730"></CodeLine>
<Link id="l03731" /><CodeLine lineNumber="3731"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Avoid specializing for stride==1 instead of bailing out.</span></CodeLine>
<Link id="l03732" /><CodeLine lineNumber="3732"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getLAI()-&gt;getSymbolicStrides().empty()) &#123;</span></CodeLine>
<Link id="l03733" /><CodeLine lineNumber="3733"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span><span class="doxyHighlightStringLiteral">&quot;Runtime stride check for small trip count&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03734" /><CodeLine lineNumber="3734"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;runtime stride == 1 checks needed. Enable vectorization of &quot;</span></CodeLine>
<Link id="l03735" /><CodeLine lineNumber="3735"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;this loop without such check by compiling with -Os/-Oz&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03736" /><CodeLine lineNumber="3736"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;CantVersionLoopWithOptForSize&quot;</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l03737" /><CodeLine lineNumber="3737"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03738" /><CodeLine lineNumber="3738"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03739" /><CodeLine lineNumber="3739"></CodeLine>
<Link id="l03740" /><CodeLine lineNumber="3740"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03741" /><CodeLine lineNumber="3741"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03742" /><CodeLine lineNumber="3742"></CodeLine>
<Link id="l03743" /><CodeLine lineNumber="3743"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopVectorizationCostModel::isScalableVectorizationAllowed() &#123;</span></CodeLine>
<Link id="l03744" /><CodeLine lineNumber="3744"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsScalableVectorizationAllowed)</span></CodeLine>
<Link id="l03745" /><CodeLine lineNumber="3745"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;IsScalableVectorizationAllowed;</span></CodeLine>
<Link id="l03746" /><CodeLine lineNumber="3746"></CodeLine>
<Link id="l03747" /><CodeLine lineNumber="3747"><span class="doxyHighlight">  IsScalableVectorizationAllowed = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03748" /><CodeLine lineNumber="3748"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.supportsScalableVectors() &amp;&amp; !<a href="#a48035e22b43c905a2961c90e5470b2f0">ForceTargetSupportsScalableVectors</a>)</span></CodeLine>
<Link id="l03749" /><CodeLine lineNumber="3749"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03750" /><CodeLine lineNumber="3750"></CodeLine>
<Link id="l03751" /><CodeLine lineNumber="3751"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35e67974daa692cfd961904c151ad33d">Hints</a>-&gt;<a href="/docs/api/classes/llvm/loopvectorizehints/#a1289a2ba34766f399d81f71c0f6b3a94">isScalableVectorizationDisabled</a>()) &#123;</span></CodeLine>
<Link id="l03752" /><CodeLine lineNumber="3752"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</span><span class="doxyHighlightStringLiteral">&quot;Scalable vectorization is explicitly disabled&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03753" /><CodeLine lineNumber="3753"><span class="doxyHighlight">                            </span><span class="doxyHighlightStringLiteral">&quot;ScalableVectorizationDisabled&quot;</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l03754" /><CodeLine lineNumber="3754"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03755" /><CodeLine lineNumber="3755"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03756" /><CodeLine lineNumber="3756"></CodeLine>
<Link id="l03757" /><CodeLine lineNumber="3757"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Scalable vectorization is available\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03758" /><CodeLine lineNumber="3758"></CodeLine>
<Link id="l03759" /><CodeLine lineNumber="3759"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MaxScalableVF = <a href="/docs/api/classes/llvm/elementcount/#a1bddc4949ab247dd1474f79b9bc6e34e">ElementCount::getScalable</a>(</span></CodeLine>
<Link id="l03760" /><CodeLine lineNumber="3760"><span class="doxyHighlight">      std::numeric&#95;limits&lt;ElementCount::ScalarTy&gt;::max());</span></CodeLine>
<Link id="l03761" /><CodeLine lineNumber="3761"></CodeLine>
<Link id="l03762" /><CodeLine lineNumber="3762"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Test that the loop-vectorizer can legalize all operations for this MaxVF.</span></CodeLine>
<Link id="l03763" /><CodeLine lineNumber="3763"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: While for scalable vectors this is currently sufficient, this should</span></CodeLine>
<Link id="l03764" /><CodeLine lineNumber="3764"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be replaced by a more detailed mechanism that filters out specific VFs,</span></CodeLine>
<Link id="l03765" /><CodeLine lineNumber="3765"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instead of invalidating vectorization for a whole set of VFs based on the</span></CodeLine>
<Link id="l03766" /><CodeLine lineNumber="3766"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// MaxVF.</span></CodeLine>
<Link id="l03767" /><CodeLine lineNumber="3767"></CodeLine>
<Link id="l03768" /><CodeLine lineNumber="3768"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Disable scalable vectorization if the loop contains unsupported reductions.</span></CodeLine>
<Link id="l03769" /><CodeLine lineNumber="3769"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a07515d0542b797be2d1c87d4359ff8f6">canVectorizeReductions</a>(MaxScalableVF)) &#123;</span></CodeLine>
<Link id="l03770" /><CodeLine lineNumber="3770"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</span></CodeLine>
<Link id="l03771" /><CodeLine lineNumber="3771"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Scalable vectorization not supported for the reduction &quot;</span></CodeLine>
<Link id="l03772" /><CodeLine lineNumber="3772"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;operations found in this loop.&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03773" /><CodeLine lineNumber="3773"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;ScalableVFUnfeasible&quot;</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l03774" /><CodeLine lineNumber="3774"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03775" /><CodeLine lineNumber="3775"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03776" /><CodeLine lineNumber="3776"></CodeLine>
<Link id="l03777" /><CodeLine lineNumber="3777"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Disable scalable vectorization if the loop contains any instructions</span></CodeLine>
<Link id="l03778" /><CodeLine lineNumber="3778"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with element types not supported for scalable vectors.</span></CodeLine>
<Link id="l03779" /><CodeLine lineNumber="3779"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a00a28a503636abdbedf080f3896b937c">ElementTypesInLoop</a>, &#91;&amp;&#93;(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Ty) &#123;</span></CodeLine>
<Link id="l03780" /><CodeLine lineNumber="3780"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Ty-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l03781" /><CodeLine lineNumber="3781"><span class="doxyHighlight">               !this-&gt;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isElementTypeLegalForScalableVector(Ty);</span></CodeLine>
<Link id="l03782" /><CodeLine lineNumber="3782"><span class="doxyHighlight">      &#125;)) &#123;</span></CodeLine>
<Link id="l03783" /><CodeLine lineNumber="3783"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</span><span class="doxyHighlightStringLiteral">&quot;Scalable vectorization is not supported &quot;</span></CodeLine>
<Link id="l03784" /><CodeLine lineNumber="3784"><span class="doxyHighlight">                            </span><span class="doxyHighlightStringLiteral">&quot;for all element types found in this loop.&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03785" /><CodeLine lineNumber="3785"><span class="doxyHighlight">                            </span><span class="doxyHighlightStringLiteral">&quot;ScalableVFUnfeasible&quot;</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l03786" /><CodeLine lineNumber="3786"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03787" /><CodeLine lineNumber="3787"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03788" /><CodeLine lineNumber="3788"></CodeLine>
<Link id="l03789" /><CodeLine lineNumber="3789"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isSafeForAnyVectorWidth() &amp;&amp; !<a href="#a604c96744d2e46447f11e2d3aab9a9b2">getMaxVScale</a>(&#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>)) &#123;</span></CodeLine>
<Link id="l03790" /><CodeLine lineNumber="3790"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</span><span class="doxyHighlightStringLiteral">&quot;The target does not provide maximum vscale value &quot;</span></CodeLine>
<Link id="l03791" /><CodeLine lineNumber="3791"><span class="doxyHighlight">                            </span><span class="doxyHighlightStringLiteral">&quot;for safe distance analysis.&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03792" /><CodeLine lineNumber="3792"><span class="doxyHighlight">                            </span><span class="doxyHighlightStringLiteral">&quot;ScalableVFUnfeasible&quot;</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l03793" /><CodeLine lineNumber="3793"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03794" /><CodeLine lineNumber="3794"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03795" /><CodeLine lineNumber="3795"></CodeLine>
<Link id="l03796" /><CodeLine lineNumber="3796"><span class="doxyHighlight">  IsScalableVectorizationAllowed = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03797" /><CodeLine lineNumber="3797"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03798" /><CodeLine lineNumber="3798"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03799" /><CodeLine lineNumber="3799"></CodeLine>
<Link id="l03800" /><CodeLine lineNumber="3800"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/elementcount">ElementCount</a></span></CodeLine>
<Link id="l03801" /><CodeLine lineNumber="3801"><span class="doxyHighlight">LoopVectorizationCostModel::getMaxLegalScalableVF(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxSafeElements) &#123;</span></CodeLine>
<Link id="l03802" /><CodeLine lineNumber="3802"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!isScalableVectorizationAllowed())</span></CodeLine>
<Link id="l03803" /><CodeLine lineNumber="3803"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/elementcount/#a1bddc4949ab247dd1474f79b9bc6e34e">ElementCount::getScalable</a>(0);</span></CodeLine>
<Link id="l03804" /><CodeLine lineNumber="3804"></CodeLine>
<Link id="l03805" /><CodeLine lineNumber="3805"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MaxScalableVF = <a href="/docs/api/classes/llvm/elementcount/#a1bddc4949ab247dd1474f79b9bc6e34e">ElementCount::getScalable</a>(</span></CodeLine>
<Link id="l03806" /><CodeLine lineNumber="3806"><span class="doxyHighlight">      std::numeric&#95;limits&lt;ElementCount::ScalarTy&gt;::max());</span></CodeLine>
<Link id="l03807" /><CodeLine lineNumber="3807"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isSafeForAnyVectorWidth())</span></CodeLine>
<Link id="l03808" /><CodeLine lineNumber="3808"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MaxScalableVF;</span></CodeLine>
<Link id="l03809" /><CodeLine lineNumber="3809"></CodeLine>
<Link id="l03810" /><CodeLine lineNumber="3810"><span class="doxyHighlight">  std::optional&lt;unsigned&gt; MaxVScale = <a href="#a604c96744d2e46447f11e2d3aab9a9b2">getMaxVScale</a>(&#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>);</span></CodeLine>
<Link id="l03811" /><CodeLine lineNumber="3811"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Limit MaxScalableVF by the maximum safe dependence distance.</span></CodeLine>
<Link id="l03812" /><CodeLine lineNumber="3812"><span class="doxyHighlight">  MaxScalableVF = <a href="/docs/api/classes/llvm/elementcount/#a1bddc4949ab247dd1474f79b9bc6e34e">ElementCount::getScalable</a>(MaxSafeElements / &#42;MaxVScale);</span></CodeLine>
<Link id="l03813" /><CodeLine lineNumber="3813"></CodeLine>
<Link id="l03814" /><CodeLine lineNumber="3814"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MaxScalableVF)</span></CodeLine>
<Link id="l03815" /><CodeLine lineNumber="3815"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</span></CodeLine>
<Link id="l03816" /><CodeLine lineNumber="3816"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Max legal vector width too small, scalable vectorization &quot;</span></CodeLine>
<Link id="l03817" /><CodeLine lineNumber="3817"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;unfeasible.&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03818" /><CodeLine lineNumber="3818"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;ScalableVFUnfeasible&quot;</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l03819" /><CodeLine lineNumber="3819"></CodeLine>
<Link id="l03820" /><CodeLine lineNumber="3820"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MaxScalableVF;</span></CodeLine>
<Link id="l03821" /><CodeLine lineNumber="3821"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03822" /><CodeLine lineNumber="3822"></CodeLine>
<Link id="l03823" /><CodeLine lineNumber="3823"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/fixedscalablevfpair">FixedScalableVFPair</a> LoopVectorizationCostModel::computeFeasibleMaxVF(</span></CodeLine>
<Link id="l03824" /><CodeLine lineNumber="3824"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxTripCount, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FoldTailByMasking) &#123;</span></CodeLine>
<Link id="l03825" /><CodeLine lineNumber="3825"><span class="doxyHighlight">  MinBWs = <a href="/docs/api/namespaces/llvm/#af7b6ae12af3578f7a20ccc11a4458f9f">computeMinimumValueSizes</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getBlocks(), &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a58fd764accfd06df487cc6ec43d4f5fc">DB</a>, &amp;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>);</span></CodeLine>
<Link id="l03826" /><CodeLine lineNumber="3826"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SmallestType, WidestType;</span></CodeLine>
<Link id="l03827" /><CodeLine lineNumber="3827"><span class="doxyHighlight">  std::tie(SmallestType, WidestType) = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a1fa63b37ad2ac06f289e9962a3703e9e">getSmallestAndWidestTypes</a>();</span></CodeLine>
<Link id="l03828" /><CodeLine lineNumber="3828"></CodeLine>
<Link id="l03829" /><CodeLine lineNumber="3829"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the maximum safe dependence distance in bits computed by LAA.</span></CodeLine>
<Link id="l03830" /><CodeLine lineNumber="3830"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// It is computed by MaxVF &#42; sizeOf(type) &#42; 8, where type is taken from</span></CodeLine>
<Link id="l03831" /><CodeLine lineNumber="3831"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the memory accesses that is most restrictive (involved in the smallest</span></CodeLine>
<Link id="l03832" /><CodeLine lineNumber="3832"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// dependence distance).</span></CodeLine>
<Link id="l03833" /><CodeLine lineNumber="3833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxSafeElements =</span></CodeLine>
<Link id="l03834" /><CodeLine lineNumber="3834"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">llvm::bit&#95;floor</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getMaxSafeVectorWidthInBits() / WidestType);</span></CodeLine>
<Link id="l03835" /><CodeLine lineNumber="3835"></CodeLine>
<Link id="l03836" /><CodeLine lineNumber="3836"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MaxSafeFixedVF = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(MaxSafeElements);</span></CodeLine>
<Link id="l03837" /><CodeLine lineNumber="3837"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MaxSafeScalableVF = getMaxLegalScalableVF(MaxSafeElements);</span></CodeLine>
<Link id="l03838" /><CodeLine lineNumber="3838"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isSafeForAnyVectorWidth())</span></CodeLine>
<Link id="l03839" /><CodeLine lineNumber="3839"><span class="doxyHighlight">    this-&gt;MaxSafeElements = MaxSafeElements;</span></CodeLine>
<Link id="l03840" /><CodeLine lineNumber="3840"></CodeLine>
<Link id="l03841" /><CodeLine lineNumber="3841"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: The max safe fixed VF is: &quot;</span><span class="doxyHighlight"> &lt;&lt; MaxSafeFixedVF</span></CodeLine>
<Link id="l03842" /><CodeLine lineNumber="3842"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03843" /><CodeLine lineNumber="3843"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: The max safe scalable VF is: &quot;</span><span class="doxyHighlight"> &lt;&lt; MaxSafeScalableVF</span></CodeLine>
<Link id="l03844" /><CodeLine lineNumber="3844"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03845" /><CodeLine lineNumber="3845"></CodeLine>
<Link id="l03846" /><CodeLine lineNumber="3846"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First analyze the UserVF, fall back if the UserVF should be ignored.</span></CodeLine>
<Link id="l03847" /><CodeLine lineNumber="3847"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserVF) &#123;</span></CodeLine>
<Link id="l03848" /><CodeLine lineNumber="3848"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MaxSafeUserVF =</span></CodeLine>
<Link id="l03849" /><CodeLine lineNumber="3849"><span class="doxyHighlight">        UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() ? MaxSafeScalableVF : MaxSafeFixedVF;</span></CodeLine>
<Link id="l03850" /><CodeLine lineNumber="3850"></CodeLine>
<Link id="l03851" /><CodeLine lineNumber="3851"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a338ba7ca7a526243ab1853d07d90fe38">ElementCount::isKnownLE</a>(UserVF, MaxSafeUserVF)) &#123;</span></CodeLine>
<Link id="l03852" /><CodeLine lineNumber="3852"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If &#96;VF=vscale x N&#96; is safe, then so is &#96;VF=N&#96;</span></CodeLine>
<Link id="l03853" /><CodeLine lineNumber="3853"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</span></CodeLine>
<Link id="l03854" /><CodeLine lineNumber="3854"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> FixedScalableVFPair(</span></CodeLine>
<Link id="l03855" /><CodeLine lineNumber="3855"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>()), UserVF);</span></CodeLine>
<Link id="l03856" /><CodeLine lineNumber="3856"></CodeLine>
<Link id="l03857" /><CodeLine lineNumber="3857"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> UserVF;</span></CodeLine>
<Link id="l03858" /><CodeLine lineNumber="3858"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03859" /><CodeLine lineNumber="3859"></CodeLine>
<Link id="l03860" /><CodeLine lineNumber="3860"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#addaa86bfa4ca26b7f366cbdd868f99bf">ElementCount::isKnownGT</a>(UserVF, MaxSafeUserVF));</span></CodeLine>
<Link id="l03861" /><CodeLine lineNumber="3861"></CodeLine>
<Link id="l03862" /><CodeLine lineNumber="3862"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Only clamp if the UserVF is not scalable. If the UserVF is scalable, it</span></CodeLine>
<Link id="l03863" /><CodeLine lineNumber="3863"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is better to ignore the hint and let the compiler choose a suitable VF.</span></CodeLine>
<Link id="l03864" /><CodeLine lineNumber="3864"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>()) &#123;</span></CodeLine>
<Link id="l03865" /><CodeLine lineNumber="3865"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: User VF=&quot;</span><span class="doxyHighlight"> &lt;&lt; UserVF</span></CodeLine>
<Link id="l03866" /><CodeLine lineNumber="3866"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; is unsafe, clamping to max safe VF=&quot;</span></CodeLine>
<Link id="l03867" /><CodeLine lineNumber="3867"><span class="doxyHighlight">                        &lt;&lt; MaxSafeFixedVF &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03868" /><CodeLine lineNumber="3868"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l03869" /><CodeLine lineNumber="3869"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OptimizationRemarkAnalysis(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;VectorizationFactor&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03870" /><CodeLine lineNumber="3870"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getStartLoc(),</span></CodeLine>
<Link id="l03871" /><CodeLine lineNumber="3871"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getHeader())</span></CodeLine>
<Link id="l03872" /><CodeLine lineNumber="3872"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;User-specified vectorization factor &quot;</span></CodeLine>
<Link id="l03873" /><CodeLine lineNumber="3873"><span class="doxyHighlight">               &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;UserVectorizationFactor&quot;</span><span class="doxyHighlight">, UserVF)</span></CodeLine>
<Link id="l03874" /><CodeLine lineNumber="3874"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; is unsafe, clamping to maximum safe vectorization factor &quot;</span></CodeLine>
<Link id="l03875" /><CodeLine lineNumber="3875"><span class="doxyHighlight">               &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;VectorizationFactor&quot;</span><span class="doxyHighlight">, MaxSafeFixedVF);</span></CodeLine>
<Link id="l03876" /><CodeLine lineNumber="3876"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l03877" /><CodeLine lineNumber="3877"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MaxSafeFixedVF;</span></CodeLine>
<Link id="l03878" /><CodeLine lineNumber="3878"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03879" /><CodeLine lineNumber="3879"></CodeLine>
<Link id="l03880" /><CodeLine lineNumber="3880"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.supportsScalableVectors() &amp;&amp; !<a href="#a48035e22b43c905a2961c90e5470b2f0">ForceTargetSupportsScalableVectors</a>) &#123;</span></CodeLine>
<Link id="l03881" /><CodeLine lineNumber="3881"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: User VF=&quot;</span><span class="doxyHighlight"> &lt;&lt; UserVF</span></CodeLine>
<Link id="l03882" /><CodeLine lineNumber="3882"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; is ignored because scalable vectors are not &quot;</span></CodeLine>
<Link id="l03883" /><CodeLine lineNumber="3883"><span class="doxyHighlight">                           </span><span class="doxyHighlightStringLiteral">&quot;available.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03884" /><CodeLine lineNumber="3884"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l03885" /><CodeLine lineNumber="3885"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OptimizationRemarkAnalysis(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;VectorizationFactor&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03886" /><CodeLine lineNumber="3886"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getStartLoc(),</span></CodeLine>
<Link id="l03887" /><CodeLine lineNumber="3887"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getHeader())</span></CodeLine>
<Link id="l03888" /><CodeLine lineNumber="3888"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;User-specified vectorization factor &quot;</span></CodeLine>
<Link id="l03889" /><CodeLine lineNumber="3889"><span class="doxyHighlight">               &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;UserVectorizationFactor&quot;</span><span class="doxyHighlight">, UserVF)</span></CodeLine>
<Link id="l03890" /><CodeLine lineNumber="3890"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; is ignored because the target does not support scalable &quot;</span></CodeLine>
<Link id="l03891" /><CodeLine lineNumber="3891"><span class="doxyHighlight">                  </span><span class="doxyHighlightStringLiteral">&quot;vectors. The compiler will pick a more suitable value.&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03892" /><CodeLine lineNumber="3892"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l03893" /><CodeLine lineNumber="3893"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l03894" /><CodeLine lineNumber="3894"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: User VF=&quot;</span><span class="doxyHighlight"> &lt;&lt; UserVF</span></CodeLine>
<Link id="l03895" /><CodeLine lineNumber="3895"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; is unsafe. Ignoring scalable UserVF.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03896" /><CodeLine lineNumber="3896"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l03897" /><CodeLine lineNumber="3897"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OptimizationRemarkAnalysis(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;VectorizationFactor&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03898" /><CodeLine lineNumber="3898"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getStartLoc(),</span></CodeLine>
<Link id="l03899" /><CodeLine lineNumber="3899"><span class="doxyHighlight">                                          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getHeader())</span></CodeLine>
<Link id="l03900" /><CodeLine lineNumber="3900"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;User-specified vectorization factor &quot;</span></CodeLine>
<Link id="l03901" /><CodeLine lineNumber="3901"><span class="doxyHighlight">               &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</span><span class="doxyHighlightStringLiteral">&quot;UserVectorizationFactor&quot;</span><span class="doxyHighlight">, UserVF)</span></CodeLine>
<Link id="l03902" /><CodeLine lineNumber="3902"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; is unsafe. Ignoring the hint to let the compiler pick a &quot;</span></CodeLine>
<Link id="l03903" /><CodeLine lineNumber="3903"><span class="doxyHighlight">                  </span><span class="doxyHighlightStringLiteral">&quot;more suitable value.&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03904" /><CodeLine lineNumber="3904"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l03905" /><CodeLine lineNumber="3905"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03906" /><CodeLine lineNumber="3906"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03907" /><CodeLine lineNumber="3907"></CodeLine>
<Link id="l03908" /><CodeLine lineNumber="3908"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: The Smallest and Widest types: &quot;</span><span class="doxyHighlight"> &lt;&lt; SmallestType</span></CodeLine>
<Link id="l03909" /><CodeLine lineNumber="3909"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; / &quot;</span><span class="doxyHighlight"> &lt;&lt; WidestType &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; bits.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03910" /><CodeLine lineNumber="3910"></CodeLine>
<Link id="l03911" /><CodeLine lineNumber="3911"><span class="doxyHighlight">  FixedScalableVFPair <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1),</span></CodeLine>
<Link id="l03912" /><CodeLine lineNumber="3912"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/elementcount/#a1bddc4949ab247dd1474f79b9bc6e34e">ElementCount::getScalable</a>(0));</span></CodeLine>
<Link id="l03913" /><CodeLine lineNumber="3913"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MaxVF =</span></CodeLine>
<Link id="l03914" /><CodeLine lineNumber="3914"><span class="doxyHighlight">          getMaximizedVFForTarget(MaxTripCount, SmallestType, WidestType,</span></CodeLine>
<Link id="l03915" /><CodeLine lineNumber="3915"><span class="doxyHighlight">                                  MaxSafeFixedVF, FoldTailByMasking))</span></CodeLine>
<Link id="l03916" /><CodeLine lineNumber="3916"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.FixedVF = MaxVF;</span></CodeLine>
<Link id="l03917" /><CodeLine lineNumber="3917"></CodeLine>
<Link id="l03918" /><CodeLine lineNumber="3918"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MaxVF =</span></CodeLine>
<Link id="l03919" /><CodeLine lineNumber="3919"><span class="doxyHighlight">          getMaximizedVFForTarget(MaxTripCount, SmallestType, WidestType,</span></CodeLine>
<Link id="l03920" /><CodeLine lineNumber="3920"><span class="doxyHighlight">                                  MaxSafeScalableVF, FoldTailByMasking))</span></CodeLine>
<Link id="l03921" /><CodeLine lineNumber="3921"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaxVF.isScalable()) &#123;</span></CodeLine>
<Link id="l03922" /><CodeLine lineNumber="3922"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.ScalableVF = MaxVF;</span></CodeLine>
<Link id="l03923" /><CodeLine lineNumber="3923"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found feasible scalable VF = &quot;</span><span class="doxyHighlight"> &lt;&lt; MaxVF</span></CodeLine>
<Link id="l03924" /><CodeLine lineNumber="3924"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03925" /><CodeLine lineNumber="3925"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l03926" /><CodeLine lineNumber="3926"></CodeLine>
<Link id="l03927" /><CodeLine lineNumber="3927"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</span></CodeLine>
<Link id="l03928" /><CodeLine lineNumber="3928"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l03929" /><CodeLine lineNumber="3929"></CodeLine>
<Link id="l03930" /><CodeLine lineNumber="3930"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/fixedscalablevfpair">FixedScalableVFPair</a></span></CodeLine>
<Link id="l03931" /><CodeLine lineNumber="3931" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a65ab4267c6c132d06451b5d97bc9ee83"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a65ab4267c6c132d06451b5d97bc9ee83">LoopVectorizationCostModel::computeMaxVF</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> UserIC) &#123;</span></CodeLine>
<Link id="l03932" /><CodeLine lineNumber="3932"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getRuntimePointerChecking()-&gt;Need &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.hasBranchDivergence()) &#123;</span></CodeLine>
<Link id="l03933" /><CodeLine lineNumber="3933"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: It may be useful to do since it&#39;s still likely to be dynamically</span></CodeLine>
<Link id="l03934" /><CodeLine lineNumber="3934"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// uniform if the target can skip.</span></CodeLine>
<Link id="l03935" /><CodeLine lineNumber="3935"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span></CodeLine>
<Link id="l03936" /><CodeLine lineNumber="3936"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Not inserting runtime ptr check for divergent target&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03937" /><CodeLine lineNumber="3937"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;runtime pointer checks needed. Not enabled for divergent target&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03938" /><CodeLine lineNumber="3938"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;CantVersionLoopWithDivergentTarget&quot;</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l03939" /><CodeLine lineNumber="3939"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</span></CodeLine>
<Link id="l03940" /><CodeLine lineNumber="3940"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03941" /><CodeLine lineNumber="3941"></CodeLine>
<Link id="l03942" /><CodeLine lineNumber="3942"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE();</span></CodeLine>
<Link id="l03943" /><CodeLine lineNumber="3943"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TC = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#abec0c616087c002528fcf80c6583eadd">getSmallConstantTripCount</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l03944" /><CodeLine lineNumber="3944"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxTC = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSmallConstantMaxTripCount();</span></CodeLine>
<Link id="l03945" /><CodeLine lineNumber="3945"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found trip count: &quot;</span><span class="doxyHighlight"> &lt;&lt; TC &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03946" /><CodeLine lineNumber="3946"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TC != MaxTC)</span></CodeLine>
<Link id="l03947" /><CodeLine lineNumber="3947"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found maximum trip count: &quot;</span><span class="doxyHighlight"> &lt;&lt; MaxTC &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03948" /><CodeLine lineNumber="3948"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TC == 1) &#123;</span></CodeLine>
<Link id="l03949" /><CodeLine lineNumber="3949"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span><span class="doxyHighlightStringLiteral">&quot;Single iteration (non) loop&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03950" /><CodeLine lineNumber="3950"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;loop trip count is one, irrelevant for vectorization&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03951" /><CodeLine lineNumber="3951"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;SingleIterationLoop&quot;</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l03952" /><CodeLine lineNumber="3952"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</span></CodeLine>
<Link id="l03953" /><CodeLine lineNumber="3953"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03954" /><CodeLine lineNumber="3954"></CodeLine>
<Link id="l03955" /><CodeLine lineNumber="3955"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If BTC matches the widest induction type and is -1 then the trip count</span></CodeLine>
<Link id="l03956" /><CodeLine lineNumber="3956"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// computation will wrap to 0 and the vector trip count will be 0 Do not try</span></CodeLine>
<Link id="l03957" /><CodeLine lineNumber="3957"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// to vectorize.</span></CodeLine>
<Link id="l03958" /><CodeLine lineNumber="3958"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BTC = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a22d9bcbd44563106d7217f3bd9a4039e">getBackedgeTakenCount</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l03959" /><CodeLine lineNumber="3959"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(BTC) &amp;&amp;</span></CodeLine>
<Link id="l03960" /><CodeLine lineNumber="3960"><span class="doxyHighlight">      BTC-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &gt;=</span></CodeLine>
<Link id="l03961" /><CodeLine lineNumber="3961"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getWidestInductionType()-&gt;getScalarSizeInBits() &amp;&amp;</span></CodeLine>
<Link id="l03962" /><CodeLine lineNumber="3962"><span class="doxyHighlight">      SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#af74112dae88db73eb5484821b6f0fccd">isKnownPredicate</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP&#95;EQ</a>, BTC,</span></CodeLine>
<Link id="l03963" /><CodeLine lineNumber="3963"><span class="doxyHighlight">                           SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a8d5202095ab1b8b726dd1e9db728b997">getMinusOne</a>(BTC-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()))) &#123;</span></CodeLine>
<Link id="l03964" /><CodeLine lineNumber="3964"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span></CodeLine>
<Link id="l03965" /><CodeLine lineNumber="3965"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Trip count computation wrapped&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03966" /><CodeLine lineNumber="3966"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;backedge-taken count is -1, loop trip count wrapped to 0&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l03967" /><CodeLine lineNumber="3967"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;TripCountWrapped&quot;</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l03968" /><CodeLine lineNumber="3968"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</span></CodeLine>
<Link id="l03969" /><CodeLine lineNumber="3969"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03970" /><CodeLine lineNumber="3970"></CodeLine>
<Link id="l03971" /><CodeLine lineNumber="3971"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (ScalarEpilogueStatus) &#123;</span></CodeLine>
<Link id="l03972" /><CodeLine lineNumber="3972"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>:</span></CodeLine>
<Link id="l03973" /><CodeLine lineNumber="3973"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> computeFeasibleMaxVF(MaxTC, UserVF, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03974" /><CodeLine lineNumber="3974"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9dab8edd8f39c728bd8b0045b64768ef206">CM&#95;ScalarEpilogueNotAllowedUsePredicate</a>:</span></CodeLine>
<Link id="l03975" /><CodeLine lineNumber="3975"><span class="doxyHighlight">    &#91;&#91;fallthrough&#93;&#93;;</span></CodeLine>
<Link id="l03976" /><CodeLine lineNumber="3976"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>:</span></CodeLine>
<Link id="l03977" /><CodeLine lineNumber="3977"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l03978" /><CodeLine lineNumber="3978"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: vector predicate hint/switch found.\\n&quot;</span></CodeLine>
<Link id="l03979" /><CodeLine lineNumber="3979"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Not allowing scalar epilogue, creating predicated &quot;</span></CodeLine>
<Link id="l03980" /><CodeLine lineNumber="3980"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;vector loop.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03981" /><CodeLine lineNumber="3981"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03982" /><CodeLine lineNumber="3982"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da0a5c3a3ea2de39aa77f3e6da8de4d5bd">CM&#95;ScalarEpilogueNotAllowedLowTripLoop</a>:</span></CodeLine>
<Link id="l03983" /><CodeLine lineNumber="3983"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// fallthrough as a special case of OptForSize</span></CodeLine>
<Link id="l03984" /><CodeLine lineNumber="3984"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da4f61afe29426363c5cf62d4ee93199b7">CM&#95;ScalarEpilogueNotAllowedOptSize</a>:</span></CodeLine>
<Link id="l03985" /><CodeLine lineNumber="3985"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ScalarEpilogueStatus == <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da4f61afe29426363c5cf62d4ee93199b7">CM&#95;ScalarEpilogueNotAllowedOptSize</a>)</span></CodeLine>
<Link id="l03986" /><CodeLine lineNumber="3986"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l03987" /><CodeLine lineNumber="3987"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Not allowing scalar epilogue due to -Os/-Oz.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03988" /><CodeLine lineNumber="3988"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l03989" /><CodeLine lineNumber="3989"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Not allowing scalar epilogue due to low trip &quot;</span></CodeLine>
<Link id="l03990" /><CodeLine lineNumber="3990"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;count.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l03991" /><CodeLine lineNumber="3991"></CodeLine>
<Link id="l03992" /><CodeLine lineNumber="3992"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Bail if runtime checks are required, which are not good when optimising</span></CodeLine>
<Link id="l03993" /><CodeLine lineNumber="3993"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for size.</span></CodeLine>
<Link id="l03994" /><CodeLine lineNumber="3994"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aad6239ca8b51657f5ebdbd6e51e6ea90">runtimeChecksRequired</a>())</span></CodeLine>
<Link id="l03995" /><CodeLine lineNumber="3995"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</span></CodeLine>
<Link id="l03996" /><CodeLine lineNumber="3996"></CodeLine>
<Link id="l03997" /><CodeLine lineNumber="3997"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l03998" /><CodeLine lineNumber="3998"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l03999" /><CodeLine lineNumber="3999"></CodeLine>
<Link id="l04000" /><CodeLine lineNumber="4000"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The only loops we can vectorize without a scalar epilogue, are loops with</span></CodeLine>
<Link id="l04001" /><CodeLine lineNumber="4001"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a bottom-test and a single exiting block. We&#39;d have to handle the fact</span></CodeLine>
<Link id="l04002" /><CodeLine lineNumber="4002"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that not every instruction executes on the last iteration.  This will</span></CodeLine>
<Link id="l04003" /><CodeLine lineNumber="4003"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// require a lane mask which varies through the vector loop body.  (TODO)</span></CodeLine>
<Link id="l04004" /><CodeLine lineNumber="4004"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getExitingBlock() != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getLoopLatch()) &#123;</span></CodeLine>
<Link id="l04005" /><CodeLine lineNumber="4005"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there was a tail-folding hint/switch, but we can&#39;t fold the tail by</span></CodeLine>
<Link id="l04006" /><CodeLine lineNumber="4006"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// masking, fallback to a vectorization with a scalar epilogue.</span></CodeLine>
<Link id="l04007" /><CodeLine lineNumber="4007"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ScalarEpilogueStatus == <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>) &#123;</span></CodeLine>
<Link id="l04008" /><CodeLine lineNumber="4008"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Cannot fold tail by masking: vectorize with a &quot;</span></CodeLine>
<Link id="l04009" /><CodeLine lineNumber="4009"><span class="doxyHighlight">                           </span><span class="doxyHighlightStringLiteral">&quot;scalar epilogue instead.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04010" /><CodeLine lineNumber="4010"><span class="doxyHighlight">      ScalarEpilogueStatus = <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>;</span></CodeLine>
<Link id="l04011" /><CodeLine lineNumber="4011"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> computeFeasibleMaxVF(MaxTC, UserVF, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04012" /><CodeLine lineNumber="4012"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04013" /><CodeLine lineNumber="4013"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</span></CodeLine>
<Link id="l04014" /><CodeLine lineNumber="4014"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04015" /><CodeLine lineNumber="4015"></CodeLine>
<Link id="l04016" /><CodeLine lineNumber="4016"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now try the tail folding</span></CodeLine>
<Link id="l04017" /><CodeLine lineNumber="4017"></CodeLine>
<Link id="l04018" /><CodeLine lineNumber="4018"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Invalidate interleave groups that require an epilogue if we can&#39;t mask</span></CodeLine>
<Link id="l04019" /><CodeLine lineNumber="4019"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the interleave-group.</span></CodeLine>
<Link id="l04020" /><CodeLine lineNumber="4020"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#adf8d8fb6f39b9c0cf21d55b7229d35e2">useMaskedInterleavedAccesses</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>)) &#123;</span></CodeLine>
<Link id="l04021" /><CodeLine lineNumber="4021"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(WideningDecisions.empty() &amp;&amp; Uniforms.empty() &amp;&amp; Scalars.empty() &amp;&amp;</span></CodeLine>
<Link id="l04022" /><CodeLine lineNumber="4022"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;No decisions should have been taken at this point&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04023" /><CodeLine lineNumber="4023"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note: There is no need to invalidate any cost modeling decisions here, as</span></CodeLine>
<Link id="l04024" /><CodeLine lineNumber="4024"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// none were taken so far.</span></CodeLine>
<Link id="l04025" /><CodeLine lineNumber="4025"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7a98f0c17229446d76997f158d896aad">InterleaveInfo</a>.invalidateGroupsRequiringScalarEpilogue();</span></CodeLine>
<Link id="l04026" /><CodeLine lineNumber="4026"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04027" /><CodeLine lineNumber="4027"></CodeLine>
<Link id="l04028" /><CodeLine lineNumber="4028"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/fixedscalablevfpair">FixedScalableVFPair</a> MaxFactors = computeFeasibleMaxVF(MaxTC, UserVF, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04029" /><CodeLine lineNumber="4029"></CodeLine>
<Link id="l04030" /><CodeLine lineNumber="4030"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Avoid tail folding if the trip count is known to be a multiple of any VF</span></CodeLine>
<Link id="l04031" /><CodeLine lineNumber="4031"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we choose.</span></CodeLine>
<Link id="l04032" /><CodeLine lineNumber="4032"><span class="doxyHighlight">  std::optional&lt;unsigned&gt; MaxPowerOf2RuntimeVF =</span></CodeLine>
<Link id="l04033" /><CodeLine lineNumber="4033"><span class="doxyHighlight">      MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25a62c28e80eac3b4cc08470ae0770bd">FixedVF</a>.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>();</span></CodeLine>
<Link id="l04034" /><CodeLine lineNumber="4034"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25f82f8ef3355c335a7ddae4ad0b6965">ScalableVF</a>) &#123;</span></CodeLine>
<Link id="l04035" /><CodeLine lineNumber="4035"><span class="doxyHighlight">    std::optional&lt;unsigned&gt; MaxVScale = <a href="#a604c96744d2e46447f11e2d3aab9a9b2">getMaxVScale</a>(&#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>);</span></CodeLine>
<Link id="l04036" /><CodeLine lineNumber="4036"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaxVScale &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isVScaleKnownToBeAPowerOfTwo()) &#123;</span></CodeLine>
<Link id="l04037" /><CodeLine lineNumber="4037"><span class="doxyHighlight">      MaxPowerOf2RuntimeVF = std::max&lt;unsigned&gt;(</span></CodeLine>
<Link id="l04038" /><CodeLine lineNumber="4038"><span class="doxyHighlight">          &#42;MaxPowerOf2RuntimeVF,</span></CodeLine>
<Link id="l04039" /><CodeLine lineNumber="4039"><span class="doxyHighlight">          &#42;MaxVScale &#42; MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25f82f8ef3355c335a7ddae4ad0b6965">ScalableVF</a>.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>());</span></CodeLine>
<Link id="l04040" /><CodeLine lineNumber="4040"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l04041" /><CodeLine lineNumber="4041"><span class="doxyHighlight">      MaxPowerOf2RuntimeVF = std::nullopt; </span><span class="doxyHighlightComment">// Stick with tail-folding for now.</span></CodeLine>
<Link id="l04042" /><CodeLine lineNumber="4042"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04043" /><CodeLine lineNumber="4043"></CodeLine>
<Link id="l04044" /><CodeLine lineNumber="4044"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaxPowerOf2RuntimeVF &amp;&amp; &#42;MaxPowerOf2RuntimeVF &gt; 0) &#123;</span></CodeLine>
<Link id="l04045" /><CodeLine lineNumber="4045"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a5cafb166cf7c4937f5647a084c4eaee2">isNonZero</a>() || <a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(&#42;MaxPowerOf2RuntimeVF)) &amp;&amp;</span></CodeLine>
<Link id="l04046" /><CodeLine lineNumber="4046"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;MaxFixedVF must be a power of 2&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04047" /><CodeLine lineNumber="4047"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxVFtimesIC =</span></CodeLine>
<Link id="l04048" /><CodeLine lineNumber="4048"><span class="doxyHighlight">        UserIC ? &#42;MaxPowerOf2RuntimeVF &#42; UserIC : &#42;MaxPowerOf2RuntimeVF;</span></CodeLine>
<Link id="l04049" /><CodeLine lineNumber="4049"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE();</span></CodeLine>
<Link id="l04050" /><CodeLine lineNumber="4050"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Currently only loops with countable exits are vectorized, but calling</span></CodeLine>
<Link id="l04051" /><CodeLine lineNumber="4051"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// getSymbolicMaxBackedgeTakenCount allows enablement work for loops with</span></CodeLine>
<Link id="l04052" /><CodeLine lineNumber="4052"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// uncountable exits whilst also ensuring the symbolic maximum and known</span></CodeLine>
<Link id="l04053" /><CodeLine lineNumber="4053"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// back-edge taken count remain identical for loops with countable exits.</span></CodeLine>
<Link id="l04054" /><CodeLine lineNumber="4054"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BackedgeTakenCount = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSymbolicMaxBackedgeTakenCount();</span></CodeLine>
<Link id="l04055" /><CodeLine lineNumber="4055"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BackedgeTakenCount == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getBackedgeTakenCount() &amp;&amp;</span></CodeLine>
<Link id="l04056" /><CodeLine lineNumber="4056"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Invalid loop count&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04057" /><CodeLine lineNumber="4057"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;ExitCount = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#aef6d2bea715d1793e956f41ddeea2320">getAddExpr</a>(</span></CodeLine>
<Link id="l04058" /><CodeLine lineNumber="4058"><span class="doxyHighlight">        BackedgeTakenCount, SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a3fbe8f529d36d76730550905d730a2a7">getOne</a>(BackedgeTakenCount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()));</span></CodeLine>
<Link id="l04059" /><CodeLine lineNumber="4059"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;Rem = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a13b9eb961d35ad9ecb3b633f5703253a">getURemExpr</a>(</span></CodeLine>
<Link id="l04060" /><CodeLine lineNumber="4060"><span class="doxyHighlight">        SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#ad146072469181af4ccb7ef03c28999ba">applyLoopGuards</a>(ExitCount, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>),</span></CodeLine>
<Link id="l04061" /><CodeLine lineNumber="4061"><span class="doxyHighlight">        SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(BackedgeTakenCount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>(), MaxVFtimesIC));</span></CodeLine>
<Link id="l04062" /><CodeLine lineNumber="4062"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Rem-&gt;<a href="/docs/api/classes/llvm/scev/#a4541962f9c18aacceb7243520eb15e1f">isZero</a>()) &#123;</span></CodeLine>
<Link id="l04063" /><CodeLine lineNumber="4063"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Accept MaxFixedVF if we do not have a tail.</span></CodeLine>
<Link id="l04064" /><CodeLine lineNumber="4064"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: No tail will remain for any chosen VF.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04065" /><CodeLine lineNumber="4065"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MaxFactors;</span></CodeLine>
<Link id="l04066" /><CodeLine lineNumber="4066"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04067" /><CodeLine lineNumber="4067"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04068" /><CodeLine lineNumber="4068"></CodeLine>
<Link id="l04069" /><CodeLine lineNumber="4069"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we don&#39;t know the precise trip count, or if the trip count that we</span></CodeLine>
<Link id="l04070" /><CodeLine lineNumber="4070"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// found modulo the vectorization factor is not zero, try to fold the tail</span></CodeLine>
<Link id="l04071" /><CodeLine lineNumber="4071"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// by masking.</span></CodeLine>
<Link id="l04072" /><CodeLine lineNumber="4072"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: look for a smaller MaxVF that does divide TC rather than masking.</span></CodeLine>
<Link id="l04073" /><CodeLine lineNumber="4073"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8eb89837d2853e4853ea14379ae3972">setTailFoldingStyles</a>(MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25f82f8ef3355c335a7ddae4ad0b6965">ScalableVF</a>.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>(), UserIC);</span></CodeLine>
<Link id="l04074" /><CodeLine lineNumber="4074"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba">foldTailByMasking</a>()) &#123;</span></CodeLine>
<Link id="l04075" /><CodeLine lineNumber="4075"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a738b994c87e0e816cf5f323e0e2b6c07">getTailFoldingStyle</a>() == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6ae67872a709ea2e3175802518fc4e71">TailFoldingStyle::DataWithEVL</a>) &#123;</span></CodeLine>
<Link id="l04076" /><CodeLine lineNumber="4076"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l04077" /><CodeLine lineNumber="4077"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l04078" /><CodeLine lineNumber="4078"><span class="doxyHighlight">          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: tail is folded with EVL, forcing unroll factor to be 1 Will &quot;</span></CodeLine>
<Link id="l04079" /><CodeLine lineNumber="4079"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;try to generate VP Intrinsics with scalable vector &quot;</span></CodeLine>
<Link id="l04080" /><CodeLine lineNumber="4080"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;factors only.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04081" /><CodeLine lineNumber="4081"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Tail folded loop using VP intrinsics restricts the VF to be scalable</span></CodeLine>
<Link id="l04082" /><CodeLine lineNumber="4082"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// for now.</span></CodeLine>
<Link id="l04083" /><CodeLine lineNumber="4083"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: extend it for fixed vectors, if required.</span></CodeLine>
<Link id="l04084" /><CodeLine lineNumber="4084"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25f82f8ef3355c335a7ddae4ad0b6965">ScalableVF</a>.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp;</span></CodeLine>
<Link id="l04085" /><CodeLine lineNumber="4085"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Expected scalable vector factor.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04086" /><CodeLine lineNumber="4086"></CodeLine>
<Link id="l04087" /><CodeLine lineNumber="4087"><span class="doxyHighlight">      MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25a62c28e80eac3b4cc08470ae0770bd">FixedVF</a> = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1);</span></CodeLine>
<Link id="l04088" /><CodeLine lineNumber="4088"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04089" /><CodeLine lineNumber="4089"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MaxFactors;</span></CodeLine>
<Link id="l04090" /><CodeLine lineNumber="4090"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04091" /><CodeLine lineNumber="4091"></CodeLine>
<Link id="l04092" /><CodeLine lineNumber="4092"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there was a tail-folding hint/switch, but we can&#39;t fold the tail by</span></CodeLine>
<Link id="l04093" /><CodeLine lineNumber="4093"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// masking, fallback to a vectorization with a scalar epilogue.</span></CodeLine>
<Link id="l04094" /><CodeLine lineNumber="4094"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ScalarEpilogueStatus == <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>) &#123;</span></CodeLine>
<Link id="l04095" /><CodeLine lineNumber="4095"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Cannot fold tail by masking: vectorize with a &quot;</span></CodeLine>
<Link id="l04096" /><CodeLine lineNumber="4096"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;scalar epilogue instead.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04097" /><CodeLine lineNumber="4097"><span class="doxyHighlight">    ScalarEpilogueStatus = <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>;</span></CodeLine>
<Link id="l04098" /><CodeLine lineNumber="4098"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MaxFactors;</span></CodeLine>
<Link id="l04099" /><CodeLine lineNumber="4099"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04100" /><CodeLine lineNumber="4100"></CodeLine>
<Link id="l04101" /><CodeLine lineNumber="4101"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ScalarEpilogueStatus == <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9dab8edd8f39c728bd8b0045b64768ef206">CM&#95;ScalarEpilogueNotAllowedUsePredicate</a>) &#123;</span></CodeLine>
<Link id="l04102" /><CodeLine lineNumber="4102"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Can&#39;t fold tail by masking: don&#39;t vectorize\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04103" /><CodeLine lineNumber="4103"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</span></CodeLine>
<Link id="l04104" /><CodeLine lineNumber="4104"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04105" /><CodeLine lineNumber="4105"></CodeLine>
<Link id="l04106" /><CodeLine lineNumber="4106"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TC == 0) &#123;</span></CodeLine>
<Link id="l04107" /><CodeLine lineNumber="4107"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span></CodeLine>
<Link id="l04108" /><CodeLine lineNumber="4108"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;unable to calculate the loop count due to complex control flow&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04109" /><CodeLine lineNumber="4109"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;UnknownLoopCountComplexCFG&quot;</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l04110" /><CodeLine lineNumber="4110"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</span></CodeLine>
<Link id="l04111" /><CodeLine lineNumber="4111"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04112" /><CodeLine lineNumber="4112"></CodeLine>
<Link id="l04113" /><CodeLine lineNumber="4113"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span></CodeLine>
<Link id="l04114" /><CodeLine lineNumber="4114"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;Cannot optimize for size and vectorize at the same time.&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04115" /><CodeLine lineNumber="4115"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;cannot optimize for size and vectorize at the same time. &quot;</span></CodeLine>
<Link id="l04116" /><CodeLine lineNumber="4116"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;Enable vectorization of this loop with &#39;#pragma clang loop &quot;</span></CodeLine>
<Link id="l04117" /><CodeLine lineNumber="4117"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;vectorize(enable)&#39; when compiling with -Os/-Oz&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04118" /><CodeLine lineNumber="4118"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;NoTailLoopWithOptForSize&quot;</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l04119" /><CodeLine lineNumber="4119"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</span></CodeLine>
<Link id="l04120" /><CodeLine lineNumber="4120"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04121" /><CodeLine lineNumber="4121"></CodeLine>
<Link id="l04122" /><CodeLine lineNumber="4122"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/elementcount">ElementCount</a> LoopVectorizationCostModel::getMaximizedVFForTarget(</span></CodeLine>
<Link id="l04123" /><CodeLine lineNumber="4123"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxTripCount, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SmallestType, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> WidestType,</span></CodeLine>
<Link id="l04124" /><CodeLine lineNumber="4124"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MaxSafeVF, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> FoldTailByMasking) &#123;</span></CodeLine>
<Link id="l04125" /><CodeLine lineNumber="4125"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ComputeScalableMaxVF = MaxSafeVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>();</span></CodeLine>
<Link id="l04126" /><CodeLine lineNumber="4126"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/typesize">TypeSize</a> WidestRegister = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getRegisterBitWidth(</span></CodeLine>
<Link id="l04127" /><CodeLine lineNumber="4127"><span class="doxyHighlight">      ComputeScalableMaxVF ? <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166a331413d3887a08546d0973091f6a4993">TargetTransformInfo::RGK&#95;ScalableVector</a></span></CodeLine>
<Link id="l04128" /><CodeLine lineNumber="4128"><span class="doxyHighlight">                           : <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166a183020fbea95c99db23f6d3594f4c4af">TargetTransformInfo::RGK&#95;FixedWidthVector</a>);</span></CodeLine>
<Link id="l04129" /><CodeLine lineNumber="4129"></CodeLine>
<Link id="l04130" /><CodeLine lineNumber="4130"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Convenience function to return the minimum of two ElementCounts.</span></CodeLine>
<Link id="l04131" /><CodeLine lineNumber="4131"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MinVF = &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> &amp;LHS, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> &amp;RHS) &#123;</span></CodeLine>
<Link id="l04132" /><CodeLine lineNumber="4132"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((LHS.isScalable() == RHS.isScalable()) &amp;&amp;</span></CodeLine>
<Link id="l04133" /><CodeLine lineNumber="4133"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Scalable flags must match&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04134" /><CodeLine lineNumber="4134"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a83e6442f8ebefccdb5e089732fe397ac">ElementCount::isKnownLT</a>(LHS, RHS) ? LHS : RHS;</span></CodeLine>
<Link id="l04135" /><CodeLine lineNumber="4135"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l04136" /><CodeLine lineNumber="4136"></CodeLine>
<Link id="l04137" /><CodeLine lineNumber="4137"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ensure MaxVF is a power of 2; the dependence distance bound may not be.</span></CodeLine>
<Link id="l04138" /><CodeLine lineNumber="4138"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that both WidestRegister and WidestType may not be a powers of 2</span></CodeLine>
<Link id="l04139" /><CodeLine lineNumber="4139"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MaxVectorElementCount = <a href="/docs/api/classes/llvm/elementcount/#a79ea372f9aa69492fccfafc0e5a1589c">ElementCount::get</a>(</span></CodeLine>
<Link id="l04140" /><CodeLine lineNumber="4140"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">llvm::bit&#95;floor</a>(WidestRegister.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() / WidestType),</span></CodeLine>
<Link id="l04141" /><CodeLine lineNumber="4141"><span class="doxyHighlight">      ComputeScalableMaxVF);</span></CodeLine>
<Link id="l04142" /><CodeLine lineNumber="4142"><span class="doxyHighlight">  MaxVectorElementCount = MinVF(MaxVectorElementCount, MaxSafeVF);</span></CodeLine>
<Link id="l04143" /><CodeLine lineNumber="4143"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: The Widest register safe to use is: &quot;</span></CodeLine>
<Link id="l04144" /><CodeLine lineNumber="4144"><span class="doxyHighlight">                    &lt;&lt; (MaxVectorElementCount &#42; WidestType) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; bits.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04145" /><CodeLine lineNumber="4145"></CodeLine>
<Link id="l04146" /><CodeLine lineNumber="4146"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MaxVectorElementCount) &#123;</span></CodeLine>
<Link id="l04147" /><CodeLine lineNumber="4147"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: The target has no &quot;</span></CodeLine>
<Link id="l04148" /><CodeLine lineNumber="4148"><span class="doxyHighlight">                      &lt;&lt; (ComputeScalableMaxVF ? </span><span class="doxyHighlightStringLiteral">&quot;scalable&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;fixed&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l04149" /><CodeLine lineNumber="4149"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; vector registers.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04150" /><CodeLine lineNumber="4150"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1);</span></CodeLine>
<Link id="l04151" /><CodeLine lineNumber="4151"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04152" /><CodeLine lineNumber="4152"></CodeLine>
<Link id="l04153" /><CodeLine lineNumber="4153"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> WidestRegisterMinEC = MaxVectorElementCount.getKnownMinValue();</span></CodeLine>
<Link id="l04154" /><CodeLine lineNumber="4154"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaxVectorElementCount.isScalable() &amp;&amp;</span></CodeLine>
<Link id="l04155" /><CodeLine lineNumber="4155"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>-&gt;hasFnAttribute(Attribute::VScaleRange)) &#123;</span></CodeLine>
<Link id="l04156" /><CodeLine lineNumber="4156"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Attr = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>-&gt;getFnAttribute(Attribute::VScaleRange);</span></CodeLine>
<Link id="l04157" /><CodeLine lineNumber="4157"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Min = Attr.getVScaleRangeMin();</span></CodeLine>
<Link id="l04158" /><CodeLine lineNumber="4158"><span class="doxyHighlight">    WidestRegisterMinEC &#42;= Min;</span></CodeLine>
<Link id="l04159" /><CodeLine lineNumber="4159"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04160" /><CodeLine lineNumber="4160"></CodeLine>
<Link id="l04161" /><CodeLine lineNumber="4161"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// When a scalar epilogue is required, at least one iteration of the scalar</span></CodeLine>
<Link id="l04162" /><CodeLine lineNumber="4162"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop has to execute. Adjust MaxTripCount accordingly to avoid picking a</span></CodeLine>
<Link id="l04163" /><CodeLine lineNumber="4163"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// max VF that results in a dead vector loop.</span></CodeLine>
<Link id="l04164" /><CodeLine lineNumber="4164"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaxTripCount &gt; 0 &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a913ab9c8291000dd3a1c3739194b03e4">requiresScalarEpilogue</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l04165" /><CodeLine lineNumber="4165"><span class="doxyHighlight">    MaxTripCount -= 1;</span></CodeLine>
<Link id="l04166" /><CodeLine lineNumber="4166"></CodeLine>
<Link id="l04167" /><CodeLine lineNumber="4167"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaxTripCount &amp;&amp; MaxTripCount &lt;= WidestRegisterMinEC &amp;&amp;</span></CodeLine>
<Link id="l04168" /><CodeLine lineNumber="4168"><span class="doxyHighlight">      (!FoldTailByMasking || <a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(MaxTripCount))) &#123;</span></CodeLine>
<Link id="l04169" /><CodeLine lineNumber="4169"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If upper bound loop trip count (TC) is known at compile time there is no</span></CodeLine>
<Link id="l04170" /><CodeLine lineNumber="4170"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// point in choosing VF greater than TC (as done in the loop below). Select</span></CodeLine>
<Link id="l04171" /><CodeLine lineNumber="4171"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// maximum power of two which doesn&#39;t exceed TC. If MaxVectorElementCount is</span></CodeLine>
<Link id="l04172" /><CodeLine lineNumber="4172"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scalable, we only fall back on a fixed VF when the TC is less than or</span></CodeLine>
<Link id="l04173" /><CodeLine lineNumber="4173"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// equal to the known number of lanes.</span></CodeLine>
<Link id="l04174" /><CodeLine lineNumber="4174"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ClampedUpperTripCount = <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">llvm::bit&#95;floor</a>(MaxTripCount);</span></CodeLine>
<Link id="l04175" /><CodeLine lineNumber="4175"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Clamping the MaxVF to maximum power of two not &quot;</span></CodeLine>
<Link id="l04176" /><CodeLine lineNumber="4176"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;exceeding the constant trip count: &quot;</span></CodeLine>
<Link id="l04177" /><CodeLine lineNumber="4177"><span class="doxyHighlight">                      &lt;&lt; ClampedUpperTripCount &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04178" /><CodeLine lineNumber="4178"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/elementcount/#a79ea372f9aa69492fccfafc0e5a1589c">ElementCount::get</a>(</span></CodeLine>
<Link id="l04179" /><CodeLine lineNumber="4179"><span class="doxyHighlight">        ClampedUpperTripCount,</span></CodeLine>
<Link id="l04180" /><CodeLine lineNumber="4180"><span class="doxyHighlight">        FoldTailByMasking ? MaxVectorElementCount.isScalable() : </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04181" /><CodeLine lineNumber="4181"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04182" /><CodeLine lineNumber="4182"></CodeLine>
<Link id="l04183" /><CodeLine lineNumber="4183"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166">TargetTransformInfo::RegisterKind</a> <a href="/docs/api/namespaces/anonymous-aarch64asmparser-cpp-/#afecbf44fe4e0f0e4e4294a38ed025957">RegKind</a> =</span></CodeLine>
<Link id="l04184" /><CodeLine lineNumber="4184"><span class="doxyHighlight">      ComputeScalableMaxVF ? <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166a331413d3887a08546d0973091f6a4993">TargetTransformInfo::RGK&#95;ScalableVector</a></span></CodeLine>
<Link id="l04185" /><CodeLine lineNumber="4185"><span class="doxyHighlight">                           : <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166a183020fbea95c99db23f6d3594f4c4af">TargetTransformInfo::RGK&#95;FixedWidthVector</a>;</span></CodeLine>
<Link id="l04186" /><CodeLine lineNumber="4186"><span class="doxyHighlight">  ElementCount MaxVF = MaxVectorElementCount;</span></CodeLine>
<Link id="l04187" /><CodeLine lineNumber="4187"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#afe9b34c22ec9e2cc84d61d437f82936d">MaximizeBandwidth</a> ||</span></CodeLine>
<Link id="l04188" /><CodeLine lineNumber="4188"><span class="doxyHighlight">      (<a href="#afe9b34c22ec9e2cc84d61d437f82936d">MaximizeBandwidth</a>.<a href="/docs/api/classes/llvm/cl/option/#a2dc75fafb68e7669e776e19da7857cdf">getNumOccurrences</a>() == 0 &amp;&amp;</span></CodeLine>
<Link id="l04189" /><CodeLine lineNumber="4189"><span class="doxyHighlight">       (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.shouldMaximizeVectorBandwidth(RegKind) ||</span></CodeLine>
<Link id="l04190" /><CodeLine lineNumber="4190"><span class="doxyHighlight">        (<a href="#a639c83322f3d5f0e24e9bde998a516fd">UseWiderVFIfCallVariantsPresent</a> &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;hasVectorCallVariants())))) &#123;</span></CodeLine>
<Link id="l04191" /><CodeLine lineNumber="4191"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MaxVectorElementCountMaxBW = <a href="/docs/api/classes/llvm/elementcount/#a79ea372f9aa69492fccfafc0e5a1589c">ElementCount::get</a>(</span></CodeLine>
<Link id="l04192" /><CodeLine lineNumber="4192"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">llvm::bit&#95;floor</a>(WidestRegister.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() / SmallestType),</span></CodeLine>
<Link id="l04193" /><CodeLine lineNumber="4193"><span class="doxyHighlight">        ComputeScalableMaxVF);</span></CodeLine>
<Link id="l04194" /><CodeLine lineNumber="4194"><span class="doxyHighlight">    MaxVectorElementCountMaxBW = MinVF(MaxVectorElementCountMaxBW, MaxSafeVF);</span></CodeLine>
<Link id="l04195" /><CodeLine lineNumber="4195"></CodeLine>
<Link id="l04196" /><CodeLine lineNumber="4196"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Collect all viable vectorization factors larger than the default MaxVF</span></CodeLine>
<Link id="l04197" /><CodeLine lineNumber="4197"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (i.e. MaxVectorElementCount).</span></CodeLine>
<Link id="l04198" /><CodeLine lineNumber="4198"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;ElementCount, 8&gt;</a> VFs;</span></CodeLine>
<Link id="l04199" /><CodeLine lineNumber="4199"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (ElementCount VS = MaxVectorElementCount &#42; 2;</span></CodeLine>
<Link id="l04200" /><CodeLine lineNumber="4200"><span class="doxyHighlight">         <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a338ba7ca7a526243ab1853d07d90fe38">ElementCount::isKnownLE</a>(VS, MaxVectorElementCountMaxBW); <a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28a9f54e5976c204d779cee3d87cabf0b02">VS</a> &#42;= 2)</span></CodeLine>
<Link id="l04201" /><CodeLine lineNumber="4201"><span class="doxyHighlight">      VFs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VS);</span></CodeLine>
<Link id="l04202" /><CodeLine lineNumber="4202"></CodeLine>
<Link id="l04203" /><CodeLine lineNumber="4203"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For each VF calculate its register usage.</span></CodeLine>
<Link id="l04204" /><CodeLine lineNumber="4204"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RUs = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91466f7a82e967ed765e6d876415a3b7">calculateRegisterUsage</a>(VFs);</span></CodeLine>
<Link id="l04205" /><CodeLine lineNumber="4205"></CodeLine>
<Link id="l04206" /><CodeLine lineNumber="4206"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Select the largest VF which doesn&#39;t require more registers than existing</span></CodeLine>
<Link id="l04207" /><CodeLine lineNumber="4207"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ones.</span></CodeLine>
<Link id="l04208" /><CodeLine lineNumber="4208"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = RUs.size() - 1; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &gt;= 0; --<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l04209" /><CodeLine lineNumber="4209"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MLU = RUs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;.MaxLocalUsers;</span></CodeLine>
<Link id="l04210" /><CodeLine lineNumber="4210"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(MLU, &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">decltype</span><span class="doxyHighlight">(MLU.front()) &amp;LU) &#123;</span></CodeLine>
<Link id="l04211" /><CodeLine lineNumber="4211"><span class="doxyHighlight">            return LU.second &lt;= TTI.getNumberOfRegisters(LU.first);</span></CodeLine>
<Link id="l04212" /><CodeLine lineNumber="4212"><span class="doxyHighlight">          &#125;)) &#123;</span></CodeLine>
<Link id="l04213" /><CodeLine lineNumber="4213"><span class="doxyHighlight">        MaxVF = VFs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l04214" /><CodeLine lineNumber="4214"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04215" /><CodeLine lineNumber="4215"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04216" /><CodeLine lineNumber="4216"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04217" /><CodeLine lineNumber="4217"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ElementCount MinVF =</span></CodeLine>
<Link id="l04218" /><CodeLine lineNumber="4218"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMinimumVF(SmallestType, ComputeScalableMaxVF)) &#123;</span></CodeLine>
<Link id="l04219" /><CodeLine lineNumber="4219"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a83e6442f8ebefccdb5e089732fe397ac">ElementCount::isKnownLT</a>(MaxVF, MinVF)) &#123;</span></CodeLine>
<Link id="l04220" /><CodeLine lineNumber="4220"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Overriding calculated MaxVF(&quot;</span><span class="doxyHighlight"> &lt;&lt; MaxVF</span></CodeLine>
<Link id="l04221" /><CodeLine lineNumber="4221"><span class="doxyHighlight">                          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;) with target&#39;s minimum: &quot;</span><span class="doxyHighlight"> &lt;&lt; MinVF &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04222" /><CodeLine lineNumber="4222"><span class="doxyHighlight">        MaxVF = MinVF;</span></CodeLine>
<Link id="l04223" /><CodeLine lineNumber="4223"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04224" /><CodeLine lineNumber="4224"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04225" /><CodeLine lineNumber="4225"></CodeLine>
<Link id="l04226" /><CodeLine lineNumber="4226"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Invalidate any widening decisions we might have made, in case the loop</span></CodeLine>
<Link id="l04227" /><CodeLine lineNumber="4227"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// requires prediction (decided later), but we have already made some</span></CodeLine>
<Link id="l04228" /><CodeLine lineNumber="4228"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// load/store widening decisions.</span></CodeLine>
<Link id="l04229" /><CodeLine lineNumber="4229"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85afe07533e500a31222b17f80b540fe">invalidateCostModelingDecisions</a>();</span></CodeLine>
<Link id="l04230" /><CodeLine lineNumber="4230"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04231" /><CodeLine lineNumber="4231"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> MaxVF;</span></CodeLine>
<Link id="l04232" /><CodeLine lineNumber="4232"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04233" /><CodeLine lineNumber="4233"></CodeLine>
<Link id="l04234" /><CodeLine lineNumber="4234"><span class="doxyHighlightComment">/// Convenience function that returns the value of vscale&#95;range iff</span></CodeLine>
<Link id="l04235" /><CodeLine lineNumber="4235"><span class="doxyHighlightComment">/// vscale&#95;range.min == vscale&#95;range.max or otherwise returns the value</span></CodeLine>
<Link id="l04236" /><CodeLine lineNumber="4236"><span class="doxyHighlightComment">/// returned by the corresponding TTI method.</span></CodeLine>
<Link id="l04237" /><CodeLine lineNumber="4237"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> std::optional&lt;unsigned&gt;</span></CodeLine>
<Link id="l04238" /><CodeLine lineNumber="4238" lineLink="#a4e108201f94f2fe89865e7868390bbf6"><span class="doxyHighlight"><a href="#a4e108201f94f2fe89865e7868390bbf6">getVScaleForTuning</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l04239" /><CodeLine lineNumber="4239"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;Fn = L-&gt;getHeader()-&gt;getParent();</span></CodeLine>
<Link id="l04240" /><CodeLine lineNumber="4240"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Fn-&gt;<a href="/docs/api/classes/llvm/function/#afb28a4deafe2954b0534cc6399ce518b">hasFnAttribute</a>(Attribute::VScaleRange)) &#123;</span></CodeLine>
<Link id="l04241" /><CodeLine lineNumber="4241"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Attr = Fn-&gt;<a href="/docs/api/classes/llvm/function/#a4c319db4fe05c27cfe55bd133a87414d">getFnAttribute</a>(Attribute::VScaleRange);</span></CodeLine>
<Link id="l04242" /><CodeLine lineNumber="4242"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Min = Attr.<a href="/docs/api/classes/llvm/attribute/#a2340c9d2c47ffa7fc07568ba059b62a2">getVScaleRangeMin</a>();</span></CodeLine>
<Link id="l04243" /><CodeLine lineNumber="4243"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Max = Attr.getVScaleRangeMax();</span></CodeLine>
<Link id="l04244" /><CodeLine lineNumber="4244"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Max &amp;&amp; Min == Max)</span></CodeLine>
<Link id="l04245" /><CodeLine lineNumber="4245"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Max;</span></CodeLine>
<Link id="l04246" /><CodeLine lineNumber="4246"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04247" /><CodeLine lineNumber="4247"></CodeLine>
<Link id="l04248" /><CodeLine lineNumber="4248"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getVScaleForTuning();</span></CodeLine>
<Link id="l04249" /><CodeLine lineNumber="4249"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04250" /><CodeLine lineNumber="4250"></CodeLine>
<Link id="l04251" /><CodeLine lineNumber="4251"><span class="doxyHighlightComment">/// This function attempts to return a value that represents the vectorization</span></CodeLine>
<Link id="l04252" /><CodeLine lineNumber="4252"><span class="doxyHighlightComment">/// factor at runtime. For fixed-width VFs we know this precisely at compile</span></CodeLine>
<Link id="l04253" /><CodeLine lineNumber="4253"><span class="doxyHighlightComment">/// time, but for scalable VFs we calculate it based on an estimate of the</span></CodeLine>
<Link id="l04254" /><CodeLine lineNumber="4254"><span class="doxyHighlightComment">/// vscale value.</span></CodeLine>
<Link id="l04255" /><CodeLine lineNumber="4255" lineLink="#ab3df41ae1ed3978e3b825bc4dd50ae8d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</span></CodeLine>
<Link id="l04256" /><CodeLine lineNumber="4256"><span class="doxyHighlight">                                      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l04257" /><CodeLine lineNumber="4257"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l04258" /><CodeLine lineNumber="4258"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EstimatedVF = VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>();</span></CodeLine>
<Link id="l04259" /><CodeLine lineNumber="4259"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</span></CodeLine>
<Link id="l04260" /><CodeLine lineNumber="4260"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (std::optional&lt;unsigned&gt; VScale = <a href="#a4e108201f94f2fe89865e7868390bbf6">getVScaleForTuning</a>(L, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</span></CodeLine>
<Link id="l04261" /><CodeLine lineNumber="4261"><span class="doxyHighlight">      EstimatedVF &#42;= &#42;VScale;</span></CodeLine>
<Link id="l04262" /><CodeLine lineNumber="4262"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EstimatedVF &gt;= 1 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Estimated VF shouldn&#39;t be less than 1&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04263" /><CodeLine lineNumber="4263"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EstimatedVF;</span></CodeLine>
<Link id="l04264" /><CodeLine lineNumber="4264"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04265" /><CodeLine lineNumber="4265"></CodeLine>
<Link id="l04266" /><CodeLine lineNumber="4266"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopVectorizationPlanner::isMoreProfitable(</span></CodeLine>
<Link id="l04267" /><CodeLine lineNumber="4267"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>,</span></CodeLine>
<Link id="l04268" /><CodeLine lineNumber="4268"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxTripCount)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04269" /><CodeLine lineNumber="4269"><span class="doxyHighlight">  InstructionCost CostA = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Cost;</span></CodeLine>
<Link id="l04270" /><CodeLine lineNumber="4270"><span class="doxyHighlight">  InstructionCost CostB = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.Cost;</span></CodeLine>
<Link id="l04271" /><CodeLine lineNumber="4271"></CodeLine>
<Link id="l04272" /><CodeLine lineNumber="4272"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Improve estimate for the vector width if it is scalable.</span></CodeLine>
<Link id="l04273" /><CodeLine lineNumber="4273"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EstimatedWidthA = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Width.getKnownMinValue();</span></CodeLine>
<Link id="l04274" /><CodeLine lineNumber="4274"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EstimatedWidthB = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.Width.getKnownMinValue();</span></CodeLine>
<Link id="l04275" /><CodeLine lineNumber="4275"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (std::optional&lt;unsigned&gt; VScale = <a href="#a4e108201f94f2fe89865e7868390bbf6">getVScaleForTuning</a>(OrigLoop, TTI)) &#123;</span></CodeLine>
<Link id="l04276" /><CodeLine lineNumber="4276"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Width.isScalable())</span></CodeLine>
<Link id="l04277" /><CodeLine lineNumber="4277"><span class="doxyHighlight">      EstimatedWidthA &#42;= &#42;VScale;</span></CodeLine>
<Link id="l04278" /><CodeLine lineNumber="4278"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.Width.isScalable())</span></CodeLine>
<Link id="l04279" /><CodeLine lineNumber="4279"><span class="doxyHighlight">      EstimatedWidthB &#42;= &#42;VScale;</span></CodeLine>
<Link id="l04280" /><CodeLine lineNumber="4280"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04281" /><CodeLine lineNumber="4281"></CodeLine>
<Link id="l04282" /><CodeLine lineNumber="4282"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Assume vscale may be larger than 1 (or the value being tuned for),</span></CodeLine>
<Link id="l04283" /><CodeLine lineNumber="4283"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so that scalable vectorization is slightly favorable over fixed-width</span></CodeLine>
<Link id="l04284" /><CodeLine lineNumber="4284"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorization.</span></CodeLine>
<Link id="l04285" /><CodeLine lineNumber="4285"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> PreferScalable = !TTI.preferFixedOverScalableIfEqualCost() &amp;&amp;</span></CodeLine>
<Link id="l04286" /><CodeLine lineNumber="4286"><span class="doxyHighlight">                        <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Width.isScalable() &amp;&amp; !<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.Width.isScalable();</span></CodeLine>
<Link id="l04287" /><CodeLine lineNumber="4287"></CodeLine>
<Link id="l04288" /><CodeLine lineNumber="4288"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CmpFn = &#91;PreferScalable&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> InstructionCost &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</span></CodeLine>
<Link id="l04289" /><CodeLine lineNumber="4289"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> InstructionCost &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</span></CodeLine>
<Link id="l04290" /><CodeLine lineNumber="4290"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PreferScalable ? <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> &lt;= <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> : <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> &lt; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>;</span></CodeLine>
<Link id="l04291" /><CodeLine lineNumber="4291"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l04292" /><CodeLine lineNumber="4292"></CodeLine>
<Link id="l04293" /><CodeLine lineNumber="4293"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// To avoid the need for FP division:</span></CodeLine>
<Link id="l04294" /><CodeLine lineNumber="4294"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//      (CostA / EstimatedWidthA) &lt; (CostB / EstimatedWidthB)</span></CodeLine>
<Link id="l04295" /><CodeLine lineNumber="4295"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &lt;=&gt;  (CostA &#42; EstimatedWidthB) &lt; (CostB &#42; EstimatedWidthA)</span></CodeLine>
<Link id="l04296" /><CodeLine lineNumber="4296"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MaxTripCount)</span></CodeLine>
<Link id="l04297" /><CodeLine lineNumber="4297"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CmpFn(CostA &#42; EstimatedWidthB, CostB &#42; EstimatedWidthA);</span></CodeLine>
<Link id="l04298" /><CodeLine lineNumber="4298"></CodeLine>
<Link id="l04299" /><CodeLine lineNumber="4299"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GetCostForTC = &#91;MaxTripCount, </span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> VF,</span></CodeLine>
<Link id="l04300" /><CodeLine lineNumber="4300"><span class="doxyHighlight">                                           InstructionCost VectorCost,</span></CodeLine>
<Link id="l04301" /><CodeLine lineNumber="4301"><span class="doxyHighlight">                                           InstructionCost ScalarCost) &#123;</span></CodeLine>
<Link id="l04302" /><CodeLine lineNumber="4302"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the trip count is a known (possibly small) constant, the trip count</span></CodeLine>
<Link id="l04303" /><CodeLine lineNumber="4303"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// will be rounded up to an integer number of iterations under</span></CodeLine>
<Link id="l04304" /><CodeLine lineNumber="4304"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// FoldTailByMasking. The total cost in that case will be</span></CodeLine>
<Link id="l04305" /><CodeLine lineNumber="4305"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// VecCost&#42;ceil(TripCount/VF). When not folding the tail, the total</span></CodeLine>
<Link id="l04306" /><CodeLine lineNumber="4306"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cost will be VecCost&#42;floor(TC/VF) + ScalarCost&#42;(TC%VF). There will be</span></CodeLine>
<Link id="l04307" /><CodeLine lineNumber="4307"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// some extra overheads, but for the purpose of comparing the costs of</span></CodeLine>
<Link id="l04308" /><CodeLine lineNumber="4308"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// different VFs we can use this to compare the total loop-body cost</span></CodeLine>
<Link id="l04309" /><CodeLine lineNumber="4309"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// expected after vectorization.</span></CodeLine>
<Link id="l04310" /><CodeLine lineNumber="4310"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CM.foldTailByMasking())</span></CodeLine>
<Link id="l04311" /><CodeLine lineNumber="4311"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> VectorCost &#42; <a href="/docs/api/namespaces/llvm/#a9dda4472ee0b7ea92ab49eedf6e13d50">divideCeil</a>(MaxTripCount, VF);</span></CodeLine>
<Link id="l04312" /><CodeLine lineNumber="4312"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> VectorCost &#42; (MaxTripCount / VF) + ScalarCost &#42; (MaxTripCount % VF);</span></CodeLine>
<Link id="l04313" /><CodeLine lineNumber="4313"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l04314" /><CodeLine lineNumber="4314"></CodeLine>
<Link id="l04315" /><CodeLine lineNumber="4315"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RTCostA = GetCostForTC(EstimatedWidthA, CostA, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.ScalarCost);</span></CodeLine>
<Link id="l04316" /><CodeLine lineNumber="4316"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RTCostB = GetCostForTC(EstimatedWidthB, CostB, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.ScalarCost);</span></CodeLine>
<Link id="l04317" /><CodeLine lineNumber="4317"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CmpFn(RTCostA, RTCostB);</span></CodeLine>
<Link id="l04318" /><CodeLine lineNumber="4318"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04319" /><CodeLine lineNumber="4319"></CodeLine>
<Link id="l04320" /><CodeLine lineNumber="4320"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopVectorizationPlanner::isMoreProfitable(</span></CodeLine>
<Link id="l04321" /><CodeLine lineNumber="4321"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04322" /><CodeLine lineNumber="4322"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxTripCount = PSE.getSmallConstantMaxTripCount();</span></CodeLine>
<Link id="l04323" /><CodeLine lineNumber="4323"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> LoopVectorizationPlanner::isMoreProfitable(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, MaxTripCount);</span></CodeLine>
<Link id="l04324" /><CodeLine lineNumber="4324"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04325" /><CodeLine lineNumber="4325"></CodeLine>
<Link id="l04326" /><CodeLine lineNumber="4326" lineLink="/docs/api/classes/llvm/loopvectorizationplanner/#aa216c2cbc8d9610dc20db065aca671d3"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationplanner/#aa216c2cbc8d9610dc20db065aca671d3">LoopVectorizationPlanner::emitInvalidCostRemarks</a>(</span></CodeLine>
<Link id="l04327" /><CodeLine lineNumber="4327"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE) &#123;</span></CodeLine>
<Link id="l04328" /><CodeLine lineNumber="4328"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">RecipeVFPair = std::pair&lt;VPRecipeBase &#42;, ElementCount&gt;;</span></CodeLine>
<Link id="l04329" /><CodeLine lineNumber="4329"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;RecipeVFPair&gt;</a> InvalidCosts;</span></CodeLine>
<Link id="l04330" /><CodeLine lineNumber="4330"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Plan : VPlans) &#123;</span></CodeLine>
<Link id="l04331" /><CodeLine lineNumber="4331"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF : Plan-&gt;vectorFactors()) &#123;</span></CodeLine>
<Link id="l04332" /><CodeLine lineNumber="4332"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/vpcostcontext">VPCostContext</a> CostCtx(CM.TTI, &#42;CM.TLI, Legal-&gt;getWidestInductionType(),</span></CodeLine>
<Link id="l04333" /><CodeLine lineNumber="4333"><span class="doxyHighlight">                            CM, CM.CostKind);</span></CodeLine>
<Link id="l04334" /><CodeLine lineNumber="4334"><span class="doxyHighlight">      precomputeCosts(&#42;Plan, VF, CostCtx);</span></CodeLine>
<Link id="l04335" /><CodeLine lineNumber="4335"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Iter = <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan-&gt;getVectorLoopRegion()-&gt;getEntry());</span></CodeLine>
<Link id="l04336" /><CodeLine lineNumber="4336"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(Iter)) &#123;</span></CodeLine>
<Link id="l04337" /><CodeLine lineNumber="4337"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;R : &#42;VPBB) &#123;</span></CodeLine>
<Link id="l04338" /><CodeLine lineNumber="4338"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!R.cost(VF, CostCtx).isValid())</span></CodeLine>
<Link id="l04339" /><CodeLine lineNumber="4339"><span class="doxyHighlight">            InvalidCosts.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(&amp;R, VF);</span></CodeLine>
<Link id="l04340" /><CodeLine lineNumber="4340"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l04341" /><CodeLine lineNumber="4341"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04342" /><CodeLine lineNumber="4342"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04343" /><CodeLine lineNumber="4343"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04344" /><CodeLine lineNumber="4344"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InvalidCosts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</span></CodeLine>
<Link id="l04345" /><CodeLine lineNumber="4345"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04346" /><CodeLine lineNumber="4346"></CodeLine>
<Link id="l04347" /><CodeLine lineNumber="4347"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit a report of VFs with invalid costs in the loop.</span></CodeLine>
<Link id="l04348" /><CodeLine lineNumber="4348"></CodeLine>
<Link id="l04349" /><CodeLine lineNumber="4349"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Group the remarks per recipe, keeping the recipe order from InvalidCosts.</span></CodeLine>
<Link id="l04350" /><CodeLine lineNumber="4350"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;VPRecipeBase &#42;, unsigned&gt;</a> Numbering;</span></CodeLine>
<Link id="l04351" /><CodeLine lineNumber="4351"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0;</span></CodeLine>
<Link id="l04352" /><CodeLine lineNumber="4352"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pair : InvalidCosts)</span></CodeLine>
<Link id="l04353" /><CodeLine lineNumber="4353"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Numbering.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(Pair.first))</span></CodeLine>
<Link id="l04354" /><CodeLine lineNumber="4354"><span class="doxyHighlight">      Numbering&#91;Pair.first&#93; = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</span></CodeLine>
<Link id="l04355" /><CodeLine lineNumber="4355"></CodeLine>
<Link id="l04356" /><CodeLine lineNumber="4356"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sort the list, first on recipe(number) then on VF.</span></CodeLine>
<Link id="l04357" /><CodeLine lineNumber="4357"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">sort</a>(InvalidCosts, &#91;&amp;Numbering&#93;(RecipeVFPair &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, RecipeVFPair &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</span></CodeLine>
<Link id="l04358" /><CodeLine lineNumber="4358"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Numbering&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.first&#93; != Numbering&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.first&#93;)</span></CodeLine>
<Link id="l04359" /><CodeLine lineNumber="4359"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Numbering&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.first&#93; &lt; Numbering&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.first&#93;;</span></CodeLine>
<Link id="l04360" /><CodeLine lineNumber="4360"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;LHS = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.second;</span></CodeLine>
<Link id="l04361" /><CodeLine lineNumber="4361"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;RHS = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.second;</span></CodeLine>
<Link id="l04362" /><CodeLine lineNumber="4362"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::make&#95;tuple(LHS.isScalable(), LHS.getKnownMinValue()) &lt;</span></CodeLine>
<Link id="l04363" /><CodeLine lineNumber="4363"><span class="doxyHighlight">           std::make&#95;tuple(RHS.isScalable(), RHS.getKnownMinValue());</span></CodeLine>
<Link id="l04364" /><CodeLine lineNumber="4364"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l04365" /><CodeLine lineNumber="4365"></CodeLine>
<Link id="l04366" /><CodeLine lineNumber="4366"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For a list of ordered recipe-VF pairs:</span></CodeLine>
<Link id="l04367" /><CodeLine lineNumber="4367"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   &#91;(load, VF1), (load, VF2), (store, VF1)&#93;</span></CodeLine>
<Link id="l04368" /><CodeLine lineNumber="4368"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// group the recipes together to emit separate remarks for:</span></CodeLine>
<Link id="l04369" /><CodeLine lineNumber="4369"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   load  (VF1, VF2)</span></CodeLine>
<Link id="l04370" /><CodeLine lineNumber="4370"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   store (VF1)</span></CodeLine>
<Link id="l04371" /><CodeLine lineNumber="4371"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a> = <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef&lt;RecipeVFPair&gt;</a>(InvalidCosts);</span></CodeLine>
<Link id="l04372" /><CodeLine lineNumber="4372"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Subset = <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef&lt;RecipeVFPair&gt;</a>();</span></CodeLine>
<Link id="l04373" /><CodeLine lineNumber="4373"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">do</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04374" /><CodeLine lineNumber="4374"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Subset.empty())</span></CodeLine>
<Link id="l04375" /><CodeLine lineNumber="4375"><span class="doxyHighlight">      Subset = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a>.take&#95;front(1);</span></CodeLine>
<Link id="l04376" /><CodeLine lineNumber="4376"></CodeLine>
<Link id="l04377" /><CodeLine lineNumber="4377"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;R = Subset.front().first;</span></CodeLine>
<Link id="l04378" /><CodeLine lineNumber="4378"></CodeLine>
<Link id="l04379" /><CodeLine lineNumber="4379"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opcode =</span></CodeLine>
<Link id="l04380" /><CodeLine lineNumber="4380"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/typeswitch">TypeSwitch&lt;const VPRecipeBase &#42;, unsigned&gt;</a>(R)</span></CodeLine>
<Link id="l04381" /><CodeLine lineNumber="4381"><span class="doxyHighlight">            .<a href="/docs/api/classes/llvm/typeswitch/#a78c545287cbe57529ce7751e25c815a5">Case</a>&lt;<a href="/docs/api/classes/llvm/vpheaderphirecipe">VPHeaderPHIRecipe</a>&gt;(</span></CodeLine>
<Link id="l04382" /><CodeLine lineNumber="4382"><span class="doxyHighlight">                &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;R) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Instruction::PHI; &#125;)</span></CodeLine>
<Link id="l04383" /><CodeLine lineNumber="4383"><span class="doxyHighlight">            .Case&lt;VPWidenSelectRecipe&gt;(</span></CodeLine>
<Link id="l04384" /><CodeLine lineNumber="4384"><span class="doxyHighlight">                &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;R) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Instruction::Select; &#125;)</span></CodeLine>
<Link id="l04385" /><CodeLine lineNumber="4385"><span class="doxyHighlight">            .Case&lt;VPWidenStoreRecipe&gt;(</span></CodeLine>
<Link id="l04386" /><CodeLine lineNumber="4386"><span class="doxyHighlight">                &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;R) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Instruction::Store; &#125;)</span></CodeLine>
<Link id="l04387" /><CodeLine lineNumber="4387"><span class="doxyHighlight">            .Case&lt;VPWidenLoadRecipe&gt;(</span></CodeLine>
<Link id="l04388" /><CodeLine lineNumber="4388"><span class="doxyHighlight">                &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;R) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Instruction::Load; &#125;)</span></CodeLine>
<Link id="l04389" /><CodeLine lineNumber="4389"><span class="doxyHighlight">            .Case&lt;VPWidenCallRecipe, VPWidenIntrinsicRecipe&gt;(</span></CodeLine>
<Link id="l04390" /><CodeLine lineNumber="4390"><span class="doxyHighlight">                &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;R) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Instruction::Call; &#125;)</span></CodeLine>
<Link id="l04391" /><CodeLine lineNumber="4391"><span class="doxyHighlight">            .Case&lt;<a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a>, <a href="/docs/api/classes/llvm/vpwidenrecipe">VPWidenRecipe</a>, <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a>,</span></CodeLine>
<Link id="l04392" /><CodeLine lineNumber="4392"><span class="doxyHighlight">                  <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>&gt;(</span></CodeLine>
<Link id="l04393" /><CodeLine lineNumber="4393"><span class="doxyHighlight">                &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;R) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> R-&gt;getOpcode(); &#125;)</span></CodeLine>
<Link id="l04394" /><CodeLine lineNumber="4394"><span class="doxyHighlight">            .Case&lt;VPInterleaveRecipe&gt;(&#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpinterleaverecipe">VPInterleaveRecipe</a> &#42;R) &#123;</span></CodeLine>
<Link id="l04395" /><CodeLine lineNumber="4395"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> R-&gt;getStoredValues().empty() ? Instruction::Load</span></CodeLine>
<Link id="l04396" /><CodeLine lineNumber="4396"><span class="doxyHighlight">                                                  : Instruction::Store;</span></CodeLine>
<Link id="l04397" /><CodeLine lineNumber="4397"><span class="doxyHighlight">            &#125;);</span></CodeLine>
<Link id="l04398" /><CodeLine lineNumber="4398"></CodeLine>
<Link id="l04399" /><CodeLine lineNumber="4399"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the next recipe is different, or if there are no other pairs,</span></CodeLine>
<Link id="l04400" /><CodeLine lineNumber="4400"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// emit a remark for the collated subset. e.g.</span></CodeLine>
<Link id="l04401" /><CodeLine lineNumber="4401"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   &#91;(load, VF1), (load, VF2))&#93;</span></CodeLine>
<Link id="l04402" /><CodeLine lineNumber="4402"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to emit:</span></CodeLine>
<Link id="l04403" /><CodeLine lineNumber="4403"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  remark: invalid costs for &#39;load&#39; at VF=(VF1, VF2)</span></CodeLine>
<Link id="l04404" /><CodeLine lineNumber="4404"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Subset == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a> || <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a>&#91;Subset.size()&#93;.first != R) &#123;</span></CodeLine>
<Link id="l04405" /><CodeLine lineNumber="4405"><span class="doxyHighlight">      std::string OutString;</span></CodeLine>
<Link id="l04406" /><CodeLine lineNumber="4406"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/raw-string-ostream">raw&#95;string&#95;ostream</a> OS(OutString);</span></CodeLine>
<Link id="l04407" /><CodeLine lineNumber="4407"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Subset.empty() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected empty range&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04408" /><CodeLine lineNumber="4408"><span class="doxyHighlight">      OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Recipe with invalid costs prevented vectorization at VF=(&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04409" /><CodeLine lineNumber="4409"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pair : Subset)</span></CodeLine>
<Link id="l04410" /><CodeLine lineNumber="4410"><span class="doxyHighlight">        OS &lt;&lt; (Pair.second == Subset.front().second ? </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;, &quot;</span><span class="doxyHighlight">) &lt;&lt; Pair.second;</span></CodeLine>
<Link id="l04411" /><CodeLine lineNumber="4411"><span class="doxyHighlight">      OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;):&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04412" /><CodeLine lineNumber="4412"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opcode == Instruction::Call) &#123;</span></CodeLine>
<Link id="l04413" /><CodeLine lineNumber="4413"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name = </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04414" /><CodeLine lineNumber="4414"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a637b69dea56f804278aa50e975337e01">Int</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenIntrinsicRecipe&gt;</a>(R)) &#123;</span></CodeLine>
<Link id="l04415" /><CodeLine lineNumber="4415"><span class="doxyHighlight">          Name = <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a637b69dea56f804278aa50e975337e01">Int</a>-&gt;getIntrinsicName();</span></CodeLine>
<Link id="l04416" /><CodeLine lineNumber="4416"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04417" /><CodeLine lineNumber="4417"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WidenCall = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenCallRecipe&gt;</a>(R);</span></CodeLine>
<Link id="l04418" /><CodeLine lineNumber="4418"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/function">Function</a> &#42;CalledFn =</span></CodeLine>
<Link id="l04419" /><CodeLine lineNumber="4419"><span class="doxyHighlight">              WidenCall ? WidenCall-&gt;getCalledScalarFunction()</span></CodeLine>
<Link id="l04420" /><CodeLine lineNumber="4420"><span class="doxyHighlight">                        : <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Function&gt;</a>(R-&gt;getOperand(R-&gt;getNumOperands() - 1)</span></CodeLine>
<Link id="l04421" /><CodeLine lineNumber="4421"><span class="doxyHighlight">                                             -&gt;getLiveInIRValue());</span></CodeLine>
<Link id="l04422" /><CodeLine lineNumber="4422"><span class="doxyHighlight">          Name = CalledFn-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>();</span></CodeLine>
<Link id="l04423" /><CodeLine lineNumber="4423"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l04424" /><CodeLine lineNumber="4424"><span class="doxyHighlight">        OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; call to &quot;</span><span class="doxyHighlight"> &lt;&lt; Name;</span></CodeLine>
<Link id="l04425" /><CodeLine lineNumber="4425"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l04426" /><CodeLine lineNumber="4426"><span class="doxyHighlight">        OS &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/classes/llvm/instruction/#a9affd129d19aae669647eb0d1c91f793">Instruction::getOpcodeName</a>(Opcode);</span></CodeLine>
<Link id="l04427" /><CodeLine lineNumber="4427"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(OutString, </span><span class="doxyHighlightStringLiteral">&quot;InvalidCost&quot;</span><span class="doxyHighlight">, ORE, OrigLoop, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04428" /><CodeLine lineNumber="4428"><span class="doxyHighlight">                              R-&gt;getDebugLoc());</span></CodeLine>
<Link id="l04429" /><CodeLine lineNumber="4429"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a> = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a>.drop&#95;front(Subset.size());</span></CodeLine>
<Link id="l04430" /><CodeLine lineNumber="4430"><span class="doxyHighlight">      Subset = &#123;&#125;;</span></CodeLine>
<Link id="l04431" /><CodeLine lineNumber="4431"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l04432" /><CodeLine lineNumber="4432"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Grow the subset by one element</span></CodeLine>
<Link id="l04433" /><CodeLine lineNumber="4433"><span class="doxyHighlight">      Subset = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a>.take&#95;front(Subset.size() + 1);</span></CodeLine>
<Link id="l04434" /><CodeLine lineNumber="4434"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a>.empty());</span></CodeLine>
<Link id="l04435" /><CodeLine lineNumber="4435"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04436" /><CodeLine lineNumber="4436"></CodeLine>
<Link id="l04437" /><CodeLine lineNumber="4437"><span class="doxyHighlightComment">/// Check if any recipe of \\p Plan will generate a vector value, which will be</span></CodeLine>
<Link id="l04438" /><CodeLine lineNumber="4438"><span class="doxyHighlightComment">/// assigned a vector register.</span></CodeLine>
<Link id="l04439" /><CodeLine lineNumber="4439" lineLink="#af378bb1e037306d9cfd4bb0b49ba55f9"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#af378bb1e037306d9cfd4bb0b49ba55f9">willGenerateVectors</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF,</span></CodeLine>
<Link id="l04440" /><CodeLine lineNumber="4440"><span class="doxyHighlight">                                </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</span></CodeLine>
<Link id="l04441" /><CodeLine lineNumber="4441"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Checking a scalar VF?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04442" /><CodeLine lineNumber="4442"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>());</span></CodeLine>
<Link id="l04443" /><CodeLine lineNumber="4443"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;VPRecipeBase &#42;&gt;</a> EphemeralRecipes;</span></CodeLine>
<Link id="l04444" /><CodeLine lineNumber="4444"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a62219a4c97e27d64593245e4e9187cd1">collectEphemeralRecipesForVPlan</a>(Plan, EphemeralRecipes);</span></CodeLine>
<Link id="l04445" /><CodeLine lineNumber="4445"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Set of already visited types.</span></CodeLine>
<Link id="l04446" /><CodeLine lineNumber="4446"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;Type &#42;&gt;</a> Visited;</span></CodeLine>
<Link id="l04447" /><CodeLine lineNumber="4447"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(</span></CodeLine>
<Link id="l04448" /><CodeLine lineNumber="4448"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#a4474bfb1e0ca062e5bfe2a35980e7d19">vp&#95;depth&#95;first&#95;shallow</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#a1ae2cb3c63b4d67324ddc947fb9696fc">getEntry</a>()))) &#123;</span></CodeLine>
<Link id="l04449" /><CodeLine lineNumber="4449"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : &#42;VPBB) &#123;</span></CodeLine>
<Link id="l04450" /><CodeLine lineNumber="4450"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EphemeralRecipes.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(&amp;R))</span></CodeLine>
<Link id="l04451" /><CodeLine lineNumber="4451"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04452" /><CodeLine lineNumber="4452"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Continue early if the recipe is considered to not produce a vector</span></CodeLine>
<Link id="l04453" /><CodeLine lineNumber="4453"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// result. Note that this includes VPInstruction where some opcodes may</span></CodeLine>
<Link id="l04454" /><CodeLine lineNumber="4454"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// produce a vector, to preserve existing behavior as VPInstructions model</span></CodeLine>
<Link id="l04455" /><CodeLine lineNumber="4455"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// aspects not directly mapped to existing IR instructions.</span></CodeLine>
<Link id="l04456" /><CodeLine lineNumber="4456"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (R.getVPDefID()) &#123;</span></CodeLine>
<Link id="l04457" /><CodeLine lineNumber="4457"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPDerivedIVSC:</span></CodeLine>
<Link id="l04458" /><CodeLine lineNumber="4458"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPScalarIVStepsSC:</span></CodeLine>
<Link id="l04459" /><CodeLine lineNumber="4459"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPScalarCastSC:</span></CodeLine>
<Link id="l04460" /><CodeLine lineNumber="4460"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPReplicateSC:</span></CodeLine>
<Link id="l04461" /><CodeLine lineNumber="4461"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPInstructionSC:</span></CodeLine>
<Link id="l04462" /><CodeLine lineNumber="4462"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPCanonicalIVPHISC:</span></CodeLine>
<Link id="l04463" /><CodeLine lineNumber="4463"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPVectorPointerSC:</span></CodeLine>
<Link id="l04464" /><CodeLine lineNumber="4464"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPReverseVectorPointerSC:</span></CodeLine>
<Link id="l04465" /><CodeLine lineNumber="4465"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPExpandSCEVSC:</span></CodeLine>
<Link id="l04466" /><CodeLine lineNumber="4466"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPEVLBasedIVPHISC:</span></CodeLine>
<Link id="l04467" /><CodeLine lineNumber="4467"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPPredInstPHISC:</span></CodeLine>
<Link id="l04468" /><CodeLine lineNumber="4468"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPBranchOnMaskSC:</span></CodeLine>
<Link id="l04469" /><CodeLine lineNumber="4469"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04470" /><CodeLine lineNumber="4470"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPReductionSC:</span></CodeLine>
<Link id="l04471" /><CodeLine lineNumber="4471"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPActiveLaneMaskPHISC:</span></CodeLine>
<Link id="l04472" /><CodeLine lineNumber="4472"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPWidenCallSC:</span></CodeLine>
<Link id="l04473" /><CodeLine lineNumber="4473"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPWidenCanonicalIVSC:</span></CodeLine>
<Link id="l04474" /><CodeLine lineNumber="4474"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPWidenCastSC:</span></CodeLine>
<Link id="l04475" /><CodeLine lineNumber="4475"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPWidenGEPSC:</span></CodeLine>
<Link id="l04476" /><CodeLine lineNumber="4476"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPWidenIntrinsicSC:</span></CodeLine>
<Link id="l04477" /><CodeLine lineNumber="4477"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPWidenSC:</span></CodeLine>
<Link id="l04478" /><CodeLine lineNumber="4478"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPWidenSelectSC:</span></CodeLine>
<Link id="l04479" /><CodeLine lineNumber="4479"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPBlendSC:</span></CodeLine>
<Link id="l04480" /><CodeLine lineNumber="4480"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPFirstOrderRecurrencePHISC:</span></CodeLine>
<Link id="l04481" /><CodeLine lineNumber="4481"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPWidenPHISC:</span></CodeLine>
<Link id="l04482" /><CodeLine lineNumber="4482"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPWidenIntOrFpInductionSC:</span></CodeLine>
<Link id="l04483" /><CodeLine lineNumber="4483"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPWidenPointerInductionSC:</span></CodeLine>
<Link id="l04484" /><CodeLine lineNumber="4484"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPReductionPHISC:</span></CodeLine>
<Link id="l04485" /><CodeLine lineNumber="4485"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPInterleaveSC:</span></CodeLine>
<Link id="l04486" /><CodeLine lineNumber="4486"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPWidenLoadEVLSC:</span></CodeLine>
<Link id="l04487" /><CodeLine lineNumber="4487"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPWidenLoadSC:</span></CodeLine>
<Link id="l04488" /><CodeLine lineNumber="4488"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPWidenStoreEVLSC:</span></CodeLine>
<Link id="l04489" /><CodeLine lineNumber="4489"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> VPDef::VPWidenStoreSC:</span></CodeLine>
<Link id="l04490" /><CodeLine lineNumber="4490"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04491" /><CodeLine lineNumber="4491"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l04492" /><CodeLine lineNumber="4492"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;unhandled recipe&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04493" /><CodeLine lineNumber="4493"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04494" /><CodeLine lineNumber="4494"></CodeLine>
<Link id="l04495" /><CodeLine lineNumber="4495"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> WillWiden = &#91;&amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, VF&#93;(<a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarTy) &#123;</span></CodeLine>
<Link id="l04496" /><CodeLine lineNumber="4496"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/type">Type</a> &#42;VectorTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ScalarTy, VF);</span></CodeLine>
<Link id="l04497" /><CodeLine lineNumber="4497"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumLegalParts = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getNumberOfParts(VectorTy);</span></CodeLine>
<Link id="l04498" /><CodeLine lineNumber="4498"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!NumLegalParts)</span></CodeLine>
<Link id="l04499" /><CodeLine lineNumber="4499"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04500" /><CodeLine lineNumber="4500"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>()) &#123;</span></CodeLine>
<Link id="l04501" /><CodeLine lineNumber="4501"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// &lt;vscale x 1 x iN&gt; is assumed to be profitable over iN because</span></CodeLine>
<Link id="l04502" /><CodeLine lineNumber="4502"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// scalable registers are a distinct register class from scalar</span></CodeLine>
<Link id="l04503" /><CodeLine lineNumber="4503"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// ones. If we ever find a target which wants to lower scalable</span></CodeLine>
<Link id="l04504" /><CodeLine lineNumber="4504"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// vectors back to scalars, we&#39;ll need to update this code to</span></CodeLine>
<Link id="l04505" /><CodeLine lineNumber="4505"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// explicitly ask TTI about the register class uses for each part.</span></CodeLine>
<Link id="l04506" /><CodeLine lineNumber="4506"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NumLegalParts &lt;= VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>();</span></CodeLine>
<Link id="l04507" /><CodeLine lineNumber="4507"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l04508" /><CodeLine lineNumber="4508"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Two or more parts that share a register - are vectorized.</span></CodeLine>
<Link id="l04509" /><CodeLine lineNumber="4509"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> NumLegalParts &lt; VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>();</span></CodeLine>
<Link id="l04510" /><CodeLine lineNumber="4510"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l04511" /><CodeLine lineNumber="4511"></CodeLine>
<Link id="l04512" /><CodeLine lineNumber="4512"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If no def nor is a store, e.g., branches, continue - no value to check.</span></CodeLine>
<Link id="l04513" /><CodeLine lineNumber="4513"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (R.getNumDefinedValues() == 0 &amp;&amp;</span></CodeLine>
<Link id="l04514" /><CodeLine lineNumber="4514"><span class="doxyHighlight">          !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenStoreRecipe, VPWidenStoreEVLRecipe, VPInterleaveRecipe&gt;</a>(</span></CodeLine>
<Link id="l04515" /><CodeLine lineNumber="4515"><span class="doxyHighlight">              &amp;R))</span></CodeLine>
<Link id="l04516" /><CodeLine lineNumber="4516"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04517" /><CodeLine lineNumber="4517"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For multi-def recipes, currently only interleaved loads, suffice to</span></CodeLine>
<Link id="l04518" /><CodeLine lineNumber="4518"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// check first def only.</span></CodeLine>
<Link id="l04519" /><CodeLine lineNumber="4519"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For stores check their stored value; for interleaved stores suffice</span></CodeLine>
<Link id="l04520" /><CodeLine lineNumber="4520"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the check first stored value only. In all cases this is the second</span></CodeLine>
<Link id="l04521" /><CodeLine lineNumber="4521"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// operand.</span></CodeLine>
<Link id="l04522" /><CodeLine lineNumber="4522"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;ToCheck =</span></CodeLine>
<Link id="l04523" /><CodeLine lineNumber="4523"><span class="doxyHighlight">          R.getNumDefinedValues() &gt;= 1 ? R.getVPValue(0) : R.getOperand(1);</span></CodeLine>
<Link id="l04524" /><CodeLine lineNumber="4524"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarTy = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(ToCheck);</span></CodeLine>
<Link id="l04525" /><CodeLine lineNumber="4525"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Visited.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(&#123;ScalarTy&#125;).second)</span></CodeLine>
<Link id="l04526" /><CodeLine lineNumber="4526"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04527" /><CodeLine lineNumber="4527"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WillWiden(ScalarTy))</span></CodeLine>
<Link id="l04528" /><CodeLine lineNumber="4528"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04529" /><CodeLine lineNumber="4529"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04530" /><CodeLine lineNumber="4530"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04531" /><CodeLine lineNumber="4531"></CodeLine>
<Link id="l04532" /><CodeLine lineNumber="4532"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04533" /><CodeLine lineNumber="4533"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04534" /><CodeLine lineNumber="4534"></CodeLine>
<Link id="l04535" /><CodeLine lineNumber="4535"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l04536" /><CodeLine lineNumber="4536"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> LoopVectorizationPlanner::selectVectorizationFactor() &#123;</span></CodeLine>
<Link id="l04537" /><CodeLine lineNumber="4537"><span class="doxyHighlight">  InstructionCost ExpectedCost = CM.expectedCost(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1));</span></CodeLine>
<Link id="l04538" /><CodeLine lineNumber="4538"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Scalar loop costs: &quot;</span><span class="doxyHighlight"> &lt;&lt; ExpectedCost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04539" /><CodeLine lineNumber="4539"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExpectedCost.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected invalid cost for scalar loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04540" /><CodeLine lineNumber="4540"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(VPlans,</span></CodeLine>
<Link id="l04541" /><CodeLine lineNumber="4541"><span class="doxyHighlight">                &#91;&#93;(std::unique&#95;ptr&lt;VPlan&gt; &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>) &#123;</span></CodeLine>
<Link id="l04542" /><CodeLine lineNumber="4542"><span class="doxyHighlight">                  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;hasVF(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1));</span></CodeLine>
<Link id="l04543" /><CodeLine lineNumber="4543"><span class="doxyHighlight">                &#125;) &amp;&amp;</span></CodeLine>
<Link id="l04544" /><CodeLine lineNumber="4544"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expected Scalar VF to be a candidate&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04545" /><CodeLine lineNumber="4545"></CodeLine>
<Link id="l04546" /><CodeLine lineNumber="4546"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/analysis/loopaccessanalysis-cpp/#a8f125edbbaab03487fd1acbc5fa1c8b4">VectorizationFactor</a> ScalarCost(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1), ExpectedCost,</span></CodeLine>
<Link id="l04547" /><CodeLine lineNumber="4547"><span class="doxyHighlight">                                       ExpectedCost);</span></CodeLine>
<Link id="l04548" /><CodeLine lineNumber="4548"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/analysis/loopaccessanalysis-cpp/#a8f125edbbaab03487fd1acbc5fa1c8b4">VectorizationFactor</a> ChosenFactor = ScalarCost;</span></CodeLine>
<Link id="l04549" /><CodeLine lineNumber="4549"></CodeLine>
<Link id="l04550" /><CodeLine lineNumber="4550"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ForceVectorization = Hints.getForce() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a>;</span></CodeLine>
<Link id="l04551" /><CodeLine lineNumber="4551"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ForceVectorization &amp;&amp;</span></CodeLine>
<Link id="l04552" /><CodeLine lineNumber="4552"><span class="doxyHighlight">      (VPlans.size() &gt; 1 || !VPlans&#91;0&#93;-&gt;hasScalarVFOnly())) &#123;</span></CodeLine>
<Link id="l04553" /><CodeLine lineNumber="4553"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ignore scalar width, because the user explicitly wants vectorization.</span></CodeLine>
<Link id="l04554" /><CodeLine lineNumber="4554"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Initialize cost to max so that VF = 2 is, at least, chosen during cost</span></CodeLine>
<Link id="l04555" /><CodeLine lineNumber="4555"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// evaluation.</span></CodeLine>
<Link id="l04556" /><CodeLine lineNumber="4556"><span class="doxyHighlight">    ChosenFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a048d568675a5cc69c3fb85206882316d">Cost</a> = <a href="/docs/api/classes/llvm/instructioncost/#a6de26b938774385a0a4fb0d0b2a32d48">InstructionCost::getMax</a>();</span></CodeLine>
<Link id="l04557" /><CodeLine lineNumber="4557"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04558" /><CodeLine lineNumber="4558"></CodeLine>
<Link id="l04559" /><CodeLine lineNumber="4559"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : VPlans) &#123;</span></CodeLine>
<Link id="l04560" /><CodeLine lineNumber="4560"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (ElementCount VF : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;vectorFactors()) &#123;</span></CodeLine>
<Link id="l04561" /><CodeLine lineNumber="4561"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The cost for scalar VF=1 is already calculated, so ignore it.</span></CodeLine>
<Link id="l04562" /><CodeLine lineNumber="4562"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.isScalar())</span></CodeLine>
<Link id="l04563" /><CodeLine lineNumber="4563"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04564" /><CodeLine lineNumber="4564"></CodeLine>
<Link id="l04565" /><CodeLine lineNumber="4565"><span class="doxyHighlight">      InstructionCost <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = CM.expectedCost(VF);</span></CodeLine>
<Link id="l04566" /><CodeLine lineNumber="4566"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/analysis/loopaccessanalysis-cpp/#a8f125edbbaab03487fd1acbc5fa1c8b4">VectorizationFactor</a> Candidate(VF, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, ScalarCost.ScalarCost);</span></CodeLine>
<Link id="l04567" /><CodeLine lineNumber="4567"></CodeLine>
<Link id="l04568" /><CodeLine lineNumber="4568"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Width = <a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a>(OrigLoop, TTI, Candidate.Width);</span></CodeLine>
<Link id="l04569" /><CodeLine lineNumber="4569"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Vector loop of width &quot;</span><span class="doxyHighlight"> &lt;&lt; VF</span></CodeLine>
<Link id="l04570" /><CodeLine lineNumber="4570"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; costs: &quot;</span><span class="doxyHighlight"> &lt;&lt; (Candidate.Cost / Width));</span></CodeLine>
<Link id="l04571" /><CodeLine lineNumber="4571"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.isScalable())</span></CodeLine>
<Link id="l04572" /><CodeLine lineNumber="4572"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; (assuming a minimum vscale of &quot;</span></CodeLine>
<Link id="l04573" /><CodeLine lineNumber="4573"><span class="doxyHighlight">                          &lt;&lt; <a href="#a4e108201f94f2fe89865e7868390bbf6">getVScaleForTuning</a>(OrigLoop, TTI).value&#95;or(1)</span></CodeLine>
<Link id="l04574" /><CodeLine lineNumber="4574"><span class="doxyHighlight">                          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;)&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04575" /><CodeLine lineNumber="4575"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04576" /><CodeLine lineNumber="4576"></CodeLine>
<Link id="l04577" /><CodeLine lineNumber="4577"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ForceVectorization &amp;&amp; !<a href="#af378bb1e037306d9cfd4bb0b49ba55f9">willGenerateVectors</a>(&#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, VF, TTI)) &#123;</span></CodeLine>
<Link id="l04578" /><CodeLine lineNumber="4578"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l04579" /><CodeLine lineNumber="4579"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l04580" /><CodeLine lineNumber="4580"><span class="doxyHighlight">            &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Not considering vector loop of width &quot;</span><span class="doxyHighlight"> &lt;&lt; VF</span></CodeLine>
<Link id="l04581" /><CodeLine lineNumber="4581"><span class="doxyHighlight">            &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; because it will not generate any vector instructions.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04582" /><CodeLine lineNumber="4582"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04583" /><CodeLine lineNumber="4583"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04584" /><CodeLine lineNumber="4584"></CodeLine>
<Link id="l04585" /><CodeLine lineNumber="4585"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isMoreProfitable(Candidate, ChosenFactor))</span></CodeLine>
<Link id="l04586" /><CodeLine lineNumber="4586"><span class="doxyHighlight">        ChosenFactor = Candidate;</span></CodeLine>
<Link id="l04587" /><CodeLine lineNumber="4587"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04588" /><CodeLine lineNumber="4588"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04589" /><CodeLine lineNumber="4589"></CodeLine>
<Link id="l04590" /><CodeLine lineNumber="4590"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a1b67aba558e56b48dbb2891b6e5fe5b8">EnableCondStoresVectorization</a> &amp;&amp; CM.hasPredStores()) &#123;</span></CodeLine>
<Link id="l04591" /><CodeLine lineNumber="4591"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span></CodeLine>
<Link id="l04592" /><CodeLine lineNumber="4592"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;There are conditional stores.&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04593" /><CodeLine lineNumber="4593"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;store that is conditionally executed prevents vectorization&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l04594" /><CodeLine lineNumber="4594"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;ConditionalStore&quot;</span><span class="doxyHighlight">, ORE, OrigLoop);</span></CodeLine>
<Link id="l04595" /><CodeLine lineNumber="4595"><span class="doxyHighlight">    ChosenFactor = ScalarCost;</span></CodeLine>
<Link id="l04596" /><CodeLine lineNumber="4596"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04597" /><CodeLine lineNumber="4597"></CodeLine>
<Link id="l04598" /><CodeLine lineNumber="4598"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ForceVectorization &amp;&amp; !ChosenFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp;</span></CodeLine>
<Link id="l04599" /><CodeLine lineNumber="4599"><span class="doxyHighlight">                 !isMoreProfitable(ChosenFactor, ScalarCost)) <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l04600" /><CodeLine lineNumber="4600"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Vectorization seems to be not beneficial, &quot;</span></CodeLine>
<Link id="l04601" /><CodeLine lineNumber="4601"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;but was forced by a user.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04602" /><CodeLine lineNumber="4602"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ChosenFactor;</span></CodeLine>
<Link id="l04603" /><CodeLine lineNumber="4603"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04604" /><CodeLine lineNumber="4604"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l04605" /><CodeLine lineNumber="4605"></CodeLine>
<Link id="l04606" /><CodeLine lineNumber="4606"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopVectorizationPlanner::isCandidateForEpilogueVectorization(</span></CodeLine>
<Link id="l04607" /><CodeLine lineNumber="4607"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04608" /><CodeLine lineNumber="4608"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Cross iteration phis such as reductions need special handling and are</span></CodeLine>
<Link id="l04609" /><CodeLine lineNumber="4609"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// currently unsupported.</span></CodeLine>
<Link id="l04610" /><CodeLine lineNumber="4610"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(OrigLoop-&gt;getHeader()-&gt;phis(),</span></CodeLine>
<Link id="l04611" /><CodeLine lineNumber="4611"><span class="doxyHighlight">             &#91;&amp;&#93;(PHINode &amp;Phi) &#123; return Legal-&gt;isFixedOrderRecurrence(&amp;Phi); &#125;))</span></CodeLine>
<Link id="l04612" /><CodeLine lineNumber="4612"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04613" /><CodeLine lineNumber="4613"></CodeLine>
<Link id="l04614" /><CodeLine lineNumber="4614"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Phis with uses outside of the loop require special handling and are</span></CodeLine>
<Link id="l04615" /><CodeLine lineNumber="4615"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// currently unsupported.</span></CodeLine>
<Link id="l04616" /><CodeLine lineNumber="4616"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Entry : Legal-&gt;getInductionVars()) &#123;</span></CodeLine>
<Link id="l04617" /><CodeLine lineNumber="4617"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Look for uses of the value of the induction at the last iteration.</span></CodeLine>
<Link id="l04618" /><CodeLine lineNumber="4618"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arc/arcinstrinfo-cpp/#a5d6e37f3d036496321824378223ad718a1673ee57164ca23d9545b629b55e08d2">PostInc</a> =</span></CodeLine>
<Link id="l04619" /><CodeLine lineNumber="4619"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Entry</a>.first-&gt;getIncomingValueForBlock(OrigLoop-&gt;getLoopLatch());</span></CodeLine>
<Link id="l04620" /><CodeLine lineNumber="4620"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;U : <a href="/docs/api/files/lib/lib/target/lib/target/arc/arcinstrinfo-cpp/#a5d6e37f3d036496321824378223ad718a1673ee57164ca23d9545b629b55e08d2">PostInc</a>-&gt;users())</span></CodeLine>
<Link id="l04621" /><CodeLine lineNumber="4621"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OrigLoop-&gt;contains(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U)))</span></CodeLine>
<Link id="l04622" /><CodeLine lineNumber="4622"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04623" /><CodeLine lineNumber="4623"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Look for uses of penultimate value of the induction.</span></CodeLine>
<Link id="l04624" /><CodeLine lineNumber="4624"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;U : <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Entry</a>.first-&gt;users())</span></CodeLine>
<Link id="l04625" /><CodeLine lineNumber="4625"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OrigLoop-&gt;contains(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U)))</span></CodeLine>
<Link id="l04626" /><CodeLine lineNumber="4626"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04627" /><CodeLine lineNumber="4627"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04628" /><CodeLine lineNumber="4628"></CodeLine>
<Link id="l04629" /><CodeLine lineNumber="4629"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t vectorize the epilogue, if there are FindLastIV recurrences with a</span></CodeLine>
<Link id="l04630" /><CodeLine lineNumber="4630"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// start value may be undef or poison. Such start values would need freezing.</span></CodeLine>
<Link id="l04631" /><CodeLine lineNumber="4631"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(Legal-&gt;getReductionVars(), &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>) &#123;</span></CodeLine>
<Link id="l04632" /><CodeLine lineNumber="4632"><span class="doxyHighlight">        return RecurrenceDescriptor::isFindLastIVRecurrenceKind(</span></CodeLine>
<Link id="l04633" /><CodeLine lineNumber="4633"><span class="doxyHighlight">                   P.second.getRecurrenceKind()) &amp;&amp;</span></CodeLine>
<Link id="l04634" /><CodeLine lineNumber="4634"><span class="doxyHighlight">               !isGuaranteedNotToBeUndefOrPoison(</span></CodeLine>
<Link id="l04635" /><CodeLine lineNumber="4635"><span class="doxyHighlight">                   P.second.getRecurrenceStartValue());</span></CodeLine>
<Link id="l04636" /><CodeLine lineNumber="4636"><span class="doxyHighlight">      &#125;))</span></CodeLine>
<Link id="l04637" /><CodeLine lineNumber="4637"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04638" /><CodeLine lineNumber="4638"></CodeLine>
<Link id="l04639" /><CodeLine lineNumber="4639"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Epilogue vectorization code has not been auditted to ensure it handles</span></CodeLine>
<Link id="l04640" /><CodeLine lineNumber="4640"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// non-latch exits properly.  It may be fine, but it needs auditted and</span></CodeLine>
<Link id="l04641" /><CodeLine lineNumber="4641"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// tested.</span></CodeLine>
<Link id="l04642" /><CodeLine lineNumber="4642"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Add support for loops with an early exit.</span></CodeLine>
<Link id="l04643" /><CodeLine lineNumber="4643"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OrigLoop-&gt;getExitingBlock() != OrigLoop-&gt;getLoopLatch())</span></CodeLine>
<Link id="l04644" /><CodeLine lineNumber="4644"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04645" /><CodeLine lineNumber="4645"></CodeLine>
<Link id="l04646" /><CodeLine lineNumber="4646"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04647" /><CodeLine lineNumber="4647"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04648" /><CodeLine lineNumber="4648"></CodeLine>
<Link id="l04649" /><CodeLine lineNumber="4649" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a07db8a5919c9879e3327549f20cda2f9"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a07db8a5919c9879e3327549f20cda2f9">LoopVectorizationCostModel::isEpilogueVectorizationProfitable</a>(</span></CodeLine>
<Link id="l04650" /><CodeLine lineNumber="4650"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IC)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l04651" /><CodeLine lineNumber="4651"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: We need a much better cost-model to take different parameters such</span></CodeLine>
<Link id="l04652" /><CodeLine lineNumber="4652"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as register pressure, code size increase and cost of extra branches into</span></CodeLine>
<Link id="l04653" /><CodeLine lineNumber="4653"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// account. For now we apply a very crude heuristic and only consider loops</span></CodeLine>
<Link id="l04654" /><CodeLine lineNumber="4654"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// with vectorization factors larger than a certain value.</span></CodeLine>
<Link id="l04655" /><CodeLine lineNumber="4655"></CodeLine>
<Link id="l04656" /><CodeLine lineNumber="4656"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Allow the target to opt out entirely.</span></CodeLine>
<Link id="l04657" /><CodeLine lineNumber="4657"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.preferEpilogueVectorization())</span></CodeLine>
<Link id="l04658" /><CodeLine lineNumber="4658"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04659" /><CodeLine lineNumber="4659"></CodeLine>
<Link id="l04660" /><CodeLine lineNumber="4660"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We also consider epilogue vectorization unprofitable for targets that don&#39;t</span></CodeLine>
<Link id="l04661" /><CodeLine lineNumber="4661"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// consider interleaving beneficial (eg. MVE).</span></CodeLine>
<Link id="l04662" /><CodeLine lineNumber="4662"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMaxInterleaveFactor(VF) &lt;= 1)</span></CodeLine>
<Link id="l04663" /><CodeLine lineNumber="4663"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04664" /><CodeLine lineNumber="4664"></CodeLine>
<Link id="l04665" /><CodeLine lineNumber="4665"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: PR #108190 introduced a discrepancy between fixed-width and scalable</span></CodeLine>
<Link id="l04666" /><CodeLine lineNumber="4666"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// VFs when deciding profitability.</span></CodeLine>
<Link id="l04667" /><CodeLine lineNumber="4667"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// See related &quot;TODO: extend to support scalable VFs.&quot; in</span></CodeLine>
<Link id="l04668" /><CodeLine lineNumber="4668"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// selectEpilogueVectorizationFactor.</span></CodeLine>
<Link id="l04669" /><CodeLine lineNumber="4669"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Multiplier = VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#aab9a9b0568c1c524f01499c7930b3bf9">isFixed</a>() ? IC : 1;</span></CodeLine>
<Link id="l04670" /><CodeLine lineNumber="4670"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MinVFThreshold = <a href="#a01070590fdc156c181654c2db7b9ddcc">EpilogueVectorizationMinVF</a>.getNumOccurrences() &gt; 0</span></CodeLine>
<Link id="l04671" /><CodeLine lineNumber="4671"><span class="doxyHighlight">                                ? <a href="#a01070590fdc156c181654c2db7b9ddcc">EpilogueVectorizationMinVF</a></span></CodeLine>
<Link id="l04672" /><CodeLine lineNumber="4672"><span class="doxyHighlight">                                : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getEpilogueVectorizationMinVF();</span></CodeLine>
<Link id="l04673" /><CodeLine lineNumber="4673"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>, VF &#42; Multiplier) &gt;= MinVFThreshold;</span></CodeLine>
<Link id="l04674" /><CodeLine lineNumber="4674"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04675" /><CodeLine lineNumber="4675"></CodeLine>
<Link id="l04676" /><CodeLine lineNumber="4676" lineLink="/docs/api/classes/llvm/loopvectorizationplanner/#a0b6b1ae088cb8ca3aa4f26c4098daa3d"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> <a href="/docs/api/classes/llvm/loopvectorizationplanner/#a0b6b1ae088cb8ca3aa4f26c4098daa3d">LoopVectorizationPlanner::selectEpilogueVectorizationFactor</a>(</span></CodeLine>
<Link id="l04677" /><CodeLine lineNumber="4677"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MainLoopVF, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IC) &#123;</span></CodeLine>
<Link id="l04678" /><CodeLine lineNumber="4678"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> Result = <a href="/docs/api/structs/llvm/vectorizationfactor/#acd24dfdad4f887e1f7b10c9039a05930">VectorizationFactor::Disabled</a>();</span></CodeLine>
<Link id="l04679" /><CodeLine lineNumber="4679"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a8bb0da83afffaf803b396b1d055ba5e0">EnableEpilogueVectorization</a>) &#123;</span></CodeLine>
<Link id="l04680" /><CodeLine lineNumber="4680"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LEV: Epilogue vectorization is disabled.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04681" /><CodeLine lineNumber="4681"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l04682" /><CodeLine lineNumber="4682"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04683" /><CodeLine lineNumber="4683"></CodeLine>
<Link id="l04684" /><CodeLine lineNumber="4684"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CM.isScalarEpilogueAllowed()) &#123;</span></CodeLine>
<Link id="l04685" /><CodeLine lineNumber="4685"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LEV: Unable to vectorize epilogue because no &quot;</span></CodeLine>
<Link id="l04686" /><CodeLine lineNumber="4686"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;epilogue is allowed.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04687" /><CodeLine lineNumber="4687"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l04688" /><CodeLine lineNumber="4688"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04689" /><CodeLine lineNumber="4689"></CodeLine>
<Link id="l04690" /><CodeLine lineNumber="4690"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Not really a cost consideration, but check for unsupported cases here to</span></CodeLine>
<Link id="l04691" /><CodeLine lineNumber="4691"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// simplify the logic.</span></CodeLine>
<Link id="l04692" /><CodeLine lineNumber="4692"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!isCandidateForEpilogueVectorization(MainLoopVF)) &#123;</span></CodeLine>
<Link id="l04693" /><CodeLine lineNumber="4693"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LEV: Unable to vectorize epilogue because the loop &quot;</span></CodeLine>
<Link id="l04694" /><CodeLine lineNumber="4694"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;is not a supported candidate.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04695" /><CodeLine lineNumber="4695"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l04696" /><CodeLine lineNumber="4696"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04697" /><CodeLine lineNumber="4697"></CodeLine>
<Link id="l04698" /><CodeLine lineNumber="4698"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a01340df86c9d26b281ff1ab9288c28ce">EpilogueVectorizationForceVF</a> &gt; 1) &#123;</span></CodeLine>
<Link id="l04699" /><CodeLine lineNumber="4699"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LEV: Epilogue vectorization factor is forced.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04700" /><CodeLine lineNumber="4700"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> ForcedEC = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(<a href="#a01340df86c9d26b281ff1ab9288c28ce">EpilogueVectorizationForceVF</a>);</span></CodeLine>
<Link id="l04701" /><CodeLine lineNumber="4701"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationplanner/#adce80172b05bc0a227fbd5e3d7bb80f2">hasPlanWithVF</a>(ForcedEC))</span></CodeLine>
<Link id="l04702" /><CodeLine lineNumber="4702"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;ForcedEC, 0, 0&#125;;</span></CodeLine>
<Link id="l04703" /><CodeLine lineNumber="4703"></CodeLine>
<Link id="l04704" /><CodeLine lineNumber="4704"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LEV: Epilogue vectorization forced factor is not &quot;</span></CodeLine>
<Link id="l04705" /><CodeLine lineNumber="4705"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;viable.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04706" /><CodeLine lineNumber="4706"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l04707" /><CodeLine lineNumber="4707"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04708" /><CodeLine lineNumber="4708"></CodeLine>
<Link id="l04709" /><CodeLine lineNumber="4709"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OrigLoop-&gt;getHeader()-&gt;getParent()-&gt;hasOptSize() ||</span></CodeLine>
<Link id="l04710" /><CodeLine lineNumber="4710"><span class="doxyHighlight">      OrigLoop-&gt;getHeader()-&gt;getParent()-&gt;hasMinSize()) &#123;</span></CodeLine>
<Link id="l04711" /><CodeLine lineNumber="4711"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l04712" /><CodeLine lineNumber="4712"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LEV: Epilogue vectorization skipped due to opt for size.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04713" /><CodeLine lineNumber="4713"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l04714" /><CodeLine lineNumber="4714"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04715" /><CodeLine lineNumber="4715"></CodeLine>
<Link id="l04716" /><CodeLine lineNumber="4716"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CM.isEpilogueVectorizationProfitable(MainLoopVF, IC)) &#123;</span></CodeLine>
<Link id="l04717" /><CodeLine lineNumber="4717"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LEV: Epilogue vectorization is not profitable for &quot;</span></CodeLine>
<Link id="l04718" /><CodeLine lineNumber="4718"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;this loop\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04719" /><CodeLine lineNumber="4719"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l04720" /><CodeLine lineNumber="4720"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04721" /><CodeLine lineNumber="4721"></CodeLine>
<Link id="l04722" /><CodeLine lineNumber="4722"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If MainLoopVF = vscale x 2, and vscale is expected to be 4, then we know</span></CodeLine>
<Link id="l04723" /><CodeLine lineNumber="4723"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the main loop handles 8 lanes per iteration. We could still benefit from</span></CodeLine>
<Link id="l04724" /><CodeLine lineNumber="4724"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorizing the epilogue loop with VF=4.</span></CodeLine>
<Link id="l04725" /><CodeLine lineNumber="4725"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> EstimatedRuntimeVF =</span></CodeLine>
<Link id="l04726" /><CodeLine lineNumber="4726"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(<a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a>(OrigLoop, TTI, MainLoopVF));</span></CodeLine>
<Link id="l04727" /><CodeLine lineNumber="4727"></CodeLine>
<Link id="l04728" /><CodeLine lineNumber="4728"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE = &#42;PSE.getSE();</span></CodeLine>
<Link id="l04729" /><CodeLine lineNumber="4729"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;TCType = Legal-&gt;getWidestInductionType();</span></CodeLine>
<Link id="l04730" /><CodeLine lineNumber="4730"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;RemainingIterations = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04731" /><CodeLine lineNumber="4731"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxTripCount = 0;</span></CodeLine>
<Link id="l04732" /><CodeLine lineNumber="4732"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;NextVF : ProfitableVFs) &#123;</span></CodeLine>
<Link id="l04733" /><CodeLine lineNumber="4733"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip candidate VFs without a corresponding VPlan.</span></CodeLine>
<Link id="l04734" /><CodeLine lineNumber="4734"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationplanner/#adce80172b05bc0a227fbd5e3d7bb80f2">hasPlanWithVF</a>(NextVF.Width))</span></CodeLine>
<Link id="l04735" /><CodeLine lineNumber="4735"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04736" /><CodeLine lineNumber="4736"></CodeLine>
<Link id="l04737" /><CodeLine lineNumber="4737"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip candidate VFs with widths &gt;= the (estimated) runtime VF (scalable</span></CodeLine>
<Link id="l04738" /><CodeLine lineNumber="4738"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// vectors) or &gt; the VF of the main loop (fixed vectors).</span></CodeLine>
<Link id="l04739" /><CodeLine lineNumber="4739"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((!NextVF.Width.isScalable() &amp;&amp; MainLoopVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp;</span></CodeLine>
<Link id="l04740" /><CodeLine lineNumber="4740"><span class="doxyHighlight">         <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#afb486f9022a26e1cc53ff189710dbde5">ElementCount::isKnownGE</a>(NextVF.Width, EstimatedRuntimeVF)) ||</span></CodeLine>
<Link id="l04741" /><CodeLine lineNumber="4741"><span class="doxyHighlight">        (NextVF.Width.isScalable() &amp;&amp;</span></CodeLine>
<Link id="l04742" /><CodeLine lineNumber="4742"><span class="doxyHighlight">         <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#afb486f9022a26e1cc53ff189710dbde5">ElementCount::isKnownGE</a>(NextVF.Width, MainLoopVF)) ||</span></CodeLine>
<Link id="l04743" /><CodeLine lineNumber="4743"><span class="doxyHighlight">        (!NextVF.Width.isScalable() &amp;&amp; !MainLoopVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp;</span></CodeLine>
<Link id="l04744" /><CodeLine lineNumber="4744"><span class="doxyHighlight">         <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#addaa86bfa4ca26b7f366cbdd868f99bf">ElementCount::isKnownGT</a>(NextVF.Width, MainLoopVF)))</span></CodeLine>
<Link id="l04745" /><CodeLine lineNumber="4745"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04746" /><CodeLine lineNumber="4746"></CodeLine>
<Link id="l04747" /><CodeLine lineNumber="4747"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If NextVF is greater than the number of remaining iterations, the</span></CodeLine>
<Link id="l04748" /><CodeLine lineNumber="4748"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// epilogue loop would be dead. Skip such factors.</span></CodeLine>
<Link id="l04749" /><CodeLine lineNumber="4749"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MainLoopVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp; !NextVF.Width.isScalable()) &#123;</span></CodeLine>
<Link id="l04750" /><CodeLine lineNumber="4750"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: extend to support scalable VFs.</span></CodeLine>
<Link id="l04751" /><CodeLine lineNumber="4751"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RemainingIterations) &#123;</span></CodeLine>
<Link id="l04752" /><CodeLine lineNumber="4752"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;TC = <a href="/docs/api/namespaces/llvm/vputils/#a5999b0390c92ee4af2544fe9772454bf">vputils::getSCEVExprForVPValue</a>(</span></CodeLine>
<Link id="l04753" /><CodeLine lineNumber="4753"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(NextVF.Width).<a href="/docs/api/classes/llvm/vplan/#a2f5fc19caa67daeca8a1316c7e055e3c">getTripCount</a>(), SE);</span></CodeLine>
<Link id="l04754" /><CodeLine lineNumber="4754"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(TC) &amp;&amp;</span></CodeLine>
<Link id="l04755" /><CodeLine lineNumber="4755"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;Trip count SCEV must be computable&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04756" /><CodeLine lineNumber="4756"><span class="doxyHighlight">        RemainingIterations = SE.<a href="/docs/api/classes/llvm/scalarevolution/#a13b9eb961d35ad9ecb3b633f5703253a">getURemExpr</a>(</span></CodeLine>
<Link id="l04757" /><CodeLine lineNumber="4757"><span class="doxyHighlight">            TC, SE.<a href="/docs/api/classes/llvm/scalarevolution/#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(TCType, MainLoopVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42; IC));</span></CodeLine>
<Link id="l04758" /><CodeLine lineNumber="4758"><span class="doxyHighlight">        MaxTripCount = MainLoopVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42; IC - 1;</span></CodeLine>
<Link id="l04759" /><CodeLine lineNumber="4759"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE.<a href="/docs/api/classes/llvm/scalarevolution/#af74112dae88db73eb5484821b6f0fccd">isKnownPredicate</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">CmpInst::ICMP&#95;ULT</a>, RemainingIterations,</span></CodeLine>
<Link id="l04760" /><CodeLine lineNumber="4760"><span class="doxyHighlight">                                SE.<a href="/docs/api/classes/llvm/scalarevolution/#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(TCType, MaxTripCount))) &#123;</span></CodeLine>
<Link id="l04761" /><CodeLine lineNumber="4761"><span class="doxyHighlight">          MaxTripCount =</span></CodeLine>
<Link id="l04762" /><CodeLine lineNumber="4762"><span class="doxyHighlight">              SE.<a href="/docs/api/classes/llvm/scalarevolution/#ac8de32f4d40eae96f0e26f0728682c2e">getUnsignedRangeMax</a>(RemainingIterations).<a href="/docs/api/classes/llvm/apint/#a217e0207d9cc8e046c2dccbf0e4bb198">getZExtValue</a>();</span></CodeLine>
<Link id="l04763" /><CodeLine lineNumber="4763"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l04764" /><CodeLine lineNumber="4764"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LEV: Maximum Trip Count for Epilogue: &quot;</span></CodeLine>
<Link id="l04765" /><CodeLine lineNumber="4765"><span class="doxyHighlight">                          &lt;&lt; MaxTripCount &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04766" /><CodeLine lineNumber="4766"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04767" /><CodeLine lineNumber="4767"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SE.<a href="/docs/api/classes/llvm/scalarevolution/#af74112dae88db73eb5484821b6f0fccd">isKnownPredicate</a>(</span></CodeLine>
<Link id="l04768" /><CodeLine lineNumber="4768"><span class="doxyHighlight">              <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">CmpInst::ICMP&#95;UGT</a>,</span></CodeLine>
<Link id="l04769" /><CodeLine lineNumber="4769"><span class="doxyHighlight">              SE.<a href="/docs/api/classes/llvm/scalarevolution/#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(TCType, NextVF.Width.getKnownMinValue()),</span></CodeLine>
<Link id="l04770" /><CodeLine lineNumber="4770"><span class="doxyHighlight">              RemainingIterations))</span></CodeLine>
<Link id="l04771" /><CodeLine lineNumber="4771"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04772" /><CodeLine lineNumber="4772"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04773" /><CodeLine lineNumber="4773"></CodeLine>
<Link id="l04774" /><CodeLine lineNumber="4774"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Result.Width.isScalar() ||</span></CodeLine>
<Link id="l04775" /><CodeLine lineNumber="4775"><span class="doxyHighlight">        isMoreProfitable(NextVF, Result, MaxTripCount))</span></CodeLine>
<Link id="l04776" /><CodeLine lineNumber="4776"><span class="doxyHighlight">      Result = NextVF;</span></CodeLine>
<Link id="l04777" /><CodeLine lineNumber="4777"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04778" /><CodeLine lineNumber="4778"></CodeLine>
<Link id="l04779" /><CodeLine lineNumber="4779"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Result != <a href="/docs/api/structs/llvm/vectorizationfactor/#acd24dfdad4f887e1f7b10c9039a05930">VectorizationFactor::Disabled</a>())</span></CodeLine>
<Link id="l04780" /><CodeLine lineNumber="4780"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LEV: Vectorizing epilogue loop with VF = &quot;</span></CodeLine>
<Link id="l04781" /><CodeLine lineNumber="4781"><span class="doxyHighlight">                      &lt;&lt; Result.Width &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04782" /><CodeLine lineNumber="4782"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Result;</span></CodeLine>
<Link id="l04783" /><CodeLine lineNumber="4783"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04784" /><CodeLine lineNumber="4784"></CodeLine>
<Link id="l04785" /><CodeLine lineNumber="4785"><span class="doxyHighlight">std::pair&lt;unsigned, unsigned&gt;</span></CodeLine>
<Link id="l04786" /><CodeLine lineNumber="4786" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a1fa63b37ad2ac06f289e9962a3703e9e"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a1fa63b37ad2ac06f289e9962a3703e9e">LoopVectorizationCostModel::getSmallestAndWidestTypes</a>() &#123;</span></CodeLine>
<Link id="l04787" /><CodeLine lineNumber="4787"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MinWidth = -1U;</span></CodeLine>
<Link id="l04788" /><CodeLine lineNumber="4788"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxWidth = 8;</span></CodeLine>
<Link id="l04789" /><CodeLine lineNumber="4789"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>-&gt;getDataLayout();</span></CodeLine>
<Link id="l04790" /><CodeLine lineNumber="4790"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For in-loop reductions, no element types are added to ElementTypesInLoop</span></CodeLine>
<Link id="l04791" /><CodeLine lineNumber="4791"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if there are no loads/stores in the loop. In this case, check through the</span></CodeLine>
<Link id="l04792" /><CodeLine lineNumber="4792"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reduction variables to determine the maximum width.</span></CodeLine>
<Link id="l04793" /><CodeLine lineNumber="4793"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a00a28a503636abdbedf080f3896b937c">ElementTypesInLoop</a>.empty() &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars().empty()) &#123;</span></CodeLine>
<Link id="l04794" /><CodeLine lineNumber="4794"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Reset MaxWidth so that we can find the smallest type used by recurrences</span></CodeLine>
<Link id="l04795" /><CodeLine lineNumber="4795"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// in the loop.</span></CodeLine>
<Link id="l04796" /><CodeLine lineNumber="4796"><span class="doxyHighlight">    MaxWidth = -1U;</span></CodeLine>
<Link id="l04797" /><CodeLine lineNumber="4797"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;PhiDescriptorPair : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars()) &#123;</span></CodeLine>
<Link id="l04798" /><CodeLine lineNumber="4798"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc = PhiDescriptorPair.second;</span></CodeLine>
<Link id="l04799" /><CodeLine lineNumber="4799"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// When finding the min width used by the recurrence we need to account</span></CodeLine>
<Link id="l04800" /><CodeLine lineNumber="4800"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// for casts on the input operands of the recurrence.</span></CodeLine>
<Link id="l04801" /><CodeLine lineNumber="4801"><span class="doxyHighlight">      MaxWidth = std::min&lt;unsigned&gt;(</span></CodeLine>
<Link id="l04802" /><CodeLine lineNumber="4802"><span class="doxyHighlight">          MaxWidth, std::min&lt;unsigned&gt;(</span></CodeLine>
<Link id="l04803" /><CodeLine lineNumber="4803"><span class="doxyHighlight">                        RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a5f64b98dd7b1371ddda6c24bf2163be6">getMinWidthCastToRecurrenceTypeInBits</a>(),</span></CodeLine>
<Link id="l04804" /><CodeLine lineNumber="4804"><span class="doxyHighlight">                        RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>()));</span></CodeLine>
<Link id="l04805" /><CodeLine lineNumber="4805"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04806" /><CodeLine lineNumber="4806"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04807" /><CodeLine lineNumber="4807"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a00a28a503636abdbedf080f3896b937c">ElementTypesInLoop</a>) &#123;</span></CodeLine>
<Link id="l04808" /><CodeLine lineNumber="4808"><span class="doxyHighlight">      MinWidth = std::min&lt;unsigned&gt;(</span></CodeLine>
<Link id="l04809" /><CodeLine lineNumber="4809"><span class="doxyHighlight">          MinWidth, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;getScalarType()).getFixedValue());</span></CodeLine>
<Link id="l04810" /><CodeLine lineNumber="4810"><span class="doxyHighlight">      MaxWidth = std::max&lt;unsigned&gt;(</span></CodeLine>
<Link id="l04811" /><CodeLine lineNumber="4811"><span class="doxyHighlight">          MaxWidth, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;getScalarType()).getFixedValue());</span></CodeLine>
<Link id="l04812" /><CodeLine lineNumber="4812"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04813" /><CodeLine lineNumber="4813"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04814" /><CodeLine lineNumber="4814"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;MinWidth, MaxWidth&#125;;</span></CodeLine>
<Link id="l04815" /><CodeLine lineNumber="4815"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04816" /><CodeLine lineNumber="4816"></CodeLine>
<Link id="l04817" /><CodeLine lineNumber="4817" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a06f5d9725a2b1f7b06e8bf51f7d31417"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a06f5d9725a2b1f7b06e8bf51f7d31417">LoopVectorizationCostModel::collectElementTypesForWidening</a>() &#123;</span></CodeLine>
<Link id="l04818" /><CodeLine lineNumber="4818"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a00a28a503636abdbedf080f3896b937c">ElementTypesInLoop</a>.clear();</span></CodeLine>
<Link id="l04819" /><CodeLine lineNumber="4819"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For each block.</span></CodeLine>
<Link id="l04820" /><CodeLine lineNumber="4820"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks()) &#123;</span></CodeLine>
<Link id="l04821" /><CodeLine lineNumber="4821"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For each instruction in the loop.</span></CodeLine>
<Link id="l04822" /><CodeLine lineNumber="4822"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB-&gt;instructionsWithoutDebug()) &#123;</span></CodeLine>
<Link id="l04823" /><CodeLine lineNumber="4823"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType();</span></CodeLine>
<Link id="l04824" /><CodeLine lineNumber="4824"></CodeLine>
<Link id="l04825" /><CodeLine lineNumber="4825"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Skip ignored values.</span></CodeLine>
<Link id="l04826" /><CodeLine lineNumber="4826"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>.count(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l04827" /><CodeLine lineNumber="4827"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04828" /><CodeLine lineNumber="4828"></CodeLine>
<Link id="l04829" /><CodeLine lineNumber="4829"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Only examine Loads, Stores and PHINodes.</span></CodeLine>
<Link id="l04830" /><CodeLine lineNumber="4830"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l04831" /><CodeLine lineNumber="4831"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04832" /><CodeLine lineNumber="4832"></CodeLine>
<Link id="l04833" /><CodeLine lineNumber="4833"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Examine PHI nodes that are reduction variables. Update the type to</span></CodeLine>
<Link id="l04834" /><CodeLine lineNumber="4834"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// account for the recurrence type.</span></CodeLine>
<Link id="l04835" /><CodeLine lineNumber="4835"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l04836" /><CodeLine lineNumber="4836"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isReductionVariable(PN))</span></CodeLine>
<Link id="l04837" /><CodeLine lineNumber="4837"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04838" /><CodeLine lineNumber="4838"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc =</span></CodeLine>
<Link id="l04839" /><CodeLine lineNumber="4839"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars().find(PN)-&gt;second;</span></CodeLine>
<Link id="l04840" /><CodeLine lineNumber="4840"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a96ef6bd4742763bf1b85aaf1a4150620">PreferInLoopReductions</a> || <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad508b8cfa31c0e7a1ac8f9d733bb8eed">useOrderedReductions</a>(RdxDesc) ||</span></CodeLine>
<Link id="l04841" /><CodeLine lineNumber="4841"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.preferInLoopReduction(RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a30ee597b72598bc7939d3a40d2a5ba20">getOpcode</a>(),</span></CodeLine>
<Link id="l04842" /><CodeLine lineNumber="4842"><span class="doxyHighlight">                                      RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>(),</span></CodeLine>
<Link id="l04843" /><CodeLine lineNumber="4843"><span class="doxyHighlight">                                      <a href="/docs/api/structs/llvm/targettransforminfo/reductionflags">TargetTransformInfo::ReductionFlags</a>()))</span></CodeLine>
<Link id="l04844" /><CodeLine lineNumber="4844"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l04845" /><CodeLine lineNumber="4845"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>();</span></CodeLine>
<Link id="l04846" /><CodeLine lineNumber="4846"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l04847" /><CodeLine lineNumber="4847"></CodeLine>
<Link id="l04848" /><CodeLine lineNumber="4848"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Examine the stored values.</span></CodeLine>
<Link id="l04849" /><CodeLine lineNumber="4849"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ST = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l04850" /><CodeLine lineNumber="4850"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = ST-&gt;getValueOperand()-&gt;getType();</span></CodeLine>
<Link id="l04851" /><CodeLine lineNumber="4851"></CodeLine>
<Link id="l04852" /><CodeLine lineNumber="4852"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;isSized() &amp;&amp;</span></CodeLine>
<Link id="l04853" /><CodeLine lineNumber="4853"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Expected the load/store/recurrence type to be sized&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04854" /><CodeLine lineNumber="4854"></CodeLine>
<Link id="l04855" /><CodeLine lineNumber="4855"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a00a28a503636abdbedf080f3896b937c">ElementTypesInLoop</a>.insert(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>);</span></CodeLine>
<Link id="l04856" /><CodeLine lineNumber="4856"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04857" /><CodeLine lineNumber="4857"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04858" /><CodeLine lineNumber="4858"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l04859" /><CodeLine lineNumber="4859"></CodeLine>
<Link id="l04860" /><CodeLine lineNumber="4860"><span class="doxyHighlightKeywordType">unsigned</span></CodeLine>
<Link id="l04861" /><CodeLine lineNumber="4861" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#af9f62350ccdebd24858be552f3fc051c"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af9f62350ccdebd24858be552f3fc051c">LoopVectorizationCostModel::selectInterleaveCount</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF,</span></CodeLine>
<Link id="l04862" /><CodeLine lineNumber="4862"><span class="doxyHighlight">                                                  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> LoopCost) &#123;</span></CodeLine>
<Link id="l04863" /><CodeLine lineNumber="4863"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// -- The interleave heuristics --</span></CodeLine>
<Link id="l04864" /><CodeLine lineNumber="4864"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We interleave the loop in order to expose ILP and reduce the loop overhead.</span></CodeLine>
<Link id="l04865" /><CodeLine lineNumber="4865"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// There are many micro-architectural considerations that we can&#39;t predict</span></CodeLine>
<Link id="l04866" /><CodeLine lineNumber="4866"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// at this level. For example, frontend pressure (on decode or fetch) due to</span></CodeLine>
<Link id="l04867" /><CodeLine lineNumber="4867"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// code size, or the number and capabilities of the execution ports.</span></CodeLine>
<Link id="l04868" /><CodeLine lineNumber="4868"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l04869" /><CodeLine lineNumber="4869"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We use the following heuristics to select the interleave count:</span></CodeLine>
<Link id="l04870" /><CodeLine lineNumber="4870"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1 If the code has reductions, then we interleave to break the cross</span></CodeLine>
<Link id="l04871" /><CodeLine lineNumber="4871"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// iteration dependency.</span></CodeLine>
<Link id="l04872" /><CodeLine lineNumber="4872"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2 If the loop is really small, then we interleave to reduce the loop</span></CodeLine>
<Link id="l04873" /><CodeLine lineNumber="4873"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// overhead.</span></CodeLine>
<Link id="l04874" /><CodeLine lineNumber="4874"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 3 We don&#39;t interleave if we think that we will spill registers to memory</span></CodeLine>
<Link id="l04875" /><CodeLine lineNumber="4875"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// due to the increased register pressure.</span></CodeLine>
<Link id="l04876" /><CodeLine lineNumber="4876"></CodeLine>
<Link id="l04877" /><CodeLine lineNumber="4877"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af67062c22dbf5e0ab35164a778768476">isScalarEpilogueAllowed</a>())</span></CodeLine>
<Link id="l04878" /><CodeLine lineNumber="4878"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 1;</span></CodeLine>
<Link id="l04879" /><CodeLine lineNumber="4879"></CodeLine>
<Link id="l04880" /><CodeLine lineNumber="4880"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Do not interleave if EVL is preferred and no User IC is specified.</span></CodeLine>
<Link id="l04881" /><CodeLine lineNumber="4881"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab0c7e793ca1b6b8a4f8c00a1bc1cb32f">foldTailWithEVL</a>()) &#123;</span></CodeLine>
<Link id="l04882" /><CodeLine lineNumber="4882"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Preference for VP intrinsics indicated. &quot;</span></CodeLine>
<Link id="l04883" /><CodeLine lineNumber="4883"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;Unroll factor forced to be 1.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04884" /><CodeLine lineNumber="4884"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 1;</span></CodeLine>
<Link id="l04885" /><CodeLine lineNumber="4885"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04886" /><CodeLine lineNumber="4886"></CodeLine>
<Link id="l04887" /><CodeLine lineNumber="4887"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We used the distance for the interleave count.</span></CodeLine>
<Link id="l04888" /><CodeLine lineNumber="4888"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isSafeForAnyVectorWidth())</span></CodeLine>
<Link id="l04889" /><CodeLine lineNumber="4889"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 1;</span></CodeLine>
<Link id="l04890" /><CodeLine lineNumber="4890"></CodeLine>
<Link id="l04891" /><CodeLine lineNumber="4891"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We don&#39;t attempt to perform interleaving for loops with uncountable early</span></CodeLine>
<Link id="l04892" /><CodeLine lineNumber="4892"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// exits because the VPInstruction::AnyOf code cannot currently handle</span></CodeLine>
<Link id="l04893" /><CodeLine lineNumber="4893"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// multiple parts.</span></CodeLine>
<Link id="l04894" /><CodeLine lineNumber="4894"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;hasUncountableEarlyExit())</span></CodeLine>
<Link id="l04895" /><CodeLine lineNumber="4895"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 1;</span></CodeLine>
<Link id="l04896" /><CodeLine lineNumber="4896"></CodeLine>
<Link id="l04897" /><CodeLine lineNumber="4897"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BestKnownTC = <a href="#a84375e6536d9214c7895013078055aff">getSmallBestKnownTC</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l04898" /><CodeLine lineNumber="4898"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasReductions = !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars().empty();</span></CodeLine>
<Link id="l04899" /><CodeLine lineNumber="4899"></CodeLine>
<Link id="l04900" /><CodeLine lineNumber="4900"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we did not calculate the cost for VF (because the user selected the VF)</span></CodeLine>
<Link id="l04901" /><CodeLine lineNumber="4901"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// then we calculate the cost of VF here.</span></CodeLine>
<Link id="l04902" /><CodeLine lineNumber="4902"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopCost == 0) &#123;</span></CodeLine>
<Link id="l04903" /><CodeLine lineNumber="4903"><span class="doxyHighlight">    LoopCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae4c50e6300599d50ba706c0d2b780502">expectedCost</a>(VF);</span></CodeLine>
<Link id="l04904" /><CodeLine lineNumber="4904"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LoopCost.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected to have chosen a VF with valid cost&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04905" /><CodeLine lineNumber="4905"></CodeLine>
<Link id="l04906" /><CodeLine lineNumber="4906"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Loop body is free and there is no need for interleaving.</span></CodeLine>
<Link id="l04907" /><CodeLine lineNumber="4907"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopCost == 0)</span></CodeLine>
<Link id="l04908" /><CodeLine lineNumber="4908"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 1;</span></CodeLine>
<Link id="l04909" /><CodeLine lineNumber="4909"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04910" /><CodeLine lineNumber="4910"></CodeLine>
<Link id="l04911" /><CodeLine lineNumber="4911"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage">RegisterUsage</a> R = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91466f7a82e967ed765e6d876415a3b7">calculateRegisterUsage</a>(&#123;VF&#125;)&#91;0&#93;;</span></CodeLine>
<Link id="l04912" /><CodeLine lineNumber="4912"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We divide by these constants so assume that we have at least one</span></CodeLine>
<Link id="l04913" /><CodeLine lineNumber="4913"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction that uses at least one register.</span></CodeLine>
<Link id="l04914" /><CodeLine lineNumber="4914"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pair : R.MaxLocalUsers) &#123;</span></CodeLine>
<Link id="l04915" /><CodeLine lineNumber="4915"><span class="doxyHighlight">    Pair.second = std::max(Pair.second, 1U);</span></CodeLine>
<Link id="l04916" /><CodeLine lineNumber="4916"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04917" /><CodeLine lineNumber="4917"></CodeLine>
<Link id="l04918" /><CodeLine lineNumber="4918"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We calculate the interleave count using the following formula.</span></CodeLine>
<Link id="l04919" /><CodeLine lineNumber="4919"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Subtract the number of loop invariants from the number of available</span></CodeLine>
<Link id="l04920" /><CodeLine lineNumber="4920"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// registers. These registers are used by all of the interleaved instances.</span></CodeLine>
<Link id="l04921" /><CodeLine lineNumber="4921"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Next, divide the remaining registers by the number of registers that is</span></CodeLine>
<Link id="l04922" /><CodeLine lineNumber="4922"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// required by the loop, in order to estimate how many parallel instances</span></CodeLine>
<Link id="l04923" /><CodeLine lineNumber="4923"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// fit without causing spills. All of this is rounded down if necessary to be</span></CodeLine>
<Link id="l04924" /><CodeLine lineNumber="4924"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// a power of two. We want power of two interleave count to simplify any</span></CodeLine>
<Link id="l04925" /><CodeLine lineNumber="4925"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// addressing operations or alignment considerations.</span></CodeLine>
<Link id="l04926" /><CodeLine lineNumber="4926"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We also want power of two interleave counts to ensure that the induction</span></CodeLine>
<Link id="l04927" /><CodeLine lineNumber="4927"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// variable of the vector loop wraps to zero, when tail is folded by masking;</span></CodeLine>
<Link id="l04928" /><CodeLine lineNumber="4928"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// this currently happens when OptForSize, in which case IC is set to 1 above.</span></CodeLine>
<Link id="l04929" /><CodeLine lineNumber="4929"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IC = UINT&#95;MAX;</span></CodeLine>
<Link id="l04930" /><CodeLine lineNumber="4930"></CodeLine>
<Link id="l04931" /><CodeLine lineNumber="4931"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pair : R.MaxLocalUsers) &#123;</span></CodeLine>
<Link id="l04932" /><CodeLine lineNumber="4932"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TargetNumRegisters = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getNumberOfRegisters(Pair.first);</span></CodeLine>
<Link id="l04933" /><CodeLine lineNumber="4933"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: The target has &quot;</span><span class="doxyHighlight"> &lt;&lt; TargetNumRegisters</span></CodeLine>
<Link id="l04934" /><CodeLine lineNumber="4934"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; registers of &quot;</span></CodeLine>
<Link id="l04935" /><CodeLine lineNumber="4935"><span class="doxyHighlight">                      &lt;&lt; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getRegisterClassName(Pair.first)</span></CodeLine>
<Link id="l04936" /><CodeLine lineNumber="4936"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; register class\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l04937" /><CodeLine lineNumber="4937"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>()) &#123;</span></CodeLine>
<Link id="l04938" /><CodeLine lineNumber="4938"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a62baadf3a5bf03eddf58bf048724acb1">ForceTargetNumScalarRegs</a>.getNumOccurrences() &gt; 0)</span></CodeLine>
<Link id="l04939" /><CodeLine lineNumber="4939"><span class="doxyHighlight">        TargetNumRegisters = <a href="#a62baadf3a5bf03eddf58bf048724acb1">ForceTargetNumScalarRegs</a>;</span></CodeLine>
<Link id="l04940" /><CodeLine lineNumber="4940"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04941" /><CodeLine lineNumber="4941"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a7d952aa72676eecd8065aa2c29ea458c">ForceTargetNumVectorRegs</a>.getNumOccurrences() &gt; 0)</span></CodeLine>
<Link id="l04942" /><CodeLine lineNumber="4942"><span class="doxyHighlight">        TargetNumRegisters = <a href="#a7d952aa72676eecd8065aa2c29ea458c">ForceTargetNumVectorRegs</a>;</span></CodeLine>
<Link id="l04943" /><CodeLine lineNumber="4943"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04944" /><CodeLine lineNumber="4944"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxLocalUsers = Pair.second;</span></CodeLine>
<Link id="l04945" /><CodeLine lineNumber="4945"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LoopInvariantRegs = 0;</span></CodeLine>
<Link id="l04946" /><CodeLine lineNumber="4946"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (R.LoopInvariantRegs.find(Pair.first) != R.LoopInvariantRegs.end())</span></CodeLine>
<Link id="l04947" /><CodeLine lineNumber="4947"><span class="doxyHighlight">      LoopInvariantRegs = R.LoopInvariantRegs&#91;Pair.first&#93;;</span></CodeLine>
<Link id="l04948" /><CodeLine lineNumber="4948"></CodeLine>
<Link id="l04949" /><CodeLine lineNumber="4949"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TmpIC = <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">llvm::bit&#95;floor</a>((TargetNumRegisters - LoopInvariantRegs) /</span></CodeLine>
<Link id="l04950" /><CodeLine lineNumber="4950"><span class="doxyHighlight">                                     MaxLocalUsers);</span></CodeLine>
<Link id="l04951" /><CodeLine lineNumber="4951"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Don&#39;t count the induction variable as interleaved.</span></CodeLine>
<Link id="l04952" /><CodeLine lineNumber="4952"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a8122656ed2c776067b43d9ae34ccecb6">EnableIndVarRegisterHeur</a>) &#123;</span></CodeLine>
<Link id="l04953" /><CodeLine lineNumber="4953"><span class="doxyHighlight">      TmpIC = <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">llvm::bit&#95;floor</a>((TargetNumRegisters - LoopInvariantRegs - 1) /</span></CodeLine>
<Link id="l04954" /><CodeLine lineNumber="4954"><span class="doxyHighlight">                              std::max(1U, (MaxLocalUsers - 1)));</span></CodeLine>
<Link id="l04955" /><CodeLine lineNumber="4955"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l04956" /><CodeLine lineNumber="4956"></CodeLine>
<Link id="l04957" /><CodeLine lineNumber="4957"><span class="doxyHighlight">    IC = std::min(IC, TmpIC);</span></CodeLine>
<Link id="l04958" /><CodeLine lineNumber="4958"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04959" /><CodeLine lineNumber="4959"></CodeLine>
<Link id="l04960" /><CodeLine lineNumber="4960"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clamp the interleave ranges to reasonable counts.</span></CodeLine>
<Link id="l04961" /><CodeLine lineNumber="4961"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MaxInterleaveCount = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMaxInterleaveFactor(VF);</span></CodeLine>
<Link id="l04962" /><CodeLine lineNumber="4962"></CodeLine>
<Link id="l04963" /><CodeLine lineNumber="4963"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if the user has overridden the max.</span></CodeLine>
<Link id="l04964" /><CodeLine lineNumber="4964"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>()) &#123;</span></CodeLine>
<Link id="l04965" /><CodeLine lineNumber="4965"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aee1082071c43958a6ef5e6e9f665ae4a">ForceTargetMaxScalarInterleaveFactor</a>.getNumOccurrences() &gt; 0)</span></CodeLine>
<Link id="l04966" /><CodeLine lineNumber="4966"><span class="doxyHighlight">      MaxInterleaveCount = <a href="#aee1082071c43958a6ef5e6e9f665ae4a">ForceTargetMaxScalarInterleaveFactor</a>;</span></CodeLine>
<Link id="l04967" /><CodeLine lineNumber="4967"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l04968" /><CodeLine lineNumber="4968"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ade5aad46b91dc51c831acf1e69ee9863">ForceTargetMaxVectorInterleaveFactor</a>.getNumOccurrences() &gt; 0)</span></CodeLine>
<Link id="l04969" /><CodeLine lineNumber="4969"><span class="doxyHighlight">      MaxInterleaveCount = <a href="#ade5aad46b91dc51c831acf1e69ee9863">ForceTargetMaxVectorInterleaveFactor</a>;</span></CodeLine>
<Link id="l04970" /><CodeLine lineNumber="4970"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l04971" /><CodeLine lineNumber="4971"></CodeLine>
<Link id="l04972" /><CodeLine lineNumber="4972"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EstimatedVF = <a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>, VF);</span></CodeLine>
<Link id="l04973" /><CodeLine lineNumber="4973"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> KnownTC = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE()-&gt;getSmallConstantTripCount(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l04974" /><CodeLine lineNumber="4974"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (KnownTC &gt; 0) &#123;</span></CodeLine>
<Link id="l04975" /><CodeLine lineNumber="4975"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// At least one iteration must be scalar when this constraint holds. So the</span></CodeLine>
<Link id="l04976" /><CodeLine lineNumber="4976"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// maximum available iterations for interleaving is one less.</span></CodeLine>
<Link id="l04977" /><CodeLine lineNumber="4977"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AvailableTC =</span></CodeLine>
<Link id="l04978" /><CodeLine lineNumber="4978"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a913ab9c8291000dd3a1c3739194b03e4">requiresScalarEpilogue</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()) ? KnownTC - 1 : KnownTC;</span></CodeLine>
<Link id="l04979" /><CodeLine lineNumber="4979"></CodeLine>
<Link id="l04980" /><CodeLine lineNumber="4980"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If trip count is known we select between two prospective ICs, where</span></CodeLine>
<Link id="l04981" /><CodeLine lineNumber="4981"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// 1) the aggressive IC is capped by the trip count divided by VF</span></CodeLine>
<Link id="l04982" /><CodeLine lineNumber="4982"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// 2) the conservative IC is capped by the trip count divided by (VF &#42; 2)</span></CodeLine>
<Link id="l04983" /><CodeLine lineNumber="4983"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The final IC is selected in a way that the epilogue loop trip count is</span></CodeLine>
<Link id="l04984" /><CodeLine lineNumber="4984"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// minimized while maximizing the IC itself, so that we either run the</span></CodeLine>
<Link id="l04985" /><CodeLine lineNumber="4985"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// vector loop at least once if it generates a small epilogue loop, or else</span></CodeLine>
<Link id="l04986" /><CodeLine lineNumber="4986"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we run the vector loop at least twice.</span></CodeLine>
<Link id="l04987" /><CodeLine lineNumber="4987"></CodeLine>
<Link id="l04988" /><CodeLine lineNumber="4988"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> InterleaveCountUB = <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">bit&#95;floor</a>(</span></CodeLine>
<Link id="l04989" /><CodeLine lineNumber="4989"><span class="doxyHighlight">        std::max(1u, std::min(AvailableTC / EstimatedVF, MaxInterleaveCount)));</span></CodeLine>
<Link id="l04990" /><CodeLine lineNumber="4990"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> InterleaveCountLB = <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">bit&#95;floor</a>(std::max(</span></CodeLine>
<Link id="l04991" /><CodeLine lineNumber="4991"><span class="doxyHighlight">        1u, std::min(AvailableTC / (EstimatedVF &#42; 2), MaxInterleaveCount)));</span></CodeLine>
<Link id="l04992" /><CodeLine lineNumber="4992"><span class="doxyHighlight">    MaxInterleaveCount = InterleaveCountLB;</span></CodeLine>
<Link id="l04993" /><CodeLine lineNumber="4993"></CodeLine>
<Link id="l04994" /><CodeLine lineNumber="4994"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InterleaveCountUB != InterleaveCountLB) &#123;</span></CodeLine>
<Link id="l04995" /><CodeLine lineNumber="4995"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TailTripCountUB =</span></CodeLine>
<Link id="l04996" /><CodeLine lineNumber="4996"><span class="doxyHighlight">          (AvailableTC % (EstimatedVF &#42; InterleaveCountUB));</span></CodeLine>
<Link id="l04997" /><CodeLine lineNumber="4997"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TailTripCountLB =</span></CodeLine>
<Link id="l04998" /><CodeLine lineNumber="4998"><span class="doxyHighlight">          (AvailableTC % (EstimatedVF &#42; InterleaveCountLB));</span></CodeLine>
<Link id="l04999" /><CodeLine lineNumber="4999"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If both produce same scalar tail, maximize the IC to do the same work</span></CodeLine>
<Link id="l05000" /><CodeLine lineNumber="5000"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// in fewer vector loop iterations</span></CodeLine>
<Link id="l05001" /><CodeLine lineNumber="5001"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (TailTripCountUB == TailTripCountLB)</span></CodeLine>
<Link id="l05002" /><CodeLine lineNumber="5002"><span class="doxyHighlight">        MaxInterleaveCount = InterleaveCountUB;</span></CodeLine>
<Link id="l05003" /><CodeLine lineNumber="5003"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05004" /><CodeLine lineNumber="5004"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BestKnownTC &amp;&amp; &#42;BestKnownTC &gt; 0) &#123;</span></CodeLine>
<Link id="l05005" /><CodeLine lineNumber="5005"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// At least one iteration must be scalar when this constraint holds. So the</span></CodeLine>
<Link id="l05006" /><CodeLine lineNumber="5006"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// maximum available iterations for interleaving is one less.</span></CodeLine>
<Link id="l05007" /><CodeLine lineNumber="5007"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AvailableTC = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a913ab9c8291000dd3a1c3739194b03e4">requiresScalarEpilogue</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>())</span></CodeLine>
<Link id="l05008" /><CodeLine lineNumber="5008"><span class="doxyHighlight">                               ? (&#42;BestKnownTC) - 1</span></CodeLine>
<Link id="l05009" /><CodeLine lineNumber="5009"><span class="doxyHighlight">                               : &#42;BestKnownTC;</span></CodeLine>
<Link id="l05010" /><CodeLine lineNumber="5010"></CodeLine>
<Link id="l05011" /><CodeLine lineNumber="5011"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If trip count is an estimated compile time constant, limit the</span></CodeLine>
<Link id="l05012" /><CodeLine lineNumber="5012"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// IC to be capped by the trip count divided by VF &#42; 2, such that the vector</span></CodeLine>
<Link id="l05013" /><CodeLine lineNumber="5013"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// loop runs at least twice to make interleaving seem profitable when there</span></CodeLine>
<Link id="l05014" /><CodeLine lineNumber="5014"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is an epilogue loop present. Since exact Trip count is not known we</span></CodeLine>
<Link id="l05015" /><CodeLine lineNumber="5015"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// choose to be conservative in our IC estimate.</span></CodeLine>
<Link id="l05016" /><CodeLine lineNumber="5016"><span class="doxyHighlight">    MaxInterleaveCount = <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">bit&#95;floor</a>(std::max(</span></CodeLine>
<Link id="l05017" /><CodeLine lineNumber="5017"><span class="doxyHighlight">        1u, std::min(AvailableTC / (EstimatedVF &#42; 2), MaxInterleaveCount)));</span></CodeLine>
<Link id="l05018" /><CodeLine lineNumber="5018"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05019" /><CodeLine lineNumber="5019"></CodeLine>
<Link id="l05020" /><CodeLine lineNumber="5020"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MaxInterleaveCount &gt; 0 &amp;&amp;</span></CodeLine>
<Link id="l05021" /><CodeLine lineNumber="5021"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Maximum interleave count must be greater than 0&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05022" /><CodeLine lineNumber="5022"></CodeLine>
<Link id="l05023" /><CodeLine lineNumber="5023"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Clamp the calculated IC to be between the 1 and the max interleave count</span></CodeLine>
<Link id="l05024" /><CodeLine lineNumber="5024"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that the target and trip count allows.</span></CodeLine>
<Link id="l05025" /><CodeLine lineNumber="5025"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IC &gt; MaxInterleaveCount)</span></CodeLine>
<Link id="l05026" /><CodeLine lineNumber="5026"><span class="doxyHighlight">    IC = MaxInterleaveCount;</span></CodeLine>
<Link id="l05027" /><CodeLine lineNumber="5027"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l05028" /><CodeLine lineNumber="5028"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Make sure IC is greater than 0</span></CodeLine>
<Link id="l05029" /><CodeLine lineNumber="5029"><span class="doxyHighlight">    IC = std::max(1u, IC);</span></CodeLine>
<Link id="l05030" /><CodeLine lineNumber="5030"></CodeLine>
<Link id="l05031" /><CodeLine lineNumber="5031"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IC &gt; 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Interleave count must be greater than 0.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05032" /><CodeLine lineNumber="5032"></CodeLine>
<Link id="l05033" /><CodeLine lineNumber="5033"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Interleave if we vectorized this loop and there is a reduction that could</span></CodeLine>
<Link id="l05034" /><CodeLine lineNumber="5034"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// benefit from interleaving.</span></CodeLine>
<Link id="l05035" /><CodeLine lineNumber="5035"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; HasReductions) &#123;</span></CodeLine>
<Link id="l05036" /><CodeLine lineNumber="5036"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Interleaving because of reductions.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05037" /><CodeLine lineNumber="5037"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IC;</span></CodeLine>
<Link id="l05038" /><CodeLine lineNumber="5038"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05039" /><CodeLine lineNumber="5039"></CodeLine>
<Link id="l05040" /><CodeLine lineNumber="5040"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For any scalar loop that either requires runtime checks or predication we</span></CodeLine>
<Link id="l05041" /><CodeLine lineNumber="5041"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// are better off leaving this to the unroller. Note that if we&#39;ve already</span></CodeLine>
<Link id="l05042" /><CodeLine lineNumber="5042"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorized the loop we will have done the runtime check and so interleaving</span></CodeLine>
<Link id="l05043" /><CodeLine lineNumber="5043"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// won&#39;t require further checks.</span></CodeLine>
<Link id="l05044" /><CodeLine lineNumber="5044"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ScalarInterleavingRequiresPredication =</span></CodeLine>
<Link id="l05045" /><CodeLine lineNumber="5045"><span class="doxyHighlight">      (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks(), &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l05046" /><CodeLine lineNumber="5046"><span class="doxyHighlight">         return Legal-&gt;blockNeedsPredication(BB);</span></CodeLine>
<Link id="l05047" /><CodeLine lineNumber="5047"><span class="doxyHighlight">       &#125;));</span></CodeLine>
<Link id="l05048" /><CodeLine lineNumber="5048"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ScalarInterleavingRequiresRuntimePointerCheck =</span></CodeLine>
<Link id="l05049" /><CodeLine lineNumber="5049"><span class="doxyHighlight">      (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getRuntimePointerChecking()-&gt;Need);</span></CodeLine>
<Link id="l05050" /><CodeLine lineNumber="5050"></CodeLine>
<Link id="l05051" /><CodeLine lineNumber="5051"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We want to interleave small loops in order to reduce the loop overhead and</span></CodeLine>
<Link id="l05052" /><CodeLine lineNumber="5052"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// potentially expose ILP opportunities.</span></CodeLine>
<Link id="l05053" /><CodeLine lineNumber="5053"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Loop cost is &quot;</span><span class="doxyHighlight"> &lt;&lt; LoopCost &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span></CodeLine>
<Link id="l05054" /><CodeLine lineNumber="5054"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: IC is &quot;</span><span class="doxyHighlight"> &lt;&lt; IC &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span></CodeLine>
<Link id="l05055" /><CodeLine lineNumber="5055"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: VF is &quot;</span><span class="doxyHighlight"> &lt;&lt; VF &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05056" /><CodeLine lineNumber="5056"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AggressivelyInterleaveReductions =</span></CodeLine>
<Link id="l05057" /><CodeLine lineNumber="5057"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.enableAggressiveInterleaving(HasReductions);</span></CodeLine>
<Link id="l05058" /><CodeLine lineNumber="5058"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ScalarInterleavingRequiresRuntimePointerCheck &amp;&amp;</span></CodeLine>
<Link id="l05059" /><CodeLine lineNumber="5059"><span class="doxyHighlight">      !ScalarInterleavingRequiresPredication &amp;&amp; LoopCost &lt; <a href="#a71899f6c73fcc8e2fc977dadc1fb1520">SmallLoopCost</a>) &#123;</span></CodeLine>
<Link id="l05060" /><CodeLine lineNumber="5060"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We assume that the cost overhead is 1 and we use the cost model</span></CodeLine>
<Link id="l05061" /><CodeLine lineNumber="5061"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// to estimate the cost of the loop and interleave until the cost of the</span></CodeLine>
<Link id="l05062" /><CodeLine lineNumber="5062"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// loop overhead is about 5% of the cost of the loop.</span></CodeLine>
<Link id="l05063" /><CodeLine lineNumber="5063"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SmallIC = std::min(IC, (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">)<a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">llvm::bit&#95;floor&lt;uint64&#95;t&gt;</a>(</span></CodeLine>
<Link id="l05064" /><CodeLine lineNumber="5064"><span class="doxyHighlight">                                        <a href="#a71899f6c73fcc8e2fc977dadc1fb1520">SmallLoopCost</a> / &#42;LoopCost.<a href="/docs/api/classes/llvm/instructioncost/#a9b642067999075ba996ecdee40b52b68">getValue</a>()));</span></CodeLine>
<Link id="l05065" /><CodeLine lineNumber="5065"></CodeLine>
<Link id="l05066" /><CodeLine lineNumber="5066"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Interleave until store/load ports (estimated by max interleave count) are</span></CodeLine>
<Link id="l05067" /><CodeLine lineNumber="5067"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// saturated.</span></CodeLine>
<Link id="l05068" /><CodeLine lineNumber="5068"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumStores = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getNumStores();</span></CodeLine>
<Link id="l05069" /><CodeLine lineNumber="5069"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumLoads = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getNumLoads();</span></CodeLine>
<Link id="l05070" /><CodeLine lineNumber="5070"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> StoresIC = IC / (NumStores ? NumStores : 1);</span></CodeLine>
<Link id="l05071" /><CodeLine lineNumber="5071"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> LoadsIC = IC / (NumLoads ? NumLoads : 1);</span></CodeLine>
<Link id="l05072" /><CodeLine lineNumber="5072"></CodeLine>
<Link id="l05073" /><CodeLine lineNumber="5073"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// There is little point in interleaving for reductions containing selects</span></CodeLine>
<Link id="l05074" /><CodeLine lineNumber="5074"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and compares when VF=1 since it may just create more overhead than it&#39;s</span></CodeLine>
<Link id="l05075" /><CodeLine lineNumber="5075"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// worth for loops with small trip counts. This is because we still have to</span></CodeLine>
<Link id="l05076" /><CodeLine lineNumber="5076"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// do the final reduction after the loop.</span></CodeLine>
<Link id="l05077" /><CodeLine lineNumber="5077"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasSelectCmpReductions =</span></CodeLine>
<Link id="l05078" /><CodeLine lineNumber="5078"><span class="doxyHighlight">        HasReductions &amp;&amp;</span></CodeLine>
<Link id="l05079" /><CodeLine lineNumber="5079"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars(), &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05080" /><CodeLine lineNumber="5080"><span class="doxyHighlight">          const RecurrenceDescriptor &amp;RdxDesc = Reduction.second;</span></CodeLine>
<Link id="l05081" /><CodeLine lineNumber="5081"><span class="doxyHighlight">          RecurKind RK = RdxDesc.getRecurrenceKind();</span></CodeLine>
<Link id="l05082" /><CodeLine lineNumber="5082"><span class="doxyHighlight">          return RecurrenceDescriptor::isAnyOfRecurrenceKind(RK) ||</span></CodeLine>
<Link id="l05083" /><CodeLine lineNumber="5083"><span class="doxyHighlight">                 RecurrenceDescriptor::isFindLastIVRecurrenceKind(RK);</span></CodeLine>
<Link id="l05084" /><CodeLine lineNumber="5084"><span class="doxyHighlight">        &#125;);</span></CodeLine>
<Link id="l05085" /><CodeLine lineNumber="5085"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasSelectCmpReductions) &#123;</span></CodeLine>
<Link id="l05086" /><CodeLine lineNumber="5086"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Not interleaving select-cmp reductions.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05087" /><CodeLine lineNumber="5087"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 1;</span></CodeLine>
<Link id="l05088" /><CodeLine lineNumber="5088"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05089" /><CodeLine lineNumber="5089"></CodeLine>
<Link id="l05090" /><CodeLine lineNumber="5090"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we have a scalar reduction (vector reductions are already dealt with</span></CodeLine>
<Link id="l05091" /><CodeLine lineNumber="5091"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// by this point), we can increase the critical path length if the loop</span></CodeLine>
<Link id="l05092" /><CodeLine lineNumber="5092"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// we&#39;re interleaving is inside another loop. For tree-wise reductions</span></CodeLine>
<Link id="l05093" /><CodeLine lineNumber="5093"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// set the limit to 2, and for ordered reductions it&#39;s best to disable</span></CodeLine>
<Link id="l05094" /><CodeLine lineNumber="5094"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// interleaving entirely.</span></CodeLine>
<Link id="l05095" /><CodeLine lineNumber="5095"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasReductions &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getLoopDepth() &gt; 1) &#123;</span></CodeLine>
<Link id="l05096" /><CodeLine lineNumber="5096"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasOrderedReductions =</span></CodeLine>
<Link id="l05097" /><CodeLine lineNumber="5097"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars(), &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05098" /><CodeLine lineNumber="5098"><span class="doxyHighlight">            const RecurrenceDescriptor &amp;RdxDesc = Reduction.second;</span></CodeLine>
<Link id="l05099" /><CodeLine lineNumber="5099"><span class="doxyHighlight">            return RdxDesc.isOrdered();</span></CodeLine>
<Link id="l05100" /><CodeLine lineNumber="5100"><span class="doxyHighlight">          &#125;);</span></CodeLine>
<Link id="l05101" /><CodeLine lineNumber="5101"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HasOrderedReductions) &#123;</span></CodeLine>
<Link id="l05102" /><CodeLine lineNumber="5102"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l05103" /><CodeLine lineNumber="5103"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Not interleaving scalar ordered reductions.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05104" /><CodeLine lineNumber="5104"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 1;</span></CodeLine>
<Link id="l05105" /><CodeLine lineNumber="5105"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05106" /><CodeLine lineNumber="5106"></CodeLine>
<Link id="l05107" /><CodeLine lineNumber="5107"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(<a href="#ae75965df4671fa34c6ffc5a6e404843a">MaxNestedScalarReductionIC</a>);</span></CodeLine>
<Link id="l05108" /><CodeLine lineNumber="5108"><span class="doxyHighlight">      SmallIC = std::min(SmallIC, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l05109" /><CodeLine lineNumber="5109"><span class="doxyHighlight">      StoresIC = std::min(StoresIC, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l05110" /><CodeLine lineNumber="5110"><span class="doxyHighlight">      LoadsIC = std::min(LoadsIC, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l05111" /><CodeLine lineNumber="5111"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05112" /><CodeLine lineNumber="5112"></CodeLine>
<Link id="l05113" /><CodeLine lineNumber="5113"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a99a396adb2c0f9fb93b7ff8ea8b2e2ef">EnableLoadStoreRuntimeInterleave</a> &amp;&amp;</span></CodeLine>
<Link id="l05114" /><CodeLine lineNumber="5114"><span class="doxyHighlight">        std::max(StoresIC, LoadsIC) &gt; SmallIC) &#123;</span></CodeLine>
<Link id="l05115" /><CodeLine lineNumber="5115"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l05116" /><CodeLine lineNumber="5116"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Interleaving to saturate store or load ports.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05117" /><CodeLine lineNumber="5117"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::max(StoresIC, LoadsIC);</span></CodeLine>
<Link id="l05118" /><CodeLine lineNumber="5118"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05119" /><CodeLine lineNumber="5119"></CodeLine>
<Link id="l05120" /><CodeLine lineNumber="5120"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If there are scalar reductions and TTI has enabled aggressive</span></CodeLine>
<Link id="l05121" /><CodeLine lineNumber="5121"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// interleaving for reductions, we will interleave to expose ILP.</span></CodeLine>
<Link id="l05122" /><CodeLine lineNumber="5122"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; AggressivelyInterleaveReductions) &#123;</span></CodeLine>
<Link id="l05123" /><CodeLine lineNumber="5123"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Interleaving to expose ILP.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05124" /><CodeLine lineNumber="5124"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Interleave no less than SmallIC but not as aggressive as the normal IC</span></CodeLine>
<Link id="l05125" /><CodeLine lineNumber="5125"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to satisfy the rare situation when resources are too limited.</span></CodeLine>
<Link id="l05126" /><CodeLine lineNumber="5126"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::max(IC / 2, SmallIC);</span></CodeLine>
<Link id="l05127" /><CodeLine lineNumber="5127"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05128" /><CodeLine lineNumber="5128"></CodeLine>
<Link id="l05129" /><CodeLine lineNumber="5129"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Interleaving to reduce branch cost.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05130" /><CodeLine lineNumber="5130"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> SmallIC;</span></CodeLine>
<Link id="l05131" /><CodeLine lineNumber="5131"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05132" /><CodeLine lineNumber="5132"></CodeLine>
<Link id="l05133" /><CodeLine lineNumber="5133"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Interleave if this is a large loop (small loops are already dealt with by</span></CodeLine>
<Link id="l05134" /><CodeLine lineNumber="5134"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// this point) that could benefit from interleaving.</span></CodeLine>
<Link id="l05135" /><CodeLine lineNumber="5135"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (AggressivelyInterleaveReductions) &#123;</span></CodeLine>
<Link id="l05136" /><CodeLine lineNumber="5136"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Interleaving to expose ILP.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05137" /><CodeLine lineNumber="5137"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> IC;</span></CodeLine>
<Link id="l05138" /><CodeLine lineNumber="5138"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05139" /><CodeLine lineNumber="5139"></CodeLine>
<Link id="l05140" /><CodeLine lineNumber="5140"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Not Interleaving.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05141" /><CodeLine lineNumber="5141"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 1;</span></CodeLine>
<Link id="l05142" /><CodeLine lineNumber="5142"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05143" /><CodeLine lineNumber="5143"></CodeLine>
<Link id="l05144" /><CodeLine lineNumber="5144"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;LoopVectorizationCostModel::RegisterUsage, 8&gt;</a></span></CodeLine>
<Link id="l05145" /><CodeLine lineNumber="5145" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91466f7a82e967ed765e6d876415a3b7"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91466f7a82e967ed765e6d876415a3b7">LoopVectorizationCostModel::calculateRegisterUsage</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ElementCount&gt;</a> VFs) &#123;</span></CodeLine>
<Link id="l05146" /><CodeLine lineNumber="5146"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This function calculates the register usage by measuring the highest number</span></CodeLine>
<Link id="l05147" /><CodeLine lineNumber="5147"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of values that are alive at a single location. Obviously, this is a very</span></CodeLine>
<Link id="l05148" /><CodeLine lineNumber="5148"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// rough estimation. We scan the loop in a topological order in order and</span></CodeLine>
<Link id="l05149" /><CodeLine lineNumber="5149"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// assign a number to each instruction. We use RPO to ensure that defs are</span></CodeLine>
<Link id="l05150" /><CodeLine lineNumber="5150"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// met before their users. We assume that each instruction that has in-loop</span></CodeLine>
<Link id="l05151" /><CodeLine lineNumber="5151"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// users starts an interval. We record every time that an in-loop value is</span></CodeLine>
<Link id="l05152" /><CodeLine lineNumber="5152"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// used, so we have a list of the first and last occurrences of each</span></CodeLine>
<Link id="l05153" /><CodeLine lineNumber="5153"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction. Next, we transpose this data structure into a multi map that</span></CodeLine>
<Link id="l05154" /><CodeLine lineNumber="5154"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// holds the list of intervals that &#42;end&#42; at a specific location. This multi</span></CodeLine>
<Link id="l05155" /><CodeLine lineNumber="5155"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// map allows us to perform a linear search. We scan the instructions linearly</span></CodeLine>
<Link id="l05156" /><CodeLine lineNumber="5156"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and record each time that a new interval starts, by placing it in a set.</span></CodeLine>
<Link id="l05157" /><CodeLine lineNumber="5157"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we find this value in the multi-map then we remove it from the set.</span></CodeLine>
<Link id="l05158" /><CodeLine lineNumber="5158"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The max register usage is the maximum size of the set.</span></CodeLine>
<Link id="l05159" /><CodeLine lineNumber="5159"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We also search for instructions that are defined outside the loop, but are</span></CodeLine>
<Link id="l05160" /><CodeLine lineNumber="5160"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// used inside the loop. We need this number separately from the max-interval</span></CodeLine>
<Link id="l05161" /><CodeLine lineNumber="5161"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// usage number because when we unroll, loop-invariant values do not take</span></CodeLine>
<Link id="l05162" /><CodeLine lineNumber="5162"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// more register.</span></CodeLine>
<Link id="l05163" /><CodeLine lineNumber="5163"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopblocksdfs">LoopBlocksDFS</a> DFS(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l05164" /><CodeLine lineNumber="5164"><span class="doxyHighlight">  DFS.<a href="/docs/api/classes/llvm/loopblocksdfs/#adc85a5f08fb0f5dc3e053975995c9d29">perform</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a>);</span></CodeLine>
<Link id="l05165" /><CodeLine lineNumber="5165"></CodeLine>
<Link id="l05166" /><CodeLine lineNumber="5166"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage">RegisterUsage</a> RU;</span></CodeLine>
<Link id="l05167" /><CodeLine lineNumber="5167"></CodeLine>
<Link id="l05168" /><CodeLine lineNumber="5168"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Each &#39;key&#39; in the map opens a new interval. The values</span></CodeLine>
<Link id="l05169" /><CodeLine lineNumber="5169"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the map are the index of the &#39;last seen&#39; usage of the</span></CodeLine>
<Link id="l05170" /><CodeLine lineNumber="5170"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction that is the key.</span></CodeLine>
<Link id="l05171" /><CodeLine lineNumber="5171"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight"><a href="/docs/api/classes/llvm/intervalmap">IntervalMap</a> = <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Instruction &#42;, unsigned, 16&gt;</a>;</span></CodeLine>
<Link id="l05172" /><CodeLine lineNumber="5172"></CodeLine>
<Link id="l05173" /><CodeLine lineNumber="5173"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Maps instruction to its index.</span></CodeLine>
<Link id="l05174" /><CodeLine lineNumber="5174"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 64&gt;</a> IdxToInstr;</span></CodeLine>
<Link id="l05175" /><CodeLine lineNumber="5175"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Marks the end of each interval.</span></CodeLine>
<Link id="l05176" /><CodeLine lineNumber="5176"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/intervalmap">IntervalMap</a> EndPoint;</span></CodeLine>
<Link id="l05177" /><CodeLine lineNumber="5177"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Saves the list of instruction indices that are used in the loop.</span></CodeLine>
<Link id="l05178" /><CodeLine lineNumber="5178"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 8&gt;</a> Ends;</span></CodeLine>
<Link id="l05179" /><CodeLine lineNumber="5179"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Saves the list of values that are used in the loop but are defined outside</span></CodeLine>
<Link id="l05180" /><CodeLine lineNumber="5180"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the loop (not including non-instruction values such as arguments and</span></CodeLine>
<Link id="l05181" /><CodeLine lineNumber="5181"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// constants).</span></CodeLine>
<Link id="l05182" /><CodeLine lineNumber="5182"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;Instruction &#42;, 8&gt;</a> LoopInvariants;</span></CodeLine>
<Link id="l05183" /><CodeLine lineNumber="5183"></CodeLine>
<Link id="l05184" /><CodeLine lineNumber="5184"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(DFS.<a href="/docs/api/classes/llvm/loopblocksdfs/#a003fe6215d300fc9720b1b056cdf4c23">beginRPO</a>(), DFS.<a href="/docs/api/classes/llvm/loopblocksdfs/#aeebda6b0288bea7cd706111624ca73f6">endRPO</a>())) &#123;</span></CodeLine>
<Link id="l05185" /><CodeLine lineNumber="5185"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB-&gt;instructionsWithoutDebug()) &#123;</span></CodeLine>
<Link id="l05186" /><CodeLine lineNumber="5186"><span class="doxyHighlight">      IdxToInstr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05187" /><CodeLine lineNumber="5187"></CodeLine>
<Link id="l05188" /><CodeLine lineNumber="5188"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Save the end location of each USE.</span></CodeLine>
<Link id="l05189" /><CodeLine lineNumber="5189"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands()) &#123;</span></CodeLine>
<Link id="l05190" /><CodeLine lineNumber="5190"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Instr = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l05191" /><CodeLine lineNumber="5191"></CodeLine>
<Link id="l05192" /><CodeLine lineNumber="5192"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Ignore non-instruction values such as arguments, constants, etc.</span></CodeLine>
<Link id="l05193" /><CodeLine lineNumber="5193"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// FIXME: Might need some motivation why these values are ignored. If</span></CodeLine>
<Link id="l05194" /><CodeLine lineNumber="5194"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// for example an argument is used inside the loop it will increase the</span></CodeLine>
<Link id="l05195" /><CodeLine lineNumber="5195"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// register pressure (so shouldn&#39;t we add it to LoopInvariants).</span></CodeLine>
<Link id="l05196" /><CodeLine lineNumber="5196"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Instr)</span></CodeLine>
<Link id="l05197" /><CodeLine lineNumber="5197"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05198" /><CodeLine lineNumber="5198"></CodeLine>
<Link id="l05199" /><CodeLine lineNumber="5199"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If this instruction is outside the loop then record it and continue.</span></CodeLine>
<Link id="l05200" /><CodeLine lineNumber="5200"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(Instr)) &#123;</span></CodeLine>
<Link id="l05201" /><CodeLine lineNumber="5201"><span class="doxyHighlight">          LoopInvariants.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Instr);</span></CodeLine>
<Link id="l05202" /><CodeLine lineNumber="5202"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05203" /><CodeLine lineNumber="5203"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05204" /><CodeLine lineNumber="5204"></CodeLine>
<Link id="l05205" /><CodeLine lineNumber="5205"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Overwrite previous end points.</span></CodeLine>
<Link id="l05206" /><CodeLine lineNumber="5206"><span class="doxyHighlight">        EndPoint&#91;Instr&#93; = IdxToInstr.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l05207" /><CodeLine lineNumber="5207"><span class="doxyHighlight">        Ends.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Instr);</span></CodeLine>
<Link id="l05208" /><CodeLine lineNumber="5208"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05209" /><CodeLine lineNumber="5209"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05210" /><CodeLine lineNumber="5210"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05211" /><CodeLine lineNumber="5211"></CodeLine>
<Link id="l05212" /><CodeLine lineNumber="5212"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Saves the list of intervals that end with the index in &#39;key&#39;.</span></CodeLine>
<Link id="l05213" /><CodeLine lineNumber="5213"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using </span><span class="doxyHighlight">InstrList = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 2&gt;</a>;</span></CodeLine>
<Link id="l05214" /><CodeLine lineNumber="5214"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;unsigned, InstrList, 16&gt;</a> TransposeEnds;</span></CodeLine>
<Link id="l05215" /><CodeLine lineNumber="5215"></CodeLine>
<Link id="l05216" /><CodeLine lineNumber="5216"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Transpose the EndPoints to a list of values that end at each index.</span></CodeLine>
<Link id="l05217" /><CodeLine lineNumber="5217"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/msf/mappedblockstream-cpp/#a4ab9bd667f674c16b2cee01ab8823644">Interval</a> : EndPoint)</span></CodeLine>
<Link id="l05218" /><CodeLine lineNumber="5218"><span class="doxyHighlight">    TransposeEnds&#91;<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/msf/mappedblockstream-cpp/#a4ab9bd667f674c16b2cee01ab8823644">Interval</a>.second&#93;.push&#95;back(<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/msf/mappedblockstream-cpp/#a4ab9bd667f674c16b2cee01ab8823644">Interval</a>.first);</span></CodeLine>
<Link id="l05219" /><CodeLine lineNumber="5219"></CodeLine>
<Link id="l05220" /><CodeLine lineNumber="5220"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 8&gt;</a> OpenIntervals;</span></CodeLine>
<Link id="l05221" /><CodeLine lineNumber="5221"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;RegisterUsage, 8&gt;</a> RUs(VFs.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</span></CodeLine>
<Link id="l05222" /><CodeLine lineNumber="5222"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SmallMapVector&lt;unsigned, unsigned, 4&gt;</a>, 8&gt; MaxUsages(VFs.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</span></CodeLine>
<Link id="l05223" /><CodeLine lineNumber="5223"></CodeLine>
<Link id="l05224" /><CodeLine lineNumber="5224"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV(REG): Calculating max register usage:\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05225" /><CodeLine lineNumber="5225"></CodeLine>
<Link id="l05226" /><CodeLine lineNumber="5226"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;TTICapture = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>;</span></CodeLine>
<Link id="l05227" /><CodeLine lineNumber="5227"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GetRegUsage = &#91;&amp;TTICapture&#93;(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) -&gt; </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05228" /><CodeLine lineNumber="5228"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ty-&gt;isTokenTy() || !<a href="/docs/api/classes/llvm/vectortype/#aa6a2194fc011669faabe43322d7c6c5f">VectorType::isValidElementType</a>(Ty) ||</span></CodeLine>
<Link id="l05229" /><CodeLine lineNumber="5229"><span class="doxyHighlight">        (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp;</span></CodeLine>
<Link id="l05230" /><CodeLine lineNumber="5230"><span class="doxyHighlight">         !TTICapture.isElementTypeLegalForScalableVector(Ty)))</span></CodeLine>
<Link id="l05231" /><CodeLine lineNumber="5231"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l05232" /><CodeLine lineNumber="5232"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> TTICapture.getRegUsageForType(<a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Ty, VF));</span></CodeLine>
<Link id="l05233" /><CodeLine lineNumber="5233"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l05234" /><CodeLine lineNumber="5234"></CodeLine>
<Link id="l05235" /><CodeLine lineNumber="5235"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> Idx = 0, Sz = IdxToInstr.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); Idx &lt; Sz; ++Idx) &#123;</span></CodeLine>
<Link id="l05236" /><CodeLine lineNumber="5236"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = IdxToInstr&#91;Idx&#93;;</span></CodeLine>
<Link id="l05237" /><CodeLine lineNumber="5237"></CodeLine>
<Link id="l05238" /><CodeLine lineNumber="5238"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Remove all of the instructions that end at this location.</span></CodeLine>
<Link id="l05239" /><CodeLine lineNumber="5239"><span class="doxyHighlight">    InstrList &amp;<a href="/docs/api/namespaces/llvm/#acefe92adee8725ad904c7c43649790e8a4ee29ca12c7d126654bd0e5275de6135">List</a> = TransposeEnds&#91;Idx&#93;;</span></CodeLine>
<Link id="l05240" /><CodeLine lineNumber="5240"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armlowoverheadloops-cpp/#a3bf42baf773b375802538951c88d8e12">ToRemove</a> : <a href="/docs/api/namespaces/llvm/#acefe92adee8725ad904c7c43649790e8a4ee29ca12c7d126654bd0e5275de6135">List</a>)</span></CodeLine>
<Link id="l05241" /><CodeLine lineNumber="5241"><span class="doxyHighlight">      OpenIntervals.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armlowoverheadloops-cpp/#a3bf42baf773b375802538951c88d8e12">ToRemove</a>);</span></CodeLine>
<Link id="l05242" /><CodeLine lineNumber="5242"></CodeLine>
<Link id="l05243" /><CodeLine lineNumber="5243"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ignore instructions that are never used within the loop.</span></CodeLine>
<Link id="l05244" /><CodeLine lineNumber="5244"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Ends.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l05245" /><CodeLine lineNumber="5245"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05246" /><CodeLine lineNumber="5246"></CodeLine>
<Link id="l05247" /><CodeLine lineNumber="5247"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip ignored values.</span></CodeLine>
<Link id="l05248" /><CodeLine lineNumber="5248"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>.count(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l05249" /><CodeLine lineNumber="5249"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05250" /><CodeLine lineNumber="5250"></CodeLine>
<Link id="l05251" /><CodeLine lineNumber="5251"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a12d2850f420726c4acb262b626e95b7d">collectInLoopReductions</a>();</span></CodeLine>
<Link id="l05252" /><CodeLine lineNumber="5252"></CodeLine>
<Link id="l05253" /><CodeLine lineNumber="5253"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For each VF find the maximum usage of registers.</span></CodeLine>
<Link id="l05254" /><CodeLine lineNumber="5254"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> J = 0, E = VFs.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); J &lt; E; ++J) &#123;</span></CodeLine>
<Link id="l05255" /><CodeLine lineNumber="5255"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Count the number of registers used, per register class, given all open</span></CodeLine>
<Link id="l05256" /><CodeLine lineNumber="5256"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// intervals.</span></CodeLine>
<Link id="l05257" /><CodeLine lineNumber="5257"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Note that elements in this SmallMapVector will be default constructed</span></CodeLine>
<Link id="l05258" /><CodeLine lineNumber="5258"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// as 0 So we can use &quot;RegUsage&#91;ClassID&#93; += n&quot; in the code below even if</span></CodeLine>
<Link id="l05259" /><CodeLine lineNumber="5259"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// there is no previous entry for ClassID.</span></CodeLine>
<Link id="l05260" /><CodeLine lineNumber="5260"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/smallmapvector">SmallMapVector&lt;unsigned, unsigned, 4&gt;</a> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06aefdc051657574f00e43b0fa1f87e7336">RegUsage</a>;</span></CodeLine>
<Link id="l05261" /><CodeLine lineNumber="5261"></CodeLine>
<Link id="l05262" /><CodeLine lineNumber="5262"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VFs&#91;J&#93;.isScalar()) &#123;</span></CodeLine>
<Link id="l05263" /><CodeLine lineNumber="5263"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Inst : OpenIntervals) &#123;</span></CodeLine>
<Link id="l05264" /><CodeLine lineNumber="5264"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ClassID =</span></CodeLine>
<Link id="l05265" /><CodeLine lineNumber="5265"><span class="doxyHighlight">              <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getRegisterClassForType(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, Inst-&gt;getType());</span></CodeLine>
<Link id="l05266" /><CodeLine lineNumber="5266"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// FIXME: The target might use more than one register for the type</span></CodeLine>
<Link id="l05267" /><CodeLine lineNumber="5267"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// even in the scalar case.</span></CodeLine>
<Link id="l05268" /><CodeLine lineNumber="5268"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06aefdc051657574f00e43b0fa1f87e7336">RegUsage</a>&#91;ClassID&#93; += 1;</span></CodeLine>
<Link id="l05269" /><CodeLine lineNumber="5269"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05270" /><CodeLine lineNumber="5270"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05271" /><CodeLine lineNumber="5271"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab4a3f06ac8f2aff57b864c2d8ace97d8">collectUniformsAndScalars</a>(VFs&#91;J&#93;);</span></CodeLine>
<Link id="l05272" /><CodeLine lineNumber="5272"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Inst : OpenIntervals) &#123;</span></CodeLine>
<Link id="l05273" /><CodeLine lineNumber="5273"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Skip ignored values for VF &gt; 1</span></CodeLine>
<Link id="l05274" /><CodeLine lineNumber="5274"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.count(Inst))</span></CodeLine>
<Link id="l05275" /><CodeLine lineNumber="5275"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05276" /><CodeLine lineNumber="5276"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(Inst, VFs&#91;J&#93;)) &#123;</span></CodeLine>
<Link id="l05277" /><CodeLine lineNumber="5277"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ClassID =</span></CodeLine>
<Link id="l05278" /><CodeLine lineNumber="5278"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getRegisterClassForType(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, Inst-&gt;getType());</span></CodeLine>
<Link id="l05279" /><CodeLine lineNumber="5279"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// FIXME: The target might use more than one register for the type</span></CodeLine>
<Link id="l05280" /><CodeLine lineNumber="5280"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// even in the scalar case.</span></CodeLine>
<Link id="l05281" /><CodeLine lineNumber="5281"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06aefdc051657574f00e43b0fa1f87e7336">RegUsage</a>&#91;ClassID&#93; += 1;</span></CodeLine>
<Link id="l05282" /><CodeLine lineNumber="5282"><span class="doxyHighlight">          &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05283" /><CodeLine lineNumber="5283"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ClassID =</span></CodeLine>
<Link id="l05284" /><CodeLine lineNumber="5284"><span class="doxyHighlight">                <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getRegisterClassForType(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, Inst-&gt;getType());</span></CodeLine>
<Link id="l05285" /><CodeLine lineNumber="5285"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06aefdc051657574f00e43b0fa1f87e7336">RegUsage</a>&#91;ClassID&#93; += GetRegUsage(Inst-&gt;getType(), VFs&#91;J&#93;);</span></CodeLine>
<Link id="l05286" /><CodeLine lineNumber="5286"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l05287" /><CodeLine lineNumber="5287"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05288" /><CodeLine lineNumber="5288"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05289" /><CodeLine lineNumber="5289"></CodeLine>
<Link id="l05290" /><CodeLine lineNumber="5290"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Pair : <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06aefdc051657574f00e43b0fa1f87e7336">RegUsage</a>) &#123;</span></CodeLine>
<Link id="l05291" /><CodeLine lineNumber="5291"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Entry = MaxUsages&#91;J&#93;&#91;Pair.first&#93;;</span></CodeLine>
<Link id="l05292" /><CodeLine lineNumber="5292"><span class="doxyHighlight">        Entry = std::max(Entry, Pair.second);</span></CodeLine>
<Link id="l05293" /><CodeLine lineNumber="5293"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05294" /><CodeLine lineNumber="5294"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05295" /><CodeLine lineNumber="5295"></CodeLine>
<Link id="l05296" /><CodeLine lineNumber="5296"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV(REG): At #&quot;</span><span class="doxyHighlight"> &lt;&lt; Idx &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; Interval # &quot;</span></CodeLine>
<Link id="l05297" /><CodeLine lineNumber="5297"><span class="doxyHighlight">                      &lt;&lt; OpenIntervals.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05298" /><CodeLine lineNumber="5298"></CodeLine>
<Link id="l05299" /><CodeLine lineNumber="5299"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add the current instruction to the list of open intervals.</span></CodeLine>
<Link id="l05300" /><CodeLine lineNumber="5300"><span class="doxyHighlight">    OpenIntervals.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05301" /><CodeLine lineNumber="5301"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05302" /><CodeLine lineNumber="5302"></CodeLine>
<Link id="l05303" /><CodeLine lineNumber="5303"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 0, End = VFs.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); Idx &lt; End; ++Idx) &#123;</span></CodeLine>
<Link id="l05304" /><CodeLine lineNumber="5304"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note that elements in this SmallMapVector will be default constructed</span></CodeLine>
<Link id="l05305" /><CodeLine lineNumber="5305"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// as 0 So we can use &quot;Invariant&#91;ClassID&#93; += n&quot; in the code below even if</span></CodeLine>
<Link id="l05306" /><CodeLine lineNumber="5306"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// there is no previous entry for ClassID.</span></CodeLine>
<Link id="l05307" /><CodeLine lineNumber="5307"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/smallmapvector">SmallMapVector&lt;unsigned, unsigned, 4&gt;</a> Invariant;</span></CodeLine>
<Link id="l05308" /><CodeLine lineNumber="5308"></CodeLine>
<Link id="l05309" /><CodeLine lineNumber="5309"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Inst : LoopInvariants) &#123;</span></CodeLine>
<Link id="l05310" /><CodeLine lineNumber="5310"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FIXME: The target might use more than one register for the type</span></CodeLine>
<Link id="l05311" /><CodeLine lineNumber="5311"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// even in the scalar case.</span></CodeLine>
<Link id="l05312" /><CodeLine lineNumber="5312"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsScalar = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(Inst-&gt;users(), &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</span></CodeLine>
<Link id="l05313" /><CodeLine lineNumber="5313"><span class="doxyHighlight">        auto &#42;I = cast&lt;Instruction&gt;(U);</span></CodeLine>
<Link id="l05314" /><CodeLine lineNumber="5314"><span class="doxyHighlight">        return TheLoop != LI-&gt;getLoopFor(I-&gt;getParent()) ||</span></CodeLine>
<Link id="l05315" /><CodeLine lineNumber="5315"><span class="doxyHighlight">               isScalarAfterVectorization(I, VFs&#91;Idx&#93;);</span></CodeLine>
<Link id="l05316" /><CodeLine lineNumber="5316"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l05317" /><CodeLine lineNumber="5317"></CodeLine>
<Link id="l05318" /><CodeLine lineNumber="5318"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF = IsScalar ? <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1) : VFs&#91;Idx&#93;;</span></CodeLine>
<Link id="l05319" /><CodeLine lineNumber="5319"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ClassID =</span></CodeLine>
<Link id="l05320" /><CodeLine lineNumber="5320"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getRegisterClassForType(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>(), Inst-&gt;getType());</span></CodeLine>
<Link id="l05321" /><CodeLine lineNumber="5321"><span class="doxyHighlight">      Invariant&#91;ClassID&#93; += GetRegUsage(Inst-&gt;getType(), VF);</span></CodeLine>
<Link id="l05322" /><CodeLine lineNumber="5322"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05323" /><CodeLine lineNumber="5323"></CodeLine>
<Link id="l05324" /><CodeLine lineNumber="5324"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l05325" /><CodeLine lineNumber="5325"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV(REG): VF = &quot;</span><span class="doxyHighlight"> &lt;&lt; VFs&#91;Idx&#93; &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05326" /><CodeLine lineNumber="5326"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV(REG): Found max usage: &quot;</span><span class="doxyHighlight"> &lt;&lt; MaxUsages&#91;Idx&#93;.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>()</span></CodeLine>
<Link id="l05327" /><CodeLine lineNumber="5327"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; item\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05328" /><CodeLine lineNumber="5328"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;pair : MaxUsages&#91;Idx&#93;) &#123;</span></CodeLine>
<Link id="l05329" /><CodeLine lineNumber="5329"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV(REG): RegisterClass: &quot;</span></CodeLine>
<Link id="l05330" /><CodeLine lineNumber="5330"><span class="doxyHighlight">               &lt;&lt; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getRegisterClassName(pair.first) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, &quot;</span><span class="doxyHighlight"> &lt;&lt; pair.second</span></CodeLine>
<Link id="l05331" /><CodeLine lineNumber="5331"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; registers\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05332" /><CodeLine lineNumber="5332"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05333" /><CodeLine lineNumber="5333"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV(REG): Found invariant usage: &quot;</span><span class="doxyHighlight"> &lt;&lt; Invariant.<a href="/docs/api/classes/llvm/mapvector/#acf4c09e1f30cdd4e0b5b1b8a236ead34">size</a>()</span></CodeLine>
<Link id="l05334" /><CodeLine lineNumber="5334"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; item\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05335" /><CodeLine lineNumber="5335"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;pair : Invariant) &#123;</span></CodeLine>
<Link id="l05336" /><CodeLine lineNumber="5336"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV(REG): RegisterClass: &quot;</span></CodeLine>
<Link id="l05337" /><CodeLine lineNumber="5337"><span class="doxyHighlight">               &lt;&lt; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getRegisterClassName(pair.first) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, &quot;</span><span class="doxyHighlight"> &lt;&lt; pair.second</span></CodeLine>
<Link id="l05338" /><CodeLine lineNumber="5338"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; registers\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05339" /><CodeLine lineNumber="5339"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05340" /><CodeLine lineNumber="5340"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l05341" /><CodeLine lineNumber="5341"></CodeLine>
<Link id="l05342" /><CodeLine lineNumber="5342"><span class="doxyHighlight">    RU.<a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage/#a12f1d225b87b9cb583e78478d9ef3b9c">LoopInvariantRegs</a> = Invariant;</span></CodeLine>
<Link id="l05343" /><CodeLine lineNumber="5343"><span class="doxyHighlight">    RU.<a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage/#a0ae3b197ca92417681a2865b605e56a9">MaxLocalUsers</a> = MaxUsages&#91;Idx&#93;;</span></CodeLine>
<Link id="l05344" /><CodeLine lineNumber="5344"><span class="doxyHighlight">    RUs&#91;Idx&#93; = RU;</span></CodeLine>
<Link id="l05345" /><CodeLine lineNumber="5345"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05346" /><CodeLine lineNumber="5346"></CodeLine>
<Link id="l05347" /><CodeLine lineNumber="5347"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RUs;</span></CodeLine>
<Link id="l05348" /><CodeLine lineNumber="5348"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05349" /><CodeLine lineNumber="5349"></CodeLine>
<Link id="l05350" /><CodeLine lineNumber="5350"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> LoopVectorizationCostModel::useEmulatedMaskMemRefHack(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l05351" /><CodeLine lineNumber="5351"><span class="doxyHighlight">                                                           <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l05352" /><CodeLine lineNumber="5352"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Cost model for emulated masked load/store is completely</span></CodeLine>
<Link id="l05353" /><CodeLine lineNumber="5353"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// broken. This hack guides the cost model to use an artificially</span></CodeLine>
<Link id="l05354" /><CodeLine lineNumber="5354"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// high enough value to practically disable vectorization with such</span></CodeLine>
<Link id="l05355" /><CodeLine lineNumber="5355"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// operations, except where previously deployed legality hack allowed</span></CodeLine>
<Link id="l05356" /><CodeLine lineNumber="5356"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// using very low cost values. This is to avoid regressions coming simply</span></CodeLine>
<Link id="l05357" /><CodeLine lineNumber="5357"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// from moving &quot;masked load/store&quot; check from legality to cost model.</span></CodeLine>
<Link id="l05358" /><CodeLine lineNumber="5358"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Masked Load/Gather emulation was previously never allowed.</span></CodeLine>
<Link id="l05359" /><CodeLine lineNumber="5359"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Limited number of Masked Store/Scatter emulation was allowed.</span></CodeLine>
<Link id="l05360" /><CodeLine lineNumber="5360"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">isPredicatedInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</span></CodeLine>
<Link id="l05361" /><CodeLine lineNumber="5361"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expecting a scalar emulated instruction&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05362" /><CodeLine lineNumber="5362"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l05363" /><CodeLine lineNumber="5363"><span class="doxyHighlight">         (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l05364" /><CodeLine lineNumber="5364"><span class="doxyHighlight">          NumPredStores &gt; <a href="#ae11c08aa35785a118bda788836cab423">NumberOfStoresToPredicate</a>);</span></CodeLine>
<Link id="l05365" /><CodeLine lineNumber="5365"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05366" /><CodeLine lineNumber="5366"></CodeLine>
<Link id="l05367" /><CodeLine lineNumber="5367" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#afcbf4a19be078644e784b539379d59b7"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#afcbf4a19be078644e784b539379d59b7">LoopVectorizationCostModel::collectInstsToScalarize</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l05368" /><CodeLine lineNumber="5368"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we aren&#39;t vectorizing the loop, or if we&#39;ve already collected the</span></CodeLine>
<Link id="l05369" /><CodeLine lineNumber="5369"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions to scalarize, there&#39;s nothing to do. Collection may already</span></CodeLine>
<Link id="l05370" /><CodeLine lineNumber="5370"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// have occurred if we have a user-selected VF and are now computing the</span></CodeLine>
<Link id="l05371" /><CodeLine lineNumber="5371"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// expected cost for interleaving.</span></CodeLine>
<Link id="l05372" /><CodeLine lineNumber="5372"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ad96fee81c3174ef427bf779d73fb1ef2">isZero</a>() || InstsToScalarize.contains(VF))</span></CodeLine>
<Link id="l05373" /><CodeLine lineNumber="5373"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05374" /><CodeLine lineNumber="5374"></CodeLine>
<Link id="l05375" /><CodeLine lineNumber="5375"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Initialize a mapping for VF in InstsToScalalarize. If we find that it&#39;s</span></CodeLine>
<Link id="l05376" /><CodeLine lineNumber="5376"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// not profitable to scalarize any instructions, the presence of VF in the</span></CodeLine>
<Link id="l05377" /><CodeLine lineNumber="5377"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// map will indicate that we&#39;ve analyzed it already.</span></CodeLine>
<Link id="l05378" /><CodeLine lineNumber="5378"><span class="doxyHighlight">  ScalarCostsTy &amp;ScalarCostsVF = InstsToScalarize&#91;VF&#93;;</span></CodeLine>
<Link id="l05379" /><CodeLine lineNumber="5379"></CodeLine>
<Link id="l05380" /><CodeLine lineNumber="5380"><span class="doxyHighlight">  PredicatedBBsAfterVectorization&#91;VF&#93;.clear();</span></CodeLine>
<Link id="l05381" /><CodeLine lineNumber="5381"></CodeLine>
<Link id="l05382" /><CodeLine lineNumber="5382"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find all the instructions that are scalar with predication in the loop and</span></CodeLine>
<Link id="l05383" /><CodeLine lineNumber="5383"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// determine if it would be better to not if-convert the blocks they are in.</span></CodeLine>
<Link id="l05384" /><CodeLine lineNumber="5384"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If so, we also record the instructions to scalarize.</span></CodeLine>
<Link id="l05385" /><CodeLine lineNumber="5385"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks()) &#123;</span></CodeLine>
<Link id="l05386" /><CodeLine lineNumber="5386"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8c8de8f62b5d2b27c4878d3effd7273">blockNeedsPredicationForAnyReason</a>(BB))</span></CodeLine>
<Link id="l05387" /><CodeLine lineNumber="5387"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05388" /><CodeLine lineNumber="5388"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB)</span></CodeLine>
<Link id="l05389" /><CodeLine lineNumber="5389"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8">isScalarWithPredication</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</span></CodeLine>
<Link id="l05390" /><CodeLine lineNumber="5390"><span class="doxyHighlight">        ScalarCostsTy ScalarCosts;</span></CodeLine>
<Link id="l05391" /><CodeLine lineNumber="5391"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Do not apply discount logic for:</span></CodeLine>
<Link id="l05392" /><CodeLine lineNumber="5392"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// 1 Scalars after vectorization, as there will only be a single copy</span></CodeLine>
<Link id="l05393" /><CodeLine lineNumber="5393"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// of the instruction.</span></CodeLine>
<Link id="l05394" /><CodeLine lineNumber="5394"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// 2 Scalable VF, as that would lead to invalid scalarization costs.</span></CodeLine>
<Link id="l05395" /><CodeLine lineNumber="5395"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// 3 Emulated masked memrefs, if a hacked cost is needed.</span></CodeLine>
<Link id="l05396" /><CodeLine lineNumber="5396"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) &amp;&amp; !VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp;</span></CodeLine>
<Link id="l05397" /><CodeLine lineNumber="5397"><span class="doxyHighlight">            !useEmulatedMaskMemRefHack(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) &amp;&amp;</span></CodeLine>
<Link id="l05398" /><CodeLine lineNumber="5398"><span class="doxyHighlight">            computePredInstDiscount(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ScalarCosts, VF) &gt;= 0) &#123;</span></CodeLine>
<Link id="l05399" /><CodeLine lineNumber="5399"><span class="doxyHighlight">          ScalarCostsVF.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(ScalarCosts.<a href="/docs/api/classes/llvm/densemapbase/#a50d461a887e200e704e5157d3b21514d">begin</a>(), ScalarCosts.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>());</span></CodeLine>
<Link id="l05400" /><CodeLine lineNumber="5400"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// Check if we decided to scalarize a call. If so, update the widening</span></CodeLine>
<Link id="l05401" /><CodeLine lineNumber="5401"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// decision of the call to CM&#95;Scalarize with the computed scalar cost.</span></CodeLine>
<Link id="l05402" /><CodeLine lineNumber="5402"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>&#93; : ScalarCosts) &#123;</span></CodeLine>
<Link id="l05403" /><CodeLine lineNumber="5403"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05404" /><CodeLine lineNumber="5404"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CI || !CallWideningDecisions.contains(&#123;CI, VF&#125;))</span></CodeLine>
<Link id="l05405" /><CodeLine lineNumber="5405"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05406" /><CodeLine lineNumber="5406"><span class="doxyHighlight">            CallWideningDecisions&#91;&#123;CI, VF&#125;&#93;.Kind = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>;</span></CodeLine>
<Link id="l05407" /><CodeLine lineNumber="5407"><span class="doxyHighlight">            CallWideningDecisions&#91;&#123;CI, VF&#125;&#93;.Cost = ScalarCosts&#91;CI&#93;;</span></CodeLine>
<Link id="l05408" /><CodeLine lineNumber="5408"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l05409" /><CodeLine lineNumber="5409"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05410" /><CodeLine lineNumber="5410"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Remember that BB will remain after vectorization.</span></CodeLine>
<Link id="l05411" /><CodeLine lineNumber="5411"><span class="doxyHighlight">        PredicatedBBsAfterVectorization&#91;VF&#93;.insert(BB);</span></CodeLine>
<Link id="l05412" /><CodeLine lineNumber="5412"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</span></CodeLine>
<Link id="l05413" /><CodeLine lineNumber="5413"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Pred-&gt;getSingleSuccessor() == BB)</span></CodeLine>
<Link id="l05414" /><CodeLine lineNumber="5414"><span class="doxyHighlight">            PredicatedBBsAfterVectorization&#91;VF&#93;.insert(Pred);</span></CodeLine>
<Link id="l05415" /><CodeLine lineNumber="5415"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05416" /><CodeLine lineNumber="5416"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05417" /><CodeLine lineNumber="5417"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05418" /><CodeLine lineNumber="5418"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05419" /><CodeLine lineNumber="5419"></CodeLine>
<Link id="l05420" /><CodeLine lineNumber="5420"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> LoopVectorizationCostModel::computePredInstDiscount(</span></CodeLine>
<Link id="l05421" /><CodeLine lineNumber="5421"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PredInst, ScalarCostsTy &amp;ScalarCosts, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l05422" /><CodeLine lineNumber="5422"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a20d7c96738b8f59692aec029895f8eb9">isUniformAfterVectorization</a>(PredInst, VF) &amp;&amp;</span></CodeLine>
<Link id="l05423" /><CodeLine lineNumber="5423"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Instruction marked uniform-after-vectorization will be predicated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05424" /><CodeLine lineNumber="5424"></CodeLine>
<Link id="l05425" /><CodeLine lineNumber="5425"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Initialize the discount to zero, meaning that the scalar version and the</span></CodeLine>
<Link id="l05426" /><CodeLine lineNumber="5426"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vector version cost the same.</span></CodeLine>
<Link id="l05427" /><CodeLine lineNumber="5427"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> Discount = 0;</span></CodeLine>
<Link id="l05428" /><CodeLine lineNumber="5428"></CodeLine>
<Link id="l05429" /><CodeLine lineNumber="5429"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Holds instructions to analyze. The instructions we visit are mapped in</span></CodeLine>
<Link id="l05430" /><CodeLine lineNumber="5430"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ScalarCosts. Those instructions are the ones that would be scalarized if</span></CodeLine>
<Link id="l05431" /><CodeLine lineNumber="5431"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we find that the scalar version costs less.</span></CodeLine>
<Link id="l05432" /><CodeLine lineNumber="5432"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 8&gt;</a> Worklist;</span></CodeLine>
<Link id="l05433" /><CodeLine lineNumber="5433"></CodeLine>
<Link id="l05434" /><CodeLine lineNumber="5434"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Returns true if the given instruction can be scalarized.</span></CodeLine>
<Link id="l05435" /><CodeLine lineNumber="5435"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CanBeScalarized = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05436" /><CodeLine lineNumber="5436"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We only attempt to scalarize instructions forming a single-use chain</span></CodeLine>
<Link id="l05437" /><CodeLine lineNumber="5437"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// from the original predicated block that would otherwise be vectorized.</span></CodeLine>
<Link id="l05438" /><CodeLine lineNumber="5438"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Although not strictly necessary, we give up on instructions we know will</span></CodeLine>
<Link id="l05439" /><CodeLine lineNumber="5439"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// already be scalar to avoid traversing chains that are unlikely to be</span></CodeLine>
<Link id="l05440" /><CodeLine lineNumber="5440"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// beneficial.</span></CodeLine>
<Link id="l05441" /><CodeLine lineNumber="5441"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse() || PredInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() ||</span></CodeLine>
<Link id="l05442" /><CodeLine lineNumber="5442"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</span></CodeLine>
<Link id="l05443" /><CodeLine lineNumber="5443"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05444" /><CodeLine lineNumber="5444"></CodeLine>
<Link id="l05445" /><CodeLine lineNumber="5445"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the instruction is scalar with predication, it will be analyzed</span></CodeLine>
<Link id="l05446" /><CodeLine lineNumber="5446"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// separately. We ignore it within the context of PredInst.</span></CodeLine>
<Link id="l05447" /><CodeLine lineNumber="5447"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8">isScalarWithPredication</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</span></CodeLine>
<Link id="l05448" /><CodeLine lineNumber="5448"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05449" /><CodeLine lineNumber="5449"></CodeLine>
<Link id="l05450" /><CodeLine lineNumber="5450"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If any of the instruction&#39;s operands are uniform after vectorization,</span></CodeLine>
<Link id="l05451" /><CodeLine lineNumber="5451"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the instruction cannot be scalarized. This prevents, for example, a</span></CodeLine>
<Link id="l05452" /><CodeLine lineNumber="5452"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// masked load from being scalarized.</span></CodeLine>
<Link id="l05453" /><CodeLine lineNumber="5453"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l05454" /><CodeLine lineNumber="5454"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We assume we will only emit a value for lane zero of an instruction</span></CodeLine>
<Link id="l05455" /><CodeLine lineNumber="5455"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// marked uniform after vectorization, rather than VF identical values.</span></CodeLine>
<Link id="l05456" /><CodeLine lineNumber="5456"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Thus, if we scalarize an instruction that uses a uniform, we would</span></CodeLine>
<Link id="l05457" /><CodeLine lineNumber="5457"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// create uses of values corresponding to the lanes we aren&#39;t emitting code</span></CodeLine>
<Link id="l05458" /><CodeLine lineNumber="5458"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for. This behavior can be changed by allowing getScalarValue to clone</span></CodeLine>
<Link id="l05459" /><CodeLine lineNumber="5459"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the lane zero values for uniforms rather than asserting.</span></CodeLine>
<Link id="l05460" /><CodeLine lineNumber="5460"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</span></CodeLine>
<Link id="l05461" /><CodeLine lineNumber="5461"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;J = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U.get()))</span></CodeLine>
<Link id="l05462" /><CodeLine lineNumber="5462"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a20d7c96738b8f59692aec029895f8eb9">isUniformAfterVectorization</a>(J, VF))</span></CodeLine>
<Link id="l05463" /><CodeLine lineNumber="5463"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05464" /><CodeLine lineNumber="5464"></CodeLine>
<Link id="l05465" /><CodeLine lineNumber="5465"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Otherwise, we can scalarize the instruction.</span></CodeLine>
<Link id="l05466" /><CodeLine lineNumber="5466"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05467" /><CodeLine lineNumber="5467"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l05468" /><CodeLine lineNumber="5468"></CodeLine>
<Link id="l05469" /><CodeLine lineNumber="5469"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute the expected cost discount from scalarizing the entire expression</span></CodeLine>
<Link id="l05470" /><CodeLine lineNumber="5470"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// feeding the predicated instruction. We currently only consider expressions</span></CodeLine>
<Link id="l05471" /><CodeLine lineNumber="5471"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that are single-use instruction chains.</span></CodeLine>
<Link id="l05472" /><CodeLine lineNumber="5472"><span class="doxyHighlight">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PredInst);</span></CodeLine>
<Link id="l05473" /><CodeLine lineNumber="5473"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l05474" /><CodeLine lineNumber="5474"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l05475" /><CodeLine lineNumber="5475"></CodeLine>
<Link id="l05476" /><CodeLine lineNumber="5476"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we&#39;ve already analyzed the instruction, there&#39;s nothing to do.</span></CodeLine>
<Link id="l05477" /><CodeLine lineNumber="5477"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ScalarCosts.contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l05478" /><CodeLine lineNumber="5478"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05479" /><CodeLine lineNumber="5479"></CodeLine>
<Link id="l05480" /><CodeLine lineNumber="5480"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compute the cost of the vector instruction. Note that this cost already</span></CodeLine>
<Link id="l05481" /><CodeLine lineNumber="5481"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// includes the scalarization overhead of the predicated instruction.</span></CodeLine>
<Link id="l05482" /><CodeLine lineNumber="5482"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> VectorCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a556ec90a0fa1e168a9f22db1deb1fee6">getInstructionCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l05483" /><CodeLine lineNumber="5483"></CodeLine>
<Link id="l05484" /><CodeLine lineNumber="5484"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compute the cost of the scalarized instruction. This cost is the cost of</span></CodeLine>
<Link id="l05485" /><CodeLine lineNumber="5485"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the instruction as if it wasn&#39;t if-converted and instead remained in the</span></CodeLine>
<Link id="l05486" /><CodeLine lineNumber="5486"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predicated block. We will scale this cost by block probability after</span></CodeLine>
<Link id="l05487" /><CodeLine lineNumber="5487"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// computing the scalarization overhead.</span></CodeLine>
<Link id="l05488" /><CodeLine lineNumber="5488"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarCost =</span></CodeLine>
<Link id="l05489" /><CodeLine lineNumber="5489"><span class="doxyHighlight">        VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>() &#42; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a556ec90a0fa1e168a9f22db1deb1fee6">getInstructionCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1));</span></CodeLine>
<Link id="l05490" /><CodeLine lineNumber="5490"></CodeLine>
<Link id="l05491" /><CodeLine lineNumber="5491"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compute the scalarization overhead of needed insertelement instructions</span></CodeLine>
<Link id="l05492" /><CodeLine lineNumber="5492"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and phi nodes.</span></CodeLine>
<Link id="l05493" /><CodeLine lineNumber="5493"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8">isScalarWithPredication</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) &amp;&amp; !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isVoidTy()) &#123;</span></CodeLine>
<Link id="l05494" /><CodeLine lineNumber="5494"><span class="doxyHighlight">      ScalarCost += <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getScalarizationOverhead(</span></CodeLine>
<Link id="l05495" /><CodeLine lineNumber="5495"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), VF)),</span></CodeLine>
<Link id="l05496" /><CodeLine lineNumber="5496"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>()), </span><span class="doxyHighlightComment">/&#42;Insert&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l05497" /><CodeLine lineNumber="5497"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">/&#42;Extract&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>);</span></CodeLine>
<Link id="l05498" /><CodeLine lineNumber="5498"><span class="doxyHighlight">      ScalarCost +=</span></CodeLine>
<Link id="l05499" /><CodeLine lineNumber="5499"><span class="doxyHighlight">          VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>() &#42; <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getCFInstrCost(Instruction::PHI, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>);</span></CodeLine>
<Link id="l05500" /><CodeLine lineNumber="5500"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05501" /><CodeLine lineNumber="5501"></CodeLine>
<Link id="l05502" /><CodeLine lineNumber="5502"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compute the scalarization overhead of needed extractelement</span></CodeLine>
<Link id="l05503" /><CodeLine lineNumber="5503"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instructions. For each of the instruction&#39;s operands, if the operand can</span></CodeLine>
<Link id="l05504" /><CodeLine lineNumber="5504"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// be scalarized, add it to the worklist; otherwise, account for the</span></CodeLine>
<Link id="l05505" /><CodeLine lineNumber="5505"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// overhead.</span></CodeLine>
<Link id="l05506" /><CodeLine lineNumber="5506"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Use &amp;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</span></CodeLine>
<Link id="l05507" /><CodeLine lineNumber="5507"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;J = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.get())) &#123;</span></CodeLine>
<Link id="l05508" /><CodeLine lineNumber="5508"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/vectortype/#aa6a2194fc011669faabe43322d7c6c5f">VectorType::isValidElementType</a>(J-&gt;getType()) &amp;&amp;</span></CodeLine>
<Link id="l05509" /><CodeLine lineNumber="5509"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;Instruction has non-scalar type&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05510" /><CodeLine lineNumber="5510"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CanBeScalarized(J))</span></CodeLine>
<Link id="l05511" /><CodeLine lineNumber="5511"><span class="doxyHighlight">          Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(J);</span></CodeLine>
<Link id="l05512" /><CodeLine lineNumber="5512"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (needsExtract(J, VF)) &#123;</span></CodeLine>
<Link id="l05513" /><CodeLine lineNumber="5513"><span class="doxyHighlight">          ScalarCost += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getScalarizationOverhead(</span></CodeLine>
<Link id="l05514" /><CodeLine lineNumber="5514"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(J-&gt;getType(), VF)),</span></CodeLine>
<Link id="l05515" /><CodeLine lineNumber="5515"><span class="doxyHighlight">              <a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>()), </span><span class="doxyHighlightComment">/&#42;Insert&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l05516" /><CodeLine lineNumber="5516"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">/&#42;Extract&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05517" /><CodeLine lineNumber="5517"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l05518" /><CodeLine lineNumber="5518"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05519" /><CodeLine lineNumber="5519"></CodeLine>
<Link id="l05520" /><CodeLine lineNumber="5520"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Scale the total scalar cost by block probability.</span></CodeLine>
<Link id="l05521" /><CodeLine lineNumber="5521"><span class="doxyHighlight">    ScalarCost /= <a href="/docs/api/namespaces/llvm/#adb5d7cdf62c5d24e421899cd74c4550d">getReciprocalPredBlockProb</a>();</span></CodeLine>
<Link id="l05522" /><CodeLine lineNumber="5522"></CodeLine>
<Link id="l05523" /><CodeLine lineNumber="5523"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Compute the discount. A non-negative discount means the vector version</span></CodeLine>
<Link id="l05524" /><CodeLine lineNumber="5524"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of the instruction costs more, and scalarizing would be beneficial.</span></CodeLine>
<Link id="l05525" /><CodeLine lineNumber="5525"><span class="doxyHighlight">    Discount += VectorCost - ScalarCost;</span></CodeLine>
<Link id="l05526" /><CodeLine lineNumber="5526"><span class="doxyHighlight">    ScalarCosts&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = ScalarCost;</span></CodeLine>
<Link id="l05527" /><CodeLine lineNumber="5527"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05528" /><CodeLine lineNumber="5528"></CodeLine>
<Link id="l05529" /><CodeLine lineNumber="5529"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Discount;</span></CodeLine>
<Link id="l05530" /><CodeLine lineNumber="5530"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05531" /><CodeLine lineNumber="5531"></CodeLine>
<Link id="l05532" /><CodeLine lineNumber="5532" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae4c50e6300599d50ba706c0d2b780502"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae4c50e6300599d50ba706c0d2b780502">LoopVectorizationCostModel::expectedCost</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l05533" /><CodeLine lineNumber="5533"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</span></CodeLine>
<Link id="l05534" /><CodeLine lineNumber="5534"></CodeLine>
<Link id="l05535" /><CodeLine lineNumber="5535"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the vector loop gets executed exactly once with the given VF, ignore the</span></CodeLine>
<Link id="l05536" /><CodeLine lineNumber="5536"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// costs of comparison and induction instructions, as they&#39;ll get simplified</span></CodeLine>
<Link id="l05537" /><CodeLine lineNumber="5537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// away.</span></CodeLine>
<Link id="l05538" /><CodeLine lineNumber="5538"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 2&gt;</a> ValuesToIgnoreForVF;</span></CodeLine>
<Link id="l05539" /><CodeLine lineNumber="5539"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> TC = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE()-&gt;getSmallConstantTripCount(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l05540" /><CodeLine lineNumber="5540"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#aab9a9b0568c1c524f01499c7930b3bf9">isFixed</a>() &amp;&amp; TC == VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>() &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba">foldTailByMasking</a>())</span></CodeLine>
<Link id="l05541" /><CodeLine lineNumber="5541"><span class="doxyHighlight">    <a href="#ababcaf6e2e00fc3fc8791ea2c3acbda5">addFullyUnrolledInstructionsToIgnore</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getInductionVars(),</span></CodeLine>
<Link id="l05542" /><CodeLine lineNumber="5542"><span class="doxyHighlight">                                         ValuesToIgnoreForVF);</span></CodeLine>
<Link id="l05543" /><CodeLine lineNumber="5543"></CodeLine>
<Link id="l05544" /><CodeLine lineNumber="5544"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For each block.</span></CodeLine>
<Link id="l05545" /><CodeLine lineNumber="5545"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks()) &#123;</span></CodeLine>
<Link id="l05546" /><CodeLine lineNumber="5546"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> BlockCost;</span></CodeLine>
<Link id="l05547" /><CodeLine lineNumber="5547"></CodeLine>
<Link id="l05548" /><CodeLine lineNumber="5548"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For each instruction in the old loop.</span></CodeLine>
<Link id="l05549" /><CodeLine lineNumber="5549"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB-&gt;instructionsWithoutDebug()) &#123;</span></CodeLine>
<Link id="l05550" /><CodeLine lineNumber="5550"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Skip ignored values.</span></CodeLine>
<Link id="l05551" /><CodeLine lineNumber="5551"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>.count(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || ValuesToIgnoreForVF.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l05552" /><CodeLine lineNumber="5552"><span class="doxyHighlight">          (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.count(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)))</span></CodeLine>
<Link id="l05553" /><CodeLine lineNumber="5553"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05554" /><CodeLine lineNumber="5554"></CodeLine>
<Link id="l05555" /><CodeLine lineNumber="5555"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a556ec90a0fa1e168a9f22db1deb1fee6">getInstructionCost</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l05556" /><CodeLine lineNumber="5556"></CodeLine>
<Link id="l05557" /><CodeLine lineNumber="5557"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check if we should override the cost.</span></CodeLine>
<Link id="l05558" /><CodeLine lineNumber="5558"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.isValid() &amp;&amp; <a href="#a5eae6074e6a1bb62e365ef65f3e26196">ForceTargetInstructionCost</a>.getNumOccurrences() &gt; 0)</span></CodeLine>
<Link id="l05559" /><CodeLine lineNumber="5559"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a>(<a href="#a5eae6074e6a1bb62e365ef65f3e26196">ForceTargetInstructionCost</a>);</span></CodeLine>
<Link id="l05560" /><CodeLine lineNumber="5560"></CodeLine>
<Link id="l05561" /><CodeLine lineNumber="5561"><span class="doxyHighlight">      BlockCost += <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</span></CodeLine>
<Link id="l05562" /><CodeLine lineNumber="5562"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found an estimated cost of &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; for VF &quot;</span></CodeLine>
<Link id="l05563" /><CodeLine lineNumber="5563"><span class="doxyHighlight">                        &lt;&lt; VF &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; For instruction: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05564" /><CodeLine lineNumber="5564"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05565" /><CodeLine lineNumber="5565"></CodeLine>
<Link id="l05566" /><CodeLine lineNumber="5566"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we are vectorizing a predicated block, it will have been</span></CodeLine>
<Link id="l05567" /><CodeLine lineNumber="5567"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// if-converted. This means that the block&#39;s instructions (aside from</span></CodeLine>
<Link id="l05568" /><CodeLine lineNumber="5568"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// stores and instructions that may divide by zero) will now be</span></CodeLine>
<Link id="l05569" /><CodeLine lineNumber="5569"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// unconditionally executed. For the scalar case, we may not always execute</span></CodeLine>
<Link id="l05570" /><CodeLine lineNumber="5570"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the predicated block, if it is an if-else block. Thus, scale the block&#39;s</span></CodeLine>
<Link id="l05571" /><CodeLine lineNumber="5571"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// cost by the probability of executing it. blockNeedsPredication from</span></CodeLine>
<Link id="l05572" /><CodeLine lineNumber="5572"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Legal is used so as to not include all blocks in tail folded loops.</span></CodeLine>
<Link id="l05573" /><CodeLine lineNumber="5573"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;blockNeedsPredication(BB))</span></CodeLine>
<Link id="l05574" /><CodeLine lineNumber="5574"><span class="doxyHighlight">      BlockCost /= <a href="/docs/api/namespaces/llvm/#adb5d7cdf62c5d24e421899cd74c4550d">getReciprocalPredBlockProb</a>();</span></CodeLine>
<Link id="l05575" /><CodeLine lineNumber="5575"></CodeLine>
<Link id="l05576" /><CodeLine lineNumber="5576"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += BlockCost;</span></CodeLine>
<Link id="l05577" /><CodeLine lineNumber="5577"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05578" /><CodeLine lineNumber="5578"></CodeLine>
<Link id="l05579" /><CodeLine lineNumber="5579"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</span></CodeLine>
<Link id="l05580" /><CodeLine lineNumber="5580"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05581" /><CodeLine lineNumber="5581"></CodeLine>
<Link id="l05582" /><CodeLine lineNumber="5582"><span class="doxyHighlightComment">/// Gets Address Access SCEV after verifying that the access pattern</span></CodeLine>
<Link id="l05583" /><CodeLine lineNumber="5583"><span class="doxyHighlightComment">/// is loop invariant except the induction variable dependence.</span></CodeLine>
<Link id="l05584" /><CodeLine lineNumber="5584"><span class="doxyHighlightComment">///</span></CodeLine>
<Link id="l05585" /><CodeLine lineNumber="5585"><span class="doxyHighlightComment">/// This SCEV can be sent to the Target in order to estimate the address</span></CodeLine>
<Link id="l05586" /><CodeLine lineNumber="5586"><span class="doxyHighlightComment">/// calculation cost.</span></CodeLine>
<Link id="l05587" /><CodeLine lineNumber="5587" lineLink="#ad27a81251d238dbfdc4d0253a64d6267"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="#ad27a81251d238dbfdc4d0253a64d6267">getAddressAccessSCEV</a>(</span></CodeLine>
<Link id="l05588" /><CodeLine lineNumber="5588"><span class="doxyHighlight">              <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>,</span></CodeLine>
<Link id="l05589" /><CodeLine lineNumber="5589"><span class="doxyHighlight">              <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;<a href="/docs/api/namespaces/llvm/irsimilarity/#af46430106334db52bfa7a4107e53a0bda8f7357506e00d8cd0694f948f909865d">Legal</a>,</span></CodeLine>
<Link id="l05590" /><CodeLine lineNumber="5590"><span class="doxyHighlight">              <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;PSE,</span></CodeLine>
<Link id="l05591" /><CodeLine lineNumber="5591"><span class="doxyHighlight">              </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;TheLoop) &#123;</span></CodeLine>
<Link id="l05592" /><CodeLine lineNumber="5592"></CodeLine>
<Link id="l05593" /><CodeLine lineNumber="5593"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Gep = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</span></CodeLine>
<Link id="l05594" /><CodeLine lineNumber="5594"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Gep)</span></CodeLine>
<Link id="l05595" /><CodeLine lineNumber="5595"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05596" /><CodeLine lineNumber="5596"></CodeLine>
<Link id="l05597" /><CodeLine lineNumber="5597"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We are looking for a gep with all loop invariant indices except for one</span></CodeLine>
<Link id="l05598" /><CodeLine lineNumber="5598"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which should be an induction variable.</span></CodeLine>
<Link id="l05599" /><CodeLine lineNumber="5599"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SE = PSE.<a href="/docs/api/classes/llvm/predicatedscalarevolution/#a10ca5eacc61b5669880de2f8b0cff33c">getSE</a>();</span></CodeLine>
<Link id="l05600" /><CodeLine lineNumber="5600"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumOperands = Gep-&gt;getNumOperands();</span></CodeLine>
<Link id="l05601" /><CodeLine lineNumber="5601"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Idx = 1; Idx &lt; NumOperands; ++Idx) &#123;</span></CodeLine>
<Link id="l05602" /><CodeLine lineNumber="5602"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opd = Gep-&gt;getOperand(Idx);</span></CodeLine>
<Link id="l05603" /><CodeLine lineNumber="5603"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SE-&gt;isLoopInvariant(SE-&gt;getSCEV(Opd), TheLoop) &amp;&amp;</span></CodeLine>
<Link id="l05604" /><CodeLine lineNumber="5604"><span class="doxyHighlight">        !<a href="/docs/api/namespaces/llvm/irsimilarity/#af46430106334db52bfa7a4107e53a0bda8f7357506e00d8cd0694f948f909865d">Legal</a>-&gt;isInductionVariable(Opd))</span></CodeLine>
<Link id="l05605" /><CodeLine lineNumber="5605"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l05606" /><CodeLine lineNumber="5606"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05607" /><CodeLine lineNumber="5607"></CodeLine>
<Link id="l05608" /><CodeLine lineNumber="5608"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now we know we have a GEP ptr, %inv, %ind, %inv. return the Ptr SCEV.</span></CodeLine>
<Link id="l05609" /><CodeLine lineNumber="5609"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PSE.<a href="/docs/api/classes/llvm/predicatedscalarevolution/#ae0994d8207b94ad22ecebc1a6bc580f1">getSCEV</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</span></CodeLine>
<Link id="l05610" /><CodeLine lineNumber="5610"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05611" /><CodeLine lineNumber="5611"></CodeLine>
<Link id="l05612" /><CodeLine lineNumber="5612"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></span></CodeLine>
<Link id="l05613" /><CodeLine lineNumber="5613"><span class="doxyHighlight">LoopVectorizationCostModel::getMemInstScalarizationCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l05614" /><CodeLine lineNumber="5614"><span class="doxyHighlight">                                                        <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l05615" /><CodeLine lineNumber="5615"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp;</span></CodeLine>
<Link id="l05616" /><CodeLine lineNumber="5616"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Scalarization cost of instruction implies vectorization.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05617" /><CodeLine lineNumber="5617"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</span></CodeLine>
<Link id="l05618" /><CodeLine lineNumber="5618"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l05619" /><CodeLine lineNumber="5619"></CodeLine>
<Link id="l05620" /><CodeLine lineNumber="5620"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ValTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05621" /><CodeLine lineNumber="5621"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SE = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE();</span></CodeLine>
<Link id="l05622" /><CodeLine lineNumber="5622"></CodeLine>
<Link id="l05623" /><CodeLine lineNumber="5623"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = <a href="/docs/api/namespaces/llvm/#a0d97f0780a320d53641729a2d8371b74">getLoadStoreAddressSpace</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05624" /><CodeLine lineNumber="5624"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05625" /><CodeLine lineNumber="5625"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PtrTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType(), VF);</span></CodeLine>
<Link id="l05626" /><CodeLine lineNumber="5626"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// NOTE: PtrTy is a vector to signal &#96;TTI::getAddressComputationCost&#96;</span></CodeLine>
<Link id="l05627" /><CodeLine lineNumber="5627"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//       that it is being called from this specific place.</span></CodeLine>
<Link id="l05628" /><CodeLine lineNumber="5628"></CodeLine>
<Link id="l05629" /><CodeLine lineNumber="5629"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Figure out whether the access is strided and get the stride value</span></CodeLine>
<Link id="l05630" /><CodeLine lineNumber="5630"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// if it&#39;s known in compile time</span></CodeLine>
<Link id="l05631" /><CodeLine lineNumber="5631"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV &#42;PtrSCEV = <a href="#ad27a81251d238dbfdc4d0253a64d6267">getAddressAccessSCEV</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l05632" /><CodeLine lineNumber="5632"></CodeLine>
<Link id="l05633" /><CodeLine lineNumber="5633"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the cost of the scalar memory instruction and address computation.</span></CodeLine>
<Link id="l05634" /><CodeLine lineNumber="5634"><span class="doxyHighlight">  InstructionCost <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> =</span></CodeLine>
<Link id="l05635" /><CodeLine lineNumber="5635"><span class="doxyHighlight">      VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getAddressComputationCost(PtrTy, SE, PtrSCEV);</span></CodeLine>
<Link id="l05636" /><CodeLine lineNumber="5636"></CodeLine>
<Link id="l05637" /><CodeLine lineNumber="5637"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t pass &#42;I here, since it is scalar but will actually be part of a</span></CodeLine>
<Link id="l05638" /><CodeLine lineNumber="5638"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorized loop where the user of it is a vectorized instruction.</span></CodeLine>
<Link id="l05639" /><CodeLine lineNumber="5639"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05640" /><CodeLine lineNumber="5640"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMemoryOpCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(),</span></CodeLine>
<Link id="l05641" /><CodeLine lineNumber="5641"><span class="doxyHighlight">                                                      ValTy-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>(),</span></CodeLine>
<Link id="l05642" /><CodeLine lineNumber="5642"><span class="doxyHighlight">                                                      Alignment, AS, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05643" /><CodeLine lineNumber="5643"></CodeLine>
<Link id="l05644" /><CodeLine lineNumber="5644"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the overhead of the extractelement and insertelement instructions</span></CodeLine>
<Link id="l05645" /><CodeLine lineNumber="5645"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we might create due to scalarization.</span></CodeLine>
<Link id="l05646" /><CodeLine lineNumber="5646"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += getScalarizationOverhead(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l05647" /><CodeLine lineNumber="5647"></CodeLine>
<Link id="l05648" /><CodeLine lineNumber="5648"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we have a predicated load/store, it will need extra i1 extracts and</span></CodeLine>
<Link id="l05649" /><CodeLine lineNumber="5649"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// conditional branches, but may not be executed for each vector lane. Scale</span></CodeLine>
<Link id="l05650" /><CodeLine lineNumber="5650"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the cost by the probability of executing the predicated block.</span></CodeLine>
<Link id="l05651" /><CodeLine lineNumber="5651"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">isPredicatedInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l05652" /><CodeLine lineNumber="5652"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> /= <a href="/docs/api/namespaces/llvm/#adb5d7cdf62c5d24e421899cd74c4550d">getReciprocalPredBlockProb</a>();</span></CodeLine>
<Link id="l05653" /><CodeLine lineNumber="5653"></CodeLine>
<Link id="l05654" /><CodeLine lineNumber="5654"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add the cost of an i1 extract and a branch</span></CodeLine>
<Link id="l05655" /><CodeLine lineNumber="5655"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VecI1Ty =</span></CodeLine>
<Link id="l05656" /><CodeLine lineNumber="5656"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">IntegerType::getInt1Ty</a>(ValTy-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>()), VF);</span></CodeLine>
<Link id="l05657" /><CodeLine lineNumber="5657"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getScalarizationOverhead(</span></CodeLine>
<Link id="l05658" /><CodeLine lineNumber="5658"><span class="doxyHighlight">        VecI1Ty, <a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>()),</span></CodeLine>
<Link id="l05659" /><CodeLine lineNumber="5659"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;Insert=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;Extract=&#42;/</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05660" /><CodeLine lineNumber="5660"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCFInstrCost(Instruction::Br, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05661" /><CodeLine lineNumber="5661"></CodeLine>
<Link id="l05662" /><CodeLine lineNumber="5662"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (useEmulatedMaskMemRefHack(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</span></CodeLine>
<Link id="l05663" /><CodeLine lineNumber="5663"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Artificially setting to a high enough value to practically disable</span></CodeLine>
<Link id="l05664" /><CodeLine lineNumber="5664"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// vectorization with such operations.</span></CodeLine>
<Link id="l05665" /><CodeLine lineNumber="5665"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = 3000000;</span></CodeLine>
<Link id="l05666" /><CodeLine lineNumber="5666"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05667" /><CodeLine lineNumber="5667"></CodeLine>
<Link id="l05668" /><CodeLine lineNumber="5668"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</span></CodeLine>
<Link id="l05669" /><CodeLine lineNumber="5669"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05670" /><CodeLine lineNumber="5670"></CodeLine>
<Link id="l05671" /><CodeLine lineNumber="5671"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></span></CodeLine>
<Link id="l05672" /><CodeLine lineNumber="5672"><span class="doxyHighlight">LoopVectorizationCostModel::getConsecutiveMemOpCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l05673" /><CodeLine lineNumber="5673"><span class="doxyHighlight">                                                    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l05674" /><CodeLine lineNumber="5674"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ValTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05675" /><CodeLine lineNumber="5675"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VectorTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ValTy, VF));</span></CodeLine>
<Link id="l05676" /><CodeLine lineNumber="5676"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05677" /><CodeLine lineNumber="5677"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = <a href="/docs/api/namespaces/llvm/#a0d97f0780a320d53641729a2d8371b74">getLoadStoreAddressSpace</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05678" /><CodeLine lineNumber="5678"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> ConsecutiveStride = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isConsecutivePtr(ValTy, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</span></CodeLine>
<Link id="l05679" /><CodeLine lineNumber="5679"></CodeLine>
<Link id="l05680" /><CodeLine lineNumber="5680"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((ConsecutiveStride == 1 || ConsecutiveStride == -1) &amp;&amp;</span></CodeLine>
<Link id="l05681" /><CodeLine lineNumber="5681"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Stride should be 1 or -1 for consecutive memory access&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05682" /><CodeLine lineNumber="5682"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05683" /><CodeLine lineNumber="5683"><span class="doxyHighlight">  InstructionCost <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = 0;</span></CodeLine>
<Link id="l05684" /><CodeLine lineNumber="5684"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l05685" /><CodeLine lineNumber="5685"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMaskedMemoryOpCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, Alignment, AS,</span></CodeLine>
<Link id="l05686" /><CodeLine lineNumber="5686"><span class="doxyHighlight">                                      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05687" /><CodeLine lineNumber="5687"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05688" /><CodeLine lineNumber="5688"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/targettransforminfo/operandvalueinfo">TTI::OperandValueInfo</a> OpInfo = <a href="/docs/api/classes/llvm/targettransforminfo/#a5fecba95c1ba20950ea8e2139127e621">TTI::getOperandInfo</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</span></CodeLine>
<Link id="l05689" /><CodeLine lineNumber="5689"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMemoryOpCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, Alignment, AS,</span></CodeLine>
<Link id="l05690" /><CodeLine lineNumber="5690"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, OpInfo, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05691" /><CodeLine lineNumber="5691"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05692" /><CodeLine lineNumber="5692"></CodeLine>
<Link id="l05693" /><CodeLine lineNumber="5693"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a1200affbcdb869bf32076f90ad9d0eafa67f115c1fddc4ce1aeb1c754001585bc">Reverse</a> = ConsecutiveStride &lt; 0;</span></CodeLine>
<Link id="l05694" /><CodeLine lineNumber="5694"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a1200affbcdb869bf32076f90ad9d0eafa67f115c1fddc4ce1aeb1c754001585bc">Reverse</a>)</span></CodeLine>
<Link id="l05695" /><CodeLine lineNumber="5695"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getShuffleCost(<a href="/docs/api/classes/llvm/targettransforminfo/#af46433d0e36d3f80afc3a8c67b5c53ecaea788d98147161f25d5adc3ec6ce7e1f">TargetTransformInfo::SK&#95;Reverse</a>, VectorTy, &#123;&#125;,</span></CodeLine>
<Link id="l05696" /><CodeLine lineNumber="5696"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, 0);</span></CodeLine>
<Link id="l05697" /><CodeLine lineNumber="5697"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</span></CodeLine>
<Link id="l05698" /><CodeLine lineNumber="5698"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05699" /><CodeLine lineNumber="5699"></CodeLine>
<Link id="l05700" /><CodeLine lineNumber="5700"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></span></CodeLine>
<Link id="l05701" /><CodeLine lineNumber="5701"><span class="doxyHighlight">LoopVectorizationCostModel::getUniformMemOpCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l05702" /><CodeLine lineNumber="5702"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l05703" /><CodeLine lineNumber="5703"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isUniformMemOp(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF));</span></CodeLine>
<Link id="l05704" /><CodeLine lineNumber="5704"></CodeLine>
<Link id="l05705" /><CodeLine lineNumber="5705"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ValTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05706" /><CodeLine lineNumber="5706"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VectorTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ValTy, VF));</span></CodeLine>
<Link id="l05707" /><CodeLine lineNumber="5707"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05708" /><CodeLine lineNumber="5708"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = <a href="/docs/api/namespaces/llvm/#a0d97f0780a320d53641729a2d8371b74">getLoadStoreAddressSpace</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05709" /><CodeLine lineNumber="5709"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l05710" /><CodeLine lineNumber="5710"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getAddressComputationCost(ValTy) +</span></CodeLine>
<Link id="l05711" /><CodeLine lineNumber="5711"><span class="doxyHighlight">           <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMemoryOpCost(Instruction::Load, ValTy, Alignment, AS,</span></CodeLine>
<Link id="l05712" /><CodeLine lineNumber="5712"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>) +</span></CodeLine>
<Link id="l05713" /><CodeLine lineNumber="5713"><span class="doxyHighlight">           <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getShuffleCost(<a href="/docs/api/classes/llvm/targettransforminfo/#af46433d0e36d3f80afc3a8c67b5c53ecab1ac8982cdb119f39a5fe74610a46796">TargetTransformInfo::SK&#95;Broadcast</a>, VectorTy, &#123;&#125;,</span></CodeLine>
<Link id="l05714" /><CodeLine lineNumber="5714"><span class="doxyHighlight">                              <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05715" /><CodeLine lineNumber="5715"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05716" /><CodeLine lineNumber="5716"><span class="doxyHighlight">  StoreInst &#42;<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05717" /><CodeLine lineNumber="5717"></CodeLine>
<Link id="l05718" /><CodeLine lineNumber="5718"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsLoopInvariantStoreValue = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInvariant(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getValueOperand());</span></CodeLine>
<Link id="l05719" /><CodeLine lineNumber="5719"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getAddressComputationCost(ValTy) +</span></CodeLine>
<Link id="l05720" /><CodeLine lineNumber="5720"><span class="doxyHighlight">         <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMemoryOpCost(Instruction::Store, ValTy, Alignment, AS,</span></CodeLine>
<Link id="l05721" /><CodeLine lineNumber="5721"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>) +</span></CodeLine>
<Link id="l05722" /><CodeLine lineNumber="5722"><span class="doxyHighlight">         (IsLoopInvariantStoreValue</span></CodeLine>
<Link id="l05723" /><CodeLine lineNumber="5723"><span class="doxyHighlight">              ? 0</span></CodeLine>
<Link id="l05724" /><CodeLine lineNumber="5724"><span class="doxyHighlight">              : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getVectorInstrCost(Instruction::ExtractElement, VectorTy,</span></CodeLine>
<Link id="l05725" /><CodeLine lineNumber="5725"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() - 1));</span></CodeLine>
<Link id="l05726" /><CodeLine lineNumber="5726"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05727" /><CodeLine lineNumber="5727"></CodeLine>
<Link id="l05728" /><CodeLine lineNumber="5728"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></span></CodeLine>
<Link id="l05729" /><CodeLine lineNumber="5729"><span class="doxyHighlight">LoopVectorizationCostModel::getGatherScatterCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l05730" /><CodeLine lineNumber="5730"><span class="doxyHighlight">                                                 <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l05731" /><CodeLine lineNumber="5731"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ValTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05732" /><CodeLine lineNumber="5732"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VectorTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ValTy, VF));</span></CodeLine>
<Link id="l05733" /><CodeLine lineNumber="5733"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05734" /><CodeLine lineNumber="5734"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05735" /><CodeLine lineNumber="5735"></CodeLine>
<Link id="l05736" /><CodeLine lineNumber="5736"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getAddressComputationCost(VectorTy) +</span></CodeLine>
<Link id="l05737" /><CodeLine lineNumber="5737"><span class="doxyHighlight">         <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getGatherScatterOpCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>,</span></CodeLine>
<Link id="l05738" /><CodeLine lineNumber="5738"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), Alignment,</span></CodeLine>
<Link id="l05739" /><CodeLine lineNumber="5739"><span class="doxyHighlight">                                    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05740" /><CodeLine lineNumber="5740"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05741" /><CodeLine lineNumber="5741"></CodeLine>
<Link id="l05742" /><CodeLine lineNumber="5742"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></span></CodeLine>
<Link id="l05743" /><CodeLine lineNumber="5743"><span class="doxyHighlight">LoopVectorizationCostModel::getInterleaveGroupCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l05744" /><CodeLine lineNumber="5744"><span class="doxyHighlight">                                                   <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l05745" /><CodeLine lineNumber="5745"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Group = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c">getInterleavedAccessGroup</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05746" /><CodeLine lineNumber="5746"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Group &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Fail to get an interleaved access group.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05747" /><CodeLine lineNumber="5747"></CodeLine>
<Link id="l05748" /><CodeLine lineNumber="5748"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;InsertPos = Group-&gt;getInsertPos();</span></CodeLine>
<Link id="l05749" /><CodeLine lineNumber="5749"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ValTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(InsertPos);</span></CodeLine>
<Link id="l05750" /><CodeLine lineNumber="5750"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VectorTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ValTy, VF));</span></CodeLine>
<Link id="l05751" /><CodeLine lineNumber="5751"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = <a href="/docs/api/namespaces/llvm/#a0d97f0780a320d53641729a2d8371b74">getLoadStoreAddressSpace</a>(InsertPos);</span></CodeLine>
<Link id="l05752" /><CodeLine lineNumber="5752"></CodeLine>
<Link id="l05753" /><CodeLine lineNumber="5753"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> InterleaveFactor = Group-&gt;getFactor();</span></CodeLine>
<Link id="l05754" /><CodeLine lineNumber="5754"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WideVecTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(ValTy, VF &#42; InterleaveFactor);</span></CodeLine>
<Link id="l05755" /><CodeLine lineNumber="5755"></CodeLine>
<Link id="l05756" /><CodeLine lineNumber="5756"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Holds the indices of existing members in the interleaved group.</span></CodeLine>
<Link id="l05757" /><CodeLine lineNumber="5757"><span class="doxyHighlight">  SmallVector&lt;unsigned, 4&gt; Indices;</span></CodeLine>
<Link id="l05758" /><CodeLine lineNumber="5758"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IF = 0; <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eac5f4a93ee302ab324b2d6be4da7d1995">IF</a> &lt; InterleaveFactor; <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eac5f4a93ee302ab324b2d6be4da7d1995">IF</a>++)</span></CodeLine>
<Link id="l05759" /><CodeLine lineNumber="5759"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Group-&gt;getMember(IF))</span></CodeLine>
<Link id="l05760" /><CodeLine lineNumber="5760"><span class="doxyHighlight">      Indices.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(IF);</span></CodeLine>
<Link id="l05761" /><CodeLine lineNumber="5761"></CodeLine>
<Link id="l05762" /><CodeLine lineNumber="5762"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Calculate the cost of the whole interleaved group.</span></CodeLine>
<Link id="l05763" /><CodeLine lineNumber="5763"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseMaskForGaps =</span></CodeLine>
<Link id="l05764" /><CodeLine lineNumber="5764"><span class="doxyHighlight">      (Group-&gt;requiresScalarEpilogue() &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af67062c22dbf5e0ab35164a778768476">isScalarEpilogueAllowed</a>()) ||</span></CodeLine>
<Link id="l05765" /><CodeLine lineNumber="5765"><span class="doxyHighlight">      (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; (Group-&gt;getNumMembers() &lt; Group-&gt;getFactor()));</span></CodeLine>
<Link id="l05766" /><CodeLine lineNumber="5766"><span class="doxyHighlight">  InstructionCost <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getInterleavedMemoryOpCost(</span></CodeLine>
<Link id="l05767" /><CodeLine lineNumber="5767"><span class="doxyHighlight">      InsertPos-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), WideVecTy, Group-&gt;getFactor(), Indices,</span></CodeLine>
<Link id="l05768" /><CodeLine lineNumber="5768"><span class="doxyHighlight">      Group-&gt;getAlign(), AS, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>),</span></CodeLine>
<Link id="l05769" /><CodeLine lineNumber="5769"><span class="doxyHighlight">      UseMaskForGaps);</span></CodeLine>
<Link id="l05770" /><CodeLine lineNumber="5770"></CodeLine>
<Link id="l05771" /><CodeLine lineNumber="5771"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Group-&gt;isReverse()) &#123;</span></CodeLine>
<Link id="l05772" /><CodeLine lineNumber="5772"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Add support for reversed masked interleaved access.</span></CodeLine>
<Link id="l05773" /><CodeLine lineNumber="5773"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l05774" /><CodeLine lineNumber="5774"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Reverse masked interleaved access not supported.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l05775" /><CodeLine lineNumber="5775"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += Group-&gt;getNumMembers() &#42;</span></CodeLine>
<Link id="l05776" /><CodeLine lineNumber="5776"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getShuffleCost(<a href="/docs/api/classes/llvm/targettransforminfo/#af46433d0e36d3f80afc3a8c67b5c53ecaea788d98147161f25d5adc3ec6ce7e1f">TargetTransformInfo::SK&#95;Reverse</a>, VectorTy, &#123;&#125;,</span></CodeLine>
<Link id="l05777" /><CodeLine lineNumber="5777"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, 0);</span></CodeLine>
<Link id="l05778" /><CodeLine lineNumber="5778"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05779" /><CodeLine lineNumber="5779"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</span></CodeLine>
<Link id="l05780" /><CodeLine lineNumber="5780"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05781" /><CodeLine lineNumber="5781"></CodeLine>
<Link id="l05782" /><CodeLine lineNumber="5782"><span class="doxyHighlight">std::optional&lt;InstructionCost&gt;</span></CodeLine>
<Link id="l05783" /><CodeLine lineNumber="5783" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4e307866e6d65e87d1e6884b0d13306c"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4e307866e6d65e87d1e6884b0d13306c">LoopVectorizationCostModel::getReductionPatternCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l05784" /><CodeLine lineNumber="5784"><span class="doxyHighlight">                                                    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF,</span></CodeLine>
<Link id="l05785" /><CodeLine lineNumber="5785"><span class="doxyHighlight">                                                    <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l05786" /><CodeLine lineNumber="5786"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</span></CodeLine>
<Link id="l05787" /><CodeLine lineNumber="5787"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Early exit for no inloop reductions</span></CodeLine>
<Link id="l05788" /><CodeLine lineNumber="5788"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InLoopReductions.empty() || VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(Ty))</span></CodeLine>
<Link id="l05789" /><CodeLine lineNumber="5789"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l05790" /><CodeLine lineNumber="5790"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VectorTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(Ty);</span></CodeLine>
<Link id="l05791" /><CodeLine lineNumber="5791"></CodeLine>
<Link id="l05792" /><CodeLine lineNumber="5792"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We are looking for a pattern of, and finding the minimal acceptable cost:</span></CodeLine>
<Link id="l05793" /><CodeLine lineNumber="5793"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  reduce(mul(ext(A), ext(B))) or</span></CodeLine>
<Link id="l05794" /><CodeLine lineNumber="5794"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  reduce(mul(A, B)) or</span></CodeLine>
<Link id="l05795" /><CodeLine lineNumber="5795"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  reduce(ext(A)) or</span></CodeLine>
<Link id="l05796" /><CodeLine lineNumber="5796"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  reduce(A).</span></CodeLine>
<Link id="l05797" /><CodeLine lineNumber="5797"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The basic idea is that we walk down the tree to do that, finding the root</span></CodeLine>
<Link id="l05798" /><CodeLine lineNumber="5798"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reduction instruction in InLoopReductionImmediateChains. From there we find</span></CodeLine>
<Link id="l05799" /><CodeLine lineNumber="5799"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the pattern of mul/ext and test the cost of the entire pattern vs the cost</span></CodeLine>
<Link id="l05800" /><CodeLine lineNumber="5800"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of the components. If the reduction cost is lower then we return it for the</span></CodeLine>
<Link id="l05801" /><CodeLine lineNumber="5801"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reduction instruction and 0 for the other instructions in the pattern. If</span></CodeLine>
<Link id="l05802" /><CodeLine lineNumber="5802"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it is not we return an invalid cost specifying the orignal cost method</span></CodeLine>
<Link id="l05803" /><CodeLine lineNumber="5803"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// should be used.</span></CodeLine>
<Link id="l05804" /><CodeLine lineNumber="5804"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;RetI = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l05805" /><CodeLine lineNumber="5805"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RetI, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()))) &#123;</span></CodeLine>
<Link id="l05806" /><CodeLine lineNumber="5806"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RetI-&gt;<a href="/docs/api/classes/llvm/value/#a2e987c6af902aad6baa39bd5b7ef322c">hasOneUser</a>())</span></CodeLine>
<Link id="l05807" /><CodeLine lineNumber="5807"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l05808" /><CodeLine lineNumber="5808"><span class="doxyHighlight">    RetI = RetI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>();</span></CodeLine>
<Link id="l05809" /><CodeLine lineNumber="5809"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05810" /><CodeLine lineNumber="5810"></CodeLine>
<Link id="l05811" /><CodeLine lineNumber="5811"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RetI, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a532515120d78196926b68c48460087ab">m&#95;Mul</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()))) &amp;&amp;</span></CodeLine>
<Link id="l05812" /><CodeLine lineNumber="5812"><span class="doxyHighlight">      RetI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Add) &#123;</span></CodeLine>
<Link id="l05813" /><CodeLine lineNumber="5813"><span class="doxyHighlight">    RetI = RetI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>();</span></CodeLine>
<Link id="l05814" /><CodeLine lineNumber="5814"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05815" /><CodeLine lineNumber="5815"></CodeLine>
<Link id="l05816" /><CodeLine lineNumber="5816"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Test if the found instruction is a reduction, and if not return an invalid</span></CodeLine>
<Link id="l05817" /><CodeLine lineNumber="5817"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cost specifying the parent to use the original cost modelling.</span></CodeLine>
<Link id="l05818" /><CodeLine lineNumber="5818"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!InLoopReductionImmediateChains.count(RetI))</span></CodeLine>
<Link id="l05819" /><CodeLine lineNumber="5819"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> std::nullopt;</span></CodeLine>
<Link id="l05820" /><CodeLine lineNumber="5820"></CodeLine>
<Link id="l05821" /><CodeLine lineNumber="5821"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find the reduction this chain is a part of and calculate the basic cost of</span></CodeLine>
<Link id="l05822" /><CodeLine lineNumber="5822"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the reduction on its own.</span></CodeLine>
<Link id="l05823" /><CodeLine lineNumber="5823"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;LastChain = InLoopReductionImmediateChains.at(RetI);</span></CodeLine>
<Link id="l05824" /><CodeLine lineNumber="5824"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ReductionPhi = LastChain;</span></CodeLine>
<Link id="l05825" /><CodeLine lineNumber="5825"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(ReductionPhi))</span></CodeLine>
<Link id="l05826" /><CodeLine lineNumber="5826"><span class="doxyHighlight">    ReductionPhi = InLoopReductionImmediateChains.at(ReductionPhi);</span></CodeLine>
<Link id="l05827" /><CodeLine lineNumber="5827"></CodeLine>
<Link id="l05828" /><CodeLine lineNumber="5828"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc =</span></CodeLine>
<Link id="l05829" /><CodeLine lineNumber="5829"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars().find(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(ReductionPhi))-&gt;second;</span></CodeLine>
<Link id="l05830" /><CodeLine lineNumber="5830"></CodeLine>
<Link id="l05831" /><CodeLine lineNumber="5831"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> BaseCost;</span></CodeLine>
<Link id="l05832" /><CodeLine lineNumber="5832"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> RK = RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>();</span></CodeLine>
<Link id="l05833" /><CodeLine lineNumber="5833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#af08d243545b64f4b77161992d0e2366e">RecurrenceDescriptor::isMinMaxRecurrenceKind</a>(RK)) &#123;</span></CodeLine>
<Link id="l05834" /><CodeLine lineNumber="5834"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> MinMaxID = <a href="/docs/api/namespaces/llvm/#a0e4b6546560e7fb6d37f6318d3236bb9">getMinMaxReductionIntrinsicOp</a>(RK);</span></CodeLine>
<Link id="l05835" /><CodeLine lineNumber="5835"><span class="doxyHighlight">    BaseCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMinMaxReductionCost(MinMaxID, VectorTy,</span></CodeLine>
<Link id="l05836" /><CodeLine lineNumber="5836"><span class="doxyHighlight">                                          RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a0d5c759e770c1c6032d077a1b9cf7172">getFastMathFlags</a>(), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05837" /><CodeLine lineNumber="5837"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l05838" /><CodeLine lineNumber="5838"><span class="doxyHighlight">    BaseCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticReductionCost(</span></CodeLine>
<Link id="l05839" /><CodeLine lineNumber="5839"><span class="doxyHighlight">        RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a30ee597b72598bc7939d3a40d2a5ba20">getOpcode</a>(), VectorTy, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a0d5c759e770c1c6032d077a1b9cf7172">getFastMathFlags</a>(), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05840" /><CodeLine lineNumber="5840"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05841" /><CodeLine lineNumber="5841"></CodeLine>
<Link id="l05842" /><CodeLine lineNumber="5842"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For a call to the llvm.fmuladd intrinsic we need to add the cost of a</span></CodeLine>
<Link id="l05843" /><CodeLine lineNumber="5843"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// normal fmul instruction to the cost of the fadd reduction.</span></CodeLine>
<Link id="l05844" /><CodeLine lineNumber="5844"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RK == <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaa7dad289ea38506fb1c9b5b148405d0c">RecurKind::FMulAdd</a>)</span></CodeLine>
<Link id="l05845" /><CodeLine lineNumber="5845"><span class="doxyHighlight">    BaseCost +=</span></CodeLine>
<Link id="l05846" /><CodeLine lineNumber="5846"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(Instruction::FMul, VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05847" /><CodeLine lineNumber="5847"></CodeLine>
<Link id="l05848" /><CodeLine lineNumber="5848"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we&#39;re using ordered reductions then we can just return the base cost</span></CodeLine>
<Link id="l05849" /><CodeLine lineNumber="5849"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// here, since getArithmeticReductionCost calculates the full ordered</span></CodeLine>
<Link id="l05850" /><CodeLine lineNumber="5850"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reduction cost when FP reassociation is not allowed.</span></CodeLine>
<Link id="l05851" /><CodeLine lineNumber="5851"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad508b8cfa31c0e7a1ac8f9d733bb8eed">useOrderedReductions</a>(RdxDesc))</span></CodeLine>
<Link id="l05852" /><CodeLine lineNumber="5852"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BaseCost;</span></CodeLine>
<Link id="l05853" /><CodeLine lineNumber="5853"></CodeLine>
<Link id="l05854" /><CodeLine lineNumber="5854"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get the operand that was not the reduction chain and match it to one of the</span></CodeLine>
<Link id="l05855" /><CodeLine lineNumber="5855"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// patterns, returning the better cost if it is found.</span></CodeLine>
<Link id="l05856" /><CodeLine lineNumber="5856"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;RedOp = RetI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) == LastChain</span></CodeLine>
<Link id="l05857" /><CodeLine lineNumber="5857"><span class="doxyHighlight">                           ? <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(RetI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0))</span></CodeLine>
<Link id="l05858" /><CodeLine lineNumber="5858"><span class="doxyHighlight">                           : <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(RetI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</span></CodeLine>
<Link id="l05859" /><CodeLine lineNumber="5859"></CodeLine>
<Link id="l05860" /><CodeLine lineNumber="5860"><span class="doxyHighlight">  VectorTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType(), VectorTy);</span></CodeLine>
<Link id="l05861" /><CodeLine lineNumber="5861"></CodeLine>
<Link id="l05862" /><CodeLine lineNumber="5862"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Op0, &#42;Op1;</span></CodeLine>
<Link id="l05863" /><CodeLine lineNumber="5863"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RedOp &amp;&amp; RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a30ee597b72598bc7939d3a40d2a5ba20">getOpcode</a>() == Instruction::Add &amp;&amp;</span></CodeLine>
<Link id="l05864" /><CodeLine lineNumber="5864"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RedOp,</span></CodeLine>
<Link id="l05865" /><CodeLine lineNumber="5865"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a532515120d78196926b68c48460087ab">m&#95;Mul</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(Op1)))) &amp;&amp;</span></CodeLine>
<Link id="l05866" /><CodeLine lineNumber="5866"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())) &amp;&amp;</span></CodeLine>
<Link id="l05867" /><CodeLine lineNumber="5867"><span class="doxyHighlight">      Op0-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Op1-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() &amp;&amp;</span></CodeLine>
<Link id="l05868" /><CodeLine lineNumber="5868"><span class="doxyHighlight">      Op0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == Op1-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() &amp;&amp;</span></CodeLine>
<Link id="l05869" /><CodeLine lineNumber="5869"><span class="doxyHighlight">      !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(Op0) &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(Op1) &amp;&amp;</span></CodeLine>
<Link id="l05870" /><CodeLine lineNumber="5870"><span class="doxyHighlight">      (Op0-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == RedOp-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() || Op0 == Op1)) &#123;</span></CodeLine>
<Link id="l05871" /><CodeLine lineNumber="5871"></CodeLine>
<Link id="l05872" /><CodeLine lineNumber="5872"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Matched reduce.add(ext(mul(ext(A), ext(B)))</span></CodeLine>
<Link id="l05873" /><CodeLine lineNumber="5873"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note that the extend opcodes need to all match, or if A==B they will have</span></CodeLine>
<Link id="l05874" /><CodeLine lineNumber="5874"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// been converted to zext(mul(sext(A), sext(A))) as it is known positive,</span></CodeLine>
<Link id="l05875" /><CodeLine lineNumber="5875"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// which is equally fine.</span></CodeLine>
<Link id="l05876" /><CodeLine lineNumber="5876"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsUnsigned = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(Op0);</span></CodeLine>
<Link id="l05877" /><CodeLine lineNumber="5877"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExtType = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Op0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), VectorTy);</span></CodeLine>
<Link id="l05878" /><CodeLine lineNumber="5878"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MulType = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Op0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), VectorTy);</span></CodeLine>
<Link id="l05879" /><CodeLine lineNumber="5879"></CodeLine>
<Link id="l05880" /><CodeLine lineNumber="5880"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ExtCost =</span></CodeLine>
<Link id="l05881" /><CodeLine lineNumber="5881"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(Op0-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), MulType, ExtType,</span></CodeLine>
<Link id="l05882" /><CodeLine lineNumber="5882"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, Op0);</span></CodeLine>
<Link id="l05883" /><CodeLine lineNumber="5883"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> MulCost =</span></CodeLine>
<Link id="l05884" /><CodeLine lineNumber="5884"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(Instruction::Mul, MulType, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05885" /><CodeLine lineNumber="5885"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> Ext2Cost =</span></CodeLine>
<Link id="l05886" /><CodeLine lineNumber="5886"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(RedOp-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), VectorTy, MulType,</span></CodeLine>
<Link id="l05887" /><CodeLine lineNumber="5887"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, RedOp);</span></CodeLine>
<Link id="l05888" /><CodeLine lineNumber="5888"></CodeLine>
<Link id="l05889" /><CodeLine lineNumber="5889"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMulAccReductionCost(</span></CodeLine>
<Link id="l05890" /><CodeLine lineNumber="5890"><span class="doxyHighlight">        IsUnsigned, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>(), ExtType, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05891" /><CodeLine lineNumber="5891"></CodeLine>
<Link id="l05892" /><CodeLine lineNumber="5892"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RedCost.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>() &amp;&amp;</span></CodeLine>
<Link id="l05893" /><CodeLine lineNumber="5893"><span class="doxyHighlight">        RedCost &lt; ExtCost &#42; 2 + MulCost + Ext2Cost + BaseCost)</span></CodeLine>
<Link id="l05894" /><CodeLine lineNumber="5894"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == RetI ? RedCost : 0;</span></CodeLine>
<Link id="l05895" /><CodeLine lineNumber="5895"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RedOp &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RedOp, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())) &amp;&amp;</span></CodeLine>
<Link id="l05896" /><CodeLine lineNumber="5896"><span class="doxyHighlight">             !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(RedOp)) &#123;</span></CodeLine>
<Link id="l05897" /><CodeLine lineNumber="5897"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Matched reduce(ext(A))</span></CodeLine>
<Link id="l05898" /><CodeLine lineNumber="5898"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsUnsigned = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(RedOp);</span></CodeLine>
<Link id="l05899" /><CodeLine lineNumber="5899"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExtType = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(RedOp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), VectorTy);</span></CodeLine>
<Link id="l05900" /><CodeLine lineNumber="5900"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getExtendedReductionCost(</span></CodeLine>
<Link id="l05901" /><CodeLine lineNumber="5901"><span class="doxyHighlight">        RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a30ee597b72598bc7939d3a40d2a5ba20">getOpcode</a>(), IsUnsigned, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>(), ExtType,</span></CodeLine>
<Link id="l05902" /><CodeLine lineNumber="5902"><span class="doxyHighlight">        RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a0d5c759e770c1c6032d077a1b9cf7172">getFastMathFlags</a>(), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05903" /><CodeLine lineNumber="5903"></CodeLine>
<Link id="l05904" /><CodeLine lineNumber="5904"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ExtCost =</span></CodeLine>
<Link id="l05905" /><CodeLine lineNumber="5905"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(RedOp-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), VectorTy, ExtType,</span></CodeLine>
<Link id="l05906" /><CodeLine lineNumber="5906"><span class="doxyHighlight">                             <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, RedOp);</span></CodeLine>
<Link id="l05907" /><CodeLine lineNumber="5907"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RedCost.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>() &amp;&amp; RedCost &lt; BaseCost + ExtCost)</span></CodeLine>
<Link id="l05908" /><CodeLine lineNumber="5908"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == RetI ? RedCost : 0;</span></CodeLine>
<Link id="l05909" /><CodeLine lineNumber="5909"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RedOp &amp;&amp; RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a30ee597b72598bc7939d3a40d2a5ba20">getOpcode</a>() == Instruction::Add &amp;&amp;</span></CodeLine>
<Link id="l05910" /><CodeLine lineNumber="5910"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RedOp, <a href="/docs/api/namespaces/llvm/patternmatch/#a532515120d78196926b68c48460087ab">m&#95;Mul</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(Op1)))) &#123;</span></CodeLine>
<Link id="l05911" /><CodeLine lineNumber="5911"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())) &amp;&amp;</span></CodeLine>
<Link id="l05912" /><CodeLine lineNumber="5912"><span class="doxyHighlight">        Op0-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Op1-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() &amp;&amp;</span></CodeLine>
<Link id="l05913" /><CodeLine lineNumber="5913"><span class="doxyHighlight">        !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(Op0) &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(Op1)) &#123;</span></CodeLine>
<Link id="l05914" /><CodeLine lineNumber="5914"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsUnsigned = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(Op0);</span></CodeLine>
<Link id="l05915" /><CodeLine lineNumber="5915"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;Op0Ty = Op0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l05916" /><CodeLine lineNumber="5916"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;Op1Ty = Op1-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l05917" /><CodeLine lineNumber="5917"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;LargestOpTy =</span></CodeLine>
<Link id="l05918" /><CodeLine lineNumber="5918"><span class="doxyHighlight">          Op0Ty-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &lt; Op1Ty-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() ? Op1Ty</span></CodeLine>
<Link id="l05919" /><CodeLine lineNumber="5919"><span class="doxyHighlight">                                                                    : Op0Ty;</span></CodeLine>
<Link id="l05920" /><CodeLine lineNumber="5920"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExtType = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(LargestOpTy, VectorTy);</span></CodeLine>
<Link id="l05921" /><CodeLine lineNumber="5921"></CodeLine>
<Link id="l05922" /><CodeLine lineNumber="5922"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Matched reduce.add(mul(ext(A), ext(B))), where the two ext may be of</span></CodeLine>
<Link id="l05923" /><CodeLine lineNumber="5923"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// different sizes. We take the largest type as the ext to reduce, and add</span></CodeLine>
<Link id="l05924" /><CodeLine lineNumber="5924"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the remaining cost as, for example reduce(mul(ext(ext(A)), ext(B))).</span></CodeLine>
<Link id="l05925" /><CodeLine lineNumber="5925"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ExtCost0 = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(</span></CodeLine>
<Link id="l05926" /><CodeLine lineNumber="5926"><span class="doxyHighlight">          Op0-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), VectorTy, <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Op0Ty, VectorTy),</span></CodeLine>
<Link id="l05927" /><CodeLine lineNumber="5927"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, Op0);</span></CodeLine>
<Link id="l05928" /><CodeLine lineNumber="5928"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ExtCost1 = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(</span></CodeLine>
<Link id="l05929" /><CodeLine lineNumber="5929"><span class="doxyHighlight">          Op1-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), VectorTy, <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Op1Ty, VectorTy),</span></CodeLine>
<Link id="l05930" /><CodeLine lineNumber="5930"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, Op1);</span></CodeLine>
<Link id="l05931" /><CodeLine lineNumber="5931"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> MulCost =</span></CodeLine>
<Link id="l05932" /><CodeLine lineNumber="5932"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(Instruction::Mul, VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05933" /><CodeLine lineNumber="5933"></CodeLine>
<Link id="l05934" /><CodeLine lineNumber="5934"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMulAccReductionCost(</span></CodeLine>
<Link id="l05935" /><CodeLine lineNumber="5935"><span class="doxyHighlight">          IsUnsigned, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>(), ExtType, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05936" /><CodeLine lineNumber="5936"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ExtraExtCost = 0;</span></CodeLine>
<Link id="l05937" /><CodeLine lineNumber="5937"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Op0Ty != LargestOpTy || Op1Ty != LargestOpTy) &#123;</span></CodeLine>
<Link id="l05938" /><CodeLine lineNumber="5938"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ExtraExtOp = (Op0Ty != LargestOpTy) ? Op0 : Op1;</span></CodeLine>
<Link id="l05939" /><CodeLine lineNumber="5939"><span class="doxyHighlight">        ExtraExtCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(</span></CodeLine>
<Link id="l05940" /><CodeLine lineNumber="5940"><span class="doxyHighlight">            ExtraExtOp-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), ExtType,</span></CodeLine>
<Link id="l05941" /><CodeLine lineNumber="5941"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(ExtraExtOp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), VectorTy),</span></CodeLine>
<Link id="l05942" /><CodeLine lineNumber="5942"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, ExtraExtOp);</span></CodeLine>
<Link id="l05943" /><CodeLine lineNumber="5943"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l05944" /><CodeLine lineNumber="5944"></CodeLine>
<Link id="l05945" /><CodeLine lineNumber="5945"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RedCost.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>() &amp;&amp;</span></CodeLine>
<Link id="l05946" /><CodeLine lineNumber="5946"><span class="doxyHighlight">          (RedCost + ExtraExtCost) &lt; (ExtCost0 + ExtCost1 + MulCost + BaseCost))</span></CodeLine>
<Link id="l05947" /><CodeLine lineNumber="5947"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == RetI ? RedCost : 0;</span></CodeLine>
<Link id="l05948" /><CodeLine lineNumber="5948"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()))) &#123;</span></CodeLine>
<Link id="l05949" /><CodeLine lineNumber="5949"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Matched reduce.add(mul())</span></CodeLine>
<Link id="l05950" /><CodeLine lineNumber="5950"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> MulCost =</span></CodeLine>
<Link id="l05951" /><CodeLine lineNumber="5951"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(Instruction::Mul, VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05952" /><CodeLine lineNumber="5952"></CodeLine>
<Link id="l05953" /><CodeLine lineNumber="5953"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMulAccReductionCost(</span></CodeLine>
<Link id="l05954" /><CodeLine lineNumber="5954"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>(), VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l05955" /><CodeLine lineNumber="5955"></CodeLine>
<Link id="l05956" /><CodeLine lineNumber="5956"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RedCost.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>() &amp;&amp; RedCost &lt; MulCost + BaseCost)</span></CodeLine>
<Link id="l05957" /><CodeLine lineNumber="5957"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == RetI ? RedCost : 0;</span></CodeLine>
<Link id="l05958" /><CodeLine lineNumber="5958"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l05959" /><CodeLine lineNumber="5959"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05960" /><CodeLine lineNumber="5960"></CodeLine>
<Link id="l05961" /><CodeLine lineNumber="5961"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == RetI ? std::optional&lt;InstructionCost&gt;(BaseCost) : std::nullopt;</span></CodeLine>
<Link id="l05962" /><CodeLine lineNumber="5962"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05963" /><CodeLine lineNumber="5963"></CodeLine>
<Link id="l05964" /><CodeLine lineNumber="5964"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></span></CodeLine>
<Link id="l05965" /><CodeLine lineNumber="5965"><span class="doxyHighlight">LoopVectorizationCostModel::getMemoryInstructionCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l05966" /><CodeLine lineNumber="5966"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l05967" /><CodeLine lineNumber="5967"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Calculate scalar cost only. Vectorization cost should be ready at this</span></CodeLine>
<Link id="l05968" /><CodeLine lineNumber="5968"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// moment.</span></CodeLine>
<Link id="l05969" /><CodeLine lineNumber="5969"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>()) &#123;</span></CodeLine>
<Link id="l05970" /><CodeLine lineNumber="5970"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ValTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05971" /><CodeLine lineNumber="5971"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/align">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05972" /><CodeLine lineNumber="5972"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> AS = <a href="/docs/api/namespaces/llvm/#a0d97f0780a320d53641729a2d8371b74">getLoadStoreAddressSpace</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05973" /><CodeLine lineNumber="5973"></CodeLine>
<Link id="l05974" /><CodeLine lineNumber="5974"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/targettransforminfo/operandvalueinfo">TTI::OperandValueInfo</a> OpInfo = <a href="/docs/api/classes/llvm/targettransforminfo/#a5fecba95c1ba20950ea8e2139127e621">TTI::getOperandInfo</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</span></CodeLine>
<Link id="l05975" /><CodeLine lineNumber="5975"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getAddressComputationCost(ValTy) +</span></CodeLine>
<Link id="l05976" /><CodeLine lineNumber="5976"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getMemoryOpCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), ValTy, Alignment, AS, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>,</span></CodeLine>
<Link id="l05977" /><CodeLine lineNumber="5977"><span class="doxyHighlight">                               OpInfo, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l05978" /><CodeLine lineNumber="5978"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l05979" /><CodeLine lineNumber="5979"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af7844564539b9f0f917e8f2380a064b3">getWideningCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l05980" /><CodeLine lineNumber="5980"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l05981" /><CodeLine lineNumber="5981"></CodeLine>
<Link id="l05982" /><CodeLine lineNumber="5982"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></span></CodeLine>
<Link id="l05983" /><CodeLine lineNumber="5983"><span class="doxyHighlight">LoopVectorizationCostModel::getScalarizationOverhead(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l05984" /><CodeLine lineNumber="5984"><span class="doxyHighlight">                                                     <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l05985" /><CodeLine lineNumber="5985"></CodeLine>
<Link id="l05986" /><CodeLine lineNumber="5986"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// There is no mechanism yet to create a scalable scalarization loop,</span></CodeLine>
<Link id="l05987" /><CodeLine lineNumber="5987"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so this is currently Invalid.</span></CodeLine>
<Link id="l05988" /><CodeLine lineNumber="5988"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</span></CodeLine>
<Link id="l05989" /><CodeLine lineNumber="5989"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l05990" /><CodeLine lineNumber="5990"></CodeLine>
<Link id="l05991" /><CodeLine lineNumber="5991"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</span></CodeLine>
<Link id="l05992" /><CodeLine lineNumber="5992"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l05993" /><CodeLine lineNumber="5993"></CodeLine>
<Link id="l05994" /><CodeLine lineNumber="5994"><span class="doxyHighlight">  InstructionCost <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = 0;</span></CodeLine>
<Link id="l05995" /><CodeLine lineNumber="5995"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;RetTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), VF);</span></CodeLine>
<Link id="l05996" /><CodeLine lineNumber="5996"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RetTy-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l05997" /><CodeLine lineNumber="5997"><span class="doxyHighlight">      (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.supportsEfficientVectorElementLoadStore()))</span></CodeLine>
<Link id="l05998" /><CodeLine lineNumber="5998"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getScalarizationOverhead(</span></CodeLine>
<Link id="l05999" /><CodeLine lineNumber="5999"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(RetTy), <a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>()),</span></CodeLine>
<Link id="l06000" /><CodeLine lineNumber="6000"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;Insert&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06001" /><CodeLine lineNumber="6001"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">/&#42;Extract&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l06002" /><CodeLine lineNumber="6002"></CodeLine>
<Link id="l06003" /><CodeLine lineNumber="6003"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Some targets keep addresses scalar.</span></CodeLine>
<Link id="l06004" /><CodeLine lineNumber="6004"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.prefersVectorizedAddressing())</span></CodeLine>
<Link id="l06005" /><CodeLine lineNumber="6005"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</span></CodeLine>
<Link id="l06006" /><CodeLine lineNumber="6006"></CodeLine>
<Link id="l06007" /><CodeLine lineNumber="6007"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Some targets support efficient element stores.</span></CodeLine>
<Link id="l06008" /><CodeLine lineNumber="6008"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.supportsEfficientVectorElementLoadStore())</span></CodeLine>
<Link id="l06009" /><CodeLine lineNumber="6009"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</span></CodeLine>
<Link id="l06010" /><CodeLine lineNumber="6010"></CodeLine>
<Link id="l06011" /><CodeLine lineNumber="6011"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect operands to consider.</span></CodeLine>
<Link id="l06012" /><CodeLine lineNumber="6012"><span class="doxyHighlight">  CallInst &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06013" /><CodeLine lineNumber="6013"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/user/#a917548288129e24325af275795e4622f">Instruction::op&#95;range</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a> = CI ? CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>() : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands();</span></CodeLine>
<Link id="l06014" /><CodeLine lineNumber="6014"></CodeLine>
<Link id="l06015" /><CodeLine lineNumber="6015"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Skip operands that do not require extraction/scalarization and do not incur</span></CodeLine>
<Link id="l06016" /><CodeLine lineNumber="6016"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// any overhead.</span></CodeLine>
<Link id="l06017" /><CodeLine lineNumber="6017"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;Type &#42;&gt;</a> <a href="/docs/api/namespaces/llvm/intrinsic/#a042f275033dbeb7761b82e5368e871bf">Tys</a>;</span></CodeLine>
<Link id="l06018" /><CodeLine lineNumber="6018"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;V : filterExtractingOperands(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, VF))</span></CodeLine>
<Link id="l06019" /><CodeLine lineNumber="6019"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/intrinsic/#a042f275033dbeb7761b82e5368e871bf">Tys</a>.push&#95;back(<a href="#a83114915b4f7fec94a20efa3834a8250">maybeVectorizeType</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType(), VF));</span></CodeLine>
<Link id="l06020" /><CodeLine lineNumber="6020"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> + <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getOperandsScalarizationOverhead(</span></CodeLine>
<Link id="l06021" /><CodeLine lineNumber="6021"><span class="doxyHighlight">                    filterExtractingOperands(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, VF), Tys, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l06022" /><CodeLine lineNumber="6022"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06023" /><CodeLine lineNumber="6023"></CodeLine>
<Link id="l06024" /><CodeLine lineNumber="6024" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae8d11752355845a0e271111de7be7d3a"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae8d11752355845a0e271111de7be7d3a">LoopVectorizationCostModel::setCostBasedWideningDecision</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l06025" /><CodeLine lineNumber="6025"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</span></CodeLine>
<Link id="l06026" /><CodeLine lineNumber="6026"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06027" /><CodeLine lineNumber="6027"><span class="doxyHighlight">  NumPredStores = 0;</span></CodeLine>
<Link id="l06028" /><CodeLine lineNumber="6028"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks()) &#123;</span></CodeLine>
<Link id="l06029" /><CodeLine lineNumber="6029"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For each instruction in the old loop.</span></CodeLine>
<Link id="l06030" /><CodeLine lineNumber="6030"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l06031" /><CodeLine lineNumber="6031"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> =  <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06032" /><CodeLine lineNumber="6032"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)</span></CodeLine>
<Link id="l06033" /><CodeLine lineNumber="6033"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06034" /><CodeLine lineNumber="6034"></CodeLine>
<Link id="l06035" /><CodeLine lineNumber="6035"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: We should generate better code and update the cost model for</span></CodeLine>
<Link id="l06036" /><CodeLine lineNumber="6036"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// predicated uniform stores. Today they are treated as any other</span></CodeLine>
<Link id="l06037" /><CodeLine lineNumber="6037"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// predicated store (see added test cases in</span></CodeLine>
<Link id="l06038" /><CodeLine lineNumber="6038"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// invariant-store-vectorization.ll).</span></CodeLine>
<Link id="l06039" /><CodeLine lineNumber="6039"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8">isScalarWithPredication</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</span></CodeLine>
<Link id="l06040" /><CodeLine lineNumber="6040"><span class="doxyHighlight">        NumPredStores++;</span></CodeLine>
<Link id="l06041" /><CodeLine lineNumber="6041"></CodeLine>
<Link id="l06042" /><CodeLine lineNumber="6042"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isUniformMemOp(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</span></CodeLine>
<Link id="l06043" /><CodeLine lineNumber="6043"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsLegalToScalarize = &#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l06044" /><CodeLine lineNumber="6044"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</span></CodeLine>
<Link id="l06045" /><CodeLine lineNumber="6045"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Scalarization of fixed length vectors &quot;just works&quot;.</span></CodeLine>
<Link id="l06046" /><CodeLine lineNumber="6046"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06047" /><CodeLine lineNumber="6047"></CodeLine>
<Link id="l06048" /><CodeLine lineNumber="6048"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// We have dedicated lowering for unpredicated uniform loads and</span></CodeLine>
<Link id="l06049" /><CodeLine lineNumber="6049"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// stores.  Note that even with tail folding we know that at least</span></CodeLine>
<Link id="l06050" /><CodeLine lineNumber="6050"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// one lane is active (i.e. generalized predication is not possible</span></CodeLine>
<Link id="l06051" /><CodeLine lineNumber="6051"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// here), and the logic below depends on this fact.</span></CodeLine>
<Link id="l06052" /><CodeLine lineNumber="6052"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba">foldTailByMasking</a>())</span></CodeLine>
<Link id="l06053" /><CodeLine lineNumber="6053"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06054" /><CodeLine lineNumber="6054"></CodeLine>
<Link id="l06055" /><CodeLine lineNumber="6055"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// For scalable vectors, a uniform memop load is always</span></CodeLine>
<Link id="l06056" /><CodeLine lineNumber="6056"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// uniform-by-parts  and we know how to scalarize that.</span></CodeLine>
<Link id="l06057" /><CodeLine lineNumber="6057"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l06058" /><CodeLine lineNumber="6058"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06059" /><CodeLine lineNumber="6059"></CodeLine>
<Link id="l06060" /><CodeLine lineNumber="6060"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// A uniform store isn&#39;t neccessarily uniform-by-part</span></CodeLine>
<Link id="l06061" /><CodeLine lineNumber="6061"><span class="doxyHighlight">          </span><span class="doxyHighlightComment">// and we can&#39;t assume scalarization.</span></CodeLine>
<Link id="l06062" /><CodeLine lineNumber="6062"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06063" /><CodeLine lineNumber="6063"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(<a href="/docs/api/namespaces/llvm/si">SI</a>.getValueOperand());</span></CodeLine>
<Link id="l06064" /><CodeLine lineNumber="6064"><span class="doxyHighlight">        &#125;;</span></CodeLine>
<Link id="l06065" /><CodeLine lineNumber="6065"></CodeLine>
<Link id="l06066" /><CodeLine lineNumber="6066"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> GatherScatterCost =</span></CodeLine>
<Link id="l06067" /><CodeLine lineNumber="6067"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa650124eefba1fd45866d05306385129">isLegalGatherOrScatter</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) ?</span></CodeLine>
<Link id="l06068" /><CodeLine lineNumber="6068"><span class="doxyHighlight">          getGatherScatterCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) : <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l06069" /><CodeLine lineNumber="6069"></CodeLine>
<Link id="l06070" /><CodeLine lineNumber="6070"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Load: Scalar load + broadcast</span></CodeLine>
<Link id="l06071" /><CodeLine lineNumber="6071"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Store: Scalar store + isLoopInvariantStoreValue ? 0 : extract</span></CodeLine>
<Link id="l06072" /><CodeLine lineNumber="6072"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// FIXME: This cost is a significant under-estimate for tail folded</span></CodeLine>
<Link id="l06073" /><CodeLine lineNumber="6073"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// memory ops.</span></CodeLine>
<Link id="l06074" /><CodeLine lineNumber="6074"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarizationCost =</span></CodeLine>
<Link id="l06075" /><CodeLine lineNumber="6075"><span class="doxyHighlight">            IsLegalToScalarize() ? getUniformMemOpCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)</span></CodeLine>
<Link id="l06076" /><CodeLine lineNumber="6076"><span class="doxyHighlight">                                 : <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l06077" /><CodeLine lineNumber="6077"></CodeLine>
<Link id="l06078" /><CodeLine lineNumber="6078"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Choose better solution for the current VF,  Note that Invalid</span></CodeLine>
<Link id="l06079" /><CodeLine lineNumber="6079"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// costs compare as maximumal large.  If both are invalid, we get</span></CodeLine>
<Link id="l06080" /><CodeLine lineNumber="6080"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// scalable invalid which signals a failure and a vectorization abort.</span></CodeLine>
<Link id="l06081" /><CodeLine lineNumber="6081"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GatherScatterCost &lt; ScalarizationCost)</span></CodeLine>
<Link id="l06082" /><CodeLine lineNumber="6082"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ae849d400780f51424bc4e4c26ddf3000">CM&#95;GatherScatter</a>, GatherScatterCost);</span></CodeLine>
<Link id="l06083" /><CodeLine lineNumber="6083"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l06084" /><CodeLine lineNumber="6084"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>, ScalarizationCost);</span></CodeLine>
<Link id="l06085" /><CodeLine lineNumber="6085"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06086" /><CodeLine lineNumber="6086"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06087" /><CodeLine lineNumber="6087"></CodeLine>
<Link id="l06088" /><CodeLine lineNumber="6088"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We assume that widening is the best solution when possible.</span></CodeLine>
<Link id="l06089" /><CodeLine lineNumber="6089"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a59a6dd7531c8683174f886ff7698cc63">memoryInstructionCanBeWidened</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</span></CodeLine>
<Link id="l06090" /><CodeLine lineNumber="6090"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = getConsecutiveMemOpCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l06091" /><CodeLine lineNumber="6091"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">int</span><span class="doxyHighlight"> ConsecutiveStride = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isConsecutivePtr(</span></CodeLine>
<Link id="l06092" /><CodeLine lineNumber="6092"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l06093" /><CodeLine lineNumber="6093"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((ConsecutiveStride == 1 || ConsecutiveStride == -1) &amp;&amp;</span></CodeLine>
<Link id="l06094" /><CodeLine lineNumber="6094"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;Expected consecutive stride.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06095" /><CodeLine lineNumber="6095"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> Decision =</span></CodeLine>
<Link id="l06096" /><CodeLine lineNumber="6096"><span class="doxyHighlight">            ConsecutiveStride == 1 ? <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260adc468760c02910f77bad7525bc66c334">CM&#95;Widen</a> : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a058eacbd3c28e2ecec2af7db726ce527">CM&#95;Widen&#95;Reverse</a>;</span></CodeLine>
<Link id="l06097" /><CodeLine lineNumber="6097"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, Decision, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>);</span></CodeLine>
<Link id="l06098" /><CodeLine lineNumber="6098"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06099" /><CodeLine lineNumber="6099"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06100" /><CodeLine lineNumber="6100"></CodeLine>
<Link id="l06101" /><CodeLine lineNumber="6101"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Choose between Interleaving, Gather/Scatter or Scalarization.</span></CodeLine>
<Link id="l06102" /><CodeLine lineNumber="6102"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> InterleaveCost = <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l06103" /><CodeLine lineNumber="6103"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumAccesses = 1;</span></CodeLine>
<Link id="l06104" /><CodeLine lineNumber="6104"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85e3110b9fe54caf00fe4297d1b4f0b6">isAccessInterleaved</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l06105" /><CodeLine lineNumber="6105"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Group = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c">getInterleavedAccessGroup</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06106" /><CodeLine lineNumber="6106"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Group &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Fail to get an interleaved access group.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06107" /><CodeLine lineNumber="6107"></CodeLine>
<Link id="l06108" /><CodeLine lineNumber="6108"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Make one decision for the whole group.</span></CodeLine>
<Link id="l06109" /><CodeLine lineNumber="6109"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">CM&#95;Unknown</a>)</span></CodeLine>
<Link id="l06110" /><CodeLine lineNumber="6110"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06111" /><CodeLine lineNumber="6111"></CodeLine>
<Link id="l06112" /><CodeLine lineNumber="6112"><span class="doxyHighlight">        NumAccesses = Group-&gt;getNumMembers();</span></CodeLine>
<Link id="l06113" /><CodeLine lineNumber="6113"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5964ce9ba38fe5a4d372242ac39e3f1d">interleavedAccessCanBeWidened</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</span></CodeLine>
<Link id="l06114" /><CodeLine lineNumber="6114"><span class="doxyHighlight">          InterleaveCost = getInterleaveGroupCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l06115" /><CodeLine lineNumber="6115"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06116" /><CodeLine lineNumber="6116"></CodeLine>
<Link id="l06117" /><CodeLine lineNumber="6117"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> GatherScatterCost =</span></CodeLine>
<Link id="l06118" /><CodeLine lineNumber="6118"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa650124eefba1fd45866d05306385129">isLegalGatherOrScatter</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)</span></CodeLine>
<Link id="l06119" /><CodeLine lineNumber="6119"><span class="doxyHighlight">              ? getGatherScatterCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) &#42; NumAccesses</span></CodeLine>
<Link id="l06120" /><CodeLine lineNumber="6120"><span class="doxyHighlight">              : <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l06121" /><CodeLine lineNumber="6121"></CodeLine>
<Link id="l06122" /><CodeLine lineNumber="6122"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarizationCost =</span></CodeLine>
<Link id="l06123" /><CodeLine lineNumber="6123"><span class="doxyHighlight">          getMemInstScalarizationCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) &#42; NumAccesses;</span></CodeLine>
<Link id="l06124" /><CodeLine lineNumber="6124"></CodeLine>
<Link id="l06125" /><CodeLine lineNumber="6125"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Choose better solution for the current VF,</span></CodeLine>
<Link id="l06126" /><CodeLine lineNumber="6126"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// write down this decision and use it during vectorization.</span></CodeLine>
<Link id="l06127" /><CodeLine lineNumber="6127"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</span></CodeLine>
<Link id="l06128" /><CodeLine lineNumber="6128"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> Decision;</span></CodeLine>
<Link id="l06129" /><CodeLine lineNumber="6129"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InterleaveCost &lt;= GatherScatterCost &amp;&amp;</span></CodeLine>
<Link id="l06130" /><CodeLine lineNumber="6130"><span class="doxyHighlight">          InterleaveCost &lt; ScalarizationCost) &#123;</span></CodeLine>
<Link id="l06131" /><CodeLine lineNumber="6131"><span class="doxyHighlight">        Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971">CM&#95;Interleave</a>;</span></CodeLine>
<Link id="l06132" /><CodeLine lineNumber="6132"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = InterleaveCost;</span></CodeLine>
<Link id="l06133" /><CodeLine lineNumber="6133"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (GatherScatterCost &lt; ScalarizationCost) &#123;</span></CodeLine>
<Link id="l06134" /><CodeLine lineNumber="6134"><span class="doxyHighlight">        Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ae849d400780f51424bc4e4c26ddf3000">CM&#95;GatherScatter</a>;</span></CodeLine>
<Link id="l06135" /><CodeLine lineNumber="6135"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = GatherScatterCost;</span></CodeLine>
<Link id="l06136" /><CodeLine lineNumber="6136"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06137" /><CodeLine lineNumber="6137"><span class="doxyHighlight">        Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>;</span></CodeLine>
<Link id="l06138" /><CodeLine lineNumber="6138"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = ScalarizationCost;</span></CodeLine>
<Link id="l06139" /><CodeLine lineNumber="6139"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06140" /><CodeLine lineNumber="6140"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the instructions belongs to an interleave group, the whole group</span></CodeLine>
<Link id="l06141" /><CodeLine lineNumber="6141"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// receives the same decision. The whole group receives the cost, but</span></CodeLine>
<Link id="l06142" /><CodeLine lineNumber="6142"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the cost will actually be assigned to one instruction.</span></CodeLine>
<Link id="l06143" /><CodeLine lineNumber="6143"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Group = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c">getInterleavedAccessGroup</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l06144" /><CodeLine lineNumber="6144"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(Group, VF, Decision, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>);</span></CodeLine>
<Link id="l06145" /><CodeLine lineNumber="6145"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l06146" /><CodeLine lineNumber="6146"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, Decision, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>);</span></CodeLine>
<Link id="l06147" /><CodeLine lineNumber="6147"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06148" /><CodeLine lineNumber="6148"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06149" /><CodeLine lineNumber="6149"></CodeLine>
<Link id="l06150" /><CodeLine lineNumber="6150"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Make sure that any load of address and any other address computation</span></CodeLine>
<Link id="l06151" /><CodeLine lineNumber="6151"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// remains scalar unless there is gather/scatter support. This avoids</span></CodeLine>
<Link id="l06152" /><CodeLine lineNumber="6152"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// inevitable extracts into address registers, and also has the benefit of</span></CodeLine>
<Link id="l06153" /><CodeLine lineNumber="6153"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// activating LSR more, since that pass can&#39;t optimize vectorized</span></CodeLine>
<Link id="l06154" /><CodeLine lineNumber="6154"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// addresses.</span></CodeLine>
<Link id="l06155" /><CodeLine lineNumber="6155"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.prefersVectorizedAddressing())</span></CodeLine>
<Link id="l06156" /><CodeLine lineNumber="6156"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06157" /><CodeLine lineNumber="6157"></CodeLine>
<Link id="l06158" /><CodeLine lineNumber="6158"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Start with all scalar pointer uses.</span></CodeLine>
<Link id="l06159" /><CodeLine lineNumber="6159"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 8&gt;</a> AddrDefs;</span></CodeLine>
<Link id="l06160" /><CodeLine lineNumber="6160"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks())</span></CodeLine>
<Link id="l06161" /><CodeLine lineNumber="6161"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l06162" /><CodeLine lineNumber="6162"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PtrDef =</span></CodeLine>
<Link id="l06163" /><CodeLine lineNumber="6163"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l06164" /><CodeLine lineNumber="6164"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PtrDef &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(PtrDef) &amp;&amp;</span></CodeLine>
<Link id="l06165" /><CodeLine lineNumber="6165"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ae849d400780f51424bc4e4c26ddf3000">CM&#95;GatherScatter</a>)</span></CodeLine>
<Link id="l06166" /><CodeLine lineNumber="6166"><span class="doxyHighlight">        AddrDefs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(PtrDef);</span></CodeLine>
<Link id="l06167" /><CodeLine lineNumber="6167"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06168" /><CodeLine lineNumber="6168"></CodeLine>
<Link id="l06169" /><CodeLine lineNumber="6169"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add all instructions used to generate the addresses.</span></CodeLine>
<Link id="l06170" /><CodeLine lineNumber="6170"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> Worklist;</span></CodeLine>
<Link id="l06171" /><CodeLine lineNumber="6171"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(Worklist, AddrDefs);</span></CodeLine>
<Link id="l06172" /><CodeLine lineNumber="6172"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l06173" /><CodeLine lineNumber="6173"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l06174" /><CodeLine lineNumber="6174"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</span></CodeLine>
<Link id="l06175" /><CodeLine lineNumber="6175"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;InstOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</span></CodeLine>
<Link id="l06176" /><CodeLine lineNumber="6176"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((InstOp-&gt;getParent() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(InstOp) &amp;&amp;</span></CodeLine>
<Link id="l06177" /><CodeLine lineNumber="6177"><span class="doxyHighlight">            AddrDefs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(InstOp).second)</span></CodeLine>
<Link id="l06178" /><CodeLine lineNumber="6178"><span class="doxyHighlight">          Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(InstOp);</span></CodeLine>
<Link id="l06179" /><CodeLine lineNumber="6179"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06180" /><CodeLine lineNumber="6180"></CodeLine>
<Link id="l06181" /><CodeLine lineNumber="6181"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : AddrDefs) &#123;</span></CodeLine>
<Link id="l06182" /><CodeLine lineNumber="6182"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l06183" /><CodeLine lineNumber="6183"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Setting the desired widening decision should ideally be handled in</span></CodeLine>
<Link id="l06184" /><CodeLine lineNumber="6184"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// by cost functions, but since this involves the task of finding out</span></CodeLine>
<Link id="l06185" /><CodeLine lineNumber="6185"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// if the loaded register is involved in an address computation, it is</span></CodeLine>
<Link id="l06186" /><CodeLine lineNumber="6186"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// instead changed here when we know this is the case.</span></CodeLine>
<Link id="l06187" /><CodeLine lineNumber="6187"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l06188" /><CodeLine lineNumber="6188"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Decision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260adc468760c02910f77bad7525bc66c334">CM&#95;Widen</a> || Decision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a058eacbd3c28e2ecec2af7db726ce527">CM&#95;Widen&#95;Reverse</a>)</span></CodeLine>
<Link id="l06189" /><CodeLine lineNumber="6189"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Scalarize a widened load of address.</span></CodeLine>
<Link id="l06190" /><CodeLine lineNumber="6190"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(</span></CodeLine>
<Link id="l06191" /><CodeLine lineNumber="6191"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>,</span></CodeLine>
<Link id="l06192" /><CodeLine lineNumber="6192"><span class="doxyHighlight">            (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42;</span></CodeLine>
<Link id="l06193" /><CodeLine lineNumber="6193"><span class="doxyHighlight">             getMemoryInstructionCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1))));</span></CodeLine>
<Link id="l06194" /><CodeLine lineNumber="6194"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Group = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c">getInterleavedAccessGroup</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l06195" /><CodeLine lineNumber="6195"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Scalarize an interleave group of address loads.</span></CodeLine>
<Link id="l06196" /><CodeLine lineNumber="6196"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; Group-&gt;getFactor(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l06197" /><CodeLine lineNumber="6197"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Member = Group-&gt;getMember(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l06198" /><CodeLine lineNumber="6198"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(</span></CodeLine>
<Link id="l06199" /><CodeLine lineNumber="6199"><span class="doxyHighlight">                Member, VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>,</span></CodeLine>
<Link id="l06200" /><CodeLine lineNumber="6200"><span class="doxyHighlight">                (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42;</span></CodeLine>
<Link id="l06201" /><CodeLine lineNumber="6201"><span class="doxyHighlight">                 getMemoryInstructionCost(Member, <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1))));</span></CodeLine>
<Link id="l06202" /><CodeLine lineNumber="6202"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l06203" /><CodeLine lineNumber="6203"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06204" /><CodeLine lineNumber="6204"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l06205" /><CodeLine lineNumber="6205"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Make sure I gets scalarized and a cost estimate without</span></CodeLine>
<Link id="l06206" /><CodeLine lineNumber="6206"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// scalarization overhead.</span></CodeLine>
<Link id="l06207" /><CodeLine lineNumber="6207"><span class="doxyHighlight">      ForcedScalars&#91;VF&#93;.insert(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06208" /><CodeLine lineNumber="6208"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06209" /><CodeLine lineNumber="6209"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06210" /><CodeLine lineNumber="6210"></CodeLine>
<Link id="l06211" /><CodeLine lineNumber="6211" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8178cc5e49d5251d7ca3413b8a434f8f"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8178cc5e49d5251d7ca3413b8a434f8f">LoopVectorizationCostModel::setVectorizedCallDecision</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l06212" /><CodeLine lineNumber="6212"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp;</span></CodeLine>
<Link id="l06213" /><CodeLine lineNumber="6213"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Trying to set a vectorization decision for a scalar VF&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06214" /><CodeLine lineNumber="6214"></CodeLine>
<Link id="l06215" /><CodeLine lineNumber="6215"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ForcedScalar = ForcedScalars.find(VF);</span></CodeLine>
<Link id="l06216" /><CodeLine lineNumber="6216"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks()) &#123;</span></CodeLine>
<Link id="l06217" /><CodeLine lineNumber="6217"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For each instruction in the old loop.</span></CodeLine>
<Link id="l06218" /><CodeLine lineNumber="6218"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</span></CodeLine>
<Link id="l06219" /><CodeLine lineNumber="6219"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06220" /><CodeLine lineNumber="6220"></CodeLine>
<Link id="l06221" /><CodeLine lineNumber="6221"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CI)</span></CodeLine>
<Link id="l06222" /><CodeLine lineNumber="6222"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06223" /><CodeLine lineNumber="6223"></CodeLine>
<Link id="l06224" /><CodeLine lineNumber="6224"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarCost = <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l06225" /><CodeLine lineNumber="6225"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> VectorCost = <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l06226" /><CodeLine lineNumber="6226"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> IntrinsicCost = <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l06227" /><CodeLine lineNumber="6227"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function">Function</a> &#42;ScalarFunc = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</span></CodeLine>
<Link id="l06228" /><CodeLine lineNumber="6228"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarRetTy = CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l06229" /><CodeLine lineNumber="6229"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Type &#42;, 4&gt;</a> Tys, ScalarTys;</span></CodeLine>
<Link id="l06230" /><CodeLine lineNumber="6230"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;ArgOp : CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>())</span></CodeLine>
<Link id="l06231" /><CodeLine lineNumber="6231"><span class="doxyHighlight">        ScalarTys.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ArgOp-&gt;getType());</span></CodeLine>
<Link id="l06232" /><CodeLine lineNumber="6232"></CodeLine>
<Link id="l06233" /><CodeLine lineNumber="6233"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Estimate cost of scalarized vector call. The source operands are</span></CodeLine>
<Link id="l06234" /><CodeLine lineNumber="6234"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// assumed to be vectors, so we need to extract individual elements from</span></CodeLine>
<Link id="l06235" /><CodeLine lineNumber="6235"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// there, execute VF scalar calls, and then gather the result into the</span></CodeLine>
<Link id="l06236" /><CodeLine lineNumber="6236"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// vector return value.</span></CodeLine>
<Link id="l06237" /><CodeLine lineNumber="6237"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarCallCost =</span></CodeLine>
<Link id="l06238" /><CodeLine lineNumber="6238"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCallInstrCost(ScalarFunc, ScalarRetTy, ScalarTys, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l06239" /><CodeLine lineNumber="6239"></CodeLine>
<Link id="l06240" /><CodeLine lineNumber="6240"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Compute costs of unpacking argument values for the scalar calls and</span></CodeLine>
<Link id="l06241" /><CodeLine lineNumber="6241"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// packing the return values to a vector.</span></CodeLine>
<Link id="l06242" /><CodeLine lineNumber="6242"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarizationCost = getScalarizationOverhead(CI, VF);</span></CodeLine>
<Link id="l06243" /><CodeLine lineNumber="6243"></CodeLine>
<Link id="l06244" /><CodeLine lineNumber="6244"><span class="doxyHighlight">      ScalarCost = ScalarCallCost &#42; VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() + ScalarizationCost;</span></CodeLine>
<Link id="l06245" /><CodeLine lineNumber="6245"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Honor ForcedScalars and UniformAfterVectorization decisions.</span></CodeLine>
<Link id="l06246" /><CodeLine lineNumber="6246"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: For calls, it might still be more profitable to widen. Use</span></CodeLine>
<Link id="l06247" /><CodeLine lineNumber="6247"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// VPlan-based cost model to compare different options.</span></CodeLine>
<Link id="l06248" /><CodeLine lineNumber="6248"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; ((ForcedScalar != ForcedScalars.end() &amp;&amp;</span></CodeLine>
<Link id="l06249" /><CodeLine lineNumber="6249"><span class="doxyHighlight">                             ForcedScalar-&gt;second.contains(CI)) ||</span></CodeLine>
<Link id="l06250" /><CodeLine lineNumber="6250"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a20d7c96738b8f59692aec029895f8eb9">isUniformAfterVectorization</a>(CI, VF))) &#123;</span></CodeLine>
<Link id="l06251" /><CodeLine lineNumber="6251"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8e5bf6d340d3b3f704b6398996ae51c">setCallWideningDecision</a>(CI, VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06252" /><CodeLine lineNumber="6252"><span class="doxyHighlight">                                <a href="/docs/api/namespaces/llvm/intrinsic/#a35fedf4db6d756bd82501607f93c1e79aab5fb650050f184fa7c19c26abde5226">Intrinsic::not&#95;intrinsic</a>, std::nullopt,</span></CodeLine>
<Link id="l06253" /><CodeLine lineNumber="6253"><span class="doxyHighlight">                                ScalarCost);</span></CodeLine>
<Link id="l06254" /><CodeLine lineNumber="6254"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06255" /><CodeLine lineNumber="6255"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06256" /><CodeLine lineNumber="6256"></CodeLine>
<Link id="l06257" /><CodeLine lineNumber="6257"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> MaskRequired = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(CI);</span></CodeLine>
<Link id="l06258" /><CodeLine lineNumber="6258"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Compute corresponding vector type for return value and arguments.</span></CodeLine>
<Link id="l06259" /><CodeLine lineNumber="6259"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ScalarRetTy, VF);</span></CodeLine>
<Link id="l06260" /><CodeLine lineNumber="6260"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarTy : ScalarTys)</span></CodeLine>
<Link id="l06261" /><CodeLine lineNumber="6261"><span class="doxyHighlight">        Tys.push&#95;back(<a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ScalarTy, VF));</span></CodeLine>
<Link id="l06262" /><CodeLine lineNumber="6262"></CodeLine>
<Link id="l06263" /><CodeLine lineNumber="6263"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// An in-loop reduction using an fmuladd intrinsic is a special case;</span></CodeLine>
<Link id="l06264" /><CodeLine lineNumber="6264"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// we don&#39;t want the normal cost for that intrinsic.</span></CodeLine>
<Link id="l06265" /><CodeLine lineNumber="6265"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a08416fb970e8c177c7d78452d927c606">RecurrenceDescriptor::isFMulAddIntrinsic</a>(CI))</span></CodeLine>
<Link id="l06266" /><CodeLine lineNumber="6266"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4e307866e6d65e87d1e6884b0d13306c">getReductionPatternCost</a>(CI, VF, RetTy)) &#123;</span></CodeLine>
<Link id="l06267" /><CodeLine lineNumber="6267"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8e5bf6d340d3b3f704b6398996ae51c">setCallWideningDecision</a>(CI, VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a679b46cebdf2f87b9efd0413c960314a">CM&#95;IntrinsicCall</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06268" /><CodeLine lineNumber="6268"><span class="doxyHighlight">                                  <a href="/docs/api/namespaces/llvm/#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>),</span></CodeLine>
<Link id="l06269" /><CodeLine lineNumber="6269"><span class="doxyHighlight">                                  std::nullopt, &#42;RedCost);</span></CodeLine>
<Link id="l06270" /><CodeLine lineNumber="6270"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06271" /><CodeLine lineNumber="6271"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l06272" /><CodeLine lineNumber="6272"></CodeLine>
<Link id="l06273" /><CodeLine lineNumber="6273"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Find the cost of vectorizing the call, if we can find a suitable</span></CodeLine>
<Link id="l06274" /><CodeLine lineNumber="6274"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// vector variant of the function.</span></CodeLine>
<Link id="l06275" /><CodeLine lineNumber="6275"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/vfinfo">VFInfo</a> FuncInfo;</span></CodeLine>
<Link id="l06276" /><CodeLine lineNumber="6276"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/function">Function</a> &#42;VecFunc = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06277" /><CodeLine lineNumber="6277"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Search through any available variants for one we can use at this VF.</span></CodeLine>
<Link id="l06278" /><CodeLine lineNumber="6278"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/vfinfo">VFInfo</a> &amp;Info : <a href="/docs/api/classes/llvm/vfdatabase/#ab3e99bee894f145998d620d3d2a2f900">VFDatabase::getMappings</a>(&#42;CI)) &#123;</span></CodeLine>
<Link id="l06279" /><CodeLine lineNumber="6279"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Must match requested VF.</span></CodeLine>
<Link id="l06280" /><CodeLine lineNumber="6280"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Info.Shape.VF != VF)</span></CodeLine>
<Link id="l06281" /><CodeLine lineNumber="6281"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06282" /><CodeLine lineNumber="6282"></CodeLine>
<Link id="l06283" /><CodeLine lineNumber="6283"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Must take a mask argument if one is required</span></CodeLine>
<Link id="l06284" /><CodeLine lineNumber="6284"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaskRequired &amp;&amp; !Info.isMasked())</span></CodeLine>
<Link id="l06285" /><CodeLine lineNumber="6285"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06286" /><CodeLine lineNumber="6286"></CodeLine>
<Link id="l06287" /><CodeLine lineNumber="6287"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Check that all parameter kinds are supported</span></CodeLine>
<Link id="l06288" /><CodeLine lineNumber="6288"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ParamsOk = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06289" /><CodeLine lineNumber="6289"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/vfparameter">VFParameter</a> Param : Info.Shape.Parameters) &#123;</span></CodeLine>
<Link id="l06290" /><CodeLine lineNumber="6290"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Param.ParamKind) &#123;</span></CodeLine>
<Link id="l06291" /><CodeLine lineNumber="6291"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#add480f2ed87faa59c16d4c01ffb4bf39a57dea6f5039281b7fee517fc43bf3110">VFParamKind::Vector</a>:</span></CodeLine>
<Link id="l06292" /><CodeLine lineNumber="6292"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06293" /><CodeLine lineNumber="6293"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#add480f2ed87faa59c16d4c01ffb4bf39acbf35bbdad5d09f9072d0e83e78e90e4">VFParamKind::OMP&#95;Uniform</a>: &#123;</span></CodeLine>
<Link id="l06294" /><CodeLine lineNumber="6294"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/value">Value</a> &#42;ScalarParam = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(Param.ParamPos);</span></CodeLine>
<Link id="l06295" /><CodeLine lineNumber="6295"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Make sure the scalar parameter in the loop is invariant.</span></CodeLine>
<Link id="l06296" /><CodeLine lineNumber="6296"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE()-&gt;isLoopInvariant(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSCEV(ScalarParam),</span></CodeLine>
<Link id="l06297" /><CodeLine lineNumber="6297"><span class="doxyHighlight">                                              <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>))</span></CodeLine>
<Link id="l06298" /><CodeLine lineNumber="6298"><span class="doxyHighlight">              ParamsOk = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06299" /><CodeLine lineNumber="6299"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06300" /><CodeLine lineNumber="6300"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l06301" /><CodeLine lineNumber="6301"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#add480f2ed87faa59c16d4c01ffb4bf39a16454c62ab71c641dedda0971980c9d5">VFParamKind::OMP&#95;Linear</a>: &#123;</span></CodeLine>
<Link id="l06302" /><CodeLine lineNumber="6302"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/value">Value</a> &#42;ScalarParam = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(Param.ParamPos);</span></CodeLine>
<Link id="l06303" /><CodeLine lineNumber="6303"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// Find the stride for the scalar parameter in this loop and see if</span></CodeLine>
<Link id="l06304" /><CodeLine lineNumber="6304"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// it matches the stride for the variant.</span></CodeLine>
<Link id="l06305" /><CodeLine lineNumber="6305"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// TODO: do we need to figure out the cost of an extract to get the</span></CodeLine>
<Link id="l06306" /><CodeLine lineNumber="6306"><span class="doxyHighlight">            </span><span class="doxyHighlightComment">// first lane? Or do we hope that it will be folded away?</span></CodeLine>
<Link id="l06307" /><CodeLine lineNumber="6307"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE();</span></CodeLine>
<Link id="l06308" /><CodeLine lineNumber="6308"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SAR =</span></CodeLine>
<Link id="l06309" /><CodeLine lineNumber="6309"><span class="doxyHighlight">                <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(ScalarParam));</span></CodeLine>
<Link id="l06310" /><CodeLine lineNumber="6310"></CodeLine>
<Link id="l06311" /><CodeLine lineNumber="6311"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!SAR || SAR-&gt;getLoop() != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>) &#123;</span></CodeLine>
<Link id="l06312" /><CodeLine lineNumber="6312"><span class="doxyHighlight">              ParamsOk = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06313" /><CodeLine lineNumber="6313"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06314" /><CodeLine lineNumber="6314"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l06315" /><CodeLine lineNumber="6315"></CodeLine>
<Link id="l06316" /><CodeLine lineNumber="6316"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scevconstant">SCEVConstant</a> &#42;Step =</span></CodeLine>
<Link id="l06317" /><CodeLine lineNumber="6317"><span class="doxyHighlight">                <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(SAR-&gt;getStepRecurrence(&#42;SE));</span></CodeLine>
<Link id="l06318" /><CodeLine lineNumber="6318"></CodeLine>
<Link id="l06319" /><CodeLine lineNumber="6319"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Step ||</span></CodeLine>
<Link id="l06320" /><CodeLine lineNumber="6320"><span class="doxyHighlight">                Step-&gt;<a href="/docs/api/classes/llvm/scevconstant/#a6caf7f3a0a4303e4c0bc06ed8e205126">getAPInt</a>().<a href="/docs/api/classes/llvm/apint/#af2daa0ee117afefed4c82eee55bf97b7">getSExtValue</a>() != Param.LinearStepOrPos)</span></CodeLine>
<Link id="l06321" /><CodeLine lineNumber="6321"><span class="doxyHighlight">              ParamsOk = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06322" /><CodeLine lineNumber="6322"></CodeLine>
<Link id="l06323" /><CodeLine lineNumber="6323"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06324" /><CodeLine lineNumber="6324"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l06325" /><CodeLine lineNumber="6325"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#add480f2ed87faa59c16d4c01ffb4bf39adf3e3249ad10ccf5bf901eb83c105cc3">VFParamKind::GlobalPredicate</a>:</span></CodeLine>
<Link id="l06326" /><CodeLine lineNumber="6326"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06327" /><CodeLine lineNumber="6327"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l06328" /><CodeLine lineNumber="6328"><span class="doxyHighlight">            ParamsOk = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06329" /><CodeLine lineNumber="6329"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06330" /><CodeLine lineNumber="6330"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l06331" /><CodeLine lineNumber="6331"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l06332" /><CodeLine lineNumber="6332"></CodeLine>
<Link id="l06333" /><CodeLine lineNumber="6333"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ParamsOk)</span></CodeLine>
<Link id="l06334" /><CodeLine lineNumber="6334"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06335" /><CodeLine lineNumber="6335"></CodeLine>
<Link id="l06336" /><CodeLine lineNumber="6336"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Found a suitable candidate, stop here.</span></CodeLine>
<Link id="l06337" /><CodeLine lineNumber="6337"><span class="doxyHighlight">        VecFunc = CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>()-&gt;<a href="/docs/api/classes/llvm/module/#a209a615a3a32241323420cca24b5520a">getFunction</a>(Info.VectorName);</span></CodeLine>
<Link id="l06338" /><CodeLine lineNumber="6338"><span class="doxyHighlight">        FuncInfo = Info;</span></CodeLine>
<Link id="l06339" /><CodeLine lineNumber="6339"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06340" /><CodeLine lineNumber="6340"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06341" /><CodeLine lineNumber="6341"></CodeLine>
<Link id="l06342" /><CodeLine lineNumber="6342"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a> &amp;&amp; VecFunc &amp;&amp; !CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a1fb374eb65dcf7cd3d1671efb2616f76">isNoBuiltin</a>())</span></CodeLine>
<Link id="l06343" /><CodeLine lineNumber="6343"><span class="doxyHighlight">        VectorCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCallInstrCost(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, RetTy, Tys, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l06344" /><CodeLine lineNumber="6344"></CodeLine>
<Link id="l06345" /><CodeLine lineNumber="6345"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Find the cost of an intrinsic; some targets may have instructions that</span></CodeLine>
<Link id="l06346" /><CodeLine lineNumber="6346"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// perform the operation without needing an actual call.</span></CodeLine>
<Link id="l06347" /><CodeLine lineNumber="6347"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID = <a href="/docs/api/namespaces/llvm/#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>);</span></CodeLine>
<Link id="l06348" /><CodeLine lineNumber="6348"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IID != <a href="/docs/api/namespaces/llvm/intrinsic/#a35fedf4db6d756bd82501607f93c1e79aab5fb650050f184fa7c19c26abde5226">Intrinsic::not&#95;intrinsic</a>)</span></CodeLine>
<Link id="l06349" /><CodeLine lineNumber="6349"><span class="doxyHighlight">        IntrinsicCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5abced3ab870d7abf57f2b35a02cd041">getVectorIntrinsicCost</a>(CI, VF);</span></CodeLine>
<Link id="l06350" /><CodeLine lineNumber="6350"></CodeLine>
<Link id="l06351" /><CodeLine lineNumber="6351"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = ScalarCost;</span></CodeLine>
<Link id="l06352" /><CodeLine lineNumber="6352"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>;</span></CodeLine>
<Link id="l06353" /><CodeLine lineNumber="6353"></CodeLine>
<Link id="l06354" /><CodeLine lineNumber="6354"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VectorCost &lt;= <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>) &#123;</span></CodeLine>
<Link id="l06355" /><CodeLine lineNumber="6355"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = VectorCost;</span></CodeLine>
<Link id="l06356" /><CodeLine lineNumber="6356"><span class="doxyHighlight">        Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ab6fd5f45ab6e363de6c3f42472d439ac">CM&#95;VectorCall</a>;</span></CodeLine>
<Link id="l06357" /><CodeLine lineNumber="6357"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06358" /><CodeLine lineNumber="6358"></CodeLine>
<Link id="l06359" /><CodeLine lineNumber="6359"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IntrinsicCost &lt;= <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>) &#123;</span></CodeLine>
<Link id="l06360" /><CodeLine lineNumber="6360"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = IntrinsicCost;</span></CodeLine>
<Link id="l06361" /><CodeLine lineNumber="6361"><span class="doxyHighlight">        Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a679b46cebdf2f87b9efd0413c960314a">CM&#95;IntrinsicCall</a>;</span></CodeLine>
<Link id="l06362" /><CodeLine lineNumber="6362"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06363" /><CodeLine lineNumber="6363"></CodeLine>
<Link id="l06364" /><CodeLine lineNumber="6364"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8e5bf6d340d3b3f704b6398996ae51c">setCallWideningDecision</a>(CI, VF, Decision, VecFunc, IID,</span></CodeLine>
<Link id="l06365" /><CodeLine lineNumber="6365"><span class="doxyHighlight">                              FuncInfo.getParamIndexForOptionalMask(), <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>);</span></CodeLine>
<Link id="l06366" /><CodeLine lineNumber="6366"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06367" /><CodeLine lineNumber="6367"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06368" /><CodeLine lineNumber="6368"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06369" /><CodeLine lineNumber="6369"></CodeLine>
<Link id="l06370" /><CodeLine lineNumber="6370" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#aadd9a9d699ede62468422c7cfab66e99"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aadd9a9d699ede62468422c7cfab66e99">LoopVectorizationCostModel::shouldConsiderInvariant</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123;</span></CodeLine>
<Link id="l06371" /><CodeLine lineNumber="6371"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInvariant(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</span></CodeLine>
<Link id="l06372" /><CodeLine lineNumber="6372"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06373" /><CodeLine lineNumber="6373"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Consider Op invariant, if it or its operands aren&#39;t predicated</span></CodeLine>
<Link id="l06374" /><CodeLine lineNumber="6374"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instruction in the loop. In that case, it is not trivially hoistable.</span></CodeLine>
<Link id="l06375" /><CodeLine lineNumber="6375"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l06376" /><CodeLine lineNumber="6376"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !OpI || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(OpI) ||</span></CodeLine>
<Link id="l06377" /><CodeLine lineNumber="6377"><span class="doxyHighlight">         (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">isPredicatedInst</a>(OpI) &amp;&amp;</span></CodeLine>
<Link id="l06378" /><CodeLine lineNumber="6378"><span class="doxyHighlight">          (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(OpI) || OpI-&gt;getParent() != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getHeader()) &amp;&amp;</span></CodeLine>
<Link id="l06379" /><CodeLine lineNumber="6379"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(OpI-&gt;operands(),</span></CodeLine>
<Link id="l06380" /><CodeLine lineNumber="6380"><span class="doxyHighlight">                 &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123; return shouldConsiderInvariant(Op); &#125;));</span></CodeLine>
<Link id="l06381" /><CodeLine lineNumber="6381"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06382" /><CodeLine lineNumber="6382"></CodeLine>
<Link id="l06383" /><CodeLine lineNumber="6383"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></span></CodeLine>
<Link id="l06384" /><CodeLine lineNumber="6384" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a556ec90a0fa1e168a9f22db1deb1fee6"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a556ec90a0fa1e168a9f22db1deb1fee6">LoopVectorizationCostModel::getInstructionCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l06385" /><CodeLine lineNumber="6385"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</span></CodeLine>
<Link id="l06386" /><CodeLine lineNumber="6386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we know that this instruction will remain uniform, check the cost of</span></CodeLine>
<Link id="l06387" /><CodeLine lineNumber="6387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the scalar version.</span></CodeLine>
<Link id="l06388" /><CodeLine lineNumber="6388"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a20d7c96738b8f59692aec029895f8eb9">isUniformAfterVectorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</span></CodeLine>
<Link id="l06389" /><CodeLine lineNumber="6389"><span class="doxyHighlight">    VF = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1);</span></CodeLine>
<Link id="l06390" /><CodeLine lineNumber="6390"></CodeLine>
<Link id="l06391" /><CodeLine lineNumber="6391"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9a6fbca8c965adeb8016a03ca3de2cac">isProfitableToScalarize</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</span></CodeLine>
<Link id="l06392" /><CodeLine lineNumber="6392"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> InstsToScalarize&#91;VF&#93;&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l06393" /><CodeLine lineNumber="6393"></CodeLine>
<Link id="l06394" /><CodeLine lineNumber="6394"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Forced scalars do not have any scalarization overhead.</span></CodeLine>
<Link id="l06395" /><CodeLine lineNumber="6395"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ForcedScalar = ForcedScalars.find(VF);</span></CodeLine>
<Link id="l06396" /><CodeLine lineNumber="6396"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; ForcedScalar != ForcedScalars.end()) &#123;</span></CodeLine>
<Link id="l06397" /><CodeLine lineNumber="6397"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> InstSet = ForcedScalar-&gt;second;</span></CodeLine>
<Link id="l06398" /><CodeLine lineNumber="6398"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InstSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l06399" /><CodeLine lineNumber="6399"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a556ec90a0fa1e168a9f22db1deb1fee6">getInstructionCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1)) &#42;</span></CodeLine>
<Link id="l06400" /><CodeLine lineNumber="6400"><span class="doxyHighlight">             VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>();</span></CodeLine>
<Link id="l06401" /><CodeLine lineNumber="6401"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06402" /><CodeLine lineNumber="6402"></CodeLine>
<Link id="l06403" /><CodeLine lineNumber="6403"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType();</span></CodeLine>
<Link id="l06404" /><CodeLine lineNumber="6404"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa8c00664c6be2042407f13e4fcad950b">canTruncateToMinimalBitwidth</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</span></CodeLine>
<Link id="l06405" /><CodeLine lineNumber="6405"><span class="doxyHighlight">    RetTy = <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(RetTy-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>(), MinBWs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</span></CodeLine>
<Link id="l06406" /><CodeLine lineNumber="6406"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SE = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE();</span></CodeLine>
<Link id="l06407" /><CodeLine lineNumber="6407"></CodeLine>
<Link id="l06408" /><CodeLine lineNumber="6408"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> HasSingleCopyAfterVectorization = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l06409" /><CodeLine lineNumber="6409"><span class="doxyHighlight">                                                <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l06410" /><CodeLine lineNumber="6410"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</span></CodeLine>
<Link id="l06411" /><CodeLine lineNumber="6411"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06412" /><CodeLine lineNumber="6412"></CodeLine>
<Link id="l06413" /><CodeLine lineNumber="6413"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Scalarized = InstsToScalarize.find(VF);</span></CodeLine>
<Link id="l06414" /><CodeLine lineNumber="6414"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Scalarized != InstsToScalarize.end() &amp;&amp;</span></CodeLine>
<Link id="l06415" /><CodeLine lineNumber="6415"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;VF not yet analyzed for scalarization profitability&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06416" /><CodeLine lineNumber="6416"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !Scalarized-&gt;second.count(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l06417" /><CodeLine lineNumber="6417"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users(), &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</span></CodeLine>
<Link id="l06418" /><CodeLine lineNumber="6418"><span class="doxyHighlight">             auto &#42;UI = cast&lt;Instruction&gt;(U);</span></CodeLine>
<Link id="l06419" /><CodeLine lineNumber="6419"><span class="doxyHighlight">             return !Scalarized-&gt;second.count(UI);</span></CodeLine>
<Link id="l06420" /><CodeLine lineNumber="6420"><span class="doxyHighlight">           &#125;);</span></CodeLine>
<Link id="l06421" /><CodeLine lineNumber="6421"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l06422" /><CodeLine lineNumber="6422"><span class="doxyHighlight">  (void)HasSingleCopyAfterVectorization;</span></CodeLine>
<Link id="l06423" /><CodeLine lineNumber="6423"></CodeLine>
<Link id="l06424" /><CodeLine lineNumber="6424"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;VectorTy;</span></CodeLine>
<Link id="l06425" /><CodeLine lineNumber="6425"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</span></CodeLine>
<Link id="l06426" /><CodeLine lineNumber="6426"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// With the exception of GEPs and PHIs, after scalarization there should</span></CodeLine>
<Link id="l06427" /><CodeLine lineNumber="6427"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// only be one copy of the instruction generated in the loop. This is</span></CodeLine>
<Link id="l06428" /><CodeLine lineNumber="6428"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// because the VF is either 1, or any instructions that need scalarizing</span></CodeLine>
<Link id="l06429" /><CodeLine lineNumber="6429"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// have already been dealt with by the time we get here. As a result,</span></CodeLine>
<Link id="l06430" /><CodeLine lineNumber="6430"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// it means we don&#39;t have to multiply the instruction cost by VF.</span></CodeLine>
<Link id="l06431" /><CodeLine lineNumber="6431"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::GetElementPtr ||</span></CodeLine>
<Link id="l06432" /><CodeLine lineNumber="6432"><span class="doxyHighlight">           <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::PHI ||</span></CodeLine>
<Link id="l06433" /><CodeLine lineNumber="6433"><span class="doxyHighlight">           (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::BitCast &amp;&amp;</span></CodeLine>
<Link id="l06434" /><CodeLine lineNumber="6434"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isPointerTy()) ||</span></CodeLine>
<Link id="l06435" /><CodeLine lineNumber="6435"><span class="doxyHighlight">           HasSingleCopyAfterVectorization(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF));</span></CodeLine>
<Link id="l06436" /><CodeLine lineNumber="6436"><span class="doxyHighlight">    VectorTy = RetTy;</span></CodeLine>
<Link id="l06437" /><CodeLine lineNumber="6437"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l06438" /><CodeLine lineNumber="6438"><span class="doxyHighlight">    VectorTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(RetTy, VF);</span></CodeLine>
<Link id="l06439" /><CodeLine lineNumber="6439"></CodeLine>
<Link id="l06440" /><CodeLine lineNumber="6440"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; VectorTy-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp;</span></CodeLine>
<Link id="l06441" /><CodeLine lineNumber="6441"><span class="doxyHighlight">      !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getNumberOfParts(VectorTy))</span></CodeLine>
<Link id="l06442" /><CodeLine lineNumber="6442"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l06443" /><CodeLine lineNumber="6443"></CodeLine>
<Link id="l06444" /><CodeLine lineNumber="6444"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: We need to estimate the cost of intrinsic calls.</span></CodeLine>
<Link id="l06445" /><CodeLine lineNumber="6445"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l06446" /><CodeLine lineNumber="6446"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::GetElementPtr:</span></CodeLine>
<Link id="l06447" /><CodeLine lineNumber="6447"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We mark this instruction as zero-cost because the cost of GEPs in</span></CodeLine>
<Link id="l06448" /><CodeLine lineNumber="6448"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// vectorized code depends on whether the corresponding memory instruction</span></CodeLine>
<Link id="l06449" /><CodeLine lineNumber="6449"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is scalarized or not. Therefore, we handle GEPs with the memory</span></CodeLine>
<Link id="l06450" /><CodeLine lineNumber="6450"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instruction cost.</span></CodeLine>
<Link id="l06451" /><CodeLine lineNumber="6451"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l06452" /><CodeLine lineNumber="6452"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Br: &#123;</span></CodeLine>
<Link id="l06453" /><CodeLine lineNumber="6453"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In cases of scalarized and predicated instructions, there will be VF</span></CodeLine>
<Link id="l06454" /><CodeLine lineNumber="6454"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predicated blocks in the vectorized loop. Each branch around these</span></CodeLine>
<Link id="l06455" /><CodeLine lineNumber="6455"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// blocks requires also an extract of its vector compare i1 element.</span></CodeLine>
<Link id="l06456" /><CodeLine lineNumber="6456"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note that the conditional branch from the loop latch will be replaced by</span></CodeLine>
<Link id="l06457" /><CodeLine lineNumber="6457"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a single branch controlling the loop, so there is no extra overhead from</span></CodeLine>
<Link id="l06458" /><CodeLine lineNumber="6458"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scalarization.</span></CodeLine>
<Link id="l06459" /><CodeLine lineNumber="6459"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ScalarPredicatedBB = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06460" /><CodeLine lineNumber="6460"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06461" /><CodeLine lineNumber="6461"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp;</span></CodeLine>
<Link id="l06462" /><CodeLine lineNumber="6462"><span class="doxyHighlight">        (PredicatedBBsAfterVectorization&#91;VF&#93;.count(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)) ||</span></CodeLine>
<Link id="l06463" /><CodeLine lineNumber="6463"><span class="doxyHighlight">         PredicatedBBsAfterVectorization&#91;VF&#93;.count(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1))) &amp;&amp;</span></CodeLine>
<Link id="l06464" /><CodeLine lineNumber="6464"><span class="doxyHighlight">        BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getLoopLatch())</span></CodeLine>
<Link id="l06465" /><CodeLine lineNumber="6465"><span class="doxyHighlight">      ScalarPredicatedBB = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06466" /><CodeLine lineNumber="6466"></CodeLine>
<Link id="l06467" /><CodeLine lineNumber="6467"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ScalarPredicatedBB) &#123;</span></CodeLine>
<Link id="l06468" /><CodeLine lineNumber="6468"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Not possible to scalarize scalable vector with predicated instructions.</span></CodeLine>
<Link id="l06469" /><CodeLine lineNumber="6469"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</span></CodeLine>
<Link id="l06470" /><CodeLine lineNumber="6470"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l06471" /><CodeLine lineNumber="6471"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Return cost for branches around scalarized and predicated blocks.</span></CodeLine>
<Link id="l06472" /><CodeLine lineNumber="6472"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VecI1Ty =</span></CodeLine>
<Link id="l06473" /><CodeLine lineNumber="6473"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">IntegerType::getInt1Ty</a>(RetTy-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>()), VF);</span></CodeLine>
<Link id="l06474" /><CodeLine lineNumber="6474"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (</span></CodeLine>
<Link id="l06475" /><CodeLine lineNumber="6475"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getScalarizationOverhead(</span></CodeLine>
<Link id="l06476" /><CodeLine lineNumber="6476"><span class="doxyHighlight">              VecI1Ty, <a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>()),</span></CodeLine>
<Link id="l06477" /><CodeLine lineNumber="6477"><span class="doxyHighlight">              </span><span class="doxyHighlightComment">/&#42;Insert&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightComment">/&#42;Extract&#42;/</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>) +</span></CodeLine>
<Link id="l06478" /><CodeLine lineNumber="6478"><span class="doxyHighlight">          (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCFInstrCost(Instruction::Br, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>) &#42; VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>()));</span></CodeLine>
<Link id="l06479" /><CodeLine lineNumber="6479"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06480" /><CodeLine lineNumber="6480"></CodeLine>
<Link id="l06481" /><CodeLine lineNumber="6481"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getLoopLatch() || VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</span></CodeLine>
<Link id="l06482" /><CodeLine lineNumber="6482"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The back-edge branch will remain, as will all scalar branches.</span></CodeLine>
<Link id="l06483" /><CodeLine lineNumber="6483"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCFInstrCost(Instruction::Br, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l06484" /><CodeLine lineNumber="6484"></CodeLine>
<Link id="l06485" /><CodeLine lineNumber="6485"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This branch will be eliminated by if-conversion.</span></CodeLine>
<Link id="l06486" /><CodeLine lineNumber="6486"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l06487" /><CodeLine lineNumber="6487"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Note: We currently assume zero cost for an unconditional branch inside</span></CodeLine>
<Link id="l06488" /><CodeLine lineNumber="6488"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// a predicated block since it will become a fall-through, although we</span></CodeLine>
<Link id="l06489" /><CodeLine lineNumber="6489"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// may decide in the future to call TTI for all branches.</span></CodeLine>
<Link id="l06490" /><CodeLine lineNumber="6490"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06491" /><CodeLine lineNumber="6491"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Switch: &#123;</span></CodeLine>
<Link id="l06492" /><CodeLine lineNumber="6492"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</span></CodeLine>
<Link id="l06493" /><CodeLine lineNumber="6493"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCFInstrCost(Instruction::Switch, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l06494" /><CodeLine lineNumber="6494"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Switch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SwitchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06495" /><CodeLine lineNumber="6495"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Switch-&gt;getNumCases() &#42;</span></CodeLine>
<Link id="l06496" /><CodeLine lineNumber="6496"><span class="doxyHighlight">           <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCmpSelInstrCost(</span></CodeLine>
<Link id="l06497" /><CodeLine lineNumber="6497"><span class="doxyHighlight">               Instruction::ICmp,</span></CodeLine>
<Link id="l06498" /><CodeLine lineNumber="6498"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(Switch-&gt;getCondition()-&gt;getType(), VF),</span></CodeLine>
<Link id="l06499" /><CodeLine lineNumber="6499"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext()), VF),</span></CodeLine>
<Link id="l06500" /><CodeLine lineNumber="6500"><span class="doxyHighlight">               <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP&#95;EQ</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l06501" /><CodeLine lineNumber="6501"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06502" /><CodeLine lineNumber="6502"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::PHI: &#123;</span></CodeLine>
<Link id="l06503" /><CodeLine lineNumber="6503"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06504" /><CodeLine lineNumber="6504"></CodeLine>
<Link id="l06505" /><CodeLine lineNumber="6505"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// First-order recurrences are replaced by vector shuffles inside the loop.</span></CodeLine>
<Link id="l06506" /><CodeLine lineNumber="6506"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isFixedOrderRecurrence(Phi)) &#123;</span></CodeLine>
<Link id="l06507" /><CodeLine lineNumber="6507"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For &lt;vscale x 1 x i64&gt;, if vscale = 1 we are unable to extract the</span></CodeLine>
<Link id="l06508" /><CodeLine lineNumber="6508"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// penultimate value of the recurrence.</span></CodeLine>
<Link id="l06509" /><CodeLine lineNumber="6509"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: Consider vscale&#95;range info.</span></CodeLine>
<Link id="l06510" /><CodeLine lineNumber="6510"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp; VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() == 1)</span></CodeLine>
<Link id="l06511" /><CodeLine lineNumber="6511"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l06512" /><CodeLine lineNumber="6512"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int&gt;</a> Mask(VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>());</span></CodeLine>
<Link id="l06513" /><CodeLine lineNumber="6513"><span class="doxyHighlight">      std::iota(Mask.begin(), Mask.end(), VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() - 1);</span></CodeLine>
<Link id="l06514" /><CodeLine lineNumber="6514"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getShuffleCost(<a href="/docs/api/classes/llvm/targettransforminfo/#af46433d0e36d3f80afc3a8c67b5c53ecaa9e18b2636661e341804da24971997df">TargetTransformInfo::SK&#95;Splice</a>,</span></CodeLine>
<Link id="l06515" /><CodeLine lineNumber="6515"><span class="doxyHighlight">                                <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(VectorTy), Mask, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>,</span></CodeLine>
<Link id="l06516" /><CodeLine lineNumber="6516"><span class="doxyHighlight">                                VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() - 1);</span></CodeLine>
<Link id="l06517" /><CodeLine lineNumber="6517"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06518" /><CodeLine lineNumber="6518"></CodeLine>
<Link id="l06519" /><CodeLine lineNumber="6519"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Phi nodes in non-header blocks (not inductions, reductions, etc.) are</span></CodeLine>
<Link id="l06520" /><CodeLine lineNumber="6520"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// converted into select instructions. We require N - 1 selects per phi</span></CodeLine>
<Link id="l06521" /><CodeLine lineNumber="6521"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// node, where N is the number of incoming values.</span></CodeLine>
<Link id="l06522" /><CodeLine lineNumber="6522"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; Phi-&gt;getParent() != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getHeader()) &#123;</span></CodeLine>
<Link id="l06523" /><CodeLine lineNumber="6523"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;ResultTy = Phi-&gt;getType();</span></CodeLine>
<Link id="l06524" /><CodeLine lineNumber="6524"></CodeLine>
<Link id="l06525" /><CodeLine lineNumber="6525"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// All instructions in an Any-of reduction chain are narrowed to bool.</span></CodeLine>
<Link id="l06526" /><CodeLine lineNumber="6526"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Check if that is the case for this phi node.</span></CodeLine>
<Link id="l06527" /><CodeLine lineNumber="6527"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;HeaderUser = <a href="/docs/api/namespaces/llvm/#a07be078de4a2c223bd6a76e24e1c02db">cast&#95;if&#95;present&lt;PHINode&gt;</a>(</span></CodeLine>
<Link id="l06528" /><CodeLine lineNumber="6528"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a8f6975e193997c4e0183e96774a7cb39">find&#95;singleton&lt;User&gt;</a>(Phi-&gt;users(), &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight">) -&gt; <a href="/docs/api/classes/llvm/user">User</a> &#42; &#123;</span></CodeLine>
<Link id="l06529" /><CodeLine lineNumber="6529"><span class="doxyHighlight">            auto &#42;Phi = dyn&#95;cast&lt;PHINode&gt;(U);</span></CodeLine>
<Link id="l06530" /><CodeLine lineNumber="6530"><span class="doxyHighlight">            if (Phi &amp;&amp; Phi-&gt;getParent() == TheLoop-&gt;getHeader())</span></CodeLine>
<Link id="l06531" /><CodeLine lineNumber="6531"><span class="doxyHighlight">              return Phi;</span></CodeLine>
<Link id="l06532" /><CodeLine lineNumber="6532"><span class="doxyHighlight">            return nullptr;</span></CodeLine>
<Link id="l06533" /><CodeLine lineNumber="6533"><span class="doxyHighlight">          &#125;));</span></CodeLine>
<Link id="l06534" /><CodeLine lineNumber="6534"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (HeaderUser) &#123;</span></CodeLine>
<Link id="l06535" /><CodeLine lineNumber="6535"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;ReductionVars = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars();</span></CodeLine>
<Link id="l06536" /><CodeLine lineNumber="6536"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Iter = ReductionVars.find(HeaderUser);</span></CodeLine>
<Link id="l06537" /><CodeLine lineNumber="6537"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Iter != ReductionVars.end() &amp;&amp;</span></CodeLine>
<Link id="l06538" /><CodeLine lineNumber="6538"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/recurrencedescriptor/#a69df67c7d92481ae63a5d8017e96c716">RecurrenceDescriptor::isAnyOfRecurrenceKind</a>(</span></CodeLine>
<Link id="l06539" /><CodeLine lineNumber="6539"><span class="doxyHighlight">                Iter-&gt;second.getRecurrenceKind()))</span></CodeLine>
<Link id="l06540" /><CodeLine lineNumber="6540"><span class="doxyHighlight">          ResultTy = <a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(Phi-&gt;getContext());</span></CodeLine>
<Link id="l06541" /><CodeLine lineNumber="6541"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06542" /><CodeLine lineNumber="6542"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> (Phi-&gt;getNumIncomingValues() - 1) &#42;</span></CodeLine>
<Link id="l06543" /><CodeLine lineNumber="6543"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCmpSelInstrCost(</span></CodeLine>
<Link id="l06544" /><CodeLine lineNumber="6544"><span class="doxyHighlight">                 Instruction::Select, <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ResultTy, VF),</span></CodeLine>
<Link id="l06545" /><CodeLine lineNumber="6545"><span class="doxyHighlight">                 <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(Phi-&gt;getContext()), VF),</span></CodeLine>
<Link id="l06546" /><CodeLine lineNumber="6546"><span class="doxyHighlight">                 <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">CmpInst::BAD&#95;ICMP&#95;PREDICATE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l06547" /><CodeLine lineNumber="6547"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06548" /><CodeLine lineNumber="6548"></CodeLine>
<Link id="l06549" /><CodeLine lineNumber="6549"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// When tail folding with EVL, if the phi is part of an out of loop</span></CodeLine>
<Link id="l06550" /><CodeLine lineNumber="6550"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// reduction then it will be transformed into a wide vp&#95;merge.</span></CodeLine>
<Link id="l06551" /><CodeLine lineNumber="6551"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab0c7e793ca1b6b8a4f8c00a1bc1cb32f">foldTailWithEVL</a>() &amp;&amp;</span></CodeLine>
<Link id="l06552" /><CodeLine lineNumber="6552"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars().contains(Phi) &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9819226a3ff242635fd99bf22b50bd97">isInLoopReduction</a>(Phi)) &#123;</span></CodeLine>
<Link id="l06553" /><CodeLine lineNumber="6553"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/intrinsiccostattributes">IntrinsicCostAttributes</a> ICA(</span></CodeLine>
<Link id="l06554" /><CodeLine lineNumber="6554"><span class="doxyHighlight">          Intrinsic::vp&#95;merge, <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(Phi-&gt;getType(), VF),</span></CodeLine>
<Link id="l06555" /><CodeLine lineNumber="6555"><span class="doxyHighlight">          &#123;toVectorTy(Type::getInt1Ty(Phi-&gt;getContext()), VF)&#125;);</span></CodeLine>
<Link id="l06556" /><CodeLine lineNumber="6556"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getIntrinsicInstrCost(ICA, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l06557" /><CodeLine lineNumber="6557"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06558" /><CodeLine lineNumber="6558"></CodeLine>
<Link id="l06559" /><CodeLine lineNumber="6559"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCFInstrCost(Instruction::PHI, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l06560" /><CodeLine lineNumber="6560"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06561" /><CodeLine lineNumber="6561"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::UDiv:</span></CodeLine>
<Link id="l06562" /><CodeLine lineNumber="6562"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SDiv:</span></CodeLine>
<Link id="l06563" /><CodeLine lineNumber="6563"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::URem:</span></CodeLine>
<Link id="l06564" /><CodeLine lineNumber="6564"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SRem:</span></CodeLine>
<Link id="l06565" /><CodeLine lineNumber="6565"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">isPredicatedInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l06566" /><CodeLine lineNumber="6566"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;ScalarCost, SafeDivisorCost&#93; = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad8398a35cd187d6a75b460fcf54b5236">getDivRemSpeculationCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l06567" /><CodeLine lineNumber="6567"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#add43c346a11ae1deb49142ba968eb07e">isDivRemScalarWithPredication</a>(ScalarCost, SafeDivisorCost) ?</span></CodeLine>
<Link id="l06568" /><CodeLine lineNumber="6568"><span class="doxyHighlight">        ScalarCost : SafeDivisorCost;</span></CodeLine>
<Link id="l06569" /><CodeLine lineNumber="6569"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06570" /><CodeLine lineNumber="6570"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We&#39;ve proven all lanes safe to speculate, fall through.</span></CodeLine>
<Link id="l06571" /><CodeLine lineNumber="6571"><span class="doxyHighlight">    &#91;&#91;fallthrough&#93;&#93;;</span></CodeLine>
<Link id="l06572" /><CodeLine lineNumber="6572"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Add:</span></CodeLine>
<Link id="l06573" /><CodeLine lineNumber="6573"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Sub: &#123;</span></CodeLine>
<Link id="l06574" /><CodeLine lineNumber="6574"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Info = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getHistogramInfo(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06575" /><CodeLine lineNumber="6575"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Info &amp;&amp; VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()) &#123;</span></CodeLine>
<Link id="l06576" /><CodeLine lineNumber="6576"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/histograminfo">HistogramInfo</a> &#42;HGram = Info.value();</span></CodeLine>
<Link id="l06577" /><CodeLine lineNumber="6577"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Assume that a non-constant update value (or a constant != 1) requires</span></CodeLine>
<Link id="l06578" /><CodeLine lineNumber="6578"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// a multiply, and add that into the cost.</span></CodeLine>
<Link id="l06579" /><CodeLine lineNumber="6579"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> MulCost = <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272ca89f768b1267e3083b4eb05b4ab77e717">TTI::TCC&#95;Free</a>;</span></CodeLine>
<Link id="l06580" /><CodeLine lineNumber="6580"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;RHS = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</span></CodeLine>
<Link id="l06581" /><CodeLine lineNumber="6581"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!RHS || RHS-&gt;getZExtValue() != 1)</span></CodeLine>
<Link id="l06582" /><CodeLine lineNumber="6582"><span class="doxyHighlight">        MulCost =</span></CodeLine>
<Link id="l06583" /><CodeLine lineNumber="6583"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(Instruction::Mul, VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l06584" /><CodeLine lineNumber="6584"></CodeLine>
<Link id="l06585" /><CodeLine lineNumber="6585"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Find the cost of the histogram operation itself.</span></CodeLine>
<Link id="l06586" /><CodeLine lineNumber="6586"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;PtrTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(HGram-&gt;<a href="/docs/api/structs/llvm/histograminfo/#a18ad617fc2ebb0c359d7a7364a226926">Load</a>-&gt;<a href="/docs/api/classes/llvm/loadinst/#a945c21ff70f310de538153db17e7b857">getPointerOperandType</a>(), VF);</span></CodeLine>
<Link id="l06587" /><CodeLine lineNumber="6587"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarTy = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType();</span></CodeLine>
<Link id="l06588" /><CodeLine lineNumber="6588"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;MaskTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext()), VF);</span></CodeLine>
<Link id="l06589" /><CodeLine lineNumber="6589"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/intrinsiccostattributes">IntrinsicCostAttributes</a> ICA(Intrinsic::experimental&#95;vector&#95;histogram&#95;add,</span></CodeLine>
<Link id="l06590" /><CodeLine lineNumber="6590"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/type/#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext()),</span></CodeLine>
<Link id="l06591" /><CodeLine lineNumber="6591"><span class="doxyHighlight">                                  &#123;PtrTy, ScalarTy, MaskTy&#125;);</span></CodeLine>
<Link id="l06592" /><CodeLine lineNumber="6592"></CodeLine>
<Link id="l06593" /><CodeLine lineNumber="6593"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add the costs together with the add/sub operation.</span></CodeLine>
<Link id="l06594" /><CodeLine lineNumber="6594"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getIntrinsicInstrCost(ICA, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>) + MulCost +</span></CodeLine>
<Link id="l06595" /><CodeLine lineNumber="6595"><span class="doxyHighlight">             <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l06596" /><CodeLine lineNumber="6596"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06597" /><CodeLine lineNumber="6597"><span class="doxyHighlight">    &#91;&#91;fallthrough&#93;&#93;;</span></CodeLine>
<Link id="l06598" /><CodeLine lineNumber="6598"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06599" /><CodeLine lineNumber="6599"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FAdd:</span></CodeLine>
<Link id="l06600" /><CodeLine lineNumber="6600"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FSub:</span></CodeLine>
<Link id="l06601" /><CodeLine lineNumber="6601"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Mul:</span></CodeLine>
<Link id="l06602" /><CodeLine lineNumber="6602"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FMul:</span></CodeLine>
<Link id="l06603" /><CodeLine lineNumber="6603"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FDiv:</span></CodeLine>
<Link id="l06604" /><CodeLine lineNumber="6604"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FRem:</span></CodeLine>
<Link id="l06605" /><CodeLine lineNumber="6605"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Shl:</span></CodeLine>
<Link id="l06606" /><CodeLine lineNumber="6606"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::LShr:</span></CodeLine>
<Link id="l06607" /><CodeLine lineNumber="6607"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::AShr:</span></CodeLine>
<Link id="l06608" /><CodeLine lineNumber="6608"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::And:</span></CodeLine>
<Link id="l06609" /><CodeLine lineNumber="6609"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Or:</span></CodeLine>
<Link id="l06610" /><CodeLine lineNumber="6610"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Xor: &#123;</span></CodeLine>
<Link id="l06611" /><CodeLine lineNumber="6611"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If we&#39;re speculating on the stride being 1, the multiplication may</span></CodeLine>
<Link id="l06612" /><CodeLine lineNumber="6612"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// fold away.  We can generalize this for all operations using the notion</span></CodeLine>
<Link id="l06613" /><CodeLine lineNumber="6613"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of neutral elements.  (TODO)</span></CodeLine>
<Link id="l06614" /><CodeLine lineNumber="6614"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::Mul &amp;&amp;</span></CodeLine>
<Link id="l06615" /><CodeLine lineNumber="6615"><span class="doxyHighlight">        ((<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)) &amp;&amp;</span></CodeLine>
<Link id="l06616" /><CodeLine lineNumber="6616"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSCEV(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0))-&gt;isOne()) ||</span></CodeLine>
<Link id="l06617" /><CodeLine lineNumber="6617"><span class="doxyHighlight">         (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1)) &amp;&amp;</span></CodeLine>
<Link id="l06618" /><CodeLine lineNumber="6618"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSCEV(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1))-&gt;isOne())))</span></CodeLine>
<Link id="l06619" /><CodeLine lineNumber="6619"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l06620" /><CodeLine lineNumber="6620"></CodeLine>
<Link id="l06621" /><CodeLine lineNumber="6621"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Detect reduction patterns</span></CodeLine>
<Link id="l06622" /><CodeLine lineNumber="6622"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4e307866e6d65e87d1e6884b0d13306c">getReductionPatternCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, VectorTy))</span></CodeLine>
<Link id="l06623" /><CodeLine lineNumber="6623"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;RedCost;</span></CodeLine>
<Link id="l06624" /><CodeLine lineNumber="6624"></CodeLine>
<Link id="l06625" /><CodeLine lineNumber="6625"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Certain instructions can be cheaper to vectorize if they have a constant</span></CodeLine>
<Link id="l06626" /><CodeLine lineNumber="6626"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// second vector operand. One example of this are shifts on x86.</span></CodeLine>
<Link id="l06627" /><CodeLine lineNumber="6627"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op2 = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1);</span></CodeLine>
<Link id="l06628" /><CodeLine lineNumber="6628"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Op2) &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE()-&gt;isSCEVable(Op2-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &amp;&amp;</span></CodeLine>
<Link id="l06629" /><CodeLine lineNumber="6629"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVConstant&gt;</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSCEV(Op2))) &#123;</span></CodeLine>
<Link id="l06630" /><CodeLine lineNumber="6630"><span class="doxyHighlight">      Op2 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SCEVConstant&gt;</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSCEV(Op2))-&gt;getValue();</span></CodeLine>
<Link id="l06631" /><CodeLine lineNumber="6631"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06632" /><CodeLine lineNumber="6632"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Op2Info = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getOperandInfo(Op2);</span></CodeLine>
<Link id="l06633" /><CodeLine lineNumber="6633"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Op2Info.Kind == <a href="/docs/api/classes/llvm/targettransforminfo/#afa38851d75434d1476444ac93f94cb4ca9c0eecea29e9fa58e4dac7ee32b9b2ac">TargetTransformInfo::OK&#95;AnyValue</a> &amp;&amp;</span></CodeLine>
<Link id="l06634" /><CodeLine lineNumber="6634"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aadd9a9d699ede62468422c7cfab66e99">shouldConsiderInvariant</a>(Op2))</span></CodeLine>
<Link id="l06635" /><CodeLine lineNumber="6635"><span class="doxyHighlight">      Op2Info.Kind = <a href="/docs/api/classes/llvm/targettransforminfo/#afa38851d75434d1476444ac93f94cb4ca7aa61d9e9d33bdf28478754c69c59640">TargetTransformInfo::OK&#95;UniformValue</a>;</span></CodeLine>
<Link id="l06636" /><CodeLine lineNumber="6636"></CodeLine>
<Link id="l06637" /><CodeLine lineNumber="6637"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;, 4&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operand&#95;values());</span></CodeLine>
<Link id="l06638" /><CodeLine lineNumber="6638"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(</span></CodeLine>
<Link id="l06639" /><CodeLine lineNumber="6639"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>,</span></CodeLine>
<Link id="l06640" /><CodeLine lineNumber="6640"><span class="doxyHighlight">        &#123;TargetTransformInfo::OK&#95;AnyValue, TargetTransformInfo::OP&#95;None&#125;,</span></CodeLine>
<Link id="l06641" /><CodeLine lineNumber="6641"><span class="doxyHighlight">        Op2Info, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>);</span></CodeLine>
<Link id="l06642" /><CodeLine lineNumber="6642"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06643" /><CodeLine lineNumber="6643"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FNeg: &#123;</span></CodeLine>
<Link id="l06644" /><CodeLine lineNumber="6644"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(</span></CodeLine>
<Link id="l06645" /><CodeLine lineNumber="6645"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>,</span></CodeLine>
<Link id="l06646" /><CodeLine lineNumber="6646"><span class="doxyHighlight">        &#123;TargetTransformInfo::OK&#95;AnyValue, TargetTransformInfo::OP&#95;None&#125;,</span></CodeLine>
<Link id="l06647" /><CodeLine lineNumber="6647"><span class="doxyHighlight">        &#123;TargetTransformInfo::OK&#95;AnyValue, TargetTransformInfo::OP&#95;None&#125;,</span></CodeLine>
<Link id="l06648" /><CodeLine lineNumber="6648"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06649" /><CodeLine lineNumber="6649"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06650" /><CodeLine lineNumber="6650"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Select: &#123;</span></CodeLine>
<Link id="l06651" /><CodeLine lineNumber="6651"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06652" /><CodeLine lineNumber="6652"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;CondSCEV = SE-&gt;getSCEV(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition());</span></CodeLine>
<Link id="l06653" /><CodeLine lineNumber="6653"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ScalarCond = (SE-&gt;isLoopInvariant(CondSCEV, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>));</span></CodeLine>
<Link id="l06654" /><CodeLine lineNumber="6654"></CodeLine>
<Link id="l06655" /><CodeLine lineNumber="6655"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0, &#42;Op1;</span></CodeLine>
<Link id="l06656" /><CodeLine lineNumber="6656"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</span></CodeLine>
<Link id="l06657" /><CodeLine lineNumber="6657"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ScalarCond &amp;&amp; (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op1))) ||</span></CodeLine>
<Link id="l06658" /><CodeLine lineNumber="6658"><span class="doxyHighlight">                        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op1))))) &#123;</span></CodeLine>
<Link id="l06659" /><CodeLine lineNumber="6659"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// select x, y, false --&gt; x &amp; y</span></CodeLine>
<Link id="l06660" /><CodeLine lineNumber="6660"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// select x, true, y --&gt; x | y</span></CodeLine>
<Link id="l06661" /><CodeLine lineNumber="6661"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;Op1VK, Op1VP&#93; = <a href="/docs/api/classes/llvm/targettransforminfo/#a5fecba95c1ba20950ea8e2139127e621">TTI::getOperandInfo</a>(Op0);</span></CodeLine>
<Link id="l06662" /><CodeLine lineNumber="6662"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;Op2VK, Op2VP&#93; = <a href="/docs/api/classes/llvm/targettransforminfo/#a5fecba95c1ba20950ea8e2139127e621">TTI::getOperandInfo</a>(Op1);</span></CodeLine>
<Link id="l06663" /><CodeLine lineNumber="6663"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Op0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() == 1 &amp;&amp;</span></CodeLine>
<Link id="l06664" /><CodeLine lineNumber="6664"><span class="doxyHighlight">              Op1-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() == 1);</span></CodeLine>
<Link id="l06665" /><CodeLine lineNumber="6665"></CodeLine>
<Link id="l06666" /><CodeLine lineNumber="6666"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;, 2&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#123;Op0, Op1&#125;;</span></CodeLine>
<Link id="l06667" /><CodeLine lineNumber="6667"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(</span></CodeLine>
<Link id="l06668" /><CodeLine lineNumber="6668"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>()) ? Instruction::Or : Instruction::And, VectorTy,</span></CodeLine>
<Link id="l06669" /><CodeLine lineNumber="6669"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, &#123;Op1VK, Op1VP&#125;, &#123;Op2VK, Op2VP&#125;, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06670" /><CodeLine lineNumber="6670"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06671" /><CodeLine lineNumber="6671"></CodeLine>
<Link id="l06672" /><CodeLine lineNumber="6672"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;CondTy = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition()-&gt;getType();</span></CodeLine>
<Link id="l06673" /><CodeLine lineNumber="6673"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ScalarCond)</span></CodeLine>
<Link id="l06674" /><CodeLine lineNumber="6674"><span class="doxyHighlight">      CondTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(CondTy, VF);</span></CodeLine>
<Link id="l06675" /><CodeLine lineNumber="6675"></CodeLine>
<Link id="l06676" /><CodeLine lineNumber="6676"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">CmpInst::BAD&#95;ICMP&#95;PREDICATE</a>;</span></CodeLine>
<Link id="l06677" /><CodeLine lineNumber="6677"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition()))</span></CodeLine>
<Link id="l06678" /><CodeLine lineNumber="6678"><span class="doxyHighlight">      Pred = Cmp-&gt;getPredicate();</span></CodeLine>
<Link id="l06679" /><CodeLine lineNumber="6679"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCmpSelInstrCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, CondTy, Pred,</span></CodeLine>
<Link id="l06680" /><CodeLine lineNumber="6680"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, &#123;TTI::OK&#95;AnyValue, TTI::OP&#95;None&#125;,</span></CodeLine>
<Link id="l06681" /><CodeLine lineNumber="6681"><span class="doxyHighlight">                                  &#123;TTI::OK&#95;AnyValue, TTI::OP&#95;None&#125;, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06682" /><CodeLine lineNumber="6682"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06683" /><CodeLine lineNumber="6683"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::ICmp:</span></CodeLine>
<Link id="l06684" /><CodeLine lineNumber="6684"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FCmp: &#123;</span></CodeLine>
<Link id="l06685" /><CodeLine lineNumber="6685"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ValTy = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType();</span></CodeLine>
<Link id="l06686" /><CodeLine lineNumber="6686"></CodeLine>
<Link id="l06687" /><CodeLine lineNumber="6687"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa8c00664c6be2042407f13e4fcad950b">canTruncateToMinimalBitwidth</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</span></CodeLine>
<Link id="l06688" /><CodeLine lineNumber="6688"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Op0AsInstruction = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</span></CodeLine>
<Link id="l06689" /><CodeLine lineNumber="6689"><span class="doxyHighlight">      (void)Op0AsInstruction;</span></CodeLine>
<Link id="l06690" /><CodeLine lineNumber="6690"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa8c00664c6be2042407f13e4fcad950b">canTruncateToMinimalBitwidth</a>(Op0AsInstruction, VF) ||</span></CodeLine>
<Link id="l06691" /><CodeLine lineNumber="6691"><span class="doxyHighlight">              MinBWs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; == MinBWs&#91;Op0AsInstruction&#93;) &amp;&amp;</span></CodeLine>
<Link id="l06692" /><CodeLine lineNumber="6692"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;if both the operand and the compare are marked for &quot;</span></CodeLine>
<Link id="l06693" /><CodeLine lineNumber="6693"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;truncation, they must have the same bitwidth&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06694" /><CodeLine lineNumber="6694"><span class="doxyHighlight">      ValTy = <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(ValTy-&gt;getContext(), MinBWs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</span></CodeLine>
<Link id="l06695" /><CodeLine lineNumber="6695"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06696" /><CodeLine lineNumber="6696"></CodeLine>
<Link id="l06697" /><CodeLine lineNumber="6697"><span class="doxyHighlight">    VectorTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ValTy, VF);</span></CodeLine>
<Link id="l06698" /><CodeLine lineNumber="6698"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCmpSelInstrCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l06699" /><CodeLine lineNumber="6699"><span class="doxyHighlight">                                  <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getPredicate(), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>,</span></CodeLine>
<Link id="l06700" /><CodeLine lineNumber="6700"><span class="doxyHighlight">                                  &#123;TTI::OK&#95;AnyValue, TTI::OP&#95;None&#125;,</span></CodeLine>
<Link id="l06701" /><CodeLine lineNumber="6701"><span class="doxyHighlight">                                  &#123;TTI::OK&#95;AnyValue, TTI::OP&#95;None&#125;, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06702" /><CodeLine lineNumber="6702"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06703" /><CodeLine lineNumber="6703"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Store:</span></CodeLine>
<Link id="l06704" /><CodeLine lineNumber="6704"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Load: &#123;</span></CodeLine>
<Link id="l06705" /><CodeLine lineNumber="6705"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> Width = VF;</span></CodeLine>
<Link id="l06706" /><CodeLine lineNumber="6706"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Width.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()) &#123;</span></CodeLine>
<Link id="l06707" /><CodeLine lineNumber="6707"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Width);</span></CodeLine>
<Link id="l06708" /><CodeLine lineNumber="6708"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Decision != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">CM&#95;Unknown</a> &amp;&amp;</span></CodeLine>
<Link id="l06709" /><CodeLine lineNumber="6709"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;CM decision should be taken at this point&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06710" /><CodeLine lineNumber="6710"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af7844564539b9f0f917e8f2380a064b3">getWideningCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) == <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>())</span></CodeLine>
<Link id="l06711" /><CodeLine lineNumber="6711"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l06712" /><CodeLine lineNumber="6712"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Decision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>)</span></CodeLine>
<Link id="l06713" /><CodeLine lineNumber="6713"><span class="doxyHighlight">        Width = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1);</span></CodeLine>
<Link id="l06714" /><CodeLine lineNumber="6714"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06715" /><CodeLine lineNumber="6715"><span class="doxyHighlight">    VectorTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), Width);</span></CodeLine>
<Link id="l06716" /><CodeLine lineNumber="6716"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> getMemoryInstructionCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l06717" /><CodeLine lineNumber="6717"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06718" /><CodeLine lineNumber="6718"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::BitCast:</span></CodeLine>
<Link id="l06719" /><CodeLine lineNumber="6719"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isPointerTy())</span></CodeLine>
<Link id="l06720" /><CodeLine lineNumber="6720"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l06721" /><CodeLine lineNumber="6721"><span class="doxyHighlight">    &#91;&#91;fallthrough&#93;&#93;;</span></CodeLine>
<Link id="l06722" /><CodeLine lineNumber="6722"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::ZExt:</span></CodeLine>
<Link id="l06723" /><CodeLine lineNumber="6723"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SExt:</span></CodeLine>
<Link id="l06724" /><CodeLine lineNumber="6724"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FPToUI:</span></CodeLine>
<Link id="l06725" /><CodeLine lineNumber="6725"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FPToSI:</span></CodeLine>
<Link id="l06726" /><CodeLine lineNumber="6726"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FPExt:</span></CodeLine>
<Link id="l06727" /><CodeLine lineNumber="6727"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::PtrToInt:</span></CodeLine>
<Link id="l06728" /><CodeLine lineNumber="6728"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::IntToPtr:</span></CodeLine>
<Link id="l06729" /><CodeLine lineNumber="6729"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SIToFP:</span></CodeLine>
<Link id="l06730" /><CodeLine lineNumber="6730"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::UIToFP:</span></CodeLine>
<Link id="l06731" /><CodeLine lineNumber="6731"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Trunc:</span></CodeLine>
<Link id="l06732" /><CodeLine lineNumber="6732"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FPTrunc: &#123;</span></CodeLine>
<Link id="l06733" /><CodeLine lineNumber="6733"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Computes the CastContextHint from a Load/Store instruction.</span></CodeLine>
<Link id="l06734" /><CodeLine lineNumber="6734"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ComputeCCH = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64">TTI::CastContextHint</a> &#123;</span></CodeLine>
<Link id="l06735" /><CodeLine lineNumber="6735"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</span></CodeLine>
<Link id="l06736" /><CodeLine lineNumber="6736"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Expected a load or a store!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06737" /><CodeLine lineNumber="6737"></CodeLine>
<Link id="l06738" /><CodeLine lineNumber="6738"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l06739" /><CodeLine lineNumber="6739"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a960b44c579bc2f6818d2daaf9e4c16f0">TTI::CastContextHint::Normal</a>;</span></CodeLine>
<Link id="l06740" /><CodeLine lineNumber="6740"></CodeLine>
<Link id="l06741" /><CodeLine lineNumber="6741"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</span></CodeLine>
<Link id="l06742" /><CodeLine lineNumber="6742"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ae849d400780f51424bc4e4c26ddf3000">LoopVectorizationCostModel::CM&#95;GatherScatter</a>:</span></CodeLine>
<Link id="l06743" /><CodeLine lineNumber="6743"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64afc2e3edeec59afcdc10f55205713f14b">TTI::CastContextHint::GatherScatter</a>;</span></CodeLine>
<Link id="l06744" /><CodeLine lineNumber="6744"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971">LoopVectorizationCostModel::CM&#95;Interleave</a>:</span></CodeLine>
<Link id="l06745" /><CodeLine lineNumber="6745"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64ad392556b3674a98332cc2938ba0bfeb7">TTI::CastContextHint::Interleave</a>;</span></CodeLine>
<Link id="l06746" /><CodeLine lineNumber="6746"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">LoopVectorizationCostModel::CM&#95;Scalarize</a>:</span></CodeLine>
<Link id="l06747" /><CodeLine lineNumber="6747"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260adc468760c02910f77bad7525bc66c334">LoopVectorizationCostModel::CM&#95;Widen</a>:</span></CodeLine>
<Link id="l06748" /><CodeLine lineNumber="6748"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ? <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6864311f985d160ad4bd46a9fbe4a4d4">TTI::CastContextHint::Masked</a></span></CodeLine>
<Link id="l06749" /><CodeLine lineNumber="6749"><span class="doxyHighlight">                                        : <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a960b44c579bc2f6818d2daaf9e4c16f0">TTI::CastContextHint::Normal</a>;</span></CodeLine>
<Link id="l06750" /><CodeLine lineNumber="6750"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a058eacbd3c28e2ecec2af7db726ce527">LoopVectorizationCostModel::CM&#95;Widen&#95;Reverse</a>:</span></CodeLine>
<Link id="l06751" /><CodeLine lineNumber="6751"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a030aa94015bd11d183b897ddb541e4e3">TTI::CastContextHint::Reversed</a>;</span></CodeLine>
<Link id="l06752" /><CodeLine lineNumber="6752"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">LoopVectorizationCostModel::CM&#95;Unknown</a>:</span></CodeLine>
<Link id="l06753" /><CodeLine lineNumber="6753"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Instr did not go through cost modelling?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06754" /><CodeLine lineNumber="6754"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ab6fd5f45ab6e363de6c3f42472d439ac">LoopVectorizationCostModel::CM&#95;VectorCall</a>:</span></CodeLine>
<Link id="l06755" /><CodeLine lineNumber="6755"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a679b46cebdf2f87b9efd0413c960314a">LoopVectorizationCostModel::CM&#95;IntrinsicCall</a>:</span></CodeLine>
<Link id="l06756" /><CodeLine lineNumber="6756"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a8cb1f2bd469f8a823857a1cf1447a0e3">llvm&#95;unreachable&#95;internal</a>(</span><span class="doxyHighlightStringLiteral">&quot;Instr has invalid widening decision&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06757" /><CodeLine lineNumber="6757"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06758" /><CodeLine lineNumber="6758"></CodeLine>
<Link id="l06759" /><CodeLine lineNumber="6759"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</span><span class="doxyHighlightStringLiteral">&quot;Unhandled case!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06760" /><CodeLine lineNumber="6760"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l06761" /><CodeLine lineNumber="6761"></CodeLine>
<Link id="l06762" /><CodeLine lineNumber="6762"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opcode = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode();</span></CodeLine>
<Link id="l06763" /><CodeLine lineNumber="6763"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64">TTI::CastContextHint</a> CCH = <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>;</span></CodeLine>
<Link id="l06764" /><CodeLine lineNumber="6764"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For Trunc, the context is the only user, which must be a StoreInst.</span></CodeLine>
<Link id="l06765" /><CodeLine lineNumber="6765"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opcode == Instruction::Trunc || Opcode == Instruction::FPTrunc) &#123;</span></CodeLine>
<Link id="l06766" /><CodeLine lineNumber="6766"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse())</span></CodeLine>
<Link id="l06767" /><CodeLine lineNumber="6767"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;Store = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;user&#95;begin()))</span></CodeLine>
<Link id="l06768" /><CodeLine lineNumber="6768"><span class="doxyHighlight">          CCH = ComputeCCH(Store);</span></CodeLine>
<Link id="l06769" /><CodeLine lineNumber="6769"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06770" /><CodeLine lineNumber="6770"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For Z/Sext, the context is the operand, which must be a LoadInst.</span></CodeLine>
<Link id="l06771" /><CodeLine lineNumber="6771"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Opcode == Instruction::ZExt || Opcode == Instruction::SExt ||</span></CodeLine>
<Link id="l06772" /><CodeLine lineNumber="6772"><span class="doxyHighlight">             Opcode == Instruction::FPExt) &#123;</span></CodeLine>
<Link id="l06773" /><CodeLine lineNumber="6773"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;Load = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)))</span></CodeLine>
<Link id="l06774" /><CodeLine lineNumber="6774"><span class="doxyHighlight">        CCH = ComputeCCH(Load);</span></CodeLine>
<Link id="l06775" /><CodeLine lineNumber="6775"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06776" /><CodeLine lineNumber="6776"></CodeLine>
<Link id="l06777" /><CodeLine lineNumber="6777"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We optimize the truncation of induction variables having constant</span></CodeLine>
<Link id="l06778" /><CodeLine lineNumber="6778"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// integer steps. The cost of these truncations is the same as the scalar</span></CodeLine>
<Link id="l06779" /><CodeLine lineNumber="6779"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// operation.</span></CodeLine>
<Link id="l06780" /><CodeLine lineNumber="6780"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a61375f5189558cc261186f388d31fe92">isOptimizableIVTruncate</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</span></CodeLine>
<Link id="l06781" /><CodeLine lineNumber="6781"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Trunc = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;TruncInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06782" /><CodeLine lineNumber="6782"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(Instruction::Trunc, Trunc-&gt;getDestTy(),</span></CodeLine>
<Link id="l06783" /><CodeLine lineNumber="6783"><span class="doxyHighlight">                                  Trunc-&gt;getSrcTy(), CCH, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, Trunc);</span></CodeLine>
<Link id="l06784" /><CodeLine lineNumber="6784"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06785" /><CodeLine lineNumber="6785"></CodeLine>
<Link id="l06786" /><CodeLine lineNumber="6786"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Detect reduction patterns</span></CodeLine>
<Link id="l06787" /><CodeLine lineNumber="6787"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4e307866e6d65e87d1e6884b0d13306c">getReductionPatternCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, VectorTy))</span></CodeLine>
<Link id="l06788" /><CodeLine lineNumber="6788"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#42;RedCost;</span></CodeLine>
<Link id="l06789" /><CodeLine lineNumber="6789"></CodeLine>
<Link id="l06790" /><CodeLine lineNumber="6790"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcScalarTy = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType();</span></CodeLine>
<Link id="l06791" /><CodeLine lineNumber="6791"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Op0AsInstruction = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</span></CodeLine>
<Link id="l06792" /><CodeLine lineNumber="6792"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa8c00664c6be2042407f13e4fcad950b">canTruncateToMinimalBitwidth</a>(Op0AsInstruction, VF))</span></CodeLine>
<Link id="l06793" /><CodeLine lineNumber="6793"><span class="doxyHighlight">      SrcScalarTy =</span></CodeLine>
<Link id="l06794" /><CodeLine lineNumber="6794"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(SrcScalarTy-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>(), MinBWs&#91;Op0AsInstruction&#93;);</span></CodeLine>
<Link id="l06795" /><CodeLine lineNumber="6795"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcVecTy =</span></CodeLine>
<Link id="l06796" /><CodeLine lineNumber="6796"><span class="doxyHighlight">        VectorTy-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() ? <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(SrcScalarTy, VF) : SrcScalarTy;</span></CodeLine>
<Link id="l06797" /><CodeLine lineNumber="6797"></CodeLine>
<Link id="l06798" /><CodeLine lineNumber="6798"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa8c00664c6be2042407f13e4fcad950b">canTruncateToMinimalBitwidth</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</span></CodeLine>
<Link id="l06799" /><CodeLine lineNumber="6799"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the result type is &lt;= the source type, there will be no extend</span></CodeLine>
<Link id="l06800" /><CodeLine lineNumber="6800"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// after truncating the users to the minimal required bitwidth.</span></CodeLine>
<Link id="l06801" /><CodeLine lineNumber="6801"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VectorTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &lt;= SrcVecTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &amp;&amp;</span></CodeLine>
<Link id="l06802" /><CodeLine lineNumber="6802"><span class="doxyHighlight">          (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::ZExt ||</span></CodeLine>
<Link id="l06803" /><CodeLine lineNumber="6803"><span class="doxyHighlight">           <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::SExt))</span></CodeLine>
<Link id="l06804" /><CodeLine lineNumber="6804"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> 0;</span></CodeLine>
<Link id="l06805" /><CodeLine lineNumber="6805"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06806" /><CodeLine lineNumber="6806"></CodeLine>
<Link id="l06807" /><CodeLine lineNumber="6807"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(Opcode, VectorTy, SrcVecTy, CCH, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06808" /><CodeLine lineNumber="6808"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06809" /><CodeLine lineNumber="6809"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Call:</span></CodeLine>
<Link id="l06810" /><CodeLine lineNumber="6810"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad1f0755693a05c2b008e9a576c3b162b">getVectorCallCost</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), VF);</span></CodeLine>
<Link id="l06811" /><CodeLine lineNumber="6811"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::ExtractValue:</span></CodeLine>
<Link id="l06812" /><CodeLine lineNumber="6812"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getInstructionCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l06813" /><CodeLine lineNumber="6813"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Alloca:</span></CodeLine>
<Link id="l06814" /><CodeLine lineNumber="6814"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We cannot easily widen alloca to a scalable alloca, as</span></CodeLine>
<Link id="l06815" /><CodeLine lineNumber="6815"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the result would need to be a vector of pointers.</span></CodeLine>
<Link id="l06816" /><CodeLine lineNumber="6816"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</span></CodeLine>
<Link id="l06817" /><CodeLine lineNumber="6817"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</span></CodeLine>
<Link id="l06818" /><CodeLine lineNumber="6818"><span class="doxyHighlight">    &#91;&#91;fallthrough&#93;&#93;;</span></CodeLine>
<Link id="l06819" /><CodeLine lineNumber="6819"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l06820" /><CodeLine lineNumber="6820"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This opcode is unknown. Assume that it is the same as &#39;mul&#39;.</span></CodeLine>
<Link id="l06821" /><CodeLine lineNumber="6821"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(Instruction::Mul, VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l06822" /><CodeLine lineNumber="6822"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightComment">// end of switch.</span></CodeLine>
<Link id="l06823" /><CodeLine lineNumber="6823"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06824" /><CodeLine lineNumber="6824"></CodeLine>
<Link id="l06825" /><CodeLine lineNumber="6825" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0ac5df8f0304981180d602dacb13512c"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0ac5df8f0304981180d602dacb13512c">LoopVectorizationCostModel::collectValuesToIgnore</a>() &#123;</span></CodeLine>
<Link id="l06826" /><CodeLine lineNumber="6826"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ignore ephemeral values.</span></CodeLine>
<Link id="l06827" /><CodeLine lineNumber="6827"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/codemetrics/#a7e174506b52ad46ea1f746a7f727d999">CodeMetrics::collectEphemeralValues</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aba357162dc28acb3a399731e1e397614">AC</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>);</span></CodeLine>
<Link id="l06828" /><CodeLine lineNumber="6828"></CodeLine>
<Link id="l06829" /><CodeLine lineNumber="6829"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> DeadInterleavePointerOps;</span></CodeLine>
<Link id="l06830" /><CodeLine lineNumber="6830"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> DeadOps;</span></CodeLine>
<Link id="l06831" /><CodeLine lineNumber="6831"></CodeLine>
<Link id="l06832" /><CodeLine lineNumber="6832"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If a scalar epilogue is required, users outside the loop won&#39;t use</span></CodeLine>
<Link id="l06833" /><CodeLine lineNumber="6833"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// live-outs from the vector loop but from the scalar epilogue. Ignore them if</span></CodeLine>
<Link id="l06834" /><CodeLine lineNumber="6834"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that is the case.</span></CodeLine>
<Link id="l06835" /><CodeLine lineNumber="6835"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> RequiresScalarEpilogue = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a913ab9c8291000dd3a1c3739194b03e4">requiresScalarEpilogue</a>(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l06836" /><CodeLine lineNumber="6836"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsLiveOutDead = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, RequiresScalarEpilogue&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</span></CodeLine>
<Link id="l06837" /><CodeLine lineNumber="6837"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> RequiresScalarEpilogue &amp;&amp;</span></CodeLine>
<Link id="l06838" /><CodeLine lineNumber="6838"><span class="doxyHighlight">           !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>());</span></CodeLine>
<Link id="l06839" /><CodeLine lineNumber="6839"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l06840" /><CodeLine lineNumber="6840"></CodeLine>
<Link id="l06841" /><CodeLine lineNumber="6841"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopblocksdfs">LoopBlocksDFS</a> DFS(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l06842" /><CodeLine lineNumber="6842"><span class="doxyHighlight">  DFS.<a href="/docs/api/classes/llvm/loopblocksdfs/#adc85a5f08fb0f5dc3e053975995c9d29">perform</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a>);</span></CodeLine>
<Link id="l06843" /><CodeLine lineNumber="6843"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;Value &#42;, SmallVector&lt;Value &#42;&gt;</a>&gt; DeadInvariantStoreOps;</span></CodeLine>
<Link id="l06844" /><CodeLine lineNumber="6844"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(<a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(DFS.<a href="/docs/api/classes/llvm/loopblocksdfs/#a003fe6215d300fc9720b1b056cdf4c23">beginRPO</a>(), DFS.<a href="/docs/api/classes/llvm/loopblocksdfs/#aeebda6b0288bea7cd706111624ca73f6">endRPO</a>())))</span></CodeLine>
<Link id="l06845" /><CodeLine lineNumber="6845"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(&#42;BB)) &#123;</span></CodeLine>
<Link id="l06846" /><CodeLine lineNumber="6846"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Find all stores to invariant variables. Since they are going to sink</span></CodeLine>
<Link id="l06847" /><CodeLine lineNumber="6847"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// outside the loop we do not need calculate cost for them.</span></CodeLine>
<Link id="l06848" /><CodeLine lineNumber="6848"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>;</span></CodeLine>
<Link id="l06849" /><CodeLine lineNumber="6849"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</span></CodeLine>
<Link id="l06850" /><CodeLine lineNumber="6850"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInvariantAddressOfReduction(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand())) &#123;</span></CodeLine>
<Link id="l06851" /><CodeLine lineNumber="6851"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>.insert(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06852" /><CodeLine lineNumber="6852"><span class="doxyHighlight">        DeadInvariantStoreOps&#91;<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand()&#93;.push&#95;back(</span></CodeLine>
<Link id="l06853" /><CodeLine lineNumber="6853"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand());</span></CodeLine>
<Link id="l06854" /><CodeLine lineNumber="6854"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06855" /><CodeLine lineNumber="6855"></CodeLine>
<Link id="l06856" /><CodeLine lineNumber="6856"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.contains(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>.contains(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l06857" /><CodeLine lineNumber="6857"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06858" /><CodeLine lineNumber="6858"></CodeLine>
<Link id="l06859" /><CodeLine lineNumber="6859"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add instructions that would be trivially dead and are only used by</span></CodeLine>
<Link id="l06860" /><CodeLine lineNumber="6860"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// values already ignored to DeadOps to seed worklist.</span></CodeLine>
<Link id="l06861" /><CodeLine lineNumber="6861"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a845142f96a84f067cb6bf639e37980d0">wouldInstructionBeTriviallyDead</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>) &amp;&amp;</span></CodeLine>
<Link id="l06862" /><CodeLine lineNumber="6862"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.users(), &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, IsLiveOutDead&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</span></CodeLine>
<Link id="l06863" /><CodeLine lineNumber="6863"><span class="doxyHighlight">            return VecValuesToIgnore.contains(U) ||</span></CodeLine>
<Link id="l06864" /><CodeLine lineNumber="6864"><span class="doxyHighlight">                   ValuesToIgnore.contains(U) || IsLiveOutDead(U);</span></CodeLine>
<Link id="l06865" /><CodeLine lineNumber="6865"><span class="doxyHighlight">          &#125;))</span></CodeLine>
<Link id="l06866" /><CodeLine lineNumber="6866"><span class="doxyHighlight">        DeadOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06867" /><CodeLine lineNumber="6867"></CodeLine>
<Link id="l06868" /><CodeLine lineNumber="6868"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For interleave groups, we only create a pointer for the start of the</span></CodeLine>
<Link id="l06869" /><CodeLine lineNumber="6869"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// interleave group. Queue up addresses of group members except the insert</span></CodeLine>
<Link id="l06870" /><CodeLine lineNumber="6870"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// position for further processing.</span></CodeLine>
<Link id="l06871" /><CodeLine lineNumber="6871"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85e3110b9fe54caf00fe4297d1b4f0b6">isAccessInterleaved</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l06872" /><CodeLine lineNumber="6872"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Group = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c">getInterleavedAccessGroup</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06873" /><CodeLine lineNumber="6873"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Group-&gt;getInsertPos() == &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l06874" /><CodeLine lineNumber="6874"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06875" /><CodeLine lineNumber="6875"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;PointerOp = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06876" /><CodeLine lineNumber="6876"><span class="doxyHighlight">        DeadInterleavePointerOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PointerOp);</span></CodeLine>
<Link id="l06877" /><CodeLine lineNumber="6877"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06878" /><CodeLine lineNumber="6878"></CodeLine>
<Link id="l06879" /><CodeLine lineNumber="6879"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Queue branches for analysis. They are dead, if their successors only</span></CodeLine>
<Link id="l06880" /><CodeLine lineNumber="6880"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// contain dead instructions.</span></CodeLine>
<Link id="l06881" /><CodeLine lineNumber="6881"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Br = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l06882" /><CodeLine lineNumber="6882"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Br-&gt;isConditional())</span></CodeLine>
<Link id="l06883" /><CodeLine lineNumber="6883"><span class="doxyHighlight">          DeadOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l06884" /><CodeLine lineNumber="6884"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06885" /><CodeLine lineNumber="6885"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06886" /><CodeLine lineNumber="6886"></CodeLine>
<Link id="l06887" /><CodeLine lineNumber="6887"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Mark ops feeding interleave group members as free, if they are only used</span></CodeLine>
<Link id="l06888" /><CodeLine lineNumber="6888"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// by other dead computations.</span></CodeLine>
<Link id="l06889" /><CodeLine lineNumber="6889"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != DeadInterleavePointerOps.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l06890" /><CodeLine lineNumber="6890"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(DeadInterleavePointerOps&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</span></CodeLine>
<Link id="l06891" /><CodeLine lineNumber="6891"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) || <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;users(), &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</span></CodeLine>
<Link id="l06892" /><CodeLine lineNumber="6892"><span class="doxyHighlight">          Instruction &#42;UI = cast&lt;Instruction&gt;(U);</span></CodeLine>
<Link id="l06893" /><CodeLine lineNumber="6893"><span class="doxyHighlight">          return !VecValuesToIgnore.contains(U) &amp;&amp;</span></CodeLine>
<Link id="l06894" /><CodeLine lineNumber="6894"><span class="doxyHighlight">                 (!isAccessInterleaved(UI) ||</span></CodeLine>
<Link id="l06895" /><CodeLine lineNumber="6895"><span class="doxyHighlight">                  getInterleavedAccessGroup(UI)-&gt;getInsertPos() == UI);</span></CodeLine>
<Link id="l06896" /><CodeLine lineNumber="6896"><span class="doxyHighlight">        &#125;))</span></CodeLine>
<Link id="l06897" /><CodeLine lineNumber="6897"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06898" /><CodeLine lineNumber="6898"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.insert(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l06899" /><CodeLine lineNumber="6899"><span class="doxyHighlight">    DeadInterleavePointerOps.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;op&#95;begin(), <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;op&#95;end());</span></CodeLine>
<Link id="l06900" /><CodeLine lineNumber="6900"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06901" /><CodeLine lineNumber="6901"></CodeLine>
<Link id="l06902" /><CodeLine lineNumber="6902"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#93; : DeadInvariantStoreOps) &#123;</span></CodeLine>
<Link id="l06903" /><CodeLine lineNumber="6903"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>).drop&#95;back())</span></CodeLine>
<Link id="l06904" /><CodeLine lineNumber="6904"><span class="doxyHighlight">      DeadOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l06905" /><CodeLine lineNumber="6905"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06906" /><CodeLine lineNumber="6906"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Mark ops that would be trivially dead and are only used by ignored</span></CodeLine>
<Link id="l06907" /><CodeLine lineNumber="6907"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// instructions as free.</span></CodeLine>
<Link id="l06908" /><CodeLine lineNumber="6908"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Header = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getHeader();</span></CodeLine>
<Link id="l06909" /><CodeLine lineNumber="6909"></CodeLine>
<Link id="l06910" /><CodeLine lineNumber="6910"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Returns true if the block contains only dead instructions. Such blocks will</span></CodeLine>
<Link id="l06911" /><CodeLine lineNumber="6911"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// be removed by VPlan-to-VPlan transforms and won&#39;t be considered by the</span></CodeLine>
<Link id="l06912" /><CodeLine lineNumber="6912"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// VPlan-based cost model, so skip them in the legacy cost-model as well.</span></CodeLine>
<Link id="l06913" /><CodeLine lineNumber="6913"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp/#a87d0fbdabd17122a3febe35d7fbefb60">IsEmptyBlock</a> = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l06914" /><CodeLine lineNumber="6914"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(&#42;BB, &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l06915" /><CodeLine lineNumber="6915"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>.contains(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.contains(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</span></CodeLine>
<Link id="l06916" /><CodeLine lineNumber="6916"><span class="doxyHighlight">             (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;isConditional());</span></CodeLine>
<Link id="l06917" /><CodeLine lineNumber="6917"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l06918" /><CodeLine lineNumber="6918"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l06919" /><CodeLine lineNumber="6919"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != DeadOps.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l06920" /><CodeLine lineNumber="6920"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(DeadOps&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</span></CodeLine>
<Link id="l06921" /><CodeLine lineNumber="6921"></CodeLine>
<Link id="l06922" /><CodeLine lineNumber="6922"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if the branch should be considered dead.</span></CodeLine>
<Link id="l06923" /><CodeLine lineNumber="6923"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Br = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;BranchInst&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) &#123;</span></CodeLine>
<Link id="l06924" /><CodeLine lineNumber="6924"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ThenBB = Br-&gt;getSuccessor(0);</span></CodeLine>
<Link id="l06925" /><CodeLine lineNumber="6925"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ElseBB = Br-&gt;getSuccessor(1);</span></CodeLine>
<Link id="l06926" /><CodeLine lineNumber="6926"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Don&#39;t considers branches leaving the loop for simplification.</span></CodeLine>
<Link id="l06927" /><CodeLine lineNumber="6927"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(ThenBB) || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(ElseBB))</span></CodeLine>
<Link id="l06928" /><CodeLine lineNumber="6928"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06929" /><CodeLine lineNumber="6929"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ThenEmpty = <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp/#a87d0fbdabd17122a3febe35d7fbefb60">IsEmptyBlock</a>(ThenBB);</span></CodeLine>
<Link id="l06930" /><CodeLine lineNumber="6930"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ElseEmpty = <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp/#a87d0fbdabd17122a3febe35d7fbefb60">IsEmptyBlock</a>(ElseBB);</span></CodeLine>
<Link id="l06931" /><CodeLine lineNumber="6931"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((ThenEmpty &amp;&amp; ElseEmpty) ||</span></CodeLine>
<Link id="l06932" /><CodeLine lineNumber="6932"><span class="doxyHighlight">          (ThenEmpty &amp;&amp; ThenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>() == ElseBB &amp;&amp;</span></CodeLine>
<Link id="l06933" /><CodeLine lineNumber="6933"><span class="doxyHighlight">           ElseBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>().empty()) ||</span></CodeLine>
<Link id="l06934" /><CodeLine lineNumber="6934"><span class="doxyHighlight">          (ElseEmpty &amp;&amp; ElseBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>() == ThenBB &amp;&amp;</span></CodeLine>
<Link id="l06935" /><CodeLine lineNumber="6935"><span class="doxyHighlight">           ThenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>().empty())) &#123;</span></CodeLine>
<Link id="l06936" /><CodeLine lineNumber="6936"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.insert(Br);</span></CodeLine>
<Link id="l06937" /><CodeLine lineNumber="6937"><span class="doxyHighlight">        DeadOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Br-&gt;getCondition());</span></CodeLine>
<Link id="l06938" /><CodeLine lineNumber="6938"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l06939" /><CodeLine lineNumber="6939"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06940" /><CodeLine lineNumber="6940"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l06941" /><CodeLine lineNumber="6941"></CodeLine>
<Link id="l06942" /><CodeLine lineNumber="6942"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Skip any op that shouldn&#39;t be considered dead.</span></CodeLine>
<Link id="l06943" /><CodeLine lineNumber="6943"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) ||</span></CodeLine>
<Link id="l06944" /><CodeLine lineNumber="6944"><span class="doxyHighlight">        (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &amp;&amp; <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getParent() == Header) ||</span></CodeLine>
<Link id="l06945" /><CodeLine lineNumber="6945"><span class="doxyHighlight">        !<a href="/docs/api/namespaces/llvm/#a845142f96a84f067cb6bf639e37980d0">wouldInstructionBeTriviallyDead</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>) ||</span></CodeLine>
<Link id="l06946" /><CodeLine lineNumber="6946"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;users(), &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, IsLiveOutDead&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</span></CodeLine>
<Link id="l06947" /><CodeLine lineNumber="6947"><span class="doxyHighlight">          return !VecValuesToIgnore.contains(U) &amp;&amp;</span></CodeLine>
<Link id="l06948" /><CodeLine lineNumber="6948"><span class="doxyHighlight">                 !ValuesToIgnore.contains(U) &amp;&amp; !IsLiveOutDead(U);</span></CodeLine>
<Link id="l06949" /><CodeLine lineNumber="6949"><span class="doxyHighlight">        &#125;))</span></CodeLine>
<Link id="l06950" /><CodeLine lineNumber="6950"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06951" /><CodeLine lineNumber="6951"></CodeLine>
<Link id="l06952" /><CodeLine lineNumber="6952"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getParent()))</span></CodeLine>
<Link id="l06953" /><CodeLine lineNumber="6953"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06954" /><CodeLine lineNumber="6954"></CodeLine>
<Link id="l06955" /><CodeLine lineNumber="6955"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If all of Op&#39;s users are in ValuesToIgnore, add it to ValuesToIgnore</span></CodeLine>
<Link id="l06956" /><CodeLine lineNumber="6956"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// which applies for both scalar and vector versions. Otherwise it is only</span></CodeLine>
<Link id="l06957" /><CodeLine lineNumber="6957"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// dead in vector versions, so only add it to VecValuesToIgnore.</span></CodeLine>
<Link id="l06958" /><CodeLine lineNumber="6958"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;users(),</span></CodeLine>
<Link id="l06959" /><CodeLine lineNumber="6959"><span class="doxyHighlight">               &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123; return ValuesToIgnore.contains(U); &#125;))</span></CodeLine>
<Link id="l06960" /><CodeLine lineNumber="6960"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>.insert(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l06961" /><CodeLine lineNumber="6961"></CodeLine>
<Link id="l06962" /><CodeLine lineNumber="6962"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.insert(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l06963" /><CodeLine lineNumber="6963"><span class="doxyHighlight">    DeadOps.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;op&#95;begin(), <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;op&#95;end());</span></CodeLine>
<Link id="l06964" /><CodeLine lineNumber="6964"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06965" /><CodeLine lineNumber="6965"></CodeLine>
<Link id="l06966" /><CodeLine lineNumber="6966"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ignore type-promoting instructions we identified during reduction</span></CodeLine>
<Link id="l06967" /><CodeLine lineNumber="6967"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// detection.</span></CodeLine>
<Link id="l06968" /><CodeLine lineNumber="6968"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a> : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars()) &#123;</span></CodeLine>
<Link id="l06969" /><CodeLine lineNumber="6969"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RedDes = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>.second;</span></CodeLine>
<Link id="l06970" /><CodeLine lineNumber="6970"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;Instruction &#42;&gt;</a> &amp;Casts = RedDes.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a5691507e6742c90b796d82fb8cb2d70d">getCastInsts</a>();</span></CodeLine>
<Link id="l06971" /><CodeLine lineNumber="6971"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.insert(Casts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#abf73a826b5d6f739eb4af48ddf14c5b4">begin</a>(), Casts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a7004354fbee1c8cd74ed9001915e1db5">end</a>());</span></CodeLine>
<Link id="l06972" /><CodeLine lineNumber="6972"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06973" /><CodeLine lineNumber="6973"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ignore type-casting instructions we identified during induction</span></CodeLine>
<Link id="l06974" /><CodeLine lineNumber="6974"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// detection.</span></CodeLine>
<Link id="l06975" /><CodeLine lineNumber="6975"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Induction : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getInductionVars()) &#123;</span></CodeLine>
<Link id="l06976" /><CodeLine lineNumber="6976"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp;IndDes = Induction.second;</span></CodeLine>
<Link id="l06977" /><CodeLine lineNumber="6977"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;Casts = IndDes.<a href="/docs/api/classes/llvm/inductiondescriptor/#ae7e8084b6da14960ba7c5b2cb7bd5f66">getCastInsts</a>();</span></CodeLine>
<Link id="l06978" /><CodeLine lineNumber="6978"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.insert(Casts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Casts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</span></CodeLine>
<Link id="l06979" /><CodeLine lineNumber="6979"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l06980" /><CodeLine lineNumber="6980"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l06981" /><CodeLine lineNumber="6981"></CodeLine>
<Link id="l06982" /><CodeLine lineNumber="6982" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a12d2850f420726c4acb262b626e95b7d"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a12d2850f420726c4acb262b626e95b7d">LoopVectorizationCostModel::collectInLoopReductions</a>() &#123;</span></CodeLine>
<Link id="l06983" /><CodeLine lineNumber="6983"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a> : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars()) &#123;</span></CodeLine>
<Link id="l06984" /><CodeLine lineNumber="6984"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>.first;</span></CodeLine>
<Link id="l06985" /><CodeLine lineNumber="6985"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>.second;</span></CodeLine>
<Link id="l06986" /><CodeLine lineNumber="6986"></CodeLine>
<Link id="l06987" /><CodeLine lineNumber="6987"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We don&#39;t collect reductions that are type promoted (yet).</span></CodeLine>
<Link id="l06988" /><CodeLine lineNumber="6988"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>() != Phi-&gt;getType())</span></CodeLine>
<Link id="l06989" /><CodeLine lineNumber="6989"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06990" /><CodeLine lineNumber="6990"></CodeLine>
<Link id="l06991" /><CodeLine lineNumber="6991"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the target would prefer this reduction to happen &quot;in-loop&quot;, then we</span></CodeLine>
<Link id="l06992" /><CodeLine lineNumber="6992"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// want to record it as such.</span></CodeLine>
<Link id="l06993" /><CodeLine lineNumber="6993"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opcode = RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a30ee597b72598bc7939d3a40d2a5ba20">getOpcode</a>();</span></CodeLine>
<Link id="l06994" /><CodeLine lineNumber="6994"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="#a96ef6bd4742763bf1b85aaf1a4150620">PreferInLoopReductions</a> &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad508b8cfa31c0e7a1ac8f9d733bb8eed">useOrderedReductions</a>(RdxDesc) &amp;&amp;</span></CodeLine>
<Link id="l06995" /><CodeLine lineNumber="6995"><span class="doxyHighlight">        !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.preferInLoopReduction(Opcode, Phi-&gt;getType(),</span></CodeLine>
<Link id="l06996" /><CodeLine lineNumber="6996"><span class="doxyHighlight">                                   <a href="/docs/api/structs/llvm/targettransforminfo/reductionflags">TargetTransformInfo::ReductionFlags</a>()))</span></CodeLine>
<Link id="l06997" /><CodeLine lineNumber="6997"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l06998" /><CodeLine lineNumber="6998"></CodeLine>
<Link id="l06999" /><CodeLine lineNumber="6999"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check that we can correctly put the reductions into the loop, by</span></CodeLine>
<Link id="l07000" /><CodeLine lineNumber="7000"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// finding the chain of operations that leads from the phi to the loop</span></CodeLine>
<Link id="l07001" /><CodeLine lineNumber="7001"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// exit value.</span></CodeLine>
<Link id="l07002" /><CodeLine lineNumber="7002"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> ReductionOperations =</span></CodeLine>
<Link id="l07003" /><CodeLine lineNumber="7003"><span class="doxyHighlight">        RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a6415fb68bc55f3a316aa414a5c2c0ab2">getReductionOpChain</a>(Phi, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</span></CodeLine>
<Link id="l07004" /><CodeLine lineNumber="7004"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> InLoop = !ReductionOperations.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>();</span></CodeLine>
<Link id="l07005" /><CodeLine lineNumber="7005"></CodeLine>
<Link id="l07006" /><CodeLine lineNumber="7006"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (InLoop) &#123;</span></CodeLine>
<Link id="l07007" /><CodeLine lineNumber="7007"><span class="doxyHighlight">      InLoopReductions.insert(Phi);</span></CodeLine>
<Link id="l07008" /><CodeLine lineNumber="7008"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Add the elements to InLoopReductionImmediateChains for cost modelling.</span></CodeLine>
<Link id="l07009" /><CodeLine lineNumber="7009"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;LastChain = Phi;</span></CodeLine>
<Link id="l07010" /><CodeLine lineNumber="7010"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : ReductionOperations) &#123;</span></CodeLine>
<Link id="l07011" /><CodeLine lineNumber="7011"><span class="doxyHighlight">        InLoopReductionImmediateChains&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = LastChain;</span></CodeLine>
<Link id="l07012" /><CodeLine lineNumber="7012"><span class="doxyHighlight">        LastChain = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l07013" /><CodeLine lineNumber="7013"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07014" /><CodeLine lineNumber="7014"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07015" /><CodeLine lineNumber="7015"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Using &quot;</span><span class="doxyHighlight"> &lt;&lt; (InLoop ? </span><span class="doxyHighlightStringLiteral">&quot;inloop&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;out of loop&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l07016" /><CodeLine lineNumber="7016"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; reduction for phi: &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Phi &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07017" /><CodeLine lineNumber="7017"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07018" /><CodeLine lineNumber="7018"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07019" /><CodeLine lineNumber="7019"></CodeLine>
<Link id="l07020" /><CodeLine lineNumber="7020"><span class="doxyHighlightComment">// This function will select a scalable VF if the target supports scalable</span></CodeLine>
<Link id="l07021" /><CodeLine lineNumber="7021"><span class="doxyHighlightComment">// vectors and a fixed one otherwise.</span></CodeLine>
<Link id="l07022" /><CodeLine lineNumber="7022"><span class="doxyHighlightComment">// TODO: we could return a pair of values that specify the max VF and</span></CodeLine>
<Link id="l07023" /><CodeLine lineNumber="7023"><span class="doxyHighlightComment">// min VF, to be used in &#96;buildVPlans(MinVF, MaxVF)&#96; instead of</span></CodeLine>
<Link id="l07024" /><CodeLine lineNumber="7024"><span class="doxyHighlightComment">// &#96;buildVPlans(VF, VF)&#96;. We cannot do it because VPLAN at the moment</span></CodeLine>
<Link id="l07025" /><CodeLine lineNumber="7025"><span class="doxyHighlightComment">// doesn&#39;t have a cost model that can choose which plan to execute if</span></CodeLine>
<Link id="l07026" /><CodeLine lineNumber="7026"><span class="doxyHighlightComment">// more than one is generated.</span></CodeLine>
<Link id="l07027" /><CodeLine lineNumber="7027" lineLink="#a0b91e092434338369b2e1995b87f0c5b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> <a href="#a0b91e092434338369b2e1995b87f0c5b">determineVPlanVF</a>(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l07028" /><CodeLine lineNumber="7028"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> &amp;CM) &#123;</span></CodeLine>
<Link id="l07029" /><CodeLine lineNumber="7029"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> WidestType;</span></CodeLine>
<Link id="l07030" /><CodeLine lineNumber="7030"><span class="doxyHighlight">  std::tie(std::ignore, WidestType) = CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a1fa63b37ad2ac06f289e9962a3703e9e">getSmallestAndWidestTypes</a>();</span></CodeLine>
<Link id="l07031" /><CodeLine lineNumber="7031"></CodeLine>
<Link id="l07032" /><CodeLine lineNumber="7032"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166">TargetTransformInfo::RegisterKind</a> RegKind =</span></CodeLine>
<Link id="l07033" /><CodeLine lineNumber="7033"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.enableScalableVectorization()</span></CodeLine>
<Link id="l07034" /><CodeLine lineNumber="7034"><span class="doxyHighlight">          ? <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166a331413d3887a08546d0973091f6a4993">TargetTransformInfo::RGK&#95;ScalableVector</a></span></CodeLine>
<Link id="l07035" /><CodeLine lineNumber="7035"><span class="doxyHighlight">          : <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166a183020fbea95c99db23f6d3594f4c4af">TargetTransformInfo::RGK&#95;FixedWidthVector</a>;</span></CodeLine>
<Link id="l07036" /><CodeLine lineNumber="7036"></CodeLine>
<Link id="l07037" /><CodeLine lineNumber="7037"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/typesize">TypeSize</a> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a9c374320ed4e895f9afa199987182bd2">RegSize</a> = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getRegisterBitWidth(RegKind);</span></CodeLine>
<Link id="l07038" /><CodeLine lineNumber="7038"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a9c374320ed4e895f9afa199987182bd2">RegSize</a>.getKnownMinValue() / WidestType;</span></CodeLine>
<Link id="l07039" /><CodeLine lineNumber="7039"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/elementcount/#a79ea372f9aa69492fccfafc0e5a1589c">ElementCount::get</a>(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a9c374320ed4e895f9afa199987182bd2">RegSize</a>.isScalable());</span></CodeLine>
<Link id="l07040" /><CodeLine lineNumber="7040"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07041" /><CodeLine lineNumber="7041"></CodeLine>
<Link id="l07042" /><CodeLine lineNumber="7042"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a></span></CodeLine>
<Link id="l07043" /><CodeLine lineNumber="7043" lineLink="/docs/api/classes/llvm/loopvectorizationplanner/#a2206e77c573f4947146faa681ea8855e"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/loopvectorizationplanner/#a2206e77c573f4947146faa681ea8855e">LoopVectorizationPlanner::planInVPlanNativePath</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF) &#123;</span></CodeLine>
<Link id="l07044" /><CodeLine lineNumber="7044"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF = UserVF;</span></CodeLine>
<Link id="l07045" /><CodeLine lineNumber="7045"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Outer loop handling: They may require CFG and instruction level</span></CodeLine>
<Link id="l07046" /><CodeLine lineNumber="7046"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// transformations before even evaluating whether vectorization is profitable.</span></CodeLine>
<Link id="l07047" /><CodeLine lineNumber="7047"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Since we cannot modify the incoming IR, we need to build VPlan upfront in</span></CodeLine>
<Link id="l07048" /><CodeLine lineNumber="7048"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the vectorization pipeline.</span></CodeLine>
<Link id="l07049" /><CodeLine lineNumber="7049"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OrigLoop-&gt;isInnermost()) &#123;</span></CodeLine>
<Link id="l07050" /><CodeLine lineNumber="7050"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the user doesn&#39;t provide a vectorization factor, determine a</span></CodeLine>
<Link id="l07051" /><CodeLine lineNumber="7051"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// reasonable one.</span></CodeLine>
<Link id="l07052" /><CodeLine lineNumber="7052"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ad96fee81c3174ef427bf779d73fb1ef2">isZero</a>()) &#123;</span></CodeLine>
<Link id="l07053" /><CodeLine lineNumber="7053"><span class="doxyHighlight">      VF = <a href="#a0b91e092434338369b2e1995b87f0c5b">determineVPlanVF</a>(TTI, CM);</span></CodeLine>
<Link id="l07054" /><CodeLine lineNumber="7054"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: VPlan computed VF &quot;</span><span class="doxyHighlight"> &lt;&lt; VF &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07055" /><CodeLine lineNumber="7055"></CodeLine>
<Link id="l07056" /><CodeLine lineNumber="7056"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Make sure we have a VF &gt; 1 for stress testing.</span></CodeLine>
<Link id="l07057" /><CodeLine lineNumber="7057"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a9f30855a6efcd4a12875deb88880b510">VPlanBuildStressTest</a> &amp;&amp; (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ad96fee81c3174ef427bf779d73fb1ef2">isZero</a>())) &#123;</span></CodeLine>
<Link id="l07058" /><CodeLine lineNumber="7058"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: VPlan stress testing: &quot;</span></CodeLine>
<Link id="l07059" /><CodeLine lineNumber="7059"><span class="doxyHighlight">                          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;overriding computed VF.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07060" /><CodeLine lineNumber="7060"><span class="doxyHighlight">        VF = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(4);</span></CodeLine>
<Link id="l07061" /><CodeLine lineNumber="7061"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07062" /><CodeLine lineNumber="7062"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp; !TTI.supportsScalableVectors() &amp;&amp;</span></CodeLine>
<Link id="l07063" /><CodeLine lineNumber="7063"><span class="doxyHighlight">               !<a href="#a48035e22b43c905a2961c90e5470b2f0">ForceTargetSupportsScalableVectors</a>) &#123;</span></CodeLine>
<Link id="l07064" /><CodeLine lineNumber="7064"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Not vectorizing. Scalable VF requested, but &quot;</span></CodeLine>
<Link id="l07065" /><CodeLine lineNumber="7065"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;not supported by the target.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07066" /><CodeLine lineNumber="7066"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span></CodeLine>
<Link id="l07067" /><CodeLine lineNumber="7067"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Scalable vectorization requested but not supported by the target&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l07068" /><CodeLine lineNumber="7068"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;the scalable user-specified vectorization width for outer-loop &quot;</span></CodeLine>
<Link id="l07069" /><CodeLine lineNumber="7069"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;vectorization cannot be used because the target does not support &quot;</span></CodeLine>
<Link id="l07070" /><CodeLine lineNumber="7070"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;scalable vectors.&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l07071" /><CodeLine lineNumber="7071"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;ScalableVFUnfeasible&quot;</span><span class="doxyHighlight">, ORE, OrigLoop);</span></CodeLine>
<Link id="l07072" /><CodeLine lineNumber="7072"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vectorizationfactor/#acd24dfdad4f887e1f7b10c9039a05930">VectorizationFactor::Disabled</a>();</span></CodeLine>
<Link id="l07073" /><CodeLine lineNumber="7073"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07074" /><CodeLine lineNumber="7074"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;VPlan-native path is not enabled.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07075" /><CodeLine lineNumber="7075"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>()) &amp;&amp;</span></CodeLine>
<Link id="l07076" /><CodeLine lineNumber="7076"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;VF needs to be a power of two&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07077" /><CodeLine lineNumber="7077"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Using &quot;</span><span class="doxyHighlight"> &lt;&lt; (!UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ad96fee81c3174ef427bf779d73fb1ef2">isZero</a>() ? </span><span class="doxyHighlightStringLiteral">&quot;user &quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">)</span></CodeLine>
<Link id="l07078" /><CodeLine lineNumber="7078"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;VF &quot;</span><span class="doxyHighlight"> &lt;&lt; VF &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; to build VPlans.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07079" /><CodeLine lineNumber="7079"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationplanner/#a36d6728b8c3cfca0a9bd02c3f0273477">buildVPlans</a>(VF, VF);</span></CodeLine>
<Link id="l07080" /><CodeLine lineNumber="7080"></CodeLine>
<Link id="l07081" /><CodeLine lineNumber="7081"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For VPlan build stress testing, we bail out after VPlan construction.</span></CodeLine>
<Link id="l07082" /><CodeLine lineNumber="7082"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a9f30855a6efcd4a12875deb88880b510">VPlanBuildStressTest</a>)</span></CodeLine>
<Link id="l07083" /><CodeLine lineNumber="7083"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vectorizationfactor/#acd24dfdad4f887e1f7b10c9039a05930">VectorizationFactor::Disabled</a>();</span></CodeLine>
<Link id="l07084" /><CodeLine lineNumber="7084"></CodeLine>
<Link id="l07085" /><CodeLine lineNumber="7085"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;VF, 0 </span><span class="doxyHighlightComment">/&#42;Cost&#42;/</span><span class="doxyHighlight">, 0 </span><span class="doxyHighlightComment">/&#42; ScalarCost &#42;/</span><span class="doxyHighlight">&#125;;</span></CodeLine>
<Link id="l07086" /><CodeLine lineNumber="7086"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07087" /><CodeLine lineNumber="7087"></CodeLine>
<Link id="l07088" /><CodeLine lineNumber="7088"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l07089" /><CodeLine lineNumber="7089"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Not vectorizing. Inner loops aren&#39;t supported in the &quot;</span></CodeLine>
<Link id="l07090" /><CodeLine lineNumber="7090"><span class="doxyHighlight">                </span><span class="doxyHighlightStringLiteral">&quot;VPlan-native path.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07091" /><CodeLine lineNumber="7091"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vectorizationfactor/#acd24dfdad4f887e1f7b10c9039a05930">VectorizationFactor::Disabled</a>();</span></CodeLine>
<Link id="l07092" /><CodeLine lineNumber="7092"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07093" /><CodeLine lineNumber="7093"></CodeLine>
<Link id="l07094" /><CodeLine lineNumber="7094" lineLink="/docs/api/classes/llvm/loopvectorizationplanner/#aca6160bb3d669e9ce01f91b124e7e0a1"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizationplanner/#aca6160bb3d669e9ce01f91b124e7e0a1">LoopVectorizationPlanner::plan</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> UserIC) &#123;</span></CodeLine>
<Link id="l07095" /><CodeLine lineNumber="7095"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OrigLoop-&gt;isInnermost() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Inner loop expected.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07096" /><CodeLine lineNumber="7096"><span class="doxyHighlight">  CM.collectValuesToIgnore();</span></CodeLine>
<Link id="l07097" /><CodeLine lineNumber="7097"><span class="doxyHighlight">  CM.collectElementTypesForWidening();</span></CodeLine>
<Link id="l07098" /><CodeLine lineNumber="7098"></CodeLine>
<Link id="l07099" /><CodeLine lineNumber="7099"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/fixedscalablevfpair">FixedScalableVFPair</a> MaxFactors = CM.computeMaxVF(UserVF, UserIC);</span></CodeLine>
<Link id="l07100" /><CodeLine lineNumber="7100"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MaxFactors) </span><span class="doxyHighlightComment">// Cases that should not to be vectorized nor interleaved.</span></CodeLine>
<Link id="l07101" /><CodeLine lineNumber="7101"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07102" /><CodeLine lineNumber="7102"></CodeLine>
<Link id="l07103" /><CodeLine lineNumber="7103"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Invalidate interleave groups if all blocks of loop will be predicated.</span></CodeLine>
<Link id="l07104" /><CodeLine lineNumber="7104"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CM.blockNeedsPredicationForAnyReason(OrigLoop-&gt;getHeader()) &amp;&amp;</span></CodeLine>
<Link id="l07105" /><CodeLine lineNumber="7105"><span class="doxyHighlight">      !<a href="#adf8d8fb6f39b9c0cf21d55b7229d35e2">useMaskedInterleavedAccesses</a>(TTI)) &#123;</span></CodeLine>
<Link id="l07106" /><CodeLine lineNumber="7106"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l07107" /><CodeLine lineNumber="7107"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l07108" /><CodeLine lineNumber="7108"><span class="doxyHighlight">        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Invalidate all interleaved groups due to fold-tail by masking &quot;</span></CodeLine>
<Link id="l07109" /><CodeLine lineNumber="7109"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;which requires masked-interleaved support.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07110" /><CodeLine lineNumber="7110"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CM.InterleaveInfo.invalidateGroups())</span></CodeLine>
<Link id="l07111" /><CodeLine lineNumber="7111"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Invalidating interleave groups also requires invalidating all decisions</span></CodeLine>
<Link id="l07112" /><CodeLine lineNumber="7112"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// based on them, which includes widening decisions and uniform and scalar</span></CodeLine>
<Link id="l07113" /><CodeLine lineNumber="7113"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// values.</span></CodeLine>
<Link id="l07114" /><CodeLine lineNumber="7114"><span class="doxyHighlight">      CM.invalidateCostModelingDecisions();</span></CodeLine>
<Link id="l07115" /><CodeLine lineNumber="7115"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07116" /><CodeLine lineNumber="7116"></CodeLine>
<Link id="l07117" /><CodeLine lineNumber="7117"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CM.foldTailByMasking())</span></CodeLine>
<Link id="l07118" /><CodeLine lineNumber="7118"><span class="doxyHighlight">    Legal-&gt;prepareToFoldTailByMasking();</span></CodeLine>
<Link id="l07119" /><CodeLine lineNumber="7119"></CodeLine>
<Link id="l07120" /><CodeLine lineNumber="7120"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MaxUserVF =</span></CodeLine>
<Link id="l07121" /><CodeLine lineNumber="7121"><span class="doxyHighlight">      UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() ? MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25f82f8ef3355c335a7ddae4ad0b6965">ScalableVF</a> : MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25a62c28e80eac3b4cc08470ae0770bd">FixedVF</a>;</span></CodeLine>
<Link id="l07122" /><CodeLine lineNumber="7122"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserVF) &#123;</span></CodeLine>
<Link id="l07123" /><CodeLine lineNumber="7123"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a338ba7ca7a526243ab1853d07d90fe38">ElementCount::isKnownLE</a>(UserVF, MaxUserVF)) &#123;</span></CodeLine>
<Link id="l07124" /><CodeLine lineNumber="7124"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</span></CodeLine>
<Link id="l07125" /><CodeLine lineNumber="7125"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;UserVF ignored because it may be larger than the maximal safe VF&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l07126" /><CodeLine lineNumber="7126"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;InvalidUserVF&quot;</span><span class="doxyHighlight">, ORE, OrigLoop);</span></CodeLine>
<Link id="l07127" /><CodeLine lineNumber="7127"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l07128" /><CodeLine lineNumber="7128"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>()) &amp;&amp;</span></CodeLine>
<Link id="l07129" /><CodeLine lineNumber="7129"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;VF needs to be a power of two&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07130" /><CodeLine lineNumber="7130"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Collect the instructions (and their associated costs) that will be more</span></CodeLine>
<Link id="l07131" /><CodeLine lineNumber="7131"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// profitable to scalarize.</span></CodeLine>
<Link id="l07132" /><CodeLine lineNumber="7132"><span class="doxyHighlight">      CM.collectInLoopReductions();</span></CodeLine>
<Link id="l07133" /><CodeLine lineNumber="7133"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CM.selectUserVectorizationFactor(UserVF)) &#123;</span></CodeLine>
<Link id="l07134" /><CodeLine lineNumber="7134"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Using user VF &quot;</span><span class="doxyHighlight"> &lt;&lt; UserVF &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07135" /><CodeLine lineNumber="7135"><span class="doxyHighlight">        buildVPlansWithVPRecipes(UserVF, UserVF);</span></CodeLine>
<Link id="l07136" /><CodeLine lineNumber="7136"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/classes/llvm/loopvectorizationplanner/#ac3a6a342405e61ad992020460a530dc4">printPlans</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</span></CodeLine>
<Link id="l07137" /><CodeLine lineNumber="7137"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07138" /><CodeLine lineNumber="7138"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07139" /><CodeLine lineNumber="7139"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</span><span class="doxyHighlightStringLiteral">&quot;UserVF ignored because of invalid costs.&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l07140" /><CodeLine lineNumber="7140"><span class="doxyHighlight">                              </span><span class="doxyHighlightStringLiteral">&quot;InvalidCost&quot;</span><span class="doxyHighlight">, ORE, OrigLoop);</span></CodeLine>
<Link id="l07141" /><CodeLine lineNumber="7141"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07142" /><CodeLine lineNumber="7142"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07143" /><CodeLine lineNumber="7143"></CodeLine>
<Link id="l07144" /><CodeLine lineNumber="7144"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect the Vectorization Factor Candidates.</span></CodeLine>
<Link id="l07145" /><CodeLine lineNumber="7145"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ElementCount&gt;</a> VFCandidates;</span></CodeLine>
<Link id="l07146" /><CodeLine lineNumber="7146"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> VF = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1);</span></CodeLine>
<Link id="l07147" /><CodeLine lineNumber="7147"><span class="doxyHighlight">       <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a338ba7ca7a526243ab1853d07d90fe38">ElementCount::isKnownLE</a>(VF, MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25a62c28e80eac3b4cc08470ae0770bd">FixedVF</a>); VF &#42;= 2)</span></CodeLine>
<Link id="l07148" /><CodeLine lineNumber="7148"><span class="doxyHighlight">    VFCandidates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VF);</span></CodeLine>
<Link id="l07149" /><CodeLine lineNumber="7149"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> VF = <a href="/docs/api/classes/llvm/elementcount/#a1bddc4949ab247dd1474f79b9bc6e34e">ElementCount::getScalable</a>(1);</span></CodeLine>
<Link id="l07150" /><CodeLine lineNumber="7150"><span class="doxyHighlight">       <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a338ba7ca7a526243ab1853d07d90fe38">ElementCount::isKnownLE</a>(VF, MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25f82f8ef3355c335a7ddae4ad0b6965">ScalableVF</a>); VF &#42;= 2)</span></CodeLine>
<Link id="l07151" /><CodeLine lineNumber="7151"><span class="doxyHighlight">    VFCandidates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VF);</span></CodeLine>
<Link id="l07152" /><CodeLine lineNumber="7152"></CodeLine>
<Link id="l07153" /><CodeLine lineNumber="7153"><span class="doxyHighlight">  CM.collectInLoopReductions();</span></CodeLine>
<Link id="l07154" /><CodeLine lineNumber="7154"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;VF : VFCandidates) &#123;</span></CodeLine>
<Link id="l07155" /><CodeLine lineNumber="7155"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Collect Uniform and Scalar instructions after vectorization with VF.</span></CodeLine>
<Link id="l07156" /><CodeLine lineNumber="7156"><span class="doxyHighlight">    CM.collectUniformsAndScalars(VF);</span></CodeLine>
<Link id="l07157" /><CodeLine lineNumber="7157"></CodeLine>
<Link id="l07158" /><CodeLine lineNumber="7158"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Collect the instructions (and their associated costs) that will be more</span></CodeLine>
<Link id="l07159" /><CodeLine lineNumber="7159"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// profitable to scalarize.</span></CodeLine>
<Link id="l07160" /><CodeLine lineNumber="7160"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>())</span></CodeLine>
<Link id="l07161" /><CodeLine lineNumber="7161"><span class="doxyHighlight">      CM.collectInstsToScalarize(VF);</span></CodeLine>
<Link id="l07162" /><CodeLine lineNumber="7162"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07163" /><CodeLine lineNumber="7163"></CodeLine>
<Link id="l07164" /><CodeLine lineNumber="7164"><span class="doxyHighlight">  buildVPlansWithVPRecipes(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1), MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25a62c28e80eac3b4cc08470ae0770bd">FixedVF</a>);</span></CodeLine>
<Link id="l07165" /><CodeLine lineNumber="7165"><span class="doxyHighlight">  buildVPlansWithVPRecipes(<a href="/docs/api/classes/llvm/elementcount/#a1bddc4949ab247dd1474f79b9bc6e34e">ElementCount::getScalable</a>(1), MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25f82f8ef3355c335a7ddae4ad0b6965">ScalableVF</a>);</span></CodeLine>
<Link id="l07166" /><CodeLine lineNumber="7166"></CodeLine>
<Link id="l07167" /><CodeLine lineNumber="7167"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/classes/llvm/loopvectorizationplanner/#ac3a6a342405e61ad992020460a530dc4">printPlans</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</span></CodeLine>
<Link id="l07168" /><CodeLine lineNumber="7168"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07169" /><CodeLine lineNumber="7169"></CodeLine>
<Link id="l07170" /><CodeLine lineNumber="7170" lineLink="/docs/api/structs/llvm/vpcostcontext/#a79d75561901a5fc0d187b229afd5a745"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/structs/llvm/vpcostcontext/#a79d75561901a5fc0d187b229afd5a745">VPCostContext::getLegacyCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI,</span></CodeLine>
<Link id="l07171" /><CodeLine lineNumber="7171"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l07172" /><CodeLine lineNumber="7172"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a5eae6074e6a1bb62e365ef65f3e26196">ForceTargetInstructionCost</a>.getNumOccurrences())</span></CodeLine>
<Link id="l07173" /><CodeLine lineNumber="7173"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a>(<a href="#a5eae6074e6a1bb62e365ef65f3e26196">ForceTargetInstructionCost</a>.getNumOccurrences());</span></CodeLine>
<Link id="l07174" /><CodeLine lineNumber="7174"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vpcostcontext/#a311ad8e3c775be69bcc47aa3e766606d">CM</a>.getInstructionCost(UI, VF);</span></CodeLine>
<Link id="l07175" /><CodeLine lineNumber="7175"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07176" /><CodeLine lineNumber="7176"></CodeLine>
<Link id="l07177" /><CodeLine lineNumber="7177" lineLink="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756">VPCostContext::skipCostComputation</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsVector)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l07178" /><CodeLine lineNumber="7178"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vpcostcontext/#a311ad8e3c775be69bcc47aa3e766606d">CM</a>.ValuesToIgnore.contains(UI) ||</span></CodeLine>
<Link id="l07179" /><CodeLine lineNumber="7179"><span class="doxyHighlight">         (IsVector &amp;&amp; <a href="/docs/api/structs/llvm/vpcostcontext/#a311ad8e3c775be69bcc47aa3e766606d">CM</a>.VecValuesToIgnore.contains(UI)) ||</span></CodeLine>
<Link id="l07180" /><CodeLine lineNumber="7180"><span class="doxyHighlight">         <a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.contains(UI);</span></CodeLine>
<Link id="l07181" /><CodeLine lineNumber="7181"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07182" /><CodeLine lineNumber="7182"></CodeLine>
<Link id="l07183" /><CodeLine lineNumber="7183"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></span></CodeLine>
<Link id="l07184" /><CodeLine lineNumber="7184"><span class="doxyHighlight">LoopVectorizationPlanner::precomputeCosts(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF,</span></CodeLine>
<Link id="l07185" /><CodeLine lineNumber="7185"><span class="doxyHighlight">                                          <a href="/docs/api/structs/llvm/vpcostcontext">VPCostContext</a> &amp;CostCtx)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l07186" /><CodeLine lineNumber="7186"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</span></CodeLine>
<Link id="l07187" /><CodeLine lineNumber="7187"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Cost modeling for inductions is inaccurate in the legacy cost model</span></CodeLine>
<Link id="l07188" /><CodeLine lineNumber="7188"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// compared to the recipes that are generated. To match here initially during</span></CodeLine>
<Link id="l07189" /><CodeLine lineNumber="7189"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// VPlan cost model bring up directly use the induction costs from the legacy</span></CodeLine>
<Link id="l07190" /><CodeLine lineNumber="7190"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cost model. Note that we do this as pre-processing; the VPlan may not have</span></CodeLine>
<Link id="l07191" /><CodeLine lineNumber="7191"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// any recipes associated with the original induction increment instruction</span></CodeLine>
<Link id="l07192" /><CodeLine lineNumber="7192"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and may replace truncates with VPWidenIntOrFpInductionRecipe. We precompute</span></CodeLine>
<Link id="l07193" /><CodeLine lineNumber="7193"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the cost of induction phis and increments (both that are represented by</span></CodeLine>
<Link id="l07194" /><CodeLine lineNumber="7194"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// recipes and those that are not), to avoid distinguishing between them here,</span></CodeLine>
<Link id="l07195" /><CodeLine lineNumber="7195"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and skip all recipes that represent induction phis and increments (the</span></CodeLine>
<Link id="l07196" /><CodeLine lineNumber="7196"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// former case) later on, if they exist, to avoid counting them twice.</span></CodeLine>
<Link id="l07197" /><CodeLine lineNumber="7197"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Similarly we pre-compute the cost of any optimized truncates.</span></CodeLine>
<Link id="l07198" /><CodeLine lineNumber="7198"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Switch to more accurate costing based on VPlan.</span></CodeLine>
<Link id="l07199" /><CodeLine lineNumber="7199"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>, IndDesc&#93; : <a href="/docs/api/namespaces/llvm/irsimilarity/#af46430106334db52bfa7a4107e53a0bda8f7357506e00d8cd0694f948f909865d">Legal</a>-&gt;getInductionVars()) &#123;</span></CodeLine>
<Link id="l07200" /><CodeLine lineNumber="7200"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVInc = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(</span></CodeLine>
<Link id="l07201" /><CodeLine lineNumber="7201"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getIncomingValueForBlock(OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a1230fd674d2609b96527fe65eaf40b1b">getLoopLatch</a>()));</span></CodeLine>
<Link id="l07202" /><CodeLine lineNumber="7202"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;&gt;</a> IVInsts = &#123;IVInc&#125;;</span></CodeLine>
<Link id="l07203" /><CodeLine lineNumber="7203"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != IVInsts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) &#123;</span></CodeLine>
<Link id="l07204" /><CodeLine lineNumber="7204"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : IVInsts&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;-&gt;operands()) &#123;</span></CodeLine>
<Link id="l07205" /><CodeLine lineNumber="7205"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l07206" /><CodeLine lineNumber="7206"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> || !OpI || !OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(OpI) || !<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;hasOneUse())</span></CodeLine>
<Link id="l07207" /><CodeLine lineNumber="7207"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07208" /><CodeLine lineNumber="7208"><span class="doxyHighlight">        IVInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpI);</span></CodeLine>
<Link id="l07209" /><CodeLine lineNumber="7209"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07210" /><CodeLine lineNumber="7210"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07211" /><CodeLine lineNumber="7211"><span class="doxyHighlight">    IVInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>);</span></CodeLine>
<Link id="l07212" /><CodeLine lineNumber="7212"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (User &#42;U : <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;users()) &#123;</span></CodeLine>
<Link id="l07213" /><CodeLine lineNumber="7213"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</span></CodeLine>
<Link id="l07214" /><CodeLine lineNumber="7214"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a311ad8e3c775be69bcc47aa3e766606d">CM</a>.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a61375f5189558cc261186f388d31fe92">isOptimizableIVTruncate</a>(CI, VF))</span></CodeLine>
<Link id="l07215" /><CodeLine lineNumber="7215"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07216" /><CodeLine lineNumber="7216"><span class="doxyHighlight">      IVInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CI);</span></CodeLine>
<Link id="l07217" /><CodeLine lineNumber="7217"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07218" /><CodeLine lineNumber="7218"></CodeLine>
<Link id="l07219" /><CodeLine lineNumber="7219"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the vector loop gets executed exactly once with the given VF, ignore</span></CodeLine>
<Link id="l07220" /><CodeLine lineNumber="7220"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the costs of comparison and induction instructions, as they&#39;ll get</span></CodeLine>
<Link id="l07221" /><CodeLine lineNumber="7221"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// simplified away.</span></CodeLine>
<Link id="l07222" /><CodeLine lineNumber="7222"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Remove this code after stepping away from the legacy cost model and</span></CodeLine>
<Link id="l07223" /><CodeLine lineNumber="7223"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// adding code to simplify VPlans before calculating their costs.</span></CodeLine>
<Link id="l07224" /><CodeLine lineNumber="7224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> TC = PSE.getSE()-&gt;getSmallConstantTripCount(OrigLoop);</span></CodeLine>
<Link id="l07225" /><CodeLine lineNumber="7225"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#aab9a9b0568c1c524f01499c7930b3bf9">isFixed</a>() &amp;&amp; TC == VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>() &amp;&amp; !CM.foldTailByMasking())</span></CodeLine>
<Link id="l07226" /><CodeLine lineNumber="7226"><span class="doxyHighlight">      <a href="#ababcaf6e2e00fc3fc8791ea2c3acbda5">addFullyUnrolledInstructionsToIgnore</a>(OrigLoop, Legal-&gt;getInductionVars(),</span></CodeLine>
<Link id="l07227" /><CodeLine lineNumber="7227"><span class="doxyHighlight">                                           CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>);</span></CodeLine>
<Link id="l07228" /><CodeLine lineNumber="7228"></CodeLine>
<Link id="l07229" /><CodeLine lineNumber="7229"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;IVInst : IVInsts) &#123;</span></CodeLine>
<Link id="l07230" /><CodeLine lineNumber="7230"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756">skipCostComputation</a>(IVInst, VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()))</span></CodeLine>
<Link id="l07231" /><CodeLine lineNumber="7231"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07232" /><CodeLine lineNumber="7232"><span class="doxyHighlight">      InstructionCost InductionCost = CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a79d75561901a5fc0d187b229afd5a745">getLegacyCost</a>(IVInst, VF);</span></CodeLine>
<Link id="l07233" /><CodeLine lineNumber="7233"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l07234" /><CodeLine lineNumber="7234"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Cost of &quot;</span><span class="doxyHighlight"> &lt;&lt; InductionCost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; for VF &quot;</span><span class="doxyHighlight"> &lt;&lt; VF</span></CodeLine>
<Link id="l07235" /><CodeLine lineNumber="7235"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;: induction instruction &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;IVInst &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07236" /><CodeLine lineNumber="7236"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l07237" /><CodeLine lineNumber="7237"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += InductionCost;</span></CodeLine>
<Link id="l07238" /><CodeLine lineNumber="7238"><span class="doxyHighlight">      CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(IVInst);</span></CodeLine>
<Link id="l07239" /><CodeLine lineNumber="7239"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07240" /><CodeLine lineNumber="7240"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07241" /><CodeLine lineNumber="7241"></CodeLine>
<Link id="l07242" /><CodeLine lineNumber="7242"><span class="doxyHighlightComment">  /// Compute the cost of all exiting conditions of the loop using the legacy</span></CodeLine>
<Link id="l07243" /><CodeLine lineNumber="7243"><span class="doxyHighlightComment">  /// cost model. This is to match the legacy behavior, which adds the cost of</span></CodeLine>
<Link id="l07244" /><CodeLine lineNumber="7244"><span class="doxyHighlightComment">  /// all exit conditions. Note that this over-estimates the cost, as there will</span></CodeLine>
<Link id="l07245" /><CodeLine lineNumber="7245"><span class="doxyHighlightComment">  /// be a single condition to control the vector loop.</span></CodeLine>
<Link id="l07246" /><CodeLine lineNumber="7246"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;BasicBlock &#42;&gt;</a> Exiting;</span></CodeLine>
<Link id="l07247" /><CodeLine lineNumber="7247"><span class="doxyHighlight">  CM.TheLoop-&gt;getExitingBlocks(Exiting);</span></CodeLine>
<Link id="l07248" /><CodeLine lineNumber="7248"><span class="doxyHighlight">  SetVector&lt;Instruction &#42;&gt; ExitInstrs;</span></CodeLine>
<Link id="l07249" /><CodeLine lineNumber="7249"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect all exit conditions.</span></CodeLine>
<Link id="l07250" /><CodeLine lineNumber="7250"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (BasicBlock &#42;EB : Exiting) &#123;</span></CodeLine>
<Link id="l07251" /><CodeLine lineNumber="7251"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/m68kbeads/#abf9ad6053d17fcef3b68af71aa681944a27d0e059322508a76f918503800ef1bd">Term</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(EB-&gt;getTerminator());</span></CodeLine>
<Link id="l07252" /><CodeLine lineNumber="7252"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Term || CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756">skipCostComputation</a>(Term, VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()))</span></CodeLine>
<Link id="l07253" /><CodeLine lineNumber="7253"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07254" /><CodeLine lineNumber="7254"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CondI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68kbeads/#abf9ad6053d17fcef3b68af71aa681944a27d0e059322508a76f918503800ef1bd">Term</a>-&gt;getOperand(0))) &#123;</span></CodeLine>
<Link id="l07255" /><CodeLine lineNumber="7255"><span class="doxyHighlight">      ExitInstrs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(CondI);</span></CodeLine>
<Link id="l07256" /><CodeLine lineNumber="7256"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07257" /><CodeLine lineNumber="7257"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07258" /><CodeLine lineNumber="7258"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Compute the cost of all instructions only feeding the exit conditions.</span></CodeLine>
<Link id="l07259" /><CodeLine lineNumber="7259"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ExitInstrs.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l07260" /><CodeLine lineNumber="7260"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;CondI = ExitInstrs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l07261" /><CodeLine lineNumber="7261"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OrigLoop-&gt;contains(CondI) ||</span></CodeLine>
<Link id="l07262" /><CodeLine lineNumber="7262"><span class="doxyHighlight">        !CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(CondI).second)</span></CodeLine>
<Link id="l07263" /><CodeLine lineNumber="7263"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07264" /><CodeLine lineNumber="7264"><span class="doxyHighlight">    InstructionCost CondICost = CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a79d75561901a5fc0d187b229afd5a745">getLegacyCost</a>(CondI, VF);</span></CodeLine>
<Link id="l07265" /><CodeLine lineNumber="7265"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l07266" /><CodeLine lineNumber="7266"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Cost of &quot;</span><span class="doxyHighlight"> &lt;&lt; CondICost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; for VF &quot;</span><span class="doxyHighlight"> &lt;&lt; VF</span></CodeLine>
<Link id="l07267" /><CodeLine lineNumber="7267"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;: exit condition instruction &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;CondI &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07268" /><CodeLine lineNumber="7268"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l07269" /><CodeLine lineNumber="7269"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += CondICost;</span></CodeLine>
<Link id="l07270" /><CodeLine lineNumber="7270"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : CondI-&gt;<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>()) &#123;</span></CodeLine>
<Link id="l07271" /><CodeLine lineNumber="7271"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l07272" /><CodeLine lineNumber="7272"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!OpI || CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756">skipCostComputation</a>(OpI, VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()) ||</span></CodeLine>
<Link id="l07273" /><CodeLine lineNumber="7273"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(OpI-&gt;users(), &#91;&amp;ExitInstrs, </span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(User &#42;U) &#123;</span></CodeLine>
<Link id="l07274" /><CodeLine lineNumber="7274"><span class="doxyHighlight">            return OrigLoop-&gt;contains(cast&lt;Instruction&gt;(U)-&gt;getParent()) &amp;&amp;</span></CodeLine>
<Link id="l07275" /><CodeLine lineNumber="7275"><span class="doxyHighlight">                   !ExitInstrs.contains(cast&lt;Instruction&gt;(U));</span></CodeLine>
<Link id="l07276" /><CodeLine lineNumber="7276"><span class="doxyHighlight">          &#125;))</span></CodeLine>
<Link id="l07277" /><CodeLine lineNumber="7277"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07278" /><CodeLine lineNumber="7278"><span class="doxyHighlight">      ExitInstrs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(OpI);</span></CodeLine>
<Link id="l07279" /><CodeLine lineNumber="7279"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07280" /><CodeLine lineNumber="7280"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07281" /><CodeLine lineNumber="7281"></CodeLine>
<Link id="l07282" /><CodeLine lineNumber="7282"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The legacy cost model has special logic to compute the cost of in-loop</span></CodeLine>
<Link id="l07283" /><CodeLine lineNumber="7283"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reductions, which may be smaller than the sum of all instructions involved</span></CodeLine>
<Link id="l07284" /><CodeLine lineNumber="7284"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in the reduction.</span></CodeLine>
<Link id="l07285" /><CodeLine lineNumber="7285"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Switch to costing based on VPlan once the logic has been ported.</span></CodeLine>
<Link id="l07286" /><CodeLine lineNumber="7286"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;RedPhi, RdxDesc&#93; : Legal-&gt;getReductionVars()) &#123;</span></CodeLine>
<Link id="l07287" /><CodeLine lineNumber="7287"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a5eae6074e6a1bb62e365ef65f3e26196">ForceTargetInstructionCost</a>.getNumOccurrences())</span></CodeLine>
<Link id="l07288" /><CodeLine lineNumber="7288"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07289" /><CodeLine lineNumber="7289"></CodeLine>
<Link id="l07290" /><CodeLine lineNumber="7290"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CM.isInLoopReduction(RedPhi))</span></CodeLine>
<Link id="l07291" /><CodeLine lineNumber="7291"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07292" /><CodeLine lineNumber="7292"></CodeLine>
<Link id="l07293" /><CodeLine lineNumber="7293"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;ChainOps = RdxDesc.getReductionOpChain(RedPhi, OrigLoop);</span></CodeLine>
<Link id="l07294" /><CodeLine lineNumber="7294"><span class="doxyHighlight">    SetVector&lt;Instruction &#42;&gt; ChainOpsAndOperands(ChainOps.begin(),</span></CodeLine>
<Link id="l07295" /><CodeLine lineNumber="7295"><span class="doxyHighlight">                                                 ChainOps.end());</span></CodeLine>
<Link id="l07296" /><CodeLine lineNumber="7296"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsZExtOrSExt = &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opcode) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l07297" /><CodeLine lineNumber="7297"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Opcode == Instruction::ZExt || Opcode == Instruction::SExt;</span></CodeLine>
<Link id="l07298" /><CodeLine lineNumber="7298"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l07299" /><CodeLine lineNumber="7299"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Also include the operands of instructions in the chain, as the cost-model</span></CodeLine>
<Link id="l07300" /><CodeLine lineNumber="7300"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// may mark extends as free.</span></CodeLine>
<Link id="l07301" /><CodeLine lineNumber="7301"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07302" /><CodeLine lineNumber="7302"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For ARM, some of the instruction can folded into the reducion</span></CodeLine>
<Link id="l07303" /><CodeLine lineNumber="7303"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instruction. So we need to mark all folded instructions free.</span></CodeLine>
<Link id="l07304" /><CodeLine lineNumber="7304"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For example: We can fold reduce(mul(ext(A), ext(B))) into one</span></CodeLine>
<Link id="l07305" /><CodeLine lineNumber="7305"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instruction.</span></CodeLine>
<Link id="l07306" /><CodeLine lineNumber="7306"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ChainOp : ChainOps) &#123;</span></CodeLine>
<Link id="l07307" /><CodeLine lineNumber="7307"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : ChainOp-&gt;operands()) &#123;</span></CodeLine>
<Link id="l07308" /><CodeLine lineNumber="7308"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) &#123;</span></CodeLine>
<Link id="l07309" /><CodeLine lineNumber="7309"><span class="doxyHighlight">          ChainOpsAndOperands.insert(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l07310" /><CodeLine lineNumber="7310"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::Mul) &#123;</span></CodeLine>
<Link id="l07311" /><CodeLine lineNumber="7311"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Ext0 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</span></CodeLine>
<Link id="l07312" /><CodeLine lineNumber="7312"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Ext1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</span></CodeLine>
<Link id="l07313" /><CodeLine lineNumber="7313"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Ext0 &amp;&amp; IsZExtOrSExt(Ext0-&gt;getOpcode()) &amp;&amp; Ext1 &amp;&amp;</span></CodeLine>
<Link id="l07314" /><CodeLine lineNumber="7314"><span class="doxyHighlight">                Ext0-&gt;getOpcode() == Ext1-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l07315" /><CodeLine lineNumber="7315"><span class="doxyHighlight">              ChainOpsAndOperands.insert(Ext0);</span></CodeLine>
<Link id="l07316" /><CodeLine lineNumber="7316"><span class="doxyHighlight">              ChainOpsAndOperands.insert(Ext1);</span></CodeLine>
<Link id="l07317" /><CodeLine lineNumber="7317"><span class="doxyHighlight">            &#125;</span></CodeLine>
<Link id="l07318" /><CodeLine lineNumber="7318"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l07319" /><CodeLine lineNumber="7319"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l07320" /><CodeLine lineNumber="7320"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07321" /><CodeLine lineNumber="7321"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07322" /><CodeLine lineNumber="7322"></CodeLine>
<Link id="l07323" /><CodeLine lineNumber="7323"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Pre-compute the cost for I, if it has a reduction pattern cost.</span></CodeLine>
<Link id="l07324" /><CodeLine lineNumber="7324"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : ChainOpsAndOperands) &#123;</span></CodeLine>
<Link id="l07325" /><CodeLine lineNumber="7325"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ReductionCost =</span></CodeLine>
<Link id="l07326" /><CodeLine lineNumber="7326"><span class="doxyHighlight">          CM.getReductionPatternCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), VF));</span></CodeLine>
<Link id="l07327" /><CodeLine lineNumber="7327"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ReductionCost)</span></CodeLine>
<Link id="l07328" /><CodeLine lineNumber="7328"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07329" /><CodeLine lineNumber="7329"></CodeLine>
<Link id="l07330" /><CodeLine lineNumber="7330"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.<a href="/docs/api/classes/llvm/smallptrsetimpl/#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l07331" /><CodeLine lineNumber="7331"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;reduction op visited multiple times&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07332" /><CodeLine lineNumber="7332"><span class="doxyHighlight">      CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l07333" /><CodeLine lineNumber="7333"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Cost of &quot;</span><span class="doxyHighlight"> &lt;&lt; ReductionCost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; for VF &quot;</span><span class="doxyHighlight"> &lt;&lt; VF</span></CodeLine>
<Link id="l07334" /><CodeLine lineNumber="7334"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;:\\n in-loop reduction &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07335" /><CodeLine lineNumber="7335"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += &#42;ReductionCost;</span></CodeLine>
<Link id="l07336" /><CodeLine lineNumber="7336"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07337" /><CodeLine lineNumber="7337"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07338" /><CodeLine lineNumber="7338"></CodeLine>
<Link id="l07339" /><CodeLine lineNumber="7339"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Pre-compute the costs for branches except for the backedge, as the number</span></CodeLine>
<Link id="l07340" /><CodeLine lineNumber="7340"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of replicate regions in a VPlan may not directly match the number of</span></CodeLine>
<Link id="l07341" /><CodeLine lineNumber="7341"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// branches, which would lead to different decisions.</span></CodeLine>
<Link id="l07342" /><CodeLine lineNumber="7342"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Compute cost of branches for each replicate region in the VPlan,</span></CodeLine>
<Link id="l07343" /><CodeLine lineNumber="7343"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which is more accurate than the legacy cost model.</span></CodeLine>
<Link id="l07344" /><CodeLine lineNumber="7344"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (BasicBlock &#42;BB : OrigLoop-&gt;blocks()) &#123;</span></CodeLine>
<Link id="l07345" /><CodeLine lineNumber="7345"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756">skipCostComputation</a>(BB-&gt;getTerminator(), VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()))</span></CodeLine>
<Link id="l07346" /><CodeLine lineNumber="7346"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07347" /><CodeLine lineNumber="7347"><span class="doxyHighlight">    CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(BB-&gt;getTerminator());</span></CodeLine>
<Link id="l07348" /><CodeLine lineNumber="7348"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BB == OrigLoop-&gt;getLoopLatch())</span></CodeLine>
<Link id="l07349" /><CodeLine lineNumber="7349"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07350" /><CodeLine lineNumber="7350"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> BranchCost = CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a79d75561901a5fc0d187b229afd5a745">getLegacyCost</a>(BB-&gt;getTerminator(), VF);</span></CodeLine>
<Link id="l07351" /><CodeLine lineNumber="7351"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += BranchCost;</span></CodeLine>
<Link id="l07352" /><CodeLine lineNumber="7352"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07353" /><CodeLine lineNumber="7353"></CodeLine>
<Link id="l07354" /><CodeLine lineNumber="7354"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Pre-compute costs for instructions that are forced-scalar or profitable to</span></CodeLine>
<Link id="l07355" /><CodeLine lineNumber="7355"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// scalarize. Their costs will be computed separately in the legacy cost</span></CodeLine>
<Link id="l07356" /><CodeLine lineNumber="7356"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// model.</span></CodeLine>
<Link id="l07357" /><CodeLine lineNumber="7357"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &#42;ForcedScalar : CM.ForcedScalars&#91;VF&#93;) &#123;</span></CodeLine>
<Link id="l07358" /><CodeLine lineNumber="7358"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756">skipCostComputation</a>(ForcedScalar, VF.isVector()))</span></CodeLine>
<Link id="l07359" /><CodeLine lineNumber="7359"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07360" /><CodeLine lineNumber="7360"><span class="doxyHighlight">    CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(ForcedScalar);</span></CodeLine>
<Link id="l07361" /><CodeLine lineNumber="7361"><span class="doxyHighlight">    InstructionCost ForcedCost = CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a79d75561901a5fc0d187b229afd5a745">getLegacyCost</a>(ForcedScalar, VF);</span></CodeLine>
<Link id="l07362" /><CodeLine lineNumber="7362"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l07363" /><CodeLine lineNumber="7363"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Cost of &quot;</span><span class="doxyHighlight"> &lt;&lt; ForcedCost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; for VF &quot;</span><span class="doxyHighlight"> &lt;&lt; VF</span></CodeLine>
<Link id="l07364" /><CodeLine lineNumber="7364"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;: forced scalar &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;ForcedScalar &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07365" /><CodeLine lineNumber="7365"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l07366" /><CodeLine lineNumber="7366"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += ForcedCost;</span></CodeLine>
<Link id="l07367" /><CodeLine lineNumber="7367"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07368" /><CodeLine lineNumber="7368"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;Scalarized, ScalarCost&#93; : CM.InstsToScalarize&#91;VF&#93;) &#123;</span></CodeLine>
<Link id="l07369" /><CodeLine lineNumber="7369"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756">skipCostComputation</a>(Scalarized, VF.isVector()))</span></CodeLine>
<Link id="l07370" /><CodeLine lineNumber="7370"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07371" /><CodeLine lineNumber="7371"><span class="doxyHighlight">    CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Scalarized);</span></CodeLine>
<Link id="l07372" /><CodeLine lineNumber="7372"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l07373" /><CodeLine lineNumber="7373"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Cost of &quot;</span><span class="doxyHighlight"> &lt;&lt; ScalarCost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; for VF &quot;</span><span class="doxyHighlight"> &lt;&lt; VF</span></CodeLine>
<Link id="l07374" /><CodeLine lineNumber="7374"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;: profitable to scalarize &quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;Scalarized &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07375" /><CodeLine lineNumber="7375"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l07376" /><CodeLine lineNumber="7376"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += ScalarCost;</span></CodeLine>
<Link id="l07377" /><CodeLine lineNumber="7377"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07378" /><CodeLine lineNumber="7378"></CodeLine>
<Link id="l07379" /><CodeLine lineNumber="7379"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</span></CodeLine>
<Link id="l07380" /><CodeLine lineNumber="7380"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07381" /><CodeLine lineNumber="7381"></CodeLine>
<Link id="l07382" /><CodeLine lineNumber="7382"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> LoopVectorizationPlanner::cost(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan,</span></CodeLine>
<Link id="l07383" /><CodeLine lineNumber="7383"><span class="doxyHighlight">                                               <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l07384" /><CodeLine lineNumber="7384"><span class="doxyHighlight">  VPCostContext CostCtx(CM.TTI, &#42;CM.TLI, Legal-&gt;getWidestInductionType(), CM,</span></CodeLine>
<Link id="l07385" /><CodeLine lineNumber="7385"><span class="doxyHighlight">                        CM.CostKind);</span></CodeLine>
<Link id="l07386" /><CodeLine lineNumber="7386"><span class="doxyHighlight">  InstructionCost <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = precomputeCosts(Plan, VF, CostCtx);</span></CodeLine>
<Link id="l07387" /><CodeLine lineNumber="7387"></CodeLine>
<Link id="l07388" /><CodeLine lineNumber="7388"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now compute and add the VPlan-based cost.</span></CodeLine>
<Link id="l07389" /><CodeLine lineNumber="7389"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += Plan.<a href="/docs/api/classes/llvm/vplan/#a8d2ce995a1feaa7a65ff40f77f073db3">cost</a>(VF, CostCtx);</span></CodeLine>
<Link id="l07390" /><CodeLine lineNumber="7390"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l07391" /><CodeLine lineNumber="7391"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EstimatedWidth = <a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a>(OrigLoop, CM.TTI, VF);</span></CodeLine>
<Link id="l07392" /><CodeLine lineNumber="7392"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Cost for VF &quot;</span><span class="doxyHighlight"> &lt;&lt; VF &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;: &quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a></span></CodeLine>
<Link id="l07393" /><CodeLine lineNumber="7393"><span class="doxyHighlight">                    &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; (Estimated cost per lane: &quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07394" /><CodeLine lineNumber="7394"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>()) &#123;</span></CodeLine>
<Link id="l07395" /><CodeLine lineNumber="7395"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">double</span><span class="doxyHighlight"> CostPerLane = double(&#42;<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>.<a href="/docs/api/classes/llvm/instructioncost/#a9b642067999075ba996ecdee40b52b68">getValue</a>()) / EstimatedWidth;</span></CodeLine>
<Link id="l07396" /><CodeLine lineNumber="7396"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/namespaces/llvm/#a939bc2108d47080767f0c06ba56caec7">format</a>(</span><span class="doxyHighlightStringLiteral">&quot;%.1f&quot;</span><span class="doxyHighlight">, CostPerLane));</span></CodeLine>
<Link id="l07397" /><CodeLine lineNumber="7397"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42; No point dividing an invalid cost - it will still be invalid &#42;/</span></CodeLine>
<Link id="l07398" /><CodeLine lineNumber="7398"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Invalid&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07399" /><CodeLine lineNumber="7399"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;)\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07400" /><CodeLine lineNumber="7400"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l07401" /><CodeLine lineNumber="7401"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</span></CodeLine>
<Link id="l07402" /><CodeLine lineNumber="7402"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07403" /><CodeLine lineNumber="7403"></CodeLine>
<Link id="l07404" /><CodeLine lineNumber="7404"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l07405" /><CodeLine lineNumber="7405"><span class="doxyHighlightComment">/// Return true if the original loop \\ TheLoop contains any instructions that do</span></CodeLine>
<Link id="l07406" /><CodeLine lineNumber="7406"><span class="doxyHighlightComment">/// not have corresponding recipes in \\p Plan and are not marked to be ignored</span></CodeLine>
<Link id="l07407" /><CodeLine lineNumber="7407"><span class="doxyHighlightComment">/// in \\p CostCtx. This means the VPlan contains simplification that the legacy</span></CodeLine>
<Link id="l07408" /><CodeLine lineNumber="7408"><span class="doxyHighlightComment">/// cost-model did not account for.</span></CodeLine>
<Link id="l07409" /><CodeLine lineNumber="7409" lineLink="#a696283c30308704d020a9d86065aa3ae"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a696283c30308704d020a9d86065aa3ae">planContainsAdditionalSimplifications</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan,</span></CodeLine>
<Link id="l07410" /><CodeLine lineNumber="7410"><span class="doxyHighlight">                                                  <a href="/docs/api/structs/llvm/vpcostcontext">VPCostContext</a> &amp;CostCtx,</span></CodeLine>
<Link id="l07411" /><CodeLine lineNumber="7411"><span class="doxyHighlight">                                                  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;TheLoop) &#123;</span></CodeLine>
<Link id="l07412" /><CodeLine lineNumber="7412"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First collect all instructions for the recipes in Plan.</span></CodeLine>
<Link id="l07413" /><CodeLine lineNumber="7413"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GetInstructionForCost = &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;R) -&gt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &#123;</span></CodeLine>
<Link id="l07414" /><CodeLine lineNumber="7414"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;S = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPSingleDefRecipe&gt;</a>(R))</span></CodeLine>
<Link id="l07415" /><CodeLine lineNumber="7415"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(S-&gt;getUnderlyingValue());</span></CodeLine>
<Link id="l07416" /><CodeLine lineNumber="7416"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WidenMem = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenMemoryRecipe&gt;</a>(R))</span></CodeLine>
<Link id="l07417" /><CodeLine lineNumber="7417"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &amp;WidenMem-&gt;getIngredient();</span></CodeLine>
<Link id="l07418" /><CodeLine lineNumber="7418"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07419" /><CodeLine lineNumber="7419"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l07420" /><CodeLine lineNumber="7420"></CodeLine>
<Link id="l07421" /><CodeLine lineNumber="7421"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;Instruction &#42;&gt;</a> SeenInstrs;</span></CodeLine>
<Link id="l07422" /><CodeLine lineNumber="7422"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Iter = <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#a1ae2cb3c63b4d67324ddc947fb9696fc">getEntry</a>());</span></CodeLine>
<Link id="l07423" /><CodeLine lineNumber="7423"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(Iter)) &#123;</span></CodeLine>
<Link id="l07424" /><CodeLine lineNumber="7424"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : &#42;VPBB) &#123;</span></CodeLine>
<Link id="l07425" /><CodeLine lineNumber="7425"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/legalizer-cpp/#a05ab4853f7153e537774d02580e761ec">IR</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPInterleaveRecipe&gt;</a>(&amp;R)) &#123;</span></CodeLine>
<Link id="l07426" /><CodeLine lineNumber="7426"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IG = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/legalizer-cpp/#a05ab4853f7153e537774d02580e761ec">IR</a>-&gt;getInterleaveGroup();</span></CodeLine>
<Link id="l07427" /><CodeLine lineNumber="7427"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumMembers = IG-&gt;getNumMembers();</span></CodeLine>
<Link id="l07428" /><CodeLine lineNumber="7428"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != NumMembers; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l07429" /><CodeLine lineNumber="7429"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;M = IG-&gt;getMember(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l07430" /><CodeLine lineNumber="7430"><span class="doxyHighlight">            SeenInstrs.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(M);</span></CodeLine>
<Link id="l07431" /><CodeLine lineNumber="7431"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l07432" /><CodeLine lineNumber="7432"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07433" /><CodeLine lineNumber="7433"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07434" /><CodeLine lineNumber="7434"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The VPlan-based cost model is more accurate for partial reduction and</span></CodeLine>
<Link id="l07435" /><CodeLine lineNumber="7435"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// comparing against the legacy cost isn&#39;t desirable.</span></CodeLine>
<Link id="l07436" /><CodeLine lineNumber="7436"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPPartialReductionRecipe&gt;</a>(&amp;R))</span></CodeLine>
<Link id="l07437" /><CodeLine lineNumber="7437"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07438" /><CodeLine lineNumber="7438"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = GetInstructionForCost(&amp;R))</span></CodeLine>
<Link id="l07439" /><CodeLine lineNumber="7439"><span class="doxyHighlight">        SeenInstrs.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(UI);</span></CodeLine>
<Link id="l07440" /><CodeLine lineNumber="7440"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07441" /><CodeLine lineNumber="7441"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07442" /><CodeLine lineNumber="7442"></CodeLine>
<Link id="l07443" /><CodeLine lineNumber="7443"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Return true if the loop contains any instructions that are not also part of</span></CodeLine>
<Link id="l07444" /><CodeLine lineNumber="7444"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the VPlan or are skipped for VPlan-based cost computations. This indicates</span></CodeLine>
<Link id="l07445" /><CodeLine lineNumber="7445"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that the VPlan contains extra simplifications.</span></CodeLine>
<Link id="l07446" /><CodeLine lineNumber="7446"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(TheLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a78bec3084b9a47ee11cc2e56f9004717">blocks</a>(), &#91;&amp;SeenInstrs, &amp;CostCtx,</span></CodeLine>
<Link id="l07447" /><CodeLine lineNumber="7447"><span class="doxyHighlight">                                    TheLoop&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l07448" /><CodeLine lineNumber="7448"><span class="doxyHighlight">    return any&#95;of(&#42;BB, &#91;&amp;SeenInstrs, &amp;CostCtx, TheLoop, BB&#93;(Instruction &amp;I) &#123;</span></CodeLine>
<Link id="l07449" /><CodeLine lineNumber="7449"><span class="doxyHighlight">      if (isa&lt;PHINode&gt;(&amp;I) &amp;&amp; BB == TheLoop-&gt;getHeader())</span></CodeLine>
<Link id="l07450" /><CodeLine lineNumber="7450"><span class="doxyHighlight">        return false;</span></CodeLine>
<Link id="l07451" /><CodeLine lineNumber="7451"><span class="doxyHighlight">      return !SeenInstrs.contains(&amp;I) &amp;&amp; !CostCtx.skipCostComputation(&amp;I, true);</span></CodeLine>
<Link id="l07452" /><CodeLine lineNumber="7452"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l07453" /><CodeLine lineNumber="7453"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l07454" /><CodeLine lineNumber="7454"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07455" /><CodeLine lineNumber="7455"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l07456" /><CodeLine lineNumber="7456"></CodeLine>
<Link id="l07457" /><CodeLine lineNumber="7457" lineLink="/docs/api/classes/llvm/loopvectorizationplanner/#a4adc69fc8f74164e990cce6afc1e061b"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> <a href="/docs/api/classes/llvm/loopvectorizationplanner/#a4adc69fc8f74164e990cce6afc1e061b">LoopVectorizationPlanner::computeBestVF</a>() &#123;</span></CodeLine>
<Link id="l07458" /><CodeLine lineNumber="7458"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VPlans.empty())</span></CodeLine>
<Link id="l07459" /><CodeLine lineNumber="7459"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vectorizationfactor/#acd24dfdad4f887e1f7b10c9039a05930">VectorizationFactor::Disabled</a>();</span></CodeLine>
<Link id="l07460" /><CodeLine lineNumber="7460"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is a single VPlan with a single VF, return it directly.</span></CodeLine>
<Link id="l07461" /><CodeLine lineNumber="7461"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;FirstPlan = &#42;VPlans&#91;0&#93;;</span></CodeLine>
<Link id="l07462" /><CodeLine lineNumber="7462"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VPlans.size() == 1 &amp;&amp; <a href="/docs/api/namespaces/llvm/#a10f3d955592ae2bc745f57e5b48ae115">size</a>(FirstPlan.<a href="/docs/api/classes/llvm/vplan/#a3aac2593ea2eaac537de30053e8e05fd">vectorFactors</a>()) == 1)</span></CodeLine>
<Link id="l07463" /><CodeLine lineNumber="7463"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#123;&#42;FirstPlan.<a href="/docs/api/classes/llvm/vplan/#a3aac2593ea2eaac537de30053e8e05fd">vectorFactors</a>().begin(), 0, 0&#125;;</span></CodeLine>
<Link id="l07464" /><CodeLine lineNumber="7464"></CodeLine>
<Link id="l07465" /><CodeLine lineNumber="7465"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Computing best VF using cost kind: &quot;</span></CodeLine>
<Link id="l07466" /><CodeLine lineNumber="7466"><span class="doxyHighlight">                    &lt;&lt; (CM.CostKind == <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">TTI::TCK&#95;RecipThroughput</a></span></CodeLine>
<Link id="l07467" /><CodeLine lineNumber="7467"><span class="doxyHighlight">                            ? </span><span class="doxyHighlightStringLiteral">&quot;Reciprocal Throughput\\n&quot;</span></CodeLine>
<Link id="l07468" /><CodeLine lineNumber="7468"><span class="doxyHighlight">                        : CM.CostKind == <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba81b2c6f1f1e13e4a575e6d1c8b29b6e1">TTI::TCK&#95;Latency</a></span></CodeLine>
<Link id="l07469" /><CodeLine lineNumber="7469"><span class="doxyHighlight">                            ? </span><span class="doxyHighlightStringLiteral">&quot;Instruction Latency\\n&quot;</span></CodeLine>
<Link id="l07470" /><CodeLine lineNumber="7470"><span class="doxyHighlight">                        : CM.CostKind == <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TTI::TCK&#95;CodeSize</a> ? </span><span class="doxyHighlightStringLiteral">&quot;Code Size\\n&quot;</span></CodeLine>
<Link id="l07471" /><CodeLine lineNumber="7471"><span class="doxyHighlight">                        : CM.CostKind == <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TTI::TCK&#95;SizeAndLatency</a></span></CodeLine>
<Link id="l07472" /><CodeLine lineNumber="7472"><span class="doxyHighlight">                            ? </span><span class="doxyHighlightStringLiteral">&quot;Code Size and Latency\\n&quot;</span></CodeLine>
<Link id="l07473" /><CodeLine lineNumber="7473"><span class="doxyHighlight">                            : </span><span class="doxyHighlightStringLiteral">&quot;Unknown\\n&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l07474" /><CodeLine lineNumber="7474"></CodeLine>
<Link id="l07475" /><CodeLine lineNumber="7475"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> ScalarVF = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1);</span></CodeLine>
<Link id="l07476" /><CodeLine lineNumber="7476"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/loopvectorizationplanner/#adce80172b05bc0a227fbd5e3d7bb80f2">hasPlanWithVF</a>(ScalarVF) &amp;&amp;</span></CodeLine>
<Link id="l07477" /><CodeLine lineNumber="7477"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;More than a single plan/VF w/o any plan having scalar VF&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07478" /><CodeLine lineNumber="7478"></CodeLine>
<Link id="l07479" /><CodeLine lineNumber="7479"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Compute scalar cost using VPlan-based cost model.</span></CodeLine>
<Link id="l07480" /><CodeLine lineNumber="7480"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarCost = CM.expectedCost(ScalarVF);</span></CodeLine>
<Link id="l07481" /><CodeLine lineNumber="7481"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Scalar loop costs: &quot;</span><span class="doxyHighlight"> &lt;&lt; ScalarCost &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07482" /><CodeLine lineNumber="7482"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> ScalarFactor(ScalarVF, ScalarCost, ScalarCost);</span></CodeLine>
<Link id="l07483" /><CodeLine lineNumber="7483"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> BestFactor = ScalarFactor;</span></CodeLine>
<Link id="l07484" /><CodeLine lineNumber="7484"></CodeLine>
<Link id="l07485" /><CodeLine lineNumber="7485"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ForceVectorization = Hints.getForce() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a>;</span></CodeLine>
<Link id="l07486" /><CodeLine lineNumber="7486"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ForceVectorization) &#123;</span></CodeLine>
<Link id="l07487" /><CodeLine lineNumber="7487"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Ignore scalar width, because the user explicitly wants vectorization.</span></CodeLine>
<Link id="l07488" /><CodeLine lineNumber="7488"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Initialize cost to max so that VF = 2 is, at least, chosen during cost</span></CodeLine>
<Link id="l07489" /><CodeLine lineNumber="7489"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// evaluation.</span></CodeLine>
<Link id="l07490" /><CodeLine lineNumber="7490"><span class="doxyHighlight">    BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a048d568675a5cc69c3fb85206882316d">Cost</a> = <a href="/docs/api/classes/llvm/instructioncost/#a6de26b938774385a0a4fb0d0b2a32d48">InstructionCost::getMax</a>();</span></CodeLine>
<Link id="l07491" /><CodeLine lineNumber="7491"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07492" /><CodeLine lineNumber="7492"></CodeLine>
<Link id="l07493" /><CodeLine lineNumber="7493"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : VPlans) &#123;</span></CodeLine>
<Link id="l07494" /><CodeLine lineNumber="7494"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;vectorFactors()) &#123;</span></CodeLine>
<Link id="l07495" /><CodeLine lineNumber="7495"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</span></CodeLine>
<Link id="l07496" /><CodeLine lineNumber="7496"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07497" /><CodeLine lineNumber="7497"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ForceVectorization &amp;&amp; !<a href="#af378bb1e037306d9cfd4bb0b49ba55f9">willGenerateVectors</a>(&#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, VF, TTI)) &#123;</span></CodeLine>
<Link id="l07498" /><CodeLine lineNumber="7498"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l07499" /><CodeLine lineNumber="7499"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l07500" /><CodeLine lineNumber="7500"><span class="doxyHighlight">            &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Not considering vector loop of width &quot;</span><span class="doxyHighlight"> &lt;&lt; VF</span></CodeLine>
<Link id="l07501" /><CodeLine lineNumber="7501"><span class="doxyHighlight">            &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; because it will not generate any vector instructions.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07502" /><CodeLine lineNumber="7502"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07503" /><CodeLine lineNumber="7503"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07504" /><CodeLine lineNumber="7504"></CodeLine>
<Link id="l07505" /><CodeLine lineNumber="7505"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = cost(&#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, VF);</span></CodeLine>
<Link id="l07506" /><CodeLine lineNumber="7506"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> CurrentFactor(VF, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>, ScalarCost);</span></CodeLine>
<Link id="l07507" /><CodeLine lineNumber="7507"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isMoreProfitable(CurrentFactor, BestFactor))</span></CodeLine>
<Link id="l07508" /><CodeLine lineNumber="7508"><span class="doxyHighlight">        BestFactor = CurrentFactor;</span></CodeLine>
<Link id="l07509" /><CodeLine lineNumber="7509"></CodeLine>
<Link id="l07510" /><CodeLine lineNumber="7510"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If profitable add it to ProfitableVF list.</span></CodeLine>
<Link id="l07511" /><CodeLine lineNumber="7511"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (isMoreProfitable(CurrentFactor, ScalarFactor))</span></CodeLine>
<Link id="l07512" /><CodeLine lineNumber="7512"><span class="doxyHighlight">        ProfitableVFs.push&#95;back(CurrentFactor);</span></CodeLine>
<Link id="l07513" /><CodeLine lineNumber="7513"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07514" /><CodeLine lineNumber="7514"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07515" /><CodeLine lineNumber="7515"></CodeLine>
<Link id="l07516" /><CodeLine lineNumber="7516"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l07517" /><CodeLine lineNumber="7517"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Select the optimal vectorization factor according to the legacy cost-model.</span></CodeLine>
<Link id="l07518" /><CodeLine lineNumber="7518"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is now only used to verify the decisions by the new VPlan-based</span></CodeLine>
<Link id="l07519" /><CodeLine lineNumber="7519"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cost-model and will be retired once the VPlan-based cost-model is</span></CodeLine>
<Link id="l07520" /><CodeLine lineNumber="7520"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// stabilized.</span></CodeLine>
<Link id="l07521" /><CodeLine lineNumber="7521"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> LegacyVF = selectVectorizationFactor();</span></CodeLine>
<Link id="l07522" /><CodeLine lineNumber="7522"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;BestPlan = <a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>);</span></CodeLine>
<Link id="l07523" /><CodeLine lineNumber="7523"></CodeLine>
<Link id="l07524" /><CodeLine lineNumber="7524"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Pre-compute the cost and use it to check if BestPlan contains any</span></CodeLine>
<Link id="l07525" /><CodeLine lineNumber="7525"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// simplifications not accounted for in the legacy cost model. If that&#39;s the</span></CodeLine>
<Link id="l07526" /><CodeLine lineNumber="7526"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// case, don&#39;t trigger the assertion, as the extra simplifications may cause a</span></CodeLine>
<Link id="l07527" /><CodeLine lineNumber="7527"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// different VF to be picked by the VPlan-based cost model.</span></CodeLine>
<Link id="l07528" /><CodeLine lineNumber="7528"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vpcostcontext">VPCostContext</a> CostCtx(CM.TTI, &#42;CM.TLI, Legal-&gt;getWidestInductionType(), CM,</span></CodeLine>
<Link id="l07529" /><CodeLine lineNumber="7529"><span class="doxyHighlight">                        CM.CostKind);</span></CodeLine>
<Link id="l07530" /><CodeLine lineNumber="7530"><span class="doxyHighlight">  precomputeCosts(BestPlan, BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, CostCtx);</span></CodeLine>
<Link id="l07531" /><CodeLine lineNumber="7531"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a> == LegacyVF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a> ||</span></CodeLine>
<Link id="l07532" /><CodeLine lineNumber="7532"><span class="doxyHighlight">          <a href="#a696283c30308704d020a9d86065aa3ae">planContainsAdditionalSimplifications</a>(<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>),</span></CodeLine>
<Link id="l07533" /><CodeLine lineNumber="7533"><span class="doxyHighlight">                                                CostCtx, OrigLoop) ||</span></CodeLine>
<Link id="l07534" /><CodeLine lineNumber="7534"><span class="doxyHighlight">          <a href="#a696283c30308704d020a9d86065aa3ae">planContainsAdditionalSimplifications</a>(<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(LegacyVF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>),</span></CodeLine>
<Link id="l07535" /><CodeLine lineNumber="7535"><span class="doxyHighlight">                                                CostCtx, OrigLoop)) &amp;&amp;</span></CodeLine>
<Link id="l07536" /><CodeLine lineNumber="7536"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot; VPlan cost model and legacy cost model disagreed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07537" /><CodeLine lineNumber="7537"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a76f716c04dfa813b98e1c112bc642d34">ScalarCost</a> &gt; 0) &amp;&amp;</span></CodeLine>
<Link id="l07538" /><CodeLine lineNumber="7538"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;when vectorizing, the scalar cost must be computed.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07539" /><CodeLine lineNumber="7539"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l07540" /><CodeLine lineNumber="7540"></CodeLine>
<Link id="l07541" /><CodeLine lineNumber="7541"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Selecting VF: &quot;</span><span class="doxyHighlight"> &lt;&lt; BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07542" /><CodeLine lineNumber="7542"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BestFactor;</span></CodeLine>
<Link id="l07543" /><CodeLine lineNumber="7543"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07544" /><CodeLine lineNumber="7544"></CodeLine>
<Link id="l07545" /><CodeLine lineNumber="7545" lineLink="#a033bb363914fbd3c2cd990330959036c"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a033bb363914fbd3c2cd990330959036c">addRuntimeUnrollDisableMetaData</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123;</span></CodeLine>
<Link id="l07546" /><CodeLine lineNumber="7546"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Metadata &#42;, 4&gt;</a> MDs;</span></CodeLine>
<Link id="l07547" /><CodeLine lineNumber="7547"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reserve first location for self reference to the LoopID metadata node.</span></CodeLine>
<Link id="l07548" /><CodeLine lineNumber="7548"><span class="doxyHighlight">  MDs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07549" /><CodeLine lineNumber="7549"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsUnrollMetadata = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07550" /><CodeLine lineNumber="7550"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;LoopID = L-&gt;getLoopID();</span></CodeLine>
<Link id="l07551" /><CodeLine lineNumber="7551"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoopID) &#123;</span></CodeLine>
<Link id="l07552" /><CodeLine lineNumber="7552"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// First find existing loop unrolling disable metadata.</span></CodeLine>
<Link id="l07553" /><CodeLine lineNumber="7553"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 1, IE = LoopID-&gt;<a href="/docs/api/classes/llvm/mdnode/#aa4068e37ec583962685e3567dc102ae5">getNumOperands</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; IE; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l07554" /><CodeLine lineNumber="7554"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MD = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MDNode&gt;</a>(LoopID-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l07555" /><CodeLine lineNumber="7555"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MD) &#123;</span></CodeLine>
<Link id="l07556" /><CodeLine lineNumber="7556"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;S = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MDString&gt;</a>(MD-&gt;getOperand(0));</span></CodeLine>
<Link id="l07557" /><CodeLine lineNumber="7557"><span class="doxyHighlight">        IsUnrollMetadata =</span></CodeLine>
<Link id="l07558" /><CodeLine lineNumber="7558"><span class="doxyHighlight">            S &amp;&amp; S-&gt;getString().starts&#95;with(</span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.unroll.disable&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07559" /><CodeLine lineNumber="7559"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l07560" /><CodeLine lineNumber="7560"><span class="doxyHighlight">      MDs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(LoopID-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</span></CodeLine>
<Link id="l07561" /><CodeLine lineNumber="7561"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07562" /><CodeLine lineNumber="7562"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07563" /><CodeLine lineNumber="7563"></CodeLine>
<Link id="l07564" /><CodeLine lineNumber="7564"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsUnrollMetadata) &#123;</span></CodeLine>
<Link id="l07565" /><CodeLine lineNumber="7565"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Add runtime unroll disable metadata.</span></CodeLine>
<Link id="l07566" /><CodeLine lineNumber="7566"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Context = L-&gt;getHeader()-&gt;getContext();</span></CodeLine>
<Link id="l07567" /><CodeLine lineNumber="7567"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Metadata &#42;, 1&gt;</a> DisableOperands;</span></CodeLine>
<Link id="l07568" /><CodeLine lineNumber="7568"><span class="doxyHighlight">    DisableOperands.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</span></CodeLine>
<Link id="l07569" /><CodeLine lineNumber="7569"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Context, </span><span class="doxyHighlightStringLiteral">&quot;llvm.loop.unroll.runtime.disable&quot;</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l07570" /><CodeLine lineNumber="7570"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;DisableNode = <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Context, DisableOperands);</span></CodeLine>
<Link id="l07571" /><CodeLine lineNumber="7571"><span class="doxyHighlight">    MDs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(DisableNode);</span></CodeLine>
<Link id="l07572" /><CodeLine lineNumber="7572"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;NewLoopID = <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Context, MDs);</span></CodeLine>
<Link id="l07573" /><CodeLine lineNumber="7573"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Set operand 0 to refer to the loop id itself.</span></CodeLine>
<Link id="l07574" /><CodeLine lineNumber="7574"><span class="doxyHighlight">    NewLoopID-&gt;<a href="/docs/api/classes/llvm/mdnode/#a160e9e1a4fd597f83034c8b2ba316984">replaceOperandWith</a>(0, NewLoopID);</span></CodeLine>
<Link id="l07575" /><CodeLine lineNumber="7575"><span class="doxyHighlight">    L-&gt;setLoopID(NewLoopID);</span></CodeLine>
<Link id="l07576" /><CodeLine lineNumber="7576"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07577" /><CodeLine lineNumber="7577"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07578" /><CodeLine lineNumber="7578"></CodeLine>
<Link id="l07579" /><CodeLine lineNumber="7579"><span class="doxyHighlightComment">// If \\p R is a ComputeReductionResult when vectorizing the epilog loop,</span></CodeLine>
<Link id="l07580" /><CodeLine lineNumber="7580"><span class="doxyHighlightComment">// fix the reduction&#39;s scalar PHI node by adding the incoming value from the</span></CodeLine>
<Link id="l07581" /><CodeLine lineNumber="7581"><span class="doxyHighlightComment">// main vector loop.</span></CodeLine>
<Link id="l07582" /><CodeLine lineNumber="7582" lineLink="#a90ad8ccd396152c749068f986f2b751a"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a90ad8ccd396152c749068f986f2b751a">fixReductionScalarResumeWhenVectorizingEpilog</a>(</span></CodeLine>
<Link id="l07583" /><CodeLine lineNumber="7583"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;R, <a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopMiddleBlock,</span></CodeLine>
<Link id="l07584" /><CodeLine lineNumber="7584"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BypassBlock) &#123;</span></CodeLine>
<Link id="l07585" /><CodeLine lineNumber="7585"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EpiRedResult = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPInstruction&gt;</a>(R);</span></CodeLine>
<Link id="l07586" /><CodeLine lineNumber="7586"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!EpiRedResult ||</span></CodeLine>
<Link id="l07587" /><CodeLine lineNumber="7587"><span class="doxyHighlight">      EpiRedResult-&gt;getOpcode() != <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2ad9b4011dc2ac58da0fecd16d99f1f17d">VPInstruction::ComputeReductionResult</a>)</span></CodeLine>
<Link id="l07588" /><CodeLine lineNumber="7588"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07589" /><CodeLine lineNumber="7589"></CodeLine>
<Link id="l07590" /><CodeLine lineNumber="7590"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EpiRedHeaderPhi =</span></CodeLine>
<Link id="l07591" /><CodeLine lineNumber="7591"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPReductionPHIRecipe&gt;</a>(EpiRedResult-&gt;getOperand(0));</span></CodeLine>
<Link id="l07592" /><CodeLine lineNumber="7592"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc =</span></CodeLine>
<Link id="l07593" /><CodeLine lineNumber="7593"><span class="doxyHighlight">      EpiRedHeaderPhi-&gt;getRecurrenceDescriptor();</span></CodeLine>
<Link id="l07594" /><CodeLine lineNumber="7594"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;MainResumeValue =</span></CodeLine>
<Link id="l07595" /><CodeLine lineNumber="7595"><span class="doxyHighlight">      EpiRedHeaderPhi-&gt;getStartValue()-&gt;getUnderlyingValue();</span></CodeLine>
<Link id="l07596" /><CodeLine lineNumber="7596"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a69df67c7d92481ae63a5d8017e96c716">RecurrenceDescriptor::isAnyOfRecurrenceKind</a>(</span></CodeLine>
<Link id="l07597" /><CodeLine lineNumber="7597"><span class="doxyHighlight">          RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>())) &#123;</span></CodeLine>
<Link id="l07598" /><CodeLine lineNumber="7598"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(MainResumeValue);</span></CodeLine>
<Link id="l07599" /><CodeLine lineNumber="7599"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Cmp-&gt;getPredicate() == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">CmpInst::ICMP&#95;NE</a> &amp;&amp;</span></CodeLine>
<Link id="l07600" /><CodeLine lineNumber="7600"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;AnyOf expected to start with ICMP&#95;NE&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07601" /><CodeLine lineNumber="7601"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Cmp-&gt;getOperand(1) == RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a61351428b7eb226cbad866ccf2382817">getRecurrenceStartValue</a>() &amp;&amp;</span></CodeLine>
<Link id="l07602" /><CodeLine lineNumber="7602"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;AnyOf expected to start by comparing main resume value to original &quot;</span></CodeLine>
<Link id="l07603" /><CodeLine lineNumber="7603"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;start value&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07604" /><CodeLine lineNumber="7604"><span class="doxyHighlight">    MainResumeValue = Cmp-&gt;getOperand(0);</span></CodeLine>
<Link id="l07605" /><CodeLine lineNumber="7605"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a7bc46d4489f4d6cb4a4e486ce5f6184b">RecurrenceDescriptor::isFindLastIVRecurrenceKind</a>(</span></CodeLine>
<Link id="l07606" /><CodeLine lineNumber="7606"><span class="doxyHighlight">                 RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>())) &#123;</span></CodeLine>
<Link id="l07607" /><CodeLine lineNumber="7607"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</span></CodeLine>
<Link id="l07608" /><CodeLine lineNumber="7608"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Cmp, &#42;OrigResumeV;</span></CodeLine>
<Link id="l07609" /><CodeLine lineNumber="7609"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsExpectedPattern =</span></CodeLine>
<Link id="l07610" /><CodeLine lineNumber="7610"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(MainResumeValue, <a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Cmp)),</span></CodeLine>
<Link id="l07611" /><CodeLine lineNumber="7611"><span class="doxyHighlight">                                        <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#aed10715d943d3e1b4ca75b585ea96ab8">getSentinelValue</a>()),</span></CodeLine>
<Link id="l07612" /><CodeLine lineNumber="7612"><span class="doxyHighlight">                                        <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(OrigResumeV))) &amp;&amp;</span></CodeLine>
<Link id="l07613" /><CodeLine lineNumber="7613"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Cmp,</span></CodeLine>
<Link id="l07614" /><CodeLine lineNumber="7614"><span class="doxyHighlight">              <a href="/docs/api/namespaces/llvm/patternmatch/#a6924ab881778c340b66e1e693154b1a8">m&#95;SpecificICmp</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(OrigResumeV),</span></CodeLine>
<Link id="l07615" /><CodeLine lineNumber="7615"><span class="doxyHighlight">                             <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a61351428b7eb226cbad866ccf2382817">getRecurrenceStartValue</a>())));</span></CodeLine>
<Link id="l07616" /><CodeLine lineNumber="7616"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IsExpectedPattern &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected reduction resume pattern&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07617" /><CodeLine lineNumber="7617"><span class="doxyHighlight">    (void)IsExpectedPattern;</span></CodeLine>
<Link id="l07618" /><CodeLine lineNumber="7618"><span class="doxyHighlight">    MainResumeValue = OrigResumeV;</span></CodeLine>
<Link id="l07619" /><CodeLine lineNumber="7619"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07620" /><CodeLine lineNumber="7620"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;MainResumePhi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(MainResumeValue);</span></CodeLine>
<Link id="l07621" /><CodeLine lineNumber="7621"></CodeLine>
<Link id="l07622" /><CodeLine lineNumber="7622"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// When fixing reductions in the epilogue loop we should already have</span></CodeLine>
<Link id="l07623" /><CodeLine lineNumber="7623"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// created a bc.merge.rdx Phi after the main vector body. Ensure that we carry</span></CodeLine>
<Link id="l07624" /><CodeLine lineNumber="7624"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// over the incoming values correctly.</span></CodeLine>
<Link id="l07625" /><CodeLine lineNumber="7625"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">VPlanPatternMatch</a>;</span></CodeLine>
<Link id="l07626" /><CodeLine lineNumber="7626"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsResumePhi = &#91;&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123;</span></CodeLine>
<Link id="l07627" /><CodeLine lineNumber="7627"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(</span></CodeLine>
<Link id="l07628" /><CodeLine lineNumber="7628"><span class="doxyHighlight">        U, m&#95;VPInstruction&lt;VPInstruction::ResumePhi&gt;(m&#95;VPValue(), m&#95;VPValue()));</span></CodeLine>
<Link id="l07629" /><CodeLine lineNumber="7629"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l07630" /><CodeLine lineNumber="7630"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac214df91cdc242f4710ea5a93939c678">count&#95;if</a>(EpiRedResult-&gt;users(), IsResumePhi) == 1 &amp;&amp;</span></CodeLine>
<Link id="l07631" /><CodeLine lineNumber="7631"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;ResumePhi must have a single user&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07632" /><CodeLine lineNumber="7632"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EpiResumePhiVPI =</span></CodeLine>
<Link id="l07633" /><CodeLine lineNumber="7633"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPInstruction&gt;</a>(&#42;<a href="/docs/api/namespaces/llvm/#ac78c09ae232b2ce188ff590d51e3c268">find&#95;if</a>(EpiRedResult-&gt;users(), IsResumePhi));</span></CodeLine>
<Link id="l07634" /><CodeLine lineNumber="7634"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;EpiResumePhi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(State.get(EpiResumePhiVPI, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l07635" /><CodeLine lineNumber="7635"><span class="doxyHighlight">  EpiResumePhi-&gt;setIncomingValueForBlock(</span></CodeLine>
<Link id="l07636" /><CodeLine lineNumber="7636"><span class="doxyHighlight">      BypassBlock, MainResumePhi-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(BypassBlock));</span></CodeLine>
<Link id="l07637" /><CodeLine lineNumber="7637"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07638" /><CodeLine lineNumber="7638"></CodeLine>
<Link id="l07639" /><CodeLine lineNumber="7639" lineLink="/docs/api/classes/llvm/loopvectorizationplanner/#acbe2feb9e960936a43c845a1fa8eaba4"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const SCEV &#42;, Value &#42;&gt;</a> <a href="/docs/api/classes/llvm/loopvectorizationplanner/#acbe2feb9e960936a43c845a1fa8eaba4">LoopVectorizationPlanner::executePlan</a>(</span></CodeLine>
<Link id="l07640" /><CodeLine lineNumber="7640"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> BestVF, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BestUF, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;BestVPlan,</span></CodeLine>
<Link id="l07641" /><CodeLine lineNumber="7641"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopvectorizer">InnerLoopVectorizer</a> &amp;ILV, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> VectorizingEpilogue,</span></CodeLine>
<Link id="l07642" /><CodeLine lineNumber="7642"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const SCEV &#42;, Value &#42;&gt;</a> &#42;ExpandedSCEVs) &#123;</span></CodeLine>
<Link id="l07643" /><CodeLine lineNumber="7643"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a633dd97e642c10e8aa1dff2bd2874edb">hasVF</a>(BestVF) &amp;&amp;</span></CodeLine>
<Link id="l07644" /><CodeLine lineNumber="7644"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Trying to execute plan with unsupported VF&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07645" /><CodeLine lineNumber="7645"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a6e9c2a69cd9bc0e46626f5302a03d3da">hasUF</a>(BestUF) &amp;&amp;</span></CodeLine>
<Link id="l07646" /><CodeLine lineNumber="7646"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Trying to execute plan with unsupported UF&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07647" /><CodeLine lineNumber="7647"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l07648" /><CodeLine lineNumber="7648"><span class="doxyHighlight">      ((VectorizingEpilogue &amp;&amp; ExpandedSCEVs) ||</span></CodeLine>
<Link id="l07649" /><CodeLine lineNumber="7649"><span class="doxyHighlight">       (!VectorizingEpilogue &amp;&amp; !ExpandedSCEVs)) &amp;&amp;</span></CodeLine>
<Link id="l07650" /><CodeLine lineNumber="7650"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;expanded SCEVs to reuse can only be used during epilogue vectorization&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07651" /><CodeLine lineNumber="7651"></CodeLine>
<Link id="l07652" /><CodeLine lineNumber="7652"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Move to VPlan transform stage once the transition to the VPlan-based</span></CodeLine>
<Link id="l07653" /><CodeLine lineNumber="7653"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cost model is complete for better cost estimates.</span></CodeLine>
<Link id="l07654" /><CodeLine lineNumber="7654"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vplantransforms/#a7a1cca51bb9bce4efad1063dcf158967">VPlanTransforms::unrollByUF</a>(BestVPlan, BestUF,</span></CodeLine>
<Link id="l07655" /><CodeLine lineNumber="7655"><span class="doxyHighlight">                              OrigLoop-&gt;getHeader()-&gt;getContext());</span></CodeLine>
<Link id="l07656" /><CodeLine lineNumber="7656"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vplantransforms/#af25d938764b8634e70e95ff3f0c35129">VPlanTransforms::optimizeForVFAndUF</a>(BestVPlan, BestVF, BestUF, PSE);</span></CodeLine>
<Link id="l07657" /><CodeLine lineNumber="7657"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vplantransforms/#a63e564d621011fac5978d18138121e5c">VPlanTransforms::convertToConcreteRecipes</a>(BestVPlan);</span></CodeLine>
<Link id="l07658" /><CodeLine lineNumber="7658"></CodeLine>
<Link id="l07659" /><CodeLine lineNumber="7659"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Perform the actual loop transformation.</span></CodeLine>
<Link id="l07660" /><CodeLine lineNumber="7660"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> State(&amp;TTI, BestVF, BestUF, LI, DT, ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>, &amp;ILV,</span></CodeLine>
<Link id="l07661" /><CodeLine lineNumber="7661"><span class="doxyHighlight">                         &amp;BestVPlan, OrigLoop-&gt;getParentLoop(),</span></CodeLine>
<Link id="l07662" /><CodeLine lineNumber="7662"><span class="doxyHighlight">                         Legal-&gt;getWidestInductionType());</span></CodeLine>
<Link id="l07663" /><CodeLine lineNumber="7663"></CodeLine>
<Link id="l07664" /><CodeLine lineNumber="7664"><span class="doxyHighlightPreprocessor">#ifdef EXPENSIVE&#95;CHECKS</span></CodeLine>
<Link id="l07665" /><CodeLine lineNumber="7665"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT-&gt;verify(DominatorTree::VerificationLevel::Fast));</span></CodeLine>
<Link id="l07666" /><CodeLine lineNumber="7666"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l07667" /><CodeLine lineNumber="7667"></CodeLine>
<Link id="l07668" /><CodeLine lineNumber="7668"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 0 Generate SCEV-dependent code in the entry, including TripCount, before</span></CodeLine>
<Link id="l07669" /><CodeLine lineNumber="7669"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// making any changes to the CFG.</span></CodeLine>
<Link id="l07670" /><CodeLine lineNumber="7670"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#aeb3dd295f833ecc508d7586df94a76f3">empty</a>())</span></CodeLine>
<Link id="l07671" /><CodeLine lineNumber="7671"><span class="doxyHighlight">    BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a305d2f13922c7da4206b299861370a80">execute</a>(&amp;State);</span></CodeLine>
<Link id="l07672" /><CodeLine lineNumber="7672"></CodeLine>
<Link id="l07673" /><CodeLine lineNumber="7673"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696">getTripCount</a>())</span></CodeLine>
<Link id="l07674" /><CodeLine lineNumber="7674"><span class="doxyHighlight">    ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a9160ed9f749a9c4df711061181288e13">setTripCount</a>(State.get(BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a2f5fc19caa67daeca8a1316c7e055e3c">getTripCount</a>(), <a href="/docs/api/classes/llvm/vplane">VPLane</a>(0)));</span></CodeLine>
<Link id="l07675" /><CodeLine lineNumber="7675"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l07676" /><CodeLine lineNumber="7676"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VectorizingEpilogue &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;should only re-use the existing trip &quot;</span></CodeLine>
<Link id="l07677" /><CodeLine lineNumber="7677"><span class="doxyHighlight">                                  </span><span class="doxyHighlightStringLiteral">&quot;count during epilogue vectorization&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07678" /><CodeLine lineNumber="7678"></CodeLine>
<Link id="l07679" /><CodeLine lineNumber="7679"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1 Set up the skeleton for vectorization, including vector pre-header and</span></CodeLine>
<Link id="l07680" /><CodeLine lineNumber="7680"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// middle block. The vector loop is created during VPlan execution.</span></CodeLine>
<Link id="l07681" /><CodeLine lineNumber="7681"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VectorPH =</span></CodeLine>
<Link id="l07682" /><CodeLine lineNumber="7682"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>());</span></CodeLine>
<Link id="l07683" /><CodeLine lineNumber="7683"><span class="doxyHighlight">  State.CFG.PrevBB = ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a31f933a6eada9926c9e320db27dfb775">createVectorizedLoopSkeleton</a>(</span></CodeLine>
<Link id="l07684" /><CodeLine lineNumber="7684"><span class="doxyHighlight">      ExpandedSCEVs ? &#42;ExpandedSCEVs : State.ExpandedSCEVs);</span></CodeLine>
<Link id="l07685" /><CodeLine lineNumber="7685"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VectorizingEpilogue)</span></CodeLine>
<Link id="l07686" /><CodeLine lineNumber="7686"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/vplantransforms/#aaca9dd97d4c523d8c65274654abe4eb9">VPlanTransforms::removeDeadRecipes</a>(BestVPlan);</span></CodeLine>
<Link id="l07687" /><CodeLine lineNumber="7687"></CodeLine>
<Link id="l07688" /><CodeLine lineNumber="7688"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Only use noalias metadata when using memory checks guaranteeing no overlap</span></CodeLine>
<Link id="l07689" /><CodeLine lineNumber="7689"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// across all iterations.</span></CodeLine>
<Link id="l07690" /><CodeLine lineNumber="7690"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopaccessinfo">LoopAccessInfo</a> &#42;LAI = ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a6bb946cd99f8c37f0145265914aea778">Legal</a>-&gt;<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab5632546144c4db5bbe1f975aeebd9d2">getLAI</a>();</span></CodeLine>
<Link id="l07691" /><CodeLine lineNumber="7691"><span class="doxyHighlight">  std::unique&#95;ptr&lt;LoopVersioning&gt; LVer = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07692" /><CodeLine lineNumber="7692"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LAI &amp;&amp; !LAI-&gt;<a href="/docs/api/classes/llvm/loopaccessinfo/#a3aedf5694dc5b1e81a79658b126a9b43">getRuntimePointerChecking</a>()-&gt;<a href="/docs/api/classes/llvm/runtimepointerchecking/#ac837a7d2828c8fe9e84140095d003d51">getChecks</a>().<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp;</span></CodeLine>
<Link id="l07693" /><CodeLine lineNumber="7693"><span class="doxyHighlight">      !LAI-&gt;<a href="/docs/api/classes/llvm/loopaccessinfo/#a3aedf5694dc5b1e81a79658b126a9b43">getRuntimePointerChecking</a>()-&gt;<a href="/docs/api/classes/llvm/runtimepointerchecking/#a741849368bb652fdaba99d70c36b527f">getDiffChecks</a>()) &#123;</span></CodeLine>
<Link id="l07694" /><CodeLine lineNumber="7694"></CodeLine>
<Link id="l07695" /><CodeLine lineNumber="7695"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  We currently don&#39;t use LoopVersioning for the actual loop cloning but we</span></CodeLine>
<Link id="l07696" /><CodeLine lineNumber="7696"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  still use it to add the noalias metadata.</span></CodeLine>
<Link id="l07697" /><CodeLine lineNumber="7697"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  TODO: Find a better way to re-use LoopVersioning functionality to add</span></CodeLine>
<Link id="l07698" /><CodeLine lineNumber="7698"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//        metadata.</span></CodeLine>
<Link id="l07699" /><CodeLine lineNumber="7699"><span class="doxyHighlight">    LVer = std::make&#95;unique&lt;LoopVersioning&gt;(</span></CodeLine>
<Link id="l07700" /><CodeLine lineNumber="7700"><span class="doxyHighlight">        &#42;LAI, LAI-&gt;<a href="/docs/api/classes/llvm/loopaccessinfo/#a3aedf5694dc5b1e81a79658b126a9b43">getRuntimePointerChecking</a>()-&gt;<a href="/docs/api/classes/llvm/runtimepointerchecking/#ac837a7d2828c8fe9e84140095d003d51">getChecks</a>(), OrigLoop, LI, DT,</span></CodeLine>
<Link id="l07701" /><CodeLine lineNumber="7701"><span class="doxyHighlight">        PSE.getSE());</span></CodeLine>
<Link id="l07702" /><CodeLine lineNumber="7702"><span class="doxyHighlight">    State.LVer = &amp;&#42;LVer;</span></CodeLine>
<Link id="l07703" /><CodeLine lineNumber="7703"><span class="doxyHighlight">    State.LVer-&gt;prepareNoAliasMetadata();</span></CodeLine>
<Link id="l07704" /><CodeLine lineNumber="7704"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07705" /><CodeLine lineNumber="7705"></CodeLine>
<Link id="l07706" /><CodeLine lineNumber="7706"><span class="doxyHighlight">  ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a00579d597c88e5f3c51754bcd9ec5658">printDebugTracesAtStart</a>();</span></CodeLine>
<Link id="l07707" /><CodeLine lineNumber="7707"></CodeLine>
<Link id="l07708" /><CodeLine lineNumber="7708"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//===------------------------------------------------===//</span></CodeLine>
<Link id="l07709" /><CodeLine lineNumber="7709"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07710" /><CodeLine lineNumber="7710"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Notice: any optimization or new instruction that go</span></CodeLine>
<Link id="l07711" /><CodeLine lineNumber="7711"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// into the code below should also be implemented in</span></CodeLine>
<Link id="l07712" /><CodeLine lineNumber="7712"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the cost-model.</span></CodeLine>
<Link id="l07713" /><CodeLine lineNumber="7713"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l07714" /><CodeLine lineNumber="7714"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//===------------------------------------------------===//</span></CodeLine>
<Link id="l07715" /><CodeLine lineNumber="7715"></CodeLine>
<Link id="l07716" /><CodeLine lineNumber="7716"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2 Copy and widen instructions from the old loop into the new loop.</span></CodeLine>
<Link id="l07717" /><CodeLine lineNumber="7717"><span class="doxyHighlight">  BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a143bc5faeb35f7363570e97bccf76e53">prepareToExecute</a>(</span></CodeLine>
<Link id="l07718" /><CodeLine lineNumber="7718"><span class="doxyHighlight">      ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696">getTripCount</a>(),</span></CodeLine>
<Link id="l07719" /><CodeLine lineNumber="7719"><span class="doxyHighlight">      ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa83b181aa14d5afe1390faad388f91a4">getOrCreateVectorTripCount</a>(ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>), State);</span></CodeLine>
<Link id="l07720" /><CodeLine lineNumber="7720"><span class="doxyHighlight">  <a href="#a3a8743a69fac5e7fa9c2b02604b2cf2f">replaceVPBBWithIRVPBB</a>(VectorPH, State.CFG.PrevBB);</span></CodeLine>
<Link id="l07721" /><CodeLine lineNumber="7721"></CodeLine>
<Link id="l07722" /><CodeLine lineNumber="7722"><span class="doxyHighlight">  BestVPlan.<a href="/docs/api/classes/llvm/vplan/#ad80b94848142a7c633976aff96d4c408">execute</a>(&amp;State);</span></CodeLine>
<Link id="l07723" /><CodeLine lineNumber="7723"></CodeLine>
<Link id="l07724" /><CodeLine lineNumber="7724"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MiddleVPBB = BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>();</span></CodeLine>
<Link id="l07725" /><CodeLine lineNumber="7725"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2.5 When vectorizing the epilogue, fix reduction and induction resume</span></CodeLine>
<Link id="l07726" /><CodeLine lineNumber="7726"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// values from the additional bypass block.</span></CodeLine>
<Link id="l07727" /><CodeLine lineNumber="7727"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VectorizingEpilogue) &#123;</span></CodeLine>
<Link id="l07728" /><CodeLine lineNumber="7728"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a6bb946cd99f8c37f0145265914aea778">Legal</a>-&gt;<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab22ff9e23f7f27234c8f6ec76db0c1f3">hasUncountableEarlyExit</a>() &amp;&amp;</span></CodeLine>
<Link id="l07729" /><CodeLine lineNumber="7729"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Epilogue vectorisation not yet supported with early exits&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07730" /><CodeLine lineNumber="7730"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BypassBlock = ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a8f2e87f456c35fdad0ec24e7c71a92a5">getAdditionalBypassBlock</a>();</span></CodeLine>
<Link id="l07731" /><CodeLine lineNumber="7731"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : &#42;MiddleVPBB) &#123;</span></CodeLine>
<Link id="l07732" /><CodeLine lineNumber="7732"><span class="doxyHighlight">      <a href="#a90ad8ccd396152c749068f986f2b751a">fixReductionScalarResumeWhenVectorizingEpilog</a>(</span></CodeLine>
<Link id="l07733" /><CodeLine lineNumber="7733"><span class="doxyHighlight">          &amp;R, State, State.CFG.VPBB2IRBB&#91;MiddleVPBB&#93;, BypassBlock);</span></CodeLine>
<Link id="l07734" /><CodeLine lineNumber="7734"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07735" /><CodeLine lineNumber="7735"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PH = OrigLoop-&gt;getLoopPreheader();</span></CodeLine>
<Link id="l07736" /><CodeLine lineNumber="7736"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;IVPhi, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>&#93; : Legal-&gt;getInductionVars()) &#123;</span></CodeLine>
<Link id="l07737" /><CodeLine lineNumber="7737"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Inc = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(IVPhi-&gt;getIncomingValueForBlock(PH));</span></CodeLine>
<Link id="l07738" /><CodeLine lineNumber="7738"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a86acbbb5785d46e5a10d2ed34c779dd9">getInductionAdditionalBypassValue</a>(IVPhi);</span></CodeLine>
<Link id="l07739" /><CodeLine lineNumber="7739"><span class="doxyHighlight">      Inc-&gt;setIncomingValueForBlock(BypassBlock, V);</span></CodeLine>
<Link id="l07740" /><CodeLine lineNumber="7740"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07741" /><CodeLine lineNumber="7741"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07742" /><CodeLine lineNumber="7742"></CodeLine>
<Link id="l07743" /><CodeLine lineNumber="7743"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2.6. Maintain Loop Hints</span></CodeLine>
<Link id="l07744" /><CodeLine lineNumber="7744"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Keep all loop hints from the original loop on the vector loop (we&#39;ll</span></CodeLine>
<Link id="l07745" /><CodeLine lineNumber="7745"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// replace the vectorizer-specific hints below).</span></CodeLine>
<Link id="l07746" /><CodeLine lineNumber="7746"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;LoopRegion = BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()) &#123;</span></CodeLine>
<Link id="l07747" /><CodeLine lineNumber="7747"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;OrigLoopID = OrigLoop-&gt;getLoopID();</span></CodeLine>
<Link id="l07748" /><CodeLine lineNumber="7748"></CodeLine>
<Link id="l07749" /><CodeLine lineNumber="7749"><span class="doxyHighlight">    std::optional&lt;MDNode &#42;&gt; VectorizedLoopID =</span></CodeLine>
<Link id="l07750" /><CodeLine lineNumber="7750"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a368216c9c116e3f30d8dd352ce1370fc">makeFollowupLoopID</a>(OrigLoopID, &#123;<a href="#a3bf55ccbbeedcfb8cd2a1bd62c0ad91a">LLVMLoopVectorizeFollowupAll</a>,</span></CodeLine>
<Link id="l07751" /><CodeLine lineNumber="7751"><span class="doxyHighlight">                                        <a href="#a99050b417d193e1cc1117e5bbd4bfbce">LLVMLoopVectorizeFollowupVectorized</a>&#125;);</span></CodeLine>
<Link id="l07752" /><CodeLine lineNumber="7752"></CodeLine>
<Link id="l07753" /><CodeLine lineNumber="7753"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;HeaderVPBB = LoopRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</span></CodeLine>
<Link id="l07754" /><CodeLine lineNumber="7754"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = LI-&gt;getLoopFor(State.CFG.VPBB2IRBB&#91;HeaderVPBB&#93;);</span></CodeLine>
<Link id="l07755" /><CodeLine lineNumber="7755"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VectorizedLoopID) &#123;</span></CodeLine>
<Link id="l07756" /><CodeLine lineNumber="7756"><span class="doxyHighlight">      L-&gt;setLoopID(&#42;VectorizedLoopID);</span></CodeLine>
<Link id="l07757" /><CodeLine lineNumber="7757"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l07758" /><CodeLine lineNumber="7758"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Keep all loop hints from the original loop on the vector loop (we&#39;ll</span></CodeLine>
<Link id="l07759" /><CodeLine lineNumber="7759"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// replace the vectorizer-specific hints below).</span></CodeLine>
<Link id="l07760" /><CodeLine lineNumber="7760"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;LID = OrigLoop-&gt;getLoopID())</span></CodeLine>
<Link id="l07761" /><CodeLine lineNumber="7761"><span class="doxyHighlight">        L-&gt;setLoopID(LID);</span></CodeLine>
<Link id="l07762" /><CodeLine lineNumber="7762"></CodeLine>
<Link id="l07763" /><CodeLine lineNumber="7763"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> Hints(L, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, &#42;ORE);</span></CodeLine>
<Link id="l07764" /><CodeLine lineNumber="7764"><span class="doxyHighlight">      Hints.setAlreadyVectorized();</span></CodeLine>
<Link id="l07765" /><CodeLine lineNumber="7765"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07766" /><CodeLine lineNumber="7766"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences">TargetTransformInfo::UnrollingPreferences</a> UP;</span></CodeLine>
<Link id="l07767" /><CodeLine lineNumber="7767"><span class="doxyHighlight">    TTI.getUnrollingPreferences(L, &#42;PSE.getSE(), UP, ORE);</span></CodeLine>
<Link id="l07768" /><CodeLine lineNumber="7768"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#a5d4cb9fb552657b2138b925b44315d21">UnrollVectorizedLoop</a> || VectorizingEpilogue)</span></CodeLine>
<Link id="l07769" /><CodeLine lineNumber="7769"><span class="doxyHighlight">      <a href="#a033bb363914fbd3c2cd990330959036c">addRuntimeUnrollDisableMetaData</a>(L);</span></CodeLine>
<Link id="l07770" /><CodeLine lineNumber="7770"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07771" /><CodeLine lineNumber="7771"></CodeLine>
<Link id="l07772" /><CodeLine lineNumber="7772"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 3 Fix the vectorized code: take care of header phi&#39;s, live-outs,</span></CodeLine>
<Link id="l07773" /><CodeLine lineNumber="7773"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    predication, updating analyses.</span></CodeLine>
<Link id="l07774" /><CodeLine lineNumber="7774"><span class="doxyHighlight">  ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a9484786140efebf774cde8f072894246">fixVectorizedLoop</a>(State);</span></CodeLine>
<Link id="l07775" /><CodeLine lineNumber="7775"></CodeLine>
<Link id="l07776" /><CodeLine lineNumber="7776"><span class="doxyHighlight">  ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a9e275f16680d4f09dbcc0dd7d323a075">printDebugTracesAtEnd</a>();</span></CodeLine>
<Link id="l07777" /><CodeLine lineNumber="7777"></CodeLine>
<Link id="l07778" /><CodeLine lineNumber="7778"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 4 Adjust branch weight of the branch in the middle block.</span></CodeLine>
<Link id="l07779" /><CodeLine lineNumber="7779"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()) &#123;</span></CodeLine>
<Link id="l07780" /><CodeLine lineNumber="7780"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MiddleVPBB = BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>();</span></CodeLine>
<Link id="l07781" /><CodeLine lineNumber="7781"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MiddleTerm =</span></CodeLine>
<Link id="l07782" /><CodeLine lineNumber="7782"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(State.CFG.VPBB2IRBB&#91;MiddleVPBB&#93;-&gt;getTerminator());</span></CodeLine>
<Link id="l07783" /><CodeLine lineNumber="7783"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MiddleTerm-&gt;isConditional() &amp;&amp;</span></CodeLine>
<Link id="l07784" /><CodeLine lineNumber="7784"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;OrigLoop-&gt;getLoopLatch()-&gt;getTerminator())) &#123;</span></CodeLine>
<Link id="l07785" /><CodeLine lineNumber="7785"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Assume that &#96;Count % VectorTripCount&#96; is equally distributed.</span></CodeLine>
<Link id="l07786" /><CodeLine lineNumber="7786"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TripCount = BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a532045d23e6f3efd21732fd342f99f09">getUF</a>() &#42; State.VF.getKnownMinValue();</span></CodeLine>
<Link id="l07787" /><CodeLine lineNumber="7787"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TripCount &gt; 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;trip count should not be zero&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07788" /><CodeLine lineNumber="7788"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint32&#95;t Weights&#91;&#93; = &#123;1, TripCount - 1&#125;;</span></CodeLine>
<Link id="l07789" /><CodeLine lineNumber="7789"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(&#42;MiddleTerm, Weights, </span><span class="doxyHighlightComment">/&#42;IsExpected=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07790" /><CodeLine lineNumber="7790"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l07791" /><CodeLine lineNumber="7791"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07792" /><CodeLine lineNumber="7792"></CodeLine>
<Link id="l07793" /><CodeLine lineNumber="7793"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> State.ExpandedSCEVs;</span></CodeLine>
<Link id="l07794" /><CodeLine lineNumber="7794"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07795" /><CodeLine lineNumber="7795"></CodeLine>
<Link id="l07796" /><CodeLine lineNumber="7796"><span class="doxyHighlightComment">//===--------------------------------------------------------------------===//</span></CodeLine>
<Link id="l07797" /><CodeLine lineNumber="7797"><span class="doxyHighlightComment">// EpilogueVectorizerMainLoop</span></CodeLine>
<Link id="l07798" /><CodeLine lineNumber="7798"><span class="doxyHighlightComment">//===--------------------------------------------------------------------===//</span></CodeLine>
<Link id="l07799" /><CodeLine lineNumber="7799"></CodeLine>
<Link id="l07800" /><CodeLine lineNumber="7800"><span class="doxyHighlightComment">/// This function is partially responsible for generating the control flow</span></CodeLine>
<Link id="l07801" /><CodeLine lineNumber="7801"><span class="doxyHighlightComment">/// depicted in https://llvm.org/docs/Vectorizers.html#epilogue-vectorization.</span></CodeLine>
<Link id="l07802" /><CodeLine lineNumber="7802" lineLink="/docs/api/classes/llvm/epiloguevectorizermainloop/#aa8b67f13fbf902634ecd95060a1cd85f"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aa8b67f13fbf902634ecd95060a1cd85f">EpilogueVectorizerMainLoop::createEpilogueVectorizedLoopSkeleton</a>(</span></CodeLine>
<Link id="l07803" /><CodeLine lineNumber="7803"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV2ValueTy &amp;ExpandedSCEVs) &#123;</span></CodeLine>
<Link id="l07804" /><CodeLine lineNumber="7804"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5e719da4709193fd5b4632da4bc69795">createVectorLoopSkeleton</a>(</span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07805" /><CodeLine lineNumber="7805"></CodeLine>
<Link id="l07806" /><CodeLine lineNumber="7806"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate the code to check the minimum iteration count of the vector</span></CodeLine>
<Link id="l07807" /><CodeLine lineNumber="7807"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// epilogue (see below).</span></CodeLine>
<Link id="l07808" /><CodeLine lineNumber="7808"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueIterationCountCheck =</span></CodeLine>
<Link id="l07809" /><CodeLine lineNumber="7809"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aeeb47f904372b9e25b9f7ba606158b25">emitIterationCountCheck</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07810" /><CodeLine lineNumber="7810"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueIterationCountCheck-&gt;setName(</span><span class="doxyHighlightStringLiteral">&quot;iter.check&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07811" /><CodeLine lineNumber="7811"></CodeLine>
<Link id="l07812" /><CodeLine lineNumber="7812"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate the code to check any assumptions that we&#39;ve made for SCEV</span></CodeLine>
<Link id="l07813" /><CodeLine lineNumber="7813"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// expressions.</span></CodeLine>
<Link id="l07814" /><CodeLine lineNumber="7814"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.SCEVSafetyCheck = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a30c4bcea7beb42c7eb075a578bc3bc3e">emitSCEVChecks</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</span></CodeLine>
<Link id="l07815" /><CodeLine lineNumber="7815"></CodeLine>
<Link id="l07816" /><CodeLine lineNumber="7816"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate the code that checks at runtime if arrays overlap. We put the</span></CodeLine>
<Link id="l07817" /><CodeLine lineNumber="7817"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// checks into a separate block to make the more common case of few elements</span></CodeLine>
<Link id="l07818" /><CodeLine lineNumber="7818"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// faster.</span></CodeLine>
<Link id="l07819" /><CodeLine lineNumber="7819"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MemSafetyCheck = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a625caa931f0d8ef201041febbfe42cca">emitMemRuntimeChecks</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</span></CodeLine>
<Link id="l07820" /><CodeLine lineNumber="7820"></CodeLine>
<Link id="l07821" /><CodeLine lineNumber="7821"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate the iteration count check for the main loop, &#42;after&#42; the check</span></CodeLine>
<Link id="l07822" /><CodeLine lineNumber="7822"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for the epilogue loop, so that the path-length is shorter for the case</span></CodeLine>
<Link id="l07823" /><CodeLine lineNumber="7823"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that goes directly through the vector epilogue. The longer-path length for</span></CodeLine>
<Link id="l07824" /><CodeLine lineNumber="7824"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the main loop is compensated for, by the gain from vectorizing the larger</span></CodeLine>
<Link id="l07825" /><CodeLine lineNumber="7825"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// trip count. Note: the branch will get updated later on when we vectorize</span></CodeLine>
<Link id="l07826" /><CodeLine lineNumber="7826"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the epilogue.</span></CodeLine>
<Link id="l07827" /><CodeLine lineNumber="7827"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopIterationCountCheck =</span></CodeLine>
<Link id="l07828" /><CodeLine lineNumber="7828"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aeeb47f904372b9e25b9f7ba606158b25">emitIterationCountCheck</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07829" /><CodeLine lineNumber="7829"></CodeLine>
<Link id="l07830" /><CodeLine lineNumber="7830"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate the induction variable.</span></CodeLine>
<Link id="l07831" /><CodeLine lineNumber="7831"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.VectorTripCount = <a href="/docs/api/classes/llvm/innerloopvectorizer/#aa83b181aa14d5afe1390faad388f91a4">getOrCreateVectorTripCount</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>);</span></CodeLine>
<Link id="l07832" /><CodeLine lineNumber="7832"></CodeLine>
<Link id="l07833" /><CodeLine lineNumber="7833"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>;</span></CodeLine>
<Link id="l07834" /><CodeLine lineNumber="7834"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07835" /><CodeLine lineNumber="7835"></CodeLine>
<Link id="l07836" /><CodeLine lineNumber="7836" lineLink="/docs/api/classes/llvm/epiloguevectorizermainloop/#aad9eb57dcbd9a2c3fd1993685783d7f7"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aad9eb57dcbd9a2c3fd1993685783d7f7">EpilogueVectorizerMainLoop::printDebugTracesAtStart</a>() &#123;</span></CodeLine>
<Link id="l07837" /><CodeLine lineNumber="7837"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l07838" /><CodeLine lineNumber="7838"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Create Skeleton for epilogue vectorized loop (first pass)\\n&quot;</span></CodeLine>
<Link id="l07839" /><CodeLine lineNumber="7839"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Main Loop VF:&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopVF</span></CodeLine>
<Link id="l07840" /><CodeLine lineNumber="7840"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, Main Loop UF:&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopUF</span></CodeLine>
<Link id="l07841" /><CodeLine lineNumber="7841"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, Epilogue Loop VF:&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueVF</span></CodeLine>
<Link id="l07842" /><CodeLine lineNumber="7842"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, Epilogue Loop UF:&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueUF &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07843" /><CodeLine lineNumber="7843"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l07844" /><CodeLine lineNumber="7844"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07845" /><CodeLine lineNumber="7845"></CodeLine>
<Link id="l07846" /><CodeLine lineNumber="7846" lineLink="/docs/api/classes/llvm/epiloguevectorizermainloop/#a87a0c8bda4e9e23e896e46d0a2208c17"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#a87a0c8bda4e9e23e896e46d0a2208c17">EpilogueVectorizerMainLoop::printDebugTracesAtEnd</a>() &#123;</span></CodeLine>
<Link id="l07847" /><CodeLine lineNumber="7847"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a3fcdc9f30e5e8b9ea4da99868a8ae4a9">DEBUG&#95;WITH&#95;TYPE</a>(<a href="/docs/api/files/lib/lib/analysis/loopnestanalysis-cpp/#ab3595005ef7c117f30d4c18201190bbb">VerboseDebug</a>, &#123;</span></CodeLine>
<Link id="l07848" /><CodeLine lineNumber="7848"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;intermediate fn:\\n&quot;</span></CodeLine>
<Link id="l07849" /><CodeLine lineNumber="7849"><span class="doxyHighlight">           &lt;&lt; &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getHeader()-&gt;getParent() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07850" /><CodeLine lineNumber="7850"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l07851" /><CodeLine lineNumber="7851"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07852" /><CodeLine lineNumber="7852"></CodeLine>
<Link id="l07853" /><CodeLine lineNumber="7853"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span></CodeLine>
<Link id="l07854" /><CodeLine lineNumber="7854" lineLink="/docs/api/classes/llvm/epiloguevectorizermainloop/#aeeb47f904372b9e25b9f7ba606158b25"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aeeb47f904372b9e25b9f7ba606158b25">EpilogueVectorizerMainLoop::emitIterationCountCheck</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass,</span></CodeLine>
<Link id="l07855" /><CodeLine lineNumber="7855"><span class="doxyHighlight">                                                    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ForEpilogue) &#123;</span></CodeLine>
<Link id="l07856" /><CodeLine lineNumber="7856"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Bypass &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Expected valid bypass basic block.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07857" /><CodeLine lineNumber="7857"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VFactor = ForEpilogue ? <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueVF : <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>;</span></CodeLine>
<Link id="l07858" /><CodeLine lineNumber="7858"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> UFactor = ForEpilogue ? <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueUF : <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>;</span></CodeLine>
<Link id="l07859" /><CodeLine lineNumber="7859"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696">getTripCount</a>();</span></CodeLine>
<Link id="l07860" /><CodeLine lineNumber="7860"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Reuse existing vector loop preheader for TC checks.</span></CodeLine>
<Link id="l07861" /><CodeLine lineNumber="7861"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that new preheader block is generated for vector loop.</span></CodeLine>
<Link id="l07862" /><CodeLine lineNumber="7862"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> TCCheckBlock = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>;</span></CodeLine>
<Link id="l07863" /><CodeLine lineNumber="7863"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>(TCCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</span></CodeLine>
<Link id="l07864" /><CodeLine lineNumber="7864"></CodeLine>
<Link id="l07865" /><CodeLine lineNumber="7865"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate code to check if the loop&#39;s trip count is less than VF &#42; UF of the</span></CodeLine>
<Link id="l07866" /><CodeLine lineNumber="7866"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// main vector loop.</span></CodeLine>
<Link id="l07867" /><CodeLine lineNumber="7867"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>-&gt;requiresScalarEpilogue(ForEpilogue ? <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueVF.isVector()</span></CodeLine>
<Link id="l07868" /><CodeLine lineNumber="7868"><span class="doxyHighlight">                                                    : <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.isVector())</span></CodeLine>
<Link id="l07869" /><CodeLine lineNumber="7869"><span class="doxyHighlight">               ? <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">ICmpInst::ICMP&#95;ULE</a></span></CodeLine>
<Link id="l07870" /><CodeLine lineNumber="7870"><span class="doxyHighlight">               : <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>;</span></CodeLine>
<Link id="l07871" /><CodeLine lineNumber="7871"></CodeLine>
<Link id="l07872" /><CodeLine lineNumber="7872"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CheckMinIters = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateICmp(</span></CodeLine>
<Link id="l07873" /><CodeLine lineNumber="7873"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>, <a href="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e">createStepForVF</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>, <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>-&gt;getType(), VFactor, UFactor),</span></CodeLine>
<Link id="l07874" /><CodeLine lineNumber="7874"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;min.iters.check&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07875" /><CodeLine lineNumber="7875"></CodeLine>
<Link id="l07876" /><CodeLine lineNumber="7876"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ForEpilogue)</span></CodeLine>
<Link id="l07877" /><CodeLine lineNumber="7877"><span class="doxyHighlight">    TCCheckBlock-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</span><span class="doxyHighlightStringLiteral">&quot;vector.main.loop.iter.check&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07878" /><CodeLine lineNumber="7878"></CodeLine>
<Link id="l07879" /><CodeLine lineNumber="7879"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create new preheader for vector loop.</span></CodeLine>
<Link id="l07880" /><CodeLine lineNumber="7880"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a> = <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(TCCheckBlock, TCCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(),</span></CodeLine>
<Link id="l07881" /><CodeLine lineNumber="7881"><span class="doxyHighlight">                                   <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;vector.ph&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07882" /><CodeLine lineNumber="7882"></CodeLine>
<Link id="l07883" /><CodeLine lineNumber="7883"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ForEpilogue) &#123;</span></CodeLine>
<Link id="l07884" /><CodeLine lineNumber="7884"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;properlyDominates(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;getNode(TCCheckBlock),</span></CodeLine>
<Link id="l07885" /><CodeLine lineNumber="7885"><span class="doxyHighlight">                                 <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;getNode(Bypass)-&gt;getIDom()) &amp;&amp;</span></CodeLine>
<Link id="l07886" /><CodeLine lineNumber="7886"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;TC check is expected to dominate Bypass&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07887" /><CodeLine lineNumber="7887"></CodeLine>
<Link id="l07888" /><CodeLine lineNumber="7888"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(TCCheckBlock);</span></CodeLine>
<Link id="l07889" /><CodeLine lineNumber="7889"></CodeLine>
<Link id="l07890" /><CodeLine lineNumber="7890"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Save the trip count so we don&#39;t have to regenerate it in the</span></CodeLine>
<Link id="l07891" /><CodeLine lineNumber="7891"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// vec.epilog.iter.check. This is safe to do because the trip count</span></CodeLine>
<Link id="l07892" /><CodeLine lineNumber="7892"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// generated here dominates the vector epilog iter check.</span></CodeLine>
<Link id="l07893" /><CodeLine lineNumber="7893"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.TripCount = <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>;</span></CodeLine>
<Link id="l07894" /><CodeLine lineNumber="7894"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07895" /><CodeLine lineNumber="7895"></CodeLine>
<Link id="l07896" /><CodeLine lineNumber="7896"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &amp;BI =</span></CodeLine>
<Link id="l07897" /><CodeLine lineNumber="7897"><span class="doxyHighlight">      &#42;<a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(Bypass, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>, CheckMinIters);</span></CodeLine>
<Link id="l07898" /><CodeLine lineNumber="7898"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getLoopLatch()-&gt;getTerminator()))</span></CodeLine>
<Link id="l07899" /><CodeLine lineNumber="7899"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(BI, <a href="#a629884e9a99a9f49106db9e5e6252fcb">MinItersBypassWeights</a>, </span><span class="doxyHighlightComment">/&#42;IsExpected=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07900" /><CodeLine lineNumber="7900"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a016a85f7487f995fe80141e102a7a5ae">ReplaceInstWithInst</a>(TCCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), &amp;BI);</span></CodeLine>
<Link id="l07901" /><CodeLine lineNumber="7901"></CodeLine>
<Link id="l07902" /><CodeLine lineNumber="7902"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9">introduceCheckBlockInVPlan</a>(TCCheckBlock);</span></CodeLine>
<Link id="l07903" /><CodeLine lineNumber="7903"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> TCCheckBlock;</span></CodeLine>
<Link id="l07904" /><CodeLine lineNumber="7904"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07905" /><CodeLine lineNumber="7905"></CodeLine>
<Link id="l07906" /><CodeLine lineNumber="7906"><span class="doxyHighlightComment">//===--------------------------------------------------------------------===//</span></CodeLine>
<Link id="l07907" /><CodeLine lineNumber="7907"><span class="doxyHighlightComment">// EpilogueVectorizerEpilogueLoop</span></CodeLine>
<Link id="l07908" /><CodeLine lineNumber="7908"><span class="doxyHighlightComment">//===--------------------------------------------------------------------===//</span></CodeLine>
<Link id="l07909" /><CodeLine lineNumber="7909"></CodeLine>
<Link id="l07910" /><CodeLine lineNumber="7910"><span class="doxyHighlightComment">/// This function is partially responsible for generating the control flow</span></CodeLine>
<Link id="l07911" /><CodeLine lineNumber="7911"><span class="doxyHighlightComment">/// depicted in https://llvm.org/docs/Vectorizers.html#epilogue-vectorization.</span></CodeLine>
<Link id="l07912" /><CodeLine lineNumber="7912"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span></CodeLine>
<Link id="l07913" /><CodeLine lineNumber="7913" lineLink="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#ad1b4c0caba0fac3a1486890cd2445040"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#ad1b4c0caba0fac3a1486890cd2445040">EpilogueVectorizerEpilogueLoop::createEpilogueVectorizedLoopSkeleton</a>(</span></CodeLine>
<Link id="l07914" /><CodeLine lineNumber="7914"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV2ValueTy &amp;ExpandedSCEVs) &#123;</span></CodeLine>
<Link id="l07915" /><CodeLine lineNumber="7915"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5e719da4709193fd5b4632da4bc69795">createVectorLoopSkeleton</a>(</span><span class="doxyHighlightStringLiteral">&quot;vec.epilog.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07916" /><CodeLine lineNumber="7916"></CodeLine>
<Link id="l07917" /><CodeLine lineNumber="7917"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now, compare the remaining count and if there aren&#39;t enough iterations to</span></CodeLine>
<Link id="l07918" /><CodeLine lineNumber="7918"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// execute the vectorized epilogue skip to the scalar part.</span></CodeLine>
<Link id="l07919" /><CodeLine lineNumber="7919"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>-&gt;setName(</span><span class="doxyHighlightStringLiteral">&quot;vec.epilog.ph&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07920" /><CodeLine lineNumber="7920"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;VecEpilogueIterationCountCheck =</span></CodeLine>
<Link id="l07921" /><CodeLine lineNumber="7921"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>-&gt;begin(), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>,</span></CodeLine>
<Link id="l07922" /><CodeLine lineNumber="7922"><span class="doxyHighlight">                 </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightStringLiteral">&quot;vec.epilog.iter.check&quot;</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07923" /><CodeLine lineNumber="7923"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a04c0081718b0f5113134aa563e1a56ca">emitMinimumVectorEpilogueIterCountCheck</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>,</span></CodeLine>
<Link id="l07924" /><CodeLine lineNumber="7924"><span class="doxyHighlight">                                          VecEpilogueIterationCountCheck);</span></CodeLine>
<Link id="l07925" /><CodeLine lineNumber="7925"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a329ce2a6185c5e632406d1d2fc75610e">AdditionalBypassBlock</a> = VecEpilogueIterationCountCheck;</span></CodeLine>
<Link id="l07926" /><CodeLine lineNumber="7926"></CodeLine>
<Link id="l07927" /><CodeLine lineNumber="7927"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Adjust the control flow taking the state info from the main loop</span></CodeLine>
<Link id="l07928" /><CodeLine lineNumber="7928"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorization into account.</span></CodeLine>
<Link id="l07929" /><CodeLine lineNumber="7929"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopIterationCountCheck &amp;&amp; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueIterationCountCheck &amp;&amp;</span></CodeLine>
<Link id="l07930" /><CodeLine lineNumber="7930"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;expected this to be saved from the previous pass.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07931" /><CodeLine lineNumber="7931"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopIterationCountCheck-&gt;getTerminator()-&gt;replaceUsesOfWith(</span></CodeLine>
<Link id="l07932" /><CodeLine lineNumber="7932"><span class="doxyHighlight">      VecEpilogueIterationCountCheck, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>);</span></CodeLine>
<Link id="l07933" /><CodeLine lineNumber="7933"></CodeLine>
<Link id="l07934" /><CodeLine lineNumber="7934"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueIterationCountCheck-&gt;getTerminator()-&gt;replaceUsesOfWith(</span></CodeLine>
<Link id="l07935" /><CodeLine lineNumber="7935"><span class="doxyHighlight">      VecEpilogueIterationCountCheck, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</span></CodeLine>
<Link id="l07936" /><CodeLine lineNumber="7936"></CodeLine>
<Link id="l07937" /><CodeLine lineNumber="7937"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.SCEVSafetyCheck)</span></CodeLine>
<Link id="l07938" /><CodeLine lineNumber="7938"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.SCEVSafetyCheck-&gt;getTerminator()-&gt;replaceUsesOfWith(</span></CodeLine>
<Link id="l07939" /><CodeLine lineNumber="7939"><span class="doxyHighlight">        VecEpilogueIterationCountCheck, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</span></CodeLine>
<Link id="l07940" /><CodeLine lineNumber="7940"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MemSafetyCheck)</span></CodeLine>
<Link id="l07941" /><CodeLine lineNumber="7941"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MemSafetyCheck-&gt;getTerminator()-&gt;replaceUsesOfWith(</span></CodeLine>
<Link id="l07942" /><CodeLine lineNumber="7942"><span class="doxyHighlight">        VecEpilogueIterationCountCheck, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</span></CodeLine>
<Link id="l07943" /><CodeLine lineNumber="7943"></CodeLine>
<Link id="l07944" /><CodeLine lineNumber="7944"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;changeImmediateDominator(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>,</span></CodeLine>
<Link id="l07945" /><CodeLine lineNumber="7945"><span class="doxyHighlight">                               <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueIterationCountCheck);</span></CodeLine>
<Link id="l07946" /><CodeLine lineNumber="7946"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Keep track of bypass blocks, as they feed start values to the induction and</span></CodeLine>
<Link id="l07947" /><CodeLine lineNumber="7947"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reduction phis in the scalar loop preheader.</span></CodeLine>
<Link id="l07948" /><CodeLine lineNumber="7948"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.SCEVSafetyCheck)</span></CodeLine>
<Link id="l07949" /><CodeLine lineNumber="7949"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.SCEVSafetyCheck);</span></CodeLine>
<Link id="l07950" /><CodeLine lineNumber="7950"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MemSafetyCheck)</span></CodeLine>
<Link id="l07951" /><CodeLine lineNumber="7951"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MemSafetyCheck);</span></CodeLine>
<Link id="l07952" /><CodeLine lineNumber="7952"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueIterationCountCheck);</span></CodeLine>
<Link id="l07953" /><CodeLine lineNumber="7953"></CodeLine>
<Link id="l07954" /><CodeLine lineNumber="7954"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The vec.epilog.iter.check block may contain Phi nodes from inductions or</span></CodeLine>
<Link id="l07955" /><CodeLine lineNumber="7955"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reductions which merge control-flow from the latch block and the middle</span></CodeLine>
<Link id="l07956" /><CodeLine lineNumber="7956"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// block. Update the incoming values here and move the Phi into the preheader.</span></CodeLine>
<Link id="l07957" /><CodeLine lineNumber="7957"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PHINode &#42;, 4&gt;</a> PhisInBlock;</span></CodeLine>
<Link id="l07958" /><CodeLine lineNumber="7958"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;Phi : VecEpilogueIterationCountCheck-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>())</span></CodeLine>
<Link id="l07959" /><CodeLine lineNumber="7959"><span class="doxyHighlight">    PhisInBlock.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;Phi);</span></CodeLine>
<Link id="l07960" /><CodeLine lineNumber="7960"></CodeLine>
<Link id="l07961" /><CodeLine lineNumber="7961"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi : PhisInBlock) &#123;</span></CodeLine>
<Link id="l07962" /><CodeLine lineNumber="7962"><span class="doxyHighlight">    Phi-&gt;moveBefore(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>-&gt;getFirstNonPHIIt());</span></CodeLine>
<Link id="l07963" /><CodeLine lineNumber="7963"><span class="doxyHighlight">    Phi-&gt;replaceIncomingBlockWith(</span></CodeLine>
<Link id="l07964" /><CodeLine lineNumber="7964"><span class="doxyHighlight">        VecEpilogueIterationCountCheck-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>(),</span></CodeLine>
<Link id="l07965" /><CodeLine lineNumber="7965"><span class="doxyHighlight">        VecEpilogueIterationCountCheck);</span></CodeLine>
<Link id="l07966" /><CodeLine lineNumber="7966"></CodeLine>
<Link id="l07967" /><CodeLine lineNumber="7967"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the phi doesn&#39;t have an incoming value from the</span></CodeLine>
<Link id="l07968" /><CodeLine lineNumber="7968"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// EpilogueIterationCountCheck, we are done. Otherwise remove the incoming</span></CodeLine>
<Link id="l07969" /><CodeLine lineNumber="7969"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// value and also those from other check blocks. This is needed for</span></CodeLine>
<Link id="l07970" /><CodeLine lineNumber="7970"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// reduction phis only.</span></CodeLine>
<Link id="l07971" /><CodeLine lineNumber="7971"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(Phi-&gt;blocks(), &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IncB) &#123;</span></CodeLine>
<Link id="l07972" /><CodeLine lineNumber="7972"><span class="doxyHighlight">          return EPI.EpilogueIterationCountCheck == IncB;</span></CodeLine>
<Link id="l07973" /><CodeLine lineNumber="7973"><span class="doxyHighlight">        &#125;))</span></CodeLine>
<Link id="l07974" /><CodeLine lineNumber="7974"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l07975" /><CodeLine lineNumber="7975"><span class="doxyHighlight">    Phi-&gt;removeIncomingValue(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueIterationCountCheck);</span></CodeLine>
<Link id="l07976" /><CodeLine lineNumber="7976"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.SCEVSafetyCheck)</span></CodeLine>
<Link id="l07977" /><CodeLine lineNumber="7977"><span class="doxyHighlight">      Phi-&gt;removeIncomingValue(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.SCEVSafetyCheck);</span></CodeLine>
<Link id="l07978" /><CodeLine lineNumber="7978"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MemSafetyCheck)</span></CodeLine>
<Link id="l07979" /><CodeLine lineNumber="7979"><span class="doxyHighlight">      Phi-&gt;removeIncomingValue(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MemSafetyCheck);</span></CodeLine>
<Link id="l07980" /><CodeLine lineNumber="7980"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l07981" /><CodeLine lineNumber="7981"></CodeLine>
<Link id="l07982" /><CodeLine lineNumber="7982"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate bypass values from the additional bypass block. Note that when the</span></CodeLine>
<Link id="l07983" /><CodeLine lineNumber="7983"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorized epilogue is skipped due to iteration count check, then the</span></CodeLine>
<Link id="l07984" /><CodeLine lineNumber="7984"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// resume value for the induction variable comes from the trip count of the</span></CodeLine>
<Link id="l07985" /><CodeLine lineNumber="7985"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// main vector loop, passed as the second argument.</span></CodeLine>
<Link id="l07986" /><CodeLine lineNumber="7986"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a69c116deda6ae831a71558a4630323cb">createInductionAdditionalBypassValues</a>(ExpandedSCEVs, <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.VectorTripCount);</span></CodeLine>
<Link id="l07987" /><CodeLine lineNumber="7987"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>;</span></CodeLine>
<Link id="l07988" /><CodeLine lineNumber="7988"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l07989" /><CodeLine lineNumber="7989"></CodeLine>
<Link id="l07990" /><CodeLine lineNumber="7990"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</span></CodeLine>
<Link id="l07991" /><CodeLine lineNumber="7991" lineLink="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a04c0081718b0f5113134aa563e1a56ca"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a04c0081718b0f5113134aa563e1a56ca">EpilogueVectorizerEpilogueLoop::emitMinimumVectorEpilogueIterCountCheck</a>(</span></CodeLine>
<Link id="l07992" /><CodeLine lineNumber="7992"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Insert) &#123;</span></CodeLine>
<Link id="l07993" /><CodeLine lineNumber="7993"></CodeLine>
<Link id="l07994" /><CodeLine lineNumber="7994"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.TripCount &amp;&amp;</span></CodeLine>
<Link id="l07995" /><CodeLine lineNumber="7995"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Expected trip count to have been saved in the first pass.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l07996" /><CodeLine lineNumber="7996"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l07997" /><CodeLine lineNumber="7997"><span class="doxyHighlight">      (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.TripCount) ||</span></CodeLine>
<Link id="l07998" /><CodeLine lineNumber="7998"><span class="doxyHighlight">       <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;dominates(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.TripCount)-&gt;getParent(), Insert)) &amp;&amp;</span></CodeLine>
<Link id="l07999" /><CodeLine lineNumber="7999"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;saved trip count does not dominate insertion point.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08000" /><CodeLine lineNumber="8000"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;TC = <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.TripCount;</span></CodeLine>
<Link id="l08001" /><CodeLine lineNumber="8001"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>(Insert-&gt;getTerminator());</span></CodeLine>
<Link id="l08002" /><CodeLine lineNumber="8002"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateSub(TC, <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.VectorTripCount, </span><span class="doxyHighlightStringLiteral">&quot;n.vec.remaining&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08003" /><CodeLine lineNumber="8003"></CodeLine>
<Link id="l08004" /><CodeLine lineNumber="8004"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate code to check if the loop&#39;s trip count is less than VF &#42; UF of the</span></CodeLine>
<Link id="l08005" /><CodeLine lineNumber="8005"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vector epilogue loop.</span></CodeLine>
<Link id="l08006" /><CodeLine lineNumber="8006"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>-&gt;requiresScalarEpilogue(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueVF.isVector())</span></CodeLine>
<Link id="l08007" /><CodeLine lineNumber="8007"><span class="doxyHighlight">               ? <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">ICmpInst::ICMP&#95;ULE</a></span></CodeLine>
<Link id="l08008" /><CodeLine lineNumber="8008"><span class="doxyHighlight">               : <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>;</span></CodeLine>
<Link id="l08009" /><CodeLine lineNumber="8009"></CodeLine>
<Link id="l08010" /><CodeLine lineNumber="8010"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CheckMinIters =</span></CodeLine>
<Link id="l08011" /><CodeLine lineNumber="8011"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateICmp(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>,</span></CodeLine>
<Link id="l08012" /><CodeLine lineNumber="8012"><span class="doxyHighlight">                         <a href="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e">createStepForVF</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>, <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>-&gt;getType(),</span></CodeLine>
<Link id="l08013" /><CodeLine lineNumber="8013"><span class="doxyHighlight">                                         <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueVF, <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueUF),</span></CodeLine>
<Link id="l08014" /><CodeLine lineNumber="8014"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;min.epilog.iters.check&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08015" /><CodeLine lineNumber="8015"></CodeLine>
<Link id="l08016" /><CodeLine lineNumber="8016"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &amp;BI =</span></CodeLine>
<Link id="l08017" /><CodeLine lineNumber="8017"><span class="doxyHighlight">      &#42;<a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(Bypass, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>, CheckMinIters);</span></CodeLine>
<Link id="l08018" /><CodeLine lineNumber="8018"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getLoopLatch()-&gt;getTerminator())) &#123;</span></CodeLine>
<Link id="l08019" /><CodeLine lineNumber="8019"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> MainLoopStep = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a> &#42; <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.getKnownMinValue();</span></CodeLine>
<Link id="l08020" /><CodeLine lineNumber="8020"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EpilogueLoopStep =</span></CodeLine>
<Link id="l08021" /><CodeLine lineNumber="8021"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueUF &#42; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueVF.getKnownMinValue();</span></CodeLine>
<Link id="l08022" /><CodeLine lineNumber="8022"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We assume the remaining &#96;Count&#96; is equally distributed in</span></CodeLine>
<Link id="l08023" /><CodeLine lineNumber="8023"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// &#91;0, MainLoopStep)</span></CodeLine>
<Link id="l08024" /><CodeLine lineNumber="8024"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// So the probability for &#96;Count &lt; EpilogueLoopStep&#96; should be</span></CodeLine>
<Link id="l08025" /><CodeLine lineNumber="8025"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// min(MainLoopStep, EpilogueLoopStep) / MainLoopStep</span></CodeLine>
<Link id="l08026" /><CodeLine lineNumber="8026"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EstimatedSkipCount = std::min(MainLoopStep, EpilogueLoopStep);</span></CodeLine>
<Link id="l08027" /><CodeLine lineNumber="8027"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> uint32&#95;t Weights&#91;&#93; = &#123;EstimatedSkipCount,</span></CodeLine>
<Link id="l08028" /><CodeLine lineNumber="8028"><span class="doxyHighlight">                                MainLoopStep - EstimatedSkipCount&#125;;</span></CodeLine>
<Link id="l08029" /><CodeLine lineNumber="8029"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(BI, Weights, </span><span class="doxyHighlightComment">/&#42;IsExpected=&#42;/</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08030" /><CodeLine lineNumber="8030"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08031" /><CodeLine lineNumber="8031"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a016a85f7487f995fe80141e102a7a5ae">ReplaceInstWithInst</a>(Insert-&gt;getTerminator(), &amp;BI);</span></CodeLine>
<Link id="l08032" /><CodeLine lineNumber="8032"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(Insert);</span></CodeLine>
<Link id="l08033" /><CodeLine lineNumber="8033"></CodeLine>
<Link id="l08034" /><CodeLine lineNumber="8034"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A new entry block has been created for the epilogue VPlan. Hook it in, as</span></CodeLine>
<Link id="l08035" /><CodeLine lineNumber="8035"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// otherwise we would try to modify the entry to the main vector loop.</span></CodeLine>
<Link id="l08036" /><CodeLine lineNumber="8036"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> &#42;NewEntry = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.createVPIRBasicBlock(Insert);</span></CodeLine>
<Link id="l08037" /><CodeLine lineNumber="8037"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;OldEntry = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.getEntry();</span></CodeLine>
<Link id="l08038" /><CodeLine lineNumber="8038"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpblockutils/#a63345282cd67ea46202fb33523be1408">VPBlockUtils::reassociateBlocks</a>(OldEntry, NewEntry);</span></CodeLine>
<Link id="l08039" /><CodeLine lineNumber="8039"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.setEntry(NewEntry);</span></CodeLine>
<Link id="l08040" /><CodeLine lineNumber="8040"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// OldEntry is now dead and will be cleaned up when the plan gets destroyed.</span></CodeLine>
<Link id="l08041" /><CodeLine lineNumber="8041"></CodeLine>
<Link id="l08042" /><CodeLine lineNumber="8042"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9">introduceCheckBlockInVPlan</a>(Insert);</span></CodeLine>
<Link id="l08043" /><CodeLine lineNumber="8043"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Insert;</span></CodeLine>
<Link id="l08044" /><CodeLine lineNumber="8044"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08045" /><CodeLine lineNumber="8045"></CodeLine>
<Link id="l08046" /><CodeLine lineNumber="8046" lineLink="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a9d4052b05414daf596711bada5c5e94b"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a9d4052b05414daf596711bada5c5e94b">EpilogueVectorizerEpilogueLoop::printDebugTracesAtStart</a>() &#123;</span></CodeLine>
<Link id="l08047" /><CodeLine lineNumber="8047"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</span></CodeLine>
<Link id="l08048" /><CodeLine lineNumber="8048"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Create Skeleton for epilogue vectorized loop (second pass)\\n&quot;</span></CodeLine>
<Link id="l08049" /><CodeLine lineNumber="8049"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Epilogue Loop VF:&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueVF</span></CodeLine>
<Link id="l08050" /><CodeLine lineNumber="8050"><span class="doxyHighlight">           &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;, Epilogue Loop UF:&quot;</span><span class="doxyHighlight"> &lt;&lt; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueUF &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08051" /><CodeLine lineNumber="8051"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l08052" /><CodeLine lineNumber="8052"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08053" /><CodeLine lineNumber="8053"></CodeLine>
<Link id="l08054" /><CodeLine lineNumber="8054" lineLink="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a07454ac2b11a89ba60771243779a58e4"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a07454ac2b11a89ba60771243779a58e4">EpilogueVectorizerEpilogueLoop::printDebugTracesAtEnd</a>() &#123;</span></CodeLine>
<Link id="l08055" /><CodeLine lineNumber="8055"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a3fcdc9f30e5e8b9ea4da99868a8ae4a9">DEBUG&#95;WITH&#95;TYPE</a>(<a href="/docs/api/files/lib/lib/analysis/loopnestanalysis-cpp/#ab3595005ef7c117f30d4c18201190bbb">VerboseDebug</a>, &#123;</span></CodeLine>
<Link id="l08056" /><CodeLine lineNumber="8056"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;final fn:\\n&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getHeader()-&gt;getParent() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08057" /><CodeLine lineNumber="8057"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l08058" /><CodeLine lineNumber="8058"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08059" /><CodeLine lineNumber="8059"></CodeLine>
<Link id="l08060" /><CodeLine lineNumber="8060"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/iterator-range">iterator&#95;range</a>&lt;<a href="/docs/api/classes/llvm/mapped-iterator">mapped&#95;iterator</a>&lt;<a href="/docs/api/classes/llvm/use">Use</a> &#42;, std::function&lt;<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;)&gt;&gt;&gt;</span></CodeLine>
<Link id="l08061" /><CodeLine lineNumber="8061" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a537d8b3b5160caeb94b20a21a9f6dcff"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vprecipebuilder/#a537d8b3b5160caeb94b20a21a9f6dcff">VPRecipeBuilder::mapToVPValues</a>(<a href="/docs/api/classes/llvm/user/#a917548288129e24325af275795e4622f">User::op&#95;range</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>) &#123;</span></CodeLine>
<Link id="l08062" /><CodeLine lineNumber="8062"><span class="doxyHighlight">  std::function&lt;<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;)&gt; Fn = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123;</span></CodeLine>
<Link id="l08063" /><CodeLine lineNumber="8063"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l08064" /><CodeLine lineNumber="8064"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l08065" /><CodeLine lineNumber="8065"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a51c7cbd21e1104ee6841c18d7daa6edb">map&#95;range</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, Fn);</span></CodeLine>
<Link id="l08066" /><CodeLine lineNumber="8066"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08067" /><CodeLine lineNumber="8067"></CodeLine>
<Link id="l08068" /><CodeLine lineNumber="8068" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a2e7e2adb0e2bd1c35df6aee471fc1db7"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vprecipebuilder/#a2e7e2adb0e2bd1c35df6aee471fc1db7">VPRecipeBuilder::createSwitchEdgeMasks</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</span></CodeLine>
<Link id="l08069" /><CodeLine lineNumber="8069"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Src = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent();</span></CodeLine>
<Link id="l08070" /><CodeLine lineNumber="8070"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!OrigLoop-&gt;isLoopExiting(Src) &amp;&amp;</span></CodeLine>
<Link id="l08071" /><CodeLine lineNumber="8071"><span class="doxyHighlight">         <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(Src),</span></CodeLine>
<Link id="l08072" /><CodeLine lineNumber="8072"><span class="doxyHighlight">                &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ) &#123;</span></CodeLine>
<Link id="l08073" /><CodeLine lineNumber="8073"><span class="doxyHighlight">                  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> OrigLoop-&gt;getHeader() != Succ;</span></CodeLine>
<Link id="l08074" /><CodeLine lineNumber="8074"><span class="doxyHighlight">                &#125;) &amp;&amp;</span></CodeLine>
<Link id="l08075" /><CodeLine lineNumber="8075"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;unsupported switch either exiting loop or continuing to header&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08076" /><CodeLine lineNumber="8076"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create masks where the terminator in Src is a switch. We create mask for</span></CodeLine>
<Link id="l08077" /><CodeLine lineNumber="8077"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// all edges at the same time. This is more efficient, as we can create and</span></CodeLine>
<Link id="l08078" /><CodeLine lineNumber="8078"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// collect compares for all cases once.</span></CodeLine>
<Link id="l08079" /><CodeLine lineNumber="8079"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition());</span></CodeLine>
<Link id="l08080" /><CodeLine lineNumber="8080"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DefaultDst = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest();</span></CodeLine>
<Link id="l08081" /><CodeLine lineNumber="8081"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;BasicBlock &#42;, SmallVector&lt;VPValue &#42;&gt;</a>&gt; Dst2Compares;</span></CodeLine>
<Link id="l08082" /><CodeLine lineNumber="8082"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases()) &#123;</span></CodeLine>
<Link id="l08083" /><CodeLine lineNumber="8083"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dst = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getCaseSuccessor();</span></CodeLine>
<Link id="l08084" /><CodeLine lineNumber="8084"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!EdgeMaskCache.contains(&#123;Src, Dst&#125;) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Edge masks already created&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08085" /><CodeLine lineNumber="8085"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Cases whose destination is the same as default are redundant and can be</span></CodeLine>
<Link id="l08086" /><CodeLine lineNumber="8086"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ignored - they will get there anyhow.</span></CodeLine>
<Link id="l08087" /><CodeLine lineNumber="8087"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Dst == DefaultDst)</span></CodeLine>
<Link id="l08088" /><CodeLine lineNumber="8088"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08089" /><CodeLine lineNumber="8089"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;Compares = Dst2Compares&#91;Dst&#93;;</span></CodeLine>
<Link id="l08090" /><CodeLine lineNumber="8090"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;V = <a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getCaseValue());</span></CodeLine>
<Link id="l08091" /><CodeLine lineNumber="8091"><span class="doxyHighlight">    Compares.push&#95;back(Builder.createICmp(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP&#95;EQ</a>, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, V));</span></CodeLine>
<Link id="l08092" /><CodeLine lineNumber="8092"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08093" /><CodeLine lineNumber="8093"></CodeLine>
<Link id="l08094" /><CodeLine lineNumber="8094"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We need to handle 2 separate cases below for all entries in Dst2Compares,</span></CodeLine>
<Link id="l08095" /><CodeLine lineNumber="8095"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which excludes destinations matching the default destination.</span></CodeLine>
<Link id="l08096" /><CodeLine lineNumber="8096"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;SrcMask = <a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(Src);</span></CodeLine>
<Link id="l08097" /><CodeLine lineNumber="8097"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;DefaultMask = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08098" /><CodeLine lineNumber="8098"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;Dst, Conds&#93; : Dst2Compares) &#123;</span></CodeLine>
<Link id="l08099" /><CodeLine lineNumber="8099"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// 1 Dst is not the default destination. Dst is reached if any of the cases</span></CodeLine>
<Link id="l08100" /><CodeLine lineNumber="8100"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// with destination == Dst are taken. Join the conditions for each case</span></CodeLine>
<Link id="l08101" /><CodeLine lineNumber="8101"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// whose destination == Dst using an OR.</span></CodeLine>
<Link id="l08102" /><CodeLine lineNumber="8102"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Mask = Conds&#91;0&#93;;</span></CodeLine>
<Link id="l08103" /><CodeLine lineNumber="8103"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;V : <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a>(Conds).drop&#95;front())</span></CodeLine>
<Link id="l08104" /><CodeLine lineNumber="8104"><span class="doxyHighlight">      Mask = Builder.createOr(Mask, V);</span></CodeLine>
<Link id="l08105" /><CodeLine lineNumber="8105"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcMask)</span></CodeLine>
<Link id="l08106" /><CodeLine lineNumber="8106"><span class="doxyHighlight">      Mask = Builder.createLogicalAnd(SrcMask, Mask);</span></CodeLine>
<Link id="l08107" /><CodeLine lineNumber="8107"><span class="doxyHighlight">    EdgeMaskCache&#91;&#123;Src, Dst&#125;&#93; = Mask;</span></CodeLine>
<Link id="l08108" /><CodeLine lineNumber="8108"></CodeLine>
<Link id="l08109" /><CodeLine lineNumber="8109"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// 2 Create the mask for the default destination, which is reached if none</span></CodeLine>
<Link id="l08110" /><CodeLine lineNumber="8110"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// of the cases with destination != default destination are taken. Join the</span></CodeLine>
<Link id="l08111" /><CodeLine lineNumber="8111"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// conditions for each case where the destination is != Dst using an OR and</span></CodeLine>
<Link id="l08112" /><CodeLine lineNumber="8112"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// negate it.</span></CodeLine>
<Link id="l08113" /><CodeLine lineNumber="8113"><span class="doxyHighlight">    DefaultMask = DefaultMask ? Builder.createOr(DefaultMask, Mask) : Mask;</span></CodeLine>
<Link id="l08114" /><CodeLine lineNumber="8114"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08115" /><CodeLine lineNumber="8115"></CodeLine>
<Link id="l08116" /><CodeLine lineNumber="8116"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DefaultMask) &#123;</span></CodeLine>
<Link id="l08117" /><CodeLine lineNumber="8117"><span class="doxyHighlight">    DefaultMask = Builder.createNot(DefaultMask);</span></CodeLine>
<Link id="l08118" /><CodeLine lineNumber="8118"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcMask)</span></CodeLine>
<Link id="l08119" /><CodeLine lineNumber="8119"><span class="doxyHighlight">      DefaultMask = Builder.createLogicalAnd(SrcMask, DefaultMask);</span></CodeLine>
<Link id="l08120" /><CodeLine lineNumber="8120"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08121" /><CodeLine lineNumber="8121"><span class="doxyHighlight">  EdgeMaskCache&#91;&#123;Src, DefaultDst&#125;&#93; = DefaultMask;</span></CodeLine>
<Link id="l08122" /><CodeLine lineNumber="8122"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08123" /><CodeLine lineNumber="8123"></CodeLine>
<Link id="l08124" /><CodeLine lineNumber="8124" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a0775987674a0fc922481db1966a5fdf5"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/classes/llvm/vprecipebuilder/#a0775987674a0fc922481db1966a5fdf5">VPRecipeBuilder::createEdgeMask</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Src, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dst) &#123;</span></CodeLine>
<Link id="l08125" /><CodeLine lineNumber="8125"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(Dst), Src) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Invalid edge&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08126" /><CodeLine lineNumber="8126"></CodeLine>
<Link id="l08127" /><CodeLine lineNumber="8127"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for cached value.</span></CodeLine>
<Link id="l08128" /><CodeLine lineNumber="8128"><span class="doxyHighlight">  std::pair&lt;BasicBlock &#42;, BasicBlock &#42;&gt; Edge(Src, Dst);</span></CodeLine>
<Link id="l08129" /><CodeLine lineNumber="8129"><span class="doxyHighlight">  EdgeMaskCacheTy::iterator ECEntryIt = EdgeMaskCache.find(Edge);</span></CodeLine>
<Link id="l08130" /><CodeLine lineNumber="8130"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ECEntryIt != EdgeMaskCache.end())</span></CodeLine>
<Link id="l08131" /><CodeLine lineNumber="8131"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ECEntryIt-&gt;second;</span></CodeLine>
<Link id="l08132" /><CodeLine lineNumber="8132"></CodeLine>
<Link id="l08133" /><CodeLine lineNumber="8133"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SwitchInst&gt;</a>(Src-&gt;getTerminator())) &#123;</span></CodeLine>
<Link id="l08134" /><CodeLine lineNumber="8134"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vprecipebuilder/#a2e7e2adb0e2bd1c35df6aee471fc1db7">createSwitchEdgeMasks</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>);</span></CodeLine>
<Link id="l08135" /><CodeLine lineNumber="8135"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EdgeMaskCache.contains(Edge) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Mask for Edge not created?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08136" /><CodeLine lineNumber="8136"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EdgeMaskCache&#91;Edge&#93;;</span></CodeLine>
<Link id="l08137" /><CodeLine lineNumber="8137"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08138" /><CodeLine lineNumber="8138"></CodeLine>
<Link id="l08139" /><CodeLine lineNumber="8139"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;SrcMask = <a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(Src);</span></CodeLine>
<Link id="l08140" /><CodeLine lineNumber="8140"></CodeLine>
<Link id="l08141" /><CodeLine lineNumber="8141"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The terminator has to be a branch inst!</span></CodeLine>
<Link id="l08142" /><CodeLine lineNumber="8142"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(Src-&gt;getTerminator());</span></CodeLine>
<Link id="l08143" /><CodeLine lineNumber="8143"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected terminator found&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08144" /><CodeLine lineNumber="8144"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() || BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1))</span></CodeLine>
<Link id="l08145" /><CodeLine lineNumber="8145"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EdgeMaskCache&#91;Edge&#93; = SrcMask;</span></CodeLine>
<Link id="l08146" /><CodeLine lineNumber="8146"></CodeLine>
<Link id="l08147" /><CodeLine lineNumber="8147"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If source is an exiting block, we know the exit edge is dynamically dead</span></CodeLine>
<Link id="l08148" /><CodeLine lineNumber="8148"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in the vector loop, and thus we don&#39;t need to restrict the mask.  Avoid</span></CodeLine>
<Link id="l08149" /><CodeLine lineNumber="8149"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// adding uses of an otherwise potentially dead instruction unless we are</span></CodeLine>
<Link id="l08150" /><CodeLine lineNumber="8150"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorizing a loop with uncountable exits. In that case, we always</span></CodeLine>
<Link id="l08151" /><CodeLine lineNumber="8151"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// materialize the mask.</span></CodeLine>
<Link id="l08152" /><CodeLine lineNumber="8152"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (OrigLoop-&gt;isLoopExiting(Src) &amp;&amp;</span></CodeLine>
<Link id="l08153" /><CodeLine lineNumber="8153"><span class="doxyHighlight">      Src != Legal-&gt;getUncountableEarlyExitingBlock())</span></CodeLine>
<Link id="l08154" /><CodeLine lineNumber="8154"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EdgeMaskCache&#91;Edge&#93; = SrcMask;</span></CodeLine>
<Link id="l08155" /><CodeLine lineNumber="8155"></CodeLine>
<Link id="l08156" /><CodeLine lineNumber="8156"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;EdgeMask = <a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>());</span></CodeLine>
<Link id="l08157" /><CodeLine lineNumber="8157"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EdgeMask &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;No Edge Mask found for condition&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08158" /><CodeLine lineNumber="8158"></CodeLine>
<Link id="l08159" /><CodeLine lineNumber="8159"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) != Dst)</span></CodeLine>
<Link id="l08160" /><CodeLine lineNumber="8160"><span class="doxyHighlight">    EdgeMask = Builder.createNot(EdgeMask, BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l08161" /><CodeLine lineNumber="8161"></CodeLine>
<Link id="l08162" /><CodeLine lineNumber="8162"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (SrcMask) &#123; </span><span class="doxyHighlightComment">// Otherwise block in-mask is all-one, no need to AND.</span></CodeLine>
<Link id="l08163" /><CodeLine lineNumber="8163"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The bitwise &#39;And&#39; of SrcMask and EdgeMask introduces new UB if SrcMask</span></CodeLine>
<Link id="l08164" /><CodeLine lineNumber="8164"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// is false and EdgeMask is poison. Avoid that by using &#39;LogicalAnd&#39;</span></CodeLine>
<Link id="l08165" /><CodeLine lineNumber="8165"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// instead which generates &#39;select i1 SrcMask, i1 EdgeMask, i1 false&#39;.</span></CodeLine>
<Link id="l08166" /><CodeLine lineNumber="8166"><span class="doxyHighlight">    EdgeMask = Builder.createLogicalAnd(SrcMask, EdgeMask, BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l08167" /><CodeLine lineNumber="8167"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08168" /><CodeLine lineNumber="8168"></CodeLine>
<Link id="l08169" /><CodeLine lineNumber="8169"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> EdgeMaskCache&#91;Edge&#93; = EdgeMask;</span></CodeLine>
<Link id="l08170" /><CodeLine lineNumber="8170"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08171" /><CodeLine lineNumber="8171"></CodeLine>
<Link id="l08172" /><CodeLine lineNumber="8172" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a4a24061cba79c1c33396b71076a7379e"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/classes/llvm/vprecipebuilder/#a4a24061cba79c1c33396b71076a7379e">VPRecipeBuilder::getEdgeMask</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Src, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dst)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l08173" /><CodeLine lineNumber="8173"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(Dst), Src) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Invalid edge&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08174" /><CodeLine lineNumber="8174"></CodeLine>
<Link id="l08175" /><CodeLine lineNumber="8175"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Look for cached value.</span></CodeLine>
<Link id="l08176" /><CodeLine lineNumber="8176"><span class="doxyHighlight">  std::pair&lt;BasicBlock &#42;, BasicBlock &#42;&gt; Edge(Src, Dst);</span></CodeLine>
<Link id="l08177" /><CodeLine lineNumber="8177"><span class="doxyHighlight">  EdgeMaskCacheTy::const&#95;iterator ECEntryIt = EdgeMaskCache.find(Edge);</span></CodeLine>
<Link id="l08178" /><CodeLine lineNumber="8178"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ECEntryIt != EdgeMaskCache.end() &amp;&amp;</span></CodeLine>
<Link id="l08179" /><CodeLine lineNumber="8179"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;looking up mask for edge which has not been created&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08180" /><CodeLine lineNumber="8180"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ECEntryIt-&gt;second;</span></CodeLine>
<Link id="l08181" /><CodeLine lineNumber="8181"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08182" /><CodeLine lineNumber="8182"></CodeLine>
<Link id="l08183" /><CodeLine lineNumber="8183" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a826173bded23a3839e30074a98ad34a1"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vprecipebuilder/#a826173bded23a3839e30074a98ad34a1">VPRecipeBuilder::createHeaderMask</a>() &#123;</span></CodeLine>
<Link id="l08184" /><CodeLine lineNumber="8184"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Header = OrigLoop-&gt;getHeader();</span></CodeLine>
<Link id="l08185" /><CodeLine lineNumber="8185"></CodeLine>
<Link id="l08186" /><CodeLine lineNumber="8186"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// When not folding the tail, use nullptr to model all-true mask.</span></CodeLine>
<Link id="l08187" /><CodeLine lineNumber="8187"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CM.foldTailByMasking()) &#123;</span></CodeLine>
<Link id="l08188" /><CodeLine lineNumber="8188"><span class="doxyHighlight">    BlockMaskCache&#91;Header&#93; = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08189" /><CodeLine lineNumber="8189"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08190" /><CodeLine lineNumber="8190"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08191" /><CodeLine lineNumber="8191"></CodeLine>
<Link id="l08192" /><CodeLine lineNumber="8192"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Introduce the early-exit compare IV &lt;= BTC to form header block mask.</span></CodeLine>
<Link id="l08193" /><CodeLine lineNumber="8193"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is used instead of IV &lt; TC because TC may wrap, unlike BTC. Start by</span></CodeLine>
<Link id="l08194" /><CodeLine lineNumber="8194"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// constructing the desired canonical IV in the header block as its first</span></CodeLine>
<Link id="l08195" /><CodeLine lineNumber="8195"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// non-phi instructions.</span></CodeLine>
<Link id="l08196" /><CodeLine lineNumber="8196"></CodeLine>
<Link id="l08197" /><CodeLine lineNumber="8197"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;HeaderVPBB = Plan.getVectorLoopRegion()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</span></CodeLine>
<Link id="l08198" /><CodeLine lineNumber="8198"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> NewInsertionPoint = HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>();</span></CodeLine>
<Link id="l08199" /><CodeLine lineNumber="8199"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidencanonicalivrecipe">VPWidenCanonicalIVRecipe</a>(Plan.getCanonicalIV());</span></CodeLine>
<Link id="l08200" /><CodeLine lineNumber="8200"><span class="doxyHighlight">  HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#adfdd504b078cce3b90e7c5cf1f5164db">insert</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>, NewInsertionPoint);</span></CodeLine>
<Link id="l08201" /><CodeLine lineNumber="8201"></CodeLine>
<Link id="l08202" /><CodeLine lineNumber="8202"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder/insertpointguard">VPBuilder::InsertPointGuard</a> Guard(Builder);</span></CodeLine>
<Link id="l08203" /><CodeLine lineNumber="8203"><span class="doxyHighlight">  Builder.setInsertPoint(HeaderVPBB, NewInsertionPoint);</span></CodeLine>
<Link id="l08204" /><CodeLine lineNumber="8204"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;BlockMask = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08205" /><CodeLine lineNumber="8205"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;BTC = Plan.getOrCreateBackedgeTakenCount();</span></CodeLine>
<Link id="l08206" /><CodeLine lineNumber="8206"><span class="doxyHighlight">  BlockMask = Builder.createICmp(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">CmpInst::ICMP&#95;ULE</a>, <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>, BTC);</span></CodeLine>
<Link id="l08207" /><CodeLine lineNumber="8207"><span class="doxyHighlight">  BlockMaskCache&#91;Header&#93; = BlockMask;</span></CodeLine>
<Link id="l08208" /><CodeLine lineNumber="8208"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08209" /><CodeLine lineNumber="8209"></CodeLine>
<Link id="l08210" /><CodeLine lineNumber="8210" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">VPRecipeBuilder::getBlockInMask</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l08211" /><CodeLine lineNumber="8211"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Return the cached value.</span></CodeLine>
<Link id="l08212" /><CodeLine lineNumber="8212"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/densemapbase/#a5784c312872bef21d9344dae0a0e8fc0">BlockMaskCacheTy::const&#95;iterator</a> BCEntryIt = BlockMaskCache.find(BB);</span></CodeLine>
<Link id="l08213" /><CodeLine lineNumber="8213"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BCEntryIt != BlockMaskCache.end() &amp;&amp;</span></CodeLine>
<Link id="l08214" /><CodeLine lineNumber="8214"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Trying to access mask for block without one.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08215" /><CodeLine lineNumber="8215"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> BCEntryIt-&gt;second;</span></CodeLine>
<Link id="l08216" /><CodeLine lineNumber="8216"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08217" /><CodeLine lineNumber="8217"></CodeLine>
<Link id="l08218" /><CodeLine lineNumber="8218" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a8a4bd8661b898e837b18df553e937311"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vprecipebuilder/#a8a4bd8661b898e837b18df553e937311">VPRecipeBuilder::createBlockInMask</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</span></CodeLine>
<Link id="l08219" /><CodeLine lineNumber="8219"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OrigLoop-&gt;contains(BB) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Block is not a part of a loop&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08220" /><CodeLine lineNumber="8220"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BlockMaskCache.count(BB) == 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Mask for block already computed&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08221" /><CodeLine lineNumber="8221"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OrigLoop-&gt;getHeader() != BB &amp;&amp;</span></CodeLine>
<Link id="l08222" /><CodeLine lineNumber="8222"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Loop header must have cached block mask&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08223" /><CodeLine lineNumber="8223"></CodeLine>
<Link id="l08224" /><CodeLine lineNumber="8224"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All-one mask is modelled as no-mask following the convention for masked</span></CodeLine>
<Link id="l08225" /><CodeLine lineNumber="8225"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// load/store/gather/scatter. Initialize BlockMask to no-mask.</span></CodeLine>
<Link id="l08226" /><CodeLine lineNumber="8226"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;BlockMask = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08227" /><CodeLine lineNumber="8227"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// This is the block mask. We OR all unique incoming edges.</span></CodeLine>
<Link id="l08228" /><CodeLine lineNumber="8228"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Predecessor :</span></CodeLine>
<Link id="l08229" /><CodeLine lineNumber="8229"><span class="doxyHighlight">       <a href="/docs/api/classes/llvm/setvector">SetVector&lt;BasicBlock &#42;&gt;</a>(<a href="/docs/api/namespaces/llvm/#ac3e549d97549636a7f08779d5cd98540">pred&#95;begin</a>(BB), <a href="/docs/api/namespaces/llvm/#a2103c335fa6ab933312c3871c82b0106">pred&#95;end</a>(BB))) &#123;</span></CodeLine>
<Link id="l08230" /><CodeLine lineNumber="8230"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;EdgeMask = <a href="/docs/api/classes/llvm/vprecipebuilder/#a0775987674a0fc922481db1966a5fdf5">createEdgeMask</a>(Predecessor, BB);</span></CodeLine>
<Link id="l08231" /><CodeLine lineNumber="8231"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!EdgeMask) &#123; </span><span class="doxyHighlightComment">// Mask of predecessor is all-one so mask of block is too.</span></CodeLine>
<Link id="l08232" /><CodeLine lineNumber="8232"><span class="doxyHighlight">      BlockMaskCache&#91;BB&#93; = EdgeMask;</span></CodeLine>
<Link id="l08233" /><CodeLine lineNumber="8233"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08234" /><CodeLine lineNumber="8234"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08235" /><CodeLine lineNumber="8235"></CodeLine>
<Link id="l08236" /><CodeLine lineNumber="8236"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BlockMask) &#123; </span><span class="doxyHighlightComment">// BlockMask has its initialized nullptr value.</span></CodeLine>
<Link id="l08237" /><CodeLine lineNumber="8237"><span class="doxyHighlight">      BlockMask = EdgeMask;</span></CodeLine>
<Link id="l08238" /><CodeLine lineNumber="8238"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08239" /><CodeLine lineNumber="8239"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08240" /><CodeLine lineNumber="8240"></CodeLine>
<Link id="l08241" /><CodeLine lineNumber="8241"><span class="doxyHighlight">    BlockMask = Builder.createOr(BlockMask, EdgeMask, &#123;&#125;);</span></CodeLine>
<Link id="l08242" /><CodeLine lineNumber="8242"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08243" /><CodeLine lineNumber="8243"></CodeLine>
<Link id="l08244" /><CodeLine lineNumber="8244"><span class="doxyHighlight">  BlockMaskCache&#91;BB&#93; = BlockMask;</span></CodeLine>
<Link id="l08245" /><CodeLine lineNumber="8245"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08246" /><CodeLine lineNumber="8246"></CodeLine>
<Link id="l08247" /><CodeLine lineNumber="8247"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vpwidenmemoryrecipe">VPWidenMemoryRecipe</a> &#42;</span></CodeLine>
<Link id="l08248" /><CodeLine lineNumber="8248"><span class="doxyHighlight">VPRecipeBuilder::tryToWidenMemory(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>,</span></CodeLine>
<Link id="l08249" /><CodeLine lineNumber="8249"><span class="doxyHighlight">                                  <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</span></CodeLine>
<Link id="l08250" /><CodeLine lineNumber="8250"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</span></CodeLine>
<Link id="l08251" /><CodeLine lineNumber="8251"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Must be called with either a load or store&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08252" /><CodeLine lineNumber="8252"></CodeLine>
<Link id="l08253" /><CodeLine lineNumber="8253"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> WillWiden = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08254" /><CodeLine lineNumber="8254"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">LoopVectorizationCostModel::InstWidening</a> Decision =</span></CodeLine>
<Link id="l08255" /><CodeLine lineNumber="8255"><span class="doxyHighlight">        CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l08256" /><CodeLine lineNumber="8256"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Decision != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">LoopVectorizationCostModel::CM&#95;Unknown</a> &amp;&amp;</span></CodeLine>
<Link id="l08257" /><CodeLine lineNumber="8257"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;CM decision should be taken at this point.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08258" /><CodeLine lineNumber="8258"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Decision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971">LoopVectorizationCostModel::CM&#95;Interleave</a>)</span></CodeLine>
<Link id="l08259" /><CodeLine lineNumber="8259"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08260" /><CodeLine lineNumber="8260"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) ||</span></CodeLine>
<Link id="l08261" /><CodeLine lineNumber="8261"><span class="doxyHighlight">        CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9a6fbca8c965adeb8016a03ca3de2cac">isProfitableToScalarize</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</span></CodeLine>
<Link id="l08262" /><CodeLine lineNumber="8262"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08263" /><CodeLine lineNumber="8263"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Decision != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">LoopVectorizationCostModel::CM&#95;Scalarize</a>;</span></CodeLine>
<Link id="l08264" /><CodeLine lineNumber="8264"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l08265" /><CodeLine lineNumber="8265"></CodeLine>
<Link id="l08266" /><CodeLine lineNumber="8266"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(WillWiden, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>))</span></CodeLine>
<Link id="l08267" /><CodeLine lineNumber="8267"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08268" /><CodeLine lineNumber="8268"></CodeLine>
<Link id="l08269" /><CodeLine lineNumber="8269"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Mask = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08270" /><CodeLine lineNumber="8270"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/irsimilarity/#af46430106334db52bfa7a4107e53a0bda8f7357506e00d8cd0694f948f909865d">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l08271" /><CodeLine lineNumber="8271"><span class="doxyHighlight">    Mask = <a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</span></CodeLine>
<Link id="l08272" /><CodeLine lineNumber="8272"></CodeLine>
<Link id="l08273" /><CodeLine lineNumber="8273"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Determine if the pointer operand of the access is either consecutive or</span></CodeLine>
<Link id="l08274" /><CodeLine lineNumber="8274"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reverse consecutive.</span></CodeLine>
<Link id="l08275" /><CodeLine lineNumber="8275"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">LoopVectorizationCostModel::InstWidening</a> Decision =</span></CodeLine>
<Link id="l08276" /><CodeLine lineNumber="8276"><span class="doxyHighlight">      CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>.Start);</span></CodeLine>
<Link id="l08277" /><CodeLine lineNumber="8277"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a1200affbcdb869bf32076f90ad9d0eafa67f115c1fddc4ce1aeb1c754001585bc">Reverse</a> = Decision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a058eacbd3c28e2ecec2af7db726ce527">LoopVectorizationCostModel::CM&#95;Widen&#95;Reverse</a>;</span></CodeLine>
<Link id="l08278" /><CodeLine lineNumber="8278"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> Consecutive =</span></CodeLine>
<Link id="l08279" /><CodeLine lineNumber="8279"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a1200affbcdb869bf32076f90ad9d0eafa67f115c1fddc4ce1aeb1c754001585bc">Reverse</a> || Decision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260adc468760c02910f77bad7525bc66c334">LoopVectorizationCostModel::CM&#95;Widen</a>;</span></CodeLine>
<Link id="l08280" /><CodeLine lineNumber="8280"></CodeLine>
<Link id="l08281" /><CodeLine lineNumber="8281"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ? <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;0&#93; : <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;1&#93;;</span></CodeLine>
<Link id="l08282" /><CodeLine lineNumber="8282"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Consecutive) &#123;</span></CodeLine>
<Link id="l08283" /><CodeLine lineNumber="8283"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(</span></CodeLine>
<Link id="l08284" /><CodeLine lineNumber="8284"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getUnderlyingValue()-&gt;stripPointerCasts());</span></CodeLine>
<Link id="l08285" /><CodeLine lineNumber="8285"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpsingledefrecipe">VPSingleDefRecipe</a> &#42;VectorPtr;</span></CodeLine>
<Link id="l08286" /><CodeLine lineNumber="8286"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a1200affbcdb869bf32076f90ad9d0eafa67f115c1fddc4ce1aeb1c754001585bc">Reverse</a>) &#123;</span></CodeLine>
<Link id="l08287" /><CodeLine lineNumber="8287"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// When folding the tail, we may compute an address that we don&#39;t in the</span></CodeLine>
<Link id="l08288" /><CodeLine lineNumber="8288"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// original scalar loop and it may not be inbounds. Drop Inbounds in that</span></CodeLine>
<Link id="l08289" /><CodeLine lineNumber="8289"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// case.</span></CodeLine>
<Link id="l08290" /><CodeLine lineNumber="8290"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/gepnowrapflags">GEPNoWrapFlags</a> Flags =</span></CodeLine>
<Link id="l08291" /><CodeLine lineNumber="8291"><span class="doxyHighlight">          (CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba">foldTailByMasking</a>() || !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> || !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;isInBounds())</span></CodeLine>
<Link id="l08292" /><CodeLine lineNumber="8292"><span class="doxyHighlight">              ? <a href="/docs/api/classes/llvm/gepnowrapflags/#ad41d3c975038ec4a4fc791601729124e">GEPNoWrapFlags::none</a>()</span></CodeLine>
<Link id="l08293" /><CodeLine lineNumber="8293"><span class="doxyHighlight">              : <a href="/docs/api/classes/llvm/gepnowrapflags">GEPNoWrapFlags</a>::inBounds();</span></CodeLine>
<Link id="l08294" /><CodeLine lineNumber="8294"><span class="doxyHighlight">      VectorPtr = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpreversevectorpointerrecipe">VPReverseVectorPointerRecipe</a>(</span></CodeLine>
<Link id="l08295" /><CodeLine lineNumber="8295"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, &amp;Plan.<a href="/docs/api/classes/llvm/vplan/#a2dffed680cc551f7ac6d92b3cd365d11">getVF</a>(), <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), Flags, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l08296" /><CodeLine lineNumber="8296"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08297" /><CodeLine lineNumber="8297"><span class="doxyHighlight">      VectorPtr = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPVectorPointerRecipe(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>),</span></CodeLine>
<Link id="l08298" /><CodeLine lineNumber="8298"><span class="doxyHighlight">                                            <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> ? <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNoWrapFlags()</span></CodeLine>
<Link id="l08299" /><CodeLine lineNumber="8299"><span class="doxyHighlight">                                                : <a href="/docs/api/classes/llvm/gepnowrapflags/#ad41d3c975038ec4a4fc791601729124e">GEPNoWrapFlags::none</a>(),</span></CodeLine>
<Link id="l08300" /><CodeLine lineNumber="8300"><span class="doxyHighlight">                                            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l08301" /><CodeLine lineNumber="8301"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08302" /><CodeLine lineNumber="8302"><span class="doxyHighlight">    Builder.getInsertBlock()-&gt;appendRecipe(VectorPtr);</span></CodeLine>
<Link id="l08303" /><CodeLine lineNumber="8303"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = VectorPtr;</span></CodeLine>
<Link id="l08304" /><CodeLine lineNumber="8304"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08305" /><CodeLine lineNumber="8305"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LoadInst &#42;Load = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l08306" /><CodeLine lineNumber="8306"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPWidenLoadRecipe(&#42;Load, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, Mask, Consecutive, <a href="/docs/api/namespaces/llvm/#a1200affbcdb869bf32076f90ad9d0eafa67f115c1fddc4ce1aeb1c754001585bc">Reverse</a>,</span></CodeLine>
<Link id="l08307" /><CodeLine lineNumber="8307"><span class="doxyHighlight">                                 <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l08308" /><CodeLine lineNumber="8308"></CodeLine>
<Link id="l08309" /><CodeLine lineNumber="8309"><span class="doxyHighlight">  StoreInst &#42;<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l08310" /><CodeLine lineNumber="8310"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPWidenStoreRecipe(&#42;Store, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;0&#93;, Mask, Consecutive,</span></CodeLine>
<Link id="l08311" /><CodeLine lineNumber="8311"><span class="doxyHighlight">                                <a href="/docs/api/namespaces/llvm/#a1200affbcdb869bf32076f90ad9d0eafa67f115c1fddc4ce1aeb1c754001585bc">Reverse</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l08312" /><CodeLine lineNumber="8312"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08313" /><CodeLine lineNumber="8313"></CodeLine>
<Link id="l08314" /><CodeLine lineNumber="8314"><span class="doxyHighlightComment">/// Creates a VPWidenIntOrFpInductionRecpipe for \\p Phi. If needed, it will also</span></CodeLine>
<Link id="l08315" /><CodeLine lineNumber="8315"><span class="doxyHighlightComment">/// insert a recipe to expand the step for the induction recipe.</span></CodeLine>
<Link id="l08316" /><CodeLine lineNumber="8316"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidenintorfpinductionrecipe">VPWidenIntOrFpInductionRecipe</a> &#42;</span></CodeLine>
<Link id="l08317" /><CodeLine lineNumber="8317" lineLink="#a9336eb7b4fbcee561dbb8c52d9eabe64"><span class="doxyHighlight"><a href="#a9336eb7b4fbcee561dbb8c52d9eabe64">createWidenInductionRecipes</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PhiOrTrunc,</span></CodeLine>
<Link id="l08318" /><CodeLine lineNumber="8318"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Start, </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp;IndDesc,</span></CodeLine>
<Link id="l08319" /><CodeLine lineNumber="8319"><span class="doxyHighlight">                            <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp;OrigLoop) &#123;</span></CodeLine>
<Link id="l08320" /><CodeLine lineNumber="8320"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IndDesc.<a href="/docs/api/classes/llvm/inductiondescriptor/#aea63dae61a488e20e237f5f517ed1491">getStartValue</a>() ==</span></CodeLine>
<Link id="l08321" /><CodeLine lineNumber="8321"><span class="doxyHighlight">         Phi-&gt;getIncomingValueForBlock(OrigLoop.<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>()));</span></CodeLine>
<Link id="l08322" /><CodeLine lineNumber="8322"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SE.<a href="/docs/api/classes/llvm/scalarevolution/#a5a19768af81df7e5fe571bc08dcd48b3">isLoopInvariant</a>(IndDesc.<a href="/docs/api/classes/llvm/inductiondescriptor/#a83b5b65084a0c1de3a76f36f198b1b0c">getStep</a>(), &amp;OrigLoop) &amp;&amp;</span></CodeLine>
<Link id="l08323" /><CodeLine lineNumber="8323"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;step must be loop invariant&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08324" /><CodeLine lineNumber="8324"></CodeLine>
<Link id="l08325" /><CodeLine lineNumber="8325"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Step =</span></CodeLine>
<Link id="l08326" /><CodeLine lineNumber="8326"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/vputils/#a064976a6c7458b10c24021b7334cec2a">vputils::getOrCreateVPValueForSCEVExpr</a>(Plan, IndDesc.<a href="/docs/api/classes/llvm/inductiondescriptor/#a83b5b65084a0c1de3a76f36f198b1b0c">getStep</a>(), SE);</span></CodeLine>
<Link id="l08327" /><CodeLine lineNumber="8327"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;TruncI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;TruncInst&gt;</a>(PhiOrTrunc)) &#123;</span></CodeLine>
<Link id="l08328" /><CodeLine lineNumber="8328"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidenintorfpinductionrecipe">VPWidenIntOrFpInductionRecipe</a>(Phi, Start, Step, &amp;Plan.<a href="/docs/api/classes/llvm/vplan/#a2dffed680cc551f7ac6d92b3cd365d11">getVF</a>(),</span></CodeLine>
<Link id="l08329" /><CodeLine lineNumber="8329"><span class="doxyHighlight">                                             IndDesc, TruncI,</span></CodeLine>
<Link id="l08330" /><CodeLine lineNumber="8330"><span class="doxyHighlight">                                             TruncI-&gt;getDebugLoc());</span></CodeLine>
<Link id="l08331" /><CodeLine lineNumber="8331"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08332" /><CodeLine lineNumber="8332"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(PhiOrTrunc) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;must be a phi node here&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08333" /><CodeLine lineNumber="8333"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidenintorfpinductionrecipe">VPWidenIntOrFpInductionRecipe</a>(Phi, Start, Step, &amp;Plan.<a href="/docs/api/classes/llvm/vplan/#a2dffed680cc551f7ac6d92b3cd365d11">getVF</a>(),</span></CodeLine>
<Link id="l08334" /><CodeLine lineNumber="8334"><span class="doxyHighlight">                                           IndDesc, Phi-&gt;getDebugLoc());</span></CodeLine>
<Link id="l08335" /><CodeLine lineNumber="8335"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08336" /><CodeLine lineNumber="8336"></CodeLine>
<Link id="l08337" /><CodeLine lineNumber="8337"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vpheaderphirecipe">VPHeaderPHIRecipe</a> &#42;VPRecipeBuilder::tryToOptimizeInductionPHI(</span></CodeLine>
<Link id="l08338" /><CodeLine lineNumber="8338"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</span></CodeLine>
<Link id="l08339" /><CodeLine lineNumber="8339"></CodeLine>
<Link id="l08340" /><CodeLine lineNumber="8340"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if this is an integer or fp induction. If so, build the recipe that</span></CodeLine>
<Link id="l08341" /><CodeLine lineNumber="8341"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// produces its scalar and vector values.</span></CodeLine>
<Link id="l08342" /><CodeLine lineNumber="8342"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = Legal-&gt;getIntOrFpInductionDescriptor(Phi))</span></CodeLine>
<Link id="l08343" /><CodeLine lineNumber="8343"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a9336eb7b4fbcee561dbb8c52d9eabe64">createWidenInductionRecipes</a>(Phi, Phi, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;0&#93;, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, Plan,</span></CodeLine>
<Link id="l08344" /><CodeLine lineNumber="8344"><span class="doxyHighlight">                                       &#42;PSE.getSE(), &#42;OrigLoop);</span></CodeLine>
<Link id="l08345" /><CodeLine lineNumber="8345"></CodeLine>
<Link id="l08346" /><CodeLine lineNumber="8346"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if this is pointer induction. If so, build the recipe for it.</span></CodeLine>
<Link id="l08347" /><CodeLine lineNumber="8347"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = Legal-&gt;getPointerInductionDescriptor(Phi)) &#123;</span></CodeLine>
<Link id="l08348" /><CodeLine lineNumber="8348"><span class="doxyHighlight">    VPValue &#42;Step = <a href="/docs/api/namespaces/llvm/vputils/#a064976a6c7458b10c24021b7334cec2a">vputils::getOrCreateVPValueForSCEVExpr</a>(Plan, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getStep(),</span></CodeLine>
<Link id="l08349" /><CodeLine lineNumber="8349"><span class="doxyHighlight">                                                           &#42;PSE.getSE());</span></CodeLine>
<Link id="l08350" /><CodeLine lineNumber="8350"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPWidenPointerInductionRecipe(</span></CodeLine>
<Link id="l08351" /><CodeLine lineNumber="8351"><span class="doxyHighlight">        Phi, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;0&#93;, Step, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>,</span></CodeLine>
<Link id="l08352" /><CodeLine lineNumber="8352"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</span></CodeLine>
<Link id="l08353" /><CodeLine lineNumber="8353"><span class="doxyHighlight">            &#91;&amp;&#93;(ElementCount VF) &#123;</span></CodeLine>
<Link id="l08354" /><CodeLine lineNumber="8354"><span class="doxyHighlight">              </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CM.isScalarAfterVectorization(Phi, VF);</span></CodeLine>
<Link id="l08355" /><CodeLine lineNumber="8355"><span class="doxyHighlight">            &#125;,</span></CodeLine>
<Link id="l08356" /><CodeLine lineNumber="8356"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>),</span></CodeLine>
<Link id="l08357" /><CodeLine lineNumber="8357"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l08358" /><CodeLine lineNumber="8358"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08359" /><CodeLine lineNumber="8359"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08360" /><CodeLine lineNumber="8360"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08361" /><CodeLine lineNumber="8361"></CodeLine>
<Link id="l08362" /><CodeLine lineNumber="8362"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vpwidenintorfpinductionrecipe">VPWidenIntOrFpInductionRecipe</a> &#42;VPRecipeBuilder::tryToOptimizeInductionTruncate(</span></CodeLine>
<Link id="l08363" /><CodeLine lineNumber="8363"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/truncinst">TruncInst</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</span></CodeLine>
<Link id="l08364" /><CodeLine lineNumber="8364"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Optimize the special case where the source is a constant integer</span></CodeLine>
<Link id="l08365" /><CodeLine lineNumber="8365"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// induction variable. Notice that we can only optimize the &#39;trunc&#39; case</span></CodeLine>
<Link id="l08366" /><CodeLine lineNumber="8366"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// because (a) FP conversions lose precision, (b) sext/zext may wrap, and</span></CodeLine>
<Link id="l08367" /><CodeLine lineNumber="8367"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (c) other casts depend on pointer size.</span></CodeLine>
<Link id="l08368" /><CodeLine lineNumber="8368"></CodeLine>
<Link id="l08369" /><CodeLine lineNumber="8369"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Determine whether \\p K is a truncation based on an induction variable that</span></CodeLine>
<Link id="l08370" /><CodeLine lineNumber="8370"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can be optimized.</span></CodeLine>
<Link id="l08371" /><CodeLine lineNumber="8371"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> IsOptimizableIVTruncate =</span></CodeLine>
<Link id="l08372" /><CodeLine lineNumber="8372"><span class="doxyHighlight">      &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38eaa5f3c6a11b03839d46af9fb43c97c188">K</a>) -&gt; std::function&lt;</span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight">(ElementCount)&gt; &#123;</span></CodeLine>
<Link id="l08373" /><CodeLine lineNumber="8373"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> &#91;=&#93;(ElementCount VF) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08374" /><CodeLine lineNumber="8374"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CM.isOptimizableIVTruncate(K, VF);</span></CodeLine>
<Link id="l08375" /><CodeLine lineNumber="8375"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l08376" /><CodeLine lineNumber="8376"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l08377" /><CodeLine lineNumber="8377"></CodeLine>
<Link id="l08378" /><CodeLine lineNumber="8378"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</span></CodeLine>
<Link id="l08379" /><CodeLine lineNumber="8379"><span class="doxyHighlight">          IsOptimizableIVTruncate(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)) &#123;</span></CodeLine>
<Link id="l08380" /><CodeLine lineNumber="8380"></CodeLine>
<Link id="l08381" /><CodeLine lineNumber="8381"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</span></CodeLine>
<Link id="l08382" /><CodeLine lineNumber="8382"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> InductionDescriptor &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = &#42;Legal-&gt;getIntOrFpInductionDescriptor(Phi);</span></CodeLine>
<Link id="l08383" /><CodeLine lineNumber="8383"><span class="doxyHighlight">    VPValue &#42;<a href="/docs/api/namespaces/llvm/memprof/#abee3ddc7c6eb611a3b96fb69489c81caaa6122a65eaa676f700ae68d393054a37">Start</a> = Plan.getOrAddLiveIn(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getStartValue());</span></CodeLine>
<Link id="l08384" /><CodeLine lineNumber="8384"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#a9336eb7b4fbcee561dbb8c52d9eabe64">createWidenInductionRecipes</a>(Phi, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Start, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, Plan, &#42;PSE.getSE(),</span></CodeLine>
<Link id="l08385" /><CodeLine lineNumber="8385"><span class="doxyHighlight">                                       &#42;OrigLoop);</span></CodeLine>
<Link id="l08386" /><CodeLine lineNumber="8386"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08387" /><CodeLine lineNumber="8387"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08388" /><CodeLine lineNumber="8388"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08389" /><CodeLine lineNumber="8389"></CodeLine>
<Link id="l08390" /><CodeLine lineNumber="8390"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vpblendrecipe">VPBlendRecipe</a> &#42;VPRecipeBuilder::tryToBlend(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi,</span></CodeLine>
<Link id="l08391" /><CodeLine lineNumber="8391"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>) &#123;</span></CodeLine>
<Link id="l08392" /><CodeLine lineNumber="8392"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> NumIncoming = <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getNumIncomingValues();</span></CodeLine>
<Link id="l08393" /><CodeLine lineNumber="8393"></CodeLine>
<Link id="l08394" /><CodeLine lineNumber="8394"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// We know that all PHIs in non-header blocks are converted into selects, so</span></CodeLine>
<Link id="l08395" /><CodeLine lineNumber="8395"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// we don&#39;t have to worry about the insertion order and we can just use the</span></CodeLine>
<Link id="l08396" /><CodeLine lineNumber="8396"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// builder. At this point we generate the predication tree. There may be</span></CodeLine>
<Link id="l08397" /><CodeLine lineNumber="8397"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// duplications since this is a simple recursive scan, but future</span></CodeLine>
<Link id="l08398" /><CodeLine lineNumber="8398"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optimizations will clean it up.</span></CodeLine>
<Link id="l08399" /><CodeLine lineNumber="8399"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;VPValue &#42;, 2&gt;</a> OperandsWithMask;</span></CodeLine>
<Link id="l08400" /><CodeLine lineNumber="8400"></CodeLine>
<Link id="l08401" /><CodeLine lineNumber="8401"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> In = 0; <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a> &lt; NumIncoming; <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>++) &#123;</span></CodeLine>
<Link id="l08402" /><CodeLine lineNumber="8402"><span class="doxyHighlight">    OperandsWithMask.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;In&#93;);</span></CodeLine>
<Link id="l08403" /><CodeLine lineNumber="8403"><span class="doxyHighlight">    VPValue &#42;EdgeMask =</span></CodeLine>
<Link id="l08404" /><CodeLine lineNumber="8404"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vprecipebuilder/#a4a24061cba79c1c33396b71076a7379e">getEdgeMask</a>(<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIncomingBlock(In), <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getParent());</span></CodeLine>
<Link id="l08405" /><CodeLine lineNumber="8405"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!EdgeMask) &#123;</span></CodeLine>
<Link id="l08406" /><CodeLine lineNumber="8406"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(In == 0 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Both null and non-null edge masks found&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08407" /><CodeLine lineNumber="8407"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ad78da75bd1f157e72100f97d1ecdc756">all&#95;equal</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>) &amp;&amp;</span></CodeLine>
<Link id="l08408" /><CodeLine lineNumber="8408"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Distinct incoming values with one having a full mask&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08409" /><CodeLine lineNumber="8409"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08410" /><CodeLine lineNumber="8410"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08411" /><CodeLine lineNumber="8411"><span class="doxyHighlight">    OperandsWithMask.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(EdgeMask);</span></CodeLine>
<Link id="l08412" /><CodeLine lineNumber="8412"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08413" /><CodeLine lineNumber="8413"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPBlendRecipe(Phi, OperandsWithMask);</span></CodeLine>
<Link id="l08414" /><CodeLine lineNumber="8414"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08415" /><CodeLine lineNumber="8415"></CodeLine>
<Link id="l08416" /><CodeLine lineNumber="8416"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vpsingledefrecipe">VPSingleDefRecipe</a> &#42;VPRecipeBuilder::tryToWidenCall(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI,</span></CodeLine>
<Link id="l08417" /><CodeLine lineNumber="8417"><span class="doxyHighlight">                                                   <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>,</span></CodeLine>
<Link id="l08418" /><CodeLine lineNumber="8418"><span class="doxyHighlight">                                                   <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</span></CodeLine>
<Link id="l08419" /><CodeLine lineNumber="8419"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsPredicated = <a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</span></CodeLine>
<Link id="l08420" /><CodeLine lineNumber="8420"><span class="doxyHighlight">      &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, CI&#93;(ElementCount VF) &#123;</span></CodeLine>
<Link id="l08421" /><CodeLine lineNumber="8421"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CM.isScalarWithPredication(CI, VF);</span></CodeLine>
<Link id="l08422" /><CodeLine lineNumber="8422"><span class="doxyHighlight">      &#125;,</span></CodeLine>
<Link id="l08423" /><CodeLine lineNumber="8423"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</span></CodeLine>
<Link id="l08424" /><CodeLine lineNumber="8424"></CodeLine>
<Link id="l08425" /><CodeLine lineNumber="8425"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsPredicated)</span></CodeLine>
<Link id="l08426" /><CodeLine lineNumber="8426"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08427" /><CodeLine lineNumber="8427"></CodeLine>
<Link id="l08428" /><CodeLine lineNumber="8428"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> = <a href="/docs/api/namespaces/llvm/#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, TLI);</span></CodeLine>
<Link id="l08429" /><CodeLine lineNumber="8429"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> &amp;&amp; (<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> == Intrinsic::assume || <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> == Intrinsic::lifetime&#95;end ||</span></CodeLine>
<Link id="l08430" /><CodeLine lineNumber="8430"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> == Intrinsic::lifetime&#95;start || <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> == Intrinsic::sideeffect ||</span></CodeLine>
<Link id="l08431" /><CodeLine lineNumber="8431"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> == Intrinsic::pseudoprobe ||</span></CodeLine>
<Link id="l08432" /><CodeLine lineNumber="8432"><span class="doxyHighlight">             <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> == Intrinsic::experimental&#95;noalias&#95;scope&#95;decl))</span></CodeLine>
<Link id="l08433" /><CodeLine lineNumber="8433"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08434" /><CodeLine lineNumber="8434"></CodeLine>
<Link id="l08435" /><CodeLine lineNumber="8435"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;VPValue &#42;, 4&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.take&#95;front(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#adde2ea00dd2613ee41bfe91908e4e68e">arg&#95;size</a>()));</span></CodeLine>
<Link id="l08436" /><CodeLine lineNumber="8436"></CodeLine>
<Link id="l08437" /><CodeLine lineNumber="8437"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Is it beneficial to perform intrinsic call compared to lib call?</span></CodeLine>
<Link id="l08438" /><CodeLine lineNumber="8438"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ShouldUseVectorIntrinsic =</span></CodeLine>
<Link id="l08439" /><CodeLine lineNumber="8439"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</span></CodeLine>
<Link id="l08440" /><CodeLine lineNumber="8440"><span class="doxyHighlight">                &#91;&amp;&#93;(ElementCount VF) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08441" /><CodeLine lineNumber="8441"><span class="doxyHighlight">                  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CM.getCallWideningDecision(CI, VF).Kind ==</span></CodeLine>
<Link id="l08442" /><CodeLine lineNumber="8442"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a679b46cebdf2f87b9efd0413c960314a">LoopVectorizationCostModel::CM&#95;IntrinsicCall</a>;</span></CodeLine>
<Link id="l08443" /><CodeLine lineNumber="8443"><span class="doxyHighlight">                &#125;,</span></CodeLine>
<Link id="l08444" /><CodeLine lineNumber="8444"><span class="doxyHighlight">                <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</span></CodeLine>
<Link id="l08445" /><CodeLine lineNumber="8445"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShouldUseVectorIntrinsic)</span></CodeLine>
<Link id="l08446" /><CodeLine lineNumber="8446"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPWidenIntrinsicRecipe(&#42;CI, <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l08447" /><CodeLine lineNumber="8447"><span class="doxyHighlight">                                      CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l08448" /><CodeLine lineNumber="8448"></CodeLine>
<Link id="l08449" /><CodeLine lineNumber="8449"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;<a href="/docs/api/namespaces/llvm/loc/#aa1fa35229c3ab492b9ea826366f68350">Variant</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08450" /><CodeLine lineNumber="8450"><span class="doxyHighlight">  std::optional&lt;unsigned&gt; MaskPos;</span></CodeLine>
<Link id="l08451" /><CodeLine lineNumber="8451"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Is better to call a vectorized version of the function than to to scalarize</span></CodeLine>
<Link id="l08452" /><CodeLine lineNumber="8452"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the call?</span></CodeLine>
<Link id="l08453" /><CodeLine lineNumber="8453"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ShouldUseVectorCall = <a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</span></CodeLine>
<Link id="l08454" /><CodeLine lineNumber="8454"><span class="doxyHighlight">      &#91;&amp;&#93;(ElementCount VF) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08455" /><CodeLine lineNumber="8455"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The following case may be scalarized depending on the VF.</span></CodeLine>
<Link id="l08456" /><CodeLine lineNumber="8456"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The flag shows whether we can use a usual Call for vectorized</span></CodeLine>
<Link id="l08457" /><CodeLine lineNumber="8457"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// version of the instruction.</span></CodeLine>
<Link id="l08458" /><CodeLine lineNumber="8458"></CodeLine>
<Link id="l08459" /><CodeLine lineNumber="8459"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If we&#39;ve found a variant at a previous VF, then stop looking. A</span></CodeLine>
<Link id="l08460" /><CodeLine lineNumber="8460"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// vectorized variant of a function expects input in a certain shape</span></CodeLine>
<Link id="l08461" /><CodeLine lineNumber="8461"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// -- basically the number of input registers, the number of lanes</span></CodeLine>
<Link id="l08462" /><CodeLine lineNumber="8462"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// per register, and whether there&#39;s a mask required.</span></CodeLine>
<Link id="l08463" /><CodeLine lineNumber="8463"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// We store a pointer to the variant in the VPWidenCallRecipe, so</span></CodeLine>
<Link id="l08464" /><CodeLine lineNumber="8464"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// once we have an appropriate variant it&#39;s only valid for that VF.</span></CodeLine>
<Link id="l08465" /><CodeLine lineNumber="8465"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// This will force a different vplan to be generated for each VF that</span></CodeLine>
<Link id="l08466" /><CodeLine lineNumber="8466"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// finds a valid variant.</span></CodeLine>
<Link id="l08467" /><CodeLine lineNumber="8467"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Variant)</span></CodeLine>
<Link id="l08468" /><CodeLine lineNumber="8468"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08469" /><CodeLine lineNumber="8469"><span class="doxyHighlight">        LoopVectorizationCostModel::CallWideningDecision Decision =</span></CodeLine>
<Link id="l08470" /><CodeLine lineNumber="8470"><span class="doxyHighlight">            CM.getCallWideningDecision(CI, VF);</span></CodeLine>
<Link id="l08471" /><CodeLine lineNumber="8471"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Decision.<a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a970379530706280ef592e3e752195707">Kind</a> == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ab6fd5f45ab6e363de6c3f42472d439ac">LoopVectorizationCostModel::CM&#95;VectorCall</a>) &#123;</span></CodeLine>
<Link id="l08472" /><CodeLine lineNumber="8472"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/loc/#aa1fa35229c3ab492b9ea826366f68350">Variant</a> = Decision.<a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a7d0c66f91e19821438f6111292e4988a">Variant</a>;</span></CodeLine>
<Link id="l08473" /><CodeLine lineNumber="8473"><span class="doxyHighlight">          MaskPos = Decision.<a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#acf57054d7a0afa002650a5f94c4a7432">MaskPos</a>;</span></CodeLine>
<Link id="l08474" /><CodeLine lineNumber="8474"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08475" /><CodeLine lineNumber="8475"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l08476" /><CodeLine lineNumber="8476"></CodeLine>
<Link id="l08477" /><CodeLine lineNumber="8477"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08478" /><CodeLine lineNumber="8478"><span class="doxyHighlight">      &#125;,</span></CodeLine>
<Link id="l08479" /><CodeLine lineNumber="8479"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</span></CodeLine>
<Link id="l08480" /><CodeLine lineNumber="8480"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ShouldUseVectorCall) &#123;</span></CodeLine>
<Link id="l08481" /><CodeLine lineNumber="8481"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MaskPos.has&#95;value()) &#123;</span></CodeLine>
<Link id="l08482" /><CodeLine lineNumber="8482"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// We have 2 cases that would require a mask:</span></CodeLine>
<Link id="l08483" /><CodeLine lineNumber="8483"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   1) The block needs to be predicated, either due to a conditional</span></CodeLine>
<Link id="l08484" /><CodeLine lineNumber="8484"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//      in the scalar loop or use of an active lane mask with</span></CodeLine>
<Link id="l08485" /><CodeLine lineNumber="8485"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//      tail-folding, and we use the appropriate mask for the block.</span></CodeLine>
<Link id="l08486" /><CodeLine lineNumber="8486"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   2) No mask is required for the block, but the only available</span></CodeLine>
<Link id="l08487" /><CodeLine lineNumber="8487"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//      vector variant at this VF requires a mask, so we synthesize an</span></CodeLine>
<Link id="l08488" /><CodeLine lineNumber="8488"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//      all-true mask.</span></CodeLine>
<Link id="l08489" /><CodeLine lineNumber="8489"><span class="doxyHighlight">      VPValue &#42;<a href="/docs/api/namespaces/llvm/bitmaskenumdetail/#a4562904154aff9698a612bc7f6086a4c">Mask</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08490" /><CodeLine lineNumber="8490"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Legal-&gt;isMaskRequired(CI))</span></CodeLine>
<Link id="l08491" /><CodeLine lineNumber="8491"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/bitmaskenumdetail/#a4562904154aff9698a612bc7f6086a4c">Mask</a> = <a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(CI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</span></CodeLine>
<Link id="l08492" /><CodeLine lineNumber="8492"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l08493" /><CodeLine lineNumber="8493"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/bitmaskenumdetail/#a4562904154aff9698a612bc7f6086a4c">Mask</a> = Plan.getOrAddLiveIn(</span></CodeLine>
<Link id="l08494" /><CodeLine lineNumber="8494"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">IntegerType::getInt1Ty</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>())));</span></CodeLine>
<Link id="l08495" /><CodeLine lineNumber="8495"></CodeLine>
<Link id="l08496" /><CodeLine lineNumber="8496"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.insert(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.begin() + &#42;MaskPos, Mask);</span></CodeLine>
<Link id="l08497" /><CodeLine lineNumber="8497"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08498" /><CodeLine lineNumber="8498"></CodeLine>
<Link id="l08499" /><CodeLine lineNumber="8499"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.back());</span></CodeLine>
<Link id="l08500" /><CodeLine lineNumber="8500"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPWidenCallRecipe(CI, Variant, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l08501" /><CodeLine lineNumber="8501"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08502" /><CodeLine lineNumber="8502"></CodeLine>
<Link id="l08503" /><CodeLine lineNumber="8503"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08504" /><CodeLine lineNumber="8504"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08505" /><CodeLine lineNumber="8505"></CodeLine>
<Link id="l08506" /><CodeLine lineNumber="8506"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> VPRecipeBuilder::shouldWiden(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)</span><span class="doxyHighlightKeyword"> const </span><span class="doxyHighlight">&#123;</span></CodeLine>
<Link id="l08507" /><CodeLine lineNumber="8507"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</span></CodeLine>
<Link id="l08508" /><CodeLine lineNumber="8508"><span class="doxyHighlight">         !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Instruction should have been handled earlier&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08509" /><CodeLine lineNumber="8509"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Instruction should be widened, unless it is scalar after vectorization,</span></CodeLine>
<Link id="l08510" /><CodeLine lineNumber="8510"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// scalarization is profitable or it is predicated.</span></CodeLine>
<Link id="l08511" /><CodeLine lineNumber="8511"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> WillScalarize = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;(ElementCount VF) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08512" /><CodeLine lineNumber="8512"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CM.isScalarAfterVectorization(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) ||</span></CodeLine>
<Link id="l08513" /><CodeLine lineNumber="8513"><span class="doxyHighlight">           CM.isProfitableToScalarize(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) ||</span></CodeLine>
<Link id="l08514" /><CodeLine lineNumber="8514"><span class="doxyHighlight">           CM.isScalarWithPredication(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</span></CodeLine>
<Link id="l08515" /><CodeLine lineNumber="8515"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l08516" /><CodeLine lineNumber="8516"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !<a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(WillScalarize,</span></CodeLine>
<Link id="l08517" /><CodeLine lineNumber="8517"><span class="doxyHighlight">                                                             <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</span></CodeLine>
<Link id="l08518" /><CodeLine lineNumber="8518"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08519" /><CodeLine lineNumber="8519"></CodeLine>
<Link id="l08520" /><CodeLine lineNumber="8520"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vpwidenrecipe">VPWidenRecipe</a> &#42;VPRecipeBuilder::tryToWiden(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l08521" /><CodeLine lineNumber="8521"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>,</span></CodeLine>
<Link id="l08522" /><CodeLine lineNumber="8522"><span class="doxyHighlight">                                           <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB) &#123;</span></CodeLine>
<Link id="l08523" /><CodeLine lineNumber="8523"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</span></CodeLine>
<Link id="l08524" /><CodeLine lineNumber="8524"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l08525" /><CodeLine lineNumber="8525"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08526" /><CodeLine lineNumber="8526"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SDiv:</span></CodeLine>
<Link id="l08527" /><CodeLine lineNumber="8527"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::UDiv:</span></CodeLine>
<Link id="l08528" /><CodeLine lineNumber="8528"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::SRem:</span></CodeLine>
<Link id="l08529" /><CodeLine lineNumber="8529"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::URem: &#123;</span></CodeLine>
<Link id="l08530" /><CodeLine lineNumber="8530"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If not provably safe, use a select to form a safe divisor before widening the</span></CodeLine>
<Link id="l08531" /><CodeLine lineNumber="8531"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// div/rem operation itself.  Otherwise fall through to general handling below.</span></CodeLine>
<Link id="l08532" /><CodeLine lineNumber="8532"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CM.isPredicatedInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l08533" /><CodeLine lineNumber="8533"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>);</span></CodeLine>
<Link id="l08534" /><CodeLine lineNumber="8534"><span class="doxyHighlight">      VPValue &#42;<a href="/docs/api/namespaces/llvm/bitmaskenumdetail/#a4562904154aff9698a612bc7f6086a4c">Mask</a> = <a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</span></CodeLine>
<Link id="l08535" /><CodeLine lineNumber="8535"><span class="doxyHighlight">      VPValue &#42;One =</span></CodeLine>
<Link id="l08536" /><CodeLine lineNumber="8536"><span class="doxyHighlight">          Plan.getOrAddLiveIn(ConstantInt::get(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), 1u, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">));</span></CodeLine>
<Link id="l08537" /><CodeLine lineNumber="8537"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;SafeRHS = Builder.createSelect(Mask, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;1&#93;, One, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</span></CodeLine>
<Link id="l08538" /><CodeLine lineNumber="8538"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;1&#93; = SafeRHS;</span></CodeLine>
<Link id="l08539" /><CodeLine lineNumber="8539"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPWidenRecipe(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.begin(), <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.end()));</span></CodeLine>
<Link id="l08540" /><CodeLine lineNumber="8540"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08541" /><CodeLine lineNumber="8541"><span class="doxyHighlight">    &#91;&#91;fallthrough&#93;&#93;;</span></CodeLine>
<Link id="l08542" /><CodeLine lineNumber="8542"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08543" /><CodeLine lineNumber="8543"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Add:</span></CodeLine>
<Link id="l08544" /><CodeLine lineNumber="8544"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::And:</span></CodeLine>
<Link id="l08545" /><CodeLine lineNumber="8545"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::AShr:</span></CodeLine>
<Link id="l08546" /><CodeLine lineNumber="8546"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FAdd:</span></CodeLine>
<Link id="l08547" /><CodeLine lineNumber="8547"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FCmp:</span></CodeLine>
<Link id="l08548" /><CodeLine lineNumber="8548"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FDiv:</span></CodeLine>
<Link id="l08549" /><CodeLine lineNumber="8549"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FMul:</span></CodeLine>
<Link id="l08550" /><CodeLine lineNumber="8550"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FNeg:</span></CodeLine>
<Link id="l08551" /><CodeLine lineNumber="8551"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FRem:</span></CodeLine>
<Link id="l08552" /><CodeLine lineNumber="8552"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::FSub:</span></CodeLine>
<Link id="l08553" /><CodeLine lineNumber="8553"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::ICmp:</span></CodeLine>
<Link id="l08554" /><CodeLine lineNumber="8554"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::LShr:</span></CodeLine>
<Link id="l08555" /><CodeLine lineNumber="8555"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Mul:</span></CodeLine>
<Link id="l08556" /><CodeLine lineNumber="8556"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Or:</span></CodeLine>
<Link id="l08557" /><CodeLine lineNumber="8557"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Select:</span></CodeLine>
<Link id="l08558" /><CodeLine lineNumber="8558"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Shl:</span></CodeLine>
<Link id="l08559" /><CodeLine lineNumber="8559"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Sub:</span></CodeLine>
<Link id="l08560" /><CodeLine lineNumber="8560"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Xor:</span></CodeLine>
<Link id="l08561" /><CodeLine lineNumber="8561"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Instruction::Freeze:</span></CodeLine>
<Link id="l08562" /><CodeLine lineNumber="8562"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;VPValue &#42;&gt;</a> NewOps(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>);</span></CodeLine>
<Link id="l08563" /><CodeLine lineNumber="8563"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction/#a5c88132322ca3f46f242f7c023a57010">Instruction::isBinaryOp</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode())) &#123;</span></CodeLine>
<Link id="l08564" /><CodeLine lineNumber="8564"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The legacy cost model uses SCEV to check if some of the operands are</span></CodeLine>
<Link id="l08565" /><CodeLine lineNumber="8565"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// constants. To match the legacy cost model&#39;s behavior, use SCEV to try</span></CodeLine>
<Link id="l08566" /><CodeLine lineNumber="8566"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// to replace operands with constants.</span></CodeLine>
<Link id="l08567" /><CodeLine lineNumber="8567"><span class="doxyHighlight">      ScalarEvolution &amp;SE = &#42;PSE.getSE();</span></CodeLine>
<Link id="l08568" /><CodeLine lineNumber="8568"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> GetConstantViaSCEV = &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, &amp;SE&#93;(VPValue &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123;</span></CodeLine>
<Link id="l08569" /><CodeLine lineNumber="8569"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;isLiveIn())</span></CodeLine>
<Link id="l08570" /><CodeLine lineNumber="8570"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>;</span></CodeLine>
<Link id="l08571" /><CodeLine lineNumber="8571"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getUnderlyingValue();</span></CodeLine>
<Link id="l08572" /><CodeLine lineNumber="8572"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V) || !SE.<a href="/docs/api/classes/llvm/scalarevolution/#a6d8769a72303e2b06ef63129cb231855">isSCEVable</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()))</span></CodeLine>
<Link id="l08573" /><CodeLine lineNumber="8573"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>;</span></CodeLine>
<Link id="l08574" /><CodeLine lineNumber="8574"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(SE.<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(V));</span></CodeLine>
<Link id="l08575" /><CodeLine lineNumber="8575"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)</span></CodeLine>
<Link id="l08576" /><CodeLine lineNumber="8576"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>;</span></CodeLine>
<Link id="l08577" /><CodeLine lineNumber="8577"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Plan.getOrAddLiveIn(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getValue());</span></CodeLine>
<Link id="l08578" /><CodeLine lineNumber="8578"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l08579" /><CodeLine lineNumber="8579"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For Mul, the legacy cost model checks both operands.</span></CodeLine>
<Link id="l08580" /><CodeLine lineNumber="8580"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::Mul)</span></CodeLine>
<Link id="l08581" /><CodeLine lineNumber="8581"><span class="doxyHighlight">        NewOps&#91;0&#93; = GetConstantViaSCEV(NewOps&#91;0&#93;);</span></CodeLine>
<Link id="l08582" /><CodeLine lineNumber="8582"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For other binops, the legacy cost model only checks the second operand.</span></CodeLine>
<Link id="l08583" /><CodeLine lineNumber="8583"><span class="doxyHighlight">      NewOps&#91;1&#93; = GetConstantViaSCEV(NewOps&#91;1&#93;);</span></CodeLine>
<Link id="l08584" /><CodeLine lineNumber="8584"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08585" /><CodeLine lineNumber="8585"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPWidenRecipe(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(NewOps.begin(), NewOps.end()));</span></CodeLine>
<Link id="l08586" /><CodeLine lineNumber="8586"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l08587" /><CodeLine lineNumber="8587"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08588" /><CodeLine lineNumber="8588"></CodeLine>
<Link id="l08589" /><CodeLine lineNumber="8589"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vphistogramrecipe">VPHistogramRecipe</a> &#42;</span></CodeLine>
<Link id="l08590" /><CodeLine lineNumber="8590"><span class="doxyHighlight">VPRecipeBuilder::tryToWidenHistogram(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/histograminfo">HistogramInfo</a> &#42;HI,</span></CodeLine>
<Link id="l08591" /><CodeLine lineNumber="8591"><span class="doxyHighlight">                                     <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>) &#123;</span></CodeLine>
<Link id="l08592" /><CodeLine lineNumber="8592"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Support other operations.</span></CodeLine>
<Link id="l08593" /><CodeLine lineNumber="8593"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Opcode = <a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28aa5506efe3dc67f7b794331f0cbffddaf">HI</a>-&gt;Update-&gt;getOpcode();</span></CodeLine>
<Link id="l08594" /><CodeLine lineNumber="8594"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Opcode == Instruction::Add || Opcode == Instruction::Sub) &amp;&amp;</span></CodeLine>
<Link id="l08595" /><CodeLine lineNumber="8595"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Histogram update operation must be an Add or Sub&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08596" /><CodeLine lineNumber="8596"></CodeLine>
<Link id="l08597" /><CodeLine lineNumber="8597"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;VPValue &#42;, 3&gt;</a> HGramOps;</span></CodeLine>
<Link id="l08598" /><CodeLine lineNumber="8598"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Bucket address.</span></CodeLine>
<Link id="l08599" /><CodeLine lineNumber="8599"><span class="doxyHighlight">  HGramOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;1&#93;);</span></CodeLine>
<Link id="l08600" /><CodeLine lineNumber="8600"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Increment value.</span></CodeLine>
<Link id="l08601" /><CodeLine lineNumber="8601"><span class="doxyHighlight">  HGramOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(<a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28aa5506efe3dc67f7b794331f0cbffddaf">HI</a>-&gt;Update-&gt;getOperand(1)));</span></CodeLine>
<Link id="l08602" /><CodeLine lineNumber="8602"></CodeLine>
<Link id="l08603" /><CodeLine lineNumber="8603"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// In case of predicated execution (due to tail-folding, or conditional</span></CodeLine>
<Link id="l08604" /><CodeLine lineNumber="8604"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// execution, or both), pass the relevant mask.</span></CodeLine>
<Link id="l08605" /><CodeLine lineNumber="8605"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Legal-&gt;isMaskRequired(<a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28aa5506efe3dc67f7b794331f0cbffddaf">HI</a>-&gt;Store))</span></CodeLine>
<Link id="l08606" /><CodeLine lineNumber="8606"><span class="doxyHighlight">    HGramOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(<a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28aa5506efe3dc67f7b794331f0cbffddaf">HI</a>-&gt;Store-&gt;getParent()));</span></CodeLine>
<Link id="l08607" /><CodeLine lineNumber="8607"></CodeLine>
<Link id="l08608" /><CodeLine lineNumber="8608"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPHistogramRecipe(Opcode,</span></CodeLine>
<Link id="l08609" /><CodeLine lineNumber="8609"><span class="doxyHighlight">                               <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(HGramOps.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), HGramOps.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>()),</span></CodeLine>
<Link id="l08610" /><CodeLine lineNumber="8610"><span class="doxyHighlight">                               <a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28aa5506efe3dc67f7b794331f0cbffddaf">HI</a>-&gt;Store-&gt;getDebugLoc());</span></CodeLine>
<Link id="l08611" /><CodeLine lineNumber="8611"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08612" /><CodeLine lineNumber="8612"></CodeLine>
<Link id="l08613" /><CodeLine lineNumber="8613" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a6d8fbabf45554d7d598dc8eb4eca41cf"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vprecipebuilder/#a6d8fbabf45554d7d598dc8eb4eca41cf">VPRecipeBuilder::fixHeaderPhis</a>() &#123;</span></CodeLine>
<Link id="l08614" /><CodeLine lineNumber="8614"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OrigLatch = OrigLoop-&gt;getLoopLatch();</span></CodeLine>
<Link id="l08615" /><CodeLine lineNumber="8615"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpheaderphirecipe">VPHeaderPHIRecipe</a> &#42;R : PhisToFix) &#123;</span></CodeLine>
<Link id="l08616" /><CodeLine lineNumber="8616"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(R-&gt;getUnderlyingValue());</span></CodeLine>
<Link id="l08617" /><CodeLine lineNumber="8617"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;IncR =</span></CodeLine>
<Link id="l08618" /><CodeLine lineNumber="8618"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vprecipebuilder/#af5f874dc688e86699e648825bfcbf495">getRecipe</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(PN-&gt;getIncomingValueForBlock(OrigLatch)));</span></CodeLine>
<Link id="l08619" /><CodeLine lineNumber="8619"><span class="doxyHighlight">    R-&gt;addOperand(IncR-&gt;<a href="/docs/api/classes/llvm/vpdef/#a76a983b694720483a3dd9fe57314e39b">getVPSingleValue</a>());</span></CodeLine>
<Link id="l08620" /><CodeLine lineNumber="8620"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08621" /><CodeLine lineNumber="8621"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08622" /><CodeLine lineNumber="8622"></CodeLine>
<Link id="l08623" /><CodeLine lineNumber="8623" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a2c36c7d44a38145e7c72340d1b0e34d8"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a> &#42;<a href="/docs/api/classes/llvm/vprecipebuilder/#a2c36c7d44a38145e7c72340d1b0e34d8">VPRecipeBuilder::handleReplication</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</span></CodeLine>
<Link id="l08624" /><CodeLine lineNumber="8624"><span class="doxyHighlight">                                                      <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</span></CodeLine>
<Link id="l08625" /><CodeLine lineNumber="8625"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsUniform = <a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</span></CodeLine>
<Link id="l08626" /><CodeLine lineNumber="8626"><span class="doxyHighlight">      &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> CM.isUniformAfterVectorization(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF); &#125;,</span></CodeLine>
<Link id="l08627" /><CodeLine lineNumber="8627"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</span></CodeLine>
<Link id="l08628" /><CodeLine lineNumber="8628"></CodeLine>
<Link id="l08629" /><CodeLine lineNumber="8629"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsPredicated = CM.isPredicatedInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</span></CodeLine>
<Link id="l08630" /><CodeLine lineNumber="8630"></CodeLine>
<Link id="l08631" /><CodeLine lineNumber="8631"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Even if the instruction is not marked as uniform, there are certain</span></CodeLine>
<Link id="l08632" /><CodeLine lineNumber="8632"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// intrinsic calls that can be effectively treated as such, so we check for</span></CodeLine>
<Link id="l08633" /><CodeLine lineNumber="8633"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// them here. Conservatively, we only do this for scalable vectors, since</span></CodeLine>
<Link id="l08634" /><CodeLine lineNumber="8634"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for fixed-width VFs we can always fall back on full scalarization.</span></CodeLine>
<Link id="l08635" /><CodeLine lineNumber="8635"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsUniform &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>.Start.isScalable() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</span></CodeLine>
<Link id="l08636" /><CodeLine lineNumber="8636"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a62766c75f88612ffa652342472e755f6">getIntrinsicID</a>()) &#123;</span></CodeLine>
<Link id="l08637" /><CodeLine lineNumber="8637"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::assume:</span></CodeLine>
<Link id="l08638" /><CodeLine lineNumber="8638"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::lifetime&#95;start:</span></CodeLine>
<Link id="l08639" /><CodeLine lineNumber="8639"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> Intrinsic::lifetime&#95;end:</span></CodeLine>
<Link id="l08640" /><CodeLine lineNumber="8640"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For scalable vectors if one of the operands is variant then we still</span></CodeLine>
<Link id="l08641" /><CodeLine lineNumber="8641"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// want to mark as uniform, which will generate one instruction for just</span></CodeLine>
<Link id="l08642" /><CodeLine lineNumber="8642"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the first lane of the vector. We can&#39;t scalarize the call in the same</span></CodeLine>
<Link id="l08643" /><CodeLine lineNumber="8643"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// way as for fixed-width vectors because we don&#39;t know how many lanes</span></CodeLine>
<Link id="l08644" /><CodeLine lineNumber="8644"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// there are.</span></CodeLine>
<Link id="l08645" /><CodeLine lineNumber="8645"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l08646" /><CodeLine lineNumber="8646"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The reasons for doing it this way for scalable vectors are:</span></CodeLine>
<Link id="l08647" /><CodeLine lineNumber="8647"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   1 For the assume intrinsic generating the instruction for the first</span></CodeLine>
<Link id="l08648" /><CodeLine lineNumber="8648"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//      lane is still be better than not generating any at all. For</span></CodeLine>
<Link id="l08649" /><CodeLine lineNumber="8649"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//      example, the input may be a splat across all lanes.</span></CodeLine>
<Link id="l08650" /><CodeLine lineNumber="8650"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//   2 For the lifetime start/end intrinsics the pointer operand only</span></CodeLine>
<Link id="l08651" /><CodeLine lineNumber="8651"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//      does anything useful when the input comes from a stack object,</span></CodeLine>
<Link id="l08652" /><CodeLine lineNumber="8652"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//      which suggests it should always be uniform. For non-stack objects</span></CodeLine>
<Link id="l08653" /><CodeLine lineNumber="8653"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//      the effect is to poison the object, which still allows us to</span></CodeLine>
<Link id="l08654" /><CodeLine lineNumber="8654"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">//      remove the call.</span></CodeLine>
<Link id="l08655" /><CodeLine lineNumber="8655"><span class="doxyHighlight">      IsUniform = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08656" /><CodeLine lineNumber="8656"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08657" /><CodeLine lineNumber="8657"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">default</span><span class="doxyHighlight">:</span></CodeLine>
<Link id="l08658" /><CodeLine lineNumber="8658"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08659" /><CodeLine lineNumber="8659"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08660" /><CodeLine lineNumber="8660"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08661" /><CodeLine lineNumber="8661"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;BlockInMask = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08662" /><CodeLine lineNumber="8662"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IsPredicated) &#123;</span></CodeLine>
<Link id="l08663" /><CodeLine lineNumber="8663"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Finalize the recipe for Instr, first if it is not predicated.</span></CodeLine>
<Link id="l08664" /><CodeLine lineNumber="8664"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Scalarizing:&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08665" /><CodeLine lineNumber="8665"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08666" /><CodeLine lineNumber="8666"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Scalarizing and predicating:&quot;</span><span class="doxyHighlight"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08667" /><CodeLine lineNumber="8667"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Instructions marked for predication are replicated and a mask operand is</span></CodeLine>
<Link id="l08668" /><CodeLine lineNumber="8668"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// added initially. Masked replicate recipes will later be placed under an</span></CodeLine>
<Link id="l08669" /><CodeLine lineNumber="8669"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// if-then construct to prevent side-effects. Generate recipes to compute</span></CodeLine>
<Link id="l08670" /><CodeLine lineNumber="8670"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the block mask for this region.</span></CodeLine>
<Link id="l08671" /><CodeLine lineNumber="8671"><span class="doxyHighlight">    BlockInMask = <a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</span></CodeLine>
<Link id="l08672" /><CodeLine lineNumber="8672"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08673" /><CodeLine lineNumber="8673"></CodeLine>
<Link id="l08674" /><CodeLine lineNumber="8674"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Note that there is some custom logic to mark some intrinsics as uniform</span></CodeLine>
<Link id="l08675" /><CodeLine lineNumber="8675"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// manually above for scalable vectors, which this assert needs to account for</span></CodeLine>
<Link id="l08676" /><CodeLine lineNumber="8676"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// as well.</span></CodeLine>
<Link id="l08677" /><CodeLine lineNumber="8677"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>.Start.isScalar() || !IsUniform || !IsPredicated ||</span></CodeLine>
<Link id="l08678" /><CodeLine lineNumber="8678"><span class="doxyHighlight">          (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>.Start.isScalable() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))) &amp;&amp;</span></CodeLine>
<Link id="l08679" /><CodeLine lineNumber="8679"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Should not predicate a uniform recipe&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08680" /><CodeLine lineNumber="8680"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Recipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/vprecipebuilder/#a537d8b3b5160caeb94b20a21a9f6dcff">mapToVPValues</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands()),</span></CodeLine>
<Link id="l08681" /><CodeLine lineNumber="8681"><span class="doxyHighlight">                                       IsUniform, BlockInMask);</span></CodeLine>
<Link id="l08682" /><CodeLine lineNumber="8682"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Recipe;</span></CodeLine>
<Link id="l08683" /><CodeLine lineNumber="8683"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08684" /><CodeLine lineNumber="8684"></CodeLine>
<Link id="l08685" /><CodeLine lineNumber="8685"><span class="doxyHighlightComment">/// Find all possible partial reductions in the loop and track all of those that</span></CodeLine>
<Link id="l08686" /><CodeLine lineNumber="8686"><span class="doxyHighlightComment">/// are valid so recipes can be formed later.</span></CodeLine>
<Link id="l08687" /><CodeLine lineNumber="8687" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a8dc41af84f49f4b418bddf15547755af"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vprecipebuilder/#a8dc41af84f49f4b418bddf15547755af">VPRecipeBuilder::collectScaledReductions</a>(<a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</span></CodeLine>
<Link id="l08688" /><CodeLine lineNumber="8688"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Find all possible partial reductions.</span></CodeLine>
<Link id="l08689" /><CodeLine lineNumber="8689"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;PartialReductionChain, unsigned&gt;</a>&gt;</span></CodeLine>
<Link id="l08690" /><CodeLine lineNumber="8690"><span class="doxyHighlight">      PartialReductionChains;</span></CodeLine>
<Link id="l08691" /><CodeLine lineNumber="8691"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;Phi, RdxDesc&#93; : Legal-&gt;getReductionVars()) &#123;</span></CodeLine>
<Link id="l08692" /><CodeLine lineNumber="8692"><span class="doxyHighlight">    getScaledReductions(Phi, RdxDesc.getLoopExitInstr(), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>,</span></CodeLine>
<Link id="l08693" /><CodeLine lineNumber="8693"><span class="doxyHighlight">                        PartialReductionChains);</span></CodeLine>
<Link id="l08694" /><CodeLine lineNumber="8694"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08695" /><CodeLine lineNumber="8695"></CodeLine>
<Link id="l08696" /><CodeLine lineNumber="8696"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A partial reduction is invalid if any of its extends are used by</span></CodeLine>
<Link id="l08697" /><CodeLine lineNumber="8697"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// something that isn&#39;t another partial reduction. This is because the</span></CodeLine>
<Link id="l08698" /><CodeLine lineNumber="8698"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// extends are intended to be lowered along with the reduction itself.</span></CodeLine>
<Link id="l08699" /><CodeLine lineNumber="8699"></CodeLine>
<Link id="l08700" /><CodeLine lineNumber="8700"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build up a set of partial reduction bin ops for efficient use checking.</span></CodeLine>
<Link id="l08701" /><CodeLine lineNumber="8701"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;User &#42;, 4&gt;</a> PartialReductionBinOps;</span></CodeLine>
<Link id="l08702" /><CodeLine lineNumber="8702"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;PartialRdx, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>&#93; : PartialReductionChains)</span></CodeLine>
<Link id="l08703" /><CodeLine lineNumber="8703"><span class="doxyHighlight">    PartialReductionBinOps.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(PartialRdx.BinOp);</span></CodeLine>
<Link id="l08704" /><CodeLine lineNumber="8704"></CodeLine>
<Link id="l08705" /><CodeLine lineNumber="8705"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ExtendIsOnlyUsedByPartialReductions =</span></CodeLine>
<Link id="l08706" /><CodeLine lineNumber="8706"><span class="doxyHighlight">      &#91;&amp;PartialReductionBinOps&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Extend) &#123;</span></CodeLine>
<Link id="l08707" /><CodeLine lineNumber="8707"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(Extend-&gt;users(), &#91;&amp;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</span></CodeLine>
<Link id="l08708" /><CodeLine lineNumber="8708"><span class="doxyHighlight">          return PartialReductionBinOps.contains(U);</span></CodeLine>
<Link id="l08709" /><CodeLine lineNumber="8709"><span class="doxyHighlight">        &#125;);</span></CodeLine>
<Link id="l08710" /><CodeLine lineNumber="8710"><span class="doxyHighlight">      &#125;;</span></CodeLine>
<Link id="l08711" /><CodeLine lineNumber="8711"></CodeLine>
<Link id="l08712" /><CodeLine lineNumber="8712"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if each use of a chain&#39;s two extends is a partial reduction</span></CodeLine>
<Link id="l08713" /><CodeLine lineNumber="8713"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and only add those that don&#39;t have non-partial reduction users.</span></CodeLine>
<Link id="l08714" /><CodeLine lineNumber="8714"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Pair : PartialReductionChains) &#123;</span></CodeLine>
<Link id="l08715" /><CodeLine lineNumber="8715"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/partialreductionchain">PartialReductionChain</a> Chain = Pair.first;</span></CodeLine>
<Link id="l08716" /><CodeLine lineNumber="8716"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExtendIsOnlyUsedByPartialReductions(Chain.ExtendA) &amp;&amp;</span></CodeLine>
<Link id="l08717" /><CodeLine lineNumber="8717"><span class="doxyHighlight">        ExtendIsOnlyUsedByPartialReductions(Chain.ExtendB))</span></CodeLine>
<Link id="l08718" /><CodeLine lineNumber="8718"><span class="doxyHighlight">      ScaledReductionMap.<a href="/docs/api/classes/llvm/smallvectorimpl/#a94d23373106467003722f7d6c17b1528">insert</a>(std::make&#95;pair(Chain.Reduction, Pair.second));</span></CodeLine>
<Link id="l08719" /><CodeLine lineNumber="8719"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08720" /><CodeLine lineNumber="8720"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08721" /><CodeLine lineNumber="8721"></CodeLine>
<Link id="l08722" /><CodeLine lineNumber="8722"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> VPRecipeBuilder::getScaledReductions(</span></CodeLine>
<Link id="l08723" /><CodeLine lineNumber="8723"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;RdxExitInstr, <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>,</span></CodeLine>
<Link id="l08724" /><CodeLine lineNumber="8724"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;std::pair&lt;PartialReductionChain, unsigned&gt;&gt; &amp;Chains) &#123;</span></CodeLine>
<Link id="l08725" /><CodeLine lineNumber="8725"></CodeLine>
<Link id="l08726" /><CodeLine lineNumber="8726"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(RdxExitInstr))</span></CodeLine>
<Link id="l08727" /><CodeLine lineNumber="8727"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08728" /><CodeLine lineNumber="8728"></CodeLine>
<Link id="l08729" /><CodeLine lineNumber="8729"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Allow scaling reductions when predicating. The select at</span></CodeLine>
<Link id="l08730" /><CodeLine lineNumber="8730"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the end of the loop chooses between the phi value and most recent</span></CodeLine>
<Link id="l08731" /><CodeLine lineNumber="8731"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// reduction result, both of which have different VFs to the active lane</span></CodeLine>
<Link id="l08732" /><CodeLine lineNumber="8732"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// mask when scaling.</span></CodeLine>
<Link id="l08733" /><CodeLine lineNumber="8733"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8c8de8f62b5d2b27c4878d3effd7273">blockNeedsPredicationForAnyReason</a>(RdxExitInstr-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()))</span></CodeLine>
<Link id="l08734" /><CodeLine lineNumber="8734"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08735" /><CodeLine lineNumber="8735"></CodeLine>
<Link id="l08736" /><CodeLine lineNumber="8736"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Update = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(RdxExitInstr);</span></CodeLine>
<Link id="l08737" /><CodeLine lineNumber="8737"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Update)</span></CodeLine>
<Link id="l08738" /><CodeLine lineNumber="8738"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08739" /><CodeLine lineNumber="8739"></CodeLine>
<Link id="l08740" /><CodeLine lineNumber="8740"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = Update-&gt;getOperand(0);</span></CodeLine>
<Link id="l08741" /><CodeLine lineNumber="8741"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;PhiOp = Update-&gt;getOperand(1);</span></CodeLine>
<Link id="l08742" /><CodeLine lineNumber="8742"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)</span></CodeLine>
<Link id="l08743" /><CodeLine lineNumber="8743"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, PhiOp);</span></CodeLine>
<Link id="l08744" /><CodeLine lineNumber="8744"></CodeLine>
<Link id="l08745" /><CodeLine lineNumber="8745"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Try and get a scaled reduction from the first non-phi operand.</span></CodeLine>
<Link id="l08746" /><CodeLine lineNumber="8746"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If one is found, we use the discovered reduction instruction in</span></CodeLine>
<Link id="l08747" /><CodeLine lineNumber="8747"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// place of the accumulator for costing.</span></CodeLine>
<Link id="l08748" /><CodeLine lineNumber="8748"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) &#123;</span></CodeLine>
<Link id="l08749" /><CodeLine lineNumber="8749"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (getScaledReductions(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, OpInst, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>, Chains)) &#123;</span></CodeLine>
<Link id="l08750" /><CodeLine lineNumber="8750"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = Chains.rbegin()-&gt;first.Reduction;</span></CodeLine>
<Link id="l08751" /><CodeLine lineNumber="8751"></CodeLine>
<Link id="l08752" /><CodeLine lineNumber="8752"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = Update-&gt;getOperand(0);</span></CodeLine>
<Link id="l08753" /><CodeLine lineNumber="8753"><span class="doxyHighlight">      PhiOp = Update-&gt;getOperand(1);</span></CodeLine>
<Link id="l08754" /><CodeLine lineNumber="8754"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)</span></CodeLine>
<Link id="l08755" /><CodeLine lineNumber="8755"><span class="doxyHighlight">        <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, PhiOp);</span></CodeLine>
<Link id="l08756" /><CodeLine lineNumber="8756"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08757" /><CodeLine lineNumber="8757"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08758" /><CodeLine lineNumber="8758"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PhiOp != <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)</span></CodeLine>
<Link id="l08759" /><CodeLine lineNumber="8759"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08760" /><CodeLine lineNumber="8760"></CodeLine>
<Link id="l08761" /><CodeLine lineNumber="8761"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;BinOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</span></CodeLine>
<Link id="l08762" /><CodeLine lineNumber="8762"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!BinOp || !BinOp-&gt;hasOneUse())</span></CodeLine>
<Link id="l08763" /><CodeLine lineNumber="8763"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08764" /><CodeLine lineNumber="8764"></CodeLine>
<Link id="l08765" /><CodeLine lineNumber="8765"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight">llvm::PatternMatch;</span></CodeLine>
<Link id="l08766" /><CodeLine lineNumber="8766"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>;</span></CodeLine>
<Link id="l08767" /><CodeLine lineNumber="8767"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BinOp-&gt;getOperand(0), <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>))) ||</span></CodeLine>
<Link id="l08768" /><CodeLine lineNumber="8768"><span class="doxyHighlight">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BinOp-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))))</span></CodeLine>
<Link id="l08769" /><CodeLine lineNumber="8769"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08770" /><CodeLine lineNumber="8770"></CodeLine>
<Link id="l08771" /><CodeLine lineNumber="8771"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExtA = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(BinOp-&gt;getOperand(0));</span></CodeLine>
<Link id="l08772" /><CodeLine lineNumber="8772"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExtB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(BinOp-&gt;getOperand(1));</span></CodeLine>
<Link id="l08773" /><CodeLine lineNumber="8773"></CodeLine>
<Link id="l08774" /><CodeLine lineNumber="8774"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targettransforminfo/#abd1dc2b46b5e2311e1f64d21b2991be9">TTI::PartialReductionExtendKind</a> OpAExtend =</span></CodeLine>
<Link id="l08775" /><CodeLine lineNumber="8775"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/targettransforminfo/#a49120eb4a93d65c200b9aa5529f88448">TargetTransformInfo::getPartialReductionExtendKind</a>(ExtA);</span></CodeLine>
<Link id="l08776" /><CodeLine lineNumber="8776"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/targettransforminfo/#abd1dc2b46b5e2311e1f64d21b2991be9">TTI::PartialReductionExtendKind</a> OpBExtend =</span></CodeLine>
<Link id="l08777" /><CodeLine lineNumber="8777"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/targettransforminfo/#a49120eb4a93d65c200b9aa5529f88448">TargetTransformInfo::getPartialReductionExtendKind</a>(ExtB);</span></CodeLine>
<Link id="l08778" /><CodeLine lineNumber="8778"></CodeLine>
<Link id="l08779" /><CodeLine lineNumber="8779"><span class="doxyHighlight">  PartialReductionChain <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>(RdxExitInstr, ExtA, ExtB, BinOp);</span></CodeLine>
<Link id="l08780" /><CodeLine lineNumber="8780"></CodeLine>
<Link id="l08781" /><CodeLine lineNumber="8781"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> TargetScaleFactor =</span></CodeLine>
<Link id="l08782" /><CodeLine lineNumber="8782"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getType()-&gt;getPrimitiveSizeInBits().getKnownScalarFactor(</span></CodeLine>
<Link id="l08783" /><CodeLine lineNumber="8783"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType()-&gt;getPrimitiveSizeInBits());</span></CodeLine>
<Link id="l08784" /><CodeLine lineNumber="8784"></CodeLine>
<Link id="l08785" /><CodeLine lineNumber="8785"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</span></CodeLine>
<Link id="l08786" /><CodeLine lineNumber="8786"><span class="doxyHighlight">          &#91;&amp;&#93;(ElementCount VF) &#123;</span></CodeLine>
<Link id="l08787" /><CodeLine lineNumber="8787"><span class="doxyHighlight">            InstructionCost <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = TTI-&gt;getPartialReductionCost(</span></CodeLine>
<Link id="l08788" /><CodeLine lineNumber="8788"><span class="doxyHighlight">                Update-&gt;getOpcode(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;getType(), <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getType(),</span></CodeLine>
<Link id="l08789" /><CodeLine lineNumber="8789"><span class="doxyHighlight">                VF, OpAExtend, OpBExtend,</span></CodeLine>
<Link id="l08790" /><CodeLine lineNumber="8790"><span class="doxyHighlight">                std::make&#95;optional(BinOp-&gt;getOpcode()));</span></CodeLine>
<Link id="l08791" /><CodeLine lineNumber="8791"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>();</span></CodeLine>
<Link id="l08792" /><CodeLine lineNumber="8792"><span class="doxyHighlight">          &#125;,</span></CodeLine>
<Link id="l08793" /><CodeLine lineNumber="8793"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)) &#123;</span></CodeLine>
<Link id="l08794" /><CodeLine lineNumber="8794"><span class="doxyHighlight">    Chains.push&#95;back(std::make&#95;pair(Chain, TargetScaleFactor));</span></CodeLine>
<Link id="l08795" /><CodeLine lineNumber="8795"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08796" /><CodeLine lineNumber="8796"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08797" /><CodeLine lineNumber="8797"></CodeLine>
<Link id="l08798" /><CodeLine lineNumber="8798"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08799" /><CodeLine lineNumber="8799"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08800" /><CodeLine lineNumber="8800"></CodeLine>
<Link id="l08801" /><CodeLine lineNumber="8801"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;</span></CodeLine>
<Link id="l08802" /><CodeLine lineNumber="8802" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a760fb390c24b907500c0a181fada9590"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vprecipebuilder/#a760fb390c24b907500c0a181fada9590">VPRecipeBuilder::tryToCreateWidenRecipe</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr,</span></CodeLine>
<Link id="l08803" /><CodeLine lineNumber="8803"><span class="doxyHighlight">                                        <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>,</span></CodeLine>
<Link id="l08804" /><CodeLine lineNumber="8804"><span class="doxyHighlight">                                        <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>, <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB) &#123;</span></CodeLine>
<Link id="l08805" /><CodeLine lineNumber="8805"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First, check for specific widening recipes that deal with inductions, Phi</span></CodeLine>
<Link id="l08806" /><CodeLine lineNumber="8806"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// nodes, calls and memory operations.</span></CodeLine>
<Link id="l08807" /><CodeLine lineNumber="8807"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Recipe;</span></CodeLine>
<Link id="l08808" /><CodeLine lineNumber="8808"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Instr)) &#123;</span></CodeLine>
<Link id="l08809" /><CodeLine lineNumber="8809"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Phi-&gt;getParent() != OrigLoop-&gt;getHeader())</span></CodeLine>
<Link id="l08810" /><CodeLine lineNumber="8810"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> tryToBlend(Phi, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>);</span></CodeLine>
<Link id="l08811" /><CodeLine lineNumber="8811"></CodeLine>
<Link id="l08812" /><CodeLine lineNumber="8812"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((Recipe = tryToOptimizeInductionPHI(Phi, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)))</span></CodeLine>
<Link id="l08813" /><CodeLine lineNumber="8813"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Recipe;</span></CodeLine>
<Link id="l08814" /><CodeLine lineNumber="8814"></CodeLine>
<Link id="l08815" /><CodeLine lineNumber="8815"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpheaderphirecipe">VPHeaderPHIRecipe</a> &#42;PhiRecipe = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08816" /><CodeLine lineNumber="8816"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Legal-&gt;isReductionVariable(Phi) ||</span></CodeLine>
<Link id="l08817" /><CodeLine lineNumber="8817"><span class="doxyHighlight">            Legal-&gt;isFixedOrderRecurrence(Phi)) &amp;&amp;</span></CodeLine>
<Link id="l08818" /><CodeLine lineNumber="8818"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;can only widen reductions and fixed-order recurrences here&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08819" /><CodeLine lineNumber="8819"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;StartV = <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;0&#93;;</span></CodeLine>
<Link id="l08820" /><CodeLine lineNumber="8820"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Legal-&gt;isReductionVariable(Phi)) &#123;</span></CodeLine>
<Link id="l08821" /><CodeLine lineNumber="8821"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc =</span></CodeLine>
<Link id="l08822" /><CodeLine lineNumber="8822"><span class="doxyHighlight">          Legal-&gt;getReductionVars().find(Phi)-&gt;second;</span></CodeLine>
<Link id="l08823" /><CodeLine lineNumber="8823"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a61351428b7eb226cbad866ccf2382817">getRecurrenceStartValue</a>() ==</span></CodeLine>
<Link id="l08824" /><CodeLine lineNumber="8824"><span class="doxyHighlight">             Phi-&gt;getIncomingValueForBlock(OrigLoop-&gt;getLoopPreheader()));</span></CodeLine>
<Link id="l08825" /><CodeLine lineNumber="8825"></CodeLine>
<Link id="l08826" /><CodeLine lineNumber="8826"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the PHI is used by a partial reduction, set the scale factor.</span></CodeLine>
<Link id="l08827" /><CodeLine lineNumber="8827"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> ScaleFactor =</span></CodeLine>
<Link id="l08828" /><CodeLine lineNumber="8828"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/vprecipebuilder/#a830fac639095604081943918ff84f703">getScalingForReduction</a>(RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a2b34d6e86d376d6857ccf7dd75d7dcf2">getLoopExitInstr</a>()).value&#95;or(1);</span></CodeLine>
<Link id="l08829" /><CodeLine lineNumber="8829"><span class="doxyHighlight">      PhiRecipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpreductionphirecipe">VPReductionPHIRecipe</a>(</span></CodeLine>
<Link id="l08830" /><CodeLine lineNumber="8830"><span class="doxyHighlight">          Phi, RdxDesc, &#42;StartV, CM.isInLoopReduction(Phi),</span></CodeLine>
<Link id="l08831" /><CodeLine lineNumber="8831"><span class="doxyHighlight">          CM.useOrderedReductions(RdxDesc), ScaleFactor);</span></CodeLine>
<Link id="l08832" /><CodeLine lineNumber="8832"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l08833" /><CodeLine lineNumber="8833"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: Currently fixed-order recurrences are modeled as chains of</span></CodeLine>
<Link id="l08834" /><CodeLine lineNumber="8834"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// first-order recurrences. If there are no users of the intermediate</span></CodeLine>
<Link id="l08835" /><CodeLine lineNumber="8835"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// recurrences in the chain, the fixed order recurrence should be modeled</span></CodeLine>
<Link id="l08836" /><CodeLine lineNumber="8836"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// directly, enabling more efficient codegen.</span></CodeLine>
<Link id="l08837" /><CodeLine lineNumber="8837"><span class="doxyHighlight">      PhiRecipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vpfirstorderrecurrencephirecipe">VPFirstOrderRecurrencePHIRecipe</a>(Phi, &#42;StartV);</span></CodeLine>
<Link id="l08838" /><CodeLine lineNumber="8838"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08839" /><CodeLine lineNumber="8839"></CodeLine>
<Link id="l08840" /><CodeLine lineNumber="8840"><span class="doxyHighlight">    PhisToFix.push&#95;back(PhiRecipe);</span></CodeLine>
<Link id="l08841" /><CodeLine lineNumber="8841"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PhiRecipe;</span></CodeLine>
<Link id="l08842" /><CodeLine lineNumber="8842"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08843" /><CodeLine lineNumber="8843"></CodeLine>
<Link id="l08844" /><CodeLine lineNumber="8844"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(Instr) &amp;&amp; (Recipe = tryToOptimizeInductionTruncate(</span></CodeLine>
<Link id="l08845" /><CodeLine lineNumber="8845"><span class="doxyHighlight">                                    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;TruncInst&gt;</a>(Instr), <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)))</span></CodeLine>
<Link id="l08846" /><CodeLine lineNumber="8846"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Recipe;</span></CodeLine>
<Link id="l08847" /><CodeLine lineNumber="8847"></CodeLine>
<Link id="l08848" /><CodeLine lineNumber="8848"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// All widen recipes below deal only with VF &gt; 1</span></CodeLine>
<Link id="l08849" /><CodeLine lineNumber="8849"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</span></CodeLine>
<Link id="l08850" /><CodeLine lineNumber="8850"><span class="doxyHighlight">          &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>(); &#125;, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>))</span></CodeLine>
<Link id="l08851" /><CodeLine lineNumber="8851"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08852" /><CodeLine lineNumber="8852"></CodeLine>
<Link id="l08853" /><CodeLine lineNumber="8853"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(Instr))</span></CodeLine>
<Link id="l08854" /><CodeLine lineNumber="8854"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> tryToWidenCall(CI, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</span></CodeLine>
<Link id="l08855" /><CodeLine lineNumber="8855"></CodeLine>
<Link id="l08856" /><CodeLine lineNumber="8856"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(Instr))</span></CodeLine>
<Link id="l08857" /><CodeLine lineNumber="8857"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> HistInfo = Legal-&gt;getHistogramInfo(<a href="/docs/api/namespaces/llvm/si">SI</a>))</span></CodeLine>
<Link id="l08858" /><CodeLine lineNumber="8858"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> tryToWidenHistogram(&#42;HistInfo, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>);</span></CodeLine>
<Link id="l08859" /><CodeLine lineNumber="8859"></CodeLine>
<Link id="l08860" /><CodeLine lineNumber="8860"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(Instr) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(Instr))</span></CodeLine>
<Link id="l08861" /><CodeLine lineNumber="8861"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> tryToWidenMemory(Instr, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</span></CodeLine>
<Link id="l08862" /><CodeLine lineNumber="8862"></CodeLine>
<Link id="l08863" /><CodeLine lineNumber="8863"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebuilder/#a830fac639095604081943918ff84f703">getScalingForReduction</a>(Instr))</span></CodeLine>
<Link id="l08864" /><CodeLine lineNumber="8864"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vprecipebuilder/#a06a097fb3e3b640d70709b4770408024">tryToCreatePartialReduction</a>(Instr, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>);</span></CodeLine>
<Link id="l08865" /><CodeLine lineNumber="8865"></CodeLine>
<Link id="l08866" /><CodeLine lineNumber="8866"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!shouldWiden(Instr, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>))</span></CodeLine>
<Link id="l08867" /><CodeLine lineNumber="8867"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08868" /><CodeLine lineNumber="8868"></CodeLine>
<Link id="l08869" /><CodeLine lineNumber="8869"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(Instr))</span></CodeLine>
<Link id="l08870" /><CodeLine lineNumber="8870"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidengeprecipe">VPWidenGEPRecipe</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>,</span></CodeLine>
<Link id="l08871" /><CodeLine lineNumber="8871"><span class="doxyHighlight">                                <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.begin(), <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.end()));</span></CodeLine>
<Link id="l08872" /><CodeLine lineNumber="8872"></CodeLine>
<Link id="l08873" /><CodeLine lineNumber="8873"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(Instr)) &#123;</span></CodeLine>
<Link id="l08874" /><CodeLine lineNumber="8874"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vpwidenselectrecipe">VPWidenSelectRecipe</a>(</span></CodeLine>
<Link id="l08875" /><CodeLine lineNumber="8875"><span class="doxyHighlight">        &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.begin(), <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.end()));</span></CodeLine>
<Link id="l08876" /><CodeLine lineNumber="8876"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08877" /><CodeLine lineNumber="8877"></CodeLine>
<Link id="l08878" /><CodeLine lineNumber="8878"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(Instr)) &#123;</span></CodeLine>
<Link id="l08879" /><CodeLine lineNumber="8879"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>(CI-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;0&#93;, CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</span></CodeLine>
<Link id="l08880" /><CodeLine lineNumber="8880"><span class="doxyHighlight">                                 &#42;CI);</span></CodeLine>
<Link id="l08881" /><CodeLine lineNumber="8881"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08882" /><CodeLine lineNumber="8882"></CodeLine>
<Link id="l08883" /><CodeLine lineNumber="8883"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> tryToWiden(Instr, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, VPBB);</span></CodeLine>
<Link id="l08884" /><CodeLine lineNumber="8884"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08885" /><CodeLine lineNumber="8885"></CodeLine>
<Link id="l08886" /><CodeLine lineNumber="8886"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;</span></CodeLine>
<Link id="l08887" /><CodeLine lineNumber="8887" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a06a097fb3e3b640d70709b4770408024"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/vprecipebuilder/#a06a097fb3e3b640d70709b4770408024">VPRecipeBuilder::tryToCreatePartialReduction</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>,</span></CodeLine>
<Link id="l08888" /><CodeLine lineNumber="8888"><span class="doxyHighlight">                                             <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>) &#123;</span></CodeLine>
<Link id="l08889" /><CodeLine lineNumber="8889"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.size() == 2 &amp;&amp;</span></CodeLine>
<Link id="l08890" /><CodeLine lineNumber="8890"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;Unexpected number of operands for partial reduction&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08891" /><CodeLine lineNumber="8891"></CodeLine>
<Link id="l08892" /><CodeLine lineNumber="8892"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;BinOp = <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;0&#93;;</span></CodeLine>
<Link id="l08893" /><CodeLine lineNumber="8893"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64instrinfo-cpp/#abb0a82cf9ab3cf0c256918c17512f987aa66d3974b6f2e3a542f896da144cd297">Accumulator</a> = <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;1&#93;;</span></CodeLine>
<Link id="l08894" /><CodeLine lineNumber="8894"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;BinOpRecipe = BinOp-&gt;getDefiningRecipe();</span></CodeLine>
<Link id="l08895" /><CodeLine lineNumber="8895"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPReductionPHIRecipe&gt;</a>(BinOpRecipe) ||</span></CodeLine>
<Link id="l08896" /><CodeLine lineNumber="8896"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPPartialReductionRecipe&gt;</a>(BinOpRecipe))</span></CodeLine>
<Link id="l08897" /><CodeLine lineNumber="8897"><span class="doxyHighlight">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(BinOp, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64instrinfo-cpp/#abb0a82cf9ab3cf0c256918c17512f987aa66d3974b6f2e3a542f896da144cd297">Accumulator</a>);</span></CodeLine>
<Link id="l08898" /><CodeLine lineNumber="8898"></CodeLine>
<Link id="l08899" /><CodeLine lineNumber="8899"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vppartialreductionrecipe">VPPartialReductionRecipe</a>(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>-&gt;getOpcode(), BinOp,</span></CodeLine>
<Link id="l08900" /><CodeLine lineNumber="8900"><span class="doxyHighlight">                                      <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64instrinfo-cpp/#abb0a82cf9ab3cf0c256918c17512f987aa66d3974b6f2e3a542f896da144cd297">Accumulator</a>, <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>);</span></CodeLine>
<Link id="l08901" /><CodeLine lineNumber="8901"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08902" /><CodeLine lineNumber="8902"></CodeLine>
<Link id="l08903" /><CodeLine lineNumber="8903"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> LoopVectorizationPlanner::buildVPlansWithVPRecipes(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MinVF,</span></CodeLine>
<Link id="l08904" /><CodeLine lineNumber="8904"><span class="doxyHighlight">                                                        <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MaxVF) &#123;</span></CodeLine>
<Link id="l08905" /><CodeLine lineNumber="8905"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a16165c1e5da45acaa086c3a54a188d34">isInnermost</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Inner loop expected.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08906" /><CodeLine lineNumber="8906"></CodeLine>
<Link id="l08907" /><CodeLine lineNumber="8907"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> MaxVFTimes2 = MaxVF &#42; 2;</span></CodeLine>
<Link id="l08908" /><CodeLine lineNumber="8908"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF = MinVF; <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a83e6442f8ebefccdb5e089732fe397ac">ElementCount::isKnownLT</a>(VF, MaxVFTimes2);) &#123;</span></CodeLine>
<Link id="l08909" /><CodeLine lineNumber="8909"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/vfrange">VFRange</a> SubRange = &#123;VF, MaxVFTimes2&#125;;</span></CodeLine>
<Link id="l08910" /><CodeLine lineNumber="8910"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Plan = tryToBuildVPlanWithVPRecipes(SubRange)) &#123;</span></CodeLine>
<Link id="l08911" /><CodeLine lineNumber="8911"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Now optimize the initial VPlan.</span></CodeLine>
<Link id="l08912" /><CodeLine lineNumber="8912"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Plan-&gt;<a href="/docs/api/classes/llvm/vplan/#a633dd97e642c10e8aa1dff2bd2874edb">hasVF</a>(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1)))</span></CodeLine>
<Link id="l08913" /><CodeLine lineNumber="8913"><span class="doxyHighlight">        <a href="/docs/api/structs/llvm/vplantransforms/#ae61793492431f138869f097a5f31bd32">VPlanTransforms::truncateToMinimalBitwidths</a>(&#42;Plan,</span></CodeLine>
<Link id="l08914" /><CodeLine lineNumber="8914"><span class="doxyHighlight">                                                    CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9fe7595d60ab8e1f3ee1da0846838113">getMinimalBitwidths</a>());</span></CodeLine>
<Link id="l08915" /><CodeLine lineNumber="8915"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/vplantransforms/#ae3449b993cd1c459995c2fe13ef50892">VPlanTransforms::optimize</a>(&#42;Plan);</span></CodeLine>
<Link id="l08916" /><CodeLine lineNumber="8916"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: try to put it close to addActiveLaneMask().</span></CodeLine>
<Link id="l08917" /><CodeLine lineNumber="8917"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Discard the plan if it is not EVL-compatible</span></CodeLine>
<Link id="l08918" /><CodeLine lineNumber="8918"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab0c7e793ca1b6b8a4f8c00a1bc1cb32f">foldTailWithEVL</a>() &amp;&amp; !<a href="/docs/api/structs/llvm/vplantransforms/#ad16bff9364e25351de81704fe81fd229">VPlanTransforms::tryAddExplicitVectorLength</a>(</span></CodeLine>
<Link id="l08919" /><CodeLine lineNumber="8919"><span class="doxyHighlight">                                      &#42;Plan, CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a36ed7dfdcdc1bca9eea99fc741511590">getMaxSafeElements</a>()))</span></CodeLine>
<Link id="l08920" /><CodeLine lineNumber="8920"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08921" /><CodeLine lineNumber="8921"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#af5f1d1b7df16dee92c5b56c26e322b89">verifyVPlanIsValid</a>(&#42;Plan) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;VPlan is invalid&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08922" /><CodeLine lineNumber="8922"><span class="doxyHighlight">      VPlans.push&#95;back(std::move(Plan));</span></CodeLine>
<Link id="l08923" /><CodeLine lineNumber="8923"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l08924" /><CodeLine lineNumber="8924"><span class="doxyHighlight">    VF = SubRange.<a href="/docs/api/structs/llvm/vfrange/#a8f3e6ec0ac823874aa93cc9d98081701">End</a>;</span></CodeLine>
<Link id="l08925" /><CodeLine lineNumber="8925"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08926" /><CodeLine lineNumber="8926"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08927" /><CodeLine lineNumber="8927"></CodeLine>
<Link id="l08928" /><CodeLine lineNumber="8928"><span class="doxyHighlightComment">// Add the necessary canonical IV and branch recipes required to control the</span></CodeLine>
<Link id="l08929" /><CodeLine lineNumber="8929"><span class="doxyHighlightComment">// loop.</span></CodeLine>
<Link id="l08930" /><CodeLine lineNumber="8930" lineLink="#a4d2a943e39c98ccce6fd53e8df9c5c2b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a4d2a943e39c98ccce6fd53e8df9c5c2b">addCanonicalIVRecipes</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/type">Type</a> &#42;IdxTy, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasNUW,</span></CodeLine>
<Link id="l08931" /><CodeLine lineNumber="8931"><span class="doxyHighlight">                                  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</span></CodeLine>
<Link id="l08932" /><CodeLine lineNumber="8932"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;StartIdx = ConstantInt::get(IdxTy, 0);</span></CodeLine>
<Link id="l08933" /><CodeLine lineNumber="8933"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;StartV = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(StartIdx);</span></CodeLine>
<Link id="l08934" /><CodeLine lineNumber="8934"></CodeLine>
<Link id="l08935" /><CodeLine lineNumber="8935"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add a VPCanonicalIVPHIRecipe starting at 0 to the header.</span></CodeLine>
<Link id="l08936" /><CodeLine lineNumber="8936"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CanonicalIVPHI = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpcanonicalivphirecipe">VPCanonicalIVPHIRecipe</a>(StartV, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l08937" /><CodeLine lineNumber="8937"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;TopRegion = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</span></CodeLine>
<Link id="l08938" /><CodeLine lineNumber="8938"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;Header = TopRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</span></CodeLine>
<Link id="l08939" /><CodeLine lineNumber="8939"><span class="doxyHighlight">  Header-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#adfdd504b078cce3b90e7c5cf1f5164db">insert</a>(CanonicalIVPHI, Header-&gt;begin());</span></CodeLine>
<Link id="l08940" /><CodeLine lineNumber="8940"></CodeLine>
<Link id="l08941" /><CodeLine lineNumber="8941"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> Builder(TopRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a28da654f916bf44da5513b6f1788835c">getExitingBasicBlock</a>());</span></CodeLine>
<Link id="l08942" /><CodeLine lineNumber="8942"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add a VPInstruction to increment the scalar canonical IV by VF &#42; UF.</span></CodeLine>
<Link id="l08943" /><CodeLine lineNumber="8943"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CanonicalIVIncrement = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#ab3b191f35221f351f77883447fef4019">createOverflowingOp</a>(</span></CodeLine>
<Link id="l08944" /><CodeLine lineNumber="8944"><span class="doxyHighlight">      Instruction::Add, &#123;CanonicalIVPHI, &amp;Plan.<a href="/docs/api/classes/llvm/vplan/#a2d53ff30dd2a706e91c30d4f50982e3d">getVFxUF</a>()&#125;, &#123;HasNUW, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">&#125;, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</span></CodeLine>
<Link id="l08945" /><CodeLine lineNumber="8945"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;index.next&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08946" /><CodeLine lineNumber="8946"><span class="doxyHighlight">  CanonicalIVPHI-&gt;<a href="/docs/api/classes/llvm/vpuser/#af4a3b471097ab37b1672a0d88869ea51">addOperand</a>(CanonicalIVIncrement);</span></CodeLine>
<Link id="l08947" /><CodeLine lineNumber="8947"></CodeLine>
<Link id="l08948" /><CodeLine lineNumber="8948"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Add the BranchOnCount VPInstruction to the latch.</span></CodeLine>
<Link id="l08949" /><CodeLine lineNumber="8949"><span class="doxyHighlight">  Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a49dcace93798ddd457a9d4e584bbc9a2">VPInstruction::BranchOnCount</a>,</span></CodeLine>
<Link id="l08950" /><CodeLine lineNumber="8950"><span class="doxyHighlight">                       &#123;CanonicalIVIncrement, &amp;Plan.<a href="/docs/api/classes/llvm/vplan/#a233848f0bf7aef1aca22e6172e5d900d">getVectorTripCount</a>()&#125;, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l08951" /><CodeLine lineNumber="8951"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08952" /><CodeLine lineNumber="8952"></CodeLine>
<Link id="l08953" /><CodeLine lineNumber="8953"><span class="doxyHighlightComment">/// Create and return a ResumePhi for \\p WideIV, unless it is truncated. If the</span></CodeLine>
<Link id="l08954" /><CodeLine lineNumber="8954"><span class="doxyHighlightComment">/// induction recipe is not canonical, creates a VPDerivedIVRecipe to compute</span></CodeLine>
<Link id="l08955" /><CodeLine lineNumber="8955"><span class="doxyHighlightComment">/// the end value of the induction.</span></CodeLine>
<Link id="l08956" /><CodeLine lineNumber="8956" lineLink="#a20c2e870e2c105fbf0945df09a9a5c4d"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a> &#42;<a href="#a20c2e870e2c105fbf0945df09a9a5c4d">addResumePhiRecipeForInduction</a>(</span></CodeLine>
<Link id="l08957" /><CodeLine lineNumber="8957"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpwideninductionrecipe">VPWidenInductionRecipe</a> &#42;WideIV, <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> &amp;VectorPHBuilder,</span></CodeLine>
<Link id="l08958" /><CodeLine lineNumber="8958"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> &amp;ScalarPHBuilder, <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> &amp;TypeInfo, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;VectorTC) &#123;</span></CodeLine>
<Link id="l08959" /><CodeLine lineNumber="8959"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WideIntOrFp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenIntOrFpInductionRecipe&gt;</a>(WideIV);</span></CodeLine>
<Link id="l08960" /><CodeLine lineNumber="8960"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Truncated wide inductions resume from the last lane of their vector value</span></CodeLine>
<Link id="l08961" /><CodeLine lineNumber="8961"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in the last vector iteration which is handled elsewhere.</span></CodeLine>
<Link id="l08962" /><CodeLine lineNumber="8962"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (WideIntOrFp &amp;&amp; WideIntOrFp-&gt;getTruncInst())</span></CodeLine>
<Link id="l08963" /><CodeLine lineNumber="8963"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l08964" /><CodeLine lineNumber="8964"></CodeLine>
<Link id="l08965" /><CodeLine lineNumber="8965"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Start = WideIV-&gt;<a href="/docs/api/classes/llvm/vpheaderphirecipe/#a92c12c8e69e03cc781dd010cdaa5f0e6">getStartValue</a>();</span></CodeLine>
<Link id="l08966" /><CodeLine lineNumber="8966"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Step = WideIV-&gt;<a href="/docs/api/classes/llvm/vpwideninductionrecipe/#a74f9beabcc57857ae7a7ba943e72776b">getStepValue</a>();</span></CodeLine>
<Link id="l08967" /><CodeLine lineNumber="8967"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> = WideIV-&gt;<a href="/docs/api/classes/llvm/vpwideninductionrecipe/#a82694b8412f0f864ede96af458b2fb87">getInductionDescriptor</a>();</span></CodeLine>
<Link id="l08968" /><CodeLine lineNumber="8968"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;EndValue = VectorTC;</span></CodeLine>
<Link id="l08969" /><CodeLine lineNumber="8969"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!WideIntOrFp || !WideIntOrFp-&gt;isCanonical()) &#123;</span></CodeLine>
<Link id="l08970" /><CodeLine lineNumber="8970"><span class="doxyHighlight">    EndValue = VectorPHBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#a3d75b91bc4016f3078bab29877d8b68e">createDerivedIV</a>(</span></CodeLine>
<Link id="l08971" /><CodeLine lineNumber="8971"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getKind(), <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;FPMathOperator&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getInductionBinOp()),</span></CodeLine>
<Link id="l08972" /><CodeLine lineNumber="8972"><span class="doxyHighlight">        Start, VectorTC, Step);</span></CodeLine>
<Link id="l08973" /><CodeLine lineNumber="8973"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08974" /><CodeLine lineNumber="8974"></CodeLine>
<Link id="l08975" /><CodeLine lineNumber="8975"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// EndValue is derived from the vector trip count (which has the same type as</span></CodeLine>
<Link id="l08976" /><CodeLine lineNumber="8976"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the widest induction) and thus may be wider than the induction here.</span></CodeLine>
<Link id="l08977" /><CodeLine lineNumber="8977"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarTypeOfWideIV = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(WideIV);</span></CodeLine>
<Link id="l08978" /><CodeLine lineNumber="8978"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ScalarTypeOfWideIV != TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(EndValue)) &#123;</span></CodeLine>
<Link id="l08979" /><CodeLine lineNumber="8979"><span class="doxyHighlight">    EndValue = VectorPHBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#a7651e884685052147f007e0e0fe0c774">createScalarCast</a>(Instruction::Trunc, EndValue,</span></CodeLine>
<Link id="l08980" /><CodeLine lineNumber="8980"><span class="doxyHighlight">                                                ScalarTypeOfWideIV,</span></CodeLine>
<Link id="l08981" /><CodeLine lineNumber="8981"><span class="doxyHighlight">                                                WideIV-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a733c4c530159a8b86223376c0696430e">getDebugLoc</a>());</span></CodeLine>
<Link id="l08982" /><CodeLine lineNumber="8982"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l08983" /><CodeLine lineNumber="8983"></CodeLine>
<Link id="l08984" /><CodeLine lineNumber="8984"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ResumePhiRecipe =</span></CodeLine>
<Link id="l08985" /><CodeLine lineNumber="8985"><span class="doxyHighlight">      ScalarPHBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a36144832b0ebcda13ce881d2b60eaf91">VPInstruction::ResumePhi</a>, &#123;EndValue, Start&#125;,</span></CodeLine>
<Link id="l08986" /><CodeLine lineNumber="8986"><span class="doxyHighlight">                                   WideIV-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a733c4c530159a8b86223376c0696430e">getDebugLoc</a>(), </span><span class="doxyHighlightStringLiteral">&quot;bc.resume.val&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l08987" /><CodeLine lineNumber="8987"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ResumePhiRecipe;</span></CodeLine>
<Link id="l08988" /><CodeLine lineNumber="8988"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l08989" /><CodeLine lineNumber="8989"></CodeLine>
<Link id="l08990" /><CodeLine lineNumber="8990"><span class="doxyHighlightComment">/// Create resume phis in the scalar preheader for first-order recurrences,</span></CodeLine>
<Link id="l08991" /><CodeLine lineNumber="8991"><span class="doxyHighlightComment">/// reductions and inductions, and update the VPIRInstructions wrapping the</span></CodeLine>
<Link id="l08992" /><CodeLine lineNumber="8992"><span class="doxyHighlightComment">/// original phis in the scalar header. End values for inductions are added to</span></CodeLine>
<Link id="l08993" /><CodeLine lineNumber="8993"><span class="doxyHighlightComment">/// \\p IVEndValues.</span></CodeLine>
<Link id="l08994" /><CodeLine lineNumber="8994" lineLink="#a02106664ead4e0c4e755457dbac7f7b3"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a02106664ead4e0c4e755457dbac7f7b3">addScalarResumePhis</a>(<a href="/docs/api/classes/llvm/vprecipebuilder">VPRecipeBuilder</a> &amp;Builder, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan,</span></CodeLine>
<Link id="l08995" /><CodeLine lineNumber="8995"><span class="doxyHighlight">                                <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;VPValue &#42;, VPValue &#42;&gt;</a> &amp;IVEndValues) &#123;</span></CodeLine>
<Link id="l08996" /><CodeLine lineNumber="8996"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>());</span></CodeLine>
<Link id="l08997" /><CodeLine lineNumber="8997"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ScalarPH = Plan.<a href="/docs/api/classes/llvm/vplan/#ad5f29ccf71b0494fc179323427eb1e11">getScalarPreheader</a>();</span></CodeLine>
<Link id="l08998" /><CodeLine lineNumber="8998"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MiddleVPBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(ScalarPH-&gt;getSinglePredecessor());</span></CodeLine>
<Link id="l08999" /><CodeLine lineNumber="8999"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;VectorRegion = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</span></CodeLine>
<Link id="l09000" /><CodeLine lineNumber="9000"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> VectorPHBuilder(</span></CodeLine>
<Link id="l09001" /><CodeLine lineNumber="9001"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aa1bb4808c7a5db9f8ed3f479c78c4b5e">getSinglePredecessor</a>()));</span></CodeLine>
<Link id="l09002" /><CodeLine lineNumber="9002"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> MiddleBuilder(MiddleVPBB, MiddleVPBB-&gt;getFirstNonPhi());</span></CodeLine>
<Link id="l09003" /><CodeLine lineNumber="9003"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> ScalarPHBuilder(ScalarPH);</span></CodeLine>
<Link id="l09004" /><CodeLine lineNumber="9004"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;OneVPV = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(</span></CodeLine>
<Link id="l09005" /><CodeLine lineNumber="9005"><span class="doxyHighlight">      ConstantInt::get(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>(), 1));</span></CodeLine>
<Link id="l09006" /><CodeLine lineNumber="9006"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;ScalarPhiR : &#42;Plan.<a href="/docs/api/classes/llvm/vplan/#ae56a6505c6bfa319e686fc23acd52495">getScalarHeader</a>()) &#123;</span></CodeLine>
<Link id="l09007" /><CodeLine lineNumber="9007"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ScalarPhiIRI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPIRInstruction&gt;</a>(&amp;ScalarPhiR);</span></CodeLine>
<Link id="l09008" /><CodeLine lineNumber="9008"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ScalarPhiI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;ScalarPhiIRI-&gt;getInstruction());</span></CodeLine>
<Link id="l09009" /><CodeLine lineNumber="9009"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ScalarPhiI)</span></CodeLine>
<Link id="l09010" /><CodeLine lineNumber="9010"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09011" /><CodeLine lineNumber="9011"></CodeLine>
<Link id="l09012" /><CodeLine lineNumber="9012"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Extract final value from induction recipe initially, optimize to</span></CodeLine>
<Link id="l09013" /><CodeLine lineNumber="9013"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// pre-computed end value together in optimizeInductionExitUsers.</span></CodeLine>
<Link id="l09014" /><CodeLine lineNumber="9014"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VectorPhiR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPHeaderPHIRecipe&gt;</a>(Builder.<a href="/docs/api/classes/llvm/vprecipebuilder/#af5f874dc688e86699e648825bfcbf495">getRecipe</a>(ScalarPhiI));</span></CodeLine>
<Link id="l09015" /><CodeLine lineNumber="9015"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;WideIVR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenInductionRecipe&gt;</a>(VectorPhiR)) &#123;</span></CodeLine>
<Link id="l09016" /><CodeLine lineNumber="9016"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a> &#42;ResumePhi = <a href="#a20c2e870e2c105fbf0945df09a9a5c4d">addResumePhiRecipeForInduction</a>(</span></CodeLine>
<Link id="l09017" /><CodeLine lineNumber="9017"><span class="doxyHighlight">              WideIVR, VectorPHBuilder, ScalarPHBuilder, TypeInfo,</span></CodeLine>
<Link id="l09018" /><CodeLine lineNumber="9018"><span class="doxyHighlight">              &amp;Plan.<a href="/docs/api/classes/llvm/vplan/#a233848f0bf7aef1aca22e6172e5d900d">getVectorTripCount</a>())) &#123;</span></CodeLine>
<Link id="l09019" /><CodeLine lineNumber="9019"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ResumePhi-&gt;getOpcode() == <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a36144832b0ebcda13ce881d2b60eaf91">VPInstruction::ResumePhi</a> &amp;&amp;</span></CodeLine>
<Link id="l09020" /><CodeLine lineNumber="9020"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;Expected a ResumePhi&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09021" /><CodeLine lineNumber="9021"><span class="doxyHighlight">        IVEndValues&#91;WideIVR&#93; = ResumePhi-&gt;getOperand(0);</span></CodeLine>
<Link id="l09022" /><CodeLine lineNumber="9022"><span class="doxyHighlight">        ScalarPhiIRI-&gt;addOperand(ResumePhi);</span></CodeLine>
<Link id="l09023" /><CodeLine lineNumber="9023"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09024" /><CodeLine lineNumber="9024"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09025" /><CodeLine lineNumber="9025"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// TODO: Also handle truncated inductions here. Computing end-values</span></CodeLine>
<Link id="l09026" /><CodeLine lineNumber="9026"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// separately should be done as VPlan-to-VPlan optimization, after</span></CodeLine>
<Link id="l09027" /><CodeLine lineNumber="9027"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// legalizing all resume values to use the last lane from the loop.</span></CodeLine>
<Link id="l09028" /><CodeLine lineNumber="9028"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenIntOrFpInductionRecipe&gt;</a>(VectorPhiR)-&gt;getTruncInst() &amp;&amp;</span></CodeLine>
<Link id="l09029" /><CodeLine lineNumber="9029"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;should only skip truncated wide inductions&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09030" /><CodeLine lineNumber="9030"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09031" /><CodeLine lineNumber="9031"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09032" /><CodeLine lineNumber="9032"></CodeLine>
<Link id="l09033" /><CodeLine lineNumber="9033"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The backedge value provides the value to resume coming out of a loop,</span></CodeLine>
<Link id="l09034" /><CodeLine lineNumber="9034"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// which for FORs is a vector whose last element needs to be extracted. The</span></CodeLine>
<Link id="l09035" /><CodeLine lineNumber="9035"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// start value provides the value if the loop is bypassed.</span></CodeLine>
<Link id="l09036" /><CodeLine lineNumber="9036"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsFOR = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPFirstOrderRecurrencePHIRecipe&gt;</a>(VectorPhiR);</span></CodeLine>
<Link id="l09037" /><CodeLine lineNumber="9037"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ResumeFromVectorLoop = VectorPhiR-&gt;getBackedgeValue();</span></CodeLine>
<Link id="l09038" /><CodeLine lineNumber="9038"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>() == Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>() &amp;&amp;</span></CodeLine>
<Link id="l09039" /><CodeLine lineNumber="9039"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Cannot handle loops with uncountable early exits&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09040" /><CodeLine lineNumber="9040"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsFOR)</span></CodeLine>
<Link id="l09041" /><CodeLine lineNumber="9041"><span class="doxyHighlight">      ResumeFromVectorLoop = MiddleBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(</span></CodeLine>
<Link id="l09042" /><CodeLine lineNumber="9042"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2ad6b029191d02f4c7a7dda59e44c88ab6">VPInstruction::ExtractFromEnd</a>, &#123;ResumeFromVectorLoop, OneVPV&#125;, &#123;&#125;,</span></CodeLine>
<Link id="l09043" /><CodeLine lineNumber="9043"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;vector.recur.extract&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09044" /><CodeLine lineNumber="9044"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name = IsFOR ? </span><span class="doxyHighlightStringLiteral">&quot;scalar.recur.init&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;bc.merge.rdx&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09045" /><CodeLine lineNumber="9045"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ResumePhiR = ScalarPHBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(</span></CodeLine>
<Link id="l09046" /><CodeLine lineNumber="9046"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a36144832b0ebcda13ce881d2b60eaf91">VPInstruction::ResumePhi</a>,</span></CodeLine>
<Link id="l09047" /><CodeLine lineNumber="9047"><span class="doxyHighlight">        &#123;ResumeFromVectorLoop, VectorPhiR-&gt;getStartValue()&#125;, &#123;&#125;, Name);</span></CodeLine>
<Link id="l09048" /><CodeLine lineNumber="9048"><span class="doxyHighlight">    ScalarPhiIRI-&gt;<a href="/docs/api/classes/llvm/vpuser/#af4a3b471097ab37b1672a0d88869ea51">addOperand</a>(ResumePhiR);</span></CodeLine>
<Link id="l09049" /><CodeLine lineNumber="9049"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09050" /><CodeLine lineNumber="9050"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09051" /><CodeLine lineNumber="9051"></CodeLine>
<Link id="l09052" /><CodeLine lineNumber="9052"><span class="doxyHighlightComment">// Collect VPIRInstructions for phis in the exit blocks that are modeled</span></CodeLine>
<Link id="l09053" /><CodeLine lineNumber="9053"><span class="doxyHighlightComment">// in VPlan and add the exiting VPValue as operand.</span></CodeLine>
<Link id="l09054" /><CodeLine lineNumber="9054"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/setvector">SetVector&lt;VPIRInstruction &#42;&gt;</a></span></CodeLine>
<Link id="l09055" /><CodeLine lineNumber="9055" lineLink="#a435b95efad7ea03299bd527b55b4708a"><span class="doxyHighlight"><a href="#a435b95efad7ea03299bd527b55b4708a">collectUsersInExitBlocks</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;OrigLoop, <a href="/docs/api/classes/llvm/vprecipebuilder">VPRecipeBuilder</a> &amp;Builder,</span></CodeLine>
<Link id="l09056" /><CodeLine lineNumber="9056"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</span></CodeLine>
<Link id="l09057" /><CodeLine lineNumber="9057"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;VPIRInstruction &#42;&gt;</a> ExitUsersToFix;</span></CodeLine>
<Link id="l09058" /><CodeLine lineNumber="9058"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> &#42;ExitVPBB : Plan.<a href="/docs/api/classes/llvm/vplan/#a85800ca7a821f540ad2d6d4d3c2d4208">getExitBlocks</a>()) &#123;</span></CodeLine>
<Link id="l09059" /><CodeLine lineNumber="9059"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : &#42;ExitVPBB) &#123;</span></CodeLine>
<Link id="l09060" /><CodeLine lineNumber="9060"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExitIRI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPIRInstruction&gt;</a>(&amp;R);</span></CodeLine>
<Link id="l09061" /><CodeLine lineNumber="9061"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExitIRI)</span></CodeLine>
<Link id="l09062" /><CodeLine lineNumber="9062"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09063" /><CodeLine lineNumber="9063"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExitPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;ExitIRI-&gt;getInstruction());</span></CodeLine>
<Link id="l09064" /><CodeLine lineNumber="9064"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExitPhi)</span></CodeLine>
<Link id="l09065" /><CodeLine lineNumber="9065"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09066" /><CodeLine lineNumber="9066"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExitVPBB-&gt;getSinglePredecessor() != Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>()) &#123;</span></CodeLine>
<Link id="l09067" /><CodeLine lineNumber="9067"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExitIRI-&gt;getNumOperands() ==</span></CodeLine>
<Link id="l09068" /><CodeLine lineNumber="9068"><span class="doxyHighlight">                   ExitVPBB-&gt;getPredecessors().size() &amp;&amp;</span></CodeLine>
<Link id="l09069" /><CodeLine lineNumber="9069"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;early-exit must update exit values on construction&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09070" /><CodeLine lineNumber="9070"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09071" /><CodeLine lineNumber="9071"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09072" /><CodeLine lineNumber="9072"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB = OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a1230fd674d2609b96527fe65eaf40b1b">getLoopLatch</a>();</span></CodeLine>
<Link id="l09073" /><CodeLine lineNumber="9073"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;IncomingValue = ExitPhi-&gt;getIncomingValueForBlock(ExitingBB);</span></CodeLine>
<Link id="l09074" /><CodeLine lineNumber="9074"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;V = Builder.<a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(IncomingValue);</span></CodeLine>
<Link id="l09075" /><CodeLine lineNumber="9075"><span class="doxyHighlight">      ExitIRI-&gt;addOperand(V);</span></CodeLine>
<Link id="l09076" /><CodeLine lineNumber="9076"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (V-&gt;isLiveIn())</span></CodeLine>
<Link id="l09077" /><CodeLine lineNumber="9077"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09078" /><CodeLine lineNumber="9078"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V-&gt;getDefiningRecipe()-&gt;getParent()-&gt;getEnclosingLoopRegion() &amp;&amp;</span></CodeLine>
<Link id="l09079" /><CodeLine lineNumber="9079"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Only recipes defined inside a region should need fixing.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09080" /><CodeLine lineNumber="9080"><span class="doxyHighlight">      ExitUsersToFix.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(ExitIRI);</span></CodeLine>
<Link id="l09081" /><CodeLine lineNumber="9081"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09082" /><CodeLine lineNumber="9082"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09083" /><CodeLine lineNumber="9083"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> ExitUsersToFix;</span></CodeLine>
<Link id="l09084" /><CodeLine lineNumber="9084"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09085" /><CodeLine lineNumber="9085"></CodeLine>
<Link id="l09086" /><CodeLine lineNumber="9086"><span class="doxyHighlightComment">// Add exit values to \\p Plan. Extracts are added for each entry in \\p</span></CodeLine>
<Link id="l09087" /><CodeLine lineNumber="9087"><span class="doxyHighlightComment">// ExitUsersToFix if needed and their operands are updated.</span></CodeLine>
<Link id="l09088" /><CodeLine lineNumber="9088"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l09089" /><CodeLine lineNumber="9089" lineLink="#af34d746d08a380c672cae45176f9df87"><span class="doxyHighlight"><a href="#af34d746d08a380c672cae45176f9df87">addUsersInExitBlocks</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan,</span></CodeLine>
<Link id="l09090" /><CodeLine lineNumber="9090"><span class="doxyHighlight">                     </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/setvector">SetVector&lt;VPIRInstruction &#42;&gt;</a> &amp;ExitUsersToFix) &#123;</span></CodeLine>
<Link id="l09091" /><CodeLine lineNumber="9091"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExitUsersToFix.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>())</span></CodeLine>
<Link id="l09092" /><CodeLine lineNumber="9092"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09093" /><CodeLine lineNumber="9093"></CodeLine>
<Link id="l09094" /><CodeLine lineNumber="9094"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MiddleVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>();</span></CodeLine>
<Link id="l09095" /><CodeLine lineNumber="9095"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>(MiddleVPBB, MiddleVPBB-&gt;getFirstNonPhi());</span></CodeLine>
<Link id="l09096" /><CodeLine lineNumber="9096"></CodeLine>
<Link id="l09097" /><CodeLine lineNumber="9097"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Introduce extract for exiting values and update the VPIRInstructions</span></CodeLine>
<Link id="l09098" /><CodeLine lineNumber="9098"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// modeling the corresponding LCSSA phis.</span></CodeLine>
<Link id="l09099" /><CodeLine lineNumber="9099"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpirinstruction">VPIRInstruction</a> &#42;ExitIRI : ExitUsersToFix) &#123;</span></CodeLine>
<Link id="l09100" /><CodeLine lineNumber="9100"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExitIRI-&gt;getNumOperands() == 1 &amp;&amp;</span></CodeLine>
<Link id="l09101" /><CodeLine lineNumber="9101"><span class="doxyHighlight">           ExitIRI-&gt;getParent()-&gt;getSinglePredecessor() == MiddleVPBB &amp;&amp;</span></CodeLine>
<Link id="l09102" /><CodeLine lineNumber="9102"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;exit values from early exits must be fixed when branch to &quot;</span></CodeLine>
<Link id="l09103" /><CodeLine lineNumber="9103"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;early-exit is added&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09104" /><CodeLine lineNumber="9104"><span class="doxyHighlight">    ExitIRI-&gt;extractLastLaneOfOperand(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</span></CodeLine>
<Link id="l09105" /><CodeLine lineNumber="9105"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09106" /><CodeLine lineNumber="9106"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09107" /><CodeLine lineNumber="9107"></CodeLine>
<Link id="l09108" /><CodeLine lineNumber="9108"><span class="doxyHighlightComment">/// Handle users in the exit block for first order reductions in the original</span></CodeLine>
<Link id="l09109" /><CodeLine lineNumber="9109"><span class="doxyHighlightComment">/// exit block. The penultimate value of recurrences is fed to their LCSSA phi</span></CodeLine>
<Link id="l09110" /><CodeLine lineNumber="9110"><span class="doxyHighlightComment">/// users in the original exit block using the VPIRInstruction wrapping to the</span></CodeLine>
<Link id="l09111" /><CodeLine lineNumber="9111"><span class="doxyHighlightComment">/// LCSSA phi.</span></CodeLine>
<Link id="l09112" /><CodeLine lineNumber="9112" lineLink="#a453563e4ed7e249a7f3e92b98b9052df"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a453563e4ed7e249a7f3e92b98b9052df">addExitUsersForFirstOrderRecurrences</a>(</span></CodeLine>
<Link id="l09113" /><CodeLine lineNumber="9113"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/setvector">SetVector&lt;VPIRInstruction &#42;&gt;</a> &amp;ExitUsersToFix) &#123;</span></CodeLine>
<Link id="l09114" /><CodeLine lineNumber="9114"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;VectorRegion = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</span></CodeLine>
<Link id="l09115" /><CodeLine lineNumber="9115"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ScalarPHVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#ad5f29ccf71b0494fc179323427eb1e11">getScalarPreheader</a>();</span></CodeLine>
<Link id="l09116" /><CodeLine lineNumber="9116"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MiddleVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>();</span></CodeLine>
<Link id="l09117" /><CodeLine lineNumber="9117"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> ScalarPHBuilder(ScalarPHVPBB);</span></CodeLine>
<Link id="l09118" /><CodeLine lineNumber="9118"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> MiddleBuilder(MiddleVPBB, MiddleVPBB-&gt;getFirstNonPhi());</span></CodeLine>
<Link id="l09119" /><CodeLine lineNumber="9119"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;TwoVPV = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(</span></CodeLine>
<Link id="l09120" /><CodeLine lineNumber="9120"><span class="doxyHighlight">      ConstantInt::get(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>(), 2));</span></CodeLine>
<Link id="l09121" /><CodeLine lineNumber="9121"></CodeLine>
<Link id="l09122" /><CodeLine lineNumber="9122"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;HeaderPhi : VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>()) &#123;</span></CodeLine>
<Link id="l09123" /><CodeLine lineNumber="9123"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FOR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPFirstOrderRecurrencePHIRecipe&gt;</a>(&amp;HeaderPhi);</span></CodeLine>
<Link id="l09124" /><CodeLine lineNumber="9124"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!FOR)</span></CodeLine>
<Link id="l09125" /><CodeLine lineNumber="9125"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09126" /><CodeLine lineNumber="9126"></CodeLine>
<Link id="l09127" /><CodeLine lineNumber="9127"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>() == Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>() &amp;&amp;</span></CodeLine>
<Link id="l09128" /><CodeLine lineNumber="9128"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;Cannot handle loops with uncountable early exits&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09129" /><CodeLine lineNumber="9129"></CodeLine>
<Link id="l09130" /><CodeLine lineNumber="9130"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// This is the second phase of vectorizing first-order recurrences, creating</span></CodeLine>
<Link id="l09131" /><CodeLine lineNumber="9131"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// extract for users outside the loop. An overview of the transformation is</span></CodeLine>
<Link id="l09132" /><CodeLine lineNumber="9132"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// described below. Suppose we have the following loop with some use after</span></CodeLine>
<Link id="l09133" /><CodeLine lineNumber="9133"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the loop of the last a&#91;i-1&#93;,</span></CodeLine>
<Link id="l09134" /><CodeLine lineNumber="9134"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09135" /><CodeLine lineNumber="9135"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   for (int i = 0; i &lt; n; ++i) &#123;</span></CodeLine>
<Link id="l09136" /><CodeLine lineNumber="9136"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     t = a&#91;i - 1&#93;;</span></CodeLine>
<Link id="l09137" /><CodeLine lineNumber="9137"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     b&#91;i&#93; = a&#91;i&#93; - t;</span></CodeLine>
<Link id="l09138" /><CodeLine lineNumber="9138"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   &#125;</span></CodeLine>
<Link id="l09139" /><CodeLine lineNumber="9139"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   use t;</span></CodeLine>
<Link id="l09140" /><CodeLine lineNumber="9140"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09141" /><CodeLine lineNumber="9141"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// There is a first-order recurrence on &quot;a&quot;. For this loop, the shorthand</span></CodeLine>
<Link id="l09142" /><CodeLine lineNumber="9142"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scalar IR looks like:</span></CodeLine>
<Link id="l09143" /><CodeLine lineNumber="9143"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09144" /><CodeLine lineNumber="9144"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   scalar.ph:</span></CodeLine>
<Link id="l09145" /><CodeLine lineNumber="9145"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     s.init = a&#91;-1&#93;</span></CodeLine>
<Link id="l09146" /><CodeLine lineNumber="9146"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     br scalar.body</span></CodeLine>
<Link id="l09147" /><CodeLine lineNumber="9147"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09148" /><CodeLine lineNumber="9148"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   scalar.body:</span></CodeLine>
<Link id="l09149" /><CodeLine lineNumber="9149"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     i = phi &#91;0, scalar.ph&#93;, &#91;i+1, scalar.body&#93;</span></CodeLine>
<Link id="l09150" /><CodeLine lineNumber="9150"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     s1 = phi &#91;s.init, scalar.ph&#93;, &#91;s2, scalar.body&#93;</span></CodeLine>
<Link id="l09151" /><CodeLine lineNumber="9151"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     s2 = a&#91;i&#93;</span></CodeLine>
<Link id="l09152" /><CodeLine lineNumber="9152"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     b&#91;i&#93; = s2 - s1</span></CodeLine>
<Link id="l09153" /><CodeLine lineNumber="9153"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     br cond, scalar.body, exit.block</span></CodeLine>
<Link id="l09154" /><CodeLine lineNumber="9154"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09155" /><CodeLine lineNumber="9155"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   exit.block:</span></CodeLine>
<Link id="l09156" /><CodeLine lineNumber="9156"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     use = lcssa.phi &#91;s1, scalar.body&#93;</span></CodeLine>
<Link id="l09157" /><CodeLine lineNumber="9157"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09158" /><CodeLine lineNumber="9158"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// In this example, s1 is a recurrence because it&#39;s value depends on the</span></CodeLine>
<Link id="l09159" /><CodeLine lineNumber="9159"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// previous iteration. In the first phase of vectorization, we created a</span></CodeLine>
<Link id="l09160" /><CodeLine lineNumber="9160"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// VPFirstOrderRecurrencePHIRecipe v1 for s1. Now we create the extracts</span></CodeLine>
<Link id="l09161" /><CodeLine lineNumber="9161"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// for users in the scalar preheader and exit block.</span></CodeLine>
<Link id="l09162" /><CodeLine lineNumber="9162"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09163" /><CodeLine lineNumber="9163"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   vector.ph:</span></CodeLine>
<Link id="l09164" /><CodeLine lineNumber="9164"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     v&#95;init = vector(..., ..., ..., a&#91;-1&#93;)</span></CodeLine>
<Link id="l09165" /><CodeLine lineNumber="9165"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     br vector.body</span></CodeLine>
<Link id="l09166" /><CodeLine lineNumber="9166"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09167" /><CodeLine lineNumber="9167"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   vector.body</span></CodeLine>
<Link id="l09168" /><CodeLine lineNumber="9168"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     i = phi &#91;0, vector.ph&#93;, &#91;i+4, vector.body&#93;</span></CodeLine>
<Link id="l09169" /><CodeLine lineNumber="9169"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     v1 = phi &#91;v&#95;init, vector.ph&#93;, &#91;v2, vector.body&#93;</span></CodeLine>
<Link id="l09170" /><CodeLine lineNumber="9170"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     v2 = a&#91;i, i+1, i+2, i+3&#93;</span></CodeLine>
<Link id="l09171" /><CodeLine lineNumber="9171"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     b&#91;i&#93; = v2 - v1</span></CodeLine>
<Link id="l09172" /><CodeLine lineNumber="9172"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     // Next, third phase will introduce v1&#39; = splice(v1(3), v2(0, 1, 2))</span></CodeLine>
<Link id="l09173" /><CodeLine lineNumber="9173"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     b&#91;i, i+1, i+2, i+3&#93; = v2 - v1</span></CodeLine>
<Link id="l09174" /><CodeLine lineNumber="9174"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     br cond, vector.body, middle.block</span></CodeLine>
<Link id="l09175" /><CodeLine lineNumber="9175"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09176" /><CodeLine lineNumber="9176"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   middle.block:</span></CodeLine>
<Link id="l09177" /><CodeLine lineNumber="9177"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     vector.recur.extract.for.phi = v2(2)</span></CodeLine>
<Link id="l09178" /><CodeLine lineNumber="9178"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     vector.recur.extract = v2(3)</span></CodeLine>
<Link id="l09179" /><CodeLine lineNumber="9179"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     br cond, scalar.ph, exit.block</span></CodeLine>
<Link id="l09180" /><CodeLine lineNumber="9180"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09181" /><CodeLine lineNumber="9181"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   scalar.ph:</span></CodeLine>
<Link id="l09182" /><CodeLine lineNumber="9182"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     scalar.recur.init = phi &#91;vector.recur.extract, middle.block&#93;,</span></CodeLine>
<Link id="l09183" /><CodeLine lineNumber="9183"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//                             &#91;s.init, otherwise&#93;</span></CodeLine>
<Link id="l09184" /><CodeLine lineNumber="9184"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     br scalar.body</span></CodeLine>
<Link id="l09185" /><CodeLine lineNumber="9185"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09186" /><CodeLine lineNumber="9186"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   scalar.body:</span></CodeLine>
<Link id="l09187" /><CodeLine lineNumber="9187"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     i = phi &#91;0, scalar.ph&#93;, &#91;i+1, scalar.body&#93;</span></CodeLine>
<Link id="l09188" /><CodeLine lineNumber="9188"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     s1 = phi &#91;scalar.recur.init, scalar.ph&#93;, &#91;s2, scalar.body&#93;</span></CodeLine>
<Link id="l09189" /><CodeLine lineNumber="9189"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     s2 = a&#91;i&#93;</span></CodeLine>
<Link id="l09190" /><CodeLine lineNumber="9190"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     b&#91;i&#93; = s2 - s1</span></CodeLine>
<Link id="l09191" /><CodeLine lineNumber="9191"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     br cond, scalar.body, exit.block</span></CodeLine>
<Link id="l09192" /><CodeLine lineNumber="9192"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09193" /><CodeLine lineNumber="9193"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//   exit.block:</span></CodeLine>
<Link id="l09194" /><CodeLine lineNumber="9194"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//     lo = lcssa.phi &#91;s1, scalar.body&#93;,</span></CodeLine>
<Link id="l09195" /><CodeLine lineNumber="9195"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//                    &#91;vector.recur.extract.for.phi, middle.block&#93;</span></CodeLine>
<Link id="l09196" /><CodeLine lineNumber="9196"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09197" /><CodeLine lineNumber="9197"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Now update VPIRInstructions modeling LCSSA phis in the exit block.</span></CodeLine>
<Link id="l09198" /><CodeLine lineNumber="9198"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Extract the penultimate value of the recurrence and use it as operand for</span></CodeLine>
<Link id="l09199" /><CodeLine lineNumber="9199"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the VPIRInstruction modeling the phi.</span></CodeLine>
<Link id="l09200" /><CodeLine lineNumber="9200"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vpirinstruction">VPIRInstruction</a> &#42;ExitIRI : ExitUsersToFix) &#123;</span></CodeLine>
<Link id="l09201" /><CodeLine lineNumber="9201"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExitIRI-&gt;getOperand(0) != FOR)</span></CodeLine>
<Link id="l09202" /><CodeLine lineNumber="9202"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09203" /><CodeLine lineNumber="9203"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;PenultimateElement = MiddleBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(</span></CodeLine>
<Link id="l09204" /><CodeLine lineNumber="9204"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2ad6b029191d02f4c7a7dda59e44c88ab6">VPInstruction::ExtractFromEnd</a>, &#123;FOR-&gt;getBackedgeValue(), TwoVPV&#125;, &#123;&#125;,</span></CodeLine>
<Link id="l09205" /><CodeLine lineNumber="9205"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;vector.recur.extract.for.phi&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09206" /><CodeLine lineNumber="9206"><span class="doxyHighlight">      ExitIRI-&gt;<a href="/docs/api/classes/llvm/vpuser/#a19c3591dc1eeb5648552b33f70e04b65">setOperand</a>(0, PenultimateElement);</span></CodeLine>
<Link id="l09207" /><CodeLine lineNumber="9207"><span class="doxyHighlight">      ExitUsersToFix.remove(ExitIRI);</span></CodeLine>
<Link id="l09208" /><CodeLine lineNumber="9208"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09209" /><CodeLine lineNumber="9209"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09210" /><CodeLine lineNumber="9210"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09211" /><CodeLine lineNumber="9211"></CodeLine>
<Link id="l09212" /><CodeLine lineNumber="9212"><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/#aefc42f3cefc5a839ca925b4cb3ae4a7b">VPlanPtr</a></span></CodeLine>
<Link id="l09213" /><CodeLine lineNumber="9213"><span class="doxyHighlight">LoopVectorizationPlanner::tryToBuildVPlanWithVPRecipes(<a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</span></CodeLine>
<Link id="l09214" /><CodeLine lineNumber="9214"></CodeLine>
<Link id="l09215" /><CodeLine lineNumber="9215"><span class="doxyHighlight">  SmallPtrSet&lt;const InterleaveGroup&lt;Instruction&gt; &#42;, 1&gt; InterleaveGroups;</span></CodeLine>
<Link id="l09216" /><CodeLine lineNumber="9216"></CodeLine>
<Link id="l09217" /><CodeLine lineNumber="9217"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ---------------------------------------------------------------------------</span></CodeLine>
<Link id="l09218" /><CodeLine lineNumber="9218"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build initial VPlan: Scan the body of the loop in a topological order to</span></CodeLine>
<Link id="l09219" /><CodeLine lineNumber="9219"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// visit each basic block after having visited its predecessor basic blocks.</span></CodeLine>
<Link id="l09220" /><CodeLine lineNumber="9220"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ---------------------------------------------------------------------------</span></CodeLine>
<Link id="l09221" /><CodeLine lineNumber="9221"></CodeLine>
<Link id="l09222" /><CodeLine lineNumber="9222"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create initial VPlan skeleton, having a basic block for the pre-header</span></CodeLine>
<Link id="l09223" /><CodeLine lineNumber="9223"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// which contains SCEV expansions that need to happen before the CFG is</span></CodeLine>
<Link id="l09224" /><CodeLine lineNumber="9224"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// modified; a basic block for the vector pre-header, followed by a region for</span></CodeLine>
<Link id="l09225" /><CodeLine lineNumber="9225"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the vector loop, followed by the middle basic block. The skeleton vector</span></CodeLine>
<Link id="l09226" /><CodeLine lineNumber="9226"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop region contains a header and latch basic blocks.</span></CodeLine>
<Link id="l09227" /><CodeLine lineNumber="9227"></CodeLine>
<Link id="l09228" /><CodeLine lineNumber="9228"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> RequiresScalarEpilogueCheck =</span></CodeLine>
<Link id="l09229" /><CodeLine lineNumber="9229"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</span></CodeLine>
<Link id="l09230" /><CodeLine lineNumber="9230"><span class="doxyHighlight">          &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(ElementCount VF) &#123;</span></CodeLine>
<Link id="l09231" /><CodeLine lineNumber="9231"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> !CM.requiresScalarEpilogue(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>());</span></CodeLine>
<Link id="l09232" /><CodeLine lineNumber="9232"><span class="doxyHighlight">          &#125;,</span></CodeLine>
<Link id="l09233" /><CodeLine lineNumber="9233"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</span></CodeLine>
<Link id="l09234" /><CodeLine lineNumber="9234"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#aefc42f3cefc5a839ca925b4cb3ae4a7b">VPlanPtr</a> Plan = <a href="/docs/api/classes/llvm/vplan/#a5a956378c8f267d4b2afc6e036a08d42">VPlan::createInitialVPlan</a>(Legal-&gt;getWidestInductionType(),</span></CodeLine>
<Link id="l09235" /><CodeLine lineNumber="9235"><span class="doxyHighlight">                                            PSE, RequiresScalarEpilogueCheck,</span></CodeLine>
<Link id="l09236" /><CodeLine lineNumber="9236"><span class="doxyHighlight">                                            CM.foldTailByMasking(), OrigLoop);</span></CodeLine>
<Link id="l09237" /><CodeLine lineNumber="9237"></CodeLine>
<Link id="l09238" /><CodeLine lineNumber="9238"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t use getDecisionAndClampRange here, because we don&#39;t know the UF</span></CodeLine>
<Link id="l09239" /><CodeLine lineNumber="9239"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// so this function is better to be conservative, rather than to split</span></CodeLine>
<Link id="l09240" /><CodeLine lineNumber="9240"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// it up into different VPlans.</span></CodeLine>
<Link id="l09241" /><CodeLine lineNumber="9241"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Consider using getDecisionAndClampRange here to split up VPlans.</span></CodeLine>
<Link id="l09242" /><CodeLine lineNumber="9242"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IVUpdateMayOverflow = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09243" /><CodeLine lineNumber="9243"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (ElementCount VF : <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)</span></CodeLine>
<Link id="l09244" /><CodeLine lineNumber="9244"><span class="doxyHighlight">    IVUpdateMayOverflow |= !<a href="#ab7edde995b7986f98c3f59788b960eba">isIndvarOverflowCheckKnownFalse</a>(&amp;CM, VF);</span></CodeLine>
<Link id="l09245" /><CodeLine lineNumber="9245"></CodeLine>
<Link id="l09246" /><CodeLine lineNumber="9246"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="#a29c708de8e758ac420523c94c797b501">getDebugLocFromInstOrOperands</a>(Legal-&gt;getPrimaryInduction());</span></CodeLine>
<Link id="l09247" /><CodeLine lineNumber="9247"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> <a href="/docs/api/namespaces/llvm/hexstyle/#a2ff7bb0072f1202f7b06bb426d6ecda0">Style</a> = CM.getTailFoldingStyle(IVUpdateMayOverflow);</span></CodeLine>
<Link id="l09248" /><CodeLine lineNumber="9248"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use NUW for the induction increment if we proved that it won&#39;t overflow in</span></CodeLine>
<Link id="l09249" /><CodeLine lineNumber="9249"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the vector loop or when not folding the tail. In the later case, we know</span></CodeLine>
<Link id="l09250" /><CodeLine lineNumber="9250"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// that the canonical induction increment will not overflow as the vector trip</span></CodeLine>
<Link id="l09251" /><CodeLine lineNumber="9251"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// count is &gt;= increment and a multiple of the increment.</span></CodeLine>
<Link id="l09252" /><CodeLine lineNumber="9252"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasNUW = !IVUpdateMayOverflow || <a href="/docs/api/namespaces/llvm/hexstyle/#a2ff7bb0072f1202f7b06bb426d6ecda0">Style</a> == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>;</span></CodeLine>
<Link id="l09253" /><CodeLine lineNumber="9253"><span class="doxyHighlight">  <a href="#a4d2a943e39c98ccce6fd53e8df9c5c2b">addCanonicalIVRecipes</a>(&#42;Plan, Legal-&gt;getWidestInductionType(), HasNUW, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</span></CodeLine>
<Link id="l09254" /><CodeLine lineNumber="9254"></CodeLine>
<Link id="l09255" /><CodeLine lineNumber="9255"><span class="doxyHighlight">  VPRecipeBuilder RecipeBuilder(&#42;Plan, OrigLoop, TLI, &amp;TTI, Legal, CM, PSE,</span></CodeLine>
<Link id="l09256" /><CodeLine lineNumber="9256"><span class="doxyHighlight">                                Builder);</span></CodeLine>
<Link id="l09257" /><CodeLine lineNumber="9257"></CodeLine>
<Link id="l09258" /><CodeLine lineNumber="9258"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ---------------------------------------------------------------------------</span></CodeLine>
<Link id="l09259" /><CodeLine lineNumber="9259"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Pre-construction: record ingredients whose recipes we&#39;ll need to further</span></CodeLine>
<Link id="l09260" /><CodeLine lineNumber="9260"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// process after constructing the initial VPlan.</span></CodeLine>
<Link id="l09261" /><CodeLine lineNumber="9261"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ---------------------------------------------------------------------------</span></CodeLine>
<Link id="l09262" /><CodeLine lineNumber="9262"></CodeLine>
<Link id="l09263" /><CodeLine lineNumber="9263"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For each interleave group which is relevant for this (possibly trimmed)</span></CodeLine>
<Link id="l09264" /><CodeLine lineNumber="9264"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Range, add it to the set of groups to be later applied to the VPlan and add</span></CodeLine>
<Link id="l09265" /><CodeLine lineNumber="9265"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// placeholders for its members&#39; Recipes which we&#39;ll be replacing with a</span></CodeLine>
<Link id="l09266" /><CodeLine lineNumber="9266"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// single VPInterleaveRecipe.</span></CodeLine>
<Link id="l09267" /><CodeLine lineNumber="9267"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (InterleaveGroup&lt;Instruction&gt; &#42;IG : IAI.getInterleaveGroups()) &#123;</span></CodeLine>
<Link id="l09268" /><CodeLine lineNumber="9268"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ApplyIG = &#91;IG, </span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(ElementCount VF) -&gt; </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l09269" /><CodeLine lineNumber="9269"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; </span><span class="doxyHighlightComment">// Query is illegal for VF == 1</span></CodeLine>
<Link id="l09270" /><CodeLine lineNumber="9270"><span class="doxyHighlight">                     CM.getWideningDecision(IG-&gt;getInsertPos(), VF) ==</span></CodeLine>
<Link id="l09271" /><CodeLine lineNumber="9271"><span class="doxyHighlight">                         <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971">LoopVectorizationCostModel::CM&#95;Interleave</a>);</span></CodeLine>
<Link id="l09272" /><CodeLine lineNumber="9272"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// For scalable vectors, the only interleave factor currently supported</span></CodeLine>
<Link id="l09273" /><CodeLine lineNumber="9273"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// is 2 since we require the (de)interleave2 intrinsics instead of</span></CodeLine>
<Link id="l09274" /><CodeLine lineNumber="9274"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// shufflevectors.</span></CodeLine>
<Link id="l09275" /><CodeLine lineNumber="9275"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!Result || !VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() || IG-&gt;getFactor() == 2) &amp;&amp;</span></CodeLine>
<Link id="l09276" /><CodeLine lineNumber="9276"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;Unsupported interleave factor for scalable vectors&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09277" /><CodeLine lineNumber="9277"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</span></CodeLine>
<Link id="l09278" /><CodeLine lineNumber="9278"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l09279" /><CodeLine lineNumber="9279"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">getDecisionAndClampRange</a>(ApplyIG, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>))</span></CodeLine>
<Link id="l09280" /><CodeLine lineNumber="9280"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09281" /><CodeLine lineNumber="9281"><span class="doxyHighlight">    InterleaveGroups.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(IG);</span></CodeLine>
<Link id="l09282" /><CodeLine lineNumber="9282"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09283" /><CodeLine lineNumber="9283"></CodeLine>
<Link id="l09284" /><CodeLine lineNumber="9284"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ---------------------------------------------------------------------------</span></CodeLine>
<Link id="l09285" /><CodeLine lineNumber="9285"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Construct recipes for the instructions in the loop</span></CodeLine>
<Link id="l09286" /><CodeLine lineNumber="9286"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ---------------------------------------------------------------------------</span></CodeLine>
<Link id="l09287" /><CodeLine lineNumber="9287"></CodeLine>
<Link id="l09288" /><CodeLine lineNumber="9288"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Scan the body of the loop in a topological order to visit each basic block</span></CodeLine>
<Link id="l09289" /><CodeLine lineNumber="9289"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// after having visited its predecessor basic blocks.</span></CodeLine>
<Link id="l09290" /><CodeLine lineNumber="9290"><span class="doxyHighlight">  LoopBlocksDFS DFS(OrigLoop);</span></CodeLine>
<Link id="l09291" /><CodeLine lineNumber="9291"><span class="doxyHighlight">  DFS.perform(LI);</span></CodeLine>
<Link id="l09292" /><CodeLine lineNumber="9292"></CodeLine>
<Link id="l09293" /><CodeLine lineNumber="9293"><span class="doxyHighlight">  VPBasicBlock &#42;HeaderVPBB = Plan-&gt;getVectorLoopRegion()-&gt;getEntryBasicBlock();</span></CodeLine>
<Link id="l09294" /><CodeLine lineNumber="9294"><span class="doxyHighlight">  VPBasicBlock &#42;VPBB = HeaderVPBB;</span></CodeLine>
<Link id="l09295" /><CodeLine lineNumber="9295"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;HeaderBB = OrigLoop-&gt;getHeader();</span></CodeLine>
<Link id="l09296" /><CodeLine lineNumber="9296"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> NeedsMasks =</span></CodeLine>
<Link id="l09297" /><CodeLine lineNumber="9297"><span class="doxyHighlight">      CM.foldTailByMasking() ||</span></CodeLine>
<Link id="l09298" /><CodeLine lineNumber="9298"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(OrigLoop-&gt;blocks(), &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, HeaderBB&#93;(BasicBlock &#42;BB) &#123;</span></CodeLine>
<Link id="l09299" /><CodeLine lineNumber="9299"><span class="doxyHighlight">        bool NeedsBlends = BB != HeaderBB &amp;&amp; !BB-&gt;phis().empty();</span></CodeLine>
<Link id="l09300" /><CodeLine lineNumber="9300"><span class="doxyHighlight">        return Legal-&gt;blockNeedsPredication(BB) || NeedsBlends;</span></CodeLine>
<Link id="l09301" /><CodeLine lineNumber="9301"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l09302" /><CodeLine lineNumber="9302"></CodeLine>
<Link id="l09303" /><CodeLine lineNumber="9303"><span class="doxyHighlight">  RecipeBuilder.collectScaledReductions(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</span></CodeLine>
<Link id="l09304" /><CodeLine lineNumber="9304"></CodeLine>
<Link id="l09305" /><CodeLine lineNumber="9305"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;MiddleVPBB = Plan-&gt;getMiddleBlock();</span></CodeLine>
<Link id="l09306" /><CodeLine lineNumber="9306"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock/#a2fc75e7b63babbf776ed29cfed87ae65">VPBasicBlock::iterator</a> MBIP = MiddleVPBB-&gt;getFirstNonPhi();</span></CodeLine>
<Link id="l09307" /><CodeLine lineNumber="9307"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (BasicBlock &#42;BB : <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(DFS.beginRPO(), DFS.endRPO())) &#123;</span></CodeLine>
<Link id="l09308" /><CodeLine lineNumber="9308"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Relevant instructions from basic block BB will be grouped into VPRecipe</span></CodeLine>
<Link id="l09309" /><CodeLine lineNumber="9309"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ingredients and fill a new VPBasicBlock.</span></CodeLine>
<Link id="l09310" /><CodeLine lineNumber="9310"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VPBB != HeaderVPBB)</span></CodeLine>
<Link id="l09311" /><CodeLine lineNumber="9311"><span class="doxyHighlight">      VPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a2bd1c53f9607876b22c6fd3ec1e28a50">setName</a>(BB-&gt;getName());</span></CodeLine>
<Link id="l09312" /><CodeLine lineNumber="9312"><span class="doxyHighlight">    Builder.setInsertPoint(VPBB);</span></CodeLine>
<Link id="l09313" /><CodeLine lineNumber="9313"></CodeLine>
<Link id="l09314" /><CodeLine lineNumber="9314"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VPBB == HeaderVPBB)</span></CodeLine>
<Link id="l09315" /><CodeLine lineNumber="9315"><span class="doxyHighlight">      RecipeBuilder.createHeaderMask();</span></CodeLine>
<Link id="l09316" /><CodeLine lineNumber="9316"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (NeedsMasks)</span></CodeLine>
<Link id="l09317" /><CodeLine lineNumber="9317"><span class="doxyHighlight">      RecipeBuilder.createBlockInMask(BB);</span></CodeLine>
<Link id="l09318" /><CodeLine lineNumber="9318"></CodeLine>
<Link id="l09319" /><CodeLine lineNumber="9319"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Introduce each ingredient into VPlan.</span></CodeLine>
<Link id="l09320" /><CodeLine lineNumber="9320"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Model and preserve debug intrinsics in VPlan.</span></CodeLine>
<Link id="l09321" /><CodeLine lineNumber="9321"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a9b64313b5c1907066b7bab1c60a2ea08">drop&#95;end</a>(BB-&gt;instructionsWithoutDebug(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">))) &#123;</span></CodeLine>
<Link id="l09322" /><CodeLine lineNumber="9322"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/rdf/#a173a2217e059f21fb25908fa2bf796d6">Instr</a> = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</span></CodeLine>
<Link id="l09323" /><CodeLine lineNumber="9323"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;VPValue &#42;, 4&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>;</span></CodeLine>
<Link id="l09324" /><CodeLine lineNumber="9324"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Instr);</span></CodeLine>
<Link id="l09325" /><CodeLine lineNumber="9325"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Phi &amp;&amp; <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getParent() == HeaderBB) &#123;</span></CodeLine>
<Link id="l09326" /><CodeLine lineNumber="9326"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.push&#95;back(Plan-&gt;getOrAddLiveIn(</span></CodeLine>
<Link id="l09327" /><CodeLine lineNumber="9327"><span class="doxyHighlight">            <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIncomingValueForBlock(OrigLoop-&gt;getLoopPreheader())));</span></CodeLine>
<Link id="l09328" /><CodeLine lineNumber="9328"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l09329" /><CodeLine lineNumber="9329"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> OpRange = RecipeBuilder.mapToVPValues(<a href="/docs/api/namespaces/llvm/rdf/#a173a2217e059f21fb25908fa2bf796d6">Instr</a>-&gt;operands());</span></CodeLine>
<Link id="l09330" /><CodeLine lineNumber="9330"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a> = &#123;OpRange.begin(), OpRange.end()&#125;;</span></CodeLine>
<Link id="l09331" /><CodeLine lineNumber="9331"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09332" /><CodeLine lineNumber="9332"></CodeLine>
<Link id="l09333" /><CodeLine lineNumber="9333"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// The stores with invariant address inside the loop will be deleted, and</span></CodeLine>
<Link id="l09334" /><CodeLine lineNumber="9334"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// in the exit block, a uniform store recipe will be created for the final</span></CodeLine>
<Link id="l09335" /><CodeLine lineNumber="9335"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// invariant store of the reduction.</span></CodeLine>
<Link id="l09336" /><CodeLine lineNumber="9336"><span class="doxyHighlight">      StoreInst &#42;<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>;</span></CodeLine>
<Link id="l09337" /><CodeLine lineNumber="9337"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> ((SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</span></CodeLine>
<Link id="l09338" /><CodeLine lineNumber="9338"><span class="doxyHighlight">          Legal-&gt;isInvariantAddressOfReduction(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getPointerOperand())) &#123;</span></CodeLine>
<Link id="l09339" /><CodeLine lineNumber="9339"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Only create recipe for the final invariant store of the reduction.</span></CodeLine>
<Link id="l09340" /><CodeLine lineNumber="9340"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Legal-&gt;isInvariantStoreOfReduction(SI))</span></CodeLine>
<Link id="l09341" /><CodeLine lineNumber="9341"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09342" /><CodeLine lineNumber="9342"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Recipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPReplicateRecipe(</span></CodeLine>
<Link id="l09343" /><CodeLine lineNumber="9343"><span class="doxyHighlight">            SI, RecipeBuilder.mapToVPValues(<a href="/docs/api/namespaces/llvm/rdf/#a173a2217e059f21fb25908fa2bf796d6">Instr</a>-&gt;operands()),</span></CodeLine>
<Link id="l09344" /><CodeLine lineNumber="9344"><span class="doxyHighlight">            </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42; IsUniform &#42;/</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09345" /><CodeLine lineNumber="9345"><span class="doxyHighlight">        Recipe-&gt;insertBefore(&#42;MiddleVPBB, MBIP);</span></CodeLine>
<Link id="l09346" /><CodeLine lineNumber="9346"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09347" /><CodeLine lineNumber="9347"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09348" /><CodeLine lineNumber="9348"></CodeLine>
<Link id="l09349" /><CodeLine lineNumber="9349"><span class="doxyHighlight">      VPRecipeBase &#42;Recipe =</span></CodeLine>
<Link id="l09350" /><CodeLine lineNumber="9350"><span class="doxyHighlight">          RecipeBuilder.tryToCreateWidenRecipe(Instr, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>, VPBB);</span></CodeLine>
<Link id="l09351" /><CodeLine lineNumber="9351"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Recipe)</span></CodeLine>
<Link id="l09352" /><CodeLine lineNumber="9352"><span class="doxyHighlight">        Recipe = RecipeBuilder.handleReplication(Instr, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</span></CodeLine>
<Link id="l09353" /><CodeLine lineNumber="9353"></CodeLine>
<Link id="l09354" /><CodeLine lineNumber="9354"><span class="doxyHighlight">      RecipeBuilder.setRecipe(Instr, Recipe);</span></CodeLine>
<Link id="l09355" /><CodeLine lineNumber="9355"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPHeaderPHIRecipe&gt;</a>(Recipe)) &#123;</span></CodeLine>
<Link id="l09356" /><CodeLine lineNumber="9356"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// VPHeaderPHIRecipes must be kept in the phi section of HeaderVPBB. In</span></CodeLine>
<Link id="l09357" /><CodeLine lineNumber="9357"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the following cases, VPHeaderPHIRecipes may be created after non-phi</span></CodeLine>
<Link id="l09358" /><CodeLine lineNumber="9358"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// recipes and need to be moved to the phi section of HeaderVPBB:</span></CodeLine>
<Link id="l09359" /><CodeLine lineNumber="9359"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// &#42; tail-folding (non-phi recipes computing the header mask are</span></CodeLine>
<Link id="l09360" /><CodeLine lineNumber="9360"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// introduced earlier than regular header phi recipes, and should appear</span></CodeLine>
<Link id="l09361" /><CodeLine lineNumber="9361"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// after them)</span></CodeLine>
<Link id="l09362" /><CodeLine lineNumber="9362"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// &#42; Optimizing truncates to VPWidenIntOrFpInductionRecipe.</span></CodeLine>
<Link id="l09363" /><CodeLine lineNumber="9363"></CodeLine>
<Link id="l09364" /><CodeLine lineNumber="9364"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>() == VPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a4a7f4b8433e9a788149ffd94a0a07051">end</a>() ||</span></CodeLine>
<Link id="l09365" /><CodeLine lineNumber="9365"><span class="doxyHighlight">                CM.foldTailByMasking() || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(Instr)) &amp;&amp;</span></CodeLine>
<Link id="l09366" /><CodeLine lineNumber="9366"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;unexpected recipe needs moving&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09367" /><CodeLine lineNumber="9367"><span class="doxyHighlight">        Recipe-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a8859e5e8cad5653b278964f47414fd84">insertBefore</a>(&#42;HeaderVPBB, HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>());</span></CodeLine>
<Link id="l09368" /><CodeLine lineNumber="9368"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l09369" /><CodeLine lineNumber="9369"><span class="doxyHighlight">        VPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a23773e962f9a56c9bdf13f7668b063a5">appendRecipe</a>(Recipe);</span></CodeLine>
<Link id="l09370" /><CodeLine lineNumber="9370"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09371" /><CodeLine lineNumber="9371"></CodeLine>
<Link id="l09372" /><CodeLine lineNumber="9372"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpblockutils/#a1f625b90be26a131061ab1e43740cc81">VPBlockUtils::insertBlockAfter</a>(Plan-&gt;createVPBasicBlock(</span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">), VPBB);</span></CodeLine>
<Link id="l09373" /><CodeLine lineNumber="9373"><span class="doxyHighlight">    VPBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(VPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>());</span></CodeLine>
<Link id="l09374" /><CodeLine lineNumber="9374"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09375" /><CodeLine lineNumber="9375"></CodeLine>
<Link id="l09376" /><CodeLine lineNumber="9376"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// After here, VPBB should not be used.</span></CodeLine>
<Link id="l09377" /><CodeLine lineNumber="9377"><span class="doxyHighlight">  VPBB = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09378" /><CodeLine lineNumber="9378"></CodeLine>
<Link id="l09379" /><CodeLine lineNumber="9379"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPRegionBlock&gt;</a>(Plan-&gt;getVectorLoopRegion()) &amp;&amp;</span></CodeLine>
<Link id="l09380" /><CodeLine lineNumber="9380"><span class="doxyHighlight">         !Plan-&gt;getVectorLoopRegion()-&gt;getEntryBasicBlock()-&gt;empty() &amp;&amp;</span></CodeLine>
<Link id="l09381" /><CodeLine lineNumber="9381"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;entry block must be set to a VPRegionBlock having a non-empty entry &quot;</span></CodeLine>
<Link id="l09382" /><CodeLine lineNumber="9382"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;VPBasicBlock&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09383" /><CodeLine lineNumber="9383"><span class="doxyHighlight">  RecipeBuilder.fixHeaderPhis();</span></CodeLine>
<Link id="l09384" /><CodeLine lineNumber="9384"></CodeLine>
<Link id="l09385" /><CodeLine lineNumber="9385"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Update wide induction increments to use the same step as the corresponding</span></CodeLine>
<Link id="l09386" /><CodeLine lineNumber="9386"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// wide induction. This enables detecting induction increments directly in</span></CodeLine>
<Link id="l09387" /><CodeLine lineNumber="9387"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// VPlan and removes redundant splats.</span></CodeLine>
<Link id="l09388" /><CodeLine lineNumber="9388"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;&#91;Phi, <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>&#93; : Legal-&gt;getInductionVars()) &#123;</span></CodeLine>
<Link id="l09389" /><CodeLine lineNumber="9389"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IVInc = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(</span></CodeLine>
<Link id="l09390" /><CodeLine lineNumber="9390"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIncomingValueForBlock(OrigLoop-&gt;getLoopLatch()));</span></CodeLine>
<Link id="l09391" /><CodeLine lineNumber="9391"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IVInc-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) != Phi || IVInc-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() != Instruction::Add)</span></CodeLine>
<Link id="l09392" /><CodeLine lineNumber="9392"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09393" /><CodeLine lineNumber="9393"><span class="doxyHighlight">    VPWidenInductionRecipe &#42;WideIV =</span></CodeLine>
<Link id="l09394" /><CodeLine lineNumber="9394"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenInductionRecipe&gt;</a>(RecipeBuilder.getRecipe(Phi));</span></CodeLine>
<Link id="l09395" /><CodeLine lineNumber="9395"><span class="doxyHighlight">    VPRecipeBase &#42;<a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> = RecipeBuilder.getRecipe(IVInc);</span></CodeLine>
<Link id="l09396" /><CodeLine lineNumber="9396"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>-&gt;setOperand(1, WideIV-&gt;<a href="/docs/api/classes/llvm/vpwideninductionrecipe/#a74f9beabcc57857ae7a7ba943e72776b">getStepValue</a>());</span></CodeLine>
<Link id="l09397" /><CodeLine lineNumber="9397"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09398" /><CodeLine lineNumber="9398"></CodeLine>
<Link id="l09399" /><CodeLine lineNumber="9399"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UncountableExitingBlock =</span></CodeLine>
<Link id="l09400" /><CodeLine lineNumber="9400"><span class="doxyHighlight">          Legal-&gt;getUncountableEarlyExitingBlock()) &#123;</span></CodeLine>
<Link id="l09401" /><CodeLine lineNumber="9401"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/llvm/vplantransforms/#ac2fcd61c17c94d7e9d10b24b718c812e">VPlanTransforms::handleUncountableEarlyExit</a>(</span></CodeLine>
<Link id="l09402" /><CodeLine lineNumber="9402"><span class="doxyHighlight">            &#42;Plan, &#42;PSE.getSE(), OrigLoop, UncountableExitingBlock,</span></CodeLine>
<Link id="l09403" /><CodeLine lineNumber="9403"><span class="doxyHighlight">            RecipeBuilder)) &#123;</span></CodeLine>
<Link id="l09404" /><CodeLine lineNumber="9404"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span></CodeLine>
<Link id="l09405" /><CodeLine lineNumber="9405"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;Some exit values in loop with uncountable exit not supported yet&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l09406" /><CodeLine lineNumber="9406"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot;UncountableEarlyExitLoopsUnsupportedExitValue&quot;</span><span class="doxyHighlight">, ORE, OrigLoop);</span></CodeLine>
<Link id="l09407" /><CodeLine lineNumber="9407"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09408" /><CodeLine lineNumber="9408"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09409" /><CodeLine lineNumber="9409"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09410" /><CodeLine lineNumber="9410"><span class="doxyHighlight">  DenseMap&lt;VPValue &#42;, VPValue &#42;&gt; IVEndValues;</span></CodeLine>
<Link id="l09411" /><CodeLine lineNumber="9411"><span class="doxyHighlight">  <a href="#a02106664ead4e0c4e755457dbac7f7b3">addScalarResumePhis</a>(RecipeBuilder, &#42;Plan, IVEndValues);</span></CodeLine>
<Link id="l09412" /><CodeLine lineNumber="9412"><span class="doxyHighlight">  SetVector&lt;VPIRInstruction &#42;&gt; ExitUsersToFix =</span></CodeLine>
<Link id="l09413" /><CodeLine lineNumber="9413"><span class="doxyHighlight">      <a href="#a435b95efad7ea03299bd527b55b4708a">collectUsersInExitBlocks</a>(OrigLoop, RecipeBuilder, &#42;Plan);</span></CodeLine>
<Link id="l09414" /><CodeLine lineNumber="9414"><span class="doxyHighlight">  <a href="#a453563e4ed7e249a7f3e92b98b9052df">addExitUsersForFirstOrderRecurrences</a>(&#42;Plan, ExitUsersToFix);</span></CodeLine>
<Link id="l09415" /><CodeLine lineNumber="9415"><span class="doxyHighlight">  <a href="#af34d746d08a380c672cae45176f9df87">addUsersInExitBlocks</a>(&#42;Plan, ExitUsersToFix);</span></CodeLine>
<Link id="l09416" /><CodeLine lineNumber="9416"></CodeLine>
<Link id="l09417" /><CodeLine lineNumber="9417"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ---------------------------------------------------------------------------</span></CodeLine>
<Link id="l09418" /><CodeLine lineNumber="9418"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Transform initial VPlan: Apply previously taken decisions, in order, to</span></CodeLine>
<Link id="l09419" /><CodeLine lineNumber="9419"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// bring the VPlan to its final state.</span></CodeLine>
<Link id="l09420" /><CodeLine lineNumber="9420"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// ---------------------------------------------------------------------------</span></CodeLine>
<Link id="l09421" /><CodeLine lineNumber="9421"></CodeLine>
<Link id="l09422" /><CodeLine lineNumber="9422"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Adjust the recipes for any inloop reductions.</span></CodeLine>
<Link id="l09423" /><CodeLine lineNumber="9423"><span class="doxyHighlight">  adjustRecipesForReductions(Plan, RecipeBuilder, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>.Start);</span></CodeLine>
<Link id="l09424" /><CodeLine lineNumber="9424"></CodeLine>
<Link id="l09425" /><CodeLine lineNumber="9425"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Interleave memory: for each Interleave Group we marked earlier as relevant</span></CodeLine>
<Link id="l09426" /><CodeLine lineNumber="9426"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for this VPlan, replace the Recipes widening its memory instructions with a</span></CodeLine>
<Link id="l09427" /><CodeLine lineNumber="9427"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// single VPInterleaveRecipe at its insertion point.</span></CodeLine>
<Link id="l09428" /><CodeLine lineNumber="9428"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vplantransforms/#aa88371693bc18186386b04e8c45a30e4">VPlanTransforms::createInterleaveGroups</a>(</span></CodeLine>
<Link id="l09429" /><CodeLine lineNumber="9429"><span class="doxyHighlight">      &#42;Plan, InterleaveGroups, RecipeBuilder, CM.isScalarEpilogueAllowed());</span></CodeLine>
<Link id="l09430" /><CodeLine lineNumber="9430"></CodeLine>
<Link id="l09431" /><CodeLine lineNumber="9431"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (ElementCount VF : <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)</span></CodeLine>
<Link id="l09432" /><CodeLine lineNumber="9432"><span class="doxyHighlight">    Plan-&gt;addVF(VF);</span></CodeLine>
<Link id="l09433" /><CodeLine lineNumber="9433"><span class="doxyHighlight">  Plan-&gt;setName(</span><span class="doxyHighlightStringLiteral">&quot;Initial VPlan&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09434" /><CodeLine lineNumber="9434"></CodeLine>
<Link id="l09435" /><CodeLine lineNumber="9435"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Replace VPValues for known constant strides guaranteed by predicate scalar</span></CodeLine>
<Link id="l09436" /><CodeLine lineNumber="9436"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// evolution.</span></CodeLine>
<Link id="l09437" /><CodeLine lineNumber="9437"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> CanUseVersionedStride = &#91;&amp;Plan&#93;(VPUser &amp;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>, unsigned) &#123;</span></CodeLine>
<Link id="l09438" /><CodeLine lineNumber="9438"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(&amp;U);</span></CodeLine>
<Link id="l09439" /><CodeLine lineNumber="9439"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>-&gt;getParent()-&gt;getParent() ||</span></CodeLine>
<Link id="l09440" /><CodeLine lineNumber="9440"><span class="doxyHighlight">           <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>-&gt;getParent() ==</span></CodeLine>
<Link id="l09441" /><CodeLine lineNumber="9441"><span class="doxyHighlight">               Plan-&gt;getVectorLoopRegion()-&gt;getSinglePredecessor();</span></CodeLine>
<Link id="l09442" /><CodeLine lineNumber="9442"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l09443" /><CodeLine lineNumber="9443"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#91;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>, Stride&#93; : Legal-&gt;getLAI()-&gt;getSymbolicStrides()) &#123;</span></CodeLine>
<Link id="l09444" /><CodeLine lineNumber="9444"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;StrideV = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SCEVUnknown&gt;</a>(Stride)-&gt;getValue();</span></CodeLine>
<Link id="l09445" /><CodeLine lineNumber="9445"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ScevStride = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(PSE.getSCEV(StrideV));</span></CodeLine>
<Link id="l09446" /><CodeLine lineNumber="9446"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Only handle constant strides for now.</span></CodeLine>
<Link id="l09447" /><CodeLine lineNumber="9447"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ScevStride)</span></CodeLine>
<Link id="l09448" /><CodeLine lineNumber="9448"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09449" /><CodeLine lineNumber="9449"></CodeLine>
<Link id="l09450" /><CodeLine lineNumber="9450"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;CI = Plan-&gt;getOrAddLiveIn(</span></CodeLine>
<Link id="l09451" /><CodeLine lineNumber="9451"><span class="doxyHighlight">        ConstantInt::get(Stride-&gt;getType(), ScevStride-&gt;getAPInt()));</span></CodeLine>
<Link id="l09452" /><CodeLine lineNumber="9452"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VPValue &#42;StrideVPV = Plan-&gt;getLiveIn(StrideV))</span></CodeLine>
<Link id="l09453" /><CodeLine lineNumber="9453"><span class="doxyHighlight">      StrideVPV-&gt;<a href="/docs/api/classes/llvm/value/#a7e8dad1701aa6445be4a29f654b0473c">replaceUsesWithIf</a>(CI, CanUseVersionedStride);</span></CodeLine>
<Link id="l09454" /><CodeLine lineNumber="9454"></CodeLine>
<Link id="l09455" /><CodeLine lineNumber="9455"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// The versioned value may not be used in the loop directly but through a</span></CodeLine>
<Link id="l09456" /><CodeLine lineNumber="9456"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// sext/zext. Add new live-ins in those cases.</span></CodeLine>
<Link id="l09457" /><CodeLine lineNumber="9457"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;U : StrideV-&gt;users()) &#123;</span></CodeLine>
<Link id="l09458" /><CodeLine lineNumber="9458"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst, ZExtInst&gt;</a>(U))</span></CodeLine>
<Link id="l09459" /><CodeLine lineNumber="9459"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09460" /><CodeLine lineNumber="9460"><span class="doxyHighlight">      VPValue &#42;StrideVPV = Plan-&gt;getLiveIn(U);</span></CodeLine>
<Link id="l09461" /><CodeLine lineNumber="9461"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!StrideVPV)</span></CodeLine>
<Link id="l09462" /><CodeLine lineNumber="9462"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09463" /><CodeLine lineNumber="9463"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> BW = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;getType()-&gt;getScalarSizeInBits();</span></CodeLine>
<Link id="l09464" /><CodeLine lineNumber="9464"><span class="doxyHighlight">      APInt <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(U) ? ScevStride-&gt;getAPInt().sext(BW)</span></CodeLine>
<Link id="l09465" /><CodeLine lineNumber="9465"><span class="doxyHighlight">                                 : ScevStride-&gt;getAPInt().zext(BW);</span></CodeLine>
<Link id="l09466" /><CodeLine lineNumber="9466"><span class="doxyHighlight">      VPValue &#42;CI = Plan-&gt;getOrAddLiveIn(ConstantInt::get(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;getType(), <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>));</span></CodeLine>
<Link id="l09467" /><CodeLine lineNumber="9467"><span class="doxyHighlight">      StrideVPV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ae3773dd8f9c831f0dde091319b2ff7d0">replaceUsesWithIf</a>(CI, CanUseVersionedStride);</span></CodeLine>
<Link id="l09468" /><CodeLine lineNumber="9468"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09469" /><CodeLine lineNumber="9469"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09470" /><CodeLine lineNumber="9470"></CodeLine>
<Link id="l09471" /><CodeLine lineNumber="9471"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vplantransforms/#aa0f143b8d4693978b984f0639c90e508">VPlanTransforms::dropPoisonGeneratingRecipes</a>(&#42;Plan, &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(BasicBlock &#42;BB) &#123;</span></CodeLine>
<Link id="l09472" /><CodeLine lineNumber="9472"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Legal-&gt;blockNeedsPredication(BB);</span></CodeLine>
<Link id="l09473" /><CodeLine lineNumber="9473"><span class="doxyHighlight">  &#125;);</span></CodeLine>
<Link id="l09474" /><CodeLine lineNumber="9474"></CodeLine>
<Link id="l09475" /><CodeLine lineNumber="9475"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Sink users of fixed-order recurrence past the recipe defining the previous</span></CodeLine>
<Link id="l09476" /><CodeLine lineNumber="9476"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// value and introduce FirstOrderRecurrenceSplice VPInstructions.</span></CodeLine>
<Link id="l09477" /><CodeLine lineNumber="9477"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/llvm/vplantransforms/#ae64d6953a1334207d9e7d9cd2587ee9f">VPlanTransforms::adjustFixedOrderRecurrences</a>(&#42;Plan, Builder))</span></CodeLine>
<Link id="l09478" /><CodeLine lineNumber="9478"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09479" /><CodeLine lineNumber="9479"></CodeLine>
<Link id="l09480" /><CodeLine lineNumber="9480"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#aae88a50a9a37f9a745939e3e726837e6">useActiveLaneMask</a>(Style)) &#123;</span></CodeLine>
<Link id="l09481" /><CodeLine lineNumber="9481"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Move checks to VPlanTransforms::addActiveLaneMask once</span></CodeLine>
<Link id="l09482" /><CodeLine lineNumber="9482"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TailFoldingStyle is visible there.</span></CodeLine>
<Link id="l09483" /><CodeLine lineNumber="9483"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ForControlFlow = <a href="#a4e445204e48d57b1e23e55869146b7ce">useActiveLaneMaskForControlFlow</a>(Style);</span></CodeLine>
<Link id="l09484" /><CodeLine lineNumber="9484"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> WithoutRuntimeCheck =</span></CodeLine>
<Link id="l09485" /><CodeLine lineNumber="9485"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/hexstyle/#a2ff7bb0072f1202f7b06bb426d6ecda0">Style</a> == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">TailFoldingStyle::DataAndControlFlowWithoutRuntimeCheck</a>;</span></CodeLine>
<Link id="l09486" /><CodeLine lineNumber="9486"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/vplantransforms/#ae1d2d60cd9edd9f7ca98c50789747c95">VPlanTransforms::addActiveLaneMask</a>(&#42;Plan, ForControlFlow,</span></CodeLine>
<Link id="l09487" /><CodeLine lineNumber="9487"><span class="doxyHighlight">                                       WithoutRuntimeCheck);</span></CodeLine>
<Link id="l09488" /><CodeLine lineNumber="9488"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09489" /><CodeLine lineNumber="9489"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vplantransforms/#a3a573419fed83f23b6bf70ac6731dbfa">VPlanTransforms::optimizeInductionExitUsers</a>(&#42;Plan, IVEndValues);</span></CodeLine>
<Link id="l09490" /><CodeLine lineNumber="9490"></CodeLine>
<Link id="l09491" /><CodeLine lineNumber="9491"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#af5f1d1b7df16dee92c5b56c26e322b89">verifyVPlanIsValid</a>(&#42;Plan) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;VPlan is invalid&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09492" /><CodeLine lineNumber="9492"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Plan;</span></CodeLine>
<Link id="l09493" /><CodeLine lineNumber="9493"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09494" /><CodeLine lineNumber="9494"></CodeLine>
<Link id="l09495" /><CodeLine lineNumber="9495"><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/#aefc42f3cefc5a839ca925b4cb3ae4a7b">VPlanPtr</a> LoopVectorizationPlanner::buildVPlan(<a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</span></CodeLine>
<Link id="l09496" /><CodeLine lineNumber="9496"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Outer loop handling: They may require CFG and instruction level</span></CodeLine>
<Link id="l09497" /><CodeLine lineNumber="9497"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// transformations before even evaluating whether vectorization is profitable.</span></CodeLine>
<Link id="l09498" /><CodeLine lineNumber="9498"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Since we cannot modify the incoming IR, we need to build VPlan upfront in</span></CodeLine>
<Link id="l09499" /><CodeLine lineNumber="9499"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the vectorization pipeline.</span></CodeLine>
<Link id="l09500" /><CodeLine lineNumber="9500"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!OrigLoop-&gt;isInnermost());</span></CodeLine>
<Link id="l09501" /><CodeLine lineNumber="9501"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;VPlan-native path is not enabled.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09502" /><CodeLine lineNumber="9502"></CodeLine>
<Link id="l09503" /><CodeLine lineNumber="9503"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Create new empty VPlan</span></CodeLine>
<Link id="l09504" /><CodeLine lineNumber="9504"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Plan = <a href="/docs/api/classes/llvm/vplan/#a5a956378c8f267d4b2afc6e036a08d42">VPlan::createInitialVPlan</a>(Legal-&gt;getWidestInductionType(), PSE,</span></CodeLine>
<Link id="l09505" /><CodeLine lineNumber="9505"><span class="doxyHighlight">                                        </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, OrigLoop);</span></CodeLine>
<Link id="l09506" /><CodeLine lineNumber="9506"></CodeLine>
<Link id="l09507" /><CodeLine lineNumber="9507"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build hierarchical CFG</span></CodeLine>
<Link id="l09508" /><CodeLine lineNumber="9508"><span class="doxyHighlight">  VPlanHCFGBuilder HCFGBuilder(OrigLoop, LI, &#42;Plan);</span></CodeLine>
<Link id="l09509" /><CodeLine lineNumber="9509"><span class="doxyHighlight">  HCFGBuilder.buildHierarchicalCFG();</span></CodeLine>
<Link id="l09510" /><CodeLine lineNumber="9510"></CodeLine>
<Link id="l09511" /><CodeLine lineNumber="9511"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (ElementCount VF : <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)</span></CodeLine>
<Link id="l09512" /><CodeLine lineNumber="9512"><span class="doxyHighlight">    Plan-&gt;addVF(VF);</span></CodeLine>
<Link id="l09513" /><CodeLine lineNumber="9513"></CodeLine>
<Link id="l09514" /><CodeLine lineNumber="9514"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vplantransforms/#ad210afaefb4884ac5008dd5fbaf1cbf8">VPlanTransforms::VPInstructionsToVPRecipes</a>(</span></CodeLine>
<Link id="l09515" /><CodeLine lineNumber="9515"><span class="doxyHighlight">      Plan,</span></CodeLine>
<Link id="l09516" /><CodeLine lineNumber="9516"><span class="doxyHighlight">      &#91;</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">&#93;(PHINode &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>) &#123; </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Legal-&gt;getIntOrFpInductionDescriptor(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>); &#125;,</span></CodeLine>
<Link id="l09517" /><CodeLine lineNumber="9517"><span class="doxyHighlight">      &#42;PSE.getSE(), &#42;TLI);</span></CodeLine>
<Link id="l09518" /><CodeLine lineNumber="9518"></CodeLine>
<Link id="l09519" /><CodeLine lineNumber="9519"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Tail folding is not supported for outer loops, so the induction increment</span></CodeLine>
<Link id="l09520" /><CodeLine lineNumber="9520"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is guaranteed to not wrap.</span></CodeLine>
<Link id="l09521" /><CodeLine lineNumber="9521"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> HasNUW = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09522" /><CodeLine lineNumber="9522"><span class="doxyHighlight">  <a href="#a4d2a943e39c98ccce6fd53e8df9c5c2b">addCanonicalIVRecipes</a>(&#42;Plan, Legal-&gt;getWidestInductionType(), HasNUW,</span></CodeLine>
<Link id="l09523" /><CodeLine lineNumber="9523"><span class="doxyHighlight">                        <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</span></CodeLine>
<Link id="l09524" /><CodeLine lineNumber="9524"></CodeLine>
<Link id="l09525" /><CodeLine lineNumber="9525"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect mapping of IR header phis to header phi recipes, to be used in</span></CodeLine>
<Link id="l09526" /><CodeLine lineNumber="9526"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// addScalarResumePhis.</span></CodeLine>
<Link id="l09527" /><CodeLine lineNumber="9527"><span class="doxyHighlight">  VPRecipeBuilder RecipeBuilder(&#42;Plan, OrigLoop, TLI, &amp;TTI, Legal, CM, PSE,</span></CodeLine>
<Link id="l09528" /><CodeLine lineNumber="9528"><span class="doxyHighlight">                                Builder);</span></CodeLine>
<Link id="l09529" /><CodeLine lineNumber="9529"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;R : Plan-&gt;getVectorLoopRegion()-&gt;getEntryBasicBlock()-&gt;phis()) &#123;</span></CodeLine>
<Link id="l09530" /><CodeLine lineNumber="9530"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPCanonicalIVPHIRecipe&gt;</a>(&amp;R))</span></CodeLine>
<Link id="l09531" /><CodeLine lineNumber="9531"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09532" /><CodeLine lineNumber="9532"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;HeaderR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPHeaderPHIRecipe&gt;</a>(&amp;R);</span></CodeLine>
<Link id="l09533" /><CodeLine lineNumber="9533"><span class="doxyHighlight">    RecipeBuilder.setRecipe(HeaderR-&gt;getUnderlyingInstr(), HeaderR);</span></CodeLine>
<Link id="l09534" /><CodeLine lineNumber="9534"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09535" /><CodeLine lineNumber="9535"><span class="doxyHighlight">  DenseMap&lt;VPValue &#42;, VPValue &#42;&gt; IVEndValues;</span></CodeLine>
<Link id="l09536" /><CodeLine lineNumber="9536"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: IVEndValues are not used yet in the native path, to optimize exit</span></CodeLine>
<Link id="l09537" /><CodeLine lineNumber="9537"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// values.</span></CodeLine>
<Link id="l09538" /><CodeLine lineNumber="9538"><span class="doxyHighlight">  <a href="#a02106664ead4e0c4e755457dbac7f7b3">addScalarResumePhis</a>(RecipeBuilder, &#42;Plan, IVEndValues);</span></CodeLine>
<Link id="l09539" /><CodeLine lineNumber="9539"></CodeLine>
<Link id="l09540" /><CodeLine lineNumber="9540"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#af5f1d1b7df16dee92c5b56c26e322b89">verifyVPlanIsValid</a>(&#42;Plan) &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;VPlan is invalid&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09541" /><CodeLine lineNumber="9541"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Plan;</span></CodeLine>
<Link id="l09542" /><CodeLine lineNumber="9542"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09543" /><CodeLine lineNumber="9543"></CodeLine>
<Link id="l09544" /><CodeLine lineNumber="9544"><span class="doxyHighlightComment">// Adjust the recipes for reductions. For in-loop reductions the chain of</span></CodeLine>
<Link id="l09545" /><CodeLine lineNumber="9545"><span class="doxyHighlightComment">// instructions leading from the loop exit instr to the phi need to be converted</span></CodeLine>
<Link id="l09546" /><CodeLine lineNumber="9546"><span class="doxyHighlightComment">// to reductions, with one operand being vector and the other being the scalar</span></CodeLine>
<Link id="l09547" /><CodeLine lineNumber="9547"><span class="doxyHighlightComment">// reduction chain. For other reductions, a select is introduced between the phi</span></CodeLine>
<Link id="l09548" /><CodeLine lineNumber="9548"><span class="doxyHighlightComment">// and users outside the vector region when folding the tail.</span></CodeLine>
<Link id="l09549" /><CodeLine lineNumber="9549"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09550" /><CodeLine lineNumber="9550"><span class="doxyHighlightComment">// A ComputeReductionResult recipe is added to the middle block, also for</span></CodeLine>
<Link id="l09551" /><CodeLine lineNumber="9551"><span class="doxyHighlightComment">// in-loop reductions which compute their result in-loop, because generating</span></CodeLine>
<Link id="l09552" /><CodeLine lineNumber="9552"><span class="doxyHighlightComment">// the subsequent bc.merge.rdx phi is driven by ComputeReductionResult recipes.</span></CodeLine>
<Link id="l09553" /><CodeLine lineNumber="9553"><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l09554" /><CodeLine lineNumber="9554"><span class="doxyHighlightComment">// Adjust AnyOf reductions; replace the reduction phi for the selected value</span></CodeLine>
<Link id="l09555" /><CodeLine lineNumber="9555"><span class="doxyHighlightComment">// with a boolean reduction phi node to check if the condition is true in any</span></CodeLine>
<Link id="l09556" /><CodeLine lineNumber="9556"><span class="doxyHighlightComment">// iteration. The final value is selected by the final ComputeReductionResult.</span></CodeLine>
<Link id="l09557" /><CodeLine lineNumber="9557"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> LoopVectorizationPlanner::adjustRecipesForReductions(</span></CodeLine>
<Link id="l09558" /><CodeLine lineNumber="9558"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aefc42f3cefc5a839ca925b4cb3ae4a7b">VPlanPtr</a> &amp;Plan, <a href="/docs/api/classes/llvm/vprecipebuilder">VPRecipeBuilder</a> &amp;RecipeBuilder, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MinVF) &#123;</span></CodeLine>
<Link id="l09559" /><CodeLine lineNumber="9559"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight">VPlanPatternMatch;</span></CodeLine>
<Link id="l09560" /><CodeLine lineNumber="9560"><span class="doxyHighlight">  VPRegionBlock &#42;VectorLoopRegion = Plan-&gt;getVectorLoopRegion();</span></CodeLine>
<Link id="l09561" /><CodeLine lineNumber="9561"><span class="doxyHighlight">  VPBasicBlock &#42;<a href="/docs/api/namespaces/anonymous-lvcompare-cpp-/#a1ad6686ca7dcf67bc791fff07fdf7818abf50d5e661106d0abe925af3c2e6f7e7">Header</a> = VectorLoopRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</span></CodeLine>
<Link id="l09562" /><CodeLine lineNumber="9562"><span class="doxyHighlight">  VPBasicBlock &#42;MiddleVPBB = Plan-&gt;getMiddleBlock();</span></CodeLine>
<Link id="l09563" /><CodeLine lineNumber="9563"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;VPRecipeBase &#42;&gt;</a> ToDelete;</span></CodeLine>
<Link id="l09564" /><CodeLine lineNumber="9564"></CodeLine>
<Link id="l09565" /><CodeLine lineNumber="9565"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (VPRecipeBase &amp;R : <a href="/docs/api/namespaces/anonymous-lvcompare-cpp-/#a1ad6686ca7dcf67bc791fff07fdf7818abf50d5e661106d0abe925af3c2e6f7e7">Header</a>-&gt;phis()) &#123;</span></CodeLine>
<Link id="l09566" /><CodeLine lineNumber="9566"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;PhiR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReductionPHIRecipe&gt;</a>(&amp;R);</span></CodeLine>
<Link id="l09567" /><CodeLine lineNumber="9567"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PhiR || !PhiR-&gt;isInLoop() || (MinVF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; !PhiR-&gt;isOrdered()))</span></CodeLine>
<Link id="l09568" /><CodeLine lineNumber="9568"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09569" /><CodeLine lineNumber="9569"></CodeLine>
<Link id="l09570" /><CodeLine lineNumber="9570"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> RecurrenceDescriptor &amp;RdxDesc = PhiR-&gt;getRecurrenceDescriptor();</span></CodeLine>
<Link id="l09571" /><CodeLine lineNumber="9571"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> <a href="/docs/api/namespaces/llvm/lltok/#af353621f14cb4b4b3af5ffaff84076b1">Kind</a> = RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>();</span></CodeLine>
<Link id="l09572" /><CodeLine lineNumber="9572"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l09573" /><CodeLine lineNumber="9573"><span class="doxyHighlight">        !<a href="/docs/api/classes/llvm/recurrencedescriptor/#a69df67c7d92481ae63a5d8017e96c716">RecurrenceDescriptor::isAnyOfRecurrenceKind</a>(Kind) &amp;&amp;</span></CodeLine>
<Link id="l09574" /><CodeLine lineNumber="9574"><span class="doxyHighlight">        !<a href="/docs/api/classes/llvm/recurrencedescriptor/#a7bc46d4489f4d6cb4a4e486ce5f6184b">RecurrenceDescriptor::isFindLastIVRecurrenceKind</a>(Kind) &amp;&amp;</span></CodeLine>
<Link id="l09575" /><CodeLine lineNumber="9575"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;AnyOf and FindLast reductions are not allowed for in-loop reductions&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09576" /><CodeLine lineNumber="9576"></CodeLine>
<Link id="l09577" /><CodeLine lineNumber="9577"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Collect the chain of &quot;link&quot; recipes for the reduction starting at PhiR.</span></CodeLine>
<Link id="l09578" /><CodeLine lineNumber="9578"><span class="doxyHighlight">    SetVector&lt;VPSingleDefRecipe &#42;&gt; Worklist;</span></CodeLine>
<Link id="l09579" /><CodeLine lineNumber="9579"><span class="doxyHighlight">    Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(PhiR);</span></CodeLine>
<Link id="l09580" /><CodeLine lineNumber="9580"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != Worklist.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</span></CodeLine>
<Link id="l09581" /><CodeLine lineNumber="9581"><span class="doxyHighlight">      VPSingleDefRecipe &#42;Cur = Worklist&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</span></CodeLine>
<Link id="l09582" /><CodeLine lineNumber="9582"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (VPUser &#42;U : Cur-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>()) &#123;</span></CodeLine>
<Link id="l09583" /><CodeLine lineNumber="9583"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;UserRecipe = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPSingleDefRecipe&gt;</a>(U);</span></CodeLine>
<Link id="l09584" /><CodeLine lineNumber="9584"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!UserRecipe-&gt;getParent()-&gt;getEnclosingLoopRegion()) &#123;</span></CodeLine>
<Link id="l09585" /><CodeLine lineNumber="9585"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((UserRecipe-&gt;getParent() == MiddleVPBB ||</span></CodeLine>
<Link id="l09586" /><CodeLine lineNumber="9586"><span class="doxyHighlight">                  UserRecipe-&gt;getParent() == Plan-&gt;getScalarPreheader()) &amp;&amp;</span></CodeLine>
<Link id="l09587" /><CodeLine lineNumber="9587"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;U must be either in the loop region, the middle block or the &quot;</span></CodeLine>
<Link id="l09588" /><CodeLine lineNumber="9588"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;scalar preheader.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09589" /><CodeLine lineNumber="9589"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09590" /><CodeLine lineNumber="9590"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l09591" /><CodeLine lineNumber="9591"><span class="doxyHighlight">        Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(UserRecipe);</span></CodeLine>
<Link id="l09592" /><CodeLine lineNumber="9592"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09593" /><CodeLine lineNumber="9593"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09594" /><CodeLine lineNumber="9594"></CodeLine>
<Link id="l09595" /><CodeLine lineNumber="9595"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Visit operation &quot;Links&quot; along the reduction chain top-down starting from</span></CodeLine>
<Link id="l09596" /><CodeLine lineNumber="9596"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the phi until LoopExitValue. We keep track of the previous item</span></CodeLine>
<Link id="l09597" /><CodeLine lineNumber="9597"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// (PreviousLink) to tell which of the two operands of a Link will remain</span></CodeLine>
<Link id="l09598" /><CodeLine lineNumber="9598"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scalar and which will be reduced. For minmax by select(cmp), Link will be</span></CodeLine>
<Link id="l09599" /><CodeLine lineNumber="9599"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the select instructions. Blend recipes of in-loop reduction phi&#39;s  will</span></CodeLine>
<Link id="l09600" /><CodeLine lineNumber="9600"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// get folded to their non-phi operand, as the reduction recipe handles the</span></CodeLine>
<Link id="l09601" /><CodeLine lineNumber="9601"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// condition directly.</span></CodeLine>
<Link id="l09602" /><CodeLine lineNumber="9602"><span class="doxyHighlight">    VPSingleDefRecipe &#42;PreviousLink = PhiR; </span><span class="doxyHighlightComment">// Aka Worklist&#91;0&#93;.</span></CodeLine>
<Link id="l09603" /><CodeLine lineNumber="9603"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (VPSingleDefRecipe &#42;CurrentLink : Worklist.<a href="/docs/api/classes/llvm/setvector/#a0c7d0dae14eb8a5916fff9f72d8b46d2">getArrayRef</a>().drop&#95;front()) &#123;</span></CodeLine>
<Link id="l09604" /><CodeLine lineNumber="9604"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;CurrentLinkI = CurrentLink-&gt;getUnderlyingInstr();</span></CodeLine>
<Link id="l09605" /><CodeLine lineNumber="9605"></CodeLine>
<Link id="l09606" /><CodeLine lineNumber="9606"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Index of the first operand which holds a non-mask vector operand.</span></CodeLine>
<Link id="l09607" /><CodeLine lineNumber="9607"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IndexOfFirstOperand;</span></CodeLine>
<Link id="l09608" /><CodeLine lineNumber="9608"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Recognize a call to the llvm.fmuladd intrinsic.</span></CodeLine>
<Link id="l09609" /><CodeLine lineNumber="9609"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> IsFMulAdd = (<a href="/docs/api/namespaces/llvm/lltok/#af353621f14cb4b4b3af5ffaff84076b1">Kind</a> == <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaa7dad289ea38506fb1c9b5b148405d0c">RecurKind::FMulAdd</a>);</span></CodeLine>
<Link id="l09610" /><CodeLine lineNumber="9610"><span class="doxyHighlight">      VPValue &#42;VecOp;</span></CodeLine>
<Link id="l09611" /><CodeLine lineNumber="9611"><span class="doxyHighlight">      VPBasicBlock &#42;LinkVPBB = CurrentLink-&gt;getParent();</span></CodeLine>
<Link id="l09612" /><CodeLine lineNumber="9612"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsFMulAdd) &#123;</span></CodeLine>
<Link id="l09613" /><CodeLine lineNumber="9613"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</span></CodeLine>
<Link id="l09614" /><CodeLine lineNumber="9614"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/recurrencedescriptor/#a08416fb970e8c177c7d78452d927c606">RecurrenceDescriptor::isFMulAddIntrinsic</a>(CurrentLinkI) &amp;&amp;</span></CodeLine>
<Link id="l09615" /><CodeLine lineNumber="9615"><span class="doxyHighlight">            </span><span class="doxyHighlightStringLiteral">&quot;Expected instruction to be a call to the llvm.fmuladd intrinsic&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09616" /><CodeLine lineNumber="9616"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(((MinVF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPReplicateRecipe&gt;</a>(CurrentLink)) ||</span></CodeLine>
<Link id="l09617" /><CodeLine lineNumber="9617"><span class="doxyHighlight">                <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenIntrinsicRecipe&gt;</a>(CurrentLink)) &amp;&amp;</span></CodeLine>
<Link id="l09618" /><CodeLine lineNumber="9618"><span class="doxyHighlight">               CurrentLink-&gt;getOperand(2) == PreviousLink &amp;&amp;</span></CodeLine>
<Link id="l09619" /><CodeLine lineNumber="9619"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;expected a call where the previous link is the added operand&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09620" /><CodeLine lineNumber="9620"></CodeLine>
<Link id="l09621" /><CodeLine lineNumber="9621"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// If the instruction is a call to the llvm.fmuladd intrinsic then we</span></CodeLine>
<Link id="l09622" /><CodeLine lineNumber="9622"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// need to create an fmul recipe (multiplying the first two operands of</span></CodeLine>
<Link id="l09623" /><CodeLine lineNumber="9623"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the fmuladd together) to use as the vector operand for the fadd</span></CodeLine>
<Link id="l09624" /><CodeLine lineNumber="9624"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// reduction.</span></CodeLine>
<Link id="l09625" /><CodeLine lineNumber="9625"><span class="doxyHighlight">        VPInstruction &#42;FMulRecipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPInstruction(</span></CodeLine>
<Link id="l09626" /><CodeLine lineNumber="9626"><span class="doxyHighlight">            Instruction::FMul,</span></CodeLine>
<Link id="l09627" /><CodeLine lineNumber="9627"><span class="doxyHighlight">            &#123;CurrentLink-&gt;getOperand(0), CurrentLink-&gt;getOperand(1)&#125;,</span></CodeLine>
<Link id="l09628" /><CodeLine lineNumber="9628"><span class="doxyHighlight">            CurrentLinkI-&gt;<a href="/docs/api/classes/llvm/instruction/#a9a167f91db810097d281b1ed627f4575">getFastMathFlags</a>());</span></CodeLine>
<Link id="l09629" /><CodeLine lineNumber="9629"><span class="doxyHighlight">        LinkVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#adfdd504b078cce3b90e7c5cf1f5164db">insert</a>(FMulRecipe, CurrentLink-&gt;getIterator());</span></CodeLine>
<Link id="l09630" /><CodeLine lineNumber="9630"><span class="doxyHighlight">        VecOp = FMulRecipe;</span></CodeLine>
<Link id="l09631" /><CodeLine lineNumber="9631"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l09632" /><CodeLine lineNumber="9632"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Blend = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPBlendRecipe&gt;</a>(CurrentLink);</span></CodeLine>
<Link id="l09633" /><CodeLine lineNumber="9633"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (PhiR-&gt;isInLoop() &amp;&amp; Blend) &#123;</span></CodeLine>
<Link id="l09634" /><CodeLine lineNumber="9634"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Blend-&gt;getNumIncomingValues() == 2 &amp;&amp;</span></CodeLine>
<Link id="l09635" /><CodeLine lineNumber="9635"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;Blend must have 2 incoming values&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09636" /><CodeLine lineNumber="9636"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Blend-&gt;getIncomingValue(0) == PhiR)</span></CodeLine>
<Link id="l09637" /><CodeLine lineNumber="9637"><span class="doxyHighlight">            Blend-&gt;replaceAllUsesWith(Blend-&gt;getIncomingValue(1));</span></CodeLine>
<Link id="l09638" /><CodeLine lineNumber="9638"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l09639" /><CodeLine lineNumber="9639"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Blend-&gt;getIncomingValue(1) == PhiR &amp;&amp;</span></CodeLine>
<Link id="l09640" /><CodeLine lineNumber="9640"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;PhiR must be an operand of the blend&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09641" /><CodeLine lineNumber="9641"><span class="doxyHighlight">            Blend-&gt;replaceAllUsesWith(Blend-&gt;getIncomingValue(0));</span></CodeLine>
<Link id="l09642" /><CodeLine lineNumber="9642"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l09643" /><CodeLine lineNumber="9643"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09644" /><CodeLine lineNumber="9644"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l09645" /><CodeLine lineNumber="9645"></CodeLine>
<Link id="l09646" /><CodeLine lineNumber="9646"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#af08d243545b64f4b77161992d0e2366e">RecurrenceDescriptor::isMinMaxRecurrenceKind</a>(Kind)) &#123;</span></CodeLine>
<Link id="l09647" /><CodeLine lineNumber="9647"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenRecipe&gt;</a>(CurrentLink)) &#123;</span></CodeLine>
<Link id="l09648" /><CodeLine lineNumber="9648"><span class="doxyHighlight">            <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CmpInst&gt;</a>(CurrentLinkI) &amp;&amp;</span></CodeLine>
<Link id="l09649" /><CodeLine lineNumber="9649"><span class="doxyHighlight">                   </span><span class="doxyHighlightStringLiteral">&quot;need to have the compare of the select&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09650" /><CodeLine lineNumber="9650"><span class="doxyHighlight">            </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09651" /><CodeLine lineNumber="9651"><span class="doxyHighlight">          &#125;</span></CodeLine>
<Link id="l09652" /><CodeLine lineNumber="9652"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenSelectRecipe&gt;</a>(CurrentLink) &amp;&amp;</span></CodeLine>
<Link id="l09653" /><CodeLine lineNumber="9653"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;must be a select recipe&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09654" /><CodeLine lineNumber="9654"><span class="doxyHighlight">          IndexOfFirstOperand = 1;</span></CodeLine>
<Link id="l09655" /><CodeLine lineNumber="9655"><span class="doxyHighlight">        &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l09656" /><CodeLine lineNumber="9656"><span class="doxyHighlight">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((MinVF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenRecipe&gt;</a>(CurrentLink)) &amp;&amp;</span></CodeLine>
<Link id="l09657" /><CodeLine lineNumber="9657"><span class="doxyHighlight">                 </span><span class="doxyHighlightStringLiteral">&quot;Expected to replace a VPWidenSC&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09658" /><CodeLine lineNumber="9658"><span class="doxyHighlight">          IndexOfFirstOperand = 0;</span></CodeLine>
<Link id="l09659" /><CodeLine lineNumber="9659"><span class="doxyHighlight">        &#125;</span></CodeLine>
<Link id="l09660" /><CodeLine lineNumber="9660"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Note that for non-commutable operands (cmp-selects), the semantics of</span></CodeLine>
<Link id="l09661" /><CodeLine lineNumber="9661"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// the cmp-select are captured in the recurrence kind.</span></CodeLine>
<Link id="l09662" /><CodeLine lineNumber="9662"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> VecOpId =</span></CodeLine>
<Link id="l09663" /><CodeLine lineNumber="9663"><span class="doxyHighlight">            CurrentLink-&gt;getOperand(IndexOfFirstOperand) == PreviousLink</span></CodeLine>
<Link id="l09664" /><CodeLine lineNumber="9664"><span class="doxyHighlight">                ? IndexOfFirstOperand + 1</span></CodeLine>
<Link id="l09665" /><CodeLine lineNumber="9665"><span class="doxyHighlight">                : IndexOfFirstOperand;</span></CodeLine>
<Link id="l09666" /><CodeLine lineNumber="9666"><span class="doxyHighlight">        VecOp = CurrentLink-&gt;getOperand(VecOpId);</span></CodeLine>
<Link id="l09667" /><CodeLine lineNumber="9667"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VecOp != PreviousLink &amp;&amp;</span></CodeLine>
<Link id="l09668" /><CodeLine lineNumber="9668"><span class="doxyHighlight">               CurrentLink-&gt;getOperand(CurrentLink-&gt;getNumOperands() - 1 -</span></CodeLine>
<Link id="l09669" /><CodeLine lineNumber="9669"><span class="doxyHighlight">                                       (VecOpId - IndexOfFirstOperand)) ==</span></CodeLine>
<Link id="l09670" /><CodeLine lineNumber="9670"><span class="doxyHighlight">                   PreviousLink &amp;&amp;</span></CodeLine>
<Link id="l09671" /><CodeLine lineNumber="9671"><span class="doxyHighlight">               </span><span class="doxyHighlightStringLiteral">&quot;PreviousLink must be the operand other than VecOp&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09672" /><CodeLine lineNumber="9672"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09673" /><CodeLine lineNumber="9673"></CodeLine>
<Link id="l09674" /><CodeLine lineNumber="9674"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;BB = CurrentLinkI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</span></CodeLine>
<Link id="l09675" /><CodeLine lineNumber="9675"><span class="doxyHighlight">      VPValue &#42;CondOp = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09676" /><CodeLine lineNumber="9676"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CM.blockNeedsPredicationForAnyReason(BB))</span></CodeLine>
<Link id="l09677" /><CodeLine lineNumber="9677"><span class="doxyHighlight">        CondOp = RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(BB);</span></CodeLine>
<Link id="l09678" /><CodeLine lineNumber="9678"></CodeLine>
<Link id="l09679" /><CodeLine lineNumber="9679"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;RedRecipe = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPReductionRecipe(</span></CodeLine>
<Link id="l09680" /><CodeLine lineNumber="9680"><span class="doxyHighlight">          RdxDesc, CurrentLinkI, PreviousLink, VecOp, CondOp,</span></CodeLine>
<Link id="l09681" /><CodeLine lineNumber="9681"><span class="doxyHighlight">          CM.useOrderedReductions(RdxDesc), CurrentLinkI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</span></CodeLine>
<Link id="l09682" /><CodeLine lineNumber="9682"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Append the recipe to the end of the VPBasicBlock because we need to</span></CodeLine>
<Link id="l09683" /><CodeLine lineNumber="9683"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// ensure that it comes after all of it&#39;s inputs, including CondOp.</span></CodeLine>
<Link id="l09684" /><CodeLine lineNumber="9684"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Delete CurrentLink as it will be invalid if its operand is replaced</span></CodeLine>
<Link id="l09685" /><CodeLine lineNumber="9685"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// with a reduction defined at the bottom of the block in the next link.</span></CodeLine>
<Link id="l09686" /><CodeLine lineNumber="9686"><span class="doxyHighlight">      LinkVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a23773e962f9a56c9bdf13f7668b063a5">appendRecipe</a>(RedRecipe);</span></CodeLine>
<Link id="l09687" /><CodeLine lineNumber="9687"><span class="doxyHighlight">      CurrentLink-&gt;replaceAllUsesWith(RedRecipe);</span></CodeLine>
<Link id="l09688" /><CodeLine lineNumber="9688"><span class="doxyHighlight">      ToDelete.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CurrentLink);</span></CodeLine>
<Link id="l09689" /><CodeLine lineNumber="9689"><span class="doxyHighlight">      PreviousLink = RedRecipe;</span></CodeLine>
<Link id="l09690" /><CodeLine lineNumber="9690"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09691" /><CodeLine lineNumber="9691"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09692" /><CodeLine lineNumber="9692"><span class="doxyHighlight">  VPBasicBlock &#42;LatchVPBB = VectorLoopRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a28da654f916bf44da5513b6f1788835c">getExitingBasicBlock</a>();</span></CodeLine>
<Link id="l09693" /><CodeLine lineNumber="9693"><span class="doxyHighlight">  Builder.setInsertPoint(&amp;&#42;LatchVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a4e30ea9d413dd86c802fee94aa8b5805">begin</a>());</span></CodeLine>
<Link id="l09694" /><CodeLine lineNumber="9694"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock/#a2fc75e7b63babbf776ed29cfed87ae65">VPBasicBlock::iterator</a> IP = MiddleVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>();</span></CodeLine>
<Link id="l09695" /><CodeLine lineNumber="9695"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (VPRecipeBase &amp;R :</span></CodeLine>
<Link id="l09696" /><CodeLine lineNumber="9696"><span class="doxyHighlight">       Plan-&gt;getVectorLoopRegion()-&gt;getEntryBasicBlock()-&gt;phis()) &#123;</span></CodeLine>
<Link id="l09697" /><CodeLine lineNumber="9697"><span class="doxyHighlight">    VPReductionPHIRecipe &#42;PhiR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReductionPHIRecipe&gt;</a>(&amp;R);</span></CodeLine>
<Link id="l09698" /><CodeLine lineNumber="9698"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PhiR)</span></CodeLine>
<Link id="l09699" /><CodeLine lineNumber="9699"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09700" /><CodeLine lineNumber="9700"></CodeLine>
<Link id="l09701" /><CodeLine lineNumber="9701"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> RecurrenceDescriptor &amp;RdxDesc = PhiR-&gt;<a href="/docs/api/classes/llvm/vpreductionphirecipe/#add56c575c69df41fbddde0c4cad13271">getRecurrenceDescriptor</a>();</span></CodeLine>
<Link id="l09702" /><CodeLine lineNumber="9702"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If tail is folded by masking, introduce selects between the phi</span></CodeLine>
<Link id="l09703" /><CodeLine lineNumber="9703"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// and the users outside the vector region of each reduction, at the</span></CodeLine>
<Link id="l09704" /><CodeLine lineNumber="9704"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// beginning of the dedicated latch block.</span></CodeLine>
<Link id="l09705" /><CodeLine lineNumber="9705"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OrigExitingVPV = PhiR-&gt;<a href="/docs/api/classes/llvm/vpheaderphirecipe/#a80333e8d5f353fb9e929388e577a593f">getBackedgeValue</a>();</span></CodeLine>
<Link id="l09706" /><CodeLine lineNumber="9706"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;NewExitingVPV = PhiR-&gt;<a href="/docs/api/classes/llvm/vpheaderphirecipe/#a80333e8d5f353fb9e929388e577a593f">getBackedgeValue</a>();</span></CodeLine>
<Link id="l09707" /><CodeLine lineNumber="9707"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!PhiR-&gt;<a href="/docs/api/classes/llvm/vpreductionphirecipe/#a9e146bc33d1c57399c7b777576f7768e">isInLoop</a>() &amp;&amp; CM.foldTailByMasking()) &#123;</span></CodeLine>
<Link id="l09708" /><CodeLine lineNumber="9708"><span class="doxyHighlight">      VPValue &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(OrigLoop-&gt;getHeader());</span></CodeLine>
<Link id="l09709" /><CodeLine lineNumber="9709"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OrigExitingVPV-&gt;getDefiningRecipe()-&gt;getParent() != LatchVPBB &amp;&amp;</span></CodeLine>
<Link id="l09710" /><CodeLine lineNumber="9710"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;reduction recipe must be defined before latch&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09711" /><CodeLine lineNumber="9711"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PhiTy = PhiR-&gt;<a href="/docs/api/classes/llvm/vpuser/#a6e1b252a9bbdc1a440fb57a6257b97f4">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ac6f0bd9ed63fe4a784697d73ae3b6fa0">getLiveInIRValue</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l09712" /><CodeLine lineNumber="9712"><span class="doxyHighlight">      std::optional&lt;FastMathFlags&gt; FMFs =</span></CodeLine>
<Link id="l09713" /><CodeLine lineNumber="9713"><span class="doxyHighlight">          PhiTy-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>()</span></CodeLine>
<Link id="l09714" /><CodeLine lineNumber="9714"><span class="doxyHighlight">              ? std::make&#95;optional(RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a0d5c759e770c1c6032d077a1b9cf7172">getFastMathFlags</a>())</span></CodeLine>
<Link id="l09715" /><CodeLine lineNumber="9715"><span class="doxyHighlight">              : std::nullopt;</span></CodeLine>
<Link id="l09716" /><CodeLine lineNumber="9716"><span class="doxyHighlight">      NewExitingVPV =</span></CodeLine>
<Link id="l09717" /><CodeLine lineNumber="9717"><span class="doxyHighlight">          Builder.createSelect(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, OrigExitingVPV, PhiR, &#123;&#125;, </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight">, FMFs);</span></CodeLine>
<Link id="l09718" /><CodeLine lineNumber="9718"><span class="doxyHighlight">      OrigExitingVPV-&gt;replaceUsesWithIf(NewExitingVPV, &#91;&#93;(VPUser &amp;U, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l09719" /><CodeLine lineNumber="9719"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPInstruction&gt;</a>(&amp;U) &amp;&amp;</span></CodeLine>
<Link id="l09720" /><CodeLine lineNumber="9720"><span class="doxyHighlight">               <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPInstruction&gt;</a>(&amp;U)-&gt;getOpcode() ==</span></CodeLine>
<Link id="l09721" /><CodeLine lineNumber="9721"><span class="doxyHighlight">                   <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2ad9b4011dc2ac58da0fecd16d99f1f17d">VPInstruction::ComputeReductionResult</a>;</span></CodeLine>
<Link id="l09722" /><CodeLine lineNumber="9722"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l09723" /><CodeLine lineNumber="9723"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CM.usePredicatedReductionSelect(</span></CodeLine>
<Link id="l09724" /><CodeLine lineNumber="9724"><span class="doxyHighlight">              PhiR-&gt;<a href="/docs/api/classes/llvm/vpreductionphirecipe/#add56c575c69df41fbddde0c4cad13271">getRecurrenceDescriptor</a>().<a href="/docs/api/classes/llvm/recurrencedescriptor/#a30ee597b72598bc7939d3a40d2a5ba20">getOpcode</a>(), PhiTy))</span></CodeLine>
<Link id="l09725" /><CodeLine lineNumber="9725"><span class="doxyHighlight">        PhiR-&gt;<a href="/docs/api/classes/llvm/vpuser/#a19c3591dc1eeb5648552b33f70e04b65">setOperand</a>(1, NewExitingVPV);</span></CodeLine>
<Link id="l09726" /><CodeLine lineNumber="9726"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09727" /><CodeLine lineNumber="9727"></CodeLine>
<Link id="l09728" /><CodeLine lineNumber="9728"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// If the vector reduction can be performed in a smaller type, we truncate</span></CodeLine>
<Link id="l09729" /><CodeLine lineNumber="9729"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// then extend the loop exit value to enable InstCombine to evaluate the</span></CodeLine>
<Link id="l09730" /><CodeLine lineNumber="9730"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// entire expression in the smaller type.</span></CodeLine>
<Link id="l09731" /><CodeLine lineNumber="9731"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PhiTy = PhiR-&gt;<a href="/docs/api/classes/llvm/vpheaderphirecipe/#a92c12c8e69e03cc781dd010cdaa5f0e6">getStartValue</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ac6f0bd9ed63fe4a784697d73ae3b6fa0">getLiveInIRValue</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</span></CodeLine>
<Link id="l09732" /><CodeLine lineNumber="9732"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (MinVF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; PhiTy != RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>() &amp;&amp;</span></CodeLine>
<Link id="l09733" /><CodeLine lineNumber="9733"><span class="doxyHighlight">        !<a href="/docs/api/classes/llvm/recurrencedescriptor/#a69df67c7d92481ae63a5d8017e96c716">RecurrenceDescriptor::isAnyOfRecurrenceKind</a>(</span></CodeLine>
<Link id="l09734" /><CodeLine lineNumber="9734"><span class="doxyHighlight">            RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>())) &#123;</span></CodeLine>
<Link id="l09735" /><CodeLine lineNumber="9735"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!PhiR-&gt;<a href="/docs/api/classes/llvm/vpreductionphirecipe/#a9e146bc33d1c57399c7b777576f7768e">isInLoop</a>() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Unexpected truncated inloop reduction!&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09736" /><CodeLine lineNumber="9736"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;RdxTy = RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>();</span></CodeLine>
<Link id="l09737" /><CodeLine lineNumber="9737"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Trunc =</span></CodeLine>
<Link id="l09738" /><CodeLine lineNumber="9738"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPWidenCastRecipe(Instruction::Trunc, NewExitingVPV, RdxTy);</span></CodeLine>
<Link id="l09739" /><CodeLine lineNumber="9739"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Extnd =</span></CodeLine>
<Link id="l09740" /><CodeLine lineNumber="9740"><span class="doxyHighlight">          RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a855906f5a6f429db8978680fd6de7886">isSigned</a>()</span></CodeLine>
<Link id="l09741" /><CodeLine lineNumber="9741"><span class="doxyHighlight">              ? </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPWidenCastRecipe(Instruction::SExt, Trunc, PhiTy)</span></CodeLine>
<Link id="l09742" /><CodeLine lineNumber="9742"><span class="doxyHighlight">              : new VPWidenCastRecipe(<a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a>::<a href="/docs/api/namespaces/anonymous-riscvisellowering-cpp-/#a0fb45dddfe1615e320ac9ad137d634e7aa2f0622a02fc4af2ec7bd22803523662">ZExt</a>, Trunc, PhiTy);</span></CodeLine>
<Link id="l09743" /><CodeLine lineNumber="9743"></CodeLine>
<Link id="l09744" /><CodeLine lineNumber="9744"><span class="doxyHighlight">      Trunc-&gt;insertAfter(NewExitingVPV-&gt;getDefiningRecipe());</span></CodeLine>
<Link id="l09745" /><CodeLine lineNumber="9745"><span class="doxyHighlight">      Extnd-&gt;insertAfter(Trunc);</span></CodeLine>
<Link id="l09746" /><CodeLine lineNumber="9746"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#acdfbcf188e2d4a80837e89de2ccdffab">if</a> (PhiR-&gt;<a href="/docs/api/classes/llvm/vpuser/#a6e1b252a9bbdc1a440fb57a6257b97f4">getOperand</a>(1) == NewExitingVPV)</span></CodeLine>
<Link id="l09747" /><CodeLine lineNumber="9747"><span class="doxyHighlight">        PhiR-&gt;<a href="/docs/api/classes/llvm/vpuser/#a19c3591dc1eeb5648552b33f70e04b65">setOperand</a>(1, Extnd-&gt;getVPSingleValue());</span></CodeLine>
<Link id="l09748" /><CodeLine lineNumber="9748"><span class="doxyHighlight">      NewExitingVPV = Extnd;</span></CodeLine>
<Link id="l09749" /><CodeLine lineNumber="9749"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09750" /><CodeLine lineNumber="9750"></CodeLine>
<Link id="l09751" /><CodeLine lineNumber="9751"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// We want code in the middle block to appear to execute on the location of</span></CodeLine>
<Link id="l09752" /><CodeLine lineNumber="9752"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the scalar loop&#39;s latch terminator because: (a) it is all compiler</span></CodeLine>
<Link id="l09753" /><CodeLine lineNumber="9753"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// generated, (b) these instructions are always executed after evaluating</span></CodeLine>
<Link id="l09754" /><CodeLine lineNumber="9754"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// the latch conditional branch, and (c) other passes may add new</span></CodeLine>
<Link id="l09755" /><CodeLine lineNumber="9755"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// predecessors which terminate on this line. This is the easiest way to</span></CodeLine>
<Link id="l09756" /><CodeLine lineNumber="9756"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ensure we don&#39;t accidentally cause an extra step back into the loop while</span></CodeLine>
<Link id="l09757" /><CodeLine lineNumber="9757"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// debugging.</span></CodeLine>
<Link id="l09758" /><CodeLine lineNumber="9758"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> ExitDL = OrigLoop-&gt;getLoopLatch()-&gt;getTerminator()-&gt;getDebugLoc();</span></CodeLine>
<Link id="l09759" /><CodeLine lineNumber="9759"></CodeLine>
<Link id="l09760" /><CodeLine lineNumber="9760"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: At the moment ComputeReductionResult also drives creation of the</span></CodeLine>
<Link id="l09761" /><CodeLine lineNumber="9761"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// bc.merge.rdx phi nodes, hence it needs to be created unconditionally here</span></CodeLine>
<Link id="l09762" /><CodeLine lineNumber="9762"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// even for in-loop reductions, until the reduction resume value handling is</span></CodeLine>
<Link id="l09763" /><CodeLine lineNumber="9763"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// also modeled in VPlan.</span></CodeLine>
<Link id="l09764" /><CodeLine lineNumber="9764"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;FinalReductionResult = </span><span class="doxyHighlightKeyword">new</span><span class="doxyHighlight"> VPInstruction(</span></CodeLine>
<Link id="l09765" /><CodeLine lineNumber="9765"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2ad9b4011dc2ac58da0fecd16d99f1f17d">VPInstruction::ComputeReductionResult</a>, &#123;PhiR, NewExitingVPV&#125;, ExitDL);</span></CodeLine>
<Link id="l09766" /><CodeLine lineNumber="9766"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Update all users outside the vector region.</span></CodeLine>
<Link id="l09767" /><CodeLine lineNumber="9767"><span class="doxyHighlight">    OrigExitingVPV-&gt;replaceUsesWithIf(</span></CodeLine>
<Link id="l09768" /><CodeLine lineNumber="9768"><span class="doxyHighlight">        FinalReductionResult, &#91;&#93;(VPUser &amp;User, </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l09769" /><CodeLine lineNumber="9769"><span class="doxyHighlight">          </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;Parent = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(&amp;User)-&gt;getParent();</span></CodeLine>
<Link id="l09770" /><CodeLine lineNumber="9770"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> Parent &amp;&amp; !Parent-&gt;getParent();</span></CodeLine>
<Link id="l09771" /><CodeLine lineNumber="9771"><span class="doxyHighlight">        &#125;);</span></CodeLine>
<Link id="l09772" /><CodeLine lineNumber="9772"><span class="doxyHighlight">    FinalReductionResult-&gt;insertBefore(&#42;MiddleVPBB, IP);</span></CodeLine>
<Link id="l09773" /><CodeLine lineNumber="9773"></CodeLine>
<Link id="l09774" /><CodeLine lineNumber="9774"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Adjust AnyOf reductions; replace the reduction phi for the selected value</span></CodeLine>
<Link id="l09775" /><CodeLine lineNumber="9775"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// with a boolean reduction phi node to check if the condition is true in</span></CodeLine>
<Link id="l09776" /><CodeLine lineNumber="9776"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// any iteration. The final value is selected by the final</span></CodeLine>
<Link id="l09777" /><CodeLine lineNumber="9777"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// ComputeReductionResult.</span></CodeLine>
<Link id="l09778" /><CodeLine lineNumber="9778"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a69df67c7d92481ae63a5d8017e96c716">RecurrenceDescriptor::isAnyOfRecurrenceKind</a>(</span></CodeLine>
<Link id="l09779" /><CodeLine lineNumber="9779"><span class="doxyHighlight">            RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>())) &#123;</span></CodeLine>
<Link id="l09780" /><CodeLine lineNumber="9780"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(&#42;<a href="/docs/api/namespaces/llvm/#ac78c09ae232b2ce188ff590d51e3c268">find&#95;if</a>(PhiR-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>(), &#91;&#93;(VPUser &#42;U) &#123;</span></CodeLine>
<Link id="l09781" /><CodeLine lineNumber="9781"><span class="doxyHighlight">        return isa&lt;VPWidenSelectRecipe&gt;(U) ||</span></CodeLine>
<Link id="l09782" /><CodeLine lineNumber="9782"><span class="doxyHighlight">               (isa&lt;VPReplicateRecipe&gt;(U) &amp;&amp;</span></CodeLine>
<Link id="l09783" /><CodeLine lineNumber="9783"><span class="doxyHighlight">                cast&lt;VPReplicateRecipe&gt;(U)-&gt;getUnderlyingInstr()-&gt;getOpcode() ==</span></CodeLine>
<Link id="l09784" /><CodeLine lineNumber="9784"><span class="doxyHighlight">                    Instruction::Select);</span></CodeLine>
<Link id="l09785" /><CodeLine lineNumber="9785"><span class="doxyHighlight">      &#125;));</span></CodeLine>
<Link id="l09786" /><CodeLine lineNumber="9786"><span class="doxyHighlight">      VPValue &#42;<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getOperand(0);</span></CodeLine>
<Link id="l09787" /><CodeLine lineNumber="9787"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the compare is checking the reduction PHI node, adjust it to check</span></CodeLine>
<Link id="l09788" /><CodeLine lineNumber="9788"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// the start value.</span></CodeLine>
<Link id="l09789" /><CodeLine lineNumber="9789"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VPRecipeBase &#42;CmpR = <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getDefiningRecipe()) &#123;</span></CodeLine>
<Link id="l09790" /><CodeLine lineNumber="9790"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != CmpR-&gt;getNumOperands(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</span></CodeLine>
<Link id="l09791" /><CodeLine lineNumber="9791"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CmpR-&gt;getOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) == PhiR)</span></CodeLine>
<Link id="l09792" /><CodeLine lineNumber="9792"><span class="doxyHighlight">            CmpR-&gt;setOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, PhiR-&gt;<a href="/docs/api/classes/llvm/vpheaderphirecipe/#a92c12c8e69e03cc781dd010cdaa5f0e6">getStartValue</a>());</span></CodeLine>
<Link id="l09793" /><CodeLine lineNumber="9793"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09794" /><CodeLine lineNumber="9794"><span class="doxyHighlight">      VPBuilder::InsertPointGuard Guard(Builder);</span></CodeLine>
<Link id="l09795" /><CodeLine lineNumber="9795"><span class="doxyHighlight">      Builder.setInsertPoint(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>);</span></CodeLine>
<Link id="l09796" /><CodeLine lineNumber="9796"></CodeLine>
<Link id="l09797" /><CodeLine lineNumber="9797"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If the true value of the select is the reduction phi, the new value is</span></CodeLine>
<Link id="l09798" /><CodeLine lineNumber="9798"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// selected if the negated condition is true in any iteration.</span></CodeLine>
<Link id="l09799" /><CodeLine lineNumber="9799"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getOperand(1) == PhiR)</span></CodeLine>
<Link id="l09800" /><CodeLine lineNumber="9800"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = Builder.createNot(Cmp);</span></CodeLine>
<Link id="l09801" /><CodeLine lineNumber="9801"><span class="doxyHighlight">      VPValue &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">Or</a> = Builder.createOr(PhiR, Cmp);</span></CodeLine>
<Link id="l09802" /><CodeLine lineNumber="9802"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getVPSingleValue()-&gt;replaceAllUsesWith(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">Or</a>);</span></CodeLine>
<Link id="l09803" /><CodeLine lineNumber="9803"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Delete Select now that it has invalid types.</span></CodeLine>
<Link id="l09804" /><CodeLine lineNumber="9804"><span class="doxyHighlight">      ToDelete.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>);</span></CodeLine>
<Link id="l09805" /><CodeLine lineNumber="9805"></CodeLine>
<Link id="l09806" /><CodeLine lineNumber="9806"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Convert the reduction phi to operate on bools.</span></CodeLine>
<Link id="l09807" /><CodeLine lineNumber="9807"><span class="doxyHighlight">      PhiR-&gt;<a href="/docs/api/classes/llvm/vpuser/#a19c3591dc1eeb5648552b33f70e04b65">setOperand</a>(0, Plan-&gt;getOrAddLiveIn(<a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(</span></CodeLine>
<Link id="l09808" /><CodeLine lineNumber="9808"><span class="doxyHighlight">                              OrigLoop-&gt;getHeader()-&gt;getContext())));</span></CodeLine>
<Link id="l09809" /><CodeLine lineNumber="9809"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09810" /><CodeLine lineNumber="9810"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09811" /><CodeLine lineNumber="9811"></CodeLine>
<Link id="l09812" /><CodeLine lineNumber="9812"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a7bc46d4489f4d6cb4a4e486ce5f6184b">RecurrenceDescriptor::isFindLastIVRecurrenceKind</a>(</span></CodeLine>
<Link id="l09813" /><CodeLine lineNumber="9813"><span class="doxyHighlight">            RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>())) &#123;</span></CodeLine>
<Link id="l09814" /><CodeLine lineNumber="9814"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Adjust the start value for FindLastIV recurrences to use the sentinel</span></CodeLine>
<Link id="l09815" /><CodeLine lineNumber="9815"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// value after generating the ResumePhi recipe, which uses the original</span></CodeLine>
<Link id="l09816" /><CodeLine lineNumber="9816"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// start value.</span></CodeLine>
<Link id="l09817" /><CodeLine lineNumber="9817"><span class="doxyHighlight">      PhiR-&gt;<a href="/docs/api/classes/llvm/vpuser/#a19c3591dc1eeb5648552b33f70e04b65">setOperand</a>(0, Plan-&gt;getOrAddLiveIn(RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#aed10715d943d3e1b4ca75b585ea96ab8">getSentinelValue</a>()));</span></CodeLine>
<Link id="l09818" /><CodeLine lineNumber="9818"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09819" /><CodeLine lineNumber="9819"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09820" /><CodeLine lineNumber="9820"></CodeLine>
<Link id="l09821" /><CodeLine lineNumber="9821"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vplantransforms/#ace9e1e6e7295914973dec18350b382ca">VPlanTransforms::clearReductionWrapFlags</a>(&#42;Plan);</span></CodeLine>
<Link id="l09822" /><CodeLine lineNumber="9822"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (VPRecipeBase &#42;R : ToDelete)</span></CodeLine>
<Link id="l09823" /><CodeLine lineNumber="9823"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>-&gt;eraseFromParent();</span></CodeLine>
<Link id="l09824" /><CodeLine lineNumber="9824"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09825" /><CodeLine lineNumber="9825"></CodeLine>
<Link id="l09826" /><CodeLine lineNumber="9826" lineLink="/docs/api/classes/llvm/vpderivedivrecipe/#a0f37fe11b57d14686c7ca5e7a3846174"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpderivedivrecipe/#a0f37fe11b57d14686c7ca5e7a3846174">VPDerivedIVRecipe::execute</a>(<a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State) &#123;</span></CodeLine>
<Link id="l09827" /><CodeLine lineNumber="9827"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!State.Lane &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;VPDerivedIVRecipe being replicated.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09828" /><CodeLine lineNumber="9828"></CodeLine>
<Link id="l09829" /><CodeLine lineNumber="9829"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Fast-math-flags propagate from the original induction instruction.</span></CodeLine>
<Link id="l09830" /><CodeLine lineNumber="9830"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/irbuilderbase/fastmathflagguard">IRBuilder&lt;&gt;::FastMathFlagGuard</a> FMFG(State.Builder);</span></CodeLine>
<Link id="l09831" /><CodeLine lineNumber="9831"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (FPBinOp)</span></CodeLine>
<Link id="l09832" /><CodeLine lineNumber="9832"><span class="doxyHighlight">    State.Builder.setFastMathFlags(FPBinOp-&gt;getFastMathFlags());</span></CodeLine>
<Link id="l09833" /><CodeLine lineNumber="9833"></CodeLine>
<Link id="l09834" /><CodeLine lineNumber="9834"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Step = State.get(<a href="/docs/api/classes/llvm/vpderivedivrecipe/#a49cc736389970ff14e3f53d8b5664674">getStepValue</a>(), <a href="/docs/api/classes/llvm/vplane">VPLane</a>(0));</span></CodeLine>
<Link id="l09835" /><CodeLine lineNumber="9835"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Index = State.get(<a href="/docs/api/classes/llvm/vpuser/#a6e1b252a9bbdc1a440fb57a6257b97f4">getOperand</a>(1), <a href="/docs/api/classes/llvm/vplane">VPLane</a>(0));</span></CodeLine>
<Link id="l09836" /><CodeLine lineNumber="9836"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;DerivedIV = <a href="#a23f5821d9ac264ae25dd087747e2c181">emitTransformedIndex</a>(</span></CodeLine>
<Link id="l09837" /><CodeLine lineNumber="9837"><span class="doxyHighlight">      State.Builder, Index, <a href="/docs/api/classes/llvm/vpderivedivrecipe/#aeb71527486a6730ec967f207fe2ac4fd">getStartValue</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ac6f0bd9ed63fe4a784697d73ae3b6fa0">getLiveInIRValue</a>(), Step, Kind,</span></CodeLine>
<Link id="l09838" /><CodeLine lineNumber="9838"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a07be078de4a2c223bd6a76e24e1c02db">cast&#95;if&#95;present&lt;BinaryOperator&gt;</a>(FPBinOp));</span></CodeLine>
<Link id="l09839" /><CodeLine lineNumber="9839"><span class="doxyHighlight">  DerivedIV-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(Name);</span></CodeLine>
<Link id="l09840" /><CodeLine lineNumber="9840"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If index is the vector trip count, the concrete value will only be set in</span></CodeLine>
<Link id="l09841" /><CodeLine lineNumber="9841"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// prepareToExecute, leading to missed simplifications, e.g. if it is 0</span></CodeLine>
<Link id="l09842" /><CodeLine lineNumber="9842"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: Remove the special case for the vector trip count once it is computed</span></CodeLine>
<Link id="l09843" /><CodeLine lineNumber="9843"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// in VPlan and can be used during VPlan simplification.</span></CodeLine>
<Link id="l09844" /><CodeLine lineNumber="9844"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((DerivedIV != Index ||</span></CodeLine>
<Link id="l09845" /><CodeLine lineNumber="9845"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/vpuser/#a6e1b252a9bbdc1a440fb57a6257b97f4">getOperand</a>(1) == &amp;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>()-&gt;getPlan()-&gt;getVectorTripCount()) &amp;&amp;</span></CodeLine>
<Link id="l09846" /><CodeLine lineNumber="9846"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;IV didn&#39;t need transforming?&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09847" /><CodeLine lineNumber="9847"><span class="doxyHighlight">  State.set(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, DerivedIV, <a href="/docs/api/classes/llvm/vplane">VPLane</a>(0));</span></CodeLine>
<Link id="l09848" /><CodeLine lineNumber="9848"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09849" /><CodeLine lineNumber="9849"></CodeLine>
<Link id="l09850" /><CodeLine lineNumber="9850" lineLink="/docs/api/classes/llvm/vpreplicaterecipe/#a2ed5b7b284097278ee4e550897b1f057"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpreplicaterecipe/#a2ed5b7b284097278ee4e550897b1f057">VPReplicateRecipe::execute</a>(<a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State) &#123;</span></CodeLine>
<Link id="l09851" /><CodeLine lineNumber="9851"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/classes/llvm/vpsingledefrecipe/#a12b12fbdf160f2cf70973e09adbf97d4">getUnderlyingInstr</a>();</span></CodeLine>
<Link id="l09852" /><CodeLine lineNumber="9852"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (State.Lane) &#123; </span><span class="doxyHighlightComment">// Generate a single instance.</span></CodeLine>
<Link id="l09853" /><CodeLine lineNumber="9853"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((State.VF.isScalar() || !<a href="/docs/api/classes/llvm/vpreplicaterecipe/#a8bb23947220a946748e3f1e6e6825155">isUniform</a>()) &amp;&amp;</span></CodeLine>
<Link id="l09854" /><CodeLine lineNumber="9854"><span class="doxyHighlight">           </span><span class="doxyHighlightStringLiteral">&quot;uniform recipe shouldn&#39;t be predicated&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09855" /><CodeLine lineNumber="9855"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!State.VF.isScalable() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t scalarize a scalable vector&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09856" /><CodeLine lineNumber="9856"><span class="doxyHighlight">    State.ILV-&gt;scalarizeInstruction(UI, </span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, &#42;State.Lane, State);</span></CodeLine>
<Link id="l09857" /><CodeLine lineNumber="9857"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Insert scalar instance packing it into a vector.</span></CodeLine>
<Link id="l09858" /><CodeLine lineNumber="9858"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (State.VF.isVector() &amp;&amp; <a href="/docs/api/classes/llvm/vpreplicaterecipe/#af0ce1d62aef3b8e6a79ebe1703f5a7d2">shouldPack</a>()) &#123;</span></CodeLine>
<Link id="l09859" /><CodeLine lineNumber="9859"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we&#39;re constructing lane 0, initialize to start from poison.</span></CodeLine>
<Link id="l09860" /><CodeLine lineNumber="9860"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (State.Lane-&gt;isFirstLane()) &#123;</span></CodeLine>
<Link id="l09861" /><CodeLine lineNumber="9861"><span class="doxyHighlight">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!State.VF.isScalable() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;VF is assumed to be non scalable.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09862" /><CodeLine lineNumber="9862"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64asmprinter-cpp/#a434449d5a0f4b334aca9163b13b6286ba02b848adda8d7d33a2b25d87dbef1d75">Poison</a> = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(</span></CodeLine>
<Link id="l09863" /><CodeLine lineNumber="9863"><span class="doxyHighlight">            <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(UI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), State.VF));</span></CodeLine>
<Link id="l09864" /><CodeLine lineNumber="9864"><span class="doxyHighlight">        State.set(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64asmprinter-cpp/#a434449d5a0f4b334aca9163b13b6286ba02b848adda8d7d33a2b25d87dbef1d75">Poison</a>);</span></CodeLine>
<Link id="l09865" /><CodeLine lineNumber="9865"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l09866" /><CodeLine lineNumber="9866"><span class="doxyHighlight">      State.packScalarIntoVectorValue(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, &#42;State.Lane);</span></CodeLine>
<Link id="l09867" /><CodeLine lineNumber="9867"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l09868" /><CodeLine lineNumber="9868"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09869" /><CodeLine lineNumber="9869"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09870" /><CodeLine lineNumber="9870"></CodeLine>
<Link id="l09871" /><CodeLine lineNumber="9871"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IsUniform) &#123;</span></CodeLine>
<Link id="l09872" /><CodeLine lineNumber="9872"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Uniform within VL means we need to generate lane 0</span></CodeLine>
<Link id="l09873" /><CodeLine lineNumber="9873"><span class="doxyHighlight">    State.ILV-&gt;scalarizeInstruction(UI, </span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/vplane">VPLane</a>(0), State);</span></CodeLine>
<Link id="l09874" /><CodeLine lineNumber="9874"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09875" /><CodeLine lineNumber="9875"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09876" /><CodeLine lineNumber="9876"></CodeLine>
<Link id="l09877" /><CodeLine lineNumber="9877"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// A store of a loop varying value to a uniform address only needs the last</span></CodeLine>
<Link id="l09878" /><CodeLine lineNumber="9878"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// copy of the store.</span></CodeLine>
<Link id="l09879" /><CodeLine lineNumber="9879"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(UI) &amp;&amp;</span></CodeLine>
<Link id="l09880" /><CodeLine lineNumber="9880"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/vputils/#a002a77cdbc23293b8f7a8458ffd0f905">vputils::isUniformAfterVectorization</a>(<a href="/docs/api/classes/llvm/vpuser/#a6e1b252a9bbdc1a440fb57a6257b97f4">getOperand</a>(1))) &#123;</span></CodeLine>
<Link id="l09881" /><CodeLine lineNumber="9881"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> Lane = <a href="/docs/api/classes/llvm/vplane/#a0e95bf2235bec4b650114e87c75e072c">VPLane::getLastLaneForVF</a>(State.VF);</span></CodeLine>
<Link id="l09882" /><CodeLine lineNumber="9882"><span class="doxyHighlight">    State.ILV-&gt;scalarizeInstruction(UI, </span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/vplane">VPLane</a>(Lane), State);</span></CodeLine>
<Link id="l09883" /><CodeLine lineNumber="9883"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09884" /><CodeLine lineNumber="9884"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09885" /><CodeLine lineNumber="9885"></CodeLine>
<Link id="l09886" /><CodeLine lineNumber="9886"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Generate scalar instances for all VF lanes.</span></CodeLine>
<Link id="l09887" /><CodeLine lineNumber="9887"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!State.VF.isScalable() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t scalarize a scalable vector&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09888" /><CodeLine lineNumber="9888"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> EndLane = State.VF.getKnownMinValue();</span></CodeLine>
<Link id="l09889" /><CodeLine lineNumber="9889"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> Lane = 0; Lane &lt; EndLane; ++Lane)</span></CodeLine>
<Link id="l09890" /><CodeLine lineNumber="9890"><span class="doxyHighlight">    State.ILV-&gt;scalarizeInstruction(UI, </span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">, <a href="/docs/api/classes/llvm/vplane">VPLane</a>(Lane), State);</span></CodeLine>
<Link id="l09891" /><CodeLine lineNumber="9891"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09892" /><CodeLine lineNumber="9892"></CodeLine>
<Link id="l09893" /><CodeLine lineNumber="9893"><span class="doxyHighlightComment">// Determine how to lower the scalar epilogue, which depends on 1) optimising</span></CodeLine>
<Link id="l09894" /><CodeLine lineNumber="9894"><span class="doxyHighlightComment">// for minimum code-size, 2) predicate compiler options, 3) loop hints forcing</span></CodeLine>
<Link id="l09895" /><CodeLine lineNumber="9895"><span class="doxyHighlightComment">// predication, and 4) a TTI hook that analyses whether the loop is suitable</span></CodeLine>
<Link id="l09896" /><CodeLine lineNumber="9896"><span class="doxyHighlightComment">// for predication.</span></CodeLine>
<Link id="l09897" /><CodeLine lineNumber="9897" lineLink="#a8cde912cc23c18f493e4e5005c85748b"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> <a href="#a8cde912cc23c18f493e4e5005c85748b">getScalarEpilogueLowering</a>(</span></CodeLine>
<Link id="l09898" /><CodeLine lineNumber="9898"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> &amp;Hints, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI,</span></CodeLine>
<Link id="l09899" /><CodeLine lineNumber="9899"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI,</span></CodeLine>
<Link id="l09900" /><CodeLine lineNumber="9900"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &amp;LVL, <a href="/docs/api/classes/llvm/interleavedaccessinfo">InterleavedAccessInfo</a> &#42;IAI) &#123;</span></CodeLine>
<Link id="l09901" /><CodeLine lineNumber="9901"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1) OptSize takes precedence over all other options, i.e. if this is set,</span></CodeLine>
<Link id="l09902" /><CodeLine lineNumber="9902"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// don&#39;t look at hints or options, and don&#39;t request a scalar epilogue.</span></CodeLine>
<Link id="l09903" /><CodeLine lineNumber="9903"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// (For PGSO, as shouldOptimizeForSize isn&#39;t currently accessible from</span></CodeLine>
<Link id="l09904" /><CodeLine lineNumber="9904"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// LoopAccessInfo (due to code dependency and not being able to reliably get</span></CodeLine>
<Link id="l09905" /><CodeLine lineNumber="9905"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// PSI/BFI from a loop analysis under NPM), we cannot suppress the collection</span></CodeLine>
<Link id="l09906" /><CodeLine lineNumber="9906"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// of strides in LoopAccessInfo::analyzeLoop() and vectorize without</span></CodeLine>
<Link id="l09907" /><CodeLine lineNumber="9907"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// versioning when the vectorization is forced, unlike hasOptSize. So revert</span></CodeLine>
<Link id="l09908" /><CodeLine lineNumber="9908"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// back to the old way and vectorize with versioning when forced. See D81345.)</span></CodeLine>
<Link id="l09909" /><CodeLine lineNumber="9909"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;hasOptSize() || (<a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(L-&gt;getHeader(), PSI, BFI,</span></CodeLine>
<Link id="l09910" /><CodeLine lineNumber="9910"><span class="doxyHighlight">                                                      <a href="/docs/api/namespaces/llvm/#aec7c967a5416fa6e154433965357a50ea089e7eb4db258e05f70eef4ed5aa10bb">PGSOQueryType::IRPass</a>) &amp;&amp;</span></CodeLine>
<Link id="l09911" /><CodeLine lineNumber="9911"><span class="doxyHighlight">                          Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a20ecacbd54e401685d798d86161af6cf">getForce</a>() != <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a>))</span></CodeLine>
<Link id="l09912" /><CodeLine lineNumber="9912"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da4f61afe29426363c5cf62d4ee93199b7">CM&#95;ScalarEpilogueNotAllowedOptSize</a>;</span></CodeLine>
<Link id="l09913" /><CodeLine lineNumber="9913"></CodeLine>
<Link id="l09914" /><CodeLine lineNumber="9914"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2) If set, obey the directives</span></CodeLine>
<Link id="l09915" /><CodeLine lineNumber="9915"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#abe3c68238712d04bbe3a70f3a8f483f5">PreferPredicateOverEpilogue</a>.getNumOccurrences()) &#123;</span></CodeLine>
<Link id="l09916" /><CodeLine lineNumber="9916"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (<a href="#abe3c68238712d04bbe3a70f3a8f483f5">PreferPredicateOverEpilogue</a>) &#123;</span></CodeLine>
<Link id="l09917" /><CodeLine lineNumber="9917"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa114bc9020d046f551b06f41f6f4539f7">PreferPredicateTy::ScalarEpilogue</a>:</span></CodeLine>
<Link id="l09918" /><CodeLine lineNumber="9918"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>;</span></CodeLine>
<Link id="l09919" /><CodeLine lineNumber="9919"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa3111b239a92c1674cea87d025e818091">PreferPredicateTy::PredicateElseScalarEpilogue</a>:</span></CodeLine>
<Link id="l09920" /><CodeLine lineNumber="9920"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>;</span></CodeLine>
<Link id="l09921" /><CodeLine lineNumber="9921"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa5e6f0abe1c426939c61d8924cfa02e5a">PreferPredicateTy::PredicateOrDontVectorize</a>:</span></CodeLine>
<Link id="l09922" /><CodeLine lineNumber="9922"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9dab8edd8f39c728bd8b0045b64768ef206">CM&#95;ScalarEpilogueNotAllowedUsePredicate</a>;</span></CodeLine>
<Link id="l09923" /><CodeLine lineNumber="9923"><span class="doxyHighlight">    &#125;;</span></CodeLine>
<Link id="l09924" /><CodeLine lineNumber="9924"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09925" /><CodeLine lineNumber="9925"></CodeLine>
<Link id="l09926" /><CodeLine lineNumber="9926"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 3) If set, obey the hints</span></CodeLine>
<Link id="l09927" /><CodeLine lineNumber="9927"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">switch</span><span class="doxyHighlight"> (Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a7592f6d851162d7f66f26408f40e9388">getPredicate</a>()) &#123;</span></CodeLine>
<Link id="l09928" /><CodeLine lineNumber="9928"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a>:</span></CodeLine>
<Link id="l09929" /><CodeLine lineNumber="9929"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>;</span></CodeLine>
<Link id="l09930" /><CodeLine lineNumber="9930"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">case</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea980c2c6e59ca5dcf413baa325d8bc385">LoopVectorizeHints::FK&#95;Disabled</a>:</span></CodeLine>
<Link id="l09931" /><CodeLine lineNumber="9931"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>;</span></CodeLine>
<Link id="l09932" /><CodeLine lineNumber="9932"><span class="doxyHighlight">  &#125;;</span></CodeLine>
<Link id="l09933" /><CodeLine lineNumber="9933"></CodeLine>
<Link id="l09934" /><CodeLine lineNumber="9934"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 4) if the TTI hook indicates this is profitable, request predication.</span></CodeLine>
<Link id="l09935" /><CodeLine lineNumber="9935"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/tailfoldinginfo">TailFoldingInfo</a> TFI(TLI, &amp;LVL, IAI);</span></CodeLine>
<Link id="l09936" /><CodeLine lineNumber="9936"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;preferPredicateOverEpilogue(&amp;TFI))</span></CodeLine>
<Link id="l09937" /><CodeLine lineNumber="9937"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>;</span></CodeLine>
<Link id="l09938" /><CodeLine lineNumber="9938"></CodeLine>
<Link id="l09939" /><CodeLine lineNumber="9939"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>;</span></CodeLine>
<Link id="l09940" /><CodeLine lineNumber="9940"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l09941" /><CodeLine lineNumber="9941"></CodeLine>
<Link id="l09942" /><CodeLine lineNumber="9942"><span class="doxyHighlightComment">// Process the loop in the VPlan-native vectorization path. This path builds</span></CodeLine>
<Link id="l09943" /><CodeLine lineNumber="9943"><span class="doxyHighlightComment">// VPlan upfront in the vectorization pipeline, which allows to apply</span></CodeLine>
<Link id="l09944" /><CodeLine lineNumber="9944"><span class="doxyHighlightComment">// VPlan-to-VPlan transformations from the very beginning without modifying the</span></CodeLine>
<Link id="l09945" /><CodeLine lineNumber="9945"><span class="doxyHighlightComment">// input LLVM IR.</span></CodeLine>
<Link id="l09946" /><CodeLine lineNumber="9946" lineLink="#adeb41c907ebde15846bc643325909f95"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#adeb41c907ebde15846bc643325909f95">processLoopInVPlanNativePath</a>(</span></CodeLine>
<Link id="l09947" /><CodeLine lineNumber="9947"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;PSE, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</span></CodeLine>
<Link id="l09948" /><CodeLine lineNumber="9948"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;LVL, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l09949" /><CodeLine lineNumber="9949"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI, <a href="/docs/api/classes/llvm/demandedbits">DemandedBits</a> &#42;DB, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</span></CodeLine>
<Link id="l09950" /><CodeLine lineNumber="9950"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI,</span></CodeLine>
<Link id="l09951" /><CodeLine lineNumber="9951"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI, <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> &amp;Hints,</span></CodeLine>
<Link id="l09952" /><CodeLine lineNumber="9952"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loopvectorizationrequirements">LoopVectorizationRequirements</a> &amp;Requirements) &#123;</span></CodeLine>
<Link id="l09953" /><CodeLine lineNumber="9953"></CodeLine>
<Link id="l09954" /><CodeLine lineNumber="9954"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(PSE.<a href="/docs/api/classes/llvm/predicatedscalarevolution/#ada1db826f3d2266fe2c4d06218d8d342">getBackedgeTakenCount</a>())) &#123;</span></CodeLine>
<Link id="l09955" /><CodeLine lineNumber="9955"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: cannot compute the outer-loop trip count\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09956" /><CodeLine lineNumber="9956"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09957" /><CodeLine lineNumber="9957"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l09958" /><CodeLine lineNumber="9958"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a> &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;VPlan-native path is disabled.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09959" /><CodeLine lineNumber="9959"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = L-&gt;getHeader()-&gt;getParent();</span></CodeLine>
<Link id="l09960" /><CodeLine lineNumber="9960"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/interleavedaccessinfo">InterleavedAccessInfo</a> IAI(PSE, L, DT, LI, LVL-&gt;<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab5632546144c4db5bbe1f975aeebd9d2">getLAI</a>());</span></CodeLine>
<Link id="l09961" /><CodeLine lineNumber="9961"></CodeLine>
<Link id="l09962" /><CodeLine lineNumber="9962"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> </span><span class="doxyHighlightKeywordType">SEL</span><span class="doxyHighlight"> =</span></CodeLine>
<Link id="l09963" /><CodeLine lineNumber="9963"><span class="doxyHighlight">      <a href="#a8cde912cc23c18f493e4e5005c85748b">getScalarEpilogueLowering</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, L, Hints, PSI, BFI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, TLI, &#42;LVL, &amp;IAI);</span></CodeLine>
<Link id="l09964" /><CodeLine lineNumber="9964"></CodeLine>
<Link id="l09965" /><CodeLine lineNumber="9965"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> CM(</span><span class="doxyHighlightKeywordType">SEL</span><span class="doxyHighlight">, L, PSE, LI, LVL, &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, TLI, DB, AC, ORE, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l09966" /><CodeLine lineNumber="9966"><span class="doxyHighlight">                                &amp;Hints, IAI);</span></CodeLine>
<Link id="l09967" /><CodeLine lineNumber="9967"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use the planner for outer loop vectorization.</span></CodeLine>
<Link id="l09968" /><CodeLine lineNumber="9968"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: CM is not used at this point inside the planner. Turn CM into an</span></CodeLine>
<Link id="l09969" /><CodeLine lineNumber="9969"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// optional argument if we don&#39;t need it in the future.</span></CodeLine>
<Link id="l09970" /><CodeLine lineNumber="9970"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationplanner">LoopVectorizationPlanner</a> LVP(L, LI, DT, TLI, &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, LVL, CM, IAI, PSE, Hints,</span></CodeLine>
<Link id="l09971" /><CodeLine lineNumber="9971"><span class="doxyHighlight">                               ORE);</span></CodeLine>
<Link id="l09972" /><CodeLine lineNumber="9972"></CodeLine>
<Link id="l09973" /><CodeLine lineNumber="9973"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get user vectorization factor.</span></CodeLine>
<Link id="l09974" /><CodeLine lineNumber="9974"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF = Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a50cae5c2df432357d50f182d310ce7b7">getWidth</a>();</span></CodeLine>
<Link id="l09975" /><CodeLine lineNumber="9975"></CodeLine>
<Link id="l09976" /><CodeLine lineNumber="9976"><span class="doxyHighlight">  CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a06f5d9725a2b1f7b06e8bf51f7d31417">collectElementTypesForWidening</a>();</span></CodeLine>
<Link id="l09977" /><CodeLine lineNumber="9977"></CodeLine>
<Link id="l09978" /><CodeLine lineNumber="9978"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Plan how to best vectorize, return the best VF and its cost.</span></CodeLine>
<Link id="l09979" /><CodeLine lineNumber="9979"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> VF = LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a2206e77c573f4947146faa681ea8855e">planInVPlanNativePath</a>(UserVF);</span></CodeLine>
<Link id="l09980" /><CodeLine lineNumber="9980"></CodeLine>
<Link id="l09981" /><CodeLine lineNumber="9981"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If we are stress testing VPlan builds, do not attempt to generate vector</span></CodeLine>
<Link id="l09982" /><CodeLine lineNumber="9982"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// code. Masked vector code generation support will follow soon.</span></CodeLine>
<Link id="l09983" /><CodeLine lineNumber="9983"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Also, do not attempt to vectorize if no vector code will be produced.</span></CodeLine>
<Link id="l09984" /><CodeLine lineNumber="9984"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#a9f30855a6efcd4a12875deb88880b510">VPlanBuildStressTest</a> || <a href="/docs/api/structs/llvm/vectorizationfactor/#acd24dfdad4f887e1f7b10c9039a05930">VectorizationFactor::Disabled</a>() == VF)</span></CodeLine>
<Link id="l09985" /><CodeLine lineNumber="9985"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l09986" /><CodeLine lineNumber="9986"></CodeLine>
<Link id="l09987" /><CodeLine lineNumber="9987"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;BestPlan = LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>);</span></CodeLine>
<Link id="l09988" /><CodeLine lineNumber="9988"></CodeLine>
<Link id="l09989" /><CodeLine lineNumber="9989"><span class="doxyHighlight">  &#123;</span></CodeLine>
<Link id="l09990" /><CodeLine lineNumber="9990"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AddBranchWeights =</span></CodeLine>
<Link id="l09991" /><CodeLine lineNumber="9991"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;L-&gt;getLoopLatch()-&gt;getTerminator());</span></CodeLine>
<Link id="l09992" /><CodeLine lineNumber="9992"><span class="doxyHighlight">    GeneratedRTChecks Checks(PSE, DT, LI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getDataLayout(),</span></CodeLine>
<Link id="l09993" /><CodeLine lineNumber="9993"><span class="doxyHighlight">                             AddBranchWeights, CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l09994" /><CodeLine lineNumber="9994"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/innerloopvectorizer">InnerLoopVectorizer</a> LB(L, PSE, LI, DT, TLI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, AC, ORE, VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>,</span></CodeLine>
<Link id="l09995" /><CodeLine lineNumber="9995"><span class="doxyHighlight">                           VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, 1, LVL, &amp;CM, BFI, PSI, Checks, BestPlan);</span></CodeLine>
<Link id="l09996" /><CodeLine lineNumber="9996"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Vectorizing outer loop in \\&quot;&quot;</span></CodeLine>
<Link id="l09997" /><CodeLine lineNumber="9997"><span class="doxyHighlight">                      &lt;&lt; L-&gt;getHeader()-&gt;getParent()-&gt;getName() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09998" /><CodeLine lineNumber="9998"><span class="doxyHighlight">    LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#acbe2feb9e960936a43c845a1fa8eaba4">executePlan</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, 1, BestPlan, LB, DT, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l09999" /><CodeLine lineNumber="9999"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10000" /><CodeLine lineNumber="10000"></CodeLine>
<Link id="l10001" /><CodeLine lineNumber="10001"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#a0c19b37908311872f655348755e8d003">reportVectorization</a>(ORE, L, VF, 1);</span></CodeLine>
<Link id="l10002" /><CodeLine lineNumber="10002"></CodeLine>
<Link id="l10003" /><CodeLine lineNumber="10003"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Mark the loop as already vectorized to avoid vectorizing again.</span></CodeLine>
<Link id="l10004" /><CodeLine lineNumber="10004"><span class="doxyHighlight">  Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#aa2f5ef2d522fb80de283a23d5bed6d86">setAlreadyVectorized</a>();</span></CodeLine>
<Link id="l10005" /><CodeLine lineNumber="10005"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a26389c546573f058ad8ecbdc5c1933cf">verifyFunction</a>(&#42;L-&gt;getHeader()-&gt;getParent(), &amp;<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</span></CodeLine>
<Link id="l10006" /><CodeLine lineNumber="10006"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10007" /><CodeLine lineNumber="10007"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l10008" /><CodeLine lineNumber="10008"></CodeLine>
<Link id="l10009" /><CodeLine lineNumber="10009"><span class="doxyHighlightComment">// Emit a remark if there are stores to floats that required a floating point</span></CodeLine>
<Link id="l10010" /><CodeLine lineNumber="10010"><span class="doxyHighlightComment">// extension. If the vectorized loop was generated with floating point there</span></CodeLine>
<Link id="l10011" /><CodeLine lineNumber="10011"><span class="doxyHighlightComment">// will be a performance penalty from the conversion overhead and the change in</span></CodeLine>
<Link id="l10012" /><CodeLine lineNumber="10012"><span class="doxyHighlightComment">// the vector width.</span></CodeLine>
<Link id="l10013" /><CodeLine lineNumber="10013" lineLink="#af1fba45879c49d4839b11ec30afd7532"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#af1fba45879c49d4839b11ec30afd7532">checkMixedPrecision</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE) &#123;</span></CodeLine>
<Link id="l10014" /><CodeLine lineNumber="10014"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> Worklist;</span></CodeLine>
<Link id="l10015" /><CodeLine lineNumber="10015"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : L-&gt;getBlocks()) &#123;</span></CodeLine>
<Link id="l10016" /><CodeLine lineNumber="10016"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Inst : &#42;BB) &#123;</span></CodeLine>
<Link id="l10017" /><CodeLine lineNumber="10017"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;S = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;Inst)) &#123;</span></CodeLine>
<Link id="l10018" /><CodeLine lineNumber="10018"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (S-&gt;getValueOperand()-&gt;getType()-&gt;isFloatTy())</span></CodeLine>
<Link id="l10019" /><CodeLine lineNumber="10019"><span class="doxyHighlight">          Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(S);</span></CodeLine>
<Link id="l10020" /><CodeLine lineNumber="10020"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l10021" /><CodeLine lineNumber="10021"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l10022" /><CodeLine lineNumber="10022"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10023" /><CodeLine lineNumber="10023"></CodeLine>
<Link id="l10024" /><CodeLine lineNumber="10024"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Traverse the floating point stores upwards searching, for floating point</span></CodeLine>
<Link id="l10025" /><CodeLine lineNumber="10025"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// conversions.</span></CodeLine>
<Link id="l10026" /><CodeLine lineNumber="10026"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Instruction &#42;, 4&gt;</a> Visited;</span></CodeLine>
<Link id="l10027" /><CodeLine lineNumber="10027"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Instruction &#42;, 4&gt;</a> EmittedRemark;</span></CodeLine>
<Link id="l10028" /><CodeLine lineNumber="10028"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l10029" /><CodeLine lineNumber="10029"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l10030" /><CodeLine lineNumber="10030"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L-&gt;contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</span></CodeLine>
<Link id="l10031" /><CodeLine lineNumber="10031"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10032" /><CodeLine lineNumber="10032"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>).second)</span></CodeLine>
<Link id="l10033" /><CodeLine lineNumber="10033"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10034" /><CodeLine lineNumber="10034"></CodeLine>
<Link id="l10035" /><CodeLine lineNumber="10035"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Emit a remark if the floating point store required a floating</span></CodeLine>
<Link id="l10036" /><CodeLine lineNumber="10036"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// point conversion.</span></CodeLine>
<Link id="l10037" /><CodeLine lineNumber="10037"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: More work could be done to identify the root cause such as a</span></CodeLine>
<Link id="l10038" /><CodeLine lineNumber="10038"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// constant or a function return type and point the user to it.</span></CodeLine>
<Link id="l10039" /><CodeLine lineNumber="10039"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FPExtInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; EmittedRemark.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>).second)</span></CodeLine>
<Link id="l10040" /><CodeLine lineNumber="10040"><span class="doxyHighlight">      ORE-&gt;<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l10041" /><CodeLine lineNumber="10041"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a>(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>, </span><span class="doxyHighlightStringLiteral">&quot;VectorMixedPrecision&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10042" /><CodeLine lineNumber="10042"><span class="doxyHighlight">                                          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc(), L-&gt;getHeader())</span></CodeLine>
<Link id="l10043" /><CodeLine lineNumber="10043"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;floating point conversion changes vector width. &quot;</span></CodeLine>
<Link id="l10044" /><CodeLine lineNumber="10044"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;Mixed floating point precision requires an up/down &quot;</span></CodeLine>
<Link id="l10045" /><CodeLine lineNumber="10045"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;cast that will negatively impact performance.&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10046" /><CodeLine lineNumber="10046"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l10047" /><CodeLine lineNumber="10047"></CodeLine>
<Link id="l10048" /><CodeLine lineNumber="10048"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</span></CodeLine>
<Link id="l10049" /><CodeLine lineNumber="10049"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;OpI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</span></CodeLine>
<Link id="l10050" /><CodeLine lineNumber="10050"><span class="doxyHighlight">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpI);</span></CodeLine>
<Link id="l10051" /><CodeLine lineNumber="10051"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10052" /><CodeLine lineNumber="10052"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l10053" /><CodeLine lineNumber="10053"></CodeLine>
<Link id="l10054" /><CodeLine lineNumber="10054" lineLink="#a362f793f3254317c698e3560548788a5"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="#a362f793f3254317c698e3560548788a5">areRuntimeChecksProfitable</a>(GeneratedRTChecks &amp;Checks,</span></CodeLine>
<Link id="l10055" /><CodeLine lineNumber="10055"><span class="doxyHighlight">                                       <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> &amp;VF, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</span></CodeLine>
<Link id="l10056" /><CodeLine lineNumber="10056"><span class="doxyHighlight">                                       </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</span></CodeLine>
<Link id="l10057" /><CodeLine lineNumber="10057"><span class="doxyHighlight">                                       <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;PSE,</span></CodeLine>
<Link id="l10058" /><CodeLine lineNumber="10058"><span class="doxyHighlight">                                       <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> </span><span class="doxyHighlightKeywordType">SEL</span><span class="doxyHighlight">) &#123;</span></CodeLine>
<Link id="l10059" /><CodeLine lineNumber="10059"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> CheckCost = Checks.getCost();</span></CodeLine>
<Link id="l10060" /><CodeLine lineNumber="10060"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!CheckCost.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>())</span></CodeLine>
<Link id="l10061" /><CodeLine lineNumber="10061"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10062" /><CodeLine lineNumber="10062"></CodeLine>
<Link id="l10063" /><CodeLine lineNumber="10063"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// When interleaving only scalar and vector cost will be equal, which in turn</span></CodeLine>
<Link id="l10064" /><CodeLine lineNumber="10064"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// would lead to a divide by 0 Fall back to hard threshold.</span></CodeLine>
<Link id="l10065" /><CodeLine lineNumber="10065"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>()) &#123;</span></CodeLine>
<Link id="l10066" /><CodeLine lineNumber="10066"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (CheckCost &gt; <a href="#a1293f02da7fffb33096a44f1b1768b3f">VectorizeMemoryCheckThreshold</a>) &#123;</span></CodeLine>
<Link id="l10067" /><CodeLine lineNumber="10067"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l10068" /><CodeLine lineNumber="10068"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</span></CodeLine>
<Link id="l10069" /><CodeLine lineNumber="10069"><span class="doxyHighlight">          &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Interleaving only is not profitable due to runtime checks\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10070" /><CodeLine lineNumber="10070"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10071" /><CodeLine lineNumber="10071"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l10072" /><CodeLine lineNumber="10072"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10073" /><CodeLine lineNumber="10073"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10074" /><CodeLine lineNumber="10074"></CodeLine>
<Link id="l10075" /><CodeLine lineNumber="10075"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The scalar cost should only be 0 when vectorizing with a user specified VF/IC. In those cases, runtime checks should always be generated.</span></CodeLine>
<Link id="l10076" /><CodeLine lineNumber="10076"><span class="doxyHighlight">  uint64&#95;t ScalarC = &#42;VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a76f716c04dfa813b98e1c112bc642d34">ScalarCost</a>.<a href="/docs/api/classes/llvm/instructioncost/#a9b642067999075ba996ecdee40b52b68">getValue</a>();</span></CodeLine>
<Link id="l10077" /><CodeLine lineNumber="10077"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ScalarC == 0)</span></CodeLine>
<Link id="l10078" /><CodeLine lineNumber="10078"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10079" /><CodeLine lineNumber="10079"></CodeLine>
<Link id="l10080" /><CodeLine lineNumber="10080"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// First, compute the minimum iteration count required so that the vector</span></CodeLine>
<Link id="l10081" /><CodeLine lineNumber="10081"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// loop outperforms the scalar loop.</span></CodeLine>
<Link id="l10082" /><CodeLine lineNumber="10082"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  The total cost of the scalar loop is</span></CodeLine>
<Link id="l10083" /><CodeLine lineNumber="10083"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   ScalarC &#42; TC</span></CodeLine>
<Link id="l10084" /><CodeLine lineNumber="10084"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  where</span></CodeLine>
<Link id="l10085" /><CodeLine lineNumber="10085"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  &#42; TC is the actual trip count of the loop.</span></CodeLine>
<Link id="l10086" /><CodeLine lineNumber="10086"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  &#42; ScalarC is the cost of a single scalar iteration.</span></CodeLine>
<Link id="l10087" /><CodeLine lineNumber="10087"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l10088" /><CodeLine lineNumber="10088"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  The total cost of the vector loop is</span></CodeLine>
<Link id="l10089" /><CodeLine lineNumber="10089"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    RtC + VecC &#42; (TC / VF) + EpiC</span></CodeLine>
<Link id="l10090" /><CodeLine lineNumber="10090"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  where</span></CodeLine>
<Link id="l10091" /><CodeLine lineNumber="10091"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  &#42; RtC is the cost of the generated runtime checks</span></CodeLine>
<Link id="l10092" /><CodeLine lineNumber="10092"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  &#42; VecC is the cost of a single vector iteration.</span></CodeLine>
<Link id="l10093" /><CodeLine lineNumber="10093"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  &#42; TC is the actual trip count of the loop</span></CodeLine>
<Link id="l10094" /><CodeLine lineNumber="10094"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  &#42; VF is the vectorization factor</span></CodeLine>
<Link id="l10095" /><CodeLine lineNumber="10095"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//  &#42; EpiCost is the cost of the generated epilogue, including the cost</span></CodeLine>
<Link id="l10096" /><CodeLine lineNumber="10096"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//    of the remaining scalar operations.</span></CodeLine>
<Link id="l10097" /><CodeLine lineNumber="10097"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l10098" /><CodeLine lineNumber="10098"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Vectorization is profitable once the total vector cost is less than the</span></CodeLine>
<Link id="l10099" /><CodeLine lineNumber="10099"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// total scalar cost:</span></CodeLine>
<Link id="l10100" /><CodeLine lineNumber="10100"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   RtC + VecC &#42; (TC / VF) + EpiC &lt;  ScalarC &#42; TC</span></CodeLine>
<Link id="l10101" /><CodeLine lineNumber="10101"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l10102" /><CodeLine lineNumber="10102"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now we can compute the minimum required trip count TC as</span></CodeLine>
<Link id="l10103" /><CodeLine lineNumber="10103"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   VF &#42; (RtC + EpiC) / (ScalarC &#42; VF - VecC) &lt; TC</span></CodeLine>
<Link id="l10104" /><CodeLine lineNumber="10104"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l10105" /><CodeLine lineNumber="10105"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// For now we assume the epilogue cost EpiC = 0 for simplicity. Note that</span></CodeLine>
<Link id="l10106" /><CodeLine lineNumber="10106"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the computations are performed on doubles, not integers and the result</span></CodeLine>
<Link id="l10107" /><CodeLine lineNumber="10107"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is rounded up, hence we get an upper estimate of the TC.</span></CodeLine>
<Link id="l10108" /><CodeLine lineNumber="10108"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IntVF = <a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a>(L, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>);</span></CodeLine>
<Link id="l10109" /><CodeLine lineNumber="10109"><span class="doxyHighlight">  uint64&#95;t RtC = &#42;CheckCost.<a href="/docs/api/classes/llvm/instructioncost/#a9b642067999075ba996ecdee40b52b68">getValue</a>();</span></CodeLine>
<Link id="l10110" /><CodeLine lineNumber="10110"><span class="doxyHighlight">  uint64&#95;t Div = ScalarC &#42; IntVF - &#42;VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a048d568675a5cc69c3fb85206882316d">Cost</a>.<a href="/docs/api/classes/llvm/instructioncost/#a9b642067999075ba996ecdee40b52b68">getValue</a>();</span></CodeLine>
<Link id="l10111" /><CodeLine lineNumber="10111"><span class="doxyHighlight">  uint64&#95;t MinTC1 = Div == 0 ? 0 : <a href="/docs/api/namespaces/llvm/#a9dda4472ee0b7ea92ab49eedf6e13d50">divideCeil</a>(RtC &#42; IntVF, Div);</span></CodeLine>
<Link id="l10112" /><CodeLine lineNumber="10112"></CodeLine>
<Link id="l10113" /><CodeLine lineNumber="10113"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Second, compute a minimum iteration count so that the cost of the</span></CodeLine>
<Link id="l10114" /><CodeLine lineNumber="10114"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// runtime checks is only a fraction of the total scalar loop cost. This</span></CodeLine>
<Link id="l10115" /><CodeLine lineNumber="10115"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// adds a loop-dependent bound on the overhead incurred if the runtime</span></CodeLine>
<Link id="l10116" /><CodeLine lineNumber="10116"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// checks fail. In case the runtime checks fail, the cost is RtC + ScalarC</span></CodeLine>
<Link id="l10117" /><CodeLine lineNumber="10117"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// &#42; TC. To bound the runtime check to be a fraction 1/X of the scalar</span></CodeLine>
<Link id="l10118" /><CodeLine lineNumber="10118"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// cost, compute</span></CodeLine>
<Link id="l10119" /><CodeLine lineNumber="10119"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//   RtC &lt; ScalarC &#42; TC &#42; (1 / X)  ==&gt;  RtC &#42; X / ScalarC &lt; TC</span></CodeLine>
<Link id="l10120" /><CodeLine lineNumber="10120"><span class="doxyHighlight">  uint64&#95;t MinTC2 = <a href="/docs/api/namespaces/llvm/#a9dda4472ee0b7ea92ab49eedf6e13d50">divideCeil</a>(RtC &#42; 10, ScalarC);</span></CodeLine>
<Link id="l10121" /><CodeLine lineNumber="10121"></CodeLine>
<Link id="l10122" /><CodeLine lineNumber="10122"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now pick the larger minimum. If it is not a multiple of VF and a scalar</span></CodeLine>
<Link id="l10123" /><CodeLine lineNumber="10123"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// epilogue is allowed, choose the next closest multiple of VF. This should</span></CodeLine>
<Link id="l10124" /><CodeLine lineNumber="10124"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// partly compensate for ignoring the epilogue cost.</span></CodeLine>
<Link id="l10125" /><CodeLine lineNumber="10125"><span class="doxyHighlight">  uint64&#95;t MinTC = std::max(MinTC1, MinTC2);</span></CodeLine>
<Link id="l10126" /><CodeLine lineNumber="10126"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">SEL</span><span class="doxyHighlight"> == <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>)</span></CodeLine>
<Link id="l10127" /><CodeLine lineNumber="10127"><span class="doxyHighlight">    MinTC = <a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(MinTC, IntVF);</span></CodeLine>
<Link id="l10128" /><CodeLine lineNumber="10128"><span class="doxyHighlight">  VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a0c1900dc8fe6b998c1de1880f300dcfa">MinProfitableTripCount</a> = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(MinTC);</span></CodeLine>
<Link id="l10129" /><CodeLine lineNumber="10129"></CodeLine>
<Link id="l10130" /><CodeLine lineNumber="10130"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l10131" /><CodeLine lineNumber="10131"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Minimum required TC for runtime checks to be profitable:&quot;</span></CodeLine>
<Link id="l10132" /><CodeLine lineNumber="10132"><span class="doxyHighlight">             &lt;&lt; VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a0c1900dc8fe6b998c1de1880f300dcfa">MinProfitableTripCount</a> &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10133" /><CodeLine lineNumber="10133"></CodeLine>
<Link id="l10134" /><CodeLine lineNumber="10134"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Skip vectorization if the expected trip count is less than the minimum</span></CodeLine>
<Link id="l10135" /><CodeLine lineNumber="10135"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// required trip count.</span></CodeLine>
<Link id="l10136" /><CodeLine lineNumber="10136"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ExpectedTC = <a href="#a84375e6536d9214c7895013078055aff">getSmallBestKnownTC</a>(PSE, L)) &#123;</span></CodeLine>
<Link id="l10137" /><CodeLine lineNumber="10137"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a83e6442f8ebefccdb5e089732fe397ac">ElementCount::isKnownLT</a>(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(&#42;ExpectedTC),</span></CodeLine>
<Link id="l10138" /><CodeLine lineNumber="10138"><span class="doxyHighlight">                                VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a0c1900dc8fe6b998c1de1880f300dcfa">MinProfitableTripCount</a>)) &#123;</span></CodeLine>
<Link id="l10139" /><CodeLine lineNumber="10139"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Vectorization is not beneficial: expected &quot;</span></CodeLine>
<Link id="l10140" /><CodeLine lineNumber="10140"><span class="doxyHighlight">                           </span><span class="doxyHighlightStringLiteral">&quot;trip count &lt; minimum profitable VF (&quot;</span></CodeLine>
<Link id="l10141" /><CodeLine lineNumber="10141"><span class="doxyHighlight">                        &lt;&lt; &#42;ExpectedTC &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; &lt; &quot;</span><span class="doxyHighlight"> &lt;&lt; VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a0c1900dc8fe6b998c1de1880f300dcfa">MinProfitableTripCount</a></span></CodeLine>
<Link id="l10142" /><CodeLine lineNumber="10142"><span class="doxyHighlight">                        &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;)\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10143" /><CodeLine lineNumber="10143"></CodeLine>
<Link id="l10144" /><CodeLine lineNumber="10144"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10145" /><CodeLine lineNumber="10145"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l10146" /><CodeLine lineNumber="10146"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10147" /><CodeLine lineNumber="10147"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10148" /><CodeLine lineNumber="10148"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l10149" /><CodeLine lineNumber="10149"></CodeLine>
<Link id="l10150" /><CodeLine lineNumber="10150" lineLink="/docs/api/structs/llvm/loopvectorizepass/#a51be961763c595602654e8d825f26b59"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/loopvectorizepass/#a51be961763c595602654e8d825f26b59">LoopVectorizePass::LoopVectorizePass</a>(<a href="/docs/api/structs/llvm/loopvectorizeoptions">LoopVectorizeOptions</a> Opts)</span></CodeLine>
<Link id="l10151" /><CodeLine lineNumber="10151"><span class="doxyHighlight">    : InterleaveOnlyWhenForced(Opts.InterleaveOnlyWhenForced ||</span></CodeLine>
<Link id="l10152" /><CodeLine lineNumber="10152"><span class="doxyHighlight">                               !<a href="/docs/api/namespaces/llvm/#af98e93062e9f33018307ffc64d4b009e">EnableLoopInterleaving</a>),</span></CodeLine>
<Link id="l10153" /><CodeLine lineNumber="10153"><span class="doxyHighlight">      VectorizeOnlyWhenForced(Opts.VectorizeOnlyWhenForced ||</span></CodeLine>
<Link id="l10154" /><CodeLine lineNumber="10154"><span class="doxyHighlight">                              !<a href="/docs/api/namespaces/llvm/#a7f386d38a2c6c22a343243e9e48f7532">EnableLoopVectorization</a>) &#123;&#125;</span></CodeLine>
<Link id="l10155" /><CodeLine lineNumber="10155"></CodeLine>
<Link id="l10156" /><CodeLine lineNumber="10156"><span class="doxyHighlightComment">/// Prepare \\p MainPlan for vectorizing the main vector loop during epilogue</span></CodeLine>
<Link id="l10157" /><CodeLine lineNumber="10157"><span class="doxyHighlightComment">/// vectorization. Remove ResumePhis from \\p MainPlan for inductions that</span></CodeLine>
<Link id="l10158" /><CodeLine lineNumber="10158"><span class="doxyHighlightComment">/// don&#39;t have a corresponding wide induction in \\p EpiPlan.</span></CodeLine>
<Link id="l10159" /><CodeLine lineNumber="10159" lineLink="#a13368acf4fbb5816c3d82099b11519b1"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="#a13368acf4fbb5816c3d82099b11519b1">preparePlanForMainVectorLoop</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;MainPlan, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;EpiPlan) &#123;</span></CodeLine>
<Link id="l10160" /><CodeLine lineNumber="10160"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Collect PHI nodes of widened phis in the VPlan for the epilogue. Those</span></CodeLine>
<Link id="l10161" /><CodeLine lineNumber="10161"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will need their resume-values computed in the main vector loop. Others</span></CodeLine>
<Link id="l10162" /><CodeLine lineNumber="10162"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// can be removed from the main VPlan.</span></CodeLine>
<Link id="l10163" /><CodeLine lineNumber="10163"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;PHINode &#42;, 2&gt;</a> EpiWidenedPhis;</span></CodeLine>
<Link id="l10164" /><CodeLine lineNumber="10164"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R :</span></CodeLine>
<Link id="l10165" /><CodeLine lineNumber="10165"><span class="doxyHighlight">       EpiPlan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>()) &#123;</span></CodeLine>
<Link id="l10166" /><CodeLine lineNumber="10166"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPCanonicalIVPHIRecipe&gt;</a>(&amp;R))</span></CodeLine>
<Link id="l10167" /><CodeLine lineNumber="10167"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10168" /><CodeLine lineNumber="10168"><span class="doxyHighlight">    EpiWidenedPhis.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(</span></CodeLine>
<Link id="l10169" /><CodeLine lineNumber="10169"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(R.getVPSingleValue()-&gt;getUnderlyingValue()));</span></CodeLine>
<Link id="l10170" /><CodeLine lineNumber="10170"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10171" /><CodeLine lineNumber="10171"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(</span></CodeLine>
<Link id="l10172" /><CodeLine lineNumber="10172"><span class="doxyHighlight">           &#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPIRBasicBlock&gt;</a>(MainPlan.<a href="/docs/api/classes/llvm/vplan/#ae56a6505c6bfa319e686fc23acd52495">getScalarHeader</a>()))) &#123;</span></CodeLine>
<Link id="l10173" /><CodeLine lineNumber="10173"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;VPIRInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPIRInstruction&gt;</a>(&amp;R);</span></CodeLine>
<Link id="l10174" /><CodeLine lineNumber="10174"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;IRI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;VPIRInst-&gt;getInstruction());</span></CodeLine>
<Link id="l10175" /><CodeLine lineNumber="10175"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!IRI)</span></CodeLine>
<Link id="l10176" /><CodeLine lineNumber="10176"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">break</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10177" /><CodeLine lineNumber="10177"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EpiWidenedPhis.<a href="/docs/api/classes/llvm/smallptrsetimpl/#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(IRI))</span></CodeLine>
<Link id="l10178" /><CodeLine lineNumber="10178"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10179" /><CodeLine lineNumber="10179"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// There is no corresponding wide induction in the epilogue plan that would</span></CodeLine>
<Link id="l10180" /><CodeLine lineNumber="10180"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// need a resume value. Remove the VPIRInst wrapping the scalar header phi</span></CodeLine>
<Link id="l10181" /><CodeLine lineNumber="10181"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// together with the corresponding ResumePhi. The resume values for the</span></CodeLine>
<Link id="l10182" /><CodeLine lineNumber="10182"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// scalar loop will be created during execution of EpiPlan.</span></CodeLine>
<Link id="l10183" /><CodeLine lineNumber="10183"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;ResumePhi = VPIRInst-&gt;<a href="/docs/api/classes/llvm/vpuser/#a6e1b252a9bbdc1a440fb57a6257b97f4">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/vpvalue/#a3be8d7833df422f3538ddb13af69bd70">getDefiningRecipe</a>();</span></CodeLine>
<Link id="l10184" /><CodeLine lineNumber="10184"><span class="doxyHighlight">    VPIRInst-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#aac9dfb61b37082dca00de284bb3309e8">eraseFromParent</a>();</span></CodeLine>
<Link id="l10185" /><CodeLine lineNumber="10185"><span class="doxyHighlight">    ResumePhi-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#aac9dfb61b37082dca00de284bb3309e8">eraseFromParent</a>();</span></CodeLine>
<Link id="l10186" /><CodeLine lineNumber="10186"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10187" /><CodeLine lineNumber="10187"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vplantransforms/#aaca9dd97d4c523d8c65274654abe4eb9">VPlanTransforms::removeDeadRecipes</a>(MainPlan);</span></CodeLine>
<Link id="l10188" /><CodeLine lineNumber="10188"></CodeLine>
<Link id="l10189" /><CodeLine lineNumber="10189"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">VPlanPatternMatch</a>;</span></CodeLine>
<Link id="l10190" /><CodeLine lineNumber="10190"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;MainScalarPH = MainPlan.<a href="/docs/api/classes/llvm/vplan/#ad5f29ccf71b0494fc179323427eb1e11">getScalarPreheader</a>();</span></CodeLine>
<Link id="l10191" /><CodeLine lineNumber="10191"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;VectorTC = &amp;MainPlan.<a href="/docs/api/classes/llvm/vplan/#a233848f0bf7aef1aca22e6172e5d900d">getVectorTripCount</a>();</span></CodeLine>
<Link id="l10192" /><CodeLine lineNumber="10192"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is a suitable resume value for the canonical induction in the</span></CodeLine>
<Link id="l10193" /><CodeLine lineNumber="10193"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// scalar (which will become vector) epilogue loop we are done. Otherwise</span></CodeLine>
<Link id="l10194" /><CodeLine lineNumber="10194"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// create it below.</span></CodeLine>
<Link id="l10195" /><CodeLine lineNumber="10195"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(&#42;MainScalarPH, &#91;VectorTC&#93;(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R) &#123;</span></CodeLine>
<Link id="l10196" /><CodeLine lineNumber="10196"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R, m&#95;VPInstruction&lt;VPInstruction::ResumePhi&gt;(</span></CodeLine>
<Link id="l10197" /><CodeLine lineNumber="10197"><span class="doxyHighlight">                             <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(VectorTC), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(0)));</span></CodeLine>
<Link id="l10198" /><CodeLine lineNumber="10198"><span class="doxyHighlight">      &#125;))</span></CodeLine>
<Link id="l10199" /><CodeLine lineNumber="10199"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10200" /><CodeLine lineNumber="10200"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> ScalarPHBuilder(MainScalarPH, MainScalarPH-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a4e30ea9d413dd86c802fee94aa8b5805">begin</a>());</span></CodeLine>
<Link id="l10201" /><CodeLine lineNumber="10201"><span class="doxyHighlight">  ScalarPHBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(</span></CodeLine>
<Link id="l10202" /><CodeLine lineNumber="10202"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a36144832b0ebcda13ce881d2b60eaf91">VPInstruction::ResumePhi</a>,</span></CodeLine>
<Link id="l10203" /><CodeLine lineNumber="10203"><span class="doxyHighlight">      &#123;VectorTC, MainPlan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpheaderphirecipe/#a92c12c8e69e03cc781dd010cdaa5f0e6">getStartValue</a>()&#125;, &#123;&#125;,</span></CodeLine>
<Link id="l10204" /><CodeLine lineNumber="10204"><span class="doxyHighlight">      </span><span class="doxyHighlightStringLiteral">&quot;vec.epilog.resume.val&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10205" /><CodeLine lineNumber="10205"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l10206" /><CodeLine lineNumber="10206"></CodeLine>
<Link id="l10207" /><CodeLine lineNumber="10207"><span class="doxyHighlightComment">/// Prepare \\p Plan for vectorizing the epilogue loop. That is, re-use expanded</span></CodeLine>
<Link id="l10208" /><CodeLine lineNumber="10208"><span class="doxyHighlightComment">/// SCEVs from \\p ExpandedSCEVs and set resume values for header recipes.</span></CodeLine>
<Link id="l10209" /><CodeLine lineNumber="10209"><span class="doxyHighlightKeyword">static</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">void</span></CodeLine>
<Link id="l10210" /><CodeLine lineNumber="10210" lineLink="#aae23f7e6fc37b0f1bb756f938023512c"><span class="doxyHighlight"><a href="#aae23f7e6fc37b0f1bb756f938023512c">preparePlanForEpilogueVectorLoop</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</span></CodeLine>
<Link id="l10211" /><CodeLine lineNumber="10211"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> SCEV2ValueTy &amp;ExpandedSCEVs,</span></CodeLine>
<Link id="l10212" /><CodeLine lineNumber="10212"><span class="doxyHighlight">                                 </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a> &amp;EPI) &#123;</span></CodeLine>
<Link id="l10213" /><CodeLine lineNumber="10213"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;VectorLoop = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</span></CodeLine>
<Link id="l10214" /><CodeLine lineNumber="10214"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;Header = VectorLoop-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</span></CodeLine>
<Link id="l10215" /><CodeLine lineNumber="10215"><span class="doxyHighlight">  Header-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a2bd1c53f9607876b22c6fd3ec1e28a50">setName</a>(</span><span class="doxyHighlightStringLiteral">&quot;vec.epilog.vector.body&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10216" /><CodeLine lineNumber="10216"></CodeLine>
<Link id="l10217" /><CodeLine lineNumber="10217"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Re-use the trip count and steps expanded for the main loop, as</span></CodeLine>
<Link id="l10218" /><CodeLine lineNumber="10218"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// skeleton creation needs it as a value that dominates both the scalar</span></CodeLine>
<Link id="l10219" /><CodeLine lineNumber="10219"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and vector epilogue loops</span></CodeLine>
<Link id="l10220" /><CodeLine lineNumber="10220"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// TODO: This is a workaround needed for epilogue vectorization and it</span></CodeLine>
<Link id="l10221" /><CodeLine lineNumber="10221"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// should be removed once induction resume value creation is done</span></CodeLine>
<Link id="l10222" /><CodeLine lineNumber="10222"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// directly in VPlan.</span></CodeLine>
<Link id="l10223" /><CodeLine lineNumber="10223"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>())) &#123;</span></CodeLine>
<Link id="l10224" /><CodeLine lineNumber="10224"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExpandR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPExpandSCEVRecipe&gt;</a>(&amp;R);</span></CodeLine>
<Link id="l10225" /><CodeLine lineNumber="10225"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ExpandR)</span></CodeLine>
<Link id="l10226" /><CodeLine lineNumber="10226"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10227" /><CodeLine lineNumber="10227"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExpandedVal =</span></CodeLine>
<Link id="l10228" /><CodeLine lineNumber="10228"><span class="doxyHighlight">        Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(ExpandedSCEVs.find(ExpandR-&gt;getSCEV())-&gt;second);</span></CodeLine>
<Link id="l10229" /><CodeLine lineNumber="10229"><span class="doxyHighlight">    ExpandR-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(ExpandedVal);</span></CodeLine>
<Link id="l10230" /><CodeLine lineNumber="10230"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Plan.<a href="/docs/api/classes/llvm/vplan/#a2f5fc19caa67daeca8a1316c7e055e3c">getTripCount</a>() == ExpandR)</span></CodeLine>
<Link id="l10231" /><CodeLine lineNumber="10231"><span class="doxyHighlight">      Plan.<a href="/docs/api/classes/llvm/vplan/#a9bb77d906fd1ae7e241f0c95dcba094b">resetTripCount</a>(ExpandedVal);</span></CodeLine>
<Link id="l10232" /><CodeLine lineNumber="10232"><span class="doxyHighlight">    ExpandR-&gt;eraseFromParent();</span></CodeLine>
<Link id="l10233" /><CodeLine lineNumber="10233"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10234" /><CodeLine lineNumber="10234"></CodeLine>
<Link id="l10235" /><CodeLine lineNumber="10235"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Ensure that the start values for all header phi recipes are updated before</span></CodeLine>
<Link id="l10236" /><CodeLine lineNumber="10236"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorizing the epilogue loop.</span></CodeLine>
<Link id="l10237" /><CodeLine lineNumber="10237"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : Header-&gt;phis()) &#123;</span></CodeLine>
<Link id="l10238" /><CodeLine lineNumber="10238"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPCanonicalIVPHIRecipe&gt;</a>(&amp;R)) &#123;</span></CodeLine>
<Link id="l10239" /><CodeLine lineNumber="10239"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// When vectorizing the epilogue loop, the canonical induction start</span></CodeLine>
<Link id="l10240" /><CodeLine lineNumber="10240"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// value needs to be changed from zero to the value after the main</span></CodeLine>
<Link id="l10241" /><CodeLine lineNumber="10241"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// vector loop. Find the resume value created during execution of the main</span></CodeLine>
<Link id="l10242" /><CodeLine lineNumber="10242"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// VPlan.</span></CodeLine>
<Link id="l10243" /><CodeLine lineNumber="10243"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// FIXME: Improve modeling for canonical IV start values in the epilogue</span></CodeLine>
<Link id="l10244" /><CodeLine lineNumber="10244"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// loop.</span></CodeLine>
<Link id="l10245" /><CodeLine lineNumber="10245"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;MainMiddle = <a href="/docs/api/namespaces/llvm/#a8f6975e193997c4e0183e96774a7cb39">find&#95;singleton&lt;BasicBlock&gt;</a>(</span></CodeLine>
<Link id="l10246" /><CodeLine lineNumber="10246"><span class="doxyHighlight">          <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(L-&gt;getLoopPreheader()),</span></CodeLine>
<Link id="l10247" /><CodeLine lineNumber="10247"><span class="doxyHighlight">          &#91;&amp;EPI&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight">) -&gt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &#123;</span></CodeLine>
<Link id="l10248" /><CodeLine lineNumber="10248"><span class="doxyHighlight">            if (BB != EPI.MainLoopIterationCountCheck &amp;&amp;</span></CodeLine>
<Link id="l10249" /><CodeLine lineNumber="10249"><span class="doxyHighlight">                BB != EPI.EpilogueIterationCountCheck &amp;&amp;</span></CodeLine>
<Link id="l10250" /><CodeLine lineNumber="10250"><span class="doxyHighlight">                BB != EPI.SCEVSafetyCheck &amp;&amp; BB != EPI.MemSafetyCheck)</span></CodeLine>
<Link id="l10251" /><CodeLine lineNumber="10251"><span class="doxyHighlight">              return BB;</span></CodeLine>
<Link id="l10252" /><CodeLine lineNumber="10252"><span class="doxyHighlight">            return nullptr;</span></CodeLine>
<Link id="l10253" /><CodeLine lineNumber="10253"><span class="doxyHighlight">          &#125;);</span></CodeLine>
<Link id="l10254" /><CodeLine lineNumber="10254"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</span></CodeLine>
<Link id="l10255" /><CodeLine lineNumber="10255"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;IdxTy = <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getScalarType();</span></CodeLine>
<Link id="l10256" /><CodeLine lineNumber="10256"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;EPResumeVal = <a href="/docs/api/namespaces/llvm/#a8f6975e193997c4e0183e96774a7cb39">find&#95;singleton&lt;PHINode&gt;</a>(</span></CodeLine>
<Link id="l10257" /><CodeLine lineNumber="10257"><span class="doxyHighlight">          L-&gt;getLoopPreheader()-&gt;phis(),</span></CodeLine>
<Link id="l10258" /><CodeLine lineNumber="10258"><span class="doxyHighlight">          &#91;&amp;EPI, IdxTy, MainMiddle&#93;(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight">) -&gt; <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; &#123;</span></CodeLine>
<Link id="l10259" /><CodeLine lineNumber="10259"><span class="doxyHighlight">            if (P.getType() == IdxTy &amp;&amp;</span></CodeLine>
<Link id="l10260" /><CodeLine lineNumber="10260"><span class="doxyHighlight">                P.getIncomingValueForBlock(MainMiddle) == EPI.VectorTripCount &amp;&amp;</span></CodeLine>
<Link id="l10261" /><CodeLine lineNumber="10261"><span class="doxyHighlight">                match(</span></CodeLine>
<Link id="l10262" /><CodeLine lineNumber="10262"><span class="doxyHighlight">                    P.getIncomingValueForBlock(EPI.MainLoopIterationCountCheck),</span></CodeLine>
<Link id="l10263" /><CodeLine lineNumber="10263"><span class="doxyHighlight">                    m&#95;SpecificInt(0)))</span></CodeLine>
<Link id="l10264" /><CodeLine lineNumber="10264"><span class="doxyHighlight">              return &amp;P;</span></CodeLine>
<Link id="l10265" /><CodeLine lineNumber="10265"><span class="doxyHighlight">            return nullptr;</span></CodeLine>
<Link id="l10266" /><CodeLine lineNumber="10266"><span class="doxyHighlight">          &#125;);</span></CodeLine>
<Link id="l10267" /><CodeLine lineNumber="10267"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EPResumeVal &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;must have a resume value for the canonical IV&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10268" /><CodeLine lineNumber="10268"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;VPV = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(EPResumeVal);</span></CodeLine>
<Link id="l10269" /><CodeLine lineNumber="10269"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;users(),</span></CodeLine>
<Link id="l10270" /><CodeLine lineNumber="10270"><span class="doxyHighlight">                    &#91;&#93;(</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123;</span></CodeLine>
<Link id="l10271" /><CodeLine lineNumber="10271"><span class="doxyHighlight">                      return isa&lt;VPScalarIVStepsRecipe&gt;(U) ||</span></CodeLine>
<Link id="l10272" /><CodeLine lineNumber="10272"><span class="doxyHighlight">                             isa&lt;VPScalarCastRecipe&gt;(U) ||</span></CodeLine>
<Link id="l10273" /><CodeLine lineNumber="10273"><span class="doxyHighlight">                             isa&lt;VPDerivedIVRecipe&gt;(U) ||</span></CodeLine>
<Link id="l10274" /><CodeLine lineNumber="10274"><span class="doxyHighlight">                             cast&lt;VPInstruction&gt;(U)-&gt;getOpcode() ==</span></CodeLine>
<Link id="l10275" /><CodeLine lineNumber="10275"><span class="doxyHighlight">                                 Instruction::Add;</span></CodeLine>
<Link id="l10276" /><CodeLine lineNumber="10276"><span class="doxyHighlight">                    &#125;) &amp;&amp;</span></CodeLine>
<Link id="l10277" /><CodeLine lineNumber="10277"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;the canonical IV should only be used by its increment or &quot;</span></CodeLine>
<Link id="l10278" /><CodeLine lineNumber="10278"><span class="doxyHighlight">             </span><span class="doxyHighlightStringLiteral">&quot;ScalarIVSteps when resetting the start value&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10279" /><CodeLine lineNumber="10279"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;setOperand(0, VPV);</span></CodeLine>
<Link id="l10280" /><CodeLine lineNumber="10280"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">continue</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10281" /><CodeLine lineNumber="10281"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l10282" /><CodeLine lineNumber="10282"></CodeLine>
<Link id="l10283" /><CodeLine lineNumber="10283"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ResumeV = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10284" /><CodeLine lineNumber="10284"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: Move setting of resume values to prepareToExecute.</span></CodeLine>
<Link id="l10285" /><CodeLine lineNumber="10285"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ReductionPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReductionPHIRecipe&gt;</a>(&amp;R)) &#123;</span></CodeLine>
<Link id="l10286" /><CodeLine lineNumber="10286"><span class="doxyHighlight">      ResumeV = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(ReductionPhi-&gt;getUnderlyingInstr())</span></CodeLine>
<Link id="l10287" /><CodeLine lineNumber="10287"><span class="doxyHighlight">                    -&gt;getIncomingValueForBlock(L-&gt;getLoopPreheader());</span></CodeLine>
<Link id="l10288" /><CodeLine lineNumber="10288"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc =</span></CodeLine>
<Link id="l10289" /><CodeLine lineNumber="10289"><span class="doxyHighlight">          ReductionPhi-&gt;getRecurrenceDescriptor();</span></CodeLine>
<Link id="l10290" /><CodeLine lineNumber="10290"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> RK = RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>();</span></CodeLine>
<Link id="l10291" /><CodeLine lineNumber="10291"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a69df67c7d92481ae63a5d8017e96c716">RecurrenceDescriptor::isAnyOfRecurrenceKind</a>(RK)) &#123;</span></CodeLine>
<Link id="l10292" /><CodeLine lineNumber="10292"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// VPReductionPHIRecipes for AnyOf reductions expect a boolean as</span></CodeLine>
<Link id="l10293" /><CodeLine lineNumber="10293"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// start value; compare the final value from the main vector loop</span></CodeLine>
<Link id="l10294" /><CodeLine lineNumber="10294"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// to the start value.</span></CodeLine>
<Link id="l10295" /><CodeLine lineNumber="10295"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(ResumeV)-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l10296" /><CodeLine lineNumber="10296"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(PBB, PBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>());</span></CodeLine>
<Link id="l10297" /><CodeLine lineNumber="10297"><span class="doxyHighlight">        ResumeV =</span></CodeLine>
<Link id="l10298" /><CodeLine lineNumber="10298"><span class="doxyHighlight">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a6ef1729b04a4fbd6c6f27787cdd0e813">CreateICmpNE</a>(ResumeV, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a61351428b7eb226cbad866ccf2382817">getRecurrenceStartValue</a>());</span></CodeLine>
<Link id="l10299" /><CodeLine lineNumber="10299"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a7bc46d4489f4d6cb4a4e486ce5f6184b">RecurrenceDescriptor::isFindLastIVRecurrenceKind</a>(RK)) &#123;</span></CodeLine>
<Link id="l10300" /><CodeLine lineNumber="10300"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// VPReductionPHIRecipe for FindLastIV reductions requires an adjustment</span></CodeLine>
<Link id="l10301" /><CodeLine lineNumber="10301"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// to the resume value. The resume value is adjusted to the sentinel</span></CodeLine>
<Link id="l10302" /><CodeLine lineNumber="10302"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// value when the final value from the main vector loop equals the start</span></CodeLine>
<Link id="l10303" /><CodeLine lineNumber="10303"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// value. This ensures correctness when the start value might not be</span></CodeLine>
<Link id="l10304" /><CodeLine lineNumber="10304"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// less than the minimum value of a monotonically increasing induction</span></CodeLine>
<Link id="l10305" /><CodeLine lineNumber="10305"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// variable.</span></CodeLine>
<Link id="l10306" /><CodeLine lineNumber="10306"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ResumeBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(ResumeV)-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</span></CodeLine>
<Link id="l10307" /><CodeLine lineNumber="10307"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(ResumeBB, ResumeBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>());</span></CodeLine>
<Link id="l10308" /><CodeLine lineNumber="10308"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Cmp =</span></CodeLine>
<Link id="l10309" /><CodeLine lineNumber="10309"><span class="doxyHighlight">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(ResumeV, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a61351428b7eb226cbad866ccf2382817">getRecurrenceStartValue</a>());</span></CodeLine>
<Link id="l10310" /><CodeLine lineNumber="10310"><span class="doxyHighlight">        ResumeV =</span></CodeLine>
<Link id="l10311" /><CodeLine lineNumber="10311"><span class="doxyHighlight">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(Cmp, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#aed10715d943d3e1b4ca75b585ea96ab8">getSentinelValue</a>(), ResumeV);</span></CodeLine>
<Link id="l10312" /><CodeLine lineNumber="10312"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l10313" /><CodeLine lineNumber="10313"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l10314" /><CodeLine lineNumber="10314"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Retrieve the induction resume values for wide inductions from</span></CodeLine>
<Link id="l10315" /><CodeLine lineNumber="10315"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// their original phi nodes in the scalar loop.</span></CodeLine>
<Link id="l10316" /><CodeLine lineNumber="10316"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;IndPhi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenInductionRecipe&gt;</a>(&amp;R)-&gt;getPHINode();</span></CodeLine>
<Link id="l10317" /><CodeLine lineNumber="10317"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Hook up to the PHINode generated by a ResumePhi recipe of main</span></CodeLine>
<Link id="l10318" /><CodeLine lineNumber="10318"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// loop VPlan, which feeds the scalar loop.</span></CodeLine>
<Link id="l10319" /><CodeLine lineNumber="10319"><span class="doxyHighlight">      ResumeV = IndPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(L-&gt;getLoopPreheader());</span></CodeLine>
<Link id="l10320" /><CodeLine lineNumber="10320"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l10321" /><CodeLine lineNumber="10321"><span class="doxyHighlight">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ResumeV &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Must have a resume value&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10322" /><CodeLine lineNumber="10322"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;StartVal = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(ResumeV);</span></CodeLine>
<Link id="l10323" /><CodeLine lineNumber="10323"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPHeaderPHIRecipe&gt;</a>(&amp;R)-&gt;setStartValue(StartVal);</span></CodeLine>
<Link id="l10324" /><CodeLine lineNumber="10324"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10325" /><CodeLine lineNumber="10325"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l10326" /><CodeLine lineNumber="10326"></CodeLine>
<Link id="l10327" /><CodeLine lineNumber="10327" lineLink="/docs/api/structs/llvm/loopvectorizepass/#a160afa01e95095aa0c8115b6e0e6f4a6"><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/loopvectorizepass/#a160afa01e95095aa0c8115b6e0e6f4a6">LoopVectorizePass::processLoop</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123;</span></CodeLine>
<Link id="l10328" /><CodeLine lineNumber="10328"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a> || L-&gt;isInnermost()) &amp;&amp;</span></CodeLine>
<Link id="l10329" /><CodeLine lineNumber="10329"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;VPlan-native path is not enabled. Only process inner loops.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10330" /><CodeLine lineNumber="10330"></CodeLine>
<Link id="l10331" /><CodeLine lineNumber="10331"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\nLV: Checking a loop in &#39;&quot;</span></CodeLine>
<Link id="l10332" /><CodeLine lineNumber="10332"><span class="doxyHighlight">                    &lt;&lt; L-&gt;getHeader()-&gt;getParent()-&gt;getName() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;&#39; from &quot;</span></CodeLine>
<Link id="l10333" /><CodeLine lineNumber="10333"><span class="doxyHighlight">                    &lt;&lt; L-&gt;getLocStr() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10334" /><CodeLine lineNumber="10334"></CodeLine>
<Link id="l10335" /><CodeLine lineNumber="10335"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> Hints(L, InterleaveOnlyWhenForced, &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>);</span></CodeLine>
<Link id="l10336" /><CodeLine lineNumber="10336"></CodeLine>
<Link id="l10337" /><CodeLine lineNumber="10337"><span class="doxyHighlight">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l10338" /><CodeLine lineNumber="10338"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Loop hints:&quot;</span></CodeLine>
<Link id="l10339" /><CodeLine lineNumber="10339"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; force=&quot;</span></CodeLine>
<Link id="l10340" /><CodeLine lineNumber="10340"><span class="doxyHighlight">             &lt;&lt; (Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a20ecacbd54e401685d798d86161af6cf">getForce</a>() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea980c2c6e59ca5dcf413baa325d8bc385">LoopVectorizeHints::FK&#95;Disabled</a></span></CodeLine>
<Link id="l10341" /><CodeLine lineNumber="10341"><span class="doxyHighlight">                     ? </span><span class="doxyHighlightStringLiteral">&quot;disabled&quot;</span></CodeLine>
<Link id="l10342" /><CodeLine lineNumber="10342"><span class="doxyHighlight">                     : (Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a20ecacbd54e401685d798d86161af6cf">getForce</a>() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a></span></CodeLine>
<Link id="l10343" /><CodeLine lineNumber="10343"><span class="doxyHighlight">                            ? </span><span class="doxyHighlightStringLiteral">&quot;enabled&quot;</span></CodeLine>
<Link id="l10344" /><CodeLine lineNumber="10344"><span class="doxyHighlight">                            : </span><span class="doxyHighlightStringLiteral">&quot;?&quot;</span><span class="doxyHighlight">))</span></CodeLine>
<Link id="l10345" /><CodeLine lineNumber="10345"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; width=&quot;</span><span class="doxyHighlight"> &lt;&lt; Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a50cae5c2df432357d50f182d310ce7b7">getWidth</a>()</span></CodeLine>
<Link id="l10346" /><CodeLine lineNumber="10346"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; interleave=&quot;</span><span class="doxyHighlight"> &lt;&lt; Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#ad98353127dbeb649d41ca07da5074b49">getInterleave</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10347" /><CodeLine lineNumber="10347"></CodeLine>
<Link id="l10348" /><CodeLine lineNumber="10348"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Function containing loop</span></CodeLine>
<Link id="l10349" /><CodeLine lineNumber="10349"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = L-&gt;getHeader()-&gt;getParent();</span></CodeLine>
<Link id="l10350" /><CodeLine lineNumber="10350"></CodeLine>
<Link id="l10351" /><CodeLine lineNumber="10351"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Looking at the diagnostic output is the only way to determine if a loop</span></CodeLine>
<Link id="l10352" /><CodeLine lineNumber="10352"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// was vectorized (other than looking at the IR or machine code), so it</span></CodeLine>
<Link id="l10353" /><CodeLine lineNumber="10353"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// is important to generate an optimization remark for each loop. Most of</span></CodeLine>
<Link id="l10354" /><CodeLine lineNumber="10354"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// these messages are generated as OptimizationRemarkAnalysis. Remarks</span></CodeLine>
<Link id="l10355" /><CodeLine lineNumber="10355"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// generated as OptimizationRemark and OptimizationRemarkMissed are</span></CodeLine>
<Link id="l10356" /><CodeLine lineNumber="10356"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// less verbose reporting vectorized loops and unvectorized loops that may</span></CodeLine>
<Link id="l10357" /><CodeLine lineNumber="10357"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// benefit from vectorization, respectively.</span></CodeLine>
<Link id="l10358" /><CodeLine lineNumber="10358"></CodeLine>
<Link id="l10359" /><CodeLine lineNumber="10359"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a21b6d9e2aa12c8c68d8e2f122ec7ecec">allowVectorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, L, VectorizeOnlyWhenForced)) &#123;</span></CodeLine>
<Link id="l10360" /><CodeLine lineNumber="10360"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Loop hints prevent vectorization.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10361" /><CodeLine lineNumber="10361"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10362" /><CodeLine lineNumber="10362"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10363" /><CodeLine lineNumber="10363"></CodeLine>
<Link id="l10364" /><CodeLine lineNumber="10364"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> PSE(&#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#a7e7c40b0a986979535eddeb2bb6eae05">SE</a>, &#42;L);</span></CodeLine>
<Link id="l10365" /><CodeLine lineNumber="10365"></CodeLine>
<Link id="l10366" /><CodeLine lineNumber="10366"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if it is legal to vectorize the loop.</span></CodeLine>
<Link id="l10367" /><CodeLine lineNumber="10367"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationrequirements">LoopVectorizationRequirements</a> Requirements;</span></CodeLine>
<Link id="l10368" /><CodeLine lineNumber="10368"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> LVL(L, PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#a38ff83df2a3ad17de50157ed09a1c259">LAIs</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>,</span></CodeLine>
<Link id="l10369" /><CodeLine lineNumber="10369"><span class="doxyHighlight">                                &amp;Requirements, &amp;Hints, <a href="/docs/api/structs/llvm/loopvectorizepass/#a427352f0eda31223a0b25d9f143ce0b1">DB</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>);</span></CodeLine>
<Link id="l10370" /><CodeLine lineNumber="10370"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#a3ce10d1174bdfcac2b73ed7efa352b7f">canVectorize</a>(<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a>)) &#123;</span></CodeLine>
<Link id="l10371" /><CodeLine lineNumber="10371"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Not vectorizing: Cannot prove legality.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10372" /><CodeLine lineNumber="10372"><span class="doxyHighlight">    Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a440979b6103588bef39bd2d62065d5ff">emitRemarkWithHints</a>();</span></CodeLine>
<Link id="l10373" /><CodeLine lineNumber="10373"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10374" /><CodeLine lineNumber="10374"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10375" /><CodeLine lineNumber="10375"></CodeLine>
<Link id="l10376" /><CodeLine lineNumber="10376"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab22ff9e23f7f27234c8f6ec76db0c1f3">hasUncountableEarlyExit</a>() &amp;&amp; !<a href="#af7af1b4bf03205c80dcba0a6324c4f21">EnableEarlyExitVectorization</a>) &#123;</span></CodeLine>
<Link id="l10377" /><CodeLine lineNumber="10377"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span><span class="doxyHighlightStringLiteral">&quot;Auto-vectorization of loops with uncountable &quot;</span></CodeLine>
<Link id="l10378" /><CodeLine lineNumber="10378"><span class="doxyHighlight">                               </span><span class="doxyHighlightStringLiteral">&quot;early exit is not enabled&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10379" /><CodeLine lineNumber="10379"><span class="doxyHighlight">                               </span><span class="doxyHighlightStringLiteral">&quot;UncountableEarlyExitLoopsDisabled&quot;</span><span class="doxyHighlight">, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, L);</span></CodeLine>
<Link id="l10380" /><CodeLine lineNumber="10380"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10381" /><CodeLine lineNumber="10381"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10382" /><CodeLine lineNumber="10382"></CodeLine>
<Link id="l10383" /><CodeLine lineNumber="10383"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#a9ede4d70a86b91ae038a77c86b3f4aaa">hasStructVectorCall</a>()) &#123;</span></CodeLine>
<Link id="l10384" /><CodeLine lineNumber="10384"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span><span class="doxyHighlightStringLiteral">&quot;Auto-vectorization of calls that return struct &quot;</span></CodeLine>
<Link id="l10385" /><CodeLine lineNumber="10385"><span class="doxyHighlight">                               </span><span class="doxyHighlightStringLiteral">&quot;types is not yet supported&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10386" /><CodeLine lineNumber="10386"><span class="doxyHighlight">                               </span><span class="doxyHighlightStringLiteral">&quot;StructCallVectorizationUnsupported&quot;</span><span class="doxyHighlight">, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, L);</span></CodeLine>
<Link id="l10387" /><CodeLine lineNumber="10387"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10388" /><CodeLine lineNumber="10388"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10389" /><CodeLine lineNumber="10389"></CodeLine>
<Link id="l10390" /><CodeLine lineNumber="10390"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Entrance to the VPlan-native vectorization path. Outer loops are processed</span></CodeLine>
<Link id="l10391" /><CodeLine lineNumber="10391"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// here. They may require CFG and instruction level transformations before</span></CodeLine>
<Link id="l10392" /><CodeLine lineNumber="10392"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// even evaluating whether vectorization is profitable. Since we cannot modify</span></CodeLine>
<Link id="l10393" /><CodeLine lineNumber="10393"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the incoming IR, we need to build VPlan upfront in the vectorization</span></CodeLine>
<Link id="l10394" /><CodeLine lineNumber="10394"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// pipeline.</span></CodeLine>
<Link id="l10395" /><CodeLine lineNumber="10395"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!L-&gt;isInnermost())</span></CodeLine>
<Link id="l10396" /><CodeLine lineNumber="10396"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="#adeb41c907ebde15846bc643325909f95">processLoopInVPlanNativePath</a>(L, PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, &amp;LVL, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a427352f0eda31223a0b25d9f143ce0b1">DB</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>,</span></CodeLine>
<Link id="l10397" /><CodeLine lineNumber="10397"><span class="doxyHighlight">                                        <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>, Hints, Requirements);</span></CodeLine>
<Link id="l10398" /><CodeLine lineNumber="10398"></CodeLine>
<Link id="l10399" /><CodeLine lineNumber="10399"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L-&gt;isInnermost() &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;Inner loop expected.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10400" /><CodeLine lineNumber="10400"></CodeLine>
<Link id="l10401" /><CodeLine lineNumber="10401"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/interleavedaccessinfo">InterleavedAccessInfo</a> IAI(PSE, L, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab5632546144c4db5bbe1f975aeebd9d2">getLAI</a>());</span></CodeLine>
<Link id="l10402" /><CodeLine lineNumber="10402"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> UseInterleaved = <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>-&gt;enableInterleavedAccessVectorization();</span></CodeLine>
<Link id="l10403" /><CodeLine lineNumber="10403"></CodeLine>
<Link id="l10404" /><CodeLine lineNumber="10404"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If an override option has been passed in for interleaved accesses, use it.</span></CodeLine>
<Link id="l10405" /><CodeLine lineNumber="10405"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#ac3af17aa5bce5ef8c3aa82faeacfc456">EnableInterleavedMemAccesses</a>.getNumOccurrences() &gt; 0)</span></CodeLine>
<Link id="l10406" /><CodeLine lineNumber="10406"><span class="doxyHighlight">    UseInterleaved = <a href="#ac3af17aa5bce5ef8c3aa82faeacfc456">EnableInterleavedMemAccesses</a>;</span></CodeLine>
<Link id="l10407" /><CodeLine lineNumber="10407"></CodeLine>
<Link id="l10408" /><CodeLine lineNumber="10408"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Analyze interleaved memory accesses.</span></CodeLine>
<Link id="l10409" /><CodeLine lineNumber="10409"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UseInterleaved)</span></CodeLine>
<Link id="l10410" /><CodeLine lineNumber="10410"><span class="doxyHighlight">    IAI.<a href="/docs/api/classes/llvm/interleavedaccessinfo/#af587d7218fa15a456103c3d2125a1fc8">analyzeInterleaving</a>(<a href="#adf8d8fb6f39b9c0cf21d55b7229d35e2">useMaskedInterleavedAccesses</a>(&#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>));</span></CodeLine>
<Link id="l10411" /><CodeLine lineNumber="10411"></CodeLine>
<Link id="l10412" /><CodeLine lineNumber="10412"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab22ff9e23f7f27234c8f6ec76db0c1f3">hasUncountableEarlyExit</a>()) &#123;</span></CodeLine>
<Link id="l10413" /><CodeLine lineNumber="10413"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopLatch = L-&gt;getLoopLatch();</span></CodeLine>
<Link id="l10414" /><CodeLine lineNumber="10414"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IAI.<a href="/docs/api/classes/llvm/interleavedaccessinfo/#a34ed64ff27fabc002da4047589142b02">requiresScalarEpilogue</a>() ||</span></CodeLine>
<Link id="l10415" /><CodeLine lineNumber="10415"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#a7a32abdcf9e80b2483aa55bc36f2840e">getCountableExitingBlocks</a>(),</span></CodeLine>
<Link id="l10416" /><CodeLine lineNumber="10416"><span class="doxyHighlight">               &#91;LoopLatch&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123; return BB != LoopLatch; &#125;)) &#123;</span></CodeLine>
<Link id="l10417" /><CodeLine lineNumber="10417"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span><span class="doxyHighlightStringLiteral">&quot;Auto-vectorization of early exit loops &quot;</span></CodeLine>
<Link id="l10418" /><CodeLine lineNumber="10418"><span class="doxyHighlight">                                 </span><span class="doxyHighlightStringLiteral">&quot;requiring a scalar epilogue is unsupported&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10419" /><CodeLine lineNumber="10419"><span class="doxyHighlight">                                 </span><span class="doxyHighlightStringLiteral">&quot;UncountableEarlyExitUnsupported&quot;</span><span class="doxyHighlight">, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, L);</span></CodeLine>
<Link id="l10420" /><CodeLine lineNumber="10420"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10421" /><CodeLine lineNumber="10421"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l10422" /><CodeLine lineNumber="10422"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10423" /><CodeLine lineNumber="10423"></CodeLine>
<Link id="l10424" /><CodeLine lineNumber="10424"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check the function attributes and profiles to find out if this function</span></CodeLine>
<Link id="l10425" /><CodeLine lineNumber="10425"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// should be optimized for size.</span></CodeLine>
<Link id="l10426" /><CodeLine lineNumber="10426"><span class="doxyHighlight">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> </span><span class="doxyHighlightKeywordType">SEL</span><span class="doxyHighlight"> =</span></CodeLine>
<Link id="l10427" /><CodeLine lineNumber="10427"><span class="doxyHighlight">      <a href="#a8cde912cc23c18f493e4e5005c85748b">getScalarEpilogueLowering</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, L, Hints, <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, LVL, &amp;IAI);</span></CodeLine>
<Link id="l10428" /><CodeLine lineNumber="10428"></CodeLine>
<Link id="l10429" /><CodeLine lineNumber="10429"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check the loop for a trip count threshold: vectorize loops with a tiny trip</span></CodeLine>
<Link id="l10430" /><CodeLine lineNumber="10430"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// count by optimizing for size, to minimize overheads.</span></CodeLine>
<Link id="l10431" /><CodeLine lineNumber="10431"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ExpectedTC = <a href="#a84375e6536d9214c7895013078055aff">getSmallBestKnownTC</a>(PSE, L);</span></CodeLine>
<Link id="l10432" /><CodeLine lineNumber="10432"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (ExpectedTC &amp;&amp; &#42;ExpectedTC &lt; <a href="#a15320a2d7ced6e62766048ae7b6f8b13">TinyTripCountVectorThreshold</a>) &#123;</span></CodeLine>
<Link id="l10433" /><CodeLine lineNumber="10433"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found a loop with a very small trip count. &quot;</span></CodeLine>
<Link id="l10434" /><CodeLine lineNumber="10434"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;This loop is worth vectorizing only if no scalar &quot;</span></CodeLine>
<Link id="l10435" /><CodeLine lineNumber="10435"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;iteration overheads are incurred.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10436" /><CodeLine lineNumber="10436"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a20ecacbd54e401685d798d86161af6cf">getForce</a>() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a>)</span></CodeLine>
<Link id="l10437" /><CodeLine lineNumber="10437"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; But vectorizing was explicitly forced.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10438" /><CodeLine lineNumber="10438"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l10439" /><CodeLine lineNumber="10439"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (&#42;ExpectedTC &gt; <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>-&gt;getMinTripCountTailFoldingThreshold()) &#123;</span></CodeLine>
<Link id="l10440" /><CodeLine lineNumber="10440"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10441" /><CodeLine lineNumber="10441"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Predicate tail-folded loops are efficient even when the loop</span></CodeLine>
<Link id="l10442" /><CodeLine lineNumber="10442"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// iteration count is low. However, setting the epilogue policy to</span></CodeLine>
<Link id="l10443" /><CodeLine lineNumber="10443"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// &#96;CM&#95;ScalarEpilogueNotAllowedLowTripLoop&#96; prevents vectorizing loops</span></CodeLine>
<Link id="l10444" /><CodeLine lineNumber="10444"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// with runtime checks. It&#39;s more effective to let</span></CodeLine>
<Link id="l10445" /><CodeLine lineNumber="10445"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// &#96;areRuntimeChecksProfitable&#96; determine if vectorization is beneficial</span></CodeLine>
<Link id="l10446" /><CodeLine lineNumber="10446"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// for the loop.</span></CodeLine>
<Link id="l10447" /><CodeLine lineNumber="10447"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeywordType">SEL</span><span class="doxyHighlight"> != <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>)</span></CodeLine>
<Link id="l10448" /><CodeLine lineNumber="10448"><span class="doxyHighlight">          </span><span class="doxyHighlightKeywordType">SEL</span><span class="doxyHighlight"> = <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da0a5c3a3ea2de39aa77f3e6da8de4d5bd">CM&#95;ScalarEpilogueNotAllowedLowTripLoop</a>;</span></CodeLine>
<Link id="l10449" /><CodeLine lineNumber="10449"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l10450" /><CodeLine lineNumber="10450"><span class="doxyHighlight">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot; But the target considers the trip count too &quot;</span></CodeLine>
<Link id="l10451" /><CodeLine lineNumber="10451"><span class="doxyHighlight">                             </span><span class="doxyHighlightStringLiteral">&quot;small to consider vectorizing.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10452" /><CodeLine lineNumber="10452"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span></CodeLine>
<Link id="l10453" /><CodeLine lineNumber="10453"><span class="doxyHighlight">            </span><span class="doxyHighlightStringLiteral">&quot;The trip count is below the minial threshold value.&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10454" /><CodeLine lineNumber="10454"><span class="doxyHighlight">            </span><span class="doxyHighlightStringLiteral">&quot;loop trip count is too low, avoiding vectorization&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10455" /><CodeLine lineNumber="10455"><span class="doxyHighlight">            </span><span class="doxyHighlightStringLiteral">&quot;LowTripCount&quot;</span><span class="doxyHighlight">, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, L);</span></CodeLine>
<Link id="l10456" /><CodeLine lineNumber="10456"><span class="doxyHighlight">        Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a440979b6103588bef39bd2d62065d5ff">emitRemarkWithHints</a>();</span></CodeLine>
<Link id="l10457" /><CodeLine lineNumber="10457"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10458" /><CodeLine lineNumber="10458"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l10459" /><CodeLine lineNumber="10459"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l10460" /><CodeLine lineNumber="10460"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10461" /><CodeLine lineNumber="10461"></CodeLine>
<Link id="l10462" /><CodeLine lineNumber="10462"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check the function attributes to see if implicit floats or vectors are</span></CodeLine>
<Link id="l10463" /><CodeLine lineNumber="10463"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// allowed.</span></CodeLine>
<Link id="l10464" /><CodeLine lineNumber="10464"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;hasFnAttribute(Attribute::NoImplicitFloat)) &#123;</span></CodeLine>
<Link id="l10465" /><CodeLine lineNumber="10465"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span></CodeLine>
<Link id="l10466" /><CodeLine lineNumber="10466"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Can&#39;t vectorize when the NoImplicitFloat attribute is used&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10467" /><CodeLine lineNumber="10467"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;loop not vectorized due to NoImplicitFloat attribute&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10468" /><CodeLine lineNumber="10468"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;NoImplicitFloat&quot;</span><span class="doxyHighlight">, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, L);</span></CodeLine>
<Link id="l10469" /><CodeLine lineNumber="10469"><span class="doxyHighlight">    Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a440979b6103588bef39bd2d62065d5ff">emitRemarkWithHints</a>();</span></CodeLine>
<Link id="l10470" /><CodeLine lineNumber="10470"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10471" /><CodeLine lineNumber="10471"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10472" /><CodeLine lineNumber="10472"></CodeLine>
<Link id="l10473" /><CodeLine lineNumber="10473"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Check if the target supports potentially unsafe FP vectorization.</span></CodeLine>
<Link id="l10474" /><CodeLine lineNumber="10474"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// FIXME: Add a check for the type of safety issue (denormal, signaling)</span></CodeLine>
<Link id="l10475" /><CodeLine lineNumber="10475"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// for the target we&#39;re vectorizing for, to make sure none of the</span></CodeLine>
<Link id="l10476" /><CodeLine lineNumber="10476"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// additional fp-math flags can help.</span></CodeLine>
<Link id="l10477" /><CodeLine lineNumber="10477"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a475b1d2223ddab6c0ab44dfcea7dcba7">isPotentiallyUnsafe</a>() &amp;&amp;</span></CodeLine>
<Link id="l10478" /><CodeLine lineNumber="10478"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>-&gt;isFPVectorizationPotentiallyUnsafe()) &#123;</span></CodeLine>
<Link id="l10479" /><CodeLine lineNumber="10479"><span class="doxyHighlight">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</span></CodeLine>
<Link id="l10480" /><CodeLine lineNumber="10480"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Potentially unsafe FP op prevents vectorization&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10481" /><CodeLine lineNumber="10481"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;loop not vectorized due to unsafe FP support.&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10482" /><CodeLine lineNumber="10482"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;UnsafeFP&quot;</span><span class="doxyHighlight">, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, L);</span></CodeLine>
<Link id="l10483" /><CodeLine lineNumber="10483"><span class="doxyHighlight">    Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a440979b6103588bef39bd2d62065d5ff">emitRemarkWithHints</a>();</span></CodeLine>
<Link id="l10484" /><CodeLine lineNumber="10484"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10485" /><CodeLine lineNumber="10485"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10486" /><CodeLine lineNumber="10486"></CodeLine>
<Link id="l10487" /><CodeLine lineNumber="10487"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AllowOrderedReductions;</span></CodeLine>
<Link id="l10488" /><CodeLine lineNumber="10488"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If the flag is set, use that instead and override the TTI behaviour.</span></CodeLine>
<Link id="l10489" /><CodeLine lineNumber="10489"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="#acb0b374f69dc6867357f0aa5e93ab33d">ForceOrderedReductions</a>.getNumOccurrences() &gt; 0)</span></CodeLine>
<Link id="l10490" /><CodeLine lineNumber="10490"><span class="doxyHighlight">    AllowOrderedReductions = <a href="#acb0b374f69dc6867357f0aa5e93ab33d">ForceOrderedReductions</a>;</span></CodeLine>
<Link id="l10491" /><CodeLine lineNumber="10491"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">else</span></CodeLine>
<Link id="l10492" /><CodeLine lineNumber="10492"><span class="doxyHighlight">    AllowOrderedReductions = <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>-&gt;enableOrderedReductions();</span></CodeLine>
<Link id="l10493" /><CodeLine lineNumber="10493"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#a552a158f5a673da0a26461d1471cea41">canVectorizeFPMath</a>(AllowOrderedReductions)) &#123;</span></CodeLine>
<Link id="l10494" /><CodeLine lineNumber="10494"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l10495" /><CodeLine lineNumber="10495"><span class="doxyHighlight">      </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &#42;ExactFPMathInst = Requirements.<a href="/docs/api/classes/llvm/loopvectorizationrequirements/#a2bb8d6e55fae2cbc8eead3d7d4d3af09">getExactFPInst</a>();</span></CodeLine>
<Link id="l10496" /><CodeLine lineNumber="10496"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkanalysisfpcommute">OptimizationRemarkAnalysisFPCommute</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;CantReorderFPOps&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10497" /><CodeLine lineNumber="10497"><span class="doxyHighlight">                                                 ExactFPMathInst-&gt;getDebugLoc(),</span></CodeLine>
<Link id="l10498" /><CodeLine lineNumber="10498"><span class="doxyHighlight">                                                 ExactFPMathInst-&gt;getParent())</span></CodeLine>
<Link id="l10499" /><CodeLine lineNumber="10499"><span class="doxyHighlight">             &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;loop not vectorized: cannot prove it is safe to reorder &quot;</span></CodeLine>
<Link id="l10500" /><CodeLine lineNumber="10500"><span class="doxyHighlight">                </span><span class="doxyHighlightStringLiteral">&quot;floating-point operations&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10501" /><CodeLine lineNumber="10501"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l10502" /><CodeLine lineNumber="10502"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: loop not vectorized: cannot prove it is safe to &quot;</span></CodeLine>
<Link id="l10503" /><CodeLine lineNumber="10503"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;reorder floating-point operations\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10504" /><CodeLine lineNumber="10504"><span class="doxyHighlight">    Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a440979b6103588bef39bd2d62065d5ff">emitRemarkWithHints</a>();</span></CodeLine>
<Link id="l10505" /><CodeLine lineNumber="10505"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10506" /><CodeLine lineNumber="10506"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10507" /><CodeLine lineNumber="10507"></CodeLine>
<Link id="l10508" /><CodeLine lineNumber="10508"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use the cost model.</span></CodeLine>
<Link id="l10509" /><CodeLine lineNumber="10509"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> CM(</span><span class="doxyHighlightKeywordType">SEL</span><span class="doxyHighlight">, L, PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, &amp;LVL, &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a427352f0eda31223a0b25d9f143ce0b1">DB</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>,</span></CodeLine>
<Link id="l10510" /><CodeLine lineNumber="10510"><span class="doxyHighlight">                                <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &amp;Hints, IAI);</span></CodeLine>
<Link id="l10511" /><CodeLine lineNumber="10511"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Use the planner for vectorization.</span></CodeLine>
<Link id="l10512" /><CodeLine lineNumber="10512"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/loopvectorizationplanner">LoopVectorizationPlanner</a> LVP(L, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, &amp;LVL, CM, IAI, PSE, Hints,</span></CodeLine>
<Link id="l10513" /><CodeLine lineNumber="10513"><span class="doxyHighlight">                               <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>);</span></CodeLine>
<Link id="l10514" /><CodeLine lineNumber="10514"></CodeLine>
<Link id="l10515" /><CodeLine lineNumber="10515"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Get user vectorization factor and interleave count.</span></CodeLine>
<Link id="l10516" /><CodeLine lineNumber="10516"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF = Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a50cae5c2df432357d50f182d310ce7b7">getWidth</a>();</span></CodeLine>
<Link id="l10517" /><CodeLine lineNumber="10517"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> UserIC = Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#ad98353127dbeb649d41ca07da5074b49">getInterleave</a>();</span></CodeLine>
<Link id="l10518" /><CodeLine lineNumber="10518"></CodeLine>
<Link id="l10519" /><CodeLine lineNumber="10519"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Plan how to best vectorize.</span></CodeLine>
<Link id="l10520" /><CodeLine lineNumber="10520"><span class="doxyHighlight">  LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#aca6160bb3d669e9ce01f91b124e7e0a1">plan</a>(UserVF, UserIC);</span></CodeLine>
<Link id="l10521" /><CodeLine lineNumber="10521"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> VF = LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a4adc69fc8f74164e990cce6afc1e061b">computeBestVF</a>();</span></CodeLine>
<Link id="l10522" /><CodeLine lineNumber="10522"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> IC = 1;</span></CodeLine>
<Link id="l10523" /><CodeLine lineNumber="10523"></CodeLine>
<Link id="l10524" /><CodeLine lineNumber="10524"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;allowExtraAnalysis(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>))</span></CodeLine>
<Link id="l10525" /><CodeLine lineNumber="10525"><span class="doxyHighlight">    LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#aa216c2cbc8d9610dc20db065aca671d3">emitInvalidCostRemarks</a>(<a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>);</span></CodeLine>
<Link id="l10526" /><CodeLine lineNumber="10526"></CodeLine>
<Link id="l10527" /><CodeLine lineNumber="10527"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> AddBranchWeights =</span></CodeLine>
<Link id="l10528" /><CodeLine lineNumber="10528"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;L-&gt;getLoopLatch()-&gt;getTerminator());</span></CodeLine>
<Link id="l10529" /><CodeLine lineNumber="10529"><span class="doxyHighlight">  GeneratedRTChecks Checks(PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getDataLayout(),</span></CodeLine>
<Link id="l10530" /><CodeLine lineNumber="10530"><span class="doxyHighlight">                           AddBranchWeights, CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</span></CodeLine>
<Link id="l10531" /><CodeLine lineNumber="10531"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#adce80172b05bc0a227fbd5e3d7bb80f2">hasPlanWithVF</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>)) &#123;</span></CodeLine>
<Link id="l10532" /><CodeLine lineNumber="10532"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Select the interleave count.</span></CodeLine>
<Link id="l10533" /><CodeLine lineNumber="10533"><span class="doxyHighlight">    IC = CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af9f62350ccdebd24858be552f3fc051c">selectInterleaveCount</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a048d568675a5cc69c3fb85206882316d">Cost</a>);</span></CodeLine>
<Link id="l10534" /><CodeLine lineNumber="10534"></CodeLine>
<Link id="l10535" /><CodeLine lineNumber="10535"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">unsigned</span><span class="doxyHighlight"> SelectedIC = std::max(IC, UserIC);</span></CodeLine>
<Link id="l10536" /><CodeLine lineNumber="10536"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  Optimistically generate runtime checks if they are needed. Drop them if</span></CodeLine>
<Link id="l10537" /><CodeLine lineNumber="10537"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">//  they turn out to not be profitable.</span></CodeLine>
<Link id="l10538" /><CodeLine lineNumber="10538"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() || SelectedIC &gt; 1)</span></CodeLine>
<Link id="l10539" /><CodeLine lineNumber="10539"><span class="doxyHighlight">      Checks.create(L, &#42;LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab5632546144c4db5bbe1f975aeebd9d2">getLAI</a>(), PSE.<a href="/docs/api/classes/llvm/predicatedscalarevolution/#a12a8ac8838fb851a2de5dc5275307bb6">getPredicate</a>(), VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, SelectedIC);</span></CodeLine>
<Link id="l10540" /><CodeLine lineNumber="10540"></CodeLine>
<Link id="l10541" /><CodeLine lineNumber="10541"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Check if it is profitable to vectorize with runtime checks.</span></CodeLine>
<Link id="l10542" /><CodeLine lineNumber="10542"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> ForceVectorization =</span></CodeLine>
<Link id="l10543" /><CodeLine lineNumber="10543"><span class="doxyHighlight">        Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a20ecacbd54e401685d798d86161af6cf">getForce</a>() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a>;</span></CodeLine>
<Link id="l10544" /><CodeLine lineNumber="10544"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!ForceVectorization &amp;&amp;</span></CodeLine>
<Link id="l10545" /><CodeLine lineNumber="10545"><span class="doxyHighlight">        !<a href="#a362f793f3254317c698e3560548788a5">areRuntimeChecksProfitable</a>(Checks, VF, L, &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, PSE, </span><span class="doxyHighlightKeywordType">SEL</span><span class="doxyHighlight">)) &#123;</span></CodeLine>
<Link id="l10546" /><CodeLine lineNumber="10546"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l10547" /><CodeLine lineNumber="10547"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkanalysisaliasing">OptimizationRemarkAnalysisAliasing</a>(</span></CodeLine>
<Link id="l10548" /><CodeLine lineNumber="10548"><span class="doxyHighlight">                   <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </span><span class="doxyHighlightStringLiteral">&quot;CantReorderMemOps&quot;</span><span class="doxyHighlight">, L-&gt;getStartLoc(),</span></CodeLine>
<Link id="l10549" /><CodeLine lineNumber="10549"><span class="doxyHighlight">                   L-&gt;getHeader())</span></CodeLine>
<Link id="l10550" /><CodeLine lineNumber="10550"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;loop not vectorized: cannot prove it is safe to reorder &quot;</span></CodeLine>
<Link id="l10551" /><CodeLine lineNumber="10551"><span class="doxyHighlight">                  </span><span class="doxyHighlightStringLiteral">&quot;memory operations&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10552" /><CodeLine lineNumber="10552"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l10553" /><CodeLine lineNumber="10553"><span class="doxyHighlight">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Too many memory checks needed.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10554" /><CodeLine lineNumber="10554"><span class="doxyHighlight">      Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a440979b6103588bef39bd2d62065d5ff">emitRemarkWithHints</a>();</span></CodeLine>
<Link id="l10555" /><CodeLine lineNumber="10555"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10556" /><CodeLine lineNumber="10556"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l10557" /><CodeLine lineNumber="10557"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10558" /><CodeLine lineNumber="10558"></CodeLine>
<Link id="l10559" /><CodeLine lineNumber="10559"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Identify the diagnostic messages that should be produced.</span></CodeLine>
<Link id="l10560" /><CodeLine lineNumber="10560"><span class="doxyHighlight">  std::pair&lt;StringRef, std::string&gt; VecDiagMsg, IntDiagMsg;</span></CodeLine>
<Link id="l10561" /><CodeLine lineNumber="10561"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> VectorizeLoop = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, InterleaveLoop = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10562" /><CodeLine lineNumber="10562"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>()) &#123;</span></CodeLine>
<Link id="l10563" /><CodeLine lineNumber="10563"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Vectorization is possible but not beneficial.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10564" /><CodeLine lineNumber="10564"><span class="doxyHighlight">    VecDiagMsg = std::make&#95;pair(</span></CodeLine>
<Link id="l10565" /><CodeLine lineNumber="10565"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;VectorizationNotBeneficial&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10566" /><CodeLine lineNumber="10566"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;the cost-model indicates that vectorization is not beneficial&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10567" /><CodeLine lineNumber="10567"><span class="doxyHighlight">    VectorizeLoop = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10568" /><CodeLine lineNumber="10568"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10569" /><CodeLine lineNumber="10569"></CodeLine>
<Link id="l10570" /><CodeLine lineNumber="10570"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#adce80172b05bc0a227fbd5e3d7bb80f2">hasPlanWithVF</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>) &amp;&amp; UserIC &gt; 1) &#123;</span></CodeLine>
<Link id="l10571" /><CodeLine lineNumber="10571"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Tell the user interleaving was avoided up-front, despite being explicitly</span></CodeLine>
<Link id="l10572" /><CodeLine lineNumber="10572"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// requested.</span></CodeLine>
<Link id="l10573" /><CodeLine lineNumber="10573"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Ignoring UserIC, because vectorization and &quot;</span></CodeLine>
<Link id="l10574" /><CodeLine lineNumber="10574"><span class="doxyHighlight">                         </span><span class="doxyHighlightStringLiteral">&quot;interleaving should be avoided up front\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10575" /><CodeLine lineNumber="10575"><span class="doxyHighlight">    IntDiagMsg = std::make&#95;pair(</span></CodeLine>
<Link id="l10576" /><CodeLine lineNumber="10576"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;InterleavingAvoided&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10577" /><CodeLine lineNumber="10577"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Ignoring UserIC, because interleaving was avoided up front&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10578" /><CodeLine lineNumber="10578"><span class="doxyHighlight">    InterleaveLoop = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10579" /><CodeLine lineNumber="10579"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IC == 1 &amp;&amp; UserIC &lt;= 1) &#123;</span></CodeLine>
<Link id="l10580" /><CodeLine lineNumber="10580"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Tell the user interleaving is not beneficial.</span></CodeLine>
<Link id="l10581" /><CodeLine lineNumber="10581"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Interleaving is not beneficial.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10582" /><CodeLine lineNumber="10582"><span class="doxyHighlight">    IntDiagMsg = std::make&#95;pair(</span></CodeLine>
<Link id="l10583" /><CodeLine lineNumber="10583"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;InterleavingNotBeneficial&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10584" /><CodeLine lineNumber="10584"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;the cost-model indicates that interleaving is not beneficial&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10585" /><CodeLine lineNumber="10585"><span class="doxyHighlight">    InterleaveLoop = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10586" /><CodeLine lineNumber="10586"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (UserIC == 1) &#123;</span></CodeLine>
<Link id="l10587" /><CodeLine lineNumber="10587"><span class="doxyHighlight">      IntDiagMsg.first = </span><span class="doxyHighlightStringLiteral">&quot;InterleavingNotBeneficialAndDisabled&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10588" /><CodeLine lineNumber="10588"><span class="doxyHighlight">      IntDiagMsg.second +=</span></CodeLine>
<Link id="l10589" /><CodeLine lineNumber="10589"><span class="doxyHighlight">          </span><span class="doxyHighlightStringLiteral">&quot; and is explicitly disabled or interleave count is set to 1&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10590" /><CodeLine lineNumber="10590"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l10591" /><CodeLine lineNumber="10591"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (IC &gt; 1 &amp;&amp; UserIC == 1) &#123;</span></CodeLine>
<Link id="l10592" /><CodeLine lineNumber="10592"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Tell the user interleaving is beneficial, but it explicitly disabled.</span></CodeLine>
<Link id="l10593" /><CodeLine lineNumber="10593"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</span></CodeLine>
<Link id="l10594" /><CodeLine lineNumber="10594"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Interleaving is beneficial but is explicitly disabled.&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10595" /><CodeLine lineNumber="10595"><span class="doxyHighlight">    IntDiagMsg = std::make&#95;pair(</span></CodeLine>
<Link id="l10596" /><CodeLine lineNumber="10596"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;InterleavingBeneficialButDisabled&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10597" /><CodeLine lineNumber="10597"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;the cost-model indicates that interleaving is beneficial &quot;</span></CodeLine>
<Link id="l10598" /><CodeLine lineNumber="10598"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;but is explicitly disabled or interleave count is set to 1&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10599" /><CodeLine lineNumber="10599"><span class="doxyHighlight">    InterleaveLoop = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10600" /><CodeLine lineNumber="10600"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10601" /><CodeLine lineNumber="10601"></CodeLine>
<Link id="l10602" /><CodeLine lineNumber="10602"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// If there is a histogram in the loop, do not just interleave without</span></CodeLine>
<Link id="l10603" /><CodeLine lineNumber="10603"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorizing. The order of operations will be incorrect without the</span></CodeLine>
<Link id="l10604" /><CodeLine lineNumber="10604"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// histogram intrinsics, which are only used for recipes with VF &gt; 1</span></CodeLine>
<Link id="l10605" /><CodeLine lineNumber="10605"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VectorizeLoop &amp;&amp; InterleaveLoop &amp;&amp; LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab306c8094bdb8c7cbdbdfb9a05800007">hasHistograms</a>()) &#123;</span></CodeLine>
<Link id="l10606" /><CodeLine lineNumber="10606"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Not interleaving without vectorization due &quot;</span></CodeLine>
<Link id="l10607" /><CodeLine lineNumber="10607"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;to histogram operations.\\n&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10608" /><CodeLine lineNumber="10608"><span class="doxyHighlight">    IntDiagMsg = std::make&#95;pair(</span></CodeLine>
<Link id="l10609" /><CodeLine lineNumber="10609"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;HistogramPreventsScalarInterleaving&quot;</span><span class="doxyHighlight">,</span></CodeLine>
<Link id="l10610" /><CodeLine lineNumber="10610"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;Unable to interleave without vectorization due to constraints on &quot;</span></CodeLine>
<Link id="l10611" /><CodeLine lineNumber="10611"><span class="doxyHighlight">        </span><span class="doxyHighlightStringLiteral">&quot;the order of histogram operations&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10612" /><CodeLine lineNumber="10612"><span class="doxyHighlight">    InterleaveLoop = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10613" /><CodeLine lineNumber="10613"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10614" /><CodeLine lineNumber="10614"></CodeLine>
<Link id="l10615" /><CodeLine lineNumber="10615"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Override IC if user provided an interleave count.</span></CodeLine>
<Link id="l10616" /><CodeLine lineNumber="10616"><span class="doxyHighlight">  IC = UserIC &gt; 0 ? UserIC : IC;</span></CodeLine>
<Link id="l10617" /><CodeLine lineNumber="10617"></CodeLine>
<Link id="l10618" /><CodeLine lineNumber="10618"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Emit diagnostic messages, if any.</span></CodeLine>
<Link id="l10619" /><CodeLine lineNumber="10619"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordType">char</span><span class="doxyHighlight"> &#42;VAPassName = Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#abcf8c2b35316773f1ab0ba70aeb2a6de">vectorizeAnalysisPassName</a>();</span></CodeLine>
<Link id="l10620" /><CodeLine lineNumber="10620"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VectorizeLoop &amp;&amp; !InterleaveLoop) &#123;</span></CodeLine>
<Link id="l10621" /><CodeLine lineNumber="10621"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Do not vectorize or interleaving the loop.</span></CodeLine>
<Link id="l10622" /><CodeLine lineNumber="10622"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l10623" /><CodeLine lineNumber="10623"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkmissed">OptimizationRemarkMissed</a>(VAPassName, VecDiagMsg.first,</span></CodeLine>
<Link id="l10624" /><CodeLine lineNumber="10624"><span class="doxyHighlight">                                      L-&gt;getStartLoc(), L-&gt;getHeader())</span></CodeLine>
<Link id="l10625" /><CodeLine lineNumber="10625"><span class="doxyHighlight">             &lt;&lt; VecDiagMsg.second;</span></CodeLine>
<Link id="l10626" /><CodeLine lineNumber="10626"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l10627" /><CodeLine lineNumber="10627"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l10628" /><CodeLine lineNumber="10628"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkmissed">OptimizationRemarkMissed</a>(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>, IntDiagMsg.first,</span></CodeLine>
<Link id="l10629" /><CodeLine lineNumber="10629"><span class="doxyHighlight">                                      L-&gt;getStartLoc(), L-&gt;getHeader())</span></CodeLine>
<Link id="l10630" /><CodeLine lineNumber="10630"><span class="doxyHighlight">             &lt;&lt; IntDiagMsg.second;</span></CodeLine>
<Link id="l10631" /><CodeLine lineNumber="10631"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l10632" /><CodeLine lineNumber="10632"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10633" /><CodeLine lineNumber="10633"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10634" /><CodeLine lineNumber="10634"></CodeLine>
<Link id="l10635" /><CodeLine lineNumber="10635"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VectorizeLoop &amp;&amp; InterleaveLoop) &#123;</span></CodeLine>
<Link id="l10636" /><CodeLine lineNumber="10636"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Interleave Count is &quot;</span><span class="doxyHighlight"> &lt;&lt; IC &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10637" /><CodeLine lineNumber="10637"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l10638" /><CodeLine lineNumber="10638"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a>(VAPassName, VecDiagMsg.first,</span></CodeLine>
<Link id="l10639" /><CodeLine lineNumber="10639"><span class="doxyHighlight">                                        L-&gt;getStartLoc(), L-&gt;getHeader())</span></CodeLine>
<Link id="l10640" /><CodeLine lineNumber="10640"><span class="doxyHighlight">             &lt;&lt; VecDiagMsg.second;</span></CodeLine>
<Link id="l10641" /><CodeLine lineNumber="10641"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l10642" /><CodeLine lineNumber="10642"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VectorizeLoop &amp;&amp; !InterleaveLoop) &#123;</span></CodeLine>
<Link id="l10643" /><CodeLine lineNumber="10643"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found a vectorizable loop (&quot;</span><span class="doxyHighlight"> &lt;&lt; VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a></span></CodeLine>
<Link id="l10644" /><CodeLine lineNumber="10644"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;) in &quot;</span><span class="doxyHighlight"> &lt;&lt; L-&gt;getLocStr() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10645" /><CodeLine lineNumber="10645"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l10646" /><CodeLine lineNumber="10646"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a>(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>, IntDiagMsg.first,</span></CodeLine>
<Link id="l10647" /><CodeLine lineNumber="10647"><span class="doxyHighlight">                                        L-&gt;getStartLoc(), L-&gt;getHeader())</span></CodeLine>
<Link id="l10648" /><CodeLine lineNumber="10648"><span class="doxyHighlight">             &lt;&lt; IntDiagMsg.second;</span></CodeLine>
<Link id="l10649" /><CodeLine lineNumber="10649"><span class="doxyHighlight">    &#125;);</span></CodeLine>
<Link id="l10650" /><CodeLine lineNumber="10650"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (VectorizeLoop &amp;&amp; InterleaveLoop) &#123;</span></CodeLine>
<Link id="l10651" /><CodeLine lineNumber="10651"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Found a vectorizable loop (&quot;</span><span class="doxyHighlight"> &lt;&lt; VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a></span></CodeLine>
<Link id="l10652" /><CodeLine lineNumber="10652"><span class="doxyHighlight">                      &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;) in &quot;</span><span class="doxyHighlight"> &lt;&lt; L-&gt;getLocStr() &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10653" /><CodeLine lineNumber="10653"><span class="doxyHighlight">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;LV: Interleave Count is &quot;</span><span class="doxyHighlight"> &lt;&lt; IC &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;\\n&#39;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10654" /><CodeLine lineNumber="10654"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10655" /><CodeLine lineNumber="10655"></CodeLine>
<Link id="l10656" /><CodeLine lineNumber="10656"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> DisableRuntimeUnroll = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10657" /><CodeLine lineNumber="10657"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;OrigLoopID = L-&gt;getLoopID();</span></CodeLine>
<Link id="l10658" /><CodeLine lineNumber="10658"><span class="doxyHighlight">  &#123;</span></CodeLine>
<Link id="l10659" /><CodeLine lineNumber="10659"><span class="doxyHighlight">    </span><span class="doxyHighlightKeyword">using namespace </span><span class="doxyHighlight"><a href="/docs/api/namespaces/llvm/ore">ore</a>;</span></CodeLine>
<Link id="l10660" /><CodeLine lineNumber="10660"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!VectorizeLoop) &#123;</span></CodeLine>
<Link id="l10661" /><CodeLine lineNumber="10661"><span class="doxyHighlight">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IC &gt; 1 &amp;&amp; </span><span class="doxyHighlightStringLiteral">&quot;interleave count should not be 1 or 0&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10662" /><CodeLine lineNumber="10662"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we decided that it is not legal to vectorize the loop, then</span></CodeLine>
<Link id="l10663" /><CodeLine lineNumber="10663"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// interleave it.</span></CodeLine>
<Link id="l10664" /><CodeLine lineNumber="10664"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;BestPlan = LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>);</span></CodeLine>
<Link id="l10665" /><CodeLine lineNumber="10665"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/innerloopvectorizer">InnerLoopVectorizer</a> Unroller(</span></CodeLine>
<Link id="l10666" /><CodeLine lineNumber="10666"><span class="doxyHighlight">          L, PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1),</span></CodeLine>
<Link id="l10667" /><CodeLine lineNumber="10667"><span class="doxyHighlight">          <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1), IC, &amp;LVL, &amp;CM, <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>, Checks, BestPlan);</span></CodeLine>
<Link id="l10668" /><CodeLine lineNumber="10668"></CodeLine>
<Link id="l10669" /><CodeLine lineNumber="10669"><span class="doxyHighlight">      LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#acbe2feb9e960936a43c845a1fa8eaba4">executePlan</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, IC, BestPlan, Unroller, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10670" /><CodeLine lineNumber="10670"></CodeLine>
<Link id="l10671" /><CodeLine lineNumber="10671"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</span></CodeLine>
<Link id="l10672" /><CodeLine lineNumber="10672"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/optimizationremark">OptimizationRemark</a>(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>, </span><span class="doxyHighlightStringLiteral">&quot;Interleaved&quot;</span><span class="doxyHighlight">, L-&gt;getStartLoc(),</span></CodeLine>
<Link id="l10673" /><CodeLine lineNumber="10673"><span class="doxyHighlight">                                  L-&gt;getHeader())</span></CodeLine>
<Link id="l10674" /><CodeLine lineNumber="10674"><span class="doxyHighlight">               &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;interleaved loop (interleaved count: &quot;</span></CodeLine>
<Link id="l10675" /><CodeLine lineNumber="10675"><span class="doxyHighlight">               &lt;&lt; NV(</span><span class="doxyHighlightStringLiteral">&quot;InterleaveCount&quot;</span><span class="doxyHighlight">, IC) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;)&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10676" /><CodeLine lineNumber="10676"><span class="doxyHighlight">      &#125;);</span></CodeLine>
<Link id="l10677" /><CodeLine lineNumber="10677"><span class="doxyHighlight">    &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l10678" /><CodeLine lineNumber="10678"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// If we decided that it is &#42;legal&#42; to vectorize the loop, then do it.</span></CodeLine>
<Link id="l10679" /><CodeLine lineNumber="10679"></CodeLine>
<Link id="l10680" /><CodeLine lineNumber="10680"><span class="doxyHighlight">      <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;BestPlan = LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>);</span></CodeLine>
<Link id="l10681" /><CodeLine lineNumber="10681"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Consider vectorizing the epilogue too if it&#39;s profitable.</span></CodeLine>
<Link id="l10682" /><CodeLine lineNumber="10682"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> EpilogueVF =</span></CodeLine>
<Link id="l10683" /><CodeLine lineNumber="10683"><span class="doxyHighlight">          LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a0b6b1ae088cb8ca3aa4f26c4098daa3d">selectEpilogueVectorizationFactor</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, IC);</span></CodeLine>
<Link id="l10684" /><CodeLine lineNumber="10684"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (EpilogueVF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()) &#123;</span></CodeLine>
<Link id="l10685" /><CodeLine lineNumber="10685"><span class="doxyHighlight">        std::unique&#95;ptr&lt;VPlan&gt; BestMainPlan(BestPlan.<a href="/docs/api/classes/llvm/vplan/#afadf7ae5a5fad2c0bde13e8b72bf7a71">duplicate</a>());</span></CodeLine>
<Link id="l10686" /><CodeLine lineNumber="10686"></CodeLine>
<Link id="l10687" /><CodeLine lineNumber="10687"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// The first pass vectorizes the main loop and creates a scalar epilogue</span></CodeLine>
<Link id="l10688" /><CodeLine lineNumber="10688"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// to be vectorized by executing the plan (potentially with a different</span></CodeLine>
<Link id="l10689" /><CodeLine lineNumber="10689"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// factor) again shortly afterwards.</span></CodeLine>
<Link id="l10690" /><CodeLine lineNumber="10690"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;BestEpiPlan = LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(EpilogueVF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>);</span></CodeLine>
<Link id="l10691" /><CodeLine lineNumber="10691"><span class="doxyHighlight">        <a href="#a13368acf4fbb5816c3d82099b11519b1">preparePlanForMainVectorLoop</a>(&#42;BestMainPlan, BestEpiPlan);</span></CodeLine>
<Link id="l10692" /><CodeLine lineNumber="10692"><span class="doxyHighlight">        <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a> EPI(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, IC, EpilogueVF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, 1,</span></CodeLine>
<Link id="l10693" /><CodeLine lineNumber="10693"><span class="doxyHighlight">                                          BestEpiPlan);</span></CodeLine>
<Link id="l10694" /><CodeLine lineNumber="10694"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/epiloguevectorizermainloop">EpilogueVectorizerMainLoop</a> MainILV(L, PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>,</span></CodeLine>
<Link id="l10695" /><CodeLine lineNumber="10695"><span class="doxyHighlight">                                           EPI, &amp;LVL, &amp;CM, <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>, Checks,</span></CodeLine>
<Link id="l10696" /><CodeLine lineNumber="10696"><span class="doxyHighlight">                                           &#42;BestMainPlan);</span></CodeLine>
<Link id="l10697" /><CodeLine lineNumber="10697"><span class="doxyHighlight">        </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> ExpandedSCEVs = LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#acbe2feb9e960936a43c845a1fa8eaba4">executePlan</a>(EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d536d11651c11a778ea9fe9332a4a2e">MainLoopVF</a>, EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a18939d452d993dd7ddd465c5c11535a4">MainLoopUF</a>,</span></CodeLine>
<Link id="l10698" /><CodeLine lineNumber="10698"><span class="doxyHighlight">                                             &#42;BestMainPlan, MainILV, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10699" /><CodeLine lineNumber="10699"><span class="doxyHighlight">        ++LoopsVectorized;</span></CodeLine>
<Link id="l10700" /><CodeLine lineNumber="10700"></CodeLine>
<Link id="l10701" /><CodeLine lineNumber="10701"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Second pass vectorizes the epilogue and adjusts the control flow</span></CodeLine>
<Link id="l10702" /><CodeLine lineNumber="10702"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// edges from the first pass.</span></CodeLine>
<Link id="l10703" /><CodeLine lineNumber="10703"><span class="doxyHighlight">        EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d536d11651c11a778ea9fe9332a4a2e">MainLoopVF</a> = EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a529385ab333b24f1f2c2dd8525ad52a8">EpilogueVF</a>;</span></CodeLine>
<Link id="l10704" /><CodeLine lineNumber="10704"><span class="doxyHighlight">        EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a18939d452d993dd7ddd465c5c11535a4">MainLoopUF</a> = EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6ec74a5afe1cfb93444b9f8988ed4c12">EpilogueUF</a>;</span></CodeLine>
<Link id="l10705" /><CodeLine lineNumber="10705"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop">EpilogueVectorizerEpilogueLoop</a> EpilogILV(L, PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>,</span></CodeLine>
<Link id="l10706" /><CodeLine lineNumber="10706"><span class="doxyHighlight">                                                 <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, EPI, &amp;LVL, &amp;CM, <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>,</span></CodeLine>
<Link id="l10707" /><CodeLine lineNumber="10707"><span class="doxyHighlight">                                                 Checks, BestEpiPlan);</span></CodeLine>
<Link id="l10708" /><CodeLine lineNumber="10708"><span class="doxyHighlight">        EpilogILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a9160ed9f749a9c4df711061181288e13">setTripCount</a>(MainILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696">getTripCount</a>());</span></CodeLine>
<Link id="l10709" /><CodeLine lineNumber="10709"><span class="doxyHighlight">        <a href="#aae23f7e6fc37b0f1bb756f938023512c">preparePlanForEpilogueVectorLoop</a>(BestEpiPlan, L, ExpandedSCEVs, EPI);</span></CodeLine>
<Link id="l10710" /><CodeLine lineNumber="10710"></CodeLine>
<Link id="l10711" /><CodeLine lineNumber="10711"><span class="doxyHighlight">        LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#acbe2feb9e960936a43c845a1fa8eaba4">executePlan</a>(EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a529385ab333b24f1f2c2dd8525ad52a8">EpilogueVF</a>, EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6ec74a5afe1cfb93444b9f8988ed4c12">EpilogueUF</a>, BestEpiPlan, EpilogILV,</span></CodeLine>
<Link id="l10712" /><CodeLine lineNumber="10712"><span class="doxyHighlight">                        <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">, &amp;ExpandedSCEVs);</span></CodeLine>
<Link id="l10713" /><CodeLine lineNumber="10713"><span class="doxyHighlight">        ++LoopsEpilogueVectorized;</span></CodeLine>
<Link id="l10714" /><CodeLine lineNumber="10714"></CodeLine>
<Link id="l10715" /><CodeLine lineNumber="10715"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!MainILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a2e066ef7bc9673cbb2a825189491577d">areSafetyChecksAdded</a>())</span></CodeLine>
<Link id="l10716" /><CodeLine lineNumber="10716"><span class="doxyHighlight">          DisableRuntimeUnroll = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10717" /><CodeLine lineNumber="10717"><span class="doxyHighlight">      &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l10718" /><CodeLine lineNumber="10718"><span class="doxyHighlight">        <a href="/docs/api/classes/llvm/innerloopvectorizer">InnerLoopVectorizer</a> LB(L, PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>,</span></CodeLine>
<Link id="l10719" /><CodeLine lineNumber="10719"><span class="doxyHighlight">                               VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a0c1900dc8fe6b998c1de1880f300dcfa">MinProfitableTripCount</a>, IC, &amp;LVL, &amp;CM, <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a>,</span></CodeLine>
<Link id="l10720" /><CodeLine lineNumber="10720"><span class="doxyHighlight">                               <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>, Checks, BestPlan);</span></CodeLine>
<Link id="l10721" /><CodeLine lineNumber="10721"><span class="doxyHighlight">        LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#acbe2feb9e960936a43c845a1fa8eaba4">executePlan</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, IC, BestPlan, LB, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10722" /><CodeLine lineNumber="10722"><span class="doxyHighlight">        ++LoopsVectorized;</span></CodeLine>
<Link id="l10723" /><CodeLine lineNumber="10723"></CodeLine>
<Link id="l10724" /><CodeLine lineNumber="10724"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// Add metadata to disable runtime unrolling a scalar loop when there</span></CodeLine>
<Link id="l10725" /><CodeLine lineNumber="10725"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// are no runtime checks about strides and memory. A scalar loop that is</span></CodeLine>
<Link id="l10726" /><CodeLine lineNumber="10726"><span class="doxyHighlight">        </span><span class="doxyHighlightComment">// rarely used is not worth unrolling.</span></CodeLine>
<Link id="l10727" /><CodeLine lineNumber="10727"><span class="doxyHighlight">        </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!LB.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a2e066ef7bc9673cbb2a825189491577d">areSafetyChecksAdded</a>())</span></CodeLine>
<Link id="l10728" /><CodeLine lineNumber="10728"><span class="doxyHighlight">          DisableRuntimeUnroll = </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10729" /><CodeLine lineNumber="10729"><span class="doxyHighlight">      &#125;</span></CodeLine>
<Link id="l10730" /><CodeLine lineNumber="10730"><span class="doxyHighlight">      </span><span class="doxyHighlightComment">// Report the vectorization decision.</span></CodeLine>
<Link id="l10731" /><CodeLine lineNumber="10731"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a0c19b37908311872f655348755e8d003">reportVectorization</a>(<a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, L, VF, IC);</span></CodeLine>
<Link id="l10732" /><CodeLine lineNumber="10732"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l10733" /><CodeLine lineNumber="10733"></CodeLine>
<Link id="l10734" /><CodeLine lineNumber="10734"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;allowExtraAnalysis(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>))</span></CodeLine>
<Link id="l10735" /><CodeLine lineNumber="10735"><span class="doxyHighlight">      <a href="#af1fba45879c49d4839b11ec30afd7532">checkMixedPrecision</a>(L, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>);</span></CodeLine>
<Link id="l10736" /><CodeLine lineNumber="10736"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10737" /><CodeLine lineNumber="10737"></CodeLine>
<Link id="l10738" /><CodeLine lineNumber="10738"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>-&gt;verify(DominatorTree::VerificationLevel::Fast) &amp;&amp;</span></CodeLine>
<Link id="l10739" /><CodeLine lineNumber="10739"><span class="doxyHighlight">         </span><span class="doxyHighlightStringLiteral">&quot;DT not preserved correctly&quot;</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10740" /><CodeLine lineNumber="10740"></CodeLine>
<Link id="l10741" /><CodeLine lineNumber="10741"><span class="doxyHighlight">  std::optional&lt;MDNode &#42;&gt; RemainderLoopID =</span></CodeLine>
<Link id="l10742" /><CodeLine lineNumber="10742"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a368216c9c116e3f30d8dd352ce1370fc">makeFollowupLoopID</a>(OrigLoopID, &#123;<a href="#a3bf55ccbbeedcfb8cd2a1bd62c0ad91a">LLVMLoopVectorizeFollowupAll</a>,</span></CodeLine>
<Link id="l10743" /><CodeLine lineNumber="10743"><span class="doxyHighlight">                                      <a href="#aadedae9de069f3bcef6fa7a90ce4a630">LLVMLoopVectorizeFollowupEpilogue</a>&#125;);</span></CodeLine>
<Link id="l10744" /><CodeLine lineNumber="10744"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (RemainderLoopID) &#123;</span></CodeLine>
<Link id="l10745" /><CodeLine lineNumber="10745"><span class="doxyHighlight">    L-&gt;setLoopID(&#42;RemainderLoopID);</span></CodeLine>
<Link id="l10746" /><CodeLine lineNumber="10746"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l10747" /><CodeLine lineNumber="10747"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (DisableRuntimeUnroll)</span></CodeLine>
<Link id="l10748" /><CodeLine lineNumber="10748"><span class="doxyHighlight">      <a href="#a033bb363914fbd3c2cd990330959036c">addRuntimeUnrollDisableMetaData</a>(L);</span></CodeLine>
<Link id="l10749" /><CodeLine lineNumber="10749"></CodeLine>
<Link id="l10750" /><CodeLine lineNumber="10750"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Mark the loop as already vectorized to avoid vectorizing again.</span></CodeLine>
<Link id="l10751" /><CodeLine lineNumber="10751"><span class="doxyHighlight">    Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#aa2f5ef2d522fb80de283a23d5bed6d86">setAlreadyVectorized</a>();</span></CodeLine>
<Link id="l10752" /><CodeLine lineNumber="10752"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10753" /><CodeLine lineNumber="10753"></CodeLine>
<Link id="l10754" /><CodeLine lineNumber="10754"><span class="doxyHighlight">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a26389c546573f058ad8ecbdc5c1933cf">verifyFunction</a>(&#42;L-&gt;getHeader()-&gt;getParent(), &amp;<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</span></CodeLine>
<Link id="l10755" /><CodeLine lineNumber="10755"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10756" /><CodeLine lineNumber="10756"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l10757" /><CodeLine lineNumber="10757"></CodeLine>
<Link id="l10758" /><CodeLine lineNumber="10758" lineLink="/docs/api/structs/llvm/loopvectorizepass/#a0d3ab70393b799b3be4875c3334a4f42"><span class="doxyHighlight"><a href="/docs/api/structs/llvm/loopvectorizeresult">LoopVectorizeResult</a> <a href="/docs/api/structs/llvm/loopvectorizepass/#a0d3ab70393b799b3be4875c3334a4f42">LoopVectorizePass::runImpl</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</span></CodeLine>
<Link id="l10759" /><CodeLine lineNumber="10759"></CodeLine>
<Link id="l10760" /><CodeLine lineNumber="10760"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Don&#39;t attempt if</span></CodeLine>
<Link id="l10761" /><CodeLine lineNumber="10761"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 1 the target claims to have no vector registers, and</span></CodeLine>
<Link id="l10762" /><CodeLine lineNumber="10762"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// 2 interleaving won&#39;t help ILP.</span></CodeLine>
<Link id="l10763" /><CodeLine lineNumber="10763"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">//</span></CodeLine>
<Link id="l10764" /><CodeLine lineNumber="10764"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The second condition is necessary because, even if the target has no</span></CodeLine>
<Link id="l10765" /><CodeLine lineNumber="10765"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vector registers, loop vectorization may still enable scalar</span></CodeLine>
<Link id="l10766" /><CodeLine lineNumber="10766"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// interleaving.</span></CodeLine>
<Link id="l10767" /><CodeLine lineNumber="10767"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!<a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>-&gt;getNumberOfRegisters(<a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>-&gt;getRegisterClassForType(</span><span class="doxyHighlightKeyword">true</span><span class="doxyHighlight">)) &amp;&amp;</span></CodeLine>
<Link id="l10768" /><CodeLine lineNumber="10768"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>-&gt;getMaxInterleaveFactor(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1)) &lt; 2)</span></CodeLine>
<Link id="l10769" /><CodeLine lineNumber="10769"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/loopvectorizeresult">LoopVectorizeResult</a>(</span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10770" /><CodeLine lineNumber="10770"></CodeLine>
<Link id="l10771" /><CodeLine lineNumber="10771"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordType">bool</span><span class="doxyHighlight"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">, CFGChanged = </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10772" /><CodeLine lineNumber="10772"></CodeLine>
<Link id="l10773" /><CodeLine lineNumber="10773"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// The vectorizer requires loops to be in simplified form.</span></CodeLine>
<Link id="l10774" /><CodeLine lineNumber="10774"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Since simplification may add new inner loops, it has to run before the</span></CodeLine>
<Link id="l10775" /><CodeLine lineNumber="10775"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// legality and profitability checks. This means running the loop vectorizer</span></CodeLine>
<Link id="l10776" /><CodeLine lineNumber="10776"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// will simplify all loops, regardless of whether anything end up being</span></CodeLine>
<Link id="l10777" /><CodeLine lineNumber="10777"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// vectorized.</span></CodeLine>
<Link id="l10778" /><CodeLine lineNumber="10778"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">const</span><span class="doxyHighlight"> </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;L : &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>)</span></CodeLine>
<Link id="l10779" /><CodeLine lineNumber="10779"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= CFGChanged |=</span></CodeLine>
<Link id="l10780" /><CodeLine lineNumber="10780"><span class="doxyHighlight">        <a href="/docs/api/namespaces/llvm/#a0083a69883e0f97e111dbff064c60f42">simplifyLoop</a>(L, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a7e7c40b0a986979535eddeb2bb6eae05">SE</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>, </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">, </span><span class="doxyHighlightKeyword">false</span><span class="doxyHighlight"> </span><span class="doxyHighlightComment">/&#42; PreserveLCSSA &#42;/</span><span class="doxyHighlight">);</span></CodeLine>
<Link id="l10781" /><CodeLine lineNumber="10781"></CodeLine>
<Link id="l10782" /><CodeLine lineNumber="10782"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Build up a worklist of inner-loops to vectorize. This is necessary as</span></CodeLine>
<Link id="l10783" /><CodeLine lineNumber="10783"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// the act of vectorizing or partially unrolling a loop creates new loops</span></CodeLine>
<Link id="l10784" /><CodeLine lineNumber="10784"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// and can invalidate iterators across the loops.</span></CodeLine>
<Link id="l10785" /><CodeLine lineNumber="10785"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Loop &#42;, 8&gt;</a> Worklist;</span></CodeLine>
<Link id="l10786" /><CodeLine lineNumber="10786"></CodeLine>
<Link id="l10787" /><CodeLine lineNumber="10787"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L : &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>)</span></CodeLine>
<Link id="l10788" /><CodeLine lineNumber="10788"><span class="doxyHighlight">    <a href="#a00315ff11c9068aab97e5780bdfa5eef">collectSupportedLoops</a>(&#42;L, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, Worklist);</span></CodeLine>
<Link id="l10789" /><CodeLine lineNumber="10789"></CodeLine>
<Link id="l10790" /><CodeLine lineNumber="10790"><span class="doxyHighlight">  LoopsAnalyzed += Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</span></CodeLine>
<Link id="l10791" /><CodeLine lineNumber="10791"></CodeLine>
<Link id="l10792" /><CodeLine lineNumber="10792"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Now walk the identified inner loops.</span></CodeLine>
<Link id="l10793" /><CodeLine lineNumber="10793"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">while</span><span class="doxyHighlight"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</span></CodeLine>
<Link id="l10794" /><CodeLine lineNumber="10794"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</span></CodeLine>
<Link id="l10795" /><CodeLine lineNumber="10795"></CodeLine>
<Link id="l10796" /><CodeLine lineNumber="10796"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// For the inner loops we actually process, form LCSSA to simplify the</span></CodeLine>
<Link id="l10797" /><CodeLine lineNumber="10797"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// transform.</span></CodeLine>
<Link id="l10798" /><CodeLine lineNumber="10798"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/namespaces/llvm/#a30e47ae014eb35bea24e45097c2bd731">formLCSSARecursively</a>(&#42;L, &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a7e7c40b0a986979535eddeb2bb6eae05">SE</a>);</span></CodeLine>
<Link id="l10799" /><CodeLine lineNumber="10799"></CodeLine>
<Link id="l10800" /><CodeLine lineNumber="10800"><span class="doxyHighlight">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= CFGChanged |= <a href="/docs/api/structs/llvm/loopvectorizepass/#a160afa01e95095aa0c8115b6e0e6f4a6">processLoop</a>(L);</span></CodeLine>
<Link id="l10801" /><CodeLine lineNumber="10801"></CodeLine>
<Link id="l10802" /><CodeLine lineNumber="10802"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>) &#123;</span></CodeLine>
<Link id="l10803" /><CodeLine lineNumber="10803"><span class="doxyHighlight">      <a href="/docs/api/structs/llvm/loopvectorizepass/#a38ff83df2a3ad17de50157ed09a1c259">LAIs</a>-&gt;clear();</span></CodeLine>
<Link id="l10804" /><CodeLine lineNumber="10804"></CodeLine>
<Link id="l10805" /><CodeLine lineNumber="10805"><span class="doxyHighlightPreprocessor">#ifndef NDEBUG</span></CodeLine>
<Link id="l10806" /><CodeLine lineNumber="10806"><span class="doxyHighlight">      </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#a4522d39270d83d73550a3777a2fca312">VerifySCEV</a>)</span></CodeLine>
<Link id="l10807" /><CodeLine lineNumber="10807"><span class="doxyHighlight">        <a href="/docs/api/structs/llvm/loopvectorizepass/#a7e7c40b0a986979535eddeb2bb6eae05">SE</a>-&gt;verify();</span></CodeLine>
<Link id="l10808" /><CodeLine lineNumber="10808"><span class="doxyHighlightPreprocessor">#endif</span></CodeLine>
<Link id="l10809" /><CodeLine lineNumber="10809"><span class="doxyHighlight">    &#125;</span></CodeLine>
<Link id="l10810" /><CodeLine lineNumber="10810"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10811" /><CodeLine lineNumber="10811"></CodeLine>
<Link id="l10812" /><CodeLine lineNumber="10812"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// Process each loop nest in the function.</span></CodeLine>
<Link id="l10813" /><CodeLine lineNumber="10813"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/loopvectorizeresult">LoopVectorizeResult</a>(<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>, CFGChanged);</span></CodeLine>
<Link id="l10814" /><CodeLine lineNumber="10814"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l10815" /><CodeLine lineNumber="10815"></CodeLine>
<Link id="l10816" /><CodeLine lineNumber="10816" lineLink="/docs/api/structs/llvm/loopvectorizepass/#af3b0e58cfdb2c6c663cd47a8808ba70a"><span class="doxyHighlight"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/structs/llvm/loopvectorizepass/#af3b0e58cfdb2c6c663cd47a8808ba70a">LoopVectorizePass::run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</span></CodeLine>
<Link id="l10817" /><CodeLine lineNumber="10817"><span class="doxyHighlight">                                         <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM) &#123;</span></CodeLine>
<Link id="l10818" /><CodeLine lineNumber="10818"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l10819" /><CodeLine lineNumber="10819"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// There are no loops in the function. Return before computing other</span></CodeLine>
<Link id="l10820" /><CodeLine lineNumber="10820"><span class="doxyHighlight">  </span><span class="doxyHighlightComment">// expensive analyses.</span></CodeLine>
<Link id="l10821" /><CodeLine lineNumber="10821"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>-&gt;empty())</span></CodeLine>
<Link id="l10822" /><CodeLine lineNumber="10822"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l10823" /><CodeLine lineNumber="10823"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizepass/#a7e7c40b0a986979535eddeb2bb6eae05">SE</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/scalarevolutionanalysis">ScalarEvolutionAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l10824" /><CodeLine lineNumber="10824"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l10825" /><CodeLine lineNumber="10825"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l10826" /><CodeLine lineNumber="10826"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryanalysis">TargetLibraryAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l10827" /><CodeLine lineNumber="10827"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/assumptionanalysis">AssumptionAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l10828" /><CodeLine lineNumber="10828"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizepass/#a427352f0eda31223a0b25d9f143ce0b1">DB</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/demandedbitsanalysis">DemandedBitsAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l10829" /><CodeLine lineNumber="10829"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/optimizationremarkemitteranalysis">OptimizationRemarkEmitterAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l10830" /><CodeLine lineNumber="10830"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizepass/#a38ff83df2a3ad17de50157ed09a1c259">LAIs</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/loopaccessanalysis">LoopAccessAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l10831" /><CodeLine lineNumber="10831"></CodeLine>
<Link id="l10832" /><CodeLine lineNumber="10832"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;MAMProxy = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/namespaces/llvm/#a2b0ee73723ccffec457f8712220b0c25">ModuleAnalysisManagerFunctionProxy</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l10833" /><CodeLine lineNumber="10833"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a> = MAMProxy.getCachedResult&lt;<a href="/docs/api/classes/llvm/profilesummaryanalysis">ProfileSummaryAnalysis</a>&gt;(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent());</span></CodeLine>
<Link id="l10834" /><CodeLine lineNumber="10834"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a> = </span><span class="doxyHighlightKeyword">nullptr</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10835" /><CodeLine lineNumber="10835"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a> &amp;&amp; <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>-&gt;hasProfileSummary())</span></CodeLine>
<Link id="l10836" /><CodeLine lineNumber="10836"><span class="doxyHighlight">    <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/blockfrequencyanalysis">BlockFrequencyAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l10837" /><CodeLine lineNumber="10837"><span class="doxyHighlight">  <a href="/docs/api/structs/llvm/loopvectorizeresult">LoopVectorizeResult</a> Result = <a href="/docs/api/structs/llvm/loopvectorizepass/#a0d3ab70393b799b3be4875c3334a4f42">runImpl</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l10838" /><CodeLine lineNumber="10838"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (!Result.MadeAnyChange)</span></CodeLine>
<Link id="l10839" /><CodeLine lineNumber="10839"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</span></CodeLine>
<Link id="l10840" /><CodeLine lineNumber="10840"><span class="doxyHighlight">  <a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> PA;</span></CodeLine>
<Link id="l10841" /><CodeLine lineNumber="10841"></CodeLine>
<Link id="l10842" /><CodeLine lineNumber="10842"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (<a href="/docs/api/namespaces/llvm/#aa9ef2dbd1b7ce921093f7d4a7bd4cc5c">isAssignmentTrackingEnabled</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent())) &#123;</span></CodeLine>
<Link id="l10843" /><CodeLine lineNumber="10843"><span class="doxyHighlight">    </span><span class="doxyHighlightKeywordFlow">for</span><span class="doxyHighlight"> (</span><span class="doxyHighlightKeyword">auto</span><span class="doxyHighlight"> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</span></CodeLine>
<Link id="l10844" /><CodeLine lineNumber="10844"><span class="doxyHighlight">      <a href="/docs/api/namespaces/llvm/#a08f3f942afc0ee9115a8f9fa87e9191d">RemoveRedundantDbgInstrs</a>(&amp;BB);</span></CodeLine>
<Link id="l10845" /><CodeLine lineNumber="10845"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10846" /><CodeLine lineNumber="10846"></CodeLine>
<Link id="l10847" /><CodeLine lineNumber="10847"><span class="doxyHighlight">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a>&gt;();</span></CodeLine>
<Link id="l10848" /><CodeLine lineNumber="10848"><span class="doxyHighlight">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;();</span></CodeLine>
<Link id="l10849" /><CodeLine lineNumber="10849"><span class="doxyHighlight">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/scalarevolutionanalysis">ScalarEvolutionAnalysis</a>&gt;();</span></CodeLine>
<Link id="l10850" /><CodeLine lineNumber="10850"><span class="doxyHighlight">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/loopaccessanalysis">LoopAccessAnalysis</a>&gt;();</span></CodeLine>
<Link id="l10851" /><CodeLine lineNumber="10851"></CodeLine>
<Link id="l10852" /><CodeLine lineNumber="10852"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">if</span><span class="doxyHighlight"> (Result.MadeCFGChange) &#123;</span></CodeLine>
<Link id="l10853" /><CodeLine lineNumber="10853"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// Making CFG changes likely means a loop got vectorized. Indicate that</span></CodeLine>
<Link id="l10854" /><CodeLine lineNumber="10854"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// extra simplification passes should be run.</span></CodeLine>
<Link id="l10855" /><CodeLine lineNumber="10855"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// TODO: MadeCFGChanges is not a prefect proxy. Extra passes should only</span></CodeLine>
<Link id="l10856" /><CodeLine lineNumber="10856"><span class="doxyHighlight">    </span><span class="doxyHighlightComment">// be run if runtime checks have been added.</span></CodeLine>
<Link id="l10857" /><CodeLine lineNumber="10857"><span class="doxyHighlight">    AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/structs/llvm/shouldrunextravectorpasses">ShouldRunExtraVectorPasses</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</span></CodeLine>
<Link id="l10858" /><CodeLine lineNumber="10858"><span class="doxyHighlight">    PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/structs/llvm/shouldrunextravectorpasses">ShouldRunExtraVectorPasses</a>&gt;();</span></CodeLine>
<Link id="l10859" /><CodeLine lineNumber="10859"><span class="doxyHighlight">  &#125; </span><span class="doxyHighlightKeywordFlow">else</span><span class="doxyHighlight"> &#123;</span></CodeLine>
<Link id="l10860" /><CodeLine lineNumber="10860"><span class="doxyHighlight">    PA.<a href="/docs/api/classes/llvm/preservedanalyses/#a937c42f77e161349ce0f999e448c7027">preserveSet</a>&lt;<a href="/docs/api/classes/llvm/cfganalyses">CFGAnalyses</a>&gt;();</span></CodeLine>
<Link id="l10861" /><CodeLine lineNumber="10861"><span class="doxyHighlight">  &#125;</span></CodeLine>
<Link id="l10862" /><CodeLine lineNumber="10862"><span class="doxyHighlight">  </span><span class="doxyHighlightKeywordFlow">return</span><span class="doxyHighlight"> PA;</span></CodeLine>
<Link id="l10863" /><CodeLine lineNumber="10863"><span class="doxyHighlight">&#125;</span></CodeLine>
<Link id="l10864" /><CodeLine lineNumber="10864"></CodeLine>
<Link id="l10865" /><CodeLine lineNumber="10865" lineLink="/docs/api/structs/llvm/loopvectorizepass/#a4fa1898352e5014c447a589398c94595"><span class="doxyHighlightKeywordType">void</span><span class="doxyHighlight"> <a href="/docs/api/structs/llvm/loopvectorizepass/#a4fa1898352e5014c447a589398c94595">LoopVectorizePass::printPipeline</a>(</span></CodeLine>
<Link id="l10866" /><CodeLine lineNumber="10866"><span class="doxyHighlight">    <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/stringref">StringRef</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a>)&gt; MapClassName2PassName) &#123;</span></CodeLine>
<Link id="l10867" /><CodeLine lineNumber="10867"><span class="doxyHighlight">  </span><span class="doxyHighlightKeyword">static&#95;cast&lt;</span><span class="doxyHighlight"><a href="/docs/api/structs/llvm/passinfomixin">PassInfoMixin&lt;LoopVectorizePass&gt;</a> &#42;</span><span class="doxyHighlightKeyword">&gt;</span><span class="doxyHighlight">(</span><span class="doxyHighlightKeyword">this</span><span class="doxyHighlight">)-&gt;<a href="/docs/api/structs/llvm/loopvectorizepass/#a4fa1898352e5014c447a589398c94595">printPipeline</a>(</span></CodeLine>
<Link id="l10868" /><CodeLine lineNumber="10868"><span class="doxyHighlight">      OS, MapClassName2PassName);</span></CodeLine>
<Link id="l10869" /><CodeLine lineNumber="10869"></CodeLine>
<Link id="l10870" /><CodeLine lineNumber="10870"><span class="doxyHighlight">  OS &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;&lt;&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10871" /><CodeLine lineNumber="10871"><span class="doxyHighlight">  OS &lt;&lt; (InterleaveOnlyWhenForced ? </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;no-&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;interleave-forced-only;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10872" /><CodeLine lineNumber="10872"><span class="doxyHighlight">  OS &lt;&lt; (VectorizeOnlyWhenForced ? </span><span class="doxyHighlightStringLiteral">&quot;&quot;</span><span class="doxyHighlight"> : </span><span class="doxyHighlightStringLiteral">&quot;no-&quot;</span><span class="doxyHighlight">) &lt;&lt; </span><span class="doxyHighlightStringLiteral">&quot;vectorize-forced-only;&quot;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10873" /><CodeLine lineNumber="10873"><span class="doxyHighlight">  OS &lt;&lt; </span><span class="doxyHighlightCharLiteral">&#39;&gt;&#39;</span><span class="doxyHighlight">;</span></CodeLine>
<Link id="l10874" /><CodeLine lineNumber="10874"><span class="doxyHighlight">&#125;</span></CodeLine>

</ProgramListing>


</DoxygenPage>
