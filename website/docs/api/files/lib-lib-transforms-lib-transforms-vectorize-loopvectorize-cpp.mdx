---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'
import SectionUser from '@xpack/docusaurus-plugin-doxygen/components/SectionUser'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `LoopVectorize.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/Vectorize/LoopVectorize.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/vectorize/loopvectorize-h"
  isLocal="true" />
<IncludesListItem
  filePath="LoopVectorizationPlanner.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationplanner-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPRecipeBuilder.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vprecipebuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlan.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplan-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanAnalysis.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplananalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanHCFGBuilder.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanhcfgbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanPatternMatch.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanpatternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanTransforms.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanUtils.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="VPlanVerifier.h"
  permalink="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanverifier-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/APInt.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMapInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemapinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Hashing.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/hashing-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/MapVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Statistic.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/StringRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/Twine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/twine-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/TypeSwitch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/typeswitch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/iterator_range.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/iterator-range-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AssumptionCache.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BasicAliasAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/basicaliasanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BlockFrequencyInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/CodeMetrics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/codemetrics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/DemandedBits.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/demandedbits-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/GlobalsModRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/globalsmodref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopAccessAnalysis.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopaccessanalysis-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopAnalysisManager.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopanalysismanager-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/LoopIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/loopiterator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/OptimizationRemarkEmitter.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ProfileSummaryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ScalarEvolution.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolution-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ScalarEvolutionExpressions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolutionexpressions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetLibraryInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/TargetTransformInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/ValueTracking.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/VectorUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Attributes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugLoc.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debugloc-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DiagnosticInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/diagnosticinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IRBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Intrinsics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/MDBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Metadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Operator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/ProfDataUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/profdatautils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Use.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/use-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Verifier.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/verifier-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/InstructionCost.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/instructioncost-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/MathExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/mathextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/NativeFormatting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/nativeformatting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/InjectTLIMappings.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/injecttlimappings-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/Local.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/LoopSimplify.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/loopsimplify-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/LoopUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looputils-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/LoopVersioning.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/loopversioning-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/ScalarEvolutionExpander.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/scalarevolutionexpander-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/SizeOpts.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/sizeopts-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Vectorize/LoopVectorizationLegality.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/vectorize/loopvectorizationlegality-h"
  isLocal="true" />
<IncludesListItem
  filePath="algorithm"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="functional"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="limits"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="memory"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="string"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="tuple"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
</IncludesList>

## Namespaces Index

<MembersIndex>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/preferpredicatety">PreferPredicateTy</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/llvm">llvm</a></>}>
This is an optimization pass for GlobalISel generic memory operations. <a href="/docs/api/namespaces/llvm/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="namespace"
  name={<><a href="/docs/api/namespaces/anonymous-loopvectorize-cpp-">anonymous&#123;LoopVectorize.cpp&#125;</a></>}>
</MembersIndexItem>

</MembersIndex>

## Classes Index

<MembersIndex>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/llvm/innerloopvectorizer">InnerLoopVectorizer</a></>}>
<a href="/docs/api/classes/llvm/innerloopvectorizer">InnerLoopVectorizer</a> vectorizes loops which contain only one basic block to a specified vectorization factor (VF). <a href="/docs/api/classes/llvm/innerloopvectorizer/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a></>}>
Encapsulate information regarding vectorization of a loop and its epilogue. <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer">InnerLoopAndEpilogueVectorizer</a></>}>
An extension of the inner loop vectorizer that creates a skeleton for a vectorized loop that has its epilogue (residual) also vectorized. <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/llvm/epiloguevectorizermainloop">EpilogueVectorizerMainLoop</a></>}>
A specialized derived class of inner loop vectorizer that performs vectorization of <em>main</em> loops in the process of vectorizing loops and their epilogues. <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop">EpilogueVectorizerEpilogueLoop</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a></>}>
<a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> - estimates the expected speedups due to vectorization. <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage">RegisterUsage</a></>}>
A struct that represents some properties of the register usage of a loop. <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision">CallWideningDecision</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="class"
  name={<><a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks">GeneratedRTChecks</a></>}>
Helper struct to manage generating runtime checks for vectorization. <a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#details">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="struct"
  name={<><a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo">CSEDenseMapInfo</a></>}>
</MembersIndexItem>

</MembersIndex>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a4d2a943e39c98ccce6fd53e8df9c5c2b">addCanonicalIVRecipes</a> (VPlan &amp;Plan, Type &#42;IdxTy, bool HasNUW, DebugLoc DL)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a453563e4ed7e249a7f3e92b98b9052df">addExitUsersForFirstOrderRecurrences</a> (VPlan &amp;Plan, SetVector&lt; VPIRInstruction &#42; &gt; &amp;ExitUsersToFix)</>}>
Handle users in the exit block for first order reductions in the original exit block. <a href="#a453563e4ed7e249a7f3e92b98b9052df">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ababcaf6e2e00fc3fc8791ea2c3acbda5">addFullyUnrolledInstructionsToIgnore</a> (Loop &#42;L, const LoopVectorizationLegality::InductionList &amp;IL, SmallPtrSetImpl&lt; Instruction &#42; &gt; &amp;InstsToIgnore)</>}>
Knowing that loop <code>L</code> executes a single vector iteration, add instructions that will get simplified and thus should not have any cost to <code>InstsToIgnore</code>. <a href="#ababcaf6e2e00fc3fc8791ea2c3acbda5">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a> &#42;</>}
  name={<><a href="#a20c2e870e2c105fbf0945df09a9a5c4d">addResumePhiRecipeForInduction</a> (VPWidenInductionRecipe &#42;WideIV, VPBuilder &amp;VectorPHBuilder, VPBuilder &amp;ScalarPHBuilder, VPTypeAnalysis &amp;TypeInfo, VPValue &#42;VectorTC)</>}>
Create and return a ResumePhi for <code>WideIV</code>, unless it is truncated. <a href="#a20c2e870e2c105fbf0945df09a9a5c4d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a033bb363914fbd3c2cd990330959036c">addRuntimeUnrollDisableMetaData</a> (Loop &#42;L)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a02106664ead4e0c4e755457dbac7f7b3">addScalarResumePhis</a> (VPRecipeBuilder &amp;Builder, VPlan &amp;Plan, DenseMap&lt; VPValue &#42;, VPValue &#42; &gt; &amp;IVEndValues)</>}>
Create resume phis in the scalar preheader for first-order recurrences, reductions and inductions, and update the VPIRInstructions wrapping the original phis in the scalar header. <a href="#a02106664ead4e0c4e755457dbac7f7b3">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#af34d746d08a380c672cae45176f9df87">addUsersInExitBlocks</a> (VPlan &amp;Plan, const SetVector&lt; VPIRInstruction &#42; &gt; &amp;ExitUsersToFix)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a362f793f3254317c698e3560548788a5">areRuntimeChecksProfitable</a> (GeneratedRTChecks &amp;Checks, VectorizationFactor &amp;VF, Loop &#42;L, const TargetTransformInfo &amp;TTI, PredicatedScalarEvolution &amp;PSE, ScalarEpilogueLowering SEL)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#af1fba45879c49d4839b11ec30afd7532">checkMixedPrecision</a> (Loop &#42;L, OptimizationRemarkEmitter &#42;ORE)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a00315ff11c9068aab97e5780bdfa5eef">collectSupportedLoops</a> (Loop &amp;L, LoopInfo &#42;LI, OptimizationRemarkEmitter &#42;ORE, SmallVectorImpl&lt; Loop &#42; &gt; &amp;V)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/vpirinstruction">VPIRInstruction</a> &#42; &gt;</>}
  name={<><a href="#a435b95efad7ea03299bd527b55b4708a">collectUsersInExitBlocks</a> (Loop &#42;OrigLoop, VPRecipeBuilder &amp;Builder, VPlan &amp;Plan)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a></>}
  name={<><a href="#afec6951f3043e25ada2b61437bd60725">createLVAnalysis</a> (const char &#42;PassName, StringRef RemarkName, Loop &#42;TheLoop, Instruction &#42;I, DebugLoc DL=&#123;&#125;)</>}>
Create an analysis remark that explains why vectorization failed. <a href="#afec6951f3043e25ada2b61437bd60725">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/vpwidenintorfpinductionrecipe">VPWidenIntOrFpInductionRecipe</a> &#42;</>}
  name={<><a href="#a9336eb7b4fbcee561dbb8c52d9eabe64">createWidenInductionRecipes</a> (PHINode &#42;Phi, Instruction &#42;PhiOrTrunc, VPValue &#42;Start, const InductionDescriptor &amp;IndDesc, VPlan &amp;Plan, ScalarEvolution &amp;SE, Loop &amp;OrigLoop)</>}>
Creates a VPWidenIntOrFpInductionRecpipe for <code>Phi</code>. <a href="#a9336eb7b4fbcee561dbb8c52d9eabe64">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#acc13ee8b8985399901ac09b51822e21a">cse</a> (BasicBlock &#42;BB)</>}>
Perform cse of induction variable instructions. <a href="#acc13ee8b8985399901ac09b51822e21a">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a1a861c376095fff2ee736b0a743cc44e">debugVectorizationMessage</a> (const StringRef Prefix, const StringRef DebugMsg, Instruction &#42;I)</>}>
Write a <code>DebugMsg</code> about vectorization to the debug output stream. <a href="#a1a861c376095fff2ee736b0a743cc44e">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/elementcount">ElementCount</a></>}
  name={<><a href="#a0b91e092434338369b2e1995b87f0c5b">determineVPlanVF</a> (const TargetTransformInfo &amp;TTI, LoopVectorizationCostModel &amp;CM)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#a23f5821d9ac264ae25dd087747e2c181">emitTransformedIndex</a> (IRBuilderBase &amp;B, Value &#42;Index, Value &#42;StartValue, Value &#42;Step, InductionDescriptor::InductionKind InductionKind, const BinaryOperator &#42;InductionBinOp)</>}>
Compute the transformed value of Index at offset StartValue using step StepValue. <a href="#a23f5821d9ac264ae25dd087747e2c181">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a90ad8ccd396152c749068f986f2b751a">fixReductionScalarResumeWhenVectorizingEpilog</a> (VPRecipeBase &#42;R, VPTransformState &amp;State, BasicBlock &#42;LoopMiddleBlock, BasicBlock &#42;BypassBlock)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;</>}
  name={<><a href="#ad27a81251d238dbfdc4d0253a64d6267">getAddressAccessSCEV</a> (Value &#42;Ptr, LoopVectorizationLegality &#42;Legal, PredicatedScalarEvolution &amp;PSE, const Loop &#42;TheLoop)</>}>
Gets Address Access <a href="/docs/api/classes/llvm/scev">SCEV</a> after verifying that the access pattern is loop invariant except the induction variable dependence. <a href="#ad27a81251d238dbfdc4d0253a64d6267">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/debugloc">DebugLoc</a></>}
  name={<><a href="#a29c708de8e758ac420523c94c797b501">getDebugLocFromInstOrOperands</a> (Instruction &#42;I)</>}>
Look for a meaningful debug location on the instruction or its operands. <a href="#a29c708de8e758ac420523c94c797b501">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="unsigned"
  name={<><a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a> (const Loop &#42;L, const TargetTransformInfo &amp;TTI, ElementCount VF)</>}>
This function attempts to return a value that represents the vectorization factor at runtime. <a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/value">Value</a> &#42;</>}
  name={<><a href="#aa8d4cfce02b245d616238ce8eed74718">getExpandedStep</a> (const InductionDescriptor &amp;ID, const SCEV2ValueTy &amp;ExpandedSCEVs)</>}>
Return the expanded step for <code><a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a></code> using <code>ExpandedSCEVs</code> to look up <a href="/docs/api/classes/llvm/scev">SCEV</a> expansion results. <a href="#aa8d4cfce02b245d616238ce8eed74718">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; unsigned &gt;</>}
  name={<><a href="#a604c96744d2e46447f11e2d3aab9a9b2">getMaxVScale</a> (const Function &amp;F, const TargetTransformInfo &amp;TTI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a></>}
  name={<><a href="#a8cde912cc23c18f493e4e5005c85748b">getScalarEpilogueLowering</a> (Function &#42;F, Loop &#42;L, LoopVectorizeHints &amp;Hints, ProfileSummaryInfo &#42;PSI, BlockFrequencyInfo &#42;BFI, TargetTransformInfo &#42;TTI, TargetLibraryInfo &#42;TLI, LoopVectorizationLegality &amp;LVL, InterleavedAccessInfo &#42;IAI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; unsigned &gt;</>}
  name={<><a href="#a84375e6536d9214c7895013078055aff">getSmallBestKnownTC</a> (PredicatedScalarEvolution &amp;PSE, Loop &#42;L, bool CanUseConstantMax=true)</>}>
Returns &quot;best known&quot; trip count for the specified loop <code>L</code> as defined by the following procedure: 1) Returns exact trip count if it is known. <a href="#a84375e6536d9214c7895013078055aff">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<>std::optional&lt; unsigned &gt;</>}
  name={<><a href="#a4e108201f94f2fe89865e7868390bbf6">getVScaleForTuning</a> (const Loop &#42;L, const TargetTransformInfo &amp;TTI)</>}>
Convenience function that returns the value of vscale&#95;range iff vscale&#95;range.min == vscale&#95;range.max or otherwise returns the value returned by the corresponding <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> method. <a href="#a4e108201f94f2fe89865e7868390bbf6">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aa407c2e7d895ed29af8cc68563c03065">hasIrregularType</a> (Type &#42;Ty, const DataLayout &amp;DL)</>}>
A helper function that returns true if the given type is irregular. <a href="#aa407c2e7d895ed29af8cc68563c03065">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a806ec23d6f44b02ad8cf3b1e61c05495">isExplicitVecOuterLoop</a> (Loop &#42;OuterLp, OptimizationRemarkEmitter &#42;ORE)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#ab7edde995b7986f98c3f59788b960eba">isIndvarOverflowCheckKnownFalse</a> (const LoopVectorizationCostModel &#42;Cost, ElementCount VF, std::optional&lt; unsigned &gt; UF=std::nullopt)</>}>
For the given VF and UF and maximum trip count computed for the loop, return whether the induction variable might overflow in the vectorized loop. <a href="#ab7edde995b7986f98c3f59788b960eba">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/type">Type</a> &#42;</>}
  name={<><a href="#a83114915b4f7fec94a20efa3834a8250">maybeVectorizeType</a> (Type &#42;Elt, ElementCount VF)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a696283c30308704d020a9d86065aa3ae">planContainsAdditionalSimplifications</a> (VPlan &amp;Plan, VPCostContext &amp;CostCtx, Loop &#42;TheLoop)</>}>
Return true if the original loop \\ TheLoop contains any instructions that do not have corresponding recipes in <code>Plan</code> and are not marked to be ignored in <code>CostCtx</code>. <a href="#a696283c30308704d020a9d86065aa3ae">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aae23f7e6fc37b0f1bb756f938023512c">preparePlanForEpilogueVectorLoop</a> (VPlan &amp;Plan, Loop &#42;L, const SCEV2ValueTy &amp;ExpandedSCEVs, const EpilogueLoopVectorizationInfo &amp;EPI)</>}>
Prepare <code>Plan</code> for vectorizing the epilogue loop. <a href="#aae23f7e6fc37b0f1bb756f938023512c">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a13368acf4fbb5816c3d82099b11519b1">preparePlanForMainVectorLoop</a> (VPlan &amp;MainPlan, VPlan &amp;EpiPlan)</>}>
Prepare <code>MainPlan</code> for vectorizing the main vector loop during epilogue vectorization. <a href="#a13368acf4fbb5816c3d82099b11519b1">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#adeb41c907ebde15846bc643325909f95">processLoopInVPlanNativePath</a> (Loop &#42;L, PredicatedScalarEvolution &amp;PSE, LoopInfo &#42;LI, DominatorTree &#42;DT, LoopVectorizationLegality &#42;LVL, TargetTransformInfo &#42;TTI, TargetLibraryInfo &#42;TLI, DemandedBits &#42;DB, AssumptionCache &#42;AC, OptimizationRemarkEmitter &#42;ORE, BlockFrequencyInfo &#42;BFI, ProfileSummaryInfo &#42;PSI, LoopVectorizeHints &amp;Hints, LoopVectorizationRequirements &amp;Requirements)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a3a8743a69fac5e7fa9c2b02604b2cf2f">replaceVPBBWithIRVPBB</a> (VPBasicBlock &#42;VPBB, BasicBlock &#42;IRBB)</>}>
Replace <code>VPBB</code> with a <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> wrapping <code>IRBB</code>. <a href="#a3a8743a69fac5e7fa9c2b02604b2cf2f">More...</a>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#ad8318a653242df10df04853e090cc21f">STATISTIC</a> (LoopsVectorized, &quot;Number of loops vectorized&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#aefd85537796668463b24d5ab5b225407">STATISTIC</a> (LoopsAnalyzed, &quot;Number of loops analyzed for vectorization&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  name={<><a href="#a683da38156d0f59a8d6a0cc83dc7ae14">STATISTIC</a> (LoopsEpilogueVectorized, &quot;Number of epilogues vectorized&quot;)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#aae88a50a9a37f9a745939e3e726837e6">useActiveLaneMask</a> (TailFoldingStyle Style)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a4e445204e48d57b1e23e55869146b7ce">useActiveLaneMaskForControlFlow</a> (TailFoldingStyle Style)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#adf8d8fb6f39b9c0cf21d55b7229d35e2">useMaskedInterleavedAccesses</a> (const TargetTransformInfo &amp;TTI)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#af378bb1e037306d9cfd4bb0b49ba55f9">willGenerateVectors</a> (VPlan &amp;Plan, ElementCount VF, const TargetTransformInfo &amp;TTI)</>}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if any recipe of <code>Plan</code> will generate a vector value, which will be assigned a vector register. <a href="#af378bb1e037306d9cfd4bb0b49ba55f9">More...</a>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a1b67aba558e56b48dbb2891b6e5fe5b8">EnableCondStoresVectorization</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#af7af1b4bf03205c80dcba0a6324c4f21">EnableEarlyExitVectorization</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a8bb0da83afffaf803b396b1d055ba5e0">EnableEpilogueVectorization</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a8122656ed2c776067b43d9ae34ccecb6">EnableIndVarRegisterHeur</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ac3af17aa5bce5ef8c3aa82faeacfc456">EnableInterleavedMemAccesses</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a99a396adb2c0f9fb93b7ff8ea8b2e2ef">EnableLoadStoreRuntimeInterleave</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ac68ad295befb7187ae293cc0faaa3ac3">EnableMaskedInterleavedMemAccesses</a></>}>
An interleave-group may need masking if it resides in a block that needs predication, or in order to mask away gaps. <a href="#ac68ad295befb7187ae293cc0faaa3ac3">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a01340df86c9d26b281ff1ab9288c28ce">EpilogueVectorizationForceVF</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a01070590fdc156c181654c2db7b9ddcc">EpilogueVectorizationMinVF</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#acb0b374f69dc6867357f0aa5e93ab33d">ForceOrderedReductions</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; <a href="/docs/api/namespaces/llvm/cl/#a9241f2e42b7587b123c885d7a659ad44">cl::boolOrDefault</a> &gt;</>}
  name={<><a href="#ad69cf8bf5c6b79c5642327ecb6be38cd">ForceSafeDivisor</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> &gt;</>}
  name={<><a href="#a8959791a22c7d3cfb4136777fd244535">ForceTailFoldingStyle</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a5eae6074e6a1bb62e365ef65f3e26196">ForceTargetInstructionCost</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#aee1082071c43958a6ef5e6e9f665ae4a">ForceTargetMaxScalarInterleaveFactor</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#ade5aad46b91dc51c831acf1e69ee9863">ForceTargetMaxVectorInterleaveFactor</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a62baadf3a5bf03eddf58bf048724acb1">ForceTargetNumScalarRegs</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a7d952aa72676eecd8065aa2c29ea458c">ForceTargetNumVectorRegs</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a48035e22b43c905a2961c90e5470b2f0">ForceTargetSupportsScalableVectors</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> char</>}
  name={<><a href="#a3bf55ccbbeedcfb8cd2a1bd62c0ad91a">LLVMLoopVectorizeFollowupAll</a> = &quot;llvm.loop.vectorize.followup&#95;all&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> char</>}
  name={<><a href="#aadedae9de069f3bcef6fa7a90ce4a630">LLVMLoopVectorizeFollowupEpilogue</a> =
    &quot;llvm.loop.vectorize.followup&#95;epilogue&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> char</>}
  name={<><a href="#a99050b417d193e1cc1117e5bbd4bfbce">LLVMLoopVectorizeFollowupVectorized</a> =
    &quot;llvm.loop.vectorize.followup&#95;vectorized&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#aa5a50c0ac98e2ed63da85783ca102cf8">LoopVectorizeWithBlockFrequency</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#afe9b34c22ec9e2cc84d61d437f82936d">MaximizeBandwidth</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#ae75965df4671fa34c6ffc5a6e404843a">MaxNestedScalarReductionIC</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>uint32&#95;t</>}
  name={<><a href="#a502070b20fa467fb54ba49d6736cf2d3">MemCheckBypassWeights</a> = &#123;1, 127&#125;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>uint32&#95;t</>}
  name={<><a href="#a629884e9a99a9f49106db9e5e6252fcb">MinItersBypassWeights</a> = &#123;1, 127&#125;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#ae11c08aa35785a118bda788836cab423">NumberOfStoresToPredicate</a></>}>
The number of stores in a loop that are allowed to need predication. <a href="#ae11c08aa35785a118bda788836cab423">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a96ef6bd4742763bf1b85aaf1a4150620">PreferInLoopReductions</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a927ef1cfd7c981c5b9b9e8c67b1d13c3">PreferPredicatedReductionSelect</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cda">PreferPredicateTy::Option</a> &gt;</>}
  name={<><a href="#abe3c68238712d04bbe3a70f3a8f483f5">PreferPredicateOverEpilogue</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<>uint32&#95;t</>}
  name={<><a href="#a968a5c2971ffa9e8ef81ff86eebaf514">SCEVCheckBypassWeights</a> = &#123;1, 127&#125;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a71899f6c73fcc8e2fc977dadc1fb1520">SmallLoopCost</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a15320a2d7ced6e62766048ae7b6f8b13">TinyTripCountVectorThreshold</a></>}>
Loops with a known constant trip count below this number are vectorized only if no scalar iteration overheads are incurred. <a href="#a15320a2d7ced6e62766048ae7b6f8b13">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a639c83322f3d5f0e24e9bde998a516fd">UseWiderVFIfCallVariantsPresent</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; unsigned &gt;</>}
  name={<><a href="#a1293f02da7fffb33096a44f1b1768b3f">VectorizeMemoryCheckThreshold</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> char</>}
  name={<><a href="#a8eba8b6f7c3e69bf4d4efd92cd74b5a6">VerboseDebug</a> = <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> &quot;-verbose&quot;</>}>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#a9f30855a6efcd4a12875deb88880b510">VPlanBuildStressTest</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a></>}>
</MembersIndexItem>

<MembersIndexItem
  type="#define"
  name={<><a href="#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>&nbsp;&nbsp;&nbsp;&quot;loop-vectorize&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### addCanonicalIVRecipes() {#a4d2a943e39c98ccce6fd53e8df9c5c2b}

<MemberDefinition
  prototype={<>static void addCanonicalIVRecipes (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/type">Type</a> &#42; IdxTy, bool HasNUW, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> DL)</>}
  labels = {["static"]}>

Definition at line <a href="#l08930">8930</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### addExitUsersForFirstOrderRecurrences() {#a453563e4ed7e249a7f3e92b98b9052df}

<MemberDefinition
  prototype={<>static void addExitUsersForFirstOrderRecurrences (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/vpirinstruction">VPIRInstruction</a> &#42; &gt; &amp; ExitUsersToFix)</>}
  labels = {["static"]}>
Handle users in the exit block for first order reductions in the original exit block.

The penultimate value of recurrences is fed to their LCSSA phi users in the original exit block using the <a href="/docs/api/classes/llvm/vpirinstruction">VPIRInstruction</a> wrapping to the LCSSA phi.

Definition at line <a href="#l09112">9112</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### addFullyUnrolledInstructionsToIgnore() {#ababcaf6e2e00fc3fc8791ea2c3acbda5}

<MemberDefinition
  prototype={<>static void addFullyUnrolledInstructionsToIgnore (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopvectorizationlegality/#a063c4d98febe7ef90dddbfedcfc59d16">LoopVectorizationLegality::InductionList</a> &amp; IL, <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl</a>&lt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &gt; &amp; InstsToIgnore)</>}
  labels = {["static"]}>
Knowing that loop <code>L</code> executes a single vector iteration, add instructions that will get simplified and thus should not have any cost to <code>InstsToIgnore</code>.

Definition at line <a href="#l02662">2662</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### addResumePhiRecipeForInduction() {#a20c2e870e2c105fbf0945df09a9a5c4d}

<MemberDefinition
  prototype={<>static VPInstruction &#42; addResumePhiRecipeForInduction (<a href="/docs/api/classes/llvm/vpwideninductionrecipe">VPWidenInductionRecipe</a> &#42; WideIV, <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> &amp; VectorPHBuilder, <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> &amp; ScalarPHBuilder, <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> &amp; TypeInfo, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; VectorTC)</>}
  labels = {["static"]}>
Create and return a ResumePhi for <code>WideIV</code>, unless it is truncated.

If the induction recipe is not canonical, creates a <a href="/docs/api/classes/llvm/vpderivedivrecipe">VPDerivedIVRecipe</a> to compute the end value of the induction.

Definition at line <a href="#l08956">8956</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### addRuntimeUnrollDisableMetaData() {#a033bb363914fbd3c2cd990330959036c}

<MemberDefinition
  prototype={<>static void addRuntimeUnrollDisableMetaData (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L)</>}
  labels = {["static"]}>

Definition at line <a href="#l07545">7545</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### addScalarResumePhis() {#a02106664ead4e0c4e755457dbac7f7b3}

<MemberDefinition
  prototype={<>static void addScalarResumePhis (<a href="/docs/api/classes/llvm/vprecipebuilder">VPRecipeBuilder</a> &amp; Builder, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/densemap">DenseMap</a>&lt; <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; &gt; &amp; IVEndValues)</>}
  labels = {["static"]}>
Create resume phis in the scalar preheader for first-order recurrences, reductions and inductions, and update the VPIRInstructions wrapping the original phis in the scalar header.

End values for inductions are added to <code>IVEndValues</code>.

Definition at line <a href="#l08994">8994</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### addUsersInExitBlocks() {#af34d746d08a380c672cae45176f9df87}

<MemberDefinition
  prototype={<>static void addUsersInExitBlocks (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/vpirinstruction">VPIRInstruction</a> &#42; &gt; &amp; ExitUsersToFix)</>}
  labels = {["static"]}>

Definition at line <a href="#l09089">9089</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### areRuntimeChecksProfitable() {#a362f793f3254317c698e3560548788a5}

<MemberDefinition
  prototype={<>static bool areRuntimeChecksProfitable (GeneratedRTChecks &amp; Checks, <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> &amp; VF, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp; PSE, <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> SEL)</>}
  labels = {["static"]}>

Definition at line <a href="#l10054">10054</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### checkMixedPrecision() {#af1fba45879c49d4839b11ec30afd7532}

<MemberDefinition
  prototype={<>static void checkMixedPrecision (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42; ORE)</>}
  labels = {["static"]}>

Definition at line <a href="#l10013">10013</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### collectSupportedLoops() {#a00315ff11c9068aab97e5780bdfa5eef}

<MemberDefinition
  prototype={<>static void collectSupportedLoops (<a href="/docs/api/classes/llvm/loop">Loop</a> &amp; L, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42; ORE, <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt; <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; &gt; &amp; V)</>}
  labels = {["static"]}>

Definition at line <a href="#l02179">2179</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### collectUsersInExitBlocks() {#a435b95efad7ea03299bd527b55b4708a}

<MemberDefinition
  prototype={<>static SetVector&lt; VPIRInstruction &#42; &gt; collectUsersInExitBlocks (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; OrigLoop, <a href="/docs/api/classes/llvm/vprecipebuilder">VPRecipeBuilder</a> &amp; Builder, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan)</>}
  labels = {["static"]}>

Definition at line <a href="#l09055">9055</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### createLVAnalysis() {#afec6951f3043e25ada2b61437bd60725}

<MemberDefinition
  prototype={<>static OptimizationRemarkAnalysis createLVAnalysis (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> char &#42; PassName, <a href="/docs/api/classes/llvm/stringref">StringRef</a> RemarkName, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; TheLoop, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> DL=&#123;&#125;)</>}
  labels = {["static"]}>
Create an analysis remark that explains why vectorization failed.

<code>PassName</code> is the name of the pass (e.g. can be AlwaysPrint). <code>RemarkName</code> is the identifier for the remark. If <code>I</code> is passed it is an instruction that prevents vectorization. Otherwise <code>TheLoop</code> is used for the location of the remark. If <code>DL</code> is passed, use it as debug location for the remark. 
<SectionUser title="Returns">
the remark object that can be streamed to.
</SectionUser>

Definition at line <a href="#l00860">860</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### createWidenInductionRecipes() {#a9336eb7b4fbcee561dbb8c52d9eabe64}

<MemberDefinition
  prototype={<>static VPWidenIntOrFpInductionRecipe &#42; createWidenInductionRecipes (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; Phi, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; PhiOrTrunc, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42; Start, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp; IndDesc, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp; SE, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp; OrigLoop)</>}
  labels = {["static"]}>
Creates a VPWidenIntOrFpInductionRecpipe for <code>Phi</code>.

If needed, it will also insert a recipe to expand the step for the induction recipe.

Definition at line <a href="#l08317">8317</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### cse() {#acc13ee8b8985399901ac09b51822e21a}

<MemberDefinition
  prototype={<>static void cse (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BB)</>}
  labels = {["static"]}>
Perform cse of induction variable instructions.

Definition at line <a href="#l02811">2811</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### debugVectorizationMessage() {#a1a861c376095fff2ee736b0a743cc44e}

<MemberDefinition
  prototype={<>static void debugVectorizationMessage (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/stringref">StringRef</a> Prefix, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/stringref">StringRef</a> DebugMsg, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I)</>}
  labels = {["static"]}>
Write a <code>DebugMsg</code> about vectorization to the debug output stream.

If <code>I</code> is passed, the message relates to that particular instruction.

Definition at line <a href="#l00840">840</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### determineVPlanVF() {#a0b91e092434338369b2e1995b87f0c5b}

<MemberDefinition
  prototype={<>static ElementCount determineVPlanVF (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> &amp; CM)</>}
  labels = {["static"]}>

Definition at line <a href="#l07027">7027</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### emitTransformedIndex() {#a23f5821d9ac264ae25dd087747e2c181}

<MemberDefinition
  prototype={<>static Value &#42; emitTransformedIndex (<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp; B, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Index, <a href="/docs/api/classes/llvm/value">Value</a> &#42; StartValue, <a href="/docs/api/classes/llvm/value">Value</a> &#42; Step, <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabcc">InductionDescriptor::InductionKind</a> InductionKind, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42; InductionBinOp)</>}
  labels = {["static"]}>
Compute the transformed value of Index at offset StartValue using step StepValue.

For integer induction, returns StartValue + Index &#42; StepValue. For pointer induction, returns StartValue&#91;Index &#42; StepValue&#93;. FIXME: The newly created binary instructions should contain nsw/nuw flags, which can be found from the original scalar operations.

Definition at line <a href="#l02216">2216</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### fixReductionScalarResumeWhenVectorizingEpilog() {#a90ad8ccd396152c749068f986f2b751a}

<MemberDefinition
  prototype={<>static void fixReductionScalarResumeWhenVectorizingEpilog (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42; R, <a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp; State, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; LoopMiddleBlock, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; BypassBlock)</>}
  labels = {["static"]}>

Definition at line <a href="#l07582">7582</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getAddressAccessSCEV() {#ad27a81251d238dbfdc4d0253a64d6267}

<MemberDefinition
  prototype={<>static const SCEV &#42; getAddressAccessSCEV (<a href="/docs/api/classes/llvm/value">Value</a> &#42; Ptr, <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42; Legal, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp; PSE, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; TheLoop)</>}
  labels = {["static"]}>
Gets Address Access <a href="/docs/api/classes/llvm/scev">SCEV</a> after verifying that the access pattern is loop invariant except the induction variable dependence.

This <a href="/docs/api/classes/llvm/scev">SCEV</a> can be sent to the <a href="/docs/api/classes/llvm/target">Target</a> in order to estimate the address calculation cost.

Definition at line <a href="#l05587">5587</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getDebugLocFromInstOrOperands() {#a29c708de8e758ac420523c94c797b501}

<MemberDefinition
  prototype={<>static DebugLoc getDebugLocFromInstOrOperands (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; I)</>}
  labels = {["static"]}>
Look for a meaningful debug location on the instruction or its operands.

Definition at line <a href="#l00820">820</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getEstimatedRuntimeVF() {#ab3df41ae1ed3978e3b825bc4dd50ae8d}

<MemberDefinition
  prototype={<>static unsigned getEstimatedRuntimeVF (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</>}
  labels = {["static"]}>
This function attempts to return a value that represents the vectorization factor at runtime.

For fixed-width VFs we know this precisely at compile time, but for scalable VFs we calculate it based on an estimate of the vscale value.

Definition at line <a href="#l04255">4255</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getExpandedStep() {#aa8d4cfce02b245d616238ce8eed74718}

<MemberDefinition
  prototype={<>static Value &#42; getExpandedStep (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp; ID, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> SCEV2ValueTy &amp; ExpandedSCEVs)</>}
  labels = {["static"]}>
Return the expanded step for <code><a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a></code> using <code>ExpandedSCEVs</code> to look up <a href="/docs/api/classes/llvm/scev">SCEV</a> expansion results.

Definition at line <a href="#l02647">2647</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getMaxVScale() {#a604c96744d2e46447f11e2d3aab9a9b2}

<MemberDefinition
  prototype={<>std::optional&lt; unsigned &gt; getMaxVScale (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/function">Function</a> &amp; F, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}>

Definition at line <a href="#l02295">2295</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getScalarEpilogueLowering() {#a8cde912cc23c18f493e4e5005c85748b}

<MemberDefinition
  prototype={<>static ScalarEpilogueLowering getScalarEpilogueLowering (<a href="/docs/api/classes/llvm/function">Function</a> &#42; F, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> &amp; Hints, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42; PSI, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42; BFI, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42; TLI, <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &amp; LVL, <a href="/docs/api/classes/llvm/interleavedaccessinfo">InterleavedAccessInfo</a> &#42; IAI)</>}
  labels = {["static"]}>

Definition at line <a href="#l09897">9897</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getSmallBestKnownTC() {#a84375e6536d9214c7895013078055aff}

<MemberDefinition
  prototype={<>static std::optional&lt; unsigned &gt; getSmallBestKnownTC (<a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp; PSE, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, bool CanUseConstantMax=<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#af6d5cafbdfc5313e65d990120021a3ec">true</a>)</>}
  labels = {["static"]}>
Returns &quot;best known&quot; trip count for the specified loop <code>L</code> as defined by the following procedure: 1) Returns exact trip count if it is known.

2) Returns expected trip count according to profile data if any. 3) Returns upper bound estimate if known, and if <code>CanUseConstantMax</code>. 4) Returns std::nullopt if all of the above failed.

Definition at line <a href="#l00420">420</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### getVScaleForTuning() {#a4e108201f94f2fe89865e7868390bbf6}

<MemberDefinition
  prototype={<>static std::optional&lt; unsigned &gt; getVScaleForTuning (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
Convenience function that returns the value of vscale&#95;range iff vscale&#95;range.min == vscale&#95;range.max or otherwise returns the value returned by the corresponding <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a> method.

Definition at line <a href="#l04238">4238</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### hasIrregularType() {#aa407c2e7d895ed29af8cc68563c03065}

<MemberDefinition
  prototype={<>static bool hasIrregularType (<a href="/docs/api/classes/llvm/type">Type</a> &#42; Ty, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp; DL)</>}
  labels = {["static"]}>
A helper function that returns true if the given type is irregular.

The type is irregular if its allocated size doesn&#39;t equal the store size of an element of the corresponding vector type.

Definition at line <a href="#l00406">406</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### isExplicitVecOuterLoop() {#a806ec23d6f44b02ad8cf3b1e61c05495}

<MemberDefinition
  prototype={<>static bool isExplicitVecOuterLoop (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; OuterLp, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42; ORE)</>}
  labels = {["static"]}>

Definition at line <a href="#l02151">2151</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### isIndvarOverflowCheckKnownFalse() {#ab7edde995b7986f98c3f59788b960eba}

<MemberDefinition
  prototype={<>static bool isIndvarOverflowCheckKnownFalse (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> &#42; Cost, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, std::optional&lt; unsigned &gt; UF=std::nullopt)</>}
  labels = {["static"]}>
For the given VF and UF and maximum trip count computed for the loop, return whether the induction variable might overflow in the vectorized loop.

If not, then we know a runtime overflow check always evaluates to false and can be removed.

Definition at line <a href="#l02310">2310</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### maybeVectorizeType() {#a83114915b4f7fec94a20efa3834a8250}

<MemberDefinition
  prototype={<>static Type &#42; maybeVectorizeType (<a href="/docs/api/classes/llvm/type">Type</a> &#42; Elt, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</>}
  labels = {["static"]}>

Definition at line <a href="#l02858">2858</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### planContainsAdditionalSimplifications() {#a696283c30308704d020a9d86065aa3ae}

<MemberDefinition
  prototype={<>static bool planContainsAdditionalSimplifications (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/structs/llvm/vpcostcontext">VPCostContext</a> &amp; CostCtx, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; TheLoop)</>}
  labels = {["static"]}>
Return true if the original loop \\ TheLoop contains any instructions that do not have corresponding recipes in <code>Plan</code> and are not marked to be ignored in <code>CostCtx</code>.

This means the <a href="/docs/api/classes/llvm/vplan">VPlan</a> contains simplification that the legacy cost-model did not account for.

Definition at line <a href="#l07409">7409</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### preparePlanForEpilogueVectorLoop() {#aae23f7e6fc37b0f1bb756f938023512c}

<MemberDefinition
  prototype={<>static void preparePlanForEpilogueVectorLoop (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> SCEV2ValueTy &amp; ExpandedSCEVs, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a> &amp; EPI)</>}
  labels = {["static"]}>
Prepare <code>Plan</code> for vectorizing the epilogue loop.

That is, re-use expanded SCEVs from <code>ExpandedSCEVs</code> and set resume values for header recipes.

Definition at line <a href="#l10210">10210</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### preparePlanForMainVectorLoop() {#a13368acf4fbb5816c3d82099b11519b1}

<MemberDefinition
  prototype={<>static void preparePlanForMainVectorLoop (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; MainPlan, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; EpiPlan)</>}
  labels = {["static"]}>
Prepare <code>MainPlan</code> for vectorizing the main vector loop during epilogue vectorization.

Remove ResumePhis from <code>MainPlan</code> for inductions that don&#39;t have a corresponding wide induction in <code>EpiPlan</code>.

Definition at line <a href="#l10159">10159</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### processLoopInVPlanNativePath() {#adeb41c907ebde15846bc643325909f95}

<MemberDefinition
  prototype={<>static bool processLoopInVPlanNativePath (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42; L, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp; PSE, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42; LI, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT, <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42; LVL, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42; TTI, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42; TLI, <a href="/docs/api/classes/llvm/demandedbits">DemandedBits</a> &#42; DB, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42; AC, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42; ORE, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42; BFI, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42; PSI, <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> &amp; Hints, <a href="/docs/api/classes/llvm/loopvectorizationrequirements">LoopVectorizationRequirements</a> &amp; Requirements)</>}
  labels = {["static"]}>

Definition at line <a href="#l09946">9946</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### replaceVPBBWithIRVPBB() {#a3a8743a69fac5e7fa9c2b02604b2cf2f}

<MemberDefinition
  prototype={<>static void replaceVPBBWithIRVPBB (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42; VPBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; IRBB)</>}
  labels = {["static"]}>
Replace <code>VPBB</code> with a <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> wrapping <code>IRBB</code>.

All recipes from <code>VPBB</code> are moved to the end of the newly created <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a>. VPBB must have a single predecessor, which is rewired to the new <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a>. All successors of VPBB, if any, are rewired to the new <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a>.

Definition at line <a href="#l02617">2617</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### STATISTIC() {#ad8318a653242df10df04853e090cc21f}

<MemberDefinition
  prototype={<>STATISTIC (LoopsVectorized, &quot;Number of <a href="/docs/api/files/lib/lib/analysis/loopinfo-cpp/#a49ae40a9c91d665793aaed656c26ca30">loops</a> vectorized&quot;)</>}>

Definition at line <a href="#l00174">174</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### STATISTIC() {#aefd85537796668463b24d5ab5b225407}

<MemberDefinition
  prototype={<>STATISTIC (LoopsAnalyzed, &quot;Number of <a href="/docs/api/files/lib/lib/analysis/loopinfo-cpp/#a49ae40a9c91d665793aaed656c26ca30">loops</a> analyzed <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64expandpseudoinsts-cpp/#a4cfc8b177e8521a4b496ae2edff6244f">for</a> vectorization&quot;)</>}>

Definition at line <a href="#l00175">175</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### STATISTIC() {#a683da38156d0f59a8d6a0cc83dc7ae14}

<MemberDefinition
  prototype={<>STATISTIC (LoopsEpilogueVectorized, &quot;Number of epilogues vectorized&quot;)</>}>

Definition at line <a href="#l00176">176</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### useActiveLaneMask() {#aae88a50a9a37f9a745939e3e726837e6}

<MemberDefinition
  prototype={<>static bool useActiveLaneMask (<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> Style)</>}
  labels = {["static"]}>

Definition at line <a href="#l02126">2126</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### useActiveLaneMaskForControlFlow() {#a4e445204e48d57b1e23e55869146b7ce}

<MemberDefinition
  prototype={<>static bool useActiveLaneMaskForControlFlow (<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> Style)</>}
  labels = {["static"]}>

Definition at line <a href="#l02132">2132</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### useMaskedInterleavedAccesses() {#adf8d8fb6f39b9c0cf21d55b7229d35e2}

<MemberDefinition
  prototype={<>static bool useMaskedInterleavedAccesses (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>

Definition at line <a href="#l02341">2341</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### willGenerateVectors() {#af378bb1e037306d9cfd4bb0b49ba55f9}

<MemberDefinition
  prototype={<>static bool willGenerateVectors (<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp; Plan, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp; TTI)</>}
  labels = {["static"]}>
<a href="/docs/api/namespaces/llvm/check">Check</a> if any recipe of <code>Plan</code> will generate a vector value, which will be assigned a vector register.

Definition at line <a href="#l04439">4439</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### EnableCondStoresVectorization {#a1b67aba558e56b48dbb2891b6e5fe5b8}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableCondStoresVectorization(&quot;enable-cond-stores-vec&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Enable if predication of stores during vectorization.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00328">328</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EnableEarlyExitVectorization {#af7af1b4bf03205c80dcba0a6324c4f21}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableEarlyExitVectorization(&quot;enable-early-exit-vectorization&quot;, cl::init(false), cl::Hidden, cl::desc( &quot;Enable vectorization of early exit loops with uncountable exits.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00388">388</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EnableEpilogueVectorization {#a8bb0da83afffaf803b396b1d055ba5e0}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableEpilogueVectorization(&quot;enable-epilogue-vectorization&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Enable vectorization of epilogue loops.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00178">178</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EnableIndVarRegisterHeur {#a8122656ed2c776067b43d9ae34ccecb6}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableIndVarRegisterHeur(&quot;enable-ind-var-reg-heur&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Count the induction variable only once when interleaving&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00324">324</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EnableInterleavedMemAccesses {#ac3af17aa5bce5ef8c3aa82faeacfc456}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableInterleavedMemAccesses(&quot;enable-interleaved-mem-accesses&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Enable vectorization on interleaved memory accesses in a loop&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00262">262</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EnableLoadStoreRuntimeInterleave {#a99a396adb2c0f9fb93b7ff8ea8b2e2ef}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableLoadStoreRuntimeInterleave(&quot;enable-loadstore-runtime-interleave&quot;, cl::init(true), cl::Hidden, cl::desc( &quot;Enable runtime interleaving until load/store ports are saturated&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00314">314</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EnableMaskedInterleavedMemAccesses {#ac68ad295befb7187ae293cc0faaa3ac3}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; EnableMaskedInterleavedMemAccesses(&quot;enable-masked-interleaved-mem-accesses&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Enable vectorization on masked interleaved memory accesses in a loop&quot;))</>}
  labels = {["static"]}>
An interleave-group may need masking if it resides in a block that needs predication, or in order to mask away gaps.

Definition at line <a href="#l00268">268</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EpilogueVectorizationForceVF {#a01340df86c9d26b281ff1ab9288c28ce}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; EpilogueVectorizationForceVF(&quot;epilogue-vectorization-force-VF&quot;, cl::init(1), cl::Hidden, cl::desc(&quot;When epilogue vectorization is enabled, and a value greater than &quot; &quot;1 is specified, forces the given VF for all applicable epilogue &quot; &quot;loops.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00182">182</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### EpilogueVectorizationMinVF {#a01070590fdc156c181654c2db7b9ddcc}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; EpilogueVectorizationMinVF(&quot;epilogue-vectorization-minimum-VF&quot;, cl::Hidden, cl::desc(&quot;Only loops with vectorization factor equal to or larger than &quot; &quot;the specified value are considered for epilogue vectorization.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00188">188</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceOrderedReductions {#acb0b374f69dc6867357f0aa5e93ab33d}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ForceOrderedReductions(&quot;force-ordered-reductions&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Enable the vectorisation of loops with in-order (strict) &quot; &quot;FP reductions&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00343">343</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceSafeDivisor {#ad69cf8bf5c6b79c5642327ecb6be38cd}

<MemberDefinition
  prototype={<>cl::opt&lt; cl::boolOrDefault &gt; ForceSafeDivisor(&quot;force-widen-divrem-via-safe-divisor&quot;, cl::Hidden, cl::desc( &quot;Override cost based safe divisor widening for div/rem instructions&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00378">378</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceTailFoldingStyle {#a8959791a22c7d3cfb4136777fd244535}

<MemberDefinition
  prototype={<>cl::opt&lt; TailFoldingStyle &gt; ForceTailFoldingStyle(&quot;force-tail-folding-style&quot;, cl::desc(&quot;Force the tail folding style&quot;), cl::init(TailFoldingStyle::None), cl::values( clEnumValN(TailFoldingStyle::None, &quot;none&quot;, &quot;Disable tail folding&quot;), clEnumValN( TailFoldingStyle::Data, &quot;data&quot;, &quot;Create lane mask for data only, using active.lane.mask intrinsic&quot;), clEnumValN(TailFoldingStyle::DataWithoutLaneMask, &quot;data-without-lane-mask&quot;, &quot;Create lane mask with compare/stepvector&quot;), clEnumValN(TailFoldingStyle::DataAndControlFlow, &quot;data-and-control&quot;, &quot;Create lane mask using active.lane.mask intrinsic, and use &quot; &quot;it for both data and control flow&quot;), clEnumValN(TailFoldingStyle::DataAndControlFlowWithoutRuntimeCheck, &quot;data-and-control-without-rt-check&quot;, &quot;Similar to data-and-control, but remove the runtime check&quot;), clEnumValN(TailFoldingStyle::DataWithEVL, &quot;data-with-evl&quot;, &quot;Use predicated EVL instructions for tail folding. If EVL &quot; &quot;is unsupported, fallback to data-without-lane-mask.&quot;)))</>}
  labels = {["static"]}>

Definition at line <a href="#l00236">236</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceTargetInstructionCost {#a5eae6074e6a1bb62e365ef65f3e26196}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; ForceTargetInstructionCost(&quot;force-target-instruction-cost&quot;, cl::init(0), cl::Hidden, cl::desc(&quot;A flag that overrides the target&#39;s expected cost for &quot; &quot;an instruction to a single constant value. Mostly &quot; &quot;useful for getting consistent testing.&quot;))</>}>

Definition at line <a href="#l00290">290</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceTargetMaxScalarInterleaveFactor {#aee1082071c43958a6ef5e6e9f665ae4a}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; ForceTargetMaxScalarInterleaveFactor(&quot;force-target-max-scalar-interleave&quot;, cl::init(0), cl::Hidden, cl::desc(&quot;A flag that overrides the target&#39;s max interleave factor for &quot; &quot;scalar loops.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00280">280</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceTargetMaxVectorInterleaveFactor {#ade5aad46b91dc51c831acf1e69ee9863}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; ForceTargetMaxVectorInterleaveFactor(&quot;force-target-max-vector-interleave&quot;, cl::init(0), cl::Hidden, cl::desc(&quot;A flag that overrides the target&#39;s max interleave factor for &quot; &quot;vectorized loops.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00285">285</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceTargetNumScalarRegs {#a62baadf3a5bf03eddf58bf048724acb1}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; ForceTargetNumScalarRegs(&quot;force-target-num-scalar-regs&quot;, cl::init(0), cl::Hidden, cl::desc(&quot;A flag that overrides the target&#39;s number of scalar registers.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00272">272</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceTargetNumVectorRegs {#a7d952aa72676eecd8065aa2c29ea458c}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; ForceTargetNumVectorRegs(&quot;force-target-num-vector-regs&quot;, cl::init(0), cl::Hidden, cl::desc(&quot;A flag that overrides the target&#39;s number of vector registers.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00276">276</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### ForceTargetSupportsScalableVectors {#a48035e22b43c905a2961c90e5470b2f0}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; ForceTargetSupportsScalableVectors(&quot;force-target-supports-scalable-vectors&quot;, cl::init(false), cl::Hidden, cl::desc( &quot;Pretend that scalable vectors are supported, even if the target does &quot; &quot;not support them. This flag should only be used for testing.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00296">296</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### LLVMLoopVectorizeFollowupAll {#a3bf55ccbbeedcfb8cd2a1bd62c0ad91a}

<MemberDefinition
  prototype={<>const char LLVMLoopVectorizeFollowupAll&#91;&#93; = &quot;llvm.loop.vectorize.followup&#95;all&quot;</>}>

<a href="/docs/api/classes/llvm/metadata">Metadata</a> attribute names

Definition at line <a href="#l00167">167</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### LLVMLoopVectorizeFollowupEpilogue {#aadedae9de069f3bcef6fa7a90ce4a630}

<MemberDefinition
  prototype={<>const char LLVMLoopVectorizeFollowupEpilogue&#91;&#93; =
    &quot;llvm.loop.vectorize.followup&#95;epilogue&quot;</>}>

Definition at line <a href="#l00170">170</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### LLVMLoopVectorizeFollowupVectorized {#a99050b417d193e1cc1117e5bbd4bfbce}

<MemberDefinition
  prototype={<>const char LLVMLoopVectorizeFollowupVectorized&#91;&#93; =
    &quot;llvm.loop.vectorize.followup&#95;vectorized&quot;</>}>

Definition at line <a href="#l00168">168</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### LoopVectorizeWithBlockFrequency {#aa5a50c0ac98e2ed63da85783ca102cf8}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; LoopVectorizeWithBlockFrequency(&quot;loop-vectorize-with-block-frequency&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Enable the use of the block frequency analysis to access PGO &quot; &quot;heuristics minimizing code growth in cold regions and being more &quot; &quot;aggressive in hot regions.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00307">307</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### MaximizeBandwidth {#afe9b34c22ec9e2cc84d61d437f82936d}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; MaximizeBandwidth(&quot;vectorizer-maximize-bandwidth&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Maximize bandwidth when selecting vectorization factor which &quot; &quot;will be determined by the smallest type in loop.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00257">257</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### MaxNestedScalarReductionIC {#ae75965df4671fa34c6ffc5a6e404843a}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; MaxNestedScalarReductionIC(&quot;max-nested-scalar-reduction-interleave&quot;, cl::init(2), cl::Hidden, cl::desc(&quot;The maximum interleave count to use when interleaving a scalar &quot; &quot;reduction in a nested loop.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00332">332</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### MemCheckBypassWeights {#a502070b20fa467fb54ba49d6736cf2d3}

<MemberDefinition
  prototype={<>uint32&#95;t MemCheckBypassWeights&#91;&#93; = &#123;1, 127&#125;</>}
  labels = {["constexpr", "static"]}>

Definition at line <a href="#l00398">398</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### MinItersBypassWeights {#a629884e9a99a9f49106db9e5e6252fcb}

<MemberDefinition
  prototype={<>uint32&#95;t MinItersBypassWeights&#91;&#93; = &#123;1, 127&#125;</>}
  labels = {["constexpr", "static"]}>

Definition at line <a href="#l00401">401</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### NumberOfStoresToPredicate {#ae11c08aa35785a118bda788836cab423}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; NumberOfStoresToPredicate(&quot;vectorize-num-stores-pred&quot;, cl::init(1), cl::Hidden, cl::desc(&quot;Max number of stores to be predicated behind an if.&quot;))</>}
  labels = {["static"]}>
The number of stores in a loop that are allowed to need predication.

Definition at line <a href="#l00320">320</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### PreferInLoopReductions {#a96ef6bd4742763bf1b85aaf1a4150620}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; PreferInLoopReductions(&quot;prefer-inloop-reductions&quot;, cl::init(false), cl::Hidden, cl::desc(&quot;Prefer in-loop vector reductions, &quot; &quot;overriding the targets preference.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00338">338</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### PreferPredicatedReductionSelect {#a927ef1cfd7c981c5b9b9e8c67b1d13c3}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; PreferPredicatedReductionSelect(&quot;prefer-predicated-reduction-select&quot;, cl::init(false), cl::Hidden, cl::desc( &quot;Prefer predicating a reduction operation over an after loop select.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00348">348</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### PreferPredicateOverEpilogue {#abe3c68238712d04bbe3a70f3a8f483f5}

<MemberDefinition
  prototype={<>cl::opt&lt; PreferPredicateTy::Option &gt; PreferPredicateOverEpilogue(&quot;prefer-predicate-over-epilogue&quot;, cl::init(PreferPredicateTy::ScalarEpilogue), cl::Hidden, cl::desc(&quot;Tail-folding and predication preferences over creating a scalar &quot; &quot;epilogue loop.&quot;), cl::values(clEnumValN(PreferPredicateTy::ScalarEpilogue, &quot;scalar-epilogue&quot;, &quot;Don&#39;t tail-predicate loops, create scalar epilogue&quot;), clEnumValN(PreferPredicateTy::PredicateElseScalarEpilogue, &quot;predicate-else-scalar-epilogue&quot;, &quot;prefer tail-folding, create scalar epilogue if tail &quot; &quot;folding fails.&quot;), clEnumValN(PreferPredicateTy::PredicateOrDontVectorize, &quot;predicate-dont-vectorize&quot;, &quot;prefers tail-folding, don&#39;t attempt vectorization if &quot; &quot;tail-folding fails.&quot;)))</>}
  labels = {["static"]}>

Definition at line <a href="#l00218">218</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### SCEVCheckBypassWeights {#a968a5c2971ffa9e8ef81ff86eebaf514}

<MemberDefinition
  prototype={<>uint32&#95;t SCEVCheckBypassWeights&#91;&#93; = &#123;1, 127&#125;</>}
  labels = {["constexpr", "static"]}>

Definition at line <a href="#l00395">395</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### SmallLoopCost {#a71899f6c73fcc8e2fc977dadc1fb1520}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; SmallLoopCost(&quot;small-loop-cost&quot;, cl::init(20), cl::Hidden, cl::desc( &quot;The cost of a loop that is considered &#39;small&#39; by the interleaver.&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00302">302</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### TinyTripCountVectorThreshold {#a15320a2d7ced6e62766048ae7b6f8b13}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; TinyTripCountVectorThreshold(&quot;vectorizer-min-trip-count&quot;, cl::init(16), cl::Hidden, cl::desc(&quot;Loops with a constant trip count that is smaller than this &quot; &quot;value are vectorized only if no scalar iteration overheads &quot; &quot;are incurred.&quot;))</>}
  labels = {["static"]}>
Loops with a known constant trip count below this number are vectorized only if no scalar iteration overheads are incurred.

Definition at line <a href="#l00195">195</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### UseWiderVFIfCallVariantsPresent {#a639c83322f3d5f0e24e9bde998a516fd}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; UseWiderVFIfCallVariantsPresent(&quot;vectorizer-maximize-bandwidth-for-vector-calls&quot;, cl::init(true), cl::Hidden, cl::desc(&quot;Try wider VFs if they enable the use of vector variants&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00383">383</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### VectorizeMemoryCheckThreshold {#a1293f02da7fffb33096a44f1b1768b3f}

<MemberDefinition
  prototype={<>cl::opt&lt; unsigned &gt; VectorizeMemoryCheckThreshold(&quot;vectorize-memory-check-threshold&quot;, cl::init(128), cl::Hidden, cl::desc(&quot;The maximum allowed number of runtime memory checks&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00201">201</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### VerboseDebug {#a8eba8b6f7c3e69bf4d4efd92cd74b5a6}

<MemberDefinition
  prototype={<>const char VerboseDebug&#91;&#93; = <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> &quot;-verbose&quot;</>}>

Definition at line <a href="#l00162">162</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### VPlanBuildStressTest {#a9f30855a6efcd4a12875deb88880b510}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; VPlanBuildStressTest(&quot;vplan-build-stress-test&quot;, cl::init(false), cl::Hidden, cl::desc( &quot;Build VPlan for every supported loop nest in the function and bail &quot; &quot;out right after the build (stress test the VPlan H-CFG construction &quot; &quot;in the VPlan-native vectorization path).&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00364">364</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a></>}>

Definition at line <a href="#l00159">159</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

### LV&#95;NAME {#a0eff4a8bccb143ae91e197e6a59d4692}

<MemberDefinition
  prototype={<>#define LV&#95;NAME&nbsp;&nbsp;&nbsp;&quot;loop-vectorize&quot;</>}>

Definition at line <a href="#l00158">158</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorize-cpp">LoopVectorize.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><Highlight kind="comment">//===- LoopVectorize.cpp - A Loop Vectorizer ------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><Highlight kind="normal"></Highlight><Highlight kind="comment">// See https://llvm.org/LICENSE.txt for license information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This is the LLVM loop vectorizer. This pass modifies &#39;vectorizable&#39; loops</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><Highlight kind="normal"></Highlight><Highlight kind="comment">// and generates target-independent LLVM-IR.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The vectorizer uses the TargetTransformInfo analysis to estimate the costs</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><Highlight kind="normal"></Highlight><Highlight kind="comment">// of instructions in order to estimate the profitability of vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The loop vectorizer combines consecutive loop iterations into a single</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><Highlight kind="normal"></Highlight><Highlight kind="comment">// &#39;wide&#39; iteration. After this transformation the index is incremented</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><Highlight kind="normal"></Highlight><Highlight kind="comment">// by the SIMD vector width, and not by one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This pass has three parts:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><Highlight kind="normal"></Highlight><Highlight kind="comment">// 1 The main loop pass that drives the different parts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><Highlight kind="normal"></Highlight><Highlight kind="comment">// 2 LoopVectorizationLegality - A unit that checks for the legality</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    of the vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><Highlight kind="normal"></Highlight><Highlight kind="comment">// 3 InnerLoopVectorizer - A unit that performs the actual</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    widening of instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><Highlight kind="normal"></Highlight><Highlight kind="comment">// 4 LoopVectorizationCostModel - A unit that checks for the profitability</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    of vectorization. It decides on the optimal vector width, which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><Highlight kind="normal"></Highlight><Highlight kind="comment">//    can be one, if vectorization is not profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><Highlight kind="normal"></Highlight><Highlight kind="comment">// There is a development effort going on to migrate loop vectorizer to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><Highlight kind="normal"></Highlight><Highlight kind="comment">// VPlan infrastructure and to introduce outer loop vectorization support (see</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><Highlight kind="normal"></Highlight><Highlight kind="comment">// docs/VectorizationPlan.rst and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><Highlight kind="normal"></Highlight><Highlight kind="comment">// http://lists.llvm.org/pipermail/llvm-dev/2017-December/119523.html). For this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><Highlight kind="normal"></Highlight><Highlight kind="comment">// purpose, we temporarily introduced the VPlan-native vectorization path: an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><Highlight kind="normal"></Highlight><Highlight kind="comment">// alternative vectorization path that is natively implemented on top of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><Highlight kind="normal"></Highlight><Highlight kind="comment">// VPlan infrastructure. See EnableVPlanNativePath for enabling.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The reduction-variable vectorization is based on the paper:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  D. Nuzman and R. Henderson. Multi-platform Auto-vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Variable uniformity checks are inspired by:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  Karrenberg, R. and Hack, S. Whole Function Vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><Highlight kind="normal"></Highlight><Highlight kind="comment">// The interleaved access vectorization is based on the paper:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  Dorit Nuzman, Ira Rosen and Ayal Zaks.  Auto-Vectorization of Interleaved</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  Data for SIMD</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Other ideas/concepts are from:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  A. Zaks and D. Nuzman. Autovectorization in GCC-two years later.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  S. Maleki, Y. Gao, M. Garzaran, T. Wong and D. Padua.  An Evaluation of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><Highlight kind="normal"></Highlight><Highlight kind="comment">//  Vectorizing Compilers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/vectorize/loopvectorize-h">llvm/Transforms/Vectorize/LoopVectorize.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationplanner-h">LoopVectorizationPlanner.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vprecipebuilder-h">VPRecipeBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplan-h">VPlan.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplananalysis-h">VPlanAnalysis.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanhcfgbuilder-h">VPlanHCFGBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanpatternmatch-h">VPlanPatternMatch.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplantransforms-h">VPlanTransforms.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanutils-h">VPlanUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/vplanverifier-h">VPlanVerifier.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/apint-h">llvm/ADT/APInt.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemapinfo-h">llvm/ADT/DenseMapInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/hashing-h">llvm/ADT/Hashing.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/mapvector-h">llvm/ADT/MapVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h">llvm/ADT/Statistic.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stringref-h">llvm/ADT/StringRef.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/twine-h">llvm/ADT/Twine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/typeswitch-h">llvm/ADT/TypeSwitch.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/iterator-range-h">llvm/ADT/iterator&#95;range.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h">llvm/Analysis/AssumptionCache.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/basicaliasanalysis-h">llvm/Analysis/BasicAliasAnalysis.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h">llvm/Analysis/BlockFrequencyInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/cfg-h">llvm/Analysis/CFG.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/codemetrics-h">llvm/Analysis/CodeMetrics.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/demandedbits-h">llvm/Analysis/DemandedBits.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/globalsmodref-h">llvm/Analysis/GlobalsModRef.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopaccessanalysis-h">llvm/Analysis/LoopAccessAnalysis.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopanalysismanager-h">llvm/Analysis/LoopAnalysisManager.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopinfo-h">llvm/Analysis/LoopInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/loopiterator-h">llvm/Analysis/LoopIterator.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/optimizationremarkemitter-h">llvm/Analysis/OptimizationRemarkEmitter.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/profilesummaryinfo-h">llvm/Analysis/ProfileSummaryInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolution-h">llvm/Analysis/ScalarEvolution.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/scalarevolutionexpressions-h">llvm/Analysis/ScalarEvolutionExpressions.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targetlibraryinfo-h">llvm/Analysis/TargetLibraryInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/targettransforminfo-h">llvm/Analysis/TargetTransformInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/valuetracking-h">llvm/Analysis/ValueTracking.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/vectorutils-h">llvm/Analysis/VectorUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h">llvm/IR/Attributes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h">llvm/IR/CFG.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debugloc-h">llvm/IR/DebugLoc.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/diagnosticinfo-h">llvm/IR/DiagnosticInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/irbuilder-h">llvm/IR/IRBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h">llvm/IR/Intrinsics.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h">llvm/IR/MDBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/metadata-h">llvm/IR/Metadata.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/operator-h">llvm/IR/Operator.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/profdatautils-h">llvm/IR/ProfDataUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/use-h">llvm/IR/Use.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/verifier-h">llvm/IR/Verifier.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/instructioncost-h">llvm/Support/InstructionCost.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/mathextras-h">llvm/Support/MathExtras.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/nativeformatting-h">llvm/Support/NativeFormatting.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/injecttlimappings-h">llvm/Transforms/Utils/InjectTLIMappings.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/local-h">llvm/Transforms/Utils/Local.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/loopsimplify-h">llvm/Transforms/Utils/LoopSimplify.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/looputils-h">llvm/Transforms/Utils/LoopUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/loopversioning-h">llvm/Transforms/Utils/LoopVersioning.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/scalarevolutionexpander-h">llvm/Transforms/Utils/ScalarEvolutionExpander.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/sizeopts-h">llvm/Transforms/Utils/SizeOpts.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/vectorize/loopvectorizationlegality-h">llvm/Transforms/Vectorize/LoopVectorizationLegality.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;algorithm&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cassert&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cstdint&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;functional&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;iterator&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;limits&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;memory&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;string&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;tuple&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;utility&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a>;</Highlight></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158" lineLink="#a0eff4a8bccb143ae91e197e6a59d4692"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define LV&#95;NAME &quot;loop-vectorize&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE LV&#95;NAME</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162" lineLink="#a8eba8b6f7c3e69bf4d4efd92cd74b5a6"><Highlight kind="normal"></Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/analysis/loopnestanalysis-cpp/#ab3595005ef7c117f30d4c18201190bbb">VerboseDebug</a>&#91;&#93; = <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a> </Highlight><Highlight kind="stringliteral">&quot;-verbose&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><Highlight kind="comment">/// @&#123;</Highlight></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><Highlight kind="comment">/// Metadata attribute names</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167" lineLink="#a3bf55ccbbeedcfb8cd2a1bd62c0ad91a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> <a href="#a3bf55ccbbeedcfb8cd2a1bd62c0ad91a">LLVMLoopVectorizeFollowupAll</a>&#91;&#93; = </Highlight><Highlight kind="stringliteral">&quot;llvm.loop.vectorize.followup&#95;all&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168" lineLink="#a99050b417d193e1cc1117e5bbd4bfbce"><Highlight kind="normal"></Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> <a href="#a99050b417d193e1cc1117e5bbd4bfbce">LLVMLoopVectorizeFollowupVectorized</a>&#91;&#93; =</Highlight></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;llvm.loop.vectorize.followup&#95;vectorized&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170" lineLink="#aadedae9de069f3bcef6fa7a90ce4a630"><Highlight kind="normal"></Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> <a href="#aadedae9de069f3bcef6fa7a90ce4a630">LLVMLoopVectorizeFollowupEpilogue</a>&#91;&#93; =</Highlight></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;llvm.loop.vectorize.followup&#95;epilogue&quot;</Highlight><Highlight kind="normal">;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><Highlight kind="comment">/// @&#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174" lineLink="#ad8318a653242df10df04853e090cc21f"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(LoopsVectorized, </Highlight><Highlight kind="stringliteral">&quot;Number of loops vectorized&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175" lineLink="#aefd85537796668463b24d5ab5b225407"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(LoopsAnalyzed, </Highlight><Highlight kind="stringliteral">&quot;Number of loops analyzed for vectorization&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176" lineLink="#a683da38156d0f59a8d6a0cc83dc7ae14"><Highlight kind="normal"><a href="/docs/api/files/include/include/llvm/include/llvm/adt/statistic-h/#ad6117415b93e5675d5a6c8e1855b3b2f">STATISTIC</a>(LoopsEpilogueVectorized, </Highlight><Highlight kind="stringliteral">&quot;Number of epilogues vectorized&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178" lineLink="#a8bb0da83afffaf803b396b1d055ba5e0"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a8bb0da83afffaf803b396b1d055ba5e0">EnableEpilogueVectorization</a>(</Highlight></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;enable-epilogue-vectorization&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable vectorization of epilogue loops.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182" lineLink="#a01340df86c9d26b281ff1ab9288c28ce"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a01340df86c9d26b281ff1ab9288c28ce">EpilogueVectorizationForceVF</a>(</Highlight></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;epilogue-vectorization-force-VF&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(1), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;When epilogue vectorization is enabled, and a value greater than &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;1 is specified, forces the given VF for all applicable epilogue &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;loops.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188" lineLink="#a01070590fdc156c181654c2db7b9ddcc"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a01070590fdc156c181654c2db7b9ddcc">EpilogueVectorizationMinVF</a>(</Highlight></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;epilogue-vectorization-minimum-VF&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Only loops with vectorization factor equal to or larger than &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;the specified value are considered for epilogue vectorization.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><Highlight kind="comment">/// Loops with a known constant trip count below this number are vectorized only</Highlight></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><Highlight kind="comment">/// if no scalar iteration overheads are incurred.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195" lineLink="#a15320a2d7ced6e62766048ae7b6f8b13"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a15320a2d7ced6e62766048ae7b6f8b13">TinyTripCountVectorThreshold</a>(</Highlight></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;vectorizer-min-trip-count&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(16), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Loops with a constant trip count that is smaller than this &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;value are vectorized only if no scalar iteration overheads &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;are incurred.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201" lineLink="#a1293f02da7fffb33096a44f1b1768b3f"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a1293f02da7fffb33096a44f1b1768b3f">VectorizeMemoryCheckThreshold</a>(</Highlight></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;vectorize-memory-check-threshold&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(128), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;The maximum allowed number of runtime memory checks&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Option prefer-predicate-over-epilogue indicates that an epilogue is undesired,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><Highlight kind="normal"></Highlight><Highlight kind="comment">// that predication is preferred, and this lists all options. I.e., the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><Highlight kind="normal"></Highlight><Highlight kind="comment">// vectorizer will try to fold the tail-loop (epilogue) into the vector body</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><Highlight kind="normal"></Highlight><Highlight kind="comment">// and predicate the instructions accordingly. If tail-folding fails, there are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><Highlight kind="normal"></Highlight><Highlight kind="comment">// different fallback strategies depending on these values:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210" lineLink="/docs/api/namespaces/preferpredicatety"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/preferpredicatety">PreferPredicateTy</a> &#123;</Highlight></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211" lineLink="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cda"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">enum</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cda">Option</a> &#123;</Highlight></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212" lineLink="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa114bc9020d046f551b06f41f6f4539f7"><Highlight kind="normal">    <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa114bc9020d046f551b06f41f6f4539f7">ScalarEpilogue</a> = 0,</Highlight></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213" lineLink="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa3111b239a92c1674cea87d025e818091"><Highlight kind="normal">    <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa3111b239a92c1674cea87d025e818091">PredicateElseScalarEpilogue</a>,</Highlight></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214" lineLink="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa5e6f0abe1c426939c61d8924cfa02e5a"><Highlight kind="normal">    <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa5e6f0abe1c426939c61d8924cfa02e5a">PredicateOrDontVectorize</a></Highlight></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// namespace PreferPredicateTy</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218" lineLink="#abe3c68238712d04bbe3a70f3a8f483f5"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;PreferPredicateTy::Option&gt;</a> <a href="#abe3c68238712d04bbe3a70f3a8f483f5">PreferPredicateOverEpilogue</a>(</Highlight></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;prefer-predicate-over-epilogue&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa114bc9020d046f551b06f41f6f4539f7">PreferPredicateTy::ScalarEpilogue</a>),</Highlight></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Tail-folding and predication preferences over creating a scalar &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;epilogue loop.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#a8fa743aa76b6902028f8a643dfb87171">cl::values</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa114bc9020d046f551b06f41f6f4539f7">PreferPredicateTy::ScalarEpilogue</a>,</Highlight></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;scalar-epilogue&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;Don&#39;t tail-predicate loops, create scalar epilogue&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><Highlight kind="normal">              <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa3111b239a92c1674cea87d025e818091">PreferPredicateTy::PredicateElseScalarEpilogue</a>,</Highlight></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;predicate-else-scalar-epilogue&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;prefer tail-folding, create scalar epilogue if tail &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;folding fails.&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><Highlight kind="normal">              <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa5e6f0abe1c426939c61d8924cfa02e5a">PreferPredicateTy::PredicateOrDontVectorize</a>,</Highlight></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;predicate-dont-vectorize&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;prefers tail-folding, don&#39;t attempt vectorization if &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;tail-folding fails.&quot;</Highlight><Highlight kind="normal">)));</Highlight></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236" lineLink="#a8959791a22c7d3cfb4136777fd244535"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;TailFoldingStyle&gt;</a> <a href="#a8959791a22c7d3cfb4136777fd244535">ForceTailFoldingStyle</a>(</Highlight></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;force-tail-folding-style&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Force the tail folding style&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>),</Highlight></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#a8fa743aa76b6902028f8a643dfb87171">cl::values</a>(</Highlight></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>, </Highlight><Highlight kind="stringliteral">&quot;none&quot;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="stringliteral">&quot;Disable tail folding&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(</Highlight></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddaf6068daa29dbb05a7ead1e3b5a48bbee">TailFoldingStyle::Data</a>, </Highlight><Highlight kind="stringliteral">&quot;data&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243"><Highlight kind="normal">            </Highlight><Highlight kind="stringliteral">&quot;Create lane mask for data only, using active.lane.mask intrinsic&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddadfca60932ecfe430f86d4ecde04e13ab">TailFoldingStyle::DataWithoutLaneMask</a>,</Highlight></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><Highlight kind="normal">                   </Highlight><Highlight kind="stringliteral">&quot;data-without-lane-mask&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><Highlight kind="normal">                   </Highlight><Highlight kind="stringliteral">&quot;Create lane mask with compare/stepvector&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddad817e2199b89933da1a3cd7e130cd782">TailFoldingStyle::DataAndControlFlow</a>, </Highlight><Highlight kind="stringliteral">&quot;data-and-control&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><Highlight kind="normal">                   </Highlight><Highlight kind="stringliteral">&quot;Create lane mask using active.lane.mask intrinsic, and use &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><Highlight kind="normal">                   </Highlight><Highlight kind="stringliteral">&quot;it for both data and control flow&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">TailFoldingStyle::DataAndControlFlowWithoutRuntimeCheck</a>,</Highlight></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><Highlight kind="normal">                   </Highlight><Highlight kind="stringliteral">&quot;data-and-control-without-rt-check&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><Highlight kind="normal">                   </Highlight><Highlight kind="stringliteral">&quot;Similar to data-and-control, but remove the runtime check&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h/#a187fd767976b311c09dff5e05ac0c1bc">clEnumValN</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6ae67872a709ea2e3175802518fc4e71">TailFoldingStyle::DataWithEVL</a>, </Highlight><Highlight kind="stringliteral">&quot;data-with-evl&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><Highlight kind="normal">                   </Highlight><Highlight kind="stringliteral">&quot;Use predicated EVL instructions for tail folding. If EVL &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><Highlight kind="normal">                   </Highlight><Highlight kind="stringliteral">&quot;is unsupported, fallback to data-without-lane-mask.&quot;</Highlight><Highlight kind="normal">)));</Highlight></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257" lineLink="#afe9b34c22ec9e2cc84d61d437f82936d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#afe9b34c22ec9e2cc84d61d437f82936d">MaximizeBandwidth</a>(</Highlight></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;vectorizer-maximize-bandwidth&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Maximize bandwidth when selecting vectorization factor which &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;will be determined by the smallest type in loop.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262" lineLink="#ac3af17aa5bce5ef8c3aa82faeacfc456"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#ac3af17aa5bce5ef8c3aa82faeacfc456">EnableInterleavedMemAccesses</a>(</Highlight></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;enable-interleaved-mem-accesses&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable vectorization on interleaved memory accesses in a loop&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><Highlight kind="comment">/// An interleave-group may need masking if it resides in a block that needs</Highlight></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267"><Highlight kind="comment">/// predication, or in order to mask away gaps.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268" lineLink="#ac68ad295befb7187ae293cc0faaa3ac3"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#ac68ad295befb7187ae293cc0faaa3ac3">EnableMaskedInterleavedMemAccesses</a>(</Highlight></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;enable-masked-interleaved-mem-accesses&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable vectorization on masked interleaved memory accesses in a loop&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272" lineLink="#a62baadf3a5bf03eddf58bf048724acb1"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a62baadf3a5bf03eddf58bf048724acb1">ForceTargetNumScalarRegs</a>(</Highlight></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;force-target-num-scalar-regs&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;A flag that overrides the target&#39;s number of scalar registers.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276" lineLink="#a7d952aa72676eecd8065aa2c29ea458c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a7d952aa72676eecd8065aa2c29ea458c">ForceTargetNumVectorRegs</a>(</Highlight></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;force-target-num-vector-regs&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;A flag that overrides the target&#39;s number of vector registers.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280" lineLink="#aee1082071c43958a6ef5e6e9f665ae4a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#aee1082071c43958a6ef5e6e9f665ae4a">ForceTargetMaxScalarInterleaveFactor</a>(</Highlight></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;force-target-max-scalar-interleave&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;A flag that overrides the target&#39;s max interleave factor for &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;scalar loops.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285" lineLink="#ade5aad46b91dc51c831acf1e69ee9863"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#ade5aad46b91dc51c831acf1e69ee9863">ForceTargetMaxVectorInterleaveFactor</a>(</Highlight></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;force-target-max-vector-interleave&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;A flag that overrides the target&#39;s max interleave factor for &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;vectorized loops.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290" lineLink="#a5eae6074e6a1bb62e365ef65f3e26196"><Highlight kind="normal"><a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a5eae6074e6a1bb62e365ef65f3e26196">ForceTargetInstructionCost</a>(</Highlight></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;force-target-instruction-cost&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(0), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;A flag that overrides the target&#39;s expected cost for &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;an instruction to a single constant value. Mostly &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;useful for getting consistent testing.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296" lineLink="#a48035e22b43c905a2961c90e5470b2f0"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a48035e22b43c905a2961c90e5470b2f0">ForceTargetSupportsScalableVectors</a>(</Highlight></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;force-target-supports-scalable-vectors&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Pretend that scalable vectors are supported, even if the target does &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;not support them. This flag should only be used for testing.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302" lineLink="#a71899f6c73fcc8e2fc977dadc1fb1520"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#a71899f6c73fcc8e2fc977dadc1fb1520">SmallLoopCost</a>(</Highlight></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;small-loop-cost&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(20), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;The cost of a loop that is considered &#39;small&#39; by the interleaver.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307" lineLink="#aa5a50c0ac98e2ed63da85783ca102cf8"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#aa5a50c0ac98e2ed63da85783ca102cf8">LoopVectorizeWithBlockFrequency</a>(</Highlight></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;loop-vectorize-with-block-frequency&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable the use of the block frequency analysis to access PGO &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;heuristics minimizing code growth in cold regions and being more &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;aggressive in hot regions.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Runtime interleave loops for load/store throughput.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314" lineLink="#a99a396adb2c0f9fb93b7ff8ea8b2e2ef"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a99a396adb2c0f9fb93b7ff8ea8b2e2ef">EnableLoadStoreRuntimeInterleave</a>(</Highlight></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;enable-loadstore-runtime-interleave&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Enable runtime interleaving until load/store ports are saturated&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><Highlight kind="comment">/// The number of stores in a loop that are allowed to need predication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320" lineLink="#ae11c08aa35785a118bda788836cab423"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#ae11c08aa35785a118bda788836cab423">NumberOfStoresToPredicate</a>(</Highlight></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;vectorize-num-stores-pred&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(1), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Max number of stores to be predicated behind an if.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324" lineLink="#a8122656ed2c776067b43d9ae34ccecb6"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a8122656ed2c776067b43d9ae34ccecb6">EnableIndVarRegisterHeur</a>(</Highlight></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;enable-ind-var-reg-heur&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Count the induction variable only once when interleaving&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328" lineLink="#a1b67aba558e56b48dbb2891b6e5fe5b8"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a1b67aba558e56b48dbb2891b6e5fe5b8">EnableCondStoresVectorization</a>(</Highlight></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;enable-cond-stores-vec&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable if predication of stores during vectorization.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332" lineLink="#ae75965df4671fa34c6ffc5a6e404843a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;unsigned&gt;</a> <a href="#ae75965df4671fa34c6ffc5a6e404843a">MaxNestedScalarReductionIC</a>(</Highlight></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;max-nested-scalar-reduction-interleave&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(2), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;The maximum interleave count to use when interleaving a scalar &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;reduction in a nested loop.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338" lineLink="#a96ef6bd4742763bf1b85aaf1a4150620"><Highlight kind="normal">    <a href="#a96ef6bd4742763bf1b85aaf1a4150620">PreferInLoopReductions</a>(</Highlight><Highlight kind="stringliteral">&quot;prefer-inloop-reductions&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><Highlight kind="normal">                           <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><Highlight kind="normal">                           <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Prefer in-loop vector reductions, &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><Highlight kind="normal">                                    </Highlight><Highlight kind="stringliteral">&quot;overriding the targets preference.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343" lineLink="#acb0b374f69dc6867357f0aa5e93ab33d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#acb0b374f69dc6867357f0aa5e93ab33d">ForceOrderedReductions</a>(</Highlight></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;force-ordered-reductions&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable the vectorisation of loops with in-order (strict) &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;FP reductions&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348" lineLink="#a927ef1cfd7c981c5b9b9e8c67b1d13c3"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a927ef1cfd7c981c5b9b9e8c67b1d13c3">PreferPredicatedReductionSelect</a>(</Highlight></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;prefer-predicated-reduction-select&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Prefer predicating a reduction operation over an after loop select.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</Highlight></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><Highlight kind="normal"><a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a>(</Highlight></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;enable-vplan-native-path&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable VPlan-native vectorization path with &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;support for outer loop vectorization.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// namespace llvm</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This flag enables the stress testing of the VPlan H-CFG construction in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361"><Highlight kind="normal"></Highlight><Highlight kind="comment">// VPlan-native vectorization path. It must be used in conjuction with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><Highlight kind="normal"></Highlight><Highlight kind="comment">// -enable-vplan-native-path. -vplan-verify-hcfg can also be used to enable the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><Highlight kind="normal"></Highlight><Highlight kind="comment">// verification of the H-CFGs built.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364" lineLink="#a9f30855a6efcd4a12875deb88880b510"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a9f30855a6efcd4a12875deb88880b510">VPlanBuildStressTest</a>(</Highlight></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;vplan-build-stress-test&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Build VPlan for every supported loop nest in the function and bail &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;out right after the build (stress test the VPlan H-CFG construction &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;in the VPlan-native vectorization path).&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><Highlight kind="normal"><a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#af98e93062e9f33018307ffc64d4b009e">llvm::EnableLoopInterleaving</a>(</Highlight></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;interleave-loops&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Enable loop interleaving in Loop vectorization passes&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><Highlight kind="normal"><a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="/docs/api/namespaces/llvm/#a7f386d38a2c6c22a343243e9e48f7532">llvm::EnableLoopVectorization</a>(</Highlight></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;vectorize-loops&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Run the Loop vectorization passes&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378" lineLink="#ad69cf8bf5c6b79c5642327ecb6be38cd"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;cl::boolOrDefault&gt;</a> <a href="#ad69cf8bf5c6b79c5642327ecb6be38cd">ForceSafeDivisor</a>(</Highlight></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;force-widen-divrem-via-safe-divisor&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Override cost based safe divisor widening for div/rem instructions&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383" lineLink="#a639c83322f3d5f0e24e9bde998a516fd"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#a639c83322f3d5f0e24e9bde998a516fd">UseWiderVFIfCallVariantsPresent</a>(</Highlight></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;vectorizer-maximize-bandwidth-for-vector-calls&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Try wider VFs if they enable the use of vector variants&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388" lineLink="#af7af1b4bf03205c80dcba0a6324c4f21"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a> <a href="#af7af1b4bf03205c80dcba0a6324c4f21">EnableEarlyExitVectorization</a>(</Highlight></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><Highlight kind="normal">    </Highlight><Highlight kind="stringliteral">&quot;enable-early-exit-vectorization&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#ac12e6a8f3a1b511f0dee2ed6de0ae806">cl::init</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">), <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Enable vectorization of early exit loops with uncountable exits.&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Likelyhood of bypassing the vectorized loop because assumptions about SCEV</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><Highlight kind="normal"></Highlight><Highlight kind="comment">// variables not overflowing do not hold. See &#96;emitSCEVChecks&#96;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395" lineLink="#a968a5c2971ffa9e8ef81ff86eebaf514"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">constexpr</Highlight><Highlight kind="normal"> uint32&#95;t <a href="#a968a5c2971ffa9e8ef81ff86eebaf514">SCEVCheckBypassWeights</a>&#91;&#93; = &#123;1, 127&#125;;</Highlight></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Likelyhood of bypassing the vectorized loop because pointers overlap. See</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><Highlight kind="normal"></Highlight><Highlight kind="comment">// &#96;emitMemRuntimeChecks&#96;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398" lineLink="#a502070b20fa467fb54ba49d6736cf2d3"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">constexpr</Highlight><Highlight kind="normal"> uint32&#95;t <a href="#a502070b20fa467fb54ba49d6736cf2d3">MemCheckBypassWeights</a>&#91;&#93; = &#123;1, 127&#125;;</Highlight></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Likelyhood of bypassing the vectorized loop because there are zero trips left</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><Highlight kind="normal"></Highlight><Highlight kind="comment">// after prolog. See &#96;emitIterationCountCheck&#96;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401" lineLink="#a629884e9a99a9f49106db9e5e6252fcb"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">constexpr</Highlight><Highlight kind="normal"> uint32&#95;t <a href="#a629884e9a99a9f49106db9e5e6252fcb">MinItersBypassWeights</a>&#91;&#93; = &#123;1, 127&#125;;</Highlight></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><Highlight kind="comment">/// A helper function that returns true if the given type is irregular. The</Highlight></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><Highlight kind="comment">/// type is irregular if its allocated size doesn&#39;t equal the store size of an</Highlight></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><Highlight kind="comment">/// element of the corresponding vector type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406" lineLink="#aa407c2e7d895ed29af8cc68563c03065"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#aa407c2e7d895ed29af8cc68563c03065">hasIrregularType</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</Highlight></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Determine if an array of N elements of type Ty is &quot;bitcast compatible&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// with a &lt;N x Ty&gt; vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is only true if there is no padding between the array elements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeAllocSizeInBits(Ty) != <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(Ty);</Highlight></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><Highlight kind="comment">/// Returns &quot;best known&quot; trip count for the specified loop \\p L as defined by</Highlight></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><Highlight kind="comment">/// the following procedure:</Highlight></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><Highlight kind="comment">///   1) Returns exact trip count if it is known.</Highlight></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><Highlight kind="comment">///   2) Returns expected trip count according to profile data if any.</Highlight></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><Highlight kind="comment">///   3) Returns upper bound estimate if known, and if \\p CanUseConstantMax.</Highlight></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><Highlight kind="comment">///   4) Returns std::nullopt if all of the above failed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> std::optional&lt;unsigned&gt;</Highlight></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420" lineLink="#a84375e6536d9214c7895013078055aff"><Highlight kind="normal"><a href="#a84375e6536d9214c7895013078055aff">getSmallBestKnownTC</a>(<a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;PSE, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</Highlight></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><Highlight kind="normal">                    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CanUseConstantMax = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if exact trip count is known.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ExpectedTC = PSE.<a href="/docs/api/classes/llvm/predicatedscalarevolution/#a10ca5eacc61b5669880de2f8b0cff33c">getSE</a>()-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#abec0c616087c002528fcf80c6583eadd">getSmallConstantTripCount</a>(L))</Highlight></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ExpectedTC;</Highlight></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if there is an expected trip count available from profile data.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#aa5a50c0ac98e2ed63da85783ca102cf8">LoopVectorizeWithBlockFrequency</a>)</Highlight></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> EstimatedTC = <a href="/docs/api/namespaces/llvm/#a0b3c6dc8e7df65d2385acfe9657abd03">getLoopEstimatedTripCount</a>(L))</Highlight></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;EstimatedTC;</Highlight></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CanUseConstantMax)</Highlight></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if upper bound estimate is known.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ExpectedTC = PSE.<a href="/docs/api/classes/llvm/predicatedscalarevolution/#aacf376f9963d73732052a7362c5afabd">getSmallConstantMaxTripCount</a>())</Highlight></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ExpectedTC;</Highlight></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441" lineLink="/docs/api/namespaces/anonymous-loopvectorize-cpp-"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Forward declare GeneratedRTChecks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks">GeneratedRTChecks</a>;</Highlight></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445" lineLink="/docs/api/namespaces/anonymous-loopvectorize-cpp-/#aad9655f266100ed4a64d9aeea1e4f4b6"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/anonymous-loopvectorize-cpp-/#aad9655f266100ed4a64d9aeea1e4f4b6">SCEV2ValueTy</a> = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const SCEV &#42;, Value &#42;&gt;</a>;</Highlight></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</Highlight></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><Highlight kind="normal"><a href="/docs/api/structs/llvm/analysiskey">AnalysisKey</a> <a href="/docs/api/structs/llvm/shouldrunextravectorpasses/#a42f51564a150e5ecd40230fad2368ee9">ShouldRunExtraVectorPasses::Key</a>;</Highlight></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><Highlight kind="comment">/// InnerLoopVectorizer vectorizes loops which contain only one basic</Highlight></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><Highlight kind="comment">/// block to a specified vectorization factor (VF).</Highlight></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><Highlight kind="comment">/// This class performs the widening of scalars into vectors, or multiple</Highlight></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><Highlight kind="comment">/// scalars. This class also implements the following features:</Highlight></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><Highlight kind="comment">/// &#42; It inserts an epilogue loop for handling loops that don&#39;t have iteration</Highlight></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><Highlight kind="comment">///   counts that are known to be a multiple of the vectorization factor.</Highlight></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><Highlight kind="comment">/// &#42; It handles the code generation for reduction variables.</Highlight></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><Highlight kind="comment">/// &#42; Scalarization (implementation using scalars) of un-vectorizable</Highlight></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><Highlight kind="comment">///   instructions.</Highlight></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><Highlight kind="comment">/// InnerLoopVectorizer does not perform any vectorization-legality</Highlight></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><Highlight kind="comment">/// checks, and relies on the caller to check for the different legality</Highlight></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><Highlight kind="comment">/// aspects. The InnerLoopVectorizer relies on the</Highlight></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><Highlight kind="comment">/// LoopVectorizationLegality class to provide information about the induction</Highlight></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><Highlight kind="comment">/// and reduction variables that were found to a given vectorization factor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466" lineLink="/docs/api/classes/llvm/innerloopvectorizer"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/innerloopvectorizer/#a6c7095217b0d803a65548373bd4db3cf">InnerLoopVectorizer</a> &#123;</Highlight></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a6c7095217b0d803a65548373bd4db3cf"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6c7095217b0d803a65548373bd4db3cf">InnerLoopVectorizer</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>,</Highlight></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><Highlight kind="normal">                      <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>,</Highlight></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><Highlight kind="normal">                      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>,</Highlight></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><Highlight kind="normal">                      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a238e95d82d095fec9241f2f5b81db3c5">TTI</a>, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>,</Highlight></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><Highlight kind="normal">                      <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VecWidth,</Highlight></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><Highlight kind="normal">                      <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a1f52585230b8a3cb8bf4a30f8e51bfb4">MinProfitableTripCount</a>,</Highlight></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><Highlight kind="normal">                      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> UnrollFactor, <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;LVL,</Highlight></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><Highlight kind="normal">                      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> &#42;CM, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>,</Highlight></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><Highlight kind="normal">                      <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>, GeneratedRTChecks &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#ae9880a8edd20b3b9b1527ecd5a03ac8c">RTChecks</a>,</Highlight></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><Highlight kind="normal">                      <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>)</Highlight></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><Highlight kind="normal">      : <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a238e95d82d095fec9241f2f5b81db3c5">TTI</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a238e95d82d095fec9241f2f5b81db3c5">TTI</a>),</Highlight></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>(VecWidth),</Highlight></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/innerloopvectorizer/#a1f52585230b8a3cb8bf4a30f8e51bfb4">MinProfitableTripCount</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a1f52585230b8a3cb8bf4a30f8e51bfb4">MinProfitableTripCount</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>(UnrollFactor),</Highlight></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>.getSE()-&gt;getContext()), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6bb946cd99f8c37f0145265914aea778">Legal</a>(LVL), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>(CM), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>),</Highlight></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae9880a8edd20b3b9b1527ecd5a03ac8c">RTChecks</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#ae9880a8edd20b3b9b1527ecd5a03ac8c">RTChecks</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>),</Highlight></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6b18db1093ed5460e67e9058b89e385b">VectorPHVPB</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.getEntry()-&gt;getSingleSuccessor()) &#123;</Highlight></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Query this against the original loop and save it here because the profile</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// of the original loop header may change as the transformation happens.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#a93a8f97a1e57c3bce2e7c3473d592c01">OptForSizeBasedOnProfile</a> = <a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(</Highlight></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getHeader(), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>, <a href="/docs/api/namespaces/llvm/#aec7c967a5416fa6e154433965357a50ea089e7eb4db258e05f70eef4ed5aa10bb">PGSOQueryType::IRPass</a>);</Highlight></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#aecacb69b3a2334317cce2a7856f7d30d"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">virtual</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#aecacb69b3a2334317cce2a7856f7d30d">~InnerLoopVectorizer</a>() = </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><Highlight kind="comment">  /// Create a new empty loop that will contain vectorized instructions later</Highlight></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><Highlight kind="comment">  /// on, while the old loop will be used as the scalar remainder. Control flow</Highlight></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><Highlight kind="comment">  /// is generated around the vectorized (and scalar epilogue) loops consisting</Highlight></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><Highlight kind="comment">  /// of various checks and bypasses. Return the pre-header block of the new</Highlight></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><Highlight kind="comment">  /// loop. In the case of epilogue vectorization, this function is overriden to</Highlight></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><Highlight kind="comment">  /// handle the more complex control flow around the loops. \\p ExpandedSCEVs is</Highlight></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><Highlight kind="comment">  /// used to look up SCEV expansions for expressions needed during skeleton</Highlight></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><Highlight kind="comment">  /// creation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">virtual</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a31f933a6eada9926c9e320db27dfb775">createVectorizedLoopSkeleton</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SCEV2ValueTy &amp;ExpandedSCEVs);</Highlight></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><Highlight kind="comment">  /// Fix the vectorized code, taking care of header phi&#39;s, and more.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a9484786140efebf774cde8f072894246">fixVectorizedLoop</a>(<a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State);</Highlight></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Return true if any runtime check is added.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a2e066ef7bc9673cbb2a825189491577d"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a2e066ef7bc9673cbb2a825189491577d">areSafetyChecksAdded</a>() &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a645c5c5c1e89cb56be66db8db877001d">AddedSafetyChecks</a>; &#125;</Highlight></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><Highlight kind="comment">  /// A helper function to scalarize a single Instruction in the innermost loop.</Highlight></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><Highlight kind="comment">  /// Generates a sequence of scalar instances for each lane between \\p MinLane</Highlight></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><Highlight kind="comment">  /// and \\p MaxLane, times each part between \\p MinPart and \\p MaxPart,</Highlight></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><Highlight kind="comment">  /// inclusive. Uses the VPValue operands from \\p RepRecipe instead of \\p</Highlight></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><Highlight kind="comment">  /// Instr&#39;s operands.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a4690286163882c35068b1908f4d752fd">scalarizeInstruction</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr,</Highlight></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a> &#42;RepRecipe, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vplane">VPLane</a> &amp;Lane,</Highlight></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><Highlight kind="normal">                            <a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State);</Highlight></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><Highlight kind="comment">  /// Fix the non-induction PHIs in \\p Plan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#accb5ce221150790c36b2d96af1be821c">fixNonInductionPHIs</a>(<a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State);</Highlight></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><Highlight kind="comment">  /// Returns the original loop trip count.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696">getTripCount</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0937fe0c707a3cd1198cea4467fa37c0">TripCount</a>; &#125;</Highlight></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><Highlight kind="comment">  /// Used to set the trip count after ILV&#39;s construction and after the</Highlight></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><Highlight kind="comment">  /// preheader block has been executed. Note that this always holds the trip</Highlight></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><Highlight kind="comment">  /// count of the original loop for both main loop and epilogue vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a9160ed9f749a9c4df711061181288e13"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a9160ed9f749a9c4df711061181288e13">setTripCount</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;TC) &#123; <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0937fe0c707a3cd1198cea4467fa37c0">TripCount</a> = TC; &#125;</Highlight></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Retrieve the additional bypass value associated with an original</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><Highlight kind="comment">  /// induction header phi.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a86acbbb5785d46e5a10d2ed34c779dd9"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a86acbbb5785d46e5a10d2ed34c779dd9">getInductionAdditionalBypassValue</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;OrigPhi)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a48c4aed6852a39d4dcc584ac75cc1055">Induction2AdditionalBypassValue</a>.at(OrigPhi);</Highlight></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><Highlight kind="comment">  /// Return the additional bypass block which targets the scalar loop by</Highlight></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><Highlight kind="comment">  /// skipping the epilogue loop after completing the main loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a8f2e87f456c35fdad0ec24e7c71a92a5"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a8f2e87f456c35fdad0ec24e7c71a92a5">getAdditionalBypassBlock</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a329ce2a6185c5e632406d1d2fc75610e">AdditionalBypassBlock</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Trying to access AdditionalBypassBlock but it has not been set&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a329ce2a6185c5e632406d1d2fc75610e">AdditionalBypassBlock</a>;</Highlight></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><Highlight kind="normal"></Highlight><Highlight kind="keyword">protected</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a409249e01d3e65716e4c76fa3369a4e0"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">friend</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/innerloopvectorizer/#a409249e01d3e65716e4c76fa3369a4e0">LoopVectorizationPlanner</a>;</Highlight></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><Highlight kind="comment">  /// Iteratively sink the scalarized operands of a predicated instruction into</Highlight></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><Highlight kind="comment">  /// the block that was created for it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0a5c60e5cebd520f95b9813fd9807016">sinkScalarOperands</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PredInst);</Highlight></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><Highlight kind="comment">  /// Returns (and creates if needed) the trip count of the widened loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa83b181aa14d5afe1390faad388f91a4">getOrCreateVectorTripCount</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InsertBlock);</Highlight></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><Highlight kind="comment">  /// Emit a bypass check to see if the vector trip count is zero, including if</Highlight></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><Highlight kind="comment">  /// it overflows.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a72c491cdf8cf0283d87008831431f917">emitIterationCountCheck</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass);</Highlight></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><Highlight kind="comment">  /// Emit a bypass check to see if all of the SCEV assumptions we&#39;ve</Highlight></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><Highlight kind="comment">  /// had to make are correct. Returns the block containing the checks or</Highlight></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><Highlight kind="comment">  /// nullptr if no checks have been added.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a30c4bcea7beb42c7eb075a578bc3bc3e">emitSCEVChecks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass);</Highlight></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><Highlight kind="comment">  /// Emit bypass checks to check any memory assumptions we may have made.</Highlight></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><Highlight kind="comment">  /// Returns the block containing the checks or nullptr if no checks have been</Highlight></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><Highlight kind="comment">  /// added.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a625caa931f0d8ef201041febbfe42cca">emitMemRuntimeChecks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass);</Highlight></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><Highlight kind="comment">  /// Emit basic blocks (prefixed with \\p Prefix) for the iteration check,</Highlight></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><Highlight kind="comment">  /// vector loop preheader, middle block and scalar preheader.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5e719da4709193fd5b4632da4bc69795">createVectorLoopSkeleton</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a> Prefix);</Highlight></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><Highlight kind="comment">  /// Create and record the values for induction variables to resume coming from</Highlight></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><Highlight kind="comment">  /// the additional bypass block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a69c116deda6ae831a71558a4630323cb">createInductionAdditionalBypassValues</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SCEV2ValueTy &amp;ExpandedSCEVs,</Highlight></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><Highlight kind="normal">                                             <a href="/docs/api/classes/llvm/value">Value</a> &#42;MainVectorTripCount);</Highlight></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><Highlight kind="comment">  /// Allow subclasses to override and print debug traces before/after vplan</Highlight></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><Highlight kind="comment">  /// execution, when trace information is requested.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a00579d597c88e5f3c51754bcd9ec5658"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">virtual</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a00579d597c88e5f3c51754bcd9ec5658">printDebugTracesAtStart</a>() &#123;&#125;</Highlight></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a9e275f16680d4f09dbcc0dd7d323a075"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">virtual</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a9e275f16680d4f09dbcc0dd7d323a075">printDebugTracesAtEnd</a>() &#123;&#125;</Highlight></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><Highlight kind="comment">  /// Introduces a new VPIRBasicBlock for \\p CheckIRBB to Plan between the</Highlight></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><Highlight kind="comment">  /// vector preheader and its predecessor, also connecting the new block to the</Highlight></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><Highlight kind="comment">  /// scalar preheader.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9">introduceCheckBlockInVPlan</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CheckIRBB);</Highlight></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><Highlight kind="comment">  /// The original loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>;</Highlight></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><Highlight kind="comment">  /// A wrapper around ScalarEvolution used to add runtime SCEV checks. Applies</Highlight></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><Highlight kind="comment">  /// dynamic knowledge to simplify SCEV expressions and converts them to a</Highlight></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><Highlight kind="comment">  /// more usable form.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>;</Highlight></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><Highlight kind="comment">  /// Loop Info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>;</Highlight></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><Highlight kind="comment">  /// Dominator Tree.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>;</Highlight></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><Highlight kind="comment">  /// Target Library Info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>;</Highlight></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><Highlight kind="comment">  /// Target Transform Info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a238e95d82d095fec9241f2f5b81db3c5"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a238e95d82d095fec9241f2f5b81db3c5">TTI</a>;</Highlight></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606"><Highlight kind="comment">  /// Assumption Cache.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>;</Highlight></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><Highlight kind="comment">  /// Interface to emit optimization remarks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>;</Highlight></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><Highlight kind="comment">  /// The vectorization SIMD factor to use. Each vector will have this many</Highlight></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><Highlight kind="comment">  /// vector elements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>;</Highlight></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a1f52585230b8a3cb8bf4a30f8e51bfb4"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a1f52585230b8a3cb8bf4a30f8e51bfb4">MinProfitableTripCount</a>;</Highlight></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><Highlight kind="comment">  /// The vectorization unroll factor to use. Each scalar is vectorized to this</Highlight></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><Highlight kind="comment">  /// many different vector instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>;</Highlight></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><Highlight kind="comment">  /// The builder that we use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>;</Highlight></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// --- Vectorization state ---</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><Highlight kind="comment">  /// The vector-loop preheader.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>;</Highlight></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><Highlight kind="comment">  /// The scalar-loop preheader.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>;</Highlight></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><Highlight kind="comment">  /// Middle Block between the vector and the scalar.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a38e6f65b6ccbdebbf2c7a8b078936115"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a38e6f65b6ccbdebbf2c7a8b078936115">LoopMiddleBlock</a>;</Highlight></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><Highlight kind="comment">  /// A list of all bypass blocks. The first block is the entry of the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;, 4&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>;</Highlight></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><Highlight kind="comment">  /// Store instructions that were predicated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a47eab9fa7cfa73af0b164da3fca49a0f"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a47eab9fa7cfa73af0b164da3fca49a0f">PredicatedInstructions</a>;</Highlight></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><Highlight kind="comment">  /// Trip count of the original loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a0937fe0c707a3cd1198cea4467fa37c0"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a0937fe0c707a3cd1198cea4467fa37c0">TripCount</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><Highlight kind="comment">  /// Trip count of the widened loop (TripCount - TripCount % (VF&#42;UF))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a2c95f95757d9c56b7a89d7f8b3278581"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a2c95f95757d9c56b7a89d7f8b3278581">VectorTripCount</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><Highlight kind="comment">  /// The legality analysis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a6bb946cd99f8c37f0145265914aea778"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a6bb946cd99f8c37f0145265914aea778">Legal</a>;</Highlight></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651"><Highlight kind="comment">  /// The profitablity analysis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>;</Highlight></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Record whether runtime checks are added.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a645c5c5c1e89cb56be66db8db877001d"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a645c5c5c1e89cb56be66db8db877001d">AddedSafetyChecks</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><Highlight kind="comment">  /// BFI and PSI are used to check for profile guided size optimizations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>;</Highlight></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>;</Highlight></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Whether this loop should be optimized for size based on profile guided size</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// optimizatios.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a93a8f97a1e57c3bce2e7c3473d592c01"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a93a8f97a1e57c3bce2e7c3473d592c01">OptForSizeBasedOnProfile</a>;</Highlight></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><Highlight kind="comment">  /// Structure to hold information about generated runtime checks, responsible</Highlight></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><Highlight kind="comment">  /// for cleaning the checks, if vectorization turns out unprofitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#ae9880a8edd20b3b9b1527ecd5a03ac8c"><Highlight kind="normal">  GeneratedRTChecks &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#ae9880a8edd20b3b9b1527ecd5a03ac8c">RTChecks</a>;</Highlight></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><Highlight kind="comment">  /// Mapping of induction phis to their additional bypass values. They</Highlight></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><Highlight kind="comment">  /// need to be added as operands to phi nodes in the scalar loop preheader</Highlight></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><Highlight kind="comment">  /// after the epilogue skeleton has been created.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a48c4aed6852a39d4dcc584ac75cc1055"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;PHINode &#42;, Value &#42;&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a48c4aed6852a39d4dcc584ac75cc1055">Induction2AdditionalBypassValue</a>;</Highlight></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><Highlight kind="comment">  /// The additional bypass block which conditionally skips over the epilogue</Highlight></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><Highlight kind="comment">  /// loop after executing the main loop. Needed to resume inductions and</Highlight></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><Highlight kind="comment">  /// reductions during epilogue vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a329ce2a6185c5e632406d1d2fc75610e"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a329ce2a6185c5e632406d1d2fc75610e">AdditionalBypassBlock</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>;</Highlight></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><Highlight kind="comment">  /// The vector preheader block of \\p Plan, used as target for check blocks</Highlight></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><Highlight kind="comment">  /// introduced during skeleton creation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a6b18db1093ed5460e67e9058b89e385b"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a6b18db1093ed5460e67e9058b89e385b">VectorPHVPB</a>;</Highlight></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><Highlight kind="comment">/// Encapsulate information regarding vectorization of a loop and its epilogue.</Highlight></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><Highlight kind="comment">/// This information is meant to be updated and used across two stages of</Highlight></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><Highlight kind="comment">/// epilogue vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo"><Highlight kind="normal"></Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal"><a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d7d09b3f7c32cf03cf05ee57020ad4f">EpilogueLoopVectorizationInfo</a> &#123;</Highlight></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d536d11651c11a778ea9fe9332a4a2e"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d536d11651c11a778ea9fe9332a4a2e">MainLoopVF</a> = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(0);</Highlight></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a18939d452d993dd7ddd465c5c11535a4"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a18939d452d993dd7ddd465c5c11535a4">MainLoopUF</a> = 0;</Highlight></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a529385ab333b24f1f2c2dd8525ad52a8"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a529385ab333b24f1f2c2dd8525ad52a8">EpilogueVF</a> = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(0);</Highlight></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6ec74a5afe1cfb93444b9f8988ed4c12"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6ec74a5afe1cfb93444b9f8988ed4c12">EpilogueUF</a> = 0;</Highlight></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a854358d393ec8943df9757b4e5e6c388"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a854358d393ec8943df9757b4e5e6c388">MainLoopIterationCountCheck</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#af7e8a35e9864ca6848ceeac1a326df93"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#af7e8a35e9864ca6848ceeac1a326df93">EpilogueIterationCountCheck</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a33f0a5678a72641d093734ca31ec43d2"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a33f0a5678a72641d093734ca31ec43d2">SCEVSafetyCheck</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a74facc922f5c9b96ee958fff171c02cf"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a74facc922f5c9b96ee958fff171c02cf">MemSafetyCheck</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a20f8969b812a491714c8181ff736e000"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a20f8969b812a491714c8181ff736e000">TripCount</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a63a7b18fae2eec1be9b81d461dc7ebe8"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a63a7b18fae2eec1be9b81d461dc7ebe8">VectorTripCount</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#af0f96a1e05dadf7e03047494b47be046"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#af0f96a1e05dadf7e03047494b47be046">EpiloguePlan</a>;</Highlight></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702" lineLink="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d7d09b3f7c32cf03cf05ee57020ad4f"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d7d09b3f7c32cf03cf05ee57020ad4f">EpilogueLoopVectorizationInfo</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MVF, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MUF,</Highlight></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><Highlight kind="normal">                                <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> EVF, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> EUF,</Highlight></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><Highlight kind="normal">                                <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#af0f96a1e05dadf7e03047494b47be046">EpiloguePlan</a>)</Highlight></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><Highlight kind="normal">      : <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d536d11651c11a778ea9fe9332a4a2e">MainLoopVF</a>(MVF), <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a18939d452d993dd7ddd465c5c11535a4">MainLoopUF</a>(MUF), <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a529385ab333b24f1f2c2dd8525ad52a8">EpilogueVF</a>(EVF), <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6ec74a5afe1cfb93444b9f8988ed4c12">EpilogueUF</a>(EUF),</Highlight></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><Highlight kind="normal">        <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#af0f96a1e05dadf7e03047494b47be046">EpiloguePlan</a>(<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#af0f96a1e05dadf7e03047494b47be046">EpiloguePlan</a>) &#123;</Highlight></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EUF == 1 &amp;&amp;</Highlight></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;A high UF for the epilogue loop is likely not beneficial.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><Highlight kind="comment">/// An extension of the inner loop vectorizer that creates a skeleton for a</Highlight></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><Highlight kind="comment">/// vectorized loop that has its epilogue (residual) also vectorized.</Highlight></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><Highlight kind="comment">/// The idea is to run the vplan on a given loop twice, firstly to setup the</Highlight></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><Highlight kind="comment">/// skeleton and vectorize the main loop, and secondly to complete the skeleton</Highlight></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><Highlight kind="comment">/// from the first step and vectorize the epilogue.  This is achieved by</Highlight></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><Highlight kind="comment">/// deriving two concrete strategy classes from this base class and invoking</Highlight></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><Highlight kind="comment">/// them in succession from the loop vectorizer planner.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719" lineLink="/docs/api/classes/llvm/innerloopandepiloguevectorizer"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a0a9465c209525e66b0e00ff32fe4495d">InnerLoopAndEpilogueVectorizer</a> : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6c7095217b0d803a65548373bd4db3cf">InnerLoopVectorizer</a> &#123;</Highlight></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721" lineLink="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a0a9465c209525e66b0e00ff32fe4495d"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a0a9465c209525e66b0e00ff32fe4495d">InnerLoopAndEpilogueVectorizer</a>(</Highlight></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>,</Highlight></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>,</Highlight></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a238e95d82d095fec9241f2f5b81db3c5">TTI</a>, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>,</Highlight></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>, <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a> &amp;<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>,</Highlight></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;LVL, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">llvm::LoopVectorizationCostModel</a> &#42;CM,</Highlight></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>,</Highlight></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><Highlight kind="normal">      GeneratedRTChecks &amp;Checks, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>)</Highlight></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><Highlight kind="normal">      : <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6c7095217b0d803a65548373bd4db3cf">InnerLoopVectorizer</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a238e95d82d095fec9241f2f5b81db3c5">TTI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>,</Highlight></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopVF, <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopVF, <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopUF, LVL,</Highlight></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><Highlight kind="normal">                            CM, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>, Checks, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>),</Highlight></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>) &#123;&#125;</Highlight></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Override this function to handle the more complex control flow around the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// three loops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737" lineLink="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a513e6b49c17c28104aab6dc635ce86b3"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a513e6b49c17c28104aab6dc635ce86b3">createVectorizedLoopSkeleton</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SCEV2ValueTy &amp;ExpandedSCEVs) </Highlight><Highlight kind="keyword">final</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a89ba81e424489963bac21757a4687fe7">createEpilogueVectorizedLoopSkeleton</a>(ExpandedSCEVs);</Highlight></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><Highlight kind="comment">  /// The interface for creating a vectorized skeleton using one of two</Highlight></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><Highlight kind="comment">  /// different strategies, each corresponding to one execution of the vplan</Highlight></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><Highlight kind="comment">  /// as described above.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">virtual</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745" lineLink="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a89ba81e424489963bac21757a4687fe7"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a89ba81e424489963bac21757a4687fe7">createEpilogueVectorizedLoopSkeleton</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SCEV2ValueTy &amp;ExpandedSCEVs) = 0;</Highlight></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><Highlight kind="comment">  /// Holds and updates state information required to vectorize the main loop</Highlight></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><Highlight kind="comment">  /// and its epilogue in two separate passes. This setup helps us avoid</Highlight></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><Highlight kind="comment">  /// regenerating and recomputing runtime safety checks. It also helps us to</Highlight></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><Highlight kind="comment">  /// shorten the iteration-count-check path length for the cases where the</Highlight></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><Highlight kind="comment">  /// iteration count of the loop is so small that the main vector loop is</Highlight></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><Highlight kind="comment">  /// completely skipped.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753" lineLink="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a> &amp;<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>;</Highlight></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><Highlight kind="comment">/// A specialized derived class of inner loop vectorizer that performs</Highlight></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><Highlight kind="comment">/// vectorization of &#42;main&#42; loops in the process of vectorizing loops and their</Highlight></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><Highlight kind="comment">/// epilogues.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759" lineLink="/docs/api/classes/llvm/epiloguevectorizermainloop"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aacb166cc55976b03684f0d3671cf1179">EpilogueVectorizerMainLoop</a> : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a0a9465c209525e66b0e00ff32fe4495d">InnerLoopAndEpilogueVectorizer</a> &#123;</Highlight></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761" lineLink="/docs/api/classes/llvm/epiloguevectorizermainloop/#aacb166cc55976b03684f0d3671cf1179"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aacb166cc55976b03684f0d3671cf1179">EpilogueVectorizerMainLoop</a>(</Highlight></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>,</Highlight></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>,</Highlight></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>,</Highlight></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>, <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a> &amp;<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>,</Highlight></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;LVL, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">llvm::LoopVectorizationCostModel</a> &#42;CM,</Highlight></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>,</Highlight></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><Highlight kind="normal">      GeneratedRTChecks &amp;<a href="/docs/api/namespaces/llvm/check">Check</a>, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>)</Highlight></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><Highlight kind="normal">      : <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a0a9465c209525e66b0e00ff32fe4495d">InnerLoopAndEpilogueVectorizer</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>,</Highlight></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><Highlight kind="normal">                                       <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>, LVL, CM, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>, <a href="/docs/api/namespaces/llvm/check">Check</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>) &#123;&#125;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><Highlight kind="comment">  /// Implements the interface for creating a vectorized skeleton using the</Highlight></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><Highlight kind="comment">  /// &#42;main loop&#42; strategy (ie the first pass of vplan execution).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aa8b67f13fbf902634ecd95060a1cd85f">createEpilogueVectorizedLoopSkeleton</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SCEV2ValueTy &amp;ExpandedSCEVs) </Highlight><Highlight kind="keyword">final</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><Highlight kind="normal"></Highlight><Highlight kind="keyword">protected</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><Highlight kind="comment">  /// Emits an iteration count bypass check once for the main loop (when \\p</Highlight></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><Highlight kind="comment">  /// ForEpilogue is false) and once for the epilogue loop (when \\p</Highlight></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><Highlight kind="comment">  /// ForEpilogue is true).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aeeb47f904372b9e25b9f7ba606158b25">emitIterationCountCheck</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ForEpilogue);</Highlight></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aad9eb57dcbd9a2c3fd1993685783d7f7">printDebugTracesAtStart</a>() </Highlight><Highlight kind="keyword">override</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#a87a0c8bda4e9e23e896e46d0a2208c17">printDebugTracesAtEnd</a>() </Highlight><Highlight kind="keyword">override</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><Highlight kind="normal"></Highlight><Highlight kind="comment">// A specialized derived class of inner loop vectorizer that performs</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><Highlight kind="normal"></Highlight><Highlight kind="comment">// vectorization of &#42;epilogue&#42; loops in the process of vectorizing loops and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><Highlight kind="normal"></Highlight><Highlight kind="comment">// their epilogues.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788" lineLink="/docs/api/classes/llvm/epiloguevectorizerepilogueloop"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a2e73500e74115783c3ab0282829aee26">EpilogueVectorizerEpilogueLoop</a> : </Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a0a9465c209525e66b0e00ff32fe4495d">InnerLoopAndEpilogueVectorizer</a> &#123;</Highlight></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790" lineLink="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a2e73500e74115783c3ab0282829aee26"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a2e73500e74115783c3ab0282829aee26">EpilogueVectorizerEpilogueLoop</a>(</Highlight></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>,</Highlight></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>,</Highlight></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>,</Highlight></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>, <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a> &amp;<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>,</Highlight></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;LVL, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">llvm::LoopVectorizationCostModel</a> &#42;CM,</Highlight></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>,</Highlight></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><Highlight kind="normal">      GeneratedRTChecks &amp;Checks, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>)</Highlight></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><Highlight kind="normal">      : <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#a0a9465c209525e66b0e00ff32fe4495d">InnerLoopAndEpilogueVectorizer</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0e1902405fb476065f5fd61c563f3567">TLI</a>, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>,</Highlight></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><Highlight kind="normal">                                       <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>, LVL, CM, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a34df1386ff3adb63b4b4bf65409e716b">BFI</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a866b987577621ecd4c7adfebaa57de15">PSI</a>, Checks, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>) &#123;</Highlight></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0937fe0c707a3cd1198cea4467fa37c0">TripCount</a> = <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.TripCount;</Highlight></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><Highlight kind="normal">  &#125;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><Highlight kind="comment">  /// Implements the interface for creating a vectorized skeleton using the</Highlight></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><Highlight kind="comment">  /// &#42;epilogue loop&#42; strategy (ie the second pass of vplan execution).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#ad1b4c0caba0fac3a1486890cd2445040">createEpilogueVectorizedLoopSkeleton</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SCEV2ValueTy &amp;ExpandedSCEVs) </Highlight><Highlight kind="keyword">final</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><Highlight kind="normal"></Highlight><Highlight kind="keyword">protected</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><Highlight kind="comment">  /// Emits an iteration count bypass check after the main vector loop has</Highlight></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><Highlight kind="comment">  /// finished to see if there are any iterations left to execute by either</Highlight></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><Highlight kind="comment">  /// the vector epilogue or the scalar epilogue.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a04c0081718b0f5113134aa563e1a56ca">emitMinimumVectorEpilogueIterCountCheck</a>(</Highlight></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><Highlight kind="normal">                                                      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass,</Highlight></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><Highlight kind="normal">                                                      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Insert);</Highlight></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a9d4052b05414daf596711bada5c5e94b">printDebugTracesAtStart</a>() </Highlight><Highlight kind="keyword">override</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a07454ac2b11a89ba60771243779a58e4">printDebugTracesAtEnd</a>() </Highlight><Highlight kind="keyword">override</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// end namespace llvm</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><Highlight kind="comment">/// Look for a meaningful debug location on the instruction or its operands.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820" lineLink="#a29c708de8e758ac420523c94c797b501"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="#a29c708de8e758ac420523c94c797b501">getDebugLocFromInstOrOperands</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>();</Highlight></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/codeview/typehashing-cpp/#a066f917f4a73ce07260b0e4262be92ba">Empty</a>;</Highlight></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc() != <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/codeview/typehashing-cpp/#a066f917f4a73ce07260b0e4262be92ba">Empty</a>)</Highlight></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc();</Highlight></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands()) &#123;</Highlight></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OpInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</Highlight></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OpInst-&gt;getDebugLoc() != <a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/codeview/typehashing-cpp/#a066f917f4a73ce07260b0e4262be92ba">Empty</a>)</Highlight></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OpInst-&gt;getDebugLoc();</Highlight></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc();</Highlight></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><Highlight kind="comment">/// Write a \\p DebugMsg about vectorization to the debug output stream. If \\p I</Highlight></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><Highlight kind="comment">/// is passed, the message relates to that particular instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840" lineLink="#a1a861c376095fff2ee736b0a743cc44e"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a1a861c376095fff2ee736b0a743cc44e">debugVectorizationMessage</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> Prefix,</Highlight></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><Highlight kind="normal">                                      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> DebugMsg,</Highlight></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><Highlight kind="normal">                                      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; Prefix &lt;&lt; DebugMsg;</Highlight></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;.&#39;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><Highlight kind="comment">/// Create an analysis remark that explains why vectorization failed</Highlight></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><Highlight kind="comment">/// \\p PassName is the name of the pass (e.g. can be AlwaysPrint).  \\p</Highlight></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><Highlight kind="comment">/// RemarkName is the identifier for the remark.  If \\p I is passed it is an</Highlight></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><Highlight kind="comment">/// instruction that prevents vectorization.  Otherwise \\p TheLoop is used for</Highlight></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><Highlight kind="comment">/// the location of the remark. If \\p DL is passed, use it as debug location for</Highlight></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><Highlight kind="comment">/// the remark. \\return the remark object that can be streamed to.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a></Highlight></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860" lineLink="#afec6951f3043e25ada2b61437bd60725"><Highlight kind="normal"><a href="#afec6951f3043e25ada2b61437bd60725">createLVAnalysis</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86loweramxintrinsics-cpp/#adb9257105a403ef9d0773b87693f7779">PassName</a>, <a href="/docs/api/classes/llvm/stringref">StringRef</a> RemarkName, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;TheLoop,</Highlight></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><Highlight kind="normal">                 <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = &#123;&#125;) &#123;</Highlight></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CodeRegion = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> ? <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() : TheLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>();</Highlight></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If debug location is attached to the instruction, use it. Otherwise if DL</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// was not provided, use the loop&#39;s.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc())</Highlight></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc();</Highlight></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)</Highlight></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = TheLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a615131659002c10601eef598d42d025e">getStartLoc</a>();</Highlight></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a>(<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86loweramxintrinsics-cpp/#adb9257105a403ef9d0773b87693f7779">PassName</a>, RemarkName, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, CodeRegion);</Highlight></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</Highlight></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><Highlight kind="comment">/// Return a value for Step multiplied by VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876" lineLink="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e">createStepForVF</a>(<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF,</Highlight></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><Highlight kind="normal">                       int64&#95;t Step) &#123;</Highlight></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Ty-&gt;isIntegerTy() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected an integer step&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateElementCount(Ty, VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#aa5b3e822013fe51665e9bddc4874cd48">multiplyCoefficientBy</a>(Step));</Highlight></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><Highlight kind="comment">/// Return the runtime value for VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883" lineLink="/docs/api/namespaces/llvm/#a2f777e2b1044ba7971766097fdd56579"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a2f777e2b1044ba7971766097fdd56579">getRuntimeVF</a>(<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateElementCount(Ty, VF);</Highlight></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887" lineLink="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> DebugMsg,</Highlight></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><Highlight kind="normal">                                </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> OREMsg, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> ORETag,</Highlight></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><Highlight kind="normal">                                <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;TheLoop,</Highlight></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><Highlight kind="normal">                                <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="#a1a861c376095fff2ee736b0a743cc44e">debugVectorizationMessage</a>(</Highlight><Highlight kind="stringliteral">&quot;Not vectorizing: &quot;</Highlight><Highlight kind="normal">, DebugMsg, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> Hints(TheLoop, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42; doesn&#39;t matter &#42;/</Highlight><Highlight kind="normal">, &#42;ORE);</Highlight></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><Highlight kind="normal">  ORE-&gt;<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(</Highlight></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><Highlight kind="normal">      <a href="#afec6951f3043e25ada2b61437bd60725">createLVAnalysis</a>(Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#abcf8c2b35316773f1ab0ba70aeb2a6de">vectorizeAnalysisPassName</a>(), ORETag, TheLoop, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><Highlight kind="normal">      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;loop not vectorized: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; OREMsg);</Highlight></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><Highlight kind="comment">/// Reports an informative message: print \\p Msg for debugging purposes as well</Highlight></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><Highlight kind="comment">/// as an optimization remark. Uses either \\p I as location of the remark, or</Highlight></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><Highlight kind="comment">/// otherwise \\p TheLoop. If \\p DL is passed, use it as debug location for the</Highlight></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><Highlight kind="comment">/// remark. If \\p DL is passed, use it as debug location for the remark.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902" lineLink="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> Msg, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/stringref">StringRef</a> ORETag,</Highlight></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><Highlight kind="normal">                                    <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE,</Highlight></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><Highlight kind="normal">                                    <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;TheLoop, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><Highlight kind="normal">                                    <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = &#123;&#125;) &#123;</Highlight></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="#a1a861c376095fff2ee736b0a743cc44e">debugVectorizationMessage</a>(</Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, Msg, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> Hints(TheLoop, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42; doesn&#39;t matter &#42;/</Highlight><Highlight kind="normal">, &#42;ORE);</Highlight></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><Highlight kind="normal">  ORE-&gt;<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(<a href="#afec6951f3043e25ada2b61437bd60725">createLVAnalysis</a>(Hints.vectorizeAnalysisPassName(), ORETag, TheLoop,</Highlight></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><Highlight kind="normal">                             <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>)</Highlight></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><Highlight kind="normal">            &lt;&lt; Msg);</Highlight></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><Highlight kind="comment">/// Report successful vectorization of the loop. In case an outer loop is</Highlight></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><Highlight kind="comment">/// vectorized, prepend &quot;outer&quot; to the vectorization remark.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915" lineLink="/docs/api/namespaces/llvm/#a0c19b37908311872f655348755e8d003"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a0c19b37908311872f655348755e8d003">reportVectorization</a>(<a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;TheLoop,</Highlight></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><Highlight kind="normal">                                <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> VF, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IC) &#123;</Highlight></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="#a1a861c376095fff2ee736b0a743cc44e">debugVectorizationMessage</a>(</Highlight></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;Vectorizing: &quot;</Highlight><Highlight kind="normal">, TheLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a16165c1e5da45acaa086c3a54a188d34">isInnermost</a>() ? </Highlight><Highlight kind="stringliteral">&quot;innermost loop&quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;outer loop&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/stringref">StringRef</a> LoopType = TheLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a16165c1e5da45acaa086c3a54a188d34">isInnermost</a>() ? </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;outer &quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><Highlight kind="normal">  ORE-&gt;<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/optimizationremark">OptimizationRemark</a>(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>, </Highlight><Highlight kind="stringliteral">&quot;Vectorized&quot;</Highlight><Highlight kind="normal">, TheLoop-&gt;<a href="/docs/api/classes/llvm/loop/#a615131659002c10601eef598d42d025e">getStartLoc</a>(),</Highlight></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><Highlight kind="normal">                              TheLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>())</Highlight></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><Highlight kind="normal">           &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;vectorized &quot;</Highlight><Highlight kind="normal"> &lt;&lt; LoopType &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;loop (vectorization width: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><Highlight kind="normal">           &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</Highlight><Highlight kind="stringliteral">&quot;VectorizationFactor&quot;</Highlight><Highlight kind="normal">, VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>)</Highlight></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><Highlight kind="normal">           &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;, interleaved count: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</Highlight><Highlight kind="stringliteral">&quot;InterleaveCount&quot;</Highlight><Highlight kind="normal">, IC) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;)&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// end namespace llvm</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a> &#123;</Highlight></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Loop vectorization cost-model hints how the scalar epilogue loop should be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><Highlight kind="normal"></Highlight><Highlight kind="comment">// lowered.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936" lineLink="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">enum</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> &#123;</Highlight></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The default: allowing scalar epilogues.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939" lineLink="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>,</Highlight></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Vectorization with OptForSize: don&#39;t allow epilogues.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942" lineLink="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da4f61afe29426363c5cf62d4ee93199b7"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da4f61afe29426363c5cf62d4ee93199b7">CM&#95;ScalarEpilogueNotAllowedOptSize</a>,</Highlight></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A special case of vectorisation with OptForSize: loops with a very small</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// trip count are considered for vectorization under OptForSize, thereby</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// making sure the cost of their loop body is dominant, free of runtime</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// guards and scalar iteration overheads.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948" lineLink="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da0a5c3a3ea2de39aa77f3e6da8de4d5bd"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da0a5c3a3ea2de39aa77f3e6da8de4d5bd">CM&#95;ScalarEpilogueNotAllowedLowTripLoop</a>,</Highlight></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Loop hint predicate indicating an epilogue is undesired.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951" lineLink="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>,</Highlight></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Directive indicating we must either tail fold or not vectorize</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954" lineLink="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9dab8edd8f39c728bd8b0045b64768ef206"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9dab8edd8f39c728bd8b0045b64768ef206">CM&#95;ScalarEpilogueNotAllowedUsePredicate</a></Highlight></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957" lineLink="/docs/api/namespaces/llvm/#a9e0841f36570b2d07c1c1d7b3e059dad"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/#a9e0841f36570b2d07c1c1d7b3e059dad">InstructionVFPair</a> = std::pair&lt;Instruction &#42;, ElementCount&gt;;</Highlight></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><Highlight kind="comment">/// LoopVectorizationCostModel - estimates the expected speedups due to</Highlight></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><Highlight kind="comment">/// vectorization.</Highlight></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><Highlight kind="comment">/// In many cases vectorization is not profitable. This can happen because of</Highlight></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><Highlight kind="comment">/// a number of reasons. In this class we mainly attempt to predict the</Highlight></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><Highlight kind="comment">/// expected speedup/slowdowns due to the supported instruction set. We use the</Highlight></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><Highlight kind="comment">/// TargetTransformInfo to query the different backends for the cost of</Highlight></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><Highlight kind="comment">/// different operations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a405e73f32c9044b8b14648b62cb2ef30">LoopVectorizationCostModel</a> &#123;</Highlight></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a409249e01d3e65716e4c76fa3369a4e0"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">friend</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a409249e01d3e65716e4c76fa3369a4e0">LoopVectorizationPlanner</a>;</Highlight></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a405e73f32c9044b8b14648b62cb2ef30"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a405e73f32c9044b8b14648b62cb2ef30">LoopVectorizationCostModel</a>(<a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> </Highlight><Highlight kind="keywordtype">SEL</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</Highlight></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a>,</Highlight></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>,</Highlight></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><Highlight kind="normal">                             </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>,</Highlight></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><Highlight kind="normal">                             </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>, <a href="/docs/api/classes/llvm/demandedbits">DemandedBits</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a58fd764accfd06df487cc6ec43d4f5fc">DB</a>,</Highlight></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aba357162dc28acb3a399731e1e397614">AC</a>,</Highlight></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</Highlight></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><Highlight kind="normal">                             </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35e67974daa692cfd961904c151ad33d">Hints</a>,</Highlight></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/interleavedaccessinfo">InterleavedAccessInfo</a> &amp;IAI)</Highlight></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><Highlight kind="normal">      : ScalarEpilogueStatus(SEL), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>(L), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>),</Highlight></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a58fd764accfd06df487cc6ec43d4f5fc">DB</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a58fd764accfd06df487cc6ec43d4f5fc">DB</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aba357162dc28acb3a399731e1e397614">AC</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aba357162dc28acb3a399731e1e397614">AC</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>),</Highlight></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35e67974daa692cfd961904c151ad33d">Hints</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35e67974daa692cfd961904c151ad33d">Hints</a>), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7a98f0c17229446d76997f158d896aad">InterleaveInfo</a>(IAI), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>::TCK&#95;RecipThroughput) &#123;&#125;</Highlight></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><Highlight kind="comment">  /// \\return An upper bound for the vectorization factors (both fixed and</Highlight></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><Highlight kind="comment">  /// scalable). If the factors are 0, vectorization and interleaving should be</Highlight></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><Highlight kind="comment">  /// avoided up front.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/fixedscalablevfpair">FixedScalableVFPair</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a65ab4267c6c132d06451b5d97bc9ee83">computeMaxVF</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> UserIC);</Highlight></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><Highlight kind="comment">  /// \\return True if runtime checks are required for vectorization, and false</Highlight></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><Highlight kind="comment">  /// otherwise.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aad6239ca8b51657f5ebdbd6e51e6ea90">runtimeChecksRequired</a>();</Highlight></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><Highlight kind="comment">  /// Setup cost-based decisions for user vectorization factor.</Highlight></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><Highlight kind="comment">  /// \\return true if the UserVF is a feasible VF to be chosen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a885ad9ea73b97e3154433e5c37fefa99"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a885ad9ea73b97e3154433e5c37fefa99">selectUserVectorizationFactor</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF) &#123;</Highlight></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab4a3f06ac8f2aff57b864c2d8ace97d8">collectUniformsAndScalars</a>(UserVF);</Highlight></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#afcbf4a19be078644e784b539379d59b7">collectInstsToScalarize</a>(UserVF);</Highlight></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae4c50e6300599d50ba706c0d2b780502">expectedCost</a>(UserVF).<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>();</Highlight></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><Highlight kind="comment">  /// \\return The size (in bits) of the smallest and widest types in the code</Highlight></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><Highlight kind="comment">  /// that needs to be vectorized. We ignore values that remain scalar such as</Highlight></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><Highlight kind="comment">  /// 64 bit loop indices.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><Highlight kind="normal">  std::pair&lt;unsigned, unsigned&gt; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a1fa63b37ad2ac06f289e9962a3703e9e">getSmallestAndWidestTypes</a>();</Highlight></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><Highlight kind="comment">  /// \\return The desired interleave count.</Highlight></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><Highlight kind="comment">  /// If interleave count has been specified by metadata it will be returned.</Highlight></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><Highlight kind="comment">  /// Otherwise, the interleave count is computed and returned. VF and LoopCost</Highlight></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><Highlight kind="comment">  /// are the selected vectorization factor and the cost of the selected VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af9f62350ccdebd24858be552f3fc051c">selectInterleaveCount</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> LoopCost);</Highlight></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><Highlight kind="comment">  /// Memory access instruction may be vectorized in more than one way.</Highlight></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><Highlight kind="comment">  /// Form of instruction after vectorization depends on cost.</Highlight></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><Highlight kind="comment">  /// This function takes cost-based decisions for Load/Store instructions</Highlight></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><Highlight kind="comment">  /// and collects them in a map. This decisions map is used for building</Highlight></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><Highlight kind="comment">  /// the lists of loop-uniform and loop-scalar instructions.</Highlight></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><Highlight kind="comment">  /// The calculated cost is saved with widening decision in order to</Highlight></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><Highlight kind="comment">  /// avoid redundant calculations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae8d11752355845a0e271111de7be7d3a">setCostBasedWideningDecision</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><Highlight kind="comment">  /// A call may be vectorized in different ways depending on whether we have</Highlight></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><Highlight kind="comment">  /// vectorized variants available and whether the target supports masking.</Highlight></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><Highlight kind="comment">  /// This function analyzes all calls in the function at the supplied VF,</Highlight></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><Highlight kind="comment">  /// makes a decision based on the costs of available options, and stores that</Highlight></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><Highlight kind="comment">  /// decision in a map for use in planning and plan execution.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8178cc5e49d5251d7ca3413b8a434f8f">setVectorizedCallDecision</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><Highlight kind="comment">  /// A struct that represents some properties of the register usage</Highlight></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><Highlight kind="comment">  /// of a loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal"><a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage">RegisterUsage</a> &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><Highlight kind="comment">    /// Holds the number of loop invariant values that are used in the loop.</Highlight></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><Highlight kind="comment">    /// The key is ClassID of target-provided register class.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage/#a12f1d225b87b9cb583e78478d9ef3b9c"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/smallmapvector">SmallMapVector&lt;unsigned, unsigned, 4&gt;</a> <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage/#a12f1d225b87b9cb583e78478d9ef3b9c">LoopInvariantRegs</a>;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><Highlight kind="comment">    /// Holds the maximum number of concurrent live intervals in the loop.</Highlight></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><Highlight kind="comment">    /// The key is ClassID of target-provided register class.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage/#a0ae3b197ca92417681a2865b605e56a9"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/smallmapvector">SmallMapVector&lt;unsigned, unsigned, 4&gt;</a> <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage/#a0ae3b197ca92417681a2865b605e56a9">MaxLocalUsers</a>;</Highlight></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><Highlight kind="comment">  /// \\return Returns information about the register usages of the loop for the</Highlight></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><Highlight kind="comment">  /// given vectorization factors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;RegisterUsage, 8&gt;</a></Highlight></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91466f7a82e967ed765e6d876415a3b7">calculateRegisterUsage</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ElementCount&gt;</a> VFs);</Highlight></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><Highlight kind="comment">  /// Collect values we want to ignore in the cost model.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0ac5df8f0304981180d602dacb13512c">collectValuesToIgnore</a>();</Highlight></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><Highlight kind="comment">  /// Collect all element types in the loop for which widening is needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a06f5d9725a2b1f7b06e8bf51f7d31417">collectElementTypesForWidening</a>();</Highlight></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><Highlight kind="comment">  /// Split reductions into those that happen in the loop, and those that happen</Highlight></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><Highlight kind="comment">  /// outside. In loop reductions are collected into InLoopReductions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a12d2850f420726c4acb262b626e95b7d">collectInLoopReductions</a>();</Highlight></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><Highlight kind="comment">  /// Returns true if we should use strict in-order reductions for the given</Highlight></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><Highlight kind="comment">  /// RdxDesc. This is true if the -enable-strict-reductions flag is passed,</Highlight></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><Highlight kind="comment">  /// the IsOrdered flag of RdxDesc is set and we do not allow reordering</Highlight></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><Highlight kind="comment">  /// of FP operations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad508b8cfa31c0e7a1ac8f9d733bb8eed"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad508b8cfa31c0e7a1ac8f9d733bb8eed">useOrderedReductions</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35e67974daa692cfd961904c151ad33d">Hints</a>-&gt;allowReordering() &amp;&amp; RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a8dad5abc2bd929acd8391643b2dbe4c5">isOrdered</a>();</Highlight></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><Highlight kind="comment">  /// \\returns The smallest bitwidth each instruction can be represented with.</Highlight></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><Highlight kind="comment">  /// The vector equivalents of these instructions should be truncated to this</Highlight></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><Highlight kind="comment">  /// type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9fe7595d60ab8e1f3ee1da0846838113"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;Instruction &#42;, uint64&#95;t&gt;</a> &amp;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9fe7595d60ab8e1f3ee1da0846838113">getMinimalBitwidths</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MinBWs;</Highlight></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><Highlight kind="comment">  /// \\returns True if it is more profitable to scalarize instruction \\p I for</Highlight></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><Highlight kind="comment">  /// vectorization factor \\p VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9a6fbca8c965adeb8016a03ca3de2cac"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9a6fbca8c965adeb8016a03ca3de2cac">isProfitableToScalarize</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Profitable to scalarize relevant only for VF &gt; 1.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isInnermost() &amp;&amp;</Highlight></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;cost-model should not be used for outer loops (in VPlan-native path)&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Scalars = InstsToScalarize.find(VF);</Highlight></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Scalars != InstsToScalarize.end() &amp;&amp;</Highlight></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;VF not yet analyzed for scalarization profitability&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Scalars-&gt;second.contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><Highlight kind="comment">  /// Returns true if \\p I is known to be uniform after vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a20d7c96738b8f59692aec029895f8eb9"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a20d7c96738b8f59692aec029895f8eb9">isUniformAfterVectorization</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isInnermost() &amp;&amp;</Highlight></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;cost-model should not be used for outer loops (in VPlan-native path)&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Pseudo probe needs to be duplicated for each unrolled iteration and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// vector lane so that profiled loop trip count can be accurately</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// accumulated instead of being under counted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PseudoProbeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</Highlight></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> UniformsPerVF = Uniforms.find(VF);</Highlight></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(UniformsPerVF != Uniforms.end() &amp;&amp;</Highlight></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;VF not yet analyzed for uniformity&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> UniformsPerVF-&gt;second.count(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><Highlight kind="comment">  /// Returns true if \\p I is known to be scalar after vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isInnermost() &amp;&amp;</Highlight></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;cost-model should not be used for outer loops (in VPlan-native path)&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</Highlight></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ScalarsPerVF = Scalars.find(VF);</Highlight></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ScalarsPerVF != Scalars.end() &amp;&amp;</Highlight></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Scalar values are not calculated for VF&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ScalarsPerVF-&gt;second.count(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><Highlight kind="comment">  /// \\returns True if instruction \\p I can be truncated to a smaller bitwidth</Highlight></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><Highlight kind="comment">  /// for vectorization factor \\p VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa8c00664c6be2042407f13e4fcad950b"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa8c00664c6be2042407f13e4fcad950b">canTruncateToMinimalBitwidth</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; MinBWs.contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><Highlight kind="normal">           !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9a6fbca8c965adeb8016a03ca3de2cac">isProfitableToScalarize</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) &amp;&amp;</Highlight></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><Highlight kind="normal">           !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><Highlight kind="comment">  /// Decision that was taken during cost calculation for memory instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">enum</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> &#123;</Highlight></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">CM&#95;Unknown</a>,</Highlight></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260adc468760c02910f77bad7525bc66c334"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260adc468760c02910f77bad7525bc66c334">CM&#95;Widen</a>,         </Highlight><Highlight kind="comment">// For consecutive accesses with stride 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a058eacbd3c28e2ecec2af7db726ce527"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a058eacbd3c28e2ecec2af7db726ce527">CM&#95;Widen&#95;Reverse</a>, </Highlight><Highlight kind="comment">// For consecutive accesses with stride -1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971">CM&#95;Interleave</a>,</Highlight></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ae849d400780f51424bc4e4c26ddf3000"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ae849d400780f51424bc4e4c26ddf3000">CM&#95;GatherScatter</a>,</Highlight></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>,</Highlight></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ab6fd5f45ab6e363de6c3f42472d439ac"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ab6fd5f45ab6e363de6c3f42472d439ac">CM&#95;VectorCall</a>,</Highlight></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a679b46cebdf2f87b9efd0413c960314a"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a679b46cebdf2f87b9efd0413c960314a">CM&#95;IntrinsicCall</a></Highlight></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><Highlight kind="comment">  /// Save vectorization decision \\p W and \\p Cost taken by the cost model for</Highlight></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><Highlight kind="comment">  /// instruction \\p I and vector width \\p VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> W,</Highlight></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><Highlight kind="normal">                           <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>) &#123;</Highlight></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected VF &gt;=2&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><Highlight kind="normal">    WideningDecisions&#91;std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)&#93; = std::make&#95;pair(W, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>);</Highlight></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><Highlight kind="comment">  /// Save vectorization decision \\p W and \\p Cost taken by the cost model for</Highlight></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><Highlight kind="comment">  /// interleaving group \\p Grp and vector width \\p VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9c44a42299ed9e7e97200271b00e0c7a"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9c44a42299ed9e7e97200271b00e0c7a">setWideningDecision</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/interleavegroup">InterleaveGroup&lt;Instruction&gt;</a> &#42;Grp,</Highlight></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><Highlight kind="normal">                           <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> W,</Highlight></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><Highlight kind="normal">                           <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>) &#123;</Highlight></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected VF &gt;=2&quot;</Highlight><Highlight kind="normal">);</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><Highlight kind="comment">    /// Broadcast this decicion to all instructions inside the group.</Highlight></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><Highlight kind="comment">    /// When interleaving, the cost will only be assigned one instruction, the</Highlight></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><Highlight kind="comment">    /// insert position. For other cases, add the appropriate fraction of the</Highlight></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><Highlight kind="comment">    /// total cost to each instruction. This ensures accurate costs are used,</Highlight></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><Highlight kind="comment">    /// even if the insert position instruction is not used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> InsertPosCost = <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> OtherMemberCost = 0;</Highlight></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (W != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971">CM&#95;Interleave</a>)</Highlight></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><Highlight kind="normal">      OtherMemberCost = InsertPosCost = <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> / Grp-&gt;<a href="/docs/api/classes/llvm/interleavegroup/#af81c826ee51addc3321e4ef1c1934696">getNumMembers</a>();</Highlight></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><Highlight kind="normal">    ;</Highlight></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 0; Idx &lt; Grp-&gt;<a href="/docs/api/classes/llvm/interleavegroup/#a46f3b431a3121fdf53608a283bf4efec">getFactor</a>(); ++Idx) &#123;</Highlight></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Grp-&gt;<a href="/docs/api/classes/llvm/interleavegroup/#a5085afe1fa721f3ef5bf09ca7fc7537c">getMember</a>(Idx)) &#123;</Highlight></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Grp-&gt;<a href="/docs/api/classes/llvm/interleavegroup/#a8ceaf9f0ed35c1a277261b29c97e4c95">getInsertPos</a>() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><Highlight kind="normal">          WideningDecisions&#91;std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)&#93; =</Highlight></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><Highlight kind="normal">              std::make&#95;pair(W, InsertPosCost);</Highlight></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><Highlight kind="normal">          WideningDecisions&#91;std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)&#93; =</Highlight></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><Highlight kind="normal">              std::make&#95;pair(W, OtherMemberCost);</Highlight></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><Highlight kind="comment">  /// Return the cost model decision for the given instruction \\p I and vector</Highlight></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><Highlight kind="comment">  /// width \\p VF. Return CM&#95;Unknown if this instruction did not pass</Highlight></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><Highlight kind="comment">  /// through the cost modeling.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected VF to be a vector VF&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isInnermost() &amp;&amp;</Highlight></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;cost-model should not be used for outer loops (in VPlan-native path)&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><Highlight kind="normal">    std::pair&lt;Instruction &#42;, ElementCount&gt; InstOnVF = std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Itr = WideningDecisions.find(InstOnVF);</Highlight></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Itr == WideningDecisions.end())</Highlight></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">CM&#95;Unknown</a>;</Highlight></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Itr-&gt;second.first;</Highlight></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><Highlight kind="comment">  /// Return the vectorization cost for the given instruction \\p I and vector</Highlight></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><Highlight kind="comment">  /// width \\p VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#af7844564539b9f0f917e8f2380a064b3"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af7844564539b9f0f917e8f2380a064b3">getWideningCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected VF &gt;=2&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><Highlight kind="normal">    std::pair&lt;Instruction &#42;, ElementCount&gt; InstOnVF = std::make&#95;pair(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(WideningDecisions.contains(InstOnVF) &amp;&amp;</Highlight></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;The cost is not calculated&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> WideningDecisions&#91;InstOnVF&#93;.second;</Highlight></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal"><a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision">CallWideningDecision</a> &#123;</Highlight></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a970379530706280ef592e3e752195707"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a970379530706280ef592e3e752195707">Kind</a>;</Highlight></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a7d0c66f91e19821438f6111292e4988a"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a7d0c66f91e19821438f6111292e4988a">Variant</a>;</Highlight></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#af305adc2c4ab529c377feef10f4786ca"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#af305adc2c4ab529c377feef10f4786ca">IID</a>;</Highlight></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#acf57054d7a0afa002650a5f94c4a7432"><Highlight kind="normal">    std::optional&lt;unsigned&gt; <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#acf57054d7a0afa002650a5f94c4a7432">MaskPos</a>;</Highlight></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204" lineLink="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a0e22ef86d37967eea1816774c457a516"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a0e22ef86d37967eea1816774c457a516">Cost</a>;</Highlight></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8e5bf6d340d3b3f704b6398996ae51c"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8e5bf6d340d3b3f704b6398996ae51c">setCallWideningDecision</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> Kind,</Highlight></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/function">Function</a> &#42;Variant, <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID,</Highlight></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><Highlight kind="normal">                               std::optional&lt;unsigned&gt; MaskPos,</Highlight></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>) &#123;</Highlight></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected vector VF&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212"><Highlight kind="normal">    CallWideningDecisions&#91;std::make&#95;pair(CI, VF)&#93; = &#123;Kind, Variant, IID,</Highlight></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><Highlight kind="normal">                                                     MaskPos, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>&#125;;</Highlight></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa29e19b06aa800d1289048b54c58e8c6"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision">CallWideningDecision</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa29e19b06aa800d1289048b54c58e8c6">getCallWideningDecision</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI,</Highlight></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><Highlight kind="normal">                                               <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected vector VF&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CallWideningDecisions.at(std::make&#95;pair(CI, VF));</Highlight></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><Highlight kind="comment">  /// Return True if instruction \\p I is an optimizable truncate whose operand</Highlight></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><Highlight kind="comment">  /// is an induction variable. Such a truncate will be removed by adding a new</Highlight></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><Highlight kind="comment">  /// induction variable with the destination type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a61375f5189558cc261186f388d31fe92"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a61375f5189558cc261186f388d31fe92">isOptimizableIVTruncate</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the instruction is not a truncate, return false.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Trunc = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;TruncInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Trunc)</Highlight></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Get the source and destination types of the truncate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getSrcTy(), VF);</Highlight></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;DestTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CastInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getDestTy(), VF);</Highlight></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the truncate is free for the given types, return false. Replacing a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// free truncate with an induction variable would add an induction variable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// update instruction to each iteration of the loop. We exclude from this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// check the primary induction variable since it will need an update</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instruction regardless.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = Trunc-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getPrimaryInduction() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isTruncateFree(SrcTy, DestTy))</Highlight></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the truncated value is not an induction variable, return false.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInductionPhi(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><Highlight kind="comment">  /// Collects the instructions to scalarize for each predicated instruction in</Highlight></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><Highlight kind="comment">  /// the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#afcbf4a19be078644e784b539379d59b7">collectInstsToScalarize</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><Highlight kind="comment">  /// Collect Uniform and Scalar values for the given \\p VF.</Highlight></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><Highlight kind="comment">  /// The sets depend on CM decision for Load/Store instructions</Highlight></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><Highlight kind="comment">  /// that may be vectorized as interleave, gather-scatter or scalarized.</Highlight></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><Highlight kind="comment">  /// Also make a decision on what to do about call instructions in the loop</Highlight></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><Highlight kind="comment">  /// at that VF -- scalarize, call a known vector routine, or call a</Highlight></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><Highlight kind="comment">  /// vector intrinsic.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab4a3f06ac8f2aff57b864c2d8ace97d8"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab4a3f06ac8f2aff57b864c2d8ace97d8">collectUniformsAndScalars</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Do the analysis once.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || Uniforms.contains(VF))</Highlight></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae8d11752355845a0e271111de7be7d3a">setCostBasedWideningDecision</a>(VF);</Highlight></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><Highlight kind="normal">    collectLoopUniforms(VF);</Highlight></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8178cc5e49d5251d7ca3413b8a434f8f">setVectorizedCallDecision</a>(VF);</Highlight></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><Highlight kind="normal">    collectLoopScalars(VF);</Highlight></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><Highlight kind="comment">  /// Returns true if the target machine supports masked store operation</Highlight></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><Highlight kind="comment">  /// for the given \\p DataType and kind of access to \\p Ptr.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c25146329f69e026508656cfb1280fa"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c25146329f69e026508656cfb1280fa">isLegalMaskedStore</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;DataType, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/structs/llvm/align">Align</a> Alignment)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isConsecutivePtr(DataType, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><Highlight kind="normal">           <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedStore(DataType, Alignment);</Highlight></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><Highlight kind="comment">  /// Returns true if the target machine supports masked load operation</Highlight></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><Highlight kind="comment">  /// for the given \\p DataType and kind of access to \\p Ptr.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a472c49074b0d81970f8eea07de4d7ad4"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a472c49074b0d81970f8eea07de4d7ad4">isLegalMaskedLoad</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;DataType, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/structs/llvm/align">Align</a> Alignment)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isConsecutivePtr(DataType, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><Highlight kind="normal">           <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedLoad(DataType, Alignment);</Highlight></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><Highlight kind="comment">  /// Returns true if the target machine can represent \\p V as a masked gather</Highlight></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><Highlight kind="comment">  /// or scatter operation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa650124eefba1fd45866d05306385129"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa650124eefba1fd45866d05306385129">isLegalGatherOrScatter</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a> = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(V);</Highlight></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(V);</Highlight></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a> &amp;&amp; !<a href="/docs/api/namespaces/llvm/si">SI</a>)</Highlight></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Ty = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(V);</Highlight></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/align">Align</a> <a href="/docs/api/structs/llvm/align">Align</a> = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(V);</Highlight></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>())</Highlight></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><Highlight kind="normal">      Ty = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Ty, VF);</Highlight></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a> &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedGather(Ty, <a href="/docs/api/structs/llvm/align">Align</a>)) ||</Highlight></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><Highlight kind="normal">           (<a href="/docs/api/namespaces/llvm/si">SI</a> &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedScatter(Ty, <a href="/docs/api/structs/llvm/align">Align</a>));</Highlight></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><Highlight kind="comment">  /// Returns true if the target machine supports all of the reduction</Highlight></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><Highlight kind="comment">  /// variables found for the given VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a07515d0542b797be2d1c87d4359ff8f6"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a07515d0542b797be2d1c87d4359ff8f6">canVectorizeReductions</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars(), &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><Highlight kind="normal">      const RecurrenceDescriptor &amp;RdxDesc = Reduction.second;</Highlight></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><Highlight kind="normal">      return TTI.isLegalToVectorizeReduction(RdxDesc, VF);</Highlight></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><Highlight kind="normal">    &#125;));</Highlight></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><Highlight kind="comment">  /// Given costs for both strategies, return true if the scalar predication</Highlight></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><Highlight kind="comment">  /// lowering should be used for div/rem.  This incorporates an override</Highlight></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><Highlight kind="comment">  /// option so it is not simply a cost comparison.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#add43c346a11ae1deb49142ba968eb07e"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#add43c346a11ae1deb49142ba968eb07e">isDivRemScalarWithPredication</a>(<a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarCost,</Highlight></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><Highlight kind="normal">                                     <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> SafeDivisorCost)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="#ad69cf8bf5c6b79c5642327ecb6be38cd">ForceSafeDivisor</a>) &#123;</Highlight></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/cl/#a9241f2e42b7587b123c885d7a659ad44aa5bd521ebe67ddf0e90f1a9e540a6d43">cl::BOU&#95;UNSET</a>:</Highlight></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ScalarCost &lt; SafeDivisorCost;</Highlight></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/cl/#a9241f2e42b7587b123c885d7a659ad44ad7c4bd83c337c86d34f6c2d8eba1e736">cl::BOU&#95;TRUE</a>:</Highlight></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/cl/#a9241f2e42b7587b123c885d7a659ad44a4e55599a5b5277382b14e6e8eb1f63ef">cl::BOU&#95;FALSE</a>:</Highlight></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;impossible case value&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><Highlight kind="comment">  /// Returns true if \\p I is an instruction which requires predication and</Highlight></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><Highlight kind="comment">  /// for which our chosen predication strategy is scalarization (i.e. we</Highlight></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><Highlight kind="comment">  /// don&#39;t have an alternate strategy such as masking available).</Highlight></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><Highlight kind="comment">  /// \\p VF is the vectorization factor that will be used to vectorize \\p I.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8">isScalarWithPredication</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><Highlight kind="comment">  /// Returns true if \\p I is an instruction that needs to be predicated</Highlight></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><Highlight kind="comment">  /// at runtime.  The result is independent of the predication mechanism.</Highlight></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><Highlight kind="comment">  /// Superset of instructions that return true for isScalarWithPredication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">isPredicatedInst</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><Highlight kind="comment">  /// Return the costs for our two available strategies for lowering a</Highlight></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><Highlight kind="comment">  /// div/rem operation which requires speculating at least one lane.</Highlight></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><Highlight kind="comment">  /// First result is for scalarization (will be invalid for scalable</Highlight></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><Highlight kind="comment">  /// vectors); second is for the safe-divisor strategy.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><Highlight kind="normal">  std::pair&lt;InstructionCost, InstructionCost&gt;</Highlight></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad8398a35cd187d6a75b460fcf54b5236">getDivRemSpeculationCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><Highlight kind="normal">                           <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><Highlight kind="comment">  /// Returns true if \\p I is a memory instruction with consecutive memory</Highlight></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><Highlight kind="comment">  /// access that can be widened.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a59a6dd7531c8683174f886ff7698cc63">memoryInstructionCanBeWidened</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><Highlight kind="comment">  /// Returns true if \\p I is a memory instruction in an interleaved-group</Highlight></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><Highlight kind="comment">  /// of memory accesses that can be vectorized with wide vector loads/stores</Highlight></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><Highlight kind="comment">  /// and shuffles.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5964ce9ba38fe5a4d372242ac39e3f1d">interleavedAccessCanBeWidened</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><Highlight kind="comment">  /// Check if \\p Instr belongs to any interleaved access group.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85e3110b9fe54caf00fe4297d1b4f0b6"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85e3110b9fe54caf00fe4297d1b4f0b6">isAccessInterleaved</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7a98f0c17229446d76997f158d896aad">InterleaveInfo</a>.isInterleaved(Instr);</Highlight></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><Highlight kind="comment">  /// Get the interleaved access group that \\p Instr belongs to.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/interleavegroup">InterleaveGroup&lt;Instruction&gt;</a> &#42;</Highlight></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c">getInterleavedAccessGroup</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7a98f0c17229446d76997f158d896aad">InterleaveInfo</a>.getInterleaveGroup(Instr);</Highlight></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><Highlight kind="comment">  /// Returns true if we&#39;re required to use a scalar epilogue for at least</Highlight></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><Highlight kind="comment">  /// the final iteration of the original loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a913ab9c8291000dd3a1c3739194b03e4"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a913ab9c8291000dd3a1c3739194b03e4">requiresScalarEpilogue</a>(</Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsVectorizing)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af67062c22dbf5e0ab35164a778768476">isScalarEpilogueAllowed</a>()) &#123;</Highlight></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Loop does not require scalar epilogue\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we might exit from anywhere but the latch and early exit vectorization</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is disabled, we must run the exiting iteration in scalar form.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getExitingBlock() != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getLoopLatch() &amp;&amp;</Highlight></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><Highlight kind="normal">        !(<a href="#af7af1b4bf03205c80dcba0a6324c4f21">EnableEarlyExitVectorization</a> &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;hasUncountableEarlyExit())) &#123;</Highlight></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Loop requires scalar epilogue: not exiting &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><Highlight kind="normal">                           </Highlight><Highlight kind="stringliteral">&quot;from latch block\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsVectorizing &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7a98f0c17229446d76997f158d896aad">InterleaveInfo</a>.requiresScalarEpilogue()) &#123;</Highlight></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Loop requires scalar epilogue: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><Highlight kind="normal">                           </Highlight><Highlight kind="stringliteral">&quot;interleaved group requires scalar epilogue\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Loop does not require scalar epilogue\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><Highlight kind="comment">  /// Returns true if we&#39;re required to use a scalar epilogue for at least</Highlight></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><Highlight kind="comment">  /// the final iteration of the original loop for all VFs in \\p Range.</Highlight></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><Highlight kind="comment">  /// A scalar epilogue must either be required for all VFs in \\p Range or for</Highlight></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><Highlight kind="comment">  /// none.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a08599d322c8160c0412192455bbfb3c2"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a08599d322c8160c0412192455bbfb3c2">requiresScalarEpilogue</a>(<a href="/docs/api/structs/llvm/vfrange">VFRange</a> <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> RequiresScalarEpilogue = &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a913ab9c8291000dd3a1c3739194b03e4">requiresScalarEpilogue</a>(VF.isVector());</Highlight></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsRequired = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>, RequiresScalarEpilogue);</Highlight></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395"><Highlight kind="normal">        (IsRequired || <a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>, RequiresScalarEpilogue)) &amp;&amp;</Highlight></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;all VFs in range must agree on whether a scalar epilogue is required&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> IsRequired;</Highlight></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><Highlight kind="comment">  /// Returns true if a scalar epilogue is not allowed due to optsize or a</Highlight></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401"><Highlight kind="comment">  /// loop hint annotation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#af67062c22dbf5e0ab35164a778768476"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af67062c22dbf5e0ab35164a778768476">isScalarEpilogueAllowed</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ScalarEpilogueStatus == <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>;</Highlight></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><Highlight kind="comment">  /// Returns the TailFoldingStyle that is best for the current loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a738b994c87e0e816cf5f323e0e2b6c07"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a738b994c87e0e816cf5f323e0e2b6c07">getTailFoldingStyle</a>(</Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IVUpdateMayOverflow = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ChosenTailFoldingStyle)</Highlight></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>;</Highlight></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> IVUpdateMayOverflow ? ChosenTailFoldingStyle-&gt;first</Highlight></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><Highlight kind="normal">                               : ChosenTailFoldingStyle-&gt;second;</Highlight></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><Highlight kind="comment">  /// Selects and saves TailFoldingStyle for 2 options - if IV update may</Highlight></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><Highlight kind="comment">  /// overflow or not.</Highlight></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><Highlight kind="comment">  /// \\param IsScalableVF true if scalable vector factors enabled.</Highlight></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><Highlight kind="comment">  /// \\param UserIC User specific interleave count.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8eb89837d2853e4853ea14379ae3972"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8eb89837d2853e4853ea14379ae3972">setTailFoldingStyles</a>(</Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsScalableVF, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> UserIC) &#123;</Highlight></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!ChosenTailFoldingStyle &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Tail folding must not be selected yet.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;canFoldTailByMasking()) &#123;</Highlight></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><Highlight kind="normal">      ChosenTailFoldingStyle =</Highlight></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><Highlight kind="normal">          std::make&#95;pair(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>, <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>);</Highlight></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a8959791a22c7d3cfb4136777fd244535">ForceTailFoldingStyle</a>.getNumOccurrences()) &#123;</Highlight></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><Highlight kind="normal">      ChosenTailFoldingStyle = std::make&#95;pair(</Highlight></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getPreferredTailFoldingStyle(</Highlight><Highlight kind="comment">/&#42;IVUpdateMayOverflow=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getPreferredTailFoldingStyle(</Highlight><Highlight kind="comment">/&#42;IVUpdateMayOverflow=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Set styles when forced.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><Highlight kind="normal">    ChosenTailFoldingStyle = std::make&#95;pair(<a href="#a8959791a22c7d3cfb4136777fd244535">ForceTailFoldingStyle</a>.getValue(),</Highlight></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><Highlight kind="normal">                                            <a href="#a8959791a22c7d3cfb4136777fd244535">ForceTailFoldingStyle</a>.getValue());</Highlight></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a8959791a22c7d3cfb4136777fd244535">ForceTailFoldingStyle</a> != <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6ae67872a709ea2e3175802518fc4e71">TailFoldingStyle::DataWithEVL</a>)</Highlight></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Override forced styles if needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: use actual opcode/data type for analysis here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: Investigate opportunity for fixed vector factor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FIXME: support fixed-order recurrences by fixing splice of non VFxUF</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// penultimate EVL.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> EVLIsLegal =</Highlight></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><Highlight kind="normal">        UserIC &lt;= 1 &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.hasActiveVectorLength(0, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, <a href="/docs/api/structs/llvm/align">Align</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a> &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getFixedOrderRecurrences().empty();</Highlight></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!EVLIsLegal) &#123;</Highlight></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If for some reason EVL mode is unsupported, fallback to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// DataWithoutLaneMask to try to vectorize the loop with folded tail</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// in a generic way.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><Highlight kind="normal">      ChosenTailFoldingStyle =</Highlight></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><Highlight kind="normal">          std::make&#95;pair(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddadfca60932ecfe430f86d4ecde04e13ab">TailFoldingStyle::DataWithoutLaneMask</a>,</Highlight></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><Highlight kind="normal">                         <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddadfca60932ecfe430f86d4ecde04e13ab">TailFoldingStyle::DataWithoutLaneMask</a>);</Highlight></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</Highlight></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><Highlight kind="normal">          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Preference for VP intrinsics indicated. Will &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;not try to generate VP Intrinsics &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><Highlight kind="normal">          &lt;&lt; (UserIC &gt; 1</Highlight></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><Highlight kind="normal">                  ? </Highlight><Highlight kind="stringliteral">&quot;since interleave count specified is greater than 1.\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><Highlight kind="normal">                  : </Highlight><Highlight kind="stringliteral">&quot;due to non-interleaving reasons.\\n&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><Highlight kind="comment">  /// Returns true if all loop blocks should be masked to fold tail loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba">foldTailByMasking</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: check if it is possible to check for None style independent of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// IVUpdateMayOverflow flag in getTailFoldingStyle.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a738b994c87e0e816cf5f323e0e2b6c07">getTailFoldingStyle</a>() != <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>;</Highlight></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><Highlight kind="comment">  /// Return maximum safe number of elements to be processed per vector</Highlight></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><Highlight kind="comment">  /// iteration, which do not prevent store-load forwarding and are safe with</Highlight></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><Highlight kind="comment">  /// regard to the memory dependencies. Required for EVL-based VPlans to</Highlight></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><Highlight kind="comment">  /// correctly calculate AVL (application vector length) as min(remaining AVL,</Highlight></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><Highlight kind="comment">  /// MaxSafeElements).</Highlight></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><Highlight kind="comment">  /// TODO: need to consider adjusting cost model to use this value as a</Highlight></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><Highlight kind="comment">  /// vectorization factor for EVL-based vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a36ed7dfdcdc1bca9eea99fc741511590"><Highlight kind="normal">  std::optional&lt;unsigned&gt; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a36ed7dfdcdc1bca9eea99fc741511590">getMaxSafeElements</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MaxSafeElements; &#125;</Highlight></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><Highlight kind="comment">  /// Returns true if the instructions in this block requires predication</Highlight></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><Highlight kind="comment">  /// for any reason, e.g. because tail folding now requires a predicate</Highlight></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><Highlight kind="comment">  /// or because the block in the original loop was predicated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8c8de8f62b5d2b27c4878d3effd7273"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8c8de8f62b5d2b27c4878d3effd7273">blockNeedsPredicationForAnyReason</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba">foldTailByMasking</a>() || <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;blockNeedsPredication(BB);</Highlight></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><Highlight kind="comment">  /// Returns true if VP intrinsics with explicit vector length support should</Highlight></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><Highlight kind="comment">  /// be generated in the tail folded loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab0c7e793ca1b6b8a4f8c00a1bc1cb32f"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab0c7e793ca1b6b8a4f8c00a1bc1cb32f">foldTailWithEVL</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a738b994c87e0e816cf5f323e0e2b6c07">getTailFoldingStyle</a>() == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6ae67872a709ea2e3175802518fc4e71">TailFoldingStyle::DataWithEVL</a>;</Highlight></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><Highlight kind="comment">  /// Returns true if the Phi is part of an inloop reduction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9819226a3ff242635fd99bf22b50bd97"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9819226a3ff242635fd99bf22b50bd97">isInLoopReduction</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> InLoopReductions.contains(Phi);</Highlight></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><Highlight kind="comment">  /// Returns true if the predicated reduction select should be used to set the</Highlight></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><Highlight kind="comment">  /// incoming value for the reduction phi.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a23c31233960bfc62d1cc93bb4a5f5148"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a23c31233960bfc62d1cc93bb4a5f5148">usePredicatedReductionSelect</a>(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Opcode, <a href="/docs/api/classes/llvm/type">Type</a> &#42;PhiTy)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Force to use predicated reduction select since the EVL of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// second-to-last iteration might not be VF&#42;UF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab0c7e793ca1b6b8a4f8c00a1bc1cb32f">foldTailWithEVL</a>())</Highlight></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a927ef1cfd7c981c5b9b9e8c67b1d13c3">PreferPredicatedReductionSelect</a> ||</Highlight></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><Highlight kind="normal">           <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.preferPredicatedReductionSelect(</Highlight></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><Highlight kind="normal">               Opcode, PhiTy, <a href="/docs/api/structs/llvm/targettransforminfo/reductionflags">TargetTransformInfo::ReductionFlags</a>());</Highlight></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><Highlight kind="comment">  /// Estimate cost of an intrinsic call instruction CI if it were vectorized</Highlight></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><Highlight kind="comment">  /// with factor VF.  Return the cost of the instruction, including</Highlight></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><Highlight kind="comment">  /// scalarization overhead if it&#39;s needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5abced3ab870d7abf57f2b35a02cd041">getVectorIntrinsicCost</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><Highlight kind="comment">  /// Estimate cost of a call instruction CI if it were vectorized with factor</Highlight></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><Highlight kind="comment">  /// VF. Return the cost of the instruction, including scalarization overhead</Highlight></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><Highlight kind="comment">  /// if it&#39;s needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad1f0755693a05c2b008e9a576c3b162b">getVectorCallCost</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><Highlight kind="comment">  /// Invalidates decisions already taken by the cost model.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85afe07533e500a31222b17f80b540fe"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85afe07533e500a31222b17f80b540fe">invalidateCostModelingDecisions</a>() &#123;</Highlight></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><Highlight kind="normal">    WideningDecisions.clear();</Highlight></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><Highlight kind="normal">    CallWideningDecisions.clear();</Highlight></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><Highlight kind="normal">    Uniforms.clear();</Highlight></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><Highlight kind="normal">    Scalars.clear();</Highlight></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><Highlight kind="comment">  /// Returns the expected execution cost. The unit of the cost does</Highlight></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><Highlight kind="comment">  /// not matter because we use the &#39;cost&#39; units to compare different</Highlight></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><Highlight kind="comment">  /// vector widths. The cost that is returned is &#42;not&#42; normalized by</Highlight></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><Highlight kind="comment">  /// the factor width.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae4c50e6300599d50ba706c0d2b780502">expectedCost</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0aa9aa5d09f2f30c5a62a4692e5a21e3"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0aa9aa5d09f2f30c5a62a4692e5a21e3">hasPredStores</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NumPredStores &gt; 0; &#125;</Highlight></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><Highlight kind="comment">  /// Returns true if epilogue vectorization is considered profitable, and</Highlight></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><Highlight kind="comment">  /// false otherwise.</Highlight></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><Highlight kind="comment">  /// \\p VF is the vectorization factor chosen for the original loop.</Highlight></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><Highlight kind="comment">  /// \\p Multiplier is an aditional scaling factor applied to VF before</Highlight></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><Highlight kind="comment">  /// comparing to EpilogueVectorizationMinVF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a07db8a5919c9879e3327549f20cda2f9">isEpilogueVectorizationProfitable</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF,</Highlight></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><Highlight kind="normal">                                         </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IC) </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><Highlight kind="comment">  /// Returns the execution time cost of an instruction for a given vector</Highlight></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><Highlight kind="comment">  /// width. Vector width of one means scalar.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a556ec90a0fa1e168a9f22db1deb1fee6">getInstructionCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><Highlight kind="comment">  /// Return the cost of instructions in an inloop reduction pattern, if I is</Highlight></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><Highlight kind="comment">  /// part of that pattern.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><Highlight kind="normal">  std::optional&lt;InstructionCost&gt; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4e307866e6d65e87d1e6884b0d13306c">getReductionPatternCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><Highlight kind="normal">                                                         <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF,</Highlight></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><Highlight kind="normal">                                                         <a href="/docs/api/classes/llvm/type">Type</a> &#42;VectorTy) </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><Highlight kind="comment">  /// Returns true if \\p Op should be considered invariant and if it is</Highlight></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><Highlight kind="comment">  /// trivially hoistable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aadd9a9d699ede62468422c7cfab66e99">shouldConsiderInvariant</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><Highlight kind="normal"></Highlight><Highlight kind="keyword">private</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumPredStores = 0;</Highlight></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><Highlight kind="comment">  /// \\return An upper bound for the vectorization factors for both</Highlight></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><Highlight kind="comment">  /// fixed and scalable vectorization, where the minimum-known number of</Highlight></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><Highlight kind="comment">  /// elements is a power-of-2 larger than zero. If scalable vectorization is</Highlight></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><Highlight kind="comment">  /// disabled or unsupported, then the scalable part will be equal to</Highlight></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><Highlight kind="comment">  /// ElementCount::getScalable(0).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/fixedscalablevfpair">FixedScalableVFPair</a> computeFeasibleMaxVF(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxTripCount,</Highlight></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><Highlight kind="normal">                                           <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF,</Highlight></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><Highlight kind="normal">                                           </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> FoldTailByMasking);</Highlight></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><Highlight kind="comment">  /// \\return the maximized element count based on the targets vector</Highlight></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><Highlight kind="comment">  /// registers and the loop trip-count, but limited to a maximum safe VF.</Highlight></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><Highlight kind="comment">  /// This is a helper function of computeFeasibleMaxVF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> getMaximizedVFForTarget(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxTripCount,</Highlight></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><Highlight kind="normal">                                       </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SmallestType,</Highlight></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><Highlight kind="normal">                                       </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> WidestType,</Highlight></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><Highlight kind="normal">                                       <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MaxSafeVF,</Highlight></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><Highlight kind="normal">                                       </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> FoldTailByMasking);</Highlight></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><Highlight kind="comment">  /// Checks if scalable vectorization is supported and enabled. Caches the</Highlight></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><Highlight kind="comment">  /// result to avoid repeated debug dumps for repeated queries.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> isScalableVectorizationAllowed();</Highlight></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><Highlight kind="comment">  /// \\return the maximum legal scalable VF, based on the safe max number</Highlight></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><Highlight kind="comment">  /// of elements.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> getMaxLegalScalableVF(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxSafeElements);</Highlight></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><Highlight kind="comment">  /// Calculate vectorization cost of memory instruction \\p I.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> getMemoryInstructionCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><Highlight kind="comment">  /// The cost computation for scalarized memory instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> getMemInstScalarizationCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><Highlight kind="comment">  /// The cost computation for interleaving group of memory instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> getInterleaveGroupCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><Highlight kind="comment">  /// The cost computation for Gather/Scatter instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> getGatherScatterCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><Highlight kind="comment">  /// The cost computation for widening instruction \\p I with consecutive</Highlight></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><Highlight kind="comment">  /// memory access.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> getConsecutiveMemOpCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><Highlight kind="comment">  /// The cost calculation for Load/Store instruction \\p I with uniform pointer -</Highlight></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><Highlight kind="comment">  /// Load: scalar load + broadcast.</Highlight></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><Highlight kind="comment">  /// Store: scalar store + (loop invariant value stored? 0 : extract of last</Highlight></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><Highlight kind="comment">  /// element)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> getUniformMemOpCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><Highlight kind="comment">  /// Estimate the overhead of scalarizing an instruction. This is a</Highlight></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><Highlight kind="comment">  /// convenience wrapper for the type-based getScalarizationOverhead API.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> getScalarizationOverhead(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><Highlight kind="normal">                                           <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><Highlight kind="comment">  /// Returns true if an artificially high cost for emulated masked memrefs</Highlight></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><Highlight kind="comment">  /// should be used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> useEmulatedMaskMemRefHack(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><Highlight kind="comment">  /// Map of scalar integer values to the smallest bitwidth they can be legally</Highlight></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><Highlight kind="comment">  /// represented as. The vector equivalents of these values should be truncated</Highlight></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><Highlight kind="comment">  /// to this type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;Instruction &#42;, uint64&#95;t&gt;</a> MinBWs;</Highlight></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><Highlight kind="comment">  /// A type representing the costs for instructions if they were to be</Highlight></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><Highlight kind="comment">  /// scalarized rather than vectorized. The entries are Instruction-Cost</Highlight></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><Highlight kind="comment">  /// pairs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal">ScalarCostsTy = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Instruction &#42;, InstructionCost&gt;</a>;</Highlight></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><Highlight kind="comment">  /// A set containing all BasicBlocks that are known to present after</Highlight></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><Highlight kind="comment">  /// vectorization as a predicated block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;ElementCount, SmallPtrSet&lt;BasicBlock &#42;, 4&gt;</a>&gt;</Highlight></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><Highlight kind="normal">      PredicatedBBsAfterVectorization;</Highlight></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><Highlight kind="comment">  /// Records whether it is allowed to have the original scalar loop execute at</Highlight></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><Highlight kind="comment">  /// least once. This may be needed as a fallback loop in case runtime</Highlight></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><Highlight kind="comment">  /// aliasing/dependence checks fail, or to handle the tail/remainder</Highlight></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><Highlight kind="comment">  /// iterations when the trip count is unknown or doesn&#39;t divide by the VF,</Highlight></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><Highlight kind="comment">  /// or as a peel-loop to handle gaps in interleave-groups.</Highlight></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><Highlight kind="comment">  /// Under optsize and when the trip count is very small we don&#39;t allow any</Highlight></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><Highlight kind="comment">  /// iterations to execute in the scalar loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> ScalarEpilogueStatus = <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>;</Highlight></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><Highlight kind="comment">  /// Control finally chosen tail folding style. The first element is used if</Highlight></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><Highlight kind="comment">  /// the IV update may overflow, the second element - if it does not.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><Highlight kind="normal">  std::optional&lt;std::pair&lt;TailFoldingStyle, TailFoldingStyle&gt;&gt;</Highlight></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><Highlight kind="normal">      ChosenTailFoldingStyle;</Highlight></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><Highlight kind="comment">  /// true if scalable vectorization is supported and enabled.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><Highlight kind="normal">  std::optional&lt;bool&gt; IsScalableVectorizationAllowed;</Highlight></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><Highlight kind="comment">  /// Maximum safe number of elements to be processed per vector iteration,</Highlight></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><Highlight kind="comment">  /// which do not prevent store-load forwarding and are safe with regard to the</Highlight></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><Highlight kind="comment">  /// memory dependencies. Required for EVL-based veectorization, where this</Highlight></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><Highlight kind="comment">  /// value is used as the upper bound of the safe AVL.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><Highlight kind="normal">  std::optional&lt;unsigned&gt; MaxSafeElements;</Highlight></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><Highlight kind="comment">  /// A map holding scalar costs for different vectorization factors. The</Highlight></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><Highlight kind="comment">  /// presence of a cost for an instruction in the mapping indicates that the</Highlight></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><Highlight kind="comment">  /// instruction will be scalarized when vectorizing with the associated</Highlight></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><Highlight kind="comment">  /// vectorization factor. The entries are VF-ScalarCostTy pairs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;ElementCount, ScalarCostsTy&gt;</a> InstsToScalarize;</Highlight></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><Highlight kind="comment">  /// Holds the instructions known to be uniform after vectorization.</Highlight></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><Highlight kind="comment">  /// The data is collected per VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;ElementCount, SmallPtrSet&lt;Instruction &#42;, 4&gt;</a>&gt; Uniforms;</Highlight></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><Highlight kind="comment">  /// Holds the instructions known to be scalar after vectorization.</Highlight></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><Highlight kind="comment">  /// The data is collected per VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;ElementCount, SmallPtrSet&lt;Instruction &#42;, 4&gt;</a>&gt; Scalars;</Highlight></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><Highlight kind="comment">  /// Holds the instructions (address computations) that are forced to be</Highlight></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><Highlight kind="comment">  /// scalarized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;ElementCount, SmallPtrSet&lt;Instruction &#42;, 4&gt;</a>&gt; ForcedScalars;</Highlight></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><Highlight kind="comment">  /// PHINodes of the reductions that should be expanded in-loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;PHINode &#42;, 4&gt;</a> InLoopReductions;</Highlight></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><Highlight kind="comment">  /// A Map of inloop reduction operations and their immediate chain operand.</Highlight></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><Highlight kind="comment">  /// FIXME: This can be removed once reductions can be costed correctly in</Highlight></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><Highlight kind="comment">  /// VPlan. This was added to allow quick lookup of the inloop operations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;Instruction &#42;, Instruction &#42;&gt;</a> InLoopReductionImmediateChains;</Highlight></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><Highlight kind="comment">  /// Returns the expected difference in cost from scalarizing the expression</Highlight></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><Highlight kind="comment">  /// feeding a predicated instruction \\p PredInst. The instructions to</Highlight></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><Highlight kind="comment">  /// scalarize and their scalar costs are collected in \\p ScalarCosts. A</Highlight></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><Highlight kind="comment">  /// non-negative return value implies the expression will be scalarized.</Highlight></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><Highlight kind="comment">  /// Currently, only single-use chains are considered for scalarization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> computePredInstDiscount(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PredInst,</Highlight></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><Highlight kind="normal">                                          ScalarCostsTy &amp;ScalarCosts,</Highlight></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><Highlight kind="comment">  /// Collect the instructions that are uniform after vectorization. An</Highlight></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><Highlight kind="comment">  /// instruction is uniform if we represent it with a single scalar value in</Highlight></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><Highlight kind="comment">  /// the vectorized loop corresponding to each vector iteration. Examples of</Highlight></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><Highlight kind="comment">  /// uniform instructions include pointer operands of consecutive or</Highlight></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><Highlight kind="comment">  /// interleaved memory accesses. Note that although uniformity implies an</Highlight></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><Highlight kind="comment">  /// instruction will be scalar, the reverse is not true. In general, a</Highlight></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><Highlight kind="comment">  /// scalarized instruction will be represented by VF scalar values in the</Highlight></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><Highlight kind="comment">  /// vectorized loop, each corresponding to an iteration of the original</Highlight></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><Highlight kind="comment">  /// scalar loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> collectLoopUniforms(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><Highlight kind="comment">  /// Collect the instructions that are scalar after vectorization. An</Highlight></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><Highlight kind="comment">  /// instruction is scalar if it is known to be uniform or will be scalarized</Highlight></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><Highlight kind="comment">  /// during vectorization. collectLoopScalars should only add non-uniform nodes</Highlight></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><Highlight kind="comment">  /// to the list if they are used by a load/store instruction that is marked as</Highlight></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><Highlight kind="comment">  /// CM&#95;Scalarize. Non-uniform scalarized instructions will be represented by</Highlight></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><Highlight kind="comment">  /// VF values in the vectorized loop, each corresponding to an iteration of</Highlight></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><Highlight kind="comment">  /// the original scalar loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> collectLoopScalars(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF);</Highlight></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><Highlight kind="comment">  /// Keeps cost model vectorization decision and cost for instructions.</Highlight></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><Highlight kind="comment">  /// Right now it is used for memory instructions only.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal">DecisionList = <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;std::pair&lt;Instruction &#42;, ElementCount&gt;</a>,</Highlight></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><Highlight kind="normal">                                std::pair&lt;InstWidening, InstructionCost&gt;&gt;;</Highlight></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><Highlight kind="normal">  DecisionList WideningDecisions;</Highlight></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal">CallDecisionList =</Highlight></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;std::pair&lt;CallInst &#42;, ElementCount&gt;</a>, CallWideningDecision&gt;;</Highlight></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><Highlight kind="normal">  CallDecisionList CallWideningDecisions;</Highlight></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><Highlight kind="comment">  /// Returns true if \\p V is expected to be vectorized and it needs to be</Highlight></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><Highlight kind="comment">  /// extracted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> needsExtract(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</Highlight></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</Highlight></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;<a href="/docs/api/classes/llvm/loop/#a6cb6a58fb0ded82b4c7755fc4c27c86d">isLoopInvariant</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</Highlight></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>)</Highlight></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Assume we can vectorize V (and hence we need extraction) if the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// scalars are not computed yet. This can happen, because it is called</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// via getScalarizationOverhead from setCostBasedWideningDecision, before</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the scalars are collected. That should be a safe assumption in most</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// cases, because we check if the operands have vectorizable types</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// beforehand in LoopVectorizationLegality.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !Scalars.<a href="/docs/api/classes/llvm/densemapbase/#a836d9cba6deced0bb1fa7333ce5afd3a">contains</a>(VF) || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><Highlight kind="comment">  /// Returns a range containing only operands needing to be extracted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> filterExtractingOperands(<a href="/docs/api/classes/llvm/user/#a917548288129e24325af275795e4622f">Instruction::op&#95;range</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>,</Highlight></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><Highlight kind="normal">                                                   <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a>(<a href="/docs/api/namespaces/llvm/#a898e9304cf2baf908f4e9b8e32a5f6c3">make&#95;filter&#95;range</a>(</Highlight></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, VF&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> this-&gt;needsExtract(V, VF); &#125;));</Highlight></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><Highlight kind="comment">  /// The loop that we evaluate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>;</Highlight></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><Highlight kind="comment">  /// Predicated scalar evolution analysis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>;</Highlight></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><Highlight kind="comment">  /// Loop Info analysis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a>;</Highlight></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><Highlight kind="comment">  /// Vectorization legality.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>;</Highlight></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><Highlight kind="comment">  /// Vector target information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>;</Highlight></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><Highlight kind="comment">  /// Target Library Info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>;</Highlight></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><Highlight kind="comment">  /// Demanded bits analysis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a58fd764accfd06df487cc6ec43d4f5fc"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/demandedbits">DemandedBits</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a58fd764accfd06df487cc6ec43d4f5fc">DB</a>;</Highlight></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><Highlight kind="comment">  /// Assumption cache.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#aba357162dc28acb3a399731e1e397614"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aba357162dc28acb3a399731e1e397614">AC</a>;</Highlight></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><Highlight kind="comment">  /// Interface to emit optimization remarks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>;</Highlight></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>;</Highlight></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><Highlight kind="comment">  /// Loop Vectorize Hint.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35e67974daa692cfd961904c151ad33d"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35e67974daa692cfd961904c151ad33d">Hints</a>;</Highlight></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><Highlight kind="comment">  /// The interleave access information contains groups of interleaved accesses</Highlight></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><Highlight kind="comment">  /// with the same stride and close to each other.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7a98f0c17229446d76997f158d896aad"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/interleavedaccessinfo">InterleavedAccessInfo</a> &amp;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7a98f0c17229446d76997f158d896aad">InterleaveInfo</a>;</Highlight></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><Highlight kind="comment">  /// Values to ignore in the cost model.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 16&gt;</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>;</Highlight></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><Highlight kind="comment">  /// Values to ignore in the cost model when VF &gt; 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Value &#42;, 16&gt;</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>;</Highlight></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><Highlight kind="comment">  /// All element types found in the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a00a28a503636abdbedf080f3896b937c"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Type &#42;, 16&gt;</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a00a28a503636abdbedf080f3896b937c">ElementTypesInLoop</a>;</Highlight></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><Highlight kind="comment">  /// The kind of cost that we are calculating</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bb">TTI::TargetCostKind</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>;</Highlight></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// end namespace llvm</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><Highlight kind="comment">/// Helper struct to manage generating runtime checks for vectorization.</Highlight></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><Highlight kind="comment">/// The runtime checks are created up-front in temporary blocks to allow better</Highlight></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><Highlight kind="comment">/// estimating the cost and un-linked from the existing IR. After deciding to</Highlight></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><Highlight kind="comment">/// vectorize, the checks are moved back. If deciding not to vectorize, the</Highlight></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><Highlight kind="comment">/// temporary blocks are completely removed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805" lineLink="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks"><Highlight kind="normal"></Highlight><Highlight kind="keyword">class </Highlight><Highlight kind="normal"><a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#a2139ed08d8dfd3185f12ff7ffb7f0f3e">GeneratedRTChecks</a> &#123;</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><Highlight kind="comment">  /// Basic block which contains the generated SCEV checks, if any.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SCEVCheckBlock = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><Highlight kind="comment">  /// The value representing the result of the generated SCEV checks. If it is</Highlight></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><Highlight kind="comment">  /// nullptr, either no SCEV checks have been generated or they have been used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;SCEVCheckCond = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><Highlight kind="comment">  /// Basic block which contains the generated memory runtime checks, if any.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;MemCheckBlock = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><Highlight kind="comment">  /// The value representing the result of the generated memory runtime checks.</Highlight></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><Highlight kind="comment">  /// If it is nullptr, either no memory runtime checks have been generated or</Highlight></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><Highlight kind="comment">  /// they have been used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;MemRuntimeCheckCond = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT;</Highlight></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI;</Highlight></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI;</Highlight></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> SCEVExp;</Highlight></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/scevexpander">SCEVExpander</a> MemCheckExp;</Highlight></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CostTooHigh = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AddBranchWeights;</Highlight></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;OuterLoop = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;PSE;</Highlight></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><Highlight kind="comment">  /// The kind of cost that we are calculating</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bb">TTI::TargetCostKind</a> CostKind;</Highlight></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><Highlight kind="normal"></Highlight><Highlight kind="keyword">public</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839" lineLink="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#a2139ed08d8dfd3185f12ff7ffb7f0f3e"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#a2139ed08d8dfd3185f12ff7ffb7f0f3e">GeneratedRTChecks</a>(<a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;PSE, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</Highlight></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><Highlight kind="normal">                    <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;TTI,</Highlight></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><Highlight kind="normal">                    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AddBranchWeights,</Highlight></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><Highlight kind="normal">                    <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bb">TTI::TargetCostKind</a> CostKind)</Highlight></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><Highlight kind="normal">      : DT(DT), LI(LI), TTI(TTI), SCEVExp(&#42;PSE.getSE(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </Highlight><Highlight kind="stringliteral">&quot;scev.check&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><Highlight kind="normal">        MemCheckExp(&#42;PSE.getSE(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, </Highlight><Highlight kind="stringliteral">&quot;scev.check&quot;</Highlight><Highlight kind="normal">),</Highlight></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><Highlight kind="normal">        AddBranchWeights(AddBranchWeights), PSE(PSE), CostKind(CostKind) &#123;&#125;</Highlight></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><Highlight kind="comment">  /// Generate runtime checks in SCEVCheckBlock and MemCheckBlock, so we can</Highlight></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><Highlight kind="comment">  /// accurately estimate the cost of the runtime checks. The blocks are</Highlight></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><Highlight kind="comment">  /// un-linked from the IR and are added back during vector code generation. If</Highlight></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><Highlight kind="comment">  /// there is no vector code generation, the check blocks are removed</Highlight></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><Highlight kind="comment">  /// completely.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852" lineLink="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#aae3714d6fe11a1e8c559880caf67fbc7"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#aae3714d6fe11a1e8c559880caf67fbc7">create</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopaccessinfo">LoopAccessInfo</a> &amp;LAI,</Highlight></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><Highlight kind="normal">              </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scevpredicate">SCEVPredicate</a> &amp;UnionPred, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IC) &#123;</Highlight></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Hard cutoff to limit compile-time increase in case a very large number of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// runtime checks needs to be generated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Skip cutoff if the loop is guaranteed to execute, e.g. due to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// profile info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><Highlight kind="normal">    CostTooHigh =</Highlight></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><Highlight kind="normal">        LAI.<a href="/docs/api/classes/llvm/loopaccessinfo/#a76ffc71fcd432b9a2a15b11c3144397d">getNumRuntimePointerChecks</a>() &gt; <a href="#a1293f02da7fffb33096a44f1b1768b3f">VectorizeMemoryCheckThreshold</a>;</Highlight></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CostTooHigh)</Highlight></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopHeader = L-&gt;getHeader();</Highlight></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Preheader = L-&gt;getLoopPreheader();</Highlight></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Use SplitBlock to create blocks for SCEV &amp; memory runtime checks to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// ensure the blocks are properly added to LoopInfo &amp; DominatorTree. Those</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// may be used by SCEVExpander. The blocks will be un-linked from their</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// predecessors and removed from LI &amp; DT at the end of the function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UnionPred.<a href="/docs/api/classes/llvm/scevpredicate/#ac43f5102232a1e1819b0763536f2937a">isAlwaysTrue</a>()) &#123;</Highlight></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><Highlight kind="normal">      SCEVCheckBlock = <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(Preheader, Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), DT, LI,</Highlight></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><Highlight kind="normal">                                  </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="stringliteral">&quot;vector.scevcheck&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><Highlight kind="normal">      SCEVCheckCond = SCEVExp.expandCodeForPredicate(</Highlight></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><Highlight kind="normal">          &amp;UnionPred, SCEVCheckBlock-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;RtPtrChecking = &#42;LAI.<a href="/docs/api/classes/llvm/loopaccessinfo/#a3aedf5694dc5b1e81a79658b126a9b43">getRuntimePointerChecking</a>();</Highlight></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RtPtrChecking.Need) &#123;</Highlight></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Pred = SCEVCheckBlock ? SCEVCheckBlock : Preheader;</Highlight></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><Highlight kind="normal">      MemCheckBlock = <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(Pred, Pred-&gt;getTerminator(), DT, LI, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><Highlight kind="normal">                                 </Highlight><Highlight kind="stringliteral">&quot;vector.memcheck&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> DiffChecks = RtPtrChecking.getDiffChecks();</Highlight></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DiffChecks) &#123;</Highlight></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;RuntimeVF = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><Highlight kind="normal">        MemRuntimeCheckCond = <a href="/docs/api/namespaces/llvm/#ad4f572b4f4bf6aa2dbf10a0bd160280d">addDiffRuntimeChecks</a>(</Highlight></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><Highlight kind="normal">            MemCheckBlock-&gt;getTerminator(), &#42;DiffChecks, MemCheckExp,</Highlight></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><Highlight kind="normal">            &#91;VF, &amp;RuntimeVF&#93;(<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Bits) &#123;</Highlight></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><Highlight kind="normal">              if (!RuntimeVF)</Highlight></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><Highlight kind="normal">                RuntimeVF = getRuntimeVF(B, B.getIntNTy(Bits), VF);</Highlight></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><Highlight kind="normal">              return RuntimeVF;</Highlight></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><Highlight kind="normal">            &#125;,</Highlight></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><Highlight kind="normal">            IC);</Highlight></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><Highlight kind="normal">        MemRuntimeCheckCond = <a href="/docs/api/namespaces/llvm/#a076304d81553bb834b6d64f72e0fe055">addRuntimeChecks</a>(</Highlight></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><Highlight kind="normal">            MemCheckBlock-&gt;getTerminator(), L, RtPtrChecking.getChecks(),</Highlight></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><Highlight kind="normal">            MemCheckExp, <a href="/docs/api/structs/llvm/vectorizerparams/#af0d74538c9c155e8b7899a962e12a68f">VectorizerParams::HoistRuntimeChecks</a>);</Highlight></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MemRuntimeCheckCond &amp;&amp;</Highlight></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;no RT checks generated although RtPtrChecking &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;claimed checks are required&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MemCheckBlock &amp;&amp; !SCEVCheckBlock)</Highlight></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Unhook the temporary block with the checks, update various places</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// accordingly.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SCEVCheckBlock)</Highlight></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><Highlight kind="normal">      SCEVCheckBlock-&gt;replaceAllUsesWith(Preheader);</Highlight></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MemCheckBlock)</Highlight></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><Highlight kind="normal">      MemCheckBlock-&gt;replaceAllUsesWith(Preheader);</Highlight></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SCEVCheckBlock) &#123;</Highlight></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><Highlight kind="normal">      SCEVCheckBlock-&gt;getTerminator()-&gt;moveBefore(</Highlight></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><Highlight kind="normal">          Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a>(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), SCEVCheckBlock);</Highlight></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><Highlight kind="normal">      Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MemCheckBlock) &#123;</Highlight></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><Highlight kind="normal">      MemCheckBlock-&gt;getTerminator()-&gt;moveBefore(</Highlight></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><Highlight kind="normal">          Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/unreachableinst">UnreachableInst</a>(Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>(), MemCheckBlock);</Highlight></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><Highlight kind="normal">      Preheader-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><Highlight kind="normal">    DT-&gt;changeImmediateDominator(LoopHeader, Preheader);</Highlight></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MemCheckBlock) &#123;</Highlight></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><Highlight kind="normal">      DT-&gt;eraseNode(MemCheckBlock);</Highlight></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><Highlight kind="normal">      LI-&gt;removeBlock(MemCheckBlock);</Highlight></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SCEVCheckBlock) &#123;</Highlight></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><Highlight kind="normal">      DT-&gt;eraseNode(SCEVCheckBlock);</Highlight></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><Highlight kind="normal">      LI-&gt;removeBlock(SCEVCheckBlock);</Highlight></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Outer loop is used as part of the later cost calculations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><Highlight kind="normal">    OuterLoop = L-&gt;getParentLoop();</Highlight></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943" lineLink="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#ad7b44d9befce70f070d4355d10ffc419"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#ad7b44d9befce70f070d4355d10ffc419">getCost</a>() &#123;</Highlight></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SCEVCheckBlock || MemCheckBlock)</Highlight></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Calculating cost of runtime checks:\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CostTooHigh) &#123;</Highlight></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>.setInvalid();</Highlight></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  number of checks exceeded threshold\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> RTCheckCost = 0;</Highlight></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SCEVCheckBlock)</Highlight></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;SCEVCheckBlock) &#123;</Highlight></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SCEVCheckBlock-&gt;getTerminator() == &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = TTI-&gt;getInstructionCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, CostKind);</Highlight></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  for &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><Highlight kind="normal">        RTCheckCost += <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MemCheckBlock) &#123;</Highlight></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> MemCheckCost = 0;</Highlight></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;MemCheckBlock) &#123;</Highlight></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MemCheckBlock-&gt;getTerminator() == &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = TTI-&gt;getInstructionCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, CostKind);</Highlight></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;  for &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><Highlight kind="normal">        MemCheckCost += <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the runtime memory checks are being created inside an outer loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// we should find out if these checks are outer loop invariant. If so,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the checks will likely be hoisted out and so the effective cost will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// reduce according to the outer loop trip count.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OuterLoop) &#123;</Highlight></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE = MemCheckExp.getSE();</Highlight></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// TODO: If profitable, we could refine this further by analysing every</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// individual memory check, since there could be a mixture of loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// variant and invariant checks that mean the final condition is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// variant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(MemRuntimeCheckCond);</Highlight></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a5a19768af81df7e5fe571bc08dcd48b3">isLoopInvariant</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, OuterLoop)) &#123;</Highlight></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// It seems reasonable to assume that we can reduce the effective</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// cost of the checks even when we know nothing about the trip</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// count. Assume that the outer loop executes at least twice.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><Highlight kind="normal">          </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> BestTripCount = 2;</Highlight></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Get the best known TC estimate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> EstimatedTC = <a href="#a84375e6536d9214c7895013078055aff">getSmallBestKnownTC</a>(</Highlight></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><Highlight kind="normal">                  PSE, OuterLoop, </Highlight><Highlight kind="comment">/&#42; CanUseConstantMax = &#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">))</Highlight></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><Highlight kind="normal">            BestTripCount = &#42;EstimatedTC;</Highlight></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><Highlight kind="normal">          BestTripCount = std::max(BestTripCount, 1U);</Highlight></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> NewMemCheckCost = MemCheckCost / BestTripCount;</Highlight></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Let&#39;s ensure the cost is always at least 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><Highlight kind="normal">          NewMemCheckCost = std::max(&#42;NewMemCheckCost.<a href="/docs/api/classes/llvm/instructioncost/#a9b642067999075ba996ecdee40b52b68">getValue</a>(),</Highlight></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><Highlight kind="normal">                                     (<a href="/docs/api/classes/llvm/instructioncost/#a5dbf65370a0656ea05a0aa97380c15cc">InstructionCost::CostType</a>)1);</Highlight></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BestTripCount &gt; 1)</Highlight></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><Highlight kind="normal">            <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</Highlight></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><Highlight kind="normal">                       &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;We expect runtime memory checks to be hoisted &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><Highlight kind="normal">                       &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;out of the outer loop. Cost reduced from &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><Highlight kind="normal">                       &lt;&lt; MemCheckCost &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to &quot;</Highlight><Highlight kind="normal"> &lt;&lt; NewMemCheckCost &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><Highlight kind="normal">          MemCheckCost = NewMemCheckCost;</Highlight></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><Highlight kind="normal">      RTCheckCost += MemCheckCost;</Highlight></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SCEVCheckBlock || MemCheckBlock)</Highlight></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Total cost of runtime checks: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; RTCheckCost</Highlight></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> RTCheckCost;</Highlight></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022"><Highlight kind="comment">  /// Remove the created SCEV &amp; memory runtime check blocks &amp; instructions, if</Highlight></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><Highlight kind="comment">  /// unused.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024" lineLink="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#a13b83b5242219a4536c997c7dc2062c4"><Highlight kind="normal">  <a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#a13b83b5242219a4536c997c7dc2062c4">~GeneratedRTChecks</a>() &#123;</Highlight></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/scevexpandercleaner">SCEVExpanderCleaner</a> SCEVCleaner(SCEVExp);</Highlight></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/scevexpandercleaner">SCEVExpanderCleaner</a> MemCheckCleaner(MemCheckExp);</Highlight></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SCEVCheckCond)</Highlight></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><Highlight kind="normal">      SCEVCleaner.<a href="/docs/api/classes/llvm/scevexpandercleaner/#adebccfabab3d98cd238936760a34a15d">markResultUsed</a>();</Highlight></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MemRuntimeCheckCond)</Highlight></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><Highlight kind="normal">      MemCheckCleaner.<a href="/docs/api/classes/llvm/scevexpandercleaner/#adebccfabab3d98cd238936760a34a15d">markResultUsed</a>();</Highlight></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MemRuntimeCheckCond) &#123;</Highlight></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;SE = &#42;MemCheckExp.getSE();</Highlight></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Memory runtime check generation creates compares that use expanded</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// values. Remove them before running the SCEVExpanderCleaners.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(&#42;MemCheckBlock))) &#123;</Highlight></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MemCheckExp.isInsertedInstruction(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><Highlight kind="normal">        SE.forgetValue(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.eraseFromParent();</Highlight></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><Highlight kind="normal">    MemCheckCleaner.<a href="/docs/api/classes/llvm/scevexpandercleaner/#ab714e94c2ba068bbd6882e560cef94e2">cleanup</a>();</Highlight></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><Highlight kind="normal">    SCEVCleaner.<a href="/docs/api/classes/llvm/scevexpandercleaner/#ab714e94c2ba068bbd6882e560cef94e2">cleanup</a>();</Highlight></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SCEVCheckCond)</Highlight></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><Highlight kind="normal">      SCEVCheckBlock-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MemRuntimeCheckCond)</Highlight></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><Highlight kind="normal">      MemCheckBlock-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><Highlight kind="comment">  /// Adds the generated SCEVCheckBlock before \\p LoopVectorPreHeader and</Highlight></CodeLine>
<Link id="l02054" /><CodeLine lineNumber="2054"><Highlight kind="comment">  /// adjusts the branches to branch to the vector preheader or \\p Bypass,</Highlight></CodeLine>
<Link id="l02055" /><CodeLine lineNumber="2055"><Highlight kind="comment">  /// depending on the generated condition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02056" /><CodeLine lineNumber="2056" lineLink="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#aa55563b1c40f6c6c94622a87dd7b5dcb"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#aa55563b1c40f6c6c94622a87dd7b5dcb">emitSCEVChecks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass,</Highlight></CodeLine>
<Link id="l02057" /><CodeLine lineNumber="2057"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopVectorPreHeader) &#123;</Highlight></CodeLine>
<Link id="l02058" /><CodeLine lineNumber="2058"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SCEVCheckCond)</Highlight></CodeLine>
<Link id="l02059" /><CodeLine lineNumber="2059"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02060" /><CodeLine lineNumber="2060"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02061" /><CodeLine lineNumber="2061"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = SCEVCheckCond;</Highlight></CodeLine>
<Link id="l02062" /><CodeLine lineNumber="2062"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Mark the check as used, to prevent it from being removed during cleanup.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02063" /><CodeLine lineNumber="2063"><Highlight kind="normal">    SCEVCheckCond = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02064" /><CodeLine lineNumber="2064"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>))</Highlight></CodeLine>
<Link id="l02065" /><CodeLine lineNumber="2065"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;isZero())</Highlight></CodeLine>
<Link id="l02066" /><CodeLine lineNumber="2066"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02067" /><CodeLine lineNumber="2067"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02068" /><CodeLine lineNumber="2068"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Pred = LoopVectorPreHeader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</Highlight></CodeLine>
<Link id="l02069" /><CodeLine lineNumber="2069"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02070" /><CodeLine lineNumber="2070"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(LoopVectorPreHeader, SCEVCheckBlock);</Highlight></CodeLine>
<Link id="l02071" /><CodeLine lineNumber="2071"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Create new preheader for vector loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02072" /><CodeLine lineNumber="2072"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OuterLoop)</Highlight></CodeLine>
<Link id="l02073" /><CodeLine lineNumber="2073"><Highlight kind="normal">      OuterLoop-&gt;addBasicBlockToLoop(SCEVCheckBlock, &#42;LI);</Highlight></CodeLine>
<Link id="l02074" /><CodeLine lineNumber="2074"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02075" /><CodeLine lineNumber="2075"><Highlight kind="normal">    SCEVCheckBlock-&gt;getTerminator()-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l02076" /><CodeLine lineNumber="2076"><Highlight kind="normal">    SCEVCheckBlock-&gt;moveBefore(LoopVectorPreHeader);</Highlight></CodeLine>
<Link id="l02077" /><CodeLine lineNumber="2077"><Highlight kind="normal">    Pred-&gt;getTerminator()-&gt;replaceSuccessorWith(LoopVectorPreHeader,</Highlight></CodeLine>
<Link id="l02078" /><CodeLine lineNumber="2078"><Highlight kind="normal">                                                SCEVCheckBlock);</Highlight></CodeLine>
<Link id="l02079" /><CodeLine lineNumber="2079"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02080" /><CodeLine lineNumber="2080"><Highlight kind="normal">    DT-&gt;addNewBlock(SCEVCheckBlock, Pred);</Highlight></CodeLine>
<Link id="l02081" /><CodeLine lineNumber="2081"><Highlight kind="normal">    DT-&gt;changeImmediateDominator(LoopVectorPreHeader, SCEVCheckBlock);</Highlight></CodeLine>
<Link id="l02082" /><CodeLine lineNumber="2082"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02083" /><CodeLine lineNumber="2083"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &amp;BI = &#42;<a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(Bypass, LoopVectorPreHeader, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>);</Highlight></CodeLine>
<Link id="l02084" /><CodeLine lineNumber="2084"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddBranchWeights)</Highlight></CodeLine>
<Link id="l02085" /><CodeLine lineNumber="2085"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(BI, <a href="#a968a5c2971ffa9e8ef81ff86eebaf514">SCEVCheckBypassWeights</a>, </Highlight><Highlight kind="comment">/&#42;IsExpected=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02086" /><CodeLine lineNumber="2086"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a016a85f7487f995fe80141e102a7a5ae">ReplaceInstWithInst</a>(SCEVCheckBlock-&gt;getTerminator(), &amp;BI);</Highlight></CodeLine>
<Link id="l02087" /><CodeLine lineNumber="2087"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> SCEVCheckBlock;</Highlight></CodeLine>
<Link id="l02088" /><CodeLine lineNumber="2088"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02089" /><CodeLine lineNumber="2089"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02090" /><CodeLine lineNumber="2090"><Highlight kind="comment">  /// Adds the generated MemCheckBlock before \\p LoopVectorPreHeader and adjusts</Highlight></CodeLine>
<Link id="l02091" /><CodeLine lineNumber="2091"><Highlight kind="comment">  /// the branches to branch to the vector preheader or \\p Bypass, depending on</Highlight></CodeLine>
<Link id="l02092" /><CodeLine lineNumber="2092"><Highlight kind="comment">  /// the generated condition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02093" /><CodeLine lineNumber="2093" lineLink="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#af15e3fefdfa2f5ea86ef5b8eacfa3517"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/anonymous-namespace-loopvectorize-cpp-/generatedrtchecks/#af15e3fefdfa2f5ea86ef5b8eacfa3517">emitMemRuntimeChecks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass,</Highlight></CodeLine>
<Link id="l02094" /><CodeLine lineNumber="2094"><Highlight kind="normal">                                   <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopVectorPreHeader) &#123;</Highlight></CodeLine>
<Link id="l02095" /><CodeLine lineNumber="2095"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if we generated code that checks in runtime if arrays overlap.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02096" /><CodeLine lineNumber="2096"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MemRuntimeCheckCond)</Highlight></CodeLine>
<Link id="l02097" /><CodeLine lineNumber="2097"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02098" /><CodeLine lineNumber="2098"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02099" /><CodeLine lineNumber="2099"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Pred = LoopVectorPreHeader-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>();</Highlight></CodeLine>
<Link id="l02100" /><CodeLine lineNumber="2100"><Highlight kind="normal">    Pred-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a657e5d1f0907b46daf10219e2b9b5ae5">replaceSuccessorWith</a>(LoopVectorPreHeader,</Highlight></CodeLine>
<Link id="l02101" /><CodeLine lineNumber="2101"><Highlight kind="normal">                                                MemCheckBlock);</Highlight></CodeLine>
<Link id="l02102" /><CodeLine lineNumber="2102"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02103" /><CodeLine lineNumber="2103"><Highlight kind="normal">    DT-&gt;addNewBlock(MemCheckBlock, Pred);</Highlight></CodeLine>
<Link id="l02104" /><CodeLine lineNumber="2104"><Highlight kind="normal">    DT-&gt;changeImmediateDominator(LoopVectorPreHeader, MemCheckBlock);</Highlight></CodeLine>
<Link id="l02105" /><CodeLine lineNumber="2105"><Highlight kind="normal">    MemCheckBlock-&gt;moveBefore(LoopVectorPreHeader);</Highlight></CodeLine>
<Link id="l02106" /><CodeLine lineNumber="2106"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02107" /><CodeLine lineNumber="2107"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OuterLoop)</Highlight></CodeLine>
<Link id="l02108" /><CodeLine lineNumber="2108"><Highlight kind="normal">      OuterLoop-&gt;addBasicBlockToLoop(MemCheckBlock, &#42;LI);</Highlight></CodeLine>
<Link id="l02109" /><CodeLine lineNumber="2109"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02110" /><CodeLine lineNumber="2110"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &amp;BI =</Highlight></CodeLine>
<Link id="l02111" /><CodeLine lineNumber="2111"><Highlight kind="normal">        &#42;<a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(Bypass, LoopVectorPreHeader, MemRuntimeCheckCond);</Highlight></CodeLine>
<Link id="l02112" /><CodeLine lineNumber="2112"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AddBranchWeights) &#123;</Highlight></CodeLine>
<Link id="l02113" /><CodeLine lineNumber="2113"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(BI, <a href="#a502070b20fa467fb54ba49d6736cf2d3">MemCheckBypassWeights</a>, </Highlight><Highlight kind="comment">/&#42;IsExpected=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02114" /><CodeLine lineNumber="2114"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02115" /><CodeLine lineNumber="2115"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a016a85f7487f995fe80141e102a7a5ae">ReplaceInstWithInst</a>(MemCheckBlock-&gt;getTerminator(), &amp;BI);</Highlight></CodeLine>
<Link id="l02116" /><CodeLine lineNumber="2116"><Highlight kind="normal">    MemCheckBlock-&gt;getTerminator()-&gt;setDebugLoc(</Highlight></CodeLine>
<Link id="l02117" /><CodeLine lineNumber="2117"><Highlight kind="normal">        Pred-&gt;getTerminator()-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l02118" /><CodeLine lineNumber="2118"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02119" /><CodeLine lineNumber="2119"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Mark the check as used, to prevent it from being removed during cleanup.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02120" /><CodeLine lineNumber="2120"><Highlight kind="normal">    MemRuntimeCheckCond = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02121" /><CodeLine lineNumber="2121"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MemCheckBlock;</Highlight></CodeLine>
<Link id="l02122" /><CodeLine lineNumber="2122"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02123" /><CodeLine lineNumber="2123"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l02124" /><CodeLine lineNumber="2124"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02125" /><CodeLine lineNumber="2125"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02126" /><CodeLine lineNumber="2126" lineLink="#aae88a50a9a37f9a745939e3e726837e6"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#aae88a50a9a37f9a745939e3e726837e6">useActiveLaneMask</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> Style) &#123;</Highlight></CodeLine>
<Link id="l02127" /><CodeLine lineNumber="2127"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Style == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddaf6068daa29dbb05a7ead1e3b5a48bbee">TailFoldingStyle::Data</a> ||</Highlight></CodeLine>
<Link id="l02128" /><CodeLine lineNumber="2128"><Highlight kind="normal">         Style == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddad817e2199b89933da1a3cd7e130cd782">TailFoldingStyle::DataAndControlFlow</a> ||</Highlight></CodeLine>
<Link id="l02129" /><CodeLine lineNumber="2129"><Highlight kind="normal">         Style == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">TailFoldingStyle::DataAndControlFlowWithoutRuntimeCheck</a>;</Highlight></CodeLine>
<Link id="l02130" /><CodeLine lineNumber="2130"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02131" /><CodeLine lineNumber="2131"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02132" /><CodeLine lineNumber="2132" lineLink="#a4e445204e48d57b1e23e55869146b7ce"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a4e445204e48d57b1e23e55869146b7ce">useActiveLaneMaskForControlFlow</a>(<a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> Style) &#123;</Highlight></CodeLine>
<Link id="l02133" /><CodeLine lineNumber="2133"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Style == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bddad817e2199b89933da1a3cd7e130cd782">TailFoldingStyle::DataAndControlFlow</a> ||</Highlight></CodeLine>
<Link id="l02134" /><CodeLine lineNumber="2134"><Highlight kind="normal">         Style == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">TailFoldingStyle::DataAndControlFlowWithoutRuntimeCheck</a>;</Highlight></CodeLine>
<Link id="l02135" /><CodeLine lineNumber="2135"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02136" /><CodeLine lineNumber="2136"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02137" /><CodeLine lineNumber="2137"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Return true if \\p OuterLp is an outer loop annotated with hints for explicit</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02138" /><CodeLine lineNumber="2138"><Highlight kind="normal"></Highlight><Highlight kind="comment">// vectorization. The loop needs to be annotated with #pragma omp simd</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02139" /><CodeLine lineNumber="2139"><Highlight kind="normal"></Highlight><Highlight kind="comment">// simdlen(#) or #pragma clang vectorize(enable) vectorize&#95;width(#). If the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02140" /><CodeLine lineNumber="2140"><Highlight kind="normal"></Highlight><Highlight kind="comment">// vector length information is not provided, vectorization is not considered</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02141" /><CodeLine lineNumber="2141"><Highlight kind="normal"></Highlight><Highlight kind="comment">// explicit. Interleave hints are not allowed either. These limitations will be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02142" /><CodeLine lineNumber="2142"><Highlight kind="normal"></Highlight><Highlight kind="comment">// relaxed in the future.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02143" /><CodeLine lineNumber="2143"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Please, note that we are currently forced to abuse the pragma &#39;clang</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02144" /><CodeLine lineNumber="2144"><Highlight kind="normal"></Highlight><Highlight kind="comment">// vectorize&#39; semantics. This pragma provides &#42;auto-vectorization hints&#42;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02145" /><CodeLine lineNumber="2145"><Highlight kind="normal"></Highlight><Highlight kind="comment">// (i.e., LV must check that vectorization is legal) whereas pragma &#39;omp simd&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02146" /><CodeLine lineNumber="2146"><Highlight kind="normal"></Highlight><Highlight kind="comment">// provides &#42;explicit vectorization hints&#42; (LV can bypass legal checks and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02147" /><CodeLine lineNumber="2147"><Highlight kind="normal"></Highlight><Highlight kind="comment">// assume that vectorization is legal). However, both hints are implemented</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02148" /><CodeLine lineNumber="2148"><Highlight kind="normal"></Highlight><Highlight kind="comment">// using the same metadata (llvm.loop.vectorize, processed by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02149" /><CodeLine lineNumber="2149"><Highlight kind="normal"></Highlight><Highlight kind="comment">// LoopVectorizeHints). This will be fixed in the future when the native IR</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02150" /><CodeLine lineNumber="2150"><Highlight kind="normal"></Highlight><Highlight kind="comment">// representation for pragma &#39;omp simd&#39; is introduced.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02151" /><CodeLine lineNumber="2151" lineLink="#a806ec23d6f44b02ad8cf3b1e61c05495"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a806ec23d6f44b02ad8cf3b1e61c05495">isExplicitVecOuterLoop</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;OuterLp,</Highlight></CodeLine>
<Link id="l02152" /><CodeLine lineNumber="2152"><Highlight kind="normal">                                   <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE) &#123;</Highlight></CodeLine>
<Link id="l02153" /><CodeLine lineNumber="2153"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!OuterLp-&gt;<a href="/docs/api/classes/llvm/loopbase/#a16165c1e5da45acaa086c3a54a188d34">isInnermost</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;This is not an outer loop&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02154" /><CodeLine lineNumber="2154"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> Hints(OuterLp, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42;DisableInterleaving&#42;/</Highlight><Highlight kind="normal">, &#42;ORE);</Highlight></CodeLine>
<Link id="l02155" /><CodeLine lineNumber="2155"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02156" /><CodeLine lineNumber="2156"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only outer loops with an explicit vectorization hint are supported.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02157" /><CodeLine lineNumber="2157"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Unannotated outer loops are ignored.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02158" /><CodeLine lineNumber="2158"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a20ecacbd54e401685d798d86161af6cf">getForce</a>() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea8914fe2dbf82d457456e8e4faa201b87">LoopVectorizeHints::FK&#95;Undefined</a>)</Highlight></CodeLine>
<Link id="l02159" /><CodeLine lineNumber="2159"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02160" /><CodeLine lineNumber="2160"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02161" /><CodeLine lineNumber="2161"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Fn = OuterLp-&gt;<a href="/docs/api/classes/llvm/loopbase/#a4a75755081e9a3803d2f4ccf6f0cb1f8">getHeader</a>()-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l02162" /><CodeLine lineNumber="2162"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a21b6d9e2aa12c8c68d8e2f122ec7ecec">allowVectorization</a>(Fn, OuterLp,</Highlight></CodeLine>
<Link id="l02163" /><CodeLine lineNumber="2163"><Highlight kind="normal">                                </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42;VectorizeOnlyWhenForced&#42;/</Highlight><Highlight kind="normal">)) &#123;</Highlight></CodeLine>
<Link id="l02164" /><CodeLine lineNumber="2164"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Loop hints prevent outer loop vectorization.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02165" /><CodeLine lineNumber="2165"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02166" /><CodeLine lineNumber="2166"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02167" /><CodeLine lineNumber="2167"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02168" /><CodeLine lineNumber="2168"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#ad98353127dbeb649d41ca07da5074b49">getInterleave</a>() &gt; 1) &#123;</Highlight></CodeLine>
<Link id="l02169" /><CodeLine lineNumber="2169"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Interleave support is future work.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02170" /><CodeLine lineNumber="2170"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Not vectorizing: Interleave is not supported for &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02171" /><CodeLine lineNumber="2171"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;outer loops.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02172" /><CodeLine lineNumber="2172"><Highlight kind="normal">    Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a440979b6103588bef39bd2d62065d5ff">emitRemarkWithHints</a>();</Highlight></CodeLine>
<Link id="l02173" /><CodeLine lineNumber="2173"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02174" /><CodeLine lineNumber="2174"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02175" /><CodeLine lineNumber="2175"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02176" /><CodeLine lineNumber="2176"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02177" /><CodeLine lineNumber="2177"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02178" /><CodeLine lineNumber="2178"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02179" /><CodeLine lineNumber="2179" lineLink="#a00315ff11c9068aab97e5780bdfa5eef"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a00315ff11c9068aab97e5780bdfa5eef">collectSupportedLoops</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &amp;L, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI,</Highlight></CodeLine>
<Link id="l02180" /><CodeLine lineNumber="2180"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE,</Highlight></CodeLine>
<Link id="l02181" /><CodeLine lineNumber="2181"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Loop &#42;&gt;</a> &amp;V) &#123;</Highlight></CodeLine>
<Link id="l02182" /><CodeLine lineNumber="2182"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect inner loops and outer loops without irreducible control flow. For</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02183" /><CodeLine lineNumber="2183"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// now, only collect outer loops that have explicit vectorization hints. If we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02184" /><CodeLine lineNumber="2184"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// are stress testing the VPlan H-CFG construction, we collect the outermost</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02185" /><CodeLine lineNumber="2185"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// loop of every loop nest.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02186" /><CodeLine lineNumber="2186"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (L.isInnermost() || <a href="#a9f30855a6efcd4a12875deb88880b510">VPlanBuildStressTest</a> ||</Highlight></CodeLine>
<Link id="l02187" /><CodeLine lineNumber="2187"><Highlight kind="normal">      (<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a> &amp;&amp; <a href="#a806ec23d6f44b02ad8cf3b1e61c05495">isExplicitVecOuterLoop</a>(&amp;L, ORE))) &#123;</Highlight></CodeLine>
<Link id="l02188" /><CodeLine lineNumber="2188"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopblocksrpo">LoopBlocksRPO</a> RPOT(&amp;L);</Highlight></CodeLine>
<Link id="l02189" /><CodeLine lineNumber="2189"><Highlight kind="normal">    RPOT.<a href="/docs/api/classes/llvm/loopblocksrpo/#aeab06fd248333b13725e55754883b570">perform</a>(LI);</Highlight></CodeLine>
<Link id="l02190" /><CodeLine lineNumber="2190"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a6dadcd5de1248b4d9893c409e7398c21">containsIrreducibleCFG&lt;const BasicBlock &#42;&gt;</a>(RPOT, &#42;LI)) &#123;</Highlight></CodeLine>
<Link id="l02191" /><CodeLine lineNumber="2191"><Highlight kind="normal">      V.push&#95;back(&amp;L);</Highlight></CodeLine>
<Link id="l02192" /><CodeLine lineNumber="2192"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: Collect inner loops inside marked outer loops in case</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02193" /><CodeLine lineNumber="2193"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// vectorization fails for the outer loop. Do not invoke</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02194" /><CodeLine lineNumber="2194"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// &#39;containsIrreducibleCFG&#39; again for inner loops when the outer loop is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02195" /><CodeLine lineNumber="2195"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// already known to be reducible. We can use an inherited attribute for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02196" /><CodeLine lineNumber="2196"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// that.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02197" /><CodeLine lineNumber="2197"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02198" /><CodeLine lineNumber="2198"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02199" /><CodeLine lineNumber="2199"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02200" /><CodeLine lineNumber="2200"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;InnerL : L)</Highlight></CodeLine>
<Link id="l02201" /><CodeLine lineNumber="2201"><Highlight kind="normal">    <a href="#a00315ff11c9068aab97e5780bdfa5eef">collectSupportedLoops</a>(&#42;InnerL, LI, ORE, V);</Highlight></CodeLine>
<Link id="l02202" /><CodeLine lineNumber="2202"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02203" /><CodeLine lineNumber="2203"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02204" /><CodeLine lineNumber="2204"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02205" /><CodeLine lineNumber="2205"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Implementation of LoopVectorizationLegality, InnerLoopVectorizer and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02206" /><CodeLine lineNumber="2206"><Highlight kind="normal"></Highlight><Highlight kind="comment">// LoopVectorizationCostModel and LoopVectorizationPlanner.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02207" /><CodeLine lineNumber="2207"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02208" /><CodeLine lineNumber="2208"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02209" /><CodeLine lineNumber="2209"><Highlight kind="comment">/// Compute the transformed value of Index at offset StartValue using step</Highlight></CodeLine>
<Link id="l02210" /><CodeLine lineNumber="2210"><Highlight kind="comment">/// StepValue.</Highlight></CodeLine>
<Link id="l02211" /><CodeLine lineNumber="2211"><Highlight kind="comment">/// For integer induction, returns StartValue + Index &#42; StepValue.</Highlight></CodeLine>
<Link id="l02212" /><CodeLine lineNumber="2212"><Highlight kind="comment">/// For pointer induction, returns StartValue&#91;Index &#42; StepValue&#93;.</Highlight></CodeLine>
<Link id="l02213" /><CodeLine lineNumber="2213"><Highlight kind="comment">/// FIXME: The newly created binary instructions should contain nsw/nuw</Highlight></CodeLine>
<Link id="l02214" /><CodeLine lineNumber="2214"><Highlight kind="comment">/// flags, which can be found from the original scalar operations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02215" /><CodeLine lineNumber="2215"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;</Highlight></CodeLine>
<Link id="l02216" /><CodeLine lineNumber="2216" lineLink="#a23f5821d9ac264ae25dd087747e2c181"><Highlight kind="normal"><a href="#a23f5821d9ac264ae25dd087747e2c181">emitTransformedIndex</a>(<a href="/docs/api/classes/llvm/irbuilderbase">IRBuilderBase</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;Index, <a href="/docs/api/classes/llvm/value">Value</a> &#42;StartValue,</Highlight></CodeLine>
<Link id="l02217" /><CodeLine lineNumber="2217"><Highlight kind="normal">                     <a href="/docs/api/classes/llvm/value">Value</a> &#42;Step,</Highlight></CodeLine>
<Link id="l02218" /><CodeLine lineNumber="2218"><Highlight kind="normal">                     <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabcc">InductionDescriptor::InductionKind</a> InductionKind,</Highlight></CodeLine>
<Link id="l02219" /><CodeLine lineNumber="2219"><Highlight kind="normal">                     </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/binaryoperator">BinaryOperator</a> &#42;InductionBinOp) &#123;</Highlight></CodeLine>
<Link id="l02220" /><CodeLine lineNumber="2220"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;StepTy = Step-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l02221" /><CodeLine lineNumber="2221"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CastedIndex = StepTy-&gt;<a href="/docs/api/classes/llvm/type/#ac6d28a9b11139182134a9618028a0d07">isIntegerTy</a>()</Highlight></CodeLine>
<Link id="l02222" /><CodeLine lineNumber="2222"><Highlight kind="normal">                           ? <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateSExtOrTrunc(Index, StepTy)</Highlight></CodeLine>
<Link id="l02223" /><CodeLine lineNumber="2223"><Highlight kind="normal">                           : <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateCast(Instruction::SIToFP, Index, StepTy);</Highlight></CodeLine>
<Link id="l02224" /><CodeLine lineNumber="2224"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CastedIndex != Index) &#123;</Highlight></CodeLine>
<Link id="l02225" /><CodeLine lineNumber="2225"><Highlight kind="normal">    CastedIndex-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(CastedIndex-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.cast&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02226" /><CodeLine lineNumber="2226"><Highlight kind="normal">    Index = CastedIndex;</Highlight></CodeLine>
<Link id="l02227" /><CodeLine lineNumber="2227"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02228" /><CodeLine lineNumber="2228"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02229" /><CodeLine lineNumber="2229"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note: the IR at this point is broken. We cannot use SE to create any new</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02230" /><CodeLine lineNumber="2230"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// SCEV and then expand it, hoping that SCEV&#39;s simplification will give us</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02231" /><CodeLine lineNumber="2231"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a more optimal code. Unfortunately, attempt of doing so on invalid IR may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02232" /><CodeLine lineNumber="2232"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// lead to various SCEV crashes. So all we can do is to use builder and rely</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02233" /><CodeLine lineNumber="2233"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// on InstCombine for future simplifications. Here we handle some trivial</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02234" /><CodeLine lineNumber="2234"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cases only.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02235" /><CodeLine lineNumber="2235"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/reassociate-cpp/#a4b946333b7fb96fec126f22534cf3794">CreateAdd</a> = &#91;&amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>) &#123;</Highlight></CodeLine>
<Link id="l02236" /><CodeLine lineNumber="2236"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType() == <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Types don&#39;t match!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02237" /><CodeLine lineNumber="2237"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CX = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))</Highlight></CodeLine>
<Link id="l02238" /><CodeLine lineNumber="2238"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CX-&gt;isZero())</Highlight></CodeLine>
<Link id="l02239" /><CodeLine lineNumber="2239"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</Highlight></CodeLine>
<Link id="l02240" /><CodeLine lineNumber="2240"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CY = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))</Highlight></CodeLine>
<Link id="l02241" /><CodeLine lineNumber="2241"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CY-&gt;isZero())</Highlight></CodeLine>
<Link id="l02242" /><CodeLine lineNumber="2242"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l02243" /><CodeLine lineNumber="2243"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateAdd(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</Highlight></CodeLine>
<Link id="l02244" /><CodeLine lineNumber="2244"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02245" /><CodeLine lineNumber="2245"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02246" /><CodeLine lineNumber="2246"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We allow X to be a vector type, in which case Y will potentially be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02247" /><CodeLine lineNumber="2247"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// splatted into a vector with the same element count.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02248" /><CodeLine lineNumber="2248"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/reassociate-cpp/#a3621b702ef72b987959cdd7242c13d47">CreateMul</a> = &#91;&amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>) &#123;</Highlight></CodeLine>
<Link id="l02249" /><CodeLine lineNumber="2249"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType()-&gt;getScalarType() == <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType() &amp;&amp;</Highlight></CodeLine>
<Link id="l02250" /><CodeLine lineNumber="2250"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Types don&#39;t match!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02251" /><CodeLine lineNumber="2251"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CX = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>))</Highlight></CodeLine>
<Link id="l02252" /><CodeLine lineNumber="2252"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CX-&gt;isOne())</Highlight></CodeLine>
<Link id="l02253" /><CodeLine lineNumber="2253"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>;</Highlight></CodeLine>
<Link id="l02254" /><CodeLine lineNumber="2254"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CY = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>))</Highlight></CodeLine>
<Link id="l02255" /><CodeLine lineNumber="2255"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CY-&gt;isOne())</Highlight></CodeLine>
<Link id="l02256" /><CodeLine lineNumber="2256"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>;</Highlight></CodeLine>
<Link id="l02257" /><CodeLine lineNumber="2257"><Highlight kind="normal">    <a href="/docs/api/classes/vectortype">VectorType</a> &#42;XVTy = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VectorType&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>-&gt;getType());</Highlight></CodeLine>
<Link id="l02258" /><CodeLine lineNumber="2258"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (XVTy &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>-&gt;getType()))</Highlight></CodeLine>
<Link id="l02259" /><CodeLine lineNumber="2259"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a> = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateVectorSplat(XVTy-&gt;getElementCount(), <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</Highlight></CodeLine>
<Link id="l02260" /><CodeLine lineNumber="2260"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateMul(<a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#ab60f28d7a141ac46ccc200176a1bca8b">X</a>, <a href="/docs/api/files/lib/lib/tablegen/tablegenbackendskeleton-cpp/#a262774d3e5186511427e5b2414a85f7f">Y</a>);</Highlight></CodeLine>
<Link id="l02261" /><CodeLine lineNumber="2261"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02262" /><CodeLine lineNumber="2262"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02263" /><CodeLine lineNumber="2263"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (InductionKind) &#123;</Highlight></CodeLine>
<Link id="l02264" /><CodeLine lineNumber="2264"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabccaf0191e822c9708e106d7bb58aa9ec947">InductionDescriptor::IK&#95;IntInduction</a>: &#123;</Highlight></CodeLine>
<Link id="l02265" /><CodeLine lineNumber="2265"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(Index-&gt;getType()) &amp;&amp;</Highlight></CodeLine>
<Link id="l02266" /><CodeLine lineNumber="2266"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Vector indices not supported for integer inductions yet&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02267" /><CodeLine lineNumber="2267"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Index-&gt;getType() == StartValue-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l02268" /><CodeLine lineNumber="2268"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Index type does not match StartValue type&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02269" /><CodeLine lineNumber="2269"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ConstantInt&gt;</a>(Step) &amp;&amp; <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ConstantInt&gt;</a>(Step)-&gt;isMinusOne())</Highlight></CodeLine>
<Link id="l02270" /><CodeLine lineNumber="2270"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateSub(StartValue, Index);</Highlight></CodeLine>
<Link id="l02271" /><CodeLine lineNumber="2271"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a> = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/reassociate-cpp/#a3621b702ef72b987959cdd7242c13d47">CreateMul</a>(Index, Step);</Highlight></CodeLine>
<Link id="l02272" /><CodeLine lineNumber="2272"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/reassociate-cpp/#a4b946333b7fb96fec126f22534cf3794">CreateAdd</a>(StartValue, <a href="/docs/api/namespaces/llvm/#a05f5b9a11bdcc5feba62899f95dcf878a3134224cba2545bc57954d3b072aebb4">Offset</a>);</Highlight></CodeLine>
<Link id="l02273" /><CodeLine lineNumber="2273"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02274" /><CodeLine lineNumber="2274"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabccab61689ca7d0a024fc4ff52a74d691ae2">InductionDescriptor::IK&#95;PtrInduction</a>:</Highlight></CodeLine>
<Link id="l02275" /><CodeLine lineNumber="2275"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreatePtrAdd(StartValue, <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/reassociate-cpp/#a3621b702ef72b987959cdd7242c13d47">CreateMul</a>(Index, Step));</Highlight></CodeLine>
<Link id="l02276" /><CodeLine lineNumber="2276"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabccab0b71801de025f26b088a8cb22825f79">InductionDescriptor::IK&#95;FpInduction</a>: &#123;</Highlight></CodeLine>
<Link id="l02277" /><CodeLine lineNumber="2277"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(Index-&gt;getType()) &amp;&amp;</Highlight></CodeLine>
<Link id="l02278" /><CodeLine lineNumber="2278"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Vector indices not supported for FP inductions yet&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02279" /><CodeLine lineNumber="2279"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Step-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected FP Step value&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02280" /><CodeLine lineNumber="2280"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(InductionBinOp &amp;&amp;</Highlight></CodeLine>
<Link id="l02281" /><CodeLine lineNumber="2281"><Highlight kind="normal">           (InductionBinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::FAdd ||</Highlight></CodeLine>
<Link id="l02282" /><CodeLine lineNumber="2282"><Highlight kind="normal">            InductionBinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>() == Instruction::FSub) &amp;&amp;</Highlight></CodeLine>
<Link id="l02283" /><CodeLine lineNumber="2283"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Original bin op should be defined for FP induction&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02284" /><CodeLine lineNumber="2284"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02285" /><CodeLine lineNumber="2285"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;MulExp = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateFMul(Step, Index);</Highlight></CodeLine>
<Link id="l02286" /><CodeLine lineNumber="2286"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.CreateBinOp(InductionBinOp-&gt;<a href="/docs/api/classes/llvm/binaryoperator/#a31bf07f3f61525486633bc1d0bbaf029">getOpcode</a>(), StartValue, MulExp,</Highlight></CodeLine>
<Link id="l02287" /><CodeLine lineNumber="2287"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;induction&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02288" /><CodeLine lineNumber="2288"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02289" /><CodeLine lineNumber="2289"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabcca85d6fca1e5ba292e9d884797aa73f545">InductionDescriptor::IK&#95;NoInduction</a>:</Highlight></CodeLine>
<Link id="l02290" /><CodeLine lineNumber="2290"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02291" /><CodeLine lineNumber="2291"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02292" /><CodeLine lineNumber="2292"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;invalid enum&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02293" /><CodeLine lineNumber="2293"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02294" /><CodeLine lineNumber="2294"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02295" /><CodeLine lineNumber="2295" lineLink="#a604c96744d2e46447f11e2d3aab9a9b2"><Highlight kind="normal">std::optional&lt;unsigned&gt; <a href="#a604c96744d2e46447f11e2d3aab9a9b2">getMaxVScale</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</Highlight></CodeLine>
<Link id="l02296" /><CodeLine lineNumber="2296"><Highlight kind="normal">                                     </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</Highlight></CodeLine>
<Link id="l02297" /><CodeLine lineNumber="2297"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (std::optional&lt;unsigned&gt; MaxVScale = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getMaxVScale())</Highlight></CodeLine>
<Link id="l02298" /><CodeLine lineNumber="2298"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MaxVScale;</Highlight></CodeLine>
<Link id="l02299" /><CodeLine lineNumber="2299"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02300" /><CodeLine lineNumber="2300"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.hasFnAttribute(Attribute::VScaleRange))</Highlight></CodeLine>
<Link id="l02301" /><CodeLine lineNumber="2301"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getFnAttribute(Attribute::VScaleRange).getVScaleRangeMax();</Highlight></CodeLine>
<Link id="l02302" /><CodeLine lineNumber="2302"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02303" /><CodeLine lineNumber="2303"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l02304" /><CodeLine lineNumber="2304"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02305" /><CodeLine lineNumber="2305"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02306" /><CodeLine lineNumber="2306"><Highlight kind="comment">/// For the given VF and UF and maximum trip count computed for the loop, return</Highlight></CodeLine>
<Link id="l02307" /><CodeLine lineNumber="2307"><Highlight kind="comment">/// whether the induction variable might overflow in the vectorized loop. If not,</Highlight></CodeLine>
<Link id="l02308" /><CodeLine lineNumber="2308"><Highlight kind="comment">/// then we know a runtime overflow check always evaluates to false and can be</Highlight></CodeLine>
<Link id="l02309" /><CodeLine lineNumber="2309"><Highlight kind="comment">/// removed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02310" /><CodeLine lineNumber="2310" lineLink="#ab7edde995b7986f98c3f59788b960eba"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#ab7edde995b7986f98c3f59788b960eba">isIndvarOverflowCheckKnownFalse</a>(</Highlight></CodeLine>
<Link id="l02311" /><CodeLine lineNumber="2311"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> &#42;<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>,</Highlight></CodeLine>
<Link id="l02312" /><CodeLine lineNumber="2312"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, std::optional&lt;unsigned&gt; UF = std::nullopt) &#123;</Highlight></CodeLine>
<Link id="l02313" /><CodeLine lineNumber="2313"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Always be conservative if we don&#39;t know the exact unroll factor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02314" /><CodeLine lineNumber="2314"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxUF = UF ? &#42;UF : <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>-&gt;TTI.getMaxInterleaveFactor(VF);</Highlight></CodeLine>
<Link id="l02315" /><CodeLine lineNumber="2315"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02316" /><CodeLine lineNumber="2316"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;IdxTy = <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>-&gt;Legal-&gt;getWidestInductionType();</Highlight></CodeLine>
<Link id="l02317" /><CodeLine lineNumber="2317"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/apint">APInt</a> MaxUIntTripCount = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(IdxTy)-&gt;getMask();</Highlight></CodeLine>
<Link id="l02318" /><CodeLine lineNumber="2318"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02319" /><CodeLine lineNumber="2319"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We know the runtime overflow check is known false iff the (max) trip-count</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02320" /><CodeLine lineNumber="2320"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is known and (max) trip-count + (VF &#42; UF) does not overflow in the type of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02321" /><CodeLine lineNumber="2321"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the vector loop induction variable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02322" /><CodeLine lineNumber="2322"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> TC = <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>-&gt;PSE.getSmallConstantMaxTripCount()) &#123;</Highlight></CodeLine>
<Link id="l02323" /><CodeLine lineNumber="2323"><Highlight kind="normal">    uint64&#95;t MaxVF = VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>();</Highlight></CodeLine>
<Link id="l02324" /><CodeLine lineNumber="2324"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>()) &#123;</Highlight></CodeLine>
<Link id="l02325" /><CodeLine lineNumber="2325"><Highlight kind="normal">      std::optional&lt;unsigned&gt; MaxVScale =</Highlight></CodeLine>
<Link id="l02326" /><CodeLine lineNumber="2326"><Highlight kind="normal">          <a href="#a604c96744d2e46447f11e2d3aab9a9b2">getMaxVScale</a>(&#42;<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>-&gt;TheFunction, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>-&gt;TTI);</Highlight></CodeLine>
<Link id="l02327" /><CodeLine lineNumber="2327"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MaxVScale)</Highlight></CodeLine>
<Link id="l02328" /><CodeLine lineNumber="2328"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02329" /><CodeLine lineNumber="2329"><Highlight kind="normal">      MaxVF &#42;= &#42;MaxVScale;</Highlight></CodeLine>
<Link id="l02330" /><CodeLine lineNumber="2330"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02331" /><CodeLine lineNumber="2331"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02332" /><CodeLine lineNumber="2332"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> (MaxUIntTripCount - TC).ugt(MaxVF &#42; MaxUF);</Highlight></CodeLine>
<Link id="l02333" /><CodeLine lineNumber="2333"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02334" /><CodeLine lineNumber="2334"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02335" /><CodeLine lineNumber="2335"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02336" /><CodeLine lineNumber="2336"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02337" /><CodeLine lineNumber="2337"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02338" /><CodeLine lineNumber="2338"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Return whether we allow using masked interleave-groups (for dealing with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02339" /><CodeLine lineNumber="2339"><Highlight kind="normal"></Highlight><Highlight kind="comment">// strided loads/stores that reside in predicated blocks, or for dealing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02340" /><CodeLine lineNumber="2340"><Highlight kind="normal"></Highlight><Highlight kind="comment">// with gaps).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02341" /><CodeLine lineNumber="2341" lineLink="#adf8d8fb6f39b9c0cf21d55b7229d35e2"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#adf8d8fb6f39b9c0cf21d55b7229d35e2">useMaskedInterleavedAccesses</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</Highlight></CodeLine>
<Link id="l02342" /><CodeLine lineNumber="2342"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If an override option has been passed in for interleaved accesses, use it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02343" /><CodeLine lineNumber="2343"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#ac68ad295befb7187ae293cc0faaa3ac3">EnableMaskedInterleavedMemAccesses</a>.getNumOccurrences() &gt; 0)</Highlight></CodeLine>
<Link id="l02344" /><CodeLine lineNumber="2344"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#ac68ad295befb7187ae293cc0faaa3ac3">EnableMaskedInterleavedMemAccesses</a>;</Highlight></CodeLine>
<Link id="l02345" /><CodeLine lineNumber="2345"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02346" /><CodeLine lineNumber="2346"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.enableMaskedInterleavedAccessVectorization();</Highlight></CodeLine>
<Link id="l02347" /><CodeLine lineNumber="2347"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02348" /><CodeLine lineNumber="2348"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02349" /><CodeLine lineNumber="2349" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a4690286163882c35068b1908f4d752fd"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a4690286163882c35068b1908f4d752fd">InnerLoopVectorizer::scalarizeInstruction</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr,</Highlight></CodeLine>
<Link id="l02350" /><CodeLine lineNumber="2350"><Highlight kind="normal">                                               <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a> &#42;RepRecipe,</Highlight></CodeLine>
<Link id="l02351" /><CodeLine lineNumber="2351"><Highlight kind="normal">                                               </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vplane">VPLane</a> &amp;Lane,</Highlight></CodeLine>
<Link id="l02352" /><CodeLine lineNumber="2352"><Highlight kind="normal">                                               <a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State) &#123;</Highlight></CodeLine>
<Link id="l02353" /><CodeLine lineNumber="2353"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Instr-&gt;getType()-&gt;isAggregateType() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Can&#39;t handle vectors&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02354" /><CodeLine lineNumber="2354"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02355" /><CodeLine lineNumber="2355"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Does this instruction return a value ?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02356" /><CodeLine lineNumber="2356"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsVoidRetTy = Instr-&gt;getType()-&gt;isVoidTy();</Highlight></CodeLine>
<Link id="l02357" /><CodeLine lineNumber="2357"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02358" /><CodeLine lineNumber="2358"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Cloned = Instr-&gt;clone();</Highlight></CodeLine>
<Link id="l02359" /><CodeLine lineNumber="2359"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IsVoidRetTy) &#123;</Highlight></CodeLine>
<Link id="l02360" /><CodeLine lineNumber="2360"><Highlight kind="normal">    Cloned-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(Instr-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;.cloned&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02361" /><CodeLine lineNumber="2361"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#if !defined(NDEBUG)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02362" /><CodeLine lineNumber="2362"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Verify that VPlan type inference results agree with the type of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02363" /><CodeLine lineNumber="2363"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// generated values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02364" /><CodeLine lineNumber="2364"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(State.TypeAnalysis.inferScalarType(RepRecipe) == Cloned-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l02365" /><CodeLine lineNumber="2365"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;inferred type and type from generated instructions do not match&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02366" /><CodeLine lineNumber="2366"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02367" /><CodeLine lineNumber="2367"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02368" /><CodeLine lineNumber="2368"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02369" /><CodeLine lineNumber="2369"><Highlight kind="normal">  RepRecipe-&gt;<a href="/docs/api/classes/llvm/vprecipewithirflags/#a3864f5d4ddd326182fa0499094807f2a">setFlags</a>(Cloned);</Highlight></CodeLine>
<Link id="l02370" /><CodeLine lineNumber="2370"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02371" /><CodeLine lineNumber="2371"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = Instr-&gt;getDebugLoc())</Highlight></CodeLine>
<Link id="l02372" /><CodeLine lineNumber="2372"><Highlight kind="normal">    State.setDebugLocFrom(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l02373" /><CodeLine lineNumber="2373"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02374" /><CodeLine lineNumber="2374"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace the operands of the cloned instructions with their scalar</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02375" /><CodeLine lineNumber="2375"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// equivalents in the new loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02376" /><CodeLine lineNumber="2376"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(RepRecipe-&gt;<a href="/docs/api/classes/llvm/vpuser/#a11d83265a9e4ff6c6ecd3cf222ad0208">operands</a>())) &#123;</Highlight></CodeLine>
<Link id="l02377" /><CodeLine lineNumber="2377"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> InputLane = Lane;</Highlight></CodeLine>
<Link id="l02378" /><CodeLine lineNumber="2378"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Operand = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.value();</Highlight></CodeLine>
<Link id="l02379" /><CodeLine lineNumber="2379"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/vputils/#a002a77cdbc23293b8f7a8458ffd0f905">vputils::isUniformAfterVectorization</a>(Operand))</Highlight></CodeLine>
<Link id="l02380" /><CodeLine lineNumber="2380"><Highlight kind="normal">      InputLane = <a href="/docs/api/classes/llvm/vplane/#af6be7b0459911799a13a8174138c7020">VPLane::getFirstLane</a>();</Highlight></CodeLine>
<Link id="l02381" /><CodeLine lineNumber="2381"><Highlight kind="normal">    Cloned-&gt;<a href="/docs/api/classes/llvm/user/#a5fa9b8e1842b354f64c1ba6be0a4a17f">setOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.index(), State.get(Operand, InputLane));</Highlight></CodeLine>
<Link id="l02382" /><CodeLine lineNumber="2382"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02383" /><CodeLine lineNumber="2383"><Highlight kind="normal">  State.addNewMetadata(Cloned, Instr);</Highlight></CodeLine>
<Link id="l02384" /><CodeLine lineNumber="2384"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02385" /><CodeLine lineNumber="2385"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Place the cloned scalar in the new loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02386" /><CodeLine lineNumber="2386"><Highlight kind="normal">  State.Builder.Insert(Cloned);</Highlight></CodeLine>
<Link id="l02387" /><CodeLine lineNumber="2387"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02388" /><CodeLine lineNumber="2388"><Highlight kind="normal">  State.set(RepRecipe, Cloned, Lane);</Highlight></CodeLine>
<Link id="l02389" /><CodeLine lineNumber="2389"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02390" /><CodeLine lineNumber="2390"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we just cloned a new assumption, add it the assumption cache.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02391" /><CodeLine lineNumber="2391"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AssumeInst&gt;</a>(Cloned))</Highlight></CodeLine>
<Link id="l02392" /><CodeLine lineNumber="2392"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#aa7526ec0b5613cd07130c3d097799534">AC</a>-&gt;registerAssumption(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l02393" /><CodeLine lineNumber="2393"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02394" /><CodeLine lineNumber="2394"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// End if-block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02395" /><CodeLine lineNumber="2395"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;Parent = RepRecipe-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a09de70cbaf2f15aa3b0697b5f378cc9d">getParent</a>();</Highlight></CodeLine>
<Link id="l02396" /><CodeLine lineNumber="2396"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IfPredicateInstr = Parent ? Parent-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#a24555c6ed92715d80348f0991a6d55df">isReplicator</a>() : </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02397" /><CodeLine lineNumber="2397"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l02398" /><CodeLine lineNumber="2398"><Highlight kind="normal">      (Parent || !RepRecipe-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a8d57e2fe646928a51e97714005eefdc7">getPlan</a>()-&gt;<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>() ||</Highlight></CodeLine>
<Link id="l02399" /><CodeLine lineNumber="2399"><Highlight kind="normal">       <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(RepRecipe-&gt;<a href="/docs/api/classes/llvm/vpuser/#a11d83265a9e4ff6c6ecd3cf222ad0208">operands</a>(),</Highlight></CodeLine>
<Link id="l02400" /><CodeLine lineNumber="2400"><Highlight kind="normal">              &#91;&#93;(<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123; return Op-&gt;isDefinedOutsideLoopRegions(); &#125;)) &amp;&amp;</Highlight></CodeLine>
<Link id="l02401" /><CodeLine lineNumber="2401"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;Expected a recipe is either within a region or all of its operands &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02402" /><CodeLine lineNumber="2402"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;are defined outside the vectorized region.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02403" /><CodeLine lineNumber="2403"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IfPredicateInstr)</Highlight></CodeLine>
<Link id="l02404" /><CodeLine lineNumber="2404"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#a47eab9fa7cfa73af0b164da3fca49a0f">PredicatedInstructions</a>.push&#95;back(Cloned);</Highlight></CodeLine>
<Link id="l02405" /><CodeLine lineNumber="2405"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02406" /><CodeLine lineNumber="2406"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02407" /><CodeLine lineNumber="2407"><Highlight kind="normal"><a href="/docs/api/classes/llvm/value">Value</a> &#42;</Highlight></CodeLine>
<Link id="l02408" /><CodeLine lineNumber="2408" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#aa83b181aa14d5afe1390faad388f91a4"><Highlight kind="normal"><a href="/docs/api/classes/llvm/innerloopvectorizer/#aa83b181aa14d5afe1390faad388f91a4">InnerLoopVectorizer::getOrCreateVectorTripCount</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;InsertBlock) &#123;</Highlight></CodeLine>
<Link id="l02409" /><CodeLine lineNumber="2409"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/innerloopvectorizer/#a2c95f95757d9c56b7a89d7f8b3278581">VectorTripCount</a>)</Highlight></CodeLine>
<Link id="l02410" /><CodeLine lineNumber="2410"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a2c95f95757d9c56b7a89d7f8b3278581">VectorTripCount</a>;</Highlight></CodeLine>
<Link id="l02411" /><CodeLine lineNumber="2411"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02412" /><CodeLine lineNumber="2412"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;TC = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696">getTripCount</a>();</Highlight></CodeLine>
<Link id="l02413" /><CodeLine lineNumber="2413"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>(InsertBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l02414" /><CodeLine lineNumber="2414"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02415" /><CodeLine lineNumber="2415"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty = TC-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l02416" /><CodeLine lineNumber="2416"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is where we can make the step a runtime constant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02417" /><CodeLine lineNumber="2417"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Step = <a href="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e">createStepForVF</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>, Ty, <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>);</Highlight></CodeLine>
<Link id="l02418" /><CodeLine lineNumber="2418"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02419" /><CodeLine lineNumber="2419"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the tail is to be folded by masking, round the number of iterations N</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02420" /><CodeLine lineNumber="2420"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// up to a multiple of Step instead of rounding down. This is done by first</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02421" /><CodeLine lineNumber="2421"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// adding Step-1 and then rounding down. Note that it&#39;s ok if this addition</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02422" /><CodeLine lineNumber="2422"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// overflows: the vector induction variable will eventually wrap to zero given</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02423" /><CodeLine lineNumber="2423"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that it starts at zero and its Step is a power of two; the loop will then</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02424" /><CodeLine lineNumber="2424"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// exit, with the last early-exit vector comparison also producing all-true.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02425" /><CodeLine lineNumber="2425"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For scalable vectors the VF is not guaranteed to be a power of 2, but this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02426" /><CodeLine lineNumber="2426"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is accounted for in emitIterationCountCheck that adds an overflow check.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02427" /><CodeLine lineNumber="2427"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>-&gt;foldTailByMasking()) &#123;</Highlight></CodeLine>
<Link id="l02428" /><CodeLine lineNumber="2428"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.getKnownMinValue() &#42; <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l02429" /><CodeLine lineNumber="2429"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;VF&#42;UF must be a power of 2 when folding tail by masking&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02430" /><CodeLine lineNumber="2430"><Highlight kind="normal">    TC = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateAdd(TC, <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateSub(Step, ConstantInt::get(Ty, 1)),</Highlight></CodeLine>
<Link id="l02431" /><CodeLine lineNumber="2431"><Highlight kind="normal">                           </Highlight><Highlight kind="stringliteral">&quot;n.rnd.up&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02432" /><CodeLine lineNumber="2432"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02433" /><CodeLine lineNumber="2433"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02434" /><CodeLine lineNumber="2434"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now we need to generate the expression for the part of the loop that the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02435" /><CodeLine lineNumber="2435"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vectorized body will execute. This is equal to N - (N % Step) if scalar</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02436" /><CodeLine lineNumber="2436"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// iterations are not required for correctness, or N - Step, otherwise. Step</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02437" /><CodeLine lineNumber="2437"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is equal to the vectorization factor (number of SIMD elements) times the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02438" /><CodeLine lineNumber="2438"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// unroll factor (number of SIMD instructions).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02439" /><CodeLine lineNumber="2439"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;R = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateURem(TC, Step, </Highlight><Highlight kind="stringliteral">&quot;n.mod.vf&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02440" /><CodeLine lineNumber="2440"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02441" /><CodeLine lineNumber="2441"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// There are cases where we &#42;must&#42; run at least one iteration in the remainder</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02442" /><CodeLine lineNumber="2442"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// loop.  See the cost model for when this can happen.  If the step evenly</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02443" /><CodeLine lineNumber="2443"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// divides the trip count, we set the remainder to be equal to the step. If</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02444" /><CodeLine lineNumber="2444"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the step does not evenly divide the trip count, no adjustment is necessary</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02445" /><CodeLine lineNumber="2445"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// since there will already be scalar iterations. Note that the minimum</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02446" /><CodeLine lineNumber="2446"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// iterations check ensures that N &gt;= Step.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02447" /><CodeLine lineNumber="2447"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>-&gt;requiresScalarEpilogue(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.isVector())) &#123;</Highlight></CodeLine>
<Link id="l02448" /><CodeLine lineNumber="2448"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IsZero = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateICmpEQ(R, ConstantInt::get(R-&gt;getType(), 0));</Highlight></CodeLine>
<Link id="l02449" /><CodeLine lineNumber="2449"><Highlight kind="normal">    R = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateSelect(IsZero, Step, R);</Highlight></CodeLine>
<Link id="l02450" /><CodeLine lineNumber="2450"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02451" /><CodeLine lineNumber="2451"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02452" /><CodeLine lineNumber="2452"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a2c95f95757d9c56b7a89d7f8b3278581">VectorTripCount</a> = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateSub(TC, R, </Highlight><Highlight kind="stringliteral">&quot;n.vec&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02453" /><CodeLine lineNumber="2453"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02454" /><CodeLine lineNumber="2454"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a2c95f95757d9c56b7a89d7f8b3278581">VectorTripCount</a>;</Highlight></CodeLine>
<Link id="l02455" /><CodeLine lineNumber="2455"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02456" /><CodeLine lineNumber="2456"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02457" /><CodeLine lineNumber="2457" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9">InnerLoopVectorizer::introduceCheckBlockInVPlan</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CheckIRBB) &#123;</Highlight></CodeLine>
<Link id="l02458" /><CodeLine lineNumber="2458"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;ScalarPH = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.getScalarPreheader();</Highlight></CodeLine>
<Link id="l02459" /><CodeLine lineNumber="2459"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpblockbase">VPBlockBase</a> &#42;PreVectorPH = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6b18db1093ed5460e67e9058b89e385b">VectorPHVPB</a>-&gt;getSinglePredecessor();</Highlight></CodeLine>
<Link id="l02460" /><CodeLine lineNumber="2460"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PreVectorPH-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a2c13ffed8c55e1b8dd38fedc7e71e7a8">getNumSuccessors</a>() != 1) &#123;</Highlight></CodeLine>
<Link id="l02461" /><CodeLine lineNumber="2461"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PreVectorPH-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a2c13ffed8c55e1b8dd38fedc7e71e7a8">getNumSuccessors</a>() == 2 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected 2 successors&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02462" /><CodeLine lineNumber="2462"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(PreVectorPH-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aeccf6a036968755c6d86e2d2bb17673a">getSuccessors</a>()&#91;0&#93; == ScalarPH &amp;&amp;</Highlight></CodeLine>
<Link id="l02463" /><CodeLine lineNumber="2463"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Unexpected successor&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02464" /><CodeLine lineNumber="2464"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> &#42;CheckVPIRBB = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.createVPIRBasicBlock(CheckIRBB);</Highlight></CodeLine>
<Link id="l02465" /><CodeLine lineNumber="2465"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpblockutils/#a2057d0749eedf6749f9e1cc6694eb1fd">VPBlockUtils::insertOnEdge</a>(PreVectorPH, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6b18db1093ed5460e67e9058b89e385b">VectorPHVPB</a>, CheckVPIRBB);</Highlight></CodeLine>
<Link id="l02466" /><CodeLine lineNumber="2466"><Highlight kind="normal">    PreVectorPH = CheckVPIRBB;</Highlight></CodeLine>
<Link id="l02467" /><CodeLine lineNumber="2467"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02468" /><CodeLine lineNumber="2468"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpblockutils/#a40bc7fec35d7093efcdbadf566d6b5ee">VPBlockUtils::connectBlocks</a>(PreVectorPH, ScalarPH);</Highlight></CodeLine>
<Link id="l02469" /><CodeLine lineNumber="2469"><Highlight kind="normal">  PreVectorPH-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a43f7e15ac1a813112684effc1e5593a4">swapSuccessors</a>();</Highlight></CodeLine>
<Link id="l02470" /><CodeLine lineNumber="2470"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02471" /><CodeLine lineNumber="2471"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02472" /><CodeLine lineNumber="2472" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a72c491cdf8cf0283d87008831431f917"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a72c491cdf8cf0283d87008831431f917">InnerLoopVectorizer::emitIterationCountCheck</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass) &#123;</Highlight></CodeLine>
<Link id="l02473" /><CodeLine lineNumber="2473"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696">getTripCount</a>();</Highlight></CodeLine>
<Link id="l02474" /><CodeLine lineNumber="2474"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Reuse existing vector loop preheader for TC checks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02475" /><CodeLine lineNumber="2475"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note that new preheader block is generated for vector loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02476" /><CodeLine lineNumber="2476"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> TCCheckBlock = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>;</Highlight></CodeLine>
<Link id="l02477" /><CodeLine lineNumber="2477"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>(TCCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l02478" /><CodeLine lineNumber="2478"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02479" /><CodeLine lineNumber="2479"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Generate code to check if the loop&#39;s trip count is less than VF &#42; UF, or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02480" /><CodeLine lineNumber="2480"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// equal to it in case a scalar epilogue is required; this implies that the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02481" /><CodeLine lineNumber="2481"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vector trip count is zero. This check also covers the case where adding one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02482" /><CodeLine lineNumber="2482"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to the backedge-taken count overflowed leading to an incorrect trip count</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02483" /><CodeLine lineNumber="2483"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of zero. In this case we will also jump to the scalar loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02484" /><CodeLine lineNumber="2484"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>-&gt;requiresScalarEpilogue(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.isVector()) ? <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">ICmpInst::ICMP&#95;ULE</a></Highlight></CodeLine>
<Link id="l02485" /><CodeLine lineNumber="2485"><Highlight kind="normal">                                                       : <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>;</Highlight></CodeLine>
<Link id="l02486" /><CodeLine lineNumber="2486"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02487" /><CodeLine lineNumber="2487"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If tail is to be folded, vector loop takes care of all iterations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02488" /><CodeLine lineNumber="2488"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;CountTy = <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>-&gt;getType();</Highlight></CodeLine>
<Link id="l02489" /><CodeLine lineNumber="2489"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CheckMinIters = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.getFalse();</Highlight></CodeLine>
<Link id="l02490" /><CodeLine lineNumber="2490"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CreateStep = &#91;&amp;&#93;() -&gt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l02491" /><CodeLine lineNumber="2491"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Create step with max(MinProTripCount, UF &#42; VF).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02492" /><CodeLine lineNumber="2492"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a> &#42; <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.getKnownMinValue() &gt;= <a href="/docs/api/classes/llvm/innerloopvectorizer/#a1f52585230b8a3cb8bf4a30f8e51bfb4">MinProfitableTripCount</a>.getKnownMinValue())</Highlight></CodeLine>
<Link id="l02493" /><CodeLine lineNumber="2493"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e">createStepForVF</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>, CountTy, <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>);</Highlight></CodeLine>
<Link id="l02494" /><CodeLine lineNumber="2494"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02495" /><CodeLine lineNumber="2495"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;MinProfTC =</Highlight></CodeLine>
<Link id="l02496" /><CodeLine lineNumber="2496"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e">createStepForVF</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>, CountTy, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a1f52585230b8a3cb8bf4a30f8e51bfb4">MinProfitableTripCount</a>, 1);</Highlight></CodeLine>
<Link id="l02497" /><CodeLine lineNumber="2497"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.isScalable())</Highlight></CodeLine>
<Link id="l02498" /><CodeLine lineNumber="2498"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MinProfTC;</Highlight></CodeLine>
<Link id="l02499" /><CodeLine lineNumber="2499"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateBinaryIntrinsic(</Highlight></CodeLine>
<Link id="l02500" /><CodeLine lineNumber="2500"><Highlight kind="normal">        Intrinsic::umax, MinProfTC, <a href="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e">createStepForVF</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>, CountTy, <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>));</Highlight></CodeLine>
<Link id="l02501" /><CodeLine lineNumber="2501"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02502" /><CodeLine lineNumber="2502"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02503" /><CodeLine lineNumber="2503"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> Style = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>-&gt;getTailFoldingStyle();</Highlight></CodeLine>
<Link id="l02504" /><CodeLine lineNumber="2504"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Style == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>) &#123;</Highlight></CodeLine>
<Link id="l02505" /><CodeLine lineNumber="2505"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Step = CreateStep();</Highlight></CodeLine>
<Link id="l02506" /><CodeLine lineNumber="2506"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE = &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>.getSE();</Highlight></CodeLine>
<Link id="l02507" /><CodeLine lineNumber="2507"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Emit unconditional branch to vector preheader instead of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02508" /><CodeLine lineNumber="2508"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// conditional branch with known condition.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02509" /><CodeLine lineNumber="2509"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;TripCountSCEV = SE.<a href="/docs/api/classes/llvm/scalarevolution/#ad146072469181af4ccb7ef03c28999ba">applyLoopGuards</a>(SE.<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>), <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>);</Highlight></CodeLine>
<Link id="l02510" /><CodeLine lineNumber="2510"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if the trip count is &lt; the step.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02511" /><CodeLine lineNumber="2511"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SE.<a href="/docs/api/classes/llvm/scalarevolution/#af74112dae88db73eb5484821b6f0fccd">isKnownPredicate</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, TripCountSCEV, SE.<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Step))) &#123;</Highlight></CodeLine>
<Link id="l02512" /><CodeLine lineNumber="2512"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: Ensure step is at most the trip count when determining max VF and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02513" /><CodeLine lineNumber="2513"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// UF, w/o tail folding.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02514" /><CodeLine lineNumber="2514"><Highlight kind="normal">      CheckMinIters = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.getTrue();</Highlight></CodeLine>
<Link id="l02515" /><CodeLine lineNumber="2515"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SE.<a href="/docs/api/classes/llvm/scalarevolution/#af74112dae88db73eb5484821b6f0fccd">isKnownPredicate</a>(<a href="/docs/api/classes/llvm/cmpinst/#aa2a54b545d237ecfe450fd1292f7675e">CmpInst::getInversePredicate</a>(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>),</Highlight></CodeLine>
<Link id="l02516" /><CodeLine lineNumber="2516"><Highlight kind="normal">                                    TripCountSCEV, SE.<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(Step))) &#123;</Highlight></CodeLine>
<Link id="l02517" /><CodeLine lineNumber="2517"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Generate the minimum iteration check only if we cannot prove the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02518" /><CodeLine lineNumber="2518"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// check is known to be true, or known to be false.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02519" /><CodeLine lineNumber="2519"><Highlight kind="normal">      CheckMinIters = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateICmp(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>, Step, </Highlight><Highlight kind="stringliteral">&quot;min.iters.check&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02520" /><CodeLine lineNumber="2520"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="comment">// else step known to be &lt; trip count, use CheckMinIters preset to false.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02521" /><CodeLine lineNumber="2521"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.isScalable() &amp;&amp;</Highlight></CodeLine>
<Link id="l02522" /><CodeLine lineNumber="2522"><Highlight kind="normal">             !<a href="#ab7edde995b7986f98c3f59788b960eba">isIndvarOverflowCheckKnownFalse</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l02523" /><CodeLine lineNumber="2523"><Highlight kind="normal">             Style != <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">TailFoldingStyle::DataAndControlFlowWithoutRuntimeCheck</a>) &#123;</Highlight></CodeLine>
<Link id="l02524" /><CodeLine lineNumber="2524"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// vscale is not necessarily a power-of-2, which means we cannot guarantee</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02525" /><CodeLine lineNumber="2525"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// an overflow to zero when updating induction variables and so an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02526" /><CodeLine lineNumber="2526"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// additional overflow check is required before entering the vector loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02527" /><CodeLine lineNumber="2527"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02528" /><CodeLine lineNumber="2528"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Get the maximum unsigned value for the type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02529" /><CodeLine lineNumber="2529"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;MaxUIntTripCount =</Highlight></CodeLine>
<Link id="l02530" /><CodeLine lineNumber="2530"><Highlight kind="normal">        ConstantInt::get(CountTy, <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntegerType&gt;</a>(CountTy)-&gt;getMask());</Highlight></CodeLine>
<Link id="l02531" /><CodeLine lineNumber="2531"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;LHS = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateSub(MaxUIntTripCount, <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>);</Highlight></CodeLine>
<Link id="l02532" /><CodeLine lineNumber="2532"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02533" /><CodeLine lineNumber="2533"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t execute the vector loop if (UMax - n) &lt; (VF &#42; UF).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02534" /><CodeLine lineNumber="2534"><Highlight kind="normal">    CheckMinIters = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateICmp(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>, LHS, CreateStep());</Highlight></CodeLine>
<Link id="l02535" /><CodeLine lineNumber="2535"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02536" /><CodeLine lineNumber="2536"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02537" /><CodeLine lineNumber="2537"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create new preheader for vector loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02538" /><CodeLine lineNumber="2538"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a> =</Highlight></CodeLine>
<Link id="l02539" /><CodeLine lineNumber="2539"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(TCCheckBlock, TCCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02540" /><CodeLine lineNumber="2540"><Highlight kind="normal">                 </Highlight><Highlight kind="stringliteral">&quot;vector.ph&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02541" /><CodeLine lineNumber="2541"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02542" /><CodeLine lineNumber="2542"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;properlyDominates(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;getNode(TCCheckBlock),</Highlight></CodeLine>
<Link id="l02543" /><CodeLine lineNumber="2543"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;getNode(Bypass)-&gt;getIDom()) &amp;&amp;</Highlight></CodeLine>
<Link id="l02544" /><CodeLine lineNumber="2544"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;TC check is expected to dominate Bypass&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02545" /><CodeLine lineNumber="2545"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02546" /><CodeLine lineNumber="2546"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &amp;BI =</Highlight></CodeLine>
<Link id="l02547" /><CodeLine lineNumber="2547"><Highlight kind="normal">      &#42;<a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(Bypass, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>, CheckMinIters);</Highlight></CodeLine>
<Link id="l02548" /><CodeLine lineNumber="2548"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getLoopLatch()-&gt;getTerminator()))</Highlight></CodeLine>
<Link id="l02549" /><CodeLine lineNumber="2549"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(BI, <a href="#a629884e9a99a9f49106db9e5e6252fcb">MinItersBypassWeights</a>, </Highlight><Highlight kind="comment">/&#42;IsExpected=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02550" /><CodeLine lineNumber="2550"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a016a85f7487f995fe80141e102a7a5ae">ReplaceInstWithInst</a>(TCCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), &amp;BI);</Highlight></CodeLine>
<Link id="l02551" /><CodeLine lineNumber="2551"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(TCCheckBlock);</Highlight></CodeLine>
<Link id="l02552" /><CodeLine lineNumber="2552"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02553" /><CodeLine lineNumber="2553"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Wrap LoopVectorPreHeader in VPIRBasicBlock here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02554" /><CodeLine lineNumber="2554"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9">introduceCheckBlockInVPlan</a>(TCCheckBlock);</Highlight></CodeLine>
<Link id="l02555" /><CodeLine lineNumber="2555"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02556" /><CodeLine lineNumber="2556"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02557" /><CodeLine lineNumber="2557" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a30c4bcea7beb42c7eb075a578bc3bc3e"><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a30c4bcea7beb42c7eb075a578bc3bc3e">InnerLoopVectorizer::emitSCEVChecks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass) &#123;</Highlight></CodeLine>
<Link id="l02558" /><CodeLine lineNumber="2558"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SCEVCheckBlock =</Highlight></CodeLine>
<Link id="l02559" /><CodeLine lineNumber="2559"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae9880a8edd20b3b9b1527ecd5a03ac8c">RTChecks</a>.emitSCEVChecks(Bypass, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>);</Highlight></CodeLine>
<Link id="l02560" /><CodeLine lineNumber="2560"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SCEVCheckBlock)</Highlight></CodeLine>
<Link id="l02561" /><CodeLine lineNumber="2561"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02562" /><CodeLine lineNumber="2562"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02563" /><CodeLine lineNumber="2563"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!(SCEVCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a1c455e007178a24dfb18ac0e200ea02c">hasOptSize</a>() ||</Highlight></CodeLine>
<Link id="l02564" /><CodeLine lineNumber="2564"><Highlight kind="normal">           (<a href="/docs/api/classes/llvm/innerloopvectorizer/#a93a8f97a1e57c3bce2e7c3473d592c01">OptForSizeBasedOnProfile</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l02565" /><CodeLine lineNumber="2565"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>-&gt;Hints-&gt;getForce() != <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a>)) &amp;&amp;</Highlight></CodeLine>
<Link id="l02566" /><CodeLine lineNumber="2566"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Cannot SCEV check stride or overflow when optimizing for size&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02567" /><CodeLine lineNumber="2567"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.empty() &amp;&amp;</Highlight></CodeLine>
<Link id="l02568" /><CodeLine lineNumber="2568"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Should already be a bypass block due to iteration count check&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02569" /><CodeLine lineNumber="2569"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(SCEVCheckBlock);</Highlight></CodeLine>
<Link id="l02570" /><CodeLine lineNumber="2570"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a645c5c5c1e89cb56be66db8db877001d">AddedSafetyChecks</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02571" /><CodeLine lineNumber="2571"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02572" /><CodeLine lineNumber="2572"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9">introduceCheckBlockInVPlan</a>(SCEVCheckBlock);</Highlight></CodeLine>
<Link id="l02573" /><CodeLine lineNumber="2573"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> SCEVCheckBlock;</Highlight></CodeLine>
<Link id="l02574" /><CodeLine lineNumber="2574"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02575" /><CodeLine lineNumber="2575"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02576" /><CodeLine lineNumber="2576" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a625caa931f0d8ef201041febbfe42cca"><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a625caa931f0d8ef201041febbfe42cca">InnerLoopVectorizer::emitMemRuntimeChecks</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass) &#123;</Highlight></CodeLine>
<Link id="l02577" /><CodeLine lineNumber="2577"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// VPlan-native path does not do any analysis for runtime checks currently.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02578" /><CodeLine lineNumber="2578"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a>)</Highlight></CodeLine>
<Link id="l02579" /><CodeLine lineNumber="2579"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02580" /><CodeLine lineNumber="2580"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02581" /><CodeLine lineNumber="2581"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> MemCheckBlock =</Highlight></CodeLine>
<Link id="l02582" /><CodeLine lineNumber="2582"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae9880a8edd20b3b9b1527ecd5a03ac8c">RTChecks</a>.emitMemRuntimeChecks(Bypass, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>);</Highlight></CodeLine>
<Link id="l02583" /><CodeLine lineNumber="2583"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02584" /><CodeLine lineNumber="2584"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if we generated code that checks in runtime if arrays overlap. We put</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02585" /><CodeLine lineNumber="2585"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the checks into a separate block to make the more common case of few</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02586" /><CodeLine lineNumber="2586"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// elements faster.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02587" /><CodeLine lineNumber="2587"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MemCheckBlock)</Highlight></CodeLine>
<Link id="l02588" /><CodeLine lineNumber="2588"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02589" /><CodeLine lineNumber="2589"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02590" /><CodeLine lineNumber="2590"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MemCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a1c455e007178a24dfb18ac0e200ea02c">hasOptSize</a>() || <a href="/docs/api/classes/llvm/innerloopvectorizer/#a93a8f97a1e57c3bce2e7c3473d592c01">OptForSizeBasedOnProfile</a>) &#123;</Highlight></CodeLine>
<Link id="l02591" /><CodeLine lineNumber="2591"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>-&gt;Hints-&gt;getForce() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l02592" /><CodeLine lineNumber="2592"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Cannot emit memory checks when optimizing for size, unless forced &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02593" /><CodeLine lineNumber="2593"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;to vectorize.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02594" /><CodeLine lineNumber="2594"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#a42f4c06af5cd58b1f8a7e54b3ae4316a">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l02595" /><CodeLine lineNumber="2595"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </Highlight><Highlight kind="stringliteral">&quot;VectorizationCodeSize&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l02596" /><CodeLine lineNumber="2596"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getStartLoc(),</Highlight></CodeLine>
<Link id="l02597" /><CodeLine lineNumber="2597"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getHeader())</Highlight></CodeLine>
<Link id="l02598" /><CodeLine lineNumber="2598"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Code-size may be reduced by not forcing &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02599" /><CodeLine lineNumber="2599"><Highlight kind="normal">                </Highlight><Highlight kind="stringliteral">&quot;vectorization, or by source-code modifications &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02600" /><CodeLine lineNumber="2600"><Highlight kind="normal">                </Highlight><Highlight kind="stringliteral">&quot;eliminating the need for runtime checks &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02601" /><CodeLine lineNumber="2601"><Highlight kind="normal">                </Highlight><Highlight kind="stringliteral">&quot;(e.g., adding &#39;restrict&#39;).&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02602" /><CodeLine lineNumber="2602"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l02603" /><CodeLine lineNumber="2603"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02604" /><CodeLine lineNumber="2604"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02605" /><CodeLine lineNumber="2605"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(MemCheckBlock);</Highlight></CodeLine>
<Link id="l02606" /><CodeLine lineNumber="2606"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02607" /><CodeLine lineNumber="2607"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a645c5c5c1e89cb56be66db8db877001d">AddedSafetyChecks</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02608" /><CodeLine lineNumber="2608"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02609" /><CodeLine lineNumber="2609"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9">introduceCheckBlockInVPlan</a>(MemCheckBlock);</Highlight></CodeLine>
<Link id="l02610" /><CodeLine lineNumber="2610"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MemCheckBlock;</Highlight></CodeLine>
<Link id="l02611" /><CodeLine lineNumber="2611"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02612" /><CodeLine lineNumber="2612"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02613" /><CodeLine lineNumber="2613"><Highlight kind="comment">/// Replace \\p VPBB with a VPIRBasicBlock wrapping \\p IRBB. All recipes from \\p</Highlight></CodeLine>
<Link id="l02614" /><CodeLine lineNumber="2614"><Highlight kind="comment">/// VPBB are moved to the end of the newly created VPIRBasicBlock. VPBB must</Highlight></CodeLine>
<Link id="l02615" /><CodeLine lineNumber="2615"><Highlight kind="comment">/// have a single predecessor, which is rewired to the new VPIRBasicBlock. All</Highlight></CodeLine>
<Link id="l02616" /><CodeLine lineNumber="2616"><Highlight kind="comment">/// successors of VPBB, if any, are rewired to the new VPIRBasicBlock.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02617" /><CodeLine lineNumber="2617" lineLink="#a3a8743a69fac5e7fa9c2b02604b2cf2f"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a3a8743a69fac5e7fa9c2b02604b2cf2f">replaceVPBBWithIRVPBB</a>(<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IRBB) &#123;</Highlight></CodeLine>
<Link id="l02618" /><CodeLine lineNumber="2618"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> &#42;IRVPBB = VPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a8d57e2fe646928a51e97714005eefdc7">getPlan</a>()-&gt;<a href="/docs/api/classes/llvm/vplan/#aa12c0d3acb3f625ee09d2919907d4067">createVPIRBasicBlock</a>(IRBB);</Highlight></CodeLine>
<Link id="l02619" /><CodeLine lineNumber="2619"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;VPBB)) &#123;</Highlight></CodeLine>
<Link id="l02620" /><CodeLine lineNumber="2620"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!R.isPhi() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Tried to move phi recipe to end of block&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02621" /><CodeLine lineNumber="2621"><Highlight kind="normal">    R.moveBefore(&#42;IRVPBB, IRVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a4a7f4b8433e9a788149ffd94a0a07051">end</a>());</Highlight></CodeLine>
<Link id="l02622" /><CodeLine lineNumber="2622"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02623" /><CodeLine lineNumber="2623"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02624" /><CodeLine lineNumber="2624"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpblockutils/#a63345282cd67ea46202fb33523be1408">VPBlockUtils::reassociateBlocks</a>(VPBB, IRVPBB);</Highlight></CodeLine>
<Link id="l02625" /><CodeLine lineNumber="2625"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// VPBB is now dead and will be cleaned up when the plan gets destroyed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02626" /><CodeLine lineNumber="2626"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02627" /><CodeLine lineNumber="2627"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02628" /><CodeLine lineNumber="2628" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a5e719da4709193fd5b4632da4bc69795"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5e719da4709193fd5b4632da4bc69795">InnerLoopVectorizer::createVectorLoopSkeleton</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a> Prefix) &#123;</Highlight></CodeLine>
<Link id="l02629" /><CodeLine lineNumber="2629"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a> = <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getLoopPreheader();</Highlight></CodeLine>
<Link id="l02630" /><CodeLine lineNumber="2630"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Invalid loop structure&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02631" /><CodeLine lineNumber="2631"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getUniqueLatchExitBlock() ||</Highlight></CodeLine>
<Link id="l02632" /><CodeLine lineNumber="2632"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/innerloopvectorizer/#a325b208d89f2e70ee7b565dbc671fbfd">Cost</a>-&gt;requiresScalarEpilogue(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.isVector())) &amp;&amp;</Highlight></CodeLine>
<Link id="l02633" /><CodeLine lineNumber="2633"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;loops not exiting via the latch without required epilogue?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02634" /><CodeLine lineNumber="2634"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02635" /><CodeLine lineNumber="2635"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a38e6f65b6ccbdebbf2c7a8b078936115">LoopMiddleBlock</a> =</Highlight></CodeLine>
<Link id="l02636" /><CodeLine lineNumber="2636"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>-&gt;getTerminator(), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>,</Highlight></CodeLine>
<Link id="l02637" /><CodeLine lineNumber="2637"><Highlight kind="normal">                 <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/twine">Twine</a>(Prefix) + </Highlight><Highlight kind="stringliteral">&quot;middle.block&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02638" /><CodeLine lineNumber="2638"><Highlight kind="normal">  <a href="#a3a8743a69fac5e7fa9c2b02604b2cf2f">replaceVPBBWithIRVPBB</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.getMiddleBlock(), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a38e6f65b6ccbdebbf2c7a8b078936115">LoopMiddleBlock</a>);</Highlight></CodeLine>
<Link id="l02639" /><CodeLine lineNumber="2639"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a> =</Highlight></CodeLine>
<Link id="l02640" /><CodeLine lineNumber="2640"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a38e6f65b6ccbdebbf2c7a8b078936115">LoopMiddleBlock</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a38e6f65b6ccbdebbf2c7a8b078936115">LoopMiddleBlock</a>-&gt;getTerminator(), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>,</Highlight></CodeLine>
<Link id="l02641" /><CodeLine lineNumber="2641"><Highlight kind="normal">                 </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/twine">Twine</a>(Prefix) + </Highlight><Highlight kind="stringliteral">&quot;scalar.ph&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02642" /><CodeLine lineNumber="2642"><Highlight kind="normal">  <a href="#a3a8743a69fac5e7fa9c2b02604b2cf2f">replaceVPBBWithIRVPBB</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.getScalarPreheader(), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</Highlight></CodeLine>
<Link id="l02643" /><CodeLine lineNumber="2643"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02644" /><CodeLine lineNumber="2644"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02645" /><CodeLine lineNumber="2645"><Highlight kind="comment">/// Return the expanded step for \\p ID using \\p ExpandedSCEVs to look up SCEV</Highlight></CodeLine>
<Link id="l02646" /><CodeLine lineNumber="2646"><Highlight kind="comment">/// expansion results.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02647" /><CodeLine lineNumber="2647" lineLink="#aa8d4cfce02b245d616238ce8eed74718"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="#aa8d4cfce02b245d616238ce8eed74718">getExpandedStep</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>,</Highlight></CodeLine>
<Link id="l02648" /><CodeLine lineNumber="2648"><Highlight kind="normal">                              </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SCEV2ValueTy &amp;ExpandedSCEVs) &#123;</Highlight></CodeLine>
<Link id="l02649" /><CodeLine lineNumber="2649"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;Step = <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getStep();</Highlight></CodeLine>
<Link id="l02650" /><CodeLine lineNumber="2650"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(Step))</Highlight></CodeLine>
<Link id="l02651" /><CodeLine lineNumber="2651"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getValue();</Highlight></CodeLine>
<Link id="l02652" /><CodeLine lineNumber="2652"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVUnknown&gt;</a>(Step))</Highlight></CodeLine>
<Link id="l02653" /><CodeLine lineNumber="2653"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> U-&gt;getValue();</Highlight></CodeLine>
<Link id="l02654" /><CodeLine lineNumber="2654"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = ExpandedSCEVs.find(Step);</Highlight></CodeLine>
<Link id="l02655" /><CodeLine lineNumber="2655"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ExpandedSCEVs.end() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;SCEV must be expanded at this point&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02656" /><CodeLine lineNumber="2656"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;second;</Highlight></CodeLine>
<Link id="l02657" /><CodeLine lineNumber="2657"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02658" /><CodeLine lineNumber="2658"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02659" /><CodeLine lineNumber="2659"><Highlight kind="comment">/// Knowing that loop \\p L executes a single vector iteration, add instructions</Highlight></CodeLine>
<Link id="l02660" /><CodeLine lineNumber="2660"><Highlight kind="comment">/// that will get simplified and thus should not have any cost to \\p</Highlight></CodeLine>
<Link id="l02661" /><CodeLine lineNumber="2661"><Highlight kind="comment">/// InstsToIgnore.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02662" /><CodeLine lineNumber="2662" lineLink="#ababcaf6e2e00fc3fc8791ea2c3acbda5"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#ababcaf6e2e00fc3fc8791ea2c3acbda5">addFullyUnrolledInstructionsToIgnore</a>(</Highlight></CodeLine>
<Link id="l02663" /><CodeLine lineNumber="2663"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationlegality/#a063c4d98febe7ef90dddbfedcfc59d16">LoopVectorizationLegality::InductionList</a> &amp;IL,</Highlight></CodeLine>
<Link id="l02664" /><CodeLine lineNumber="2664"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;Instruction &#42;&gt;</a> &amp;InstsToIgnore) &#123;</Highlight></CodeLine>
<Link id="l02665" /><CodeLine lineNumber="2665"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Cmp = L-&gt;getLatchCmpInst();</Highlight></CodeLine>
<Link id="l02666" /><CodeLine lineNumber="2666"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Cmp)</Highlight></CodeLine>
<Link id="l02667" /><CodeLine lineNumber="2667"><Highlight kind="normal">    InstsToIgnore.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Cmp);</Highlight></CodeLine>
<Link id="l02668" /><CodeLine lineNumber="2668"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;KV : IL) &#123;</Highlight></CodeLine>
<Link id="l02669" /><CodeLine lineNumber="2669"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Extract the key by hand so that it can be used in the lambda below.  Note</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02670" /><CodeLine lineNumber="2670"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// that captured structured bindings are a C++20 extension.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02671" /><CodeLine lineNumber="2671"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = KV.first;</Highlight></CodeLine>
<Link id="l02672" /><CodeLine lineNumber="2672"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02673" /><CodeLine lineNumber="2673"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Get next iteration value of the induction variable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02674" /><CodeLine lineNumber="2674"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVInst =</Highlight></CodeLine>
<Link id="l02675" /><CodeLine lineNumber="2675"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getIncomingValueForBlock(L-&gt;getLoopLatch()));</Highlight></CodeLine>
<Link id="l02676" /><CodeLine lineNumber="2676"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(IVInst-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>(),</Highlight></CodeLine>
<Link id="l02677" /><CodeLine lineNumber="2677"><Highlight kind="normal">               &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123; return U == IV || U == Cmp; &#125;))</Highlight></CodeLine>
<Link id="l02678" /><CodeLine lineNumber="2678"><Highlight kind="normal">      InstsToIgnore.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(IVInst);</Highlight></CodeLine>
<Link id="l02679" /><CodeLine lineNumber="2679"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02680" /><CodeLine lineNumber="2680"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02681" /><CodeLine lineNumber="2681"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02682" /><CodeLine lineNumber="2682" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a69c116deda6ae831a71558a4630323cb"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a69c116deda6ae831a71558a4630323cb">InnerLoopVectorizer::createInductionAdditionalBypassValues</a>(</Highlight></CodeLine>
<Link id="l02683" /><CodeLine lineNumber="2683"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SCEV2ValueTy &amp;ExpandedSCEVs, <a href="/docs/api/classes/llvm/value">Value</a> &#42;MainVectorTripCount) &#123;</Highlight></CodeLine>
<Link id="l02684" /><CodeLine lineNumber="2684"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MainVectorTripCount &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Must have bypass information&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02685" /><CodeLine lineNumber="2685"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02686" /><CodeLine lineNumber="2686"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;OldInduction = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6bb946cd99f8c37f0145265914aea778">Legal</a>-&gt;getPrimaryInduction();</Highlight></CodeLine>
<Link id="l02687" /><CodeLine lineNumber="2687"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> BypassBuilder(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a8f2e87f456c35fdad0ec24e7c71a92a5">getAdditionalBypassBlock</a>(),</Highlight></CodeLine>
<Link id="l02688" /><CodeLine lineNumber="2688"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/innerloopvectorizer/#a8f2e87f456c35fdad0ec24e7c71a92a5">getAdditionalBypassBlock</a>()-&gt;getFirstInsertionPt());</Highlight></CodeLine>
<Link id="l02689" /><CodeLine lineNumber="2689"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;InductionEntry : <a href="/docs/api/classes/llvm/innerloopvectorizer/#a6bb946cd99f8c37f0145265914aea778">Legal</a>-&gt;getInductionVars()) &#123;</Highlight></CodeLine>
<Link id="l02690" /><CodeLine lineNumber="2690"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;OrigPhi = InductionEntry.first;</Highlight></CodeLine>
<Link id="l02691" /><CodeLine lineNumber="2691"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = InductionEntry.second;</Highlight></CodeLine>
<Link id="l02692" /><CodeLine lineNumber="2692"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Step = <a href="#aa8d4cfce02b245d616238ce8eed74718">getExpandedStep</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, ExpandedSCEVs);</Highlight></CodeLine>
<Link id="l02693" /><CodeLine lineNumber="2693"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For the primary induction the additional bypass end value is known.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02694" /><CodeLine lineNumber="2694"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise it is computed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02695" /><CodeLine lineNumber="2695"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;EndValueFromAdditionalBypass = MainVectorTripCount;</Highlight></CodeLine>
<Link id="l02696" /><CodeLine lineNumber="2696"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OrigPhi != OldInduction) &#123;</Highlight></CodeLine>
<Link id="l02697" /><CodeLine lineNumber="2697"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BinOp = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getInductionBinOp();</Highlight></CodeLine>
<Link id="l02698" /><CodeLine lineNumber="2698"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Fast-math-flags propagate from the original induction instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02699" /><CodeLine lineNumber="2699"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a4956305191cdba7f9995569d011a5ab7">isa&#95;and&#95;nonnull&lt;FPMathOperator&gt;</a>(BinOp))</Highlight></CodeLine>
<Link id="l02700" /><CodeLine lineNumber="2700"><Highlight kind="normal">        BypassBuilder.<a href="/docs/api/classes/llvm/irbuilderbase/#a6370e29617c71c8081bbbc68d6058403">setFastMathFlags</a>(BinOp-&gt;getFastMathFlags());</Highlight></CodeLine>
<Link id="l02701" /><CodeLine lineNumber="2701"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02702" /><CodeLine lineNumber="2702"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Compute the end value for the additional bypass.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02703" /><CodeLine lineNumber="2703"><Highlight kind="normal">      EndValueFromAdditionalBypass =</Highlight></CodeLine>
<Link id="l02704" /><CodeLine lineNumber="2704"><Highlight kind="normal">          <a href="#a23f5821d9ac264ae25dd087747e2c181">emitTransformedIndex</a>(BypassBuilder, MainVectorTripCount,</Highlight></CodeLine>
<Link id="l02705" /><CodeLine lineNumber="2705"><Highlight kind="normal">                               <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getStartValue(), Step, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getKind(), BinOp);</Highlight></CodeLine>
<Link id="l02706" /><CodeLine lineNumber="2706"><Highlight kind="normal">      EndValueFromAdditionalBypass-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</Highlight><Highlight kind="stringliteral">&quot;ind.end&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02707" /><CodeLine lineNumber="2707"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02708" /><CodeLine lineNumber="2708"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02709" /><CodeLine lineNumber="2709"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Store the bypass value here, as it needs to be added as operand to its</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02710" /><CodeLine lineNumber="2710"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// scalar preheader phi node after the epilogue skeleton has been created.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02711" /><CodeLine lineNumber="2711"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Directly add as extra operand to the VPResumePHI recipe.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02712" /><CodeLine lineNumber="2712"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/classes/llvm/innerloopvectorizer/#a48c4aed6852a39d4dcc584ac75cc1055">Induction2AdditionalBypassValue</a>.contains(OrigPhi) &amp;&amp;</Highlight></CodeLine>
<Link id="l02713" /><CodeLine lineNumber="2713"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;entry for OrigPhi already exits&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02714" /><CodeLine lineNumber="2714"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#a48c4aed6852a39d4dcc584ac75cc1055">Induction2AdditionalBypassValue</a>&#91;OrigPhi&#93; = EndValueFromAdditionalBypass;</Highlight></CodeLine>
<Link id="l02715" /><CodeLine lineNumber="2715"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02716" /><CodeLine lineNumber="2716"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02717" /><CodeLine lineNumber="2717"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02718" /><CodeLine lineNumber="2718" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a31f933a6eada9926c9e320db27dfb775"><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#a31f933a6eada9926c9e320db27dfb775">InnerLoopVectorizer::createVectorizedLoopSkeleton</a>(</Highlight></CodeLine>
<Link id="l02719" /><CodeLine lineNumber="2719"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SCEV2ValueTy &amp;ExpandedSCEVs) &#123;</Highlight></CodeLine>
<Link id="l02720" /><CodeLine lineNumber="2720"><Highlight kind="normal">  </Highlight><Highlight kind="comment">/&#42;</Highlight></CodeLine>
<Link id="l02721" /><CodeLine lineNumber="2721"><Highlight kind="comment">   In this function we generate a new loop. The new loop will contain</Highlight></CodeLine>
<Link id="l02722" /><CodeLine lineNumber="2722"><Highlight kind="comment">   the vectorized instructions while the old loop will continue to run the</Highlight></CodeLine>
<Link id="l02723" /><CodeLine lineNumber="2723"><Highlight kind="comment">   scalar remainder.</Highlight></CodeLine>
<Link id="l02724" /><CodeLine lineNumber="2724"><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02725" /><CodeLine lineNumber="2725"><Highlight kind="comment">       &#91; &#93; &lt;-- old preheader - loop iteration number check and SCEVs in Plan&#39;s</Highlight></CodeLine>
<Link id="l02726" /><CodeLine lineNumber="2726"><Highlight kind="comment">     /  |      preheader are expanded here. Eventually all required SCEV</Highlight></CodeLine>
<Link id="l02727" /><CodeLine lineNumber="2727"><Highlight kind="comment">    /   |      expansion should happen here.</Highlight></CodeLine>
<Link id="l02728" /><CodeLine lineNumber="2728"><Highlight kind="comment">   /    v</Highlight></CodeLine>
<Link id="l02729" /><CodeLine lineNumber="2729"><Highlight kind="comment">  |    &#91; &#93; &lt;-- vector loop bypass (may consist of multiple blocks).</Highlight></CodeLine>
<Link id="l02730" /><CodeLine lineNumber="2730"><Highlight kind="comment">  |  /  |</Highlight></CodeLine>
<Link id="l02731" /><CodeLine lineNumber="2731"><Highlight kind="comment">  | /   v</Highlight></CodeLine>
<Link id="l02732" /><CodeLine lineNumber="2732"><Highlight kind="comment">  ||   &#91; &#93;     &lt;-- vector pre header.</Highlight></CodeLine>
<Link id="l02733" /><CodeLine lineNumber="2733"><Highlight kind="comment">  |/    |</Highlight></CodeLine>
<Link id="l02734" /><CodeLine lineNumber="2734"><Highlight kind="comment">  |     v</Highlight></CodeLine>
<Link id="l02735" /><CodeLine lineNumber="2735"><Highlight kind="comment">  |    &#91;  &#93; \\</Highlight></CodeLine>
<Link id="l02736" /><CodeLine lineNumber="2736"><Highlight kind="comment">  |    &#91;  &#93;&#95;|   &lt;-- vector loop (created during VPlan execution).</Highlight></CodeLine>
<Link id="l02737" /><CodeLine lineNumber="2737"><Highlight kind="comment">  |     |</Highlight></CodeLine>
<Link id="l02738" /><CodeLine lineNumber="2738"><Highlight kind="comment">  |     v</Highlight></CodeLine>
<Link id="l02739" /><CodeLine lineNumber="2739"><Highlight kind="comment">  \\   -&#91; &#93;   &lt;--- middle-block (wrapped in VPIRBasicBlock with the branch to</Highlight></CodeLine>
<Link id="l02740" /><CodeLine lineNumber="2740"><Highlight kind="comment">   |    |                       successors created during VPlan execution)</Highlight></CodeLine>
<Link id="l02741" /><CodeLine lineNumber="2741"><Highlight kind="comment">   \\/   |</Highlight></CodeLine>
<Link id="l02742" /><CodeLine lineNumber="2742"><Highlight kind="comment">   /\\   v</Highlight></CodeLine>
<Link id="l02743" /><CodeLine lineNumber="2743"><Highlight kind="comment">   | -&gt;&#91; &#93;     &lt;--- new preheader (wrapped in VPIRBasicBlock).</Highlight></CodeLine>
<Link id="l02744" /><CodeLine lineNumber="2744"><Highlight kind="comment">   |    |</Highlight></CodeLine>
<Link id="l02745" /><CodeLine lineNumber="2745"><Highlight kind="comment"> (opt)  v      &lt;-- edge from middle to exit iff epilogue is not required.</Highlight></CodeLine>
<Link id="l02746" /><CodeLine lineNumber="2746"><Highlight kind="comment">   |   &#91; &#93; \\</Highlight></CodeLine>
<Link id="l02747" /><CodeLine lineNumber="2747"><Highlight kind="comment">   |   &#91; &#93;&#95;|   &lt;-- old scalar loop to handle remainder (scalar epilogue, header</Highlight></CodeLine>
<Link id="l02748" /><CodeLine lineNumber="2748"><Highlight kind="comment">   |    |          wrapped in VPIRBasicBlock).</Highlight></CodeLine>
<Link id="l02749" /><CodeLine lineNumber="2749"><Highlight kind="comment">    \\   |</Highlight></CodeLine>
<Link id="l02750" /><CodeLine lineNumber="2750"><Highlight kind="comment">     \\  v</Highlight></CodeLine>
<Link id="l02751" /><CodeLine lineNumber="2751"><Highlight kind="comment">      &gt;&#91; &#93;     &lt;-- exit block(s). (wrapped in VPIRBasicBlock)</Highlight></CodeLine>
<Link id="l02752" /><CodeLine lineNumber="2752"><Highlight kind="comment">   ...</Highlight></CodeLine>
<Link id="l02753" /><CodeLine lineNumber="2753"><Highlight kind="comment">   &#42;/</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02754" /><CodeLine lineNumber="2754"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02755" /><CodeLine lineNumber="2755"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create an empty vector loop, and prepare basic blocks for the runtime</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02756" /><CodeLine lineNumber="2756"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// checks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02757" /><CodeLine lineNumber="2757"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5e719da4709193fd5b4632da4bc69795">createVectorLoopSkeleton</a>(</Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02758" /><CodeLine lineNumber="2758"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02759" /><CodeLine lineNumber="2759"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now, compare the new count to zero. If it is zero skip the vector loop and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02760" /><CodeLine lineNumber="2760"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// jump to the scalar loop. This check also covers the case where the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02761" /><CodeLine lineNumber="2761"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// backedge-taken count is uint##&#95;max: adding one to it will overflow leading</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02762" /><CodeLine lineNumber="2762"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to an incorrect trip count of zero. In this (rare) case we will also jump</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02763" /><CodeLine lineNumber="2763"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to the scalar loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02764" /><CodeLine lineNumber="2764"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a72c491cdf8cf0283d87008831431f917">emitIterationCountCheck</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</Highlight></CodeLine>
<Link id="l02765" /><CodeLine lineNumber="2765"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02766" /><CodeLine lineNumber="2766"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Generate the code to check any assumptions that we&#39;ve made for SCEV</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02767" /><CodeLine lineNumber="2767"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// expressions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02768" /><CodeLine lineNumber="2768"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a30c4bcea7beb42c7eb075a578bc3bc3e">emitSCEVChecks</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</Highlight></CodeLine>
<Link id="l02769" /><CodeLine lineNumber="2769"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02770" /><CodeLine lineNumber="2770"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Generate the code that checks in runtime if arrays overlap. We put the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02771" /><CodeLine lineNumber="2771"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// checks into a separate block to make the more common case of few elements</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02772" /><CodeLine lineNumber="2772"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// faster.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02773" /><CodeLine lineNumber="2773"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a625caa931f0d8ef201041febbfe42cca">emitMemRuntimeChecks</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</Highlight></CodeLine>
<Link id="l02774" /><CodeLine lineNumber="2774"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02775" /><CodeLine lineNumber="2775"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>;</Highlight></CodeLine>
<Link id="l02776" /><CodeLine lineNumber="2776"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02777" /><CodeLine lineNumber="2777"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02778" /><CodeLine lineNumber="2778"><Highlight kind="normal"></Highlight><Highlight kind="keyword">namespace </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l02779" /><CodeLine lineNumber="2779"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02780" /><CodeLine lineNumber="2780" lineLink="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo"><Highlight kind="normal"></Highlight><Highlight kind="keyword">struct </Highlight><Highlight kind="normal"><a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo">CSEDenseMapInfo</a> &#123;</Highlight></CodeLine>
<Link id="l02781" /><CodeLine lineNumber="2781" lineLink="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a64e393e021291b440c6638be61fe249b"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a64e393e021291b440c6638be61fe249b">canHandle</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l02782" /><CodeLine lineNumber="2782"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;InsertElementInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ExtractElementInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</Highlight></CodeLine>
<Link id="l02783" /><CodeLine lineNumber="2783"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ShuffleVectorInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l02784" /><CodeLine lineNumber="2784"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02785" /><CodeLine lineNumber="2785"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02786" /><CodeLine lineNumber="2786" lineLink="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a658190e47d719896a310288b63b7e67c"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">inline</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a658190e47d719896a310288b63b7e67c">getEmptyKey</a>() &#123;</Highlight></CodeLine>
<Link id="l02787" /><CodeLine lineNumber="2787"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-gvnsink-cpp-/densemapinfo/#a1423601a8e4ec304e0756df4e761ebbb">DenseMapInfo&lt;Instruction &#42;&gt;::getEmptyKey</a>();</Highlight></CodeLine>
<Link id="l02788" /><CodeLine lineNumber="2788"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02789" /><CodeLine lineNumber="2789"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02790" /><CodeLine lineNumber="2790" lineLink="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a08a2129253b9049a133a8e83c54022ee"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">inline</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a08a2129253b9049a133a8e83c54022ee">getTombstoneKey</a>() &#123;</Highlight></CodeLine>
<Link id="l02791" /><CodeLine lineNumber="2791"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-gvnsink-cpp-/densemapinfo/#a9571e26b946751eaf015a9b8dc508be9">DenseMapInfo&lt;Instruction &#42;&gt;::getTombstoneKey</a>();</Highlight></CodeLine>
<Link id="l02792" /><CodeLine lineNumber="2792"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02793" /><CodeLine lineNumber="2793"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02794" /><CodeLine lineNumber="2794" lineLink="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a125ba060ad3c925017ab248aeac66703"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a125ba060ad3c925017ab248aeac66703">getHashValue</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l02795" /><CodeLine lineNumber="2795"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a64e393e021291b440c6638be61fe249b">canHandle</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unknown instruction!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02796" /><CodeLine lineNumber="2796"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#add71474638430694c84640146383fc44">hash&#95;combine</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), <a href="/docs/api/namespaces/llvm/#af80edfc5e42059e045aa7bf7fe42bee3">hash&#95;combine&#95;range</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;value&#95;op&#95;begin(),</Highlight></CodeLine>
<Link id="l02797" /><CodeLine lineNumber="2797"><Highlight kind="normal">                                                           <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;value&#95;op&#95;end()));</Highlight></CodeLine>
<Link id="l02798" /><CodeLine lineNumber="2798"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02799" /><CodeLine lineNumber="2799"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02800" /><CodeLine lineNumber="2800" lineLink="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a622c00e10772021ab1a0f6ea243e9942"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a622c00e10772021ab1a0f6ea243e9942">isEqual</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;LHS, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;RHS) &#123;</Highlight></CodeLine>
<Link id="l02801" /><CodeLine lineNumber="2801"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LHS == <a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a658190e47d719896a310288b63b7e67c">getEmptyKey</a>() || RHS == <a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a658190e47d719896a310288b63b7e67c">getEmptyKey</a>() ||</Highlight></CodeLine>
<Link id="l02802" /><CodeLine lineNumber="2802"><Highlight kind="normal">        LHS == <a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a08a2129253b9049a133a8e83c54022ee">getTombstoneKey</a>() || RHS == <a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a08a2129253b9049a133a8e83c54022ee">getTombstoneKey</a>())</Highlight></CodeLine>
<Link id="l02803" /><CodeLine lineNumber="2803"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> LHS == RHS;</Highlight></CodeLine>
<Link id="l02804" /><CodeLine lineNumber="2804"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> LHS-&gt;isIdenticalTo(RHS);</Highlight></CodeLine>
<Link id="l02805" /><CodeLine lineNumber="2805"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02806" /><CodeLine lineNumber="2806"><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l02807" /><CodeLine lineNumber="2807"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02808" /><CodeLine lineNumber="2808"><Highlight kind="normal">&#125; </Highlight><Highlight kind="comment">// end anonymous namespace</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02809" /><CodeLine lineNumber="2809"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l02810" /><CodeLine lineNumber="2810"><Highlight kind="comment">///Perform cse of induction variable instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02811" /><CodeLine lineNumber="2811" lineLink="#acc13ee8b8985399901ac09b51822e21a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#acc13ee8b8985399901ac09b51822e21a">cse</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l02812" /><CodeLine lineNumber="2812"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Perform simple cse.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02813" /><CodeLine lineNumber="2813"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Instruction &#42;, Instruction &#42;, 4, CSEDenseMapInfo&gt;</a> CSEMap;</Highlight></CodeLine>
<Link id="l02814" /><CodeLine lineNumber="2814"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;In : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(&#42;BB)) &#123;</Highlight></CodeLine>
<Link id="l02815" /><CodeLine lineNumber="2815"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/structs/anonymous-namespace-loopvectorize-cpp-/csedensemapinfo/#a64e393e021291b440c6638be61fe249b">CSEDenseMapInfo::canHandle</a>(&amp;In))</Highlight></CodeLine>
<Link id="l02816" /><CodeLine lineNumber="2816"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02817" /><CodeLine lineNumber="2817"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02818" /><CodeLine lineNumber="2818"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if we can replace this instruction with any of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02819" /><CodeLine lineNumber="2819"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// visited instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02820" /><CodeLine lineNumber="2820"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;V = CSEMap.<a href="/docs/api/classes/llvm/densemapbase/#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(&amp;In)) &#123;</Highlight></CodeLine>
<Link id="l02821" /><CodeLine lineNumber="2821"><Highlight kind="normal">      In.replaceAllUsesWith(V);</Highlight></CodeLine>
<Link id="l02822" /><CodeLine lineNumber="2822"><Highlight kind="normal">      In.eraseFromParent();</Highlight></CodeLine>
<Link id="l02823" /><CodeLine lineNumber="2823"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02824" /><CodeLine lineNumber="2824"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02825" /><CodeLine lineNumber="2825"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02826" /><CodeLine lineNumber="2826"><Highlight kind="normal">    CSEMap&#91;&amp;In&#93; = &amp;In;</Highlight></CodeLine>
<Link id="l02827" /><CodeLine lineNumber="2827"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02828" /><CodeLine lineNumber="2828"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02829" /><CodeLine lineNumber="2829"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02830" /><CodeLine lineNumber="2830"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></Highlight></CodeLine>
<Link id="l02831" /><CodeLine lineNumber="2831" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad1f0755693a05c2b008e9a576c3b162b"><Highlight kind="normal"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad1f0755693a05c2b008e9a576c3b162b">LoopVectorizationCostModel::getVectorCallCost</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI,</Highlight></CodeLine>
<Link id="l02832" /><CodeLine lineNumber="2832"><Highlight kind="normal">                                              <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l02833" /><CodeLine lineNumber="2833"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We only need to calculate a cost if the VF is scalar; for actual vectors</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02834" /><CodeLine lineNumber="2834"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we should already have a pre-calculated cost at each VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02835" /><CodeLine lineNumber="2835"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</Highlight></CodeLine>
<Link id="l02836" /><CodeLine lineNumber="2836"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CallWideningDecisions.at(std::make&#95;pair(CI, VF)).Cost;</Highlight></CodeLine>
<Link id="l02837" /><CodeLine lineNumber="2837"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02838" /><CodeLine lineNumber="2838"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy = CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l02839" /><CodeLine lineNumber="2839"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a08416fb970e8c177c7d78452d927c606">RecurrenceDescriptor::isFMulAddIntrinsic</a>(CI))</Highlight></CodeLine>
<Link id="l02840" /><CodeLine lineNumber="2840"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4e307866e6d65e87d1e6884b0d13306c">getReductionPatternCost</a>(CI, VF, RetTy))</Highlight></CodeLine>
<Link id="l02841" /><CodeLine lineNumber="2841"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;RedCost;</Highlight></CodeLine>
<Link id="l02842" /><CodeLine lineNumber="2842"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02843" /><CodeLine lineNumber="2843"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Type &#42;, 4&gt;</a> Tys;</Highlight></CodeLine>
<Link id="l02844" /><CodeLine lineNumber="2844"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;ArgOp : CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>())</Highlight></CodeLine>
<Link id="l02845" /><CodeLine lineNumber="2845"><Highlight kind="normal">    Tys.push&#95;back(ArgOp-&gt;getType());</Highlight></CodeLine>
<Link id="l02846" /><CodeLine lineNumber="2846"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02847" /><CodeLine lineNumber="2847"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarCallCost =</Highlight></CodeLine>
<Link id="l02848" /><CodeLine lineNumber="2848"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCallInstrCost(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>(), RetTy, Tys, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l02849" /><CodeLine lineNumber="2849"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02850" /><CodeLine lineNumber="2850"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If this is an intrinsic we may have a lower cost for it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02851" /><CodeLine lineNumber="2851"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>)) &#123;</Highlight></CodeLine>
<Link id="l02852" /><CodeLine lineNumber="2852"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> IntrinsicCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5abced3ab870d7abf57f2b35a02cd041">getVectorIntrinsicCost</a>(CI, VF);</Highlight></CodeLine>
<Link id="l02853" /><CodeLine lineNumber="2853"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::min(ScalarCallCost, IntrinsicCost);</Highlight></CodeLine>
<Link id="l02854" /><CodeLine lineNumber="2854"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02855" /><CodeLine lineNumber="2855"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ScalarCallCost;</Highlight></CodeLine>
<Link id="l02856" /><CodeLine lineNumber="2856"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02857" /><CodeLine lineNumber="2857"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02858" /><CodeLine lineNumber="2858" lineLink="#a83114915b4f7fec94a20efa3834a8250"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="#a83114915b4f7fec94a20efa3834a8250">maybeVectorizeType</a>(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Elt, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l02859" /><CodeLine lineNumber="2859"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || (!Elt-&gt;<a href="/docs/api/classes/llvm/type/#abf313eff420b7c6c8e322a2e9c53cd90">isIntOrPtrTy</a>() &amp;&amp; !Elt-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>()))</Highlight></CodeLine>
<Link id="l02860" /><CodeLine lineNumber="2860"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Elt;</Highlight></CodeLine>
<Link id="l02861" /><CodeLine lineNumber="2861"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Elt, VF);</Highlight></CodeLine>
<Link id="l02862" /><CodeLine lineNumber="2862"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02863" /><CodeLine lineNumber="2863"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02864" /><CodeLine lineNumber="2864"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></Highlight></CodeLine>
<Link id="l02865" /><CodeLine lineNumber="2865" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5abced3ab870d7abf57f2b35a02cd041"><Highlight kind="normal"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5abced3ab870d7abf57f2b35a02cd041">LoopVectorizationCostModel::getVectorIntrinsicCost</a>(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI,</Highlight></CodeLine>
<Link id="l02866" /><CodeLine lineNumber="2866"><Highlight kind="normal">                                                   <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l02867" /><CodeLine lineNumber="2867"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> = <a href="/docs/api/namespaces/llvm/#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>);</Highlight></CodeLine>
<Link id="l02868" /><CodeLine lineNumber="2868"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected intrinsic call!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02869" /><CodeLine lineNumber="2869"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy = <a href="#a83114915b4f7fec94a20efa3834a8250">maybeVectorizeType</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), VF);</Highlight></CodeLine>
<Link id="l02870" /><CodeLine lineNumber="2870"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/fastmathflags">FastMathFlags</a> FMF;</Highlight></CodeLine>
<Link id="l02871" /><CodeLine lineNumber="2871"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;FPMO = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;FPMathOperator&gt;</a>(CI))</Highlight></CodeLine>
<Link id="l02872" /><CodeLine lineNumber="2872"><Highlight kind="normal">    FMF = FPMO-&gt;getFastMathFlags();</Highlight></CodeLine>
<Link id="l02873" /><CodeLine lineNumber="2873"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02874" /><CodeLine lineNumber="2874"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;&gt;</a> <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowerkernelarguments-cpp/#a1161e5a4e753384aaba3a8e4533c4261">Arguments</a>(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>());</Highlight></CodeLine>
<Link id="l02875" /><CodeLine lineNumber="2875"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/functiontype">FunctionType</a> &#42;FTy = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a21075305f0e463b24aafc2fb99514ace">getFunctionType</a>();</Highlight></CodeLine>
<Link id="l02876" /><CodeLine lineNumber="2876"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Type &#42;&gt;</a> ParamTys;</Highlight></CodeLine>
<Link id="l02877" /><CodeLine lineNumber="2877"><Highlight kind="normal">  std::transform(FTy-&gt;<a href="/docs/api/classes/llvm/functiontype/#a05d5616e1422394b4d350c008b0cc5e0">param&#95;begin</a>(), FTy-&gt;<a href="/docs/api/classes/llvm/functiontype/#aeae69a459419ec0bb738cdc73f4fc2a1">param&#95;end</a>(),</Highlight></CodeLine>
<Link id="l02878" /><CodeLine lineNumber="2878"><Highlight kind="normal">                 std::back&#95;inserter(ParamTys),</Highlight></CodeLine>
<Link id="l02879" /><CodeLine lineNumber="2879"><Highlight kind="normal">                 &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty) &#123; return maybeVectorizeType(Ty, VF); &#125;);</Highlight></CodeLine>
<Link id="l02880" /><CodeLine lineNumber="2880"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02881" /><CodeLine lineNumber="2881"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/intrinsiccostattributes">IntrinsicCostAttributes</a> CostAttrs(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>, RetTy, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpulowerkernelarguments-cpp/#a1161e5a4e753384aaba3a8e4533c4261">Arguments</a>, ParamTys, FMF,</Highlight></CodeLine>
<Link id="l02882" /><CodeLine lineNumber="2882"><Highlight kind="normal">                                    <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(CI));</Highlight></CodeLine>
<Link id="l02883" /><CodeLine lineNumber="2883"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getIntrinsicInstrCost(CostAttrs, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l02884" /><CodeLine lineNumber="2884"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02885" /><CodeLine lineNumber="2885"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02886" /><CodeLine lineNumber="2886" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a9484786140efebf774cde8f072894246"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a9484786140efebf774cde8f072894246">InnerLoopVectorizer::fixVectorizedLoop</a>(<a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State) &#123;</Highlight></CodeLine>
<Link id="l02887" /><CodeLine lineNumber="2887"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Fix widened non-induction PHIs by setting up the PHI operands.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02888" /><CodeLine lineNumber="2888"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a>)</Highlight></CodeLine>
<Link id="l02889" /><CodeLine lineNumber="2889"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#accb5ce221150790c36b2d96af1be821c">fixNonInductionPHIs</a>(State);</Highlight></CodeLine>
<Link id="l02890" /><CodeLine lineNumber="2890"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02891" /><CodeLine lineNumber="2891"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// After vectorization, the exit blocks of the original loop will have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02892" /><CodeLine lineNumber="2892"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// additional predecessors. Invalidate SCEVs for the exit phis in case SE</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02893" /><CodeLine lineNumber="2893"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// looked through single-entry phis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02894" /><CodeLine lineNumber="2894"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;BasicBlock &#42;&gt;</a> ExitBlocks;</Highlight></CodeLine>
<Link id="l02895" /><CodeLine lineNumber="2895"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getExitBlocks(ExitBlocks);</Highlight></CodeLine>
<Link id="l02896" /><CodeLine lineNumber="2896"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Exit : ExitBlocks)</Highlight></CodeLine>
<Link id="l02897" /><CodeLine lineNumber="2897"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;PN : Exit-&gt;phis())</Highlight></CodeLine>
<Link id="l02898" /><CodeLine lineNumber="2898"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>.getSE()-&gt;forgetLcssaPhiWithNewPredecessor(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, &amp;PN);</Highlight></CodeLine>
<Link id="l02899" /><CodeLine lineNumber="2899"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02900" /><CodeLine lineNumber="2900"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Forget the original basic block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02901" /><CodeLine lineNumber="2901"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>.getSE()-&gt;forgetLoop(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>);</Highlight></CodeLine>
<Link id="l02902" /><CodeLine lineNumber="2902"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a79a00ec9570d7ae0b7fd17387e3d151f">PSE</a>.getSE()-&gt;forgetBlockAndLoopDispositions();</Highlight></CodeLine>
<Link id="l02903" /><CodeLine lineNumber="2903"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02904" /><CodeLine lineNumber="2904"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Don&#39;t apply optimizations below when no vector region remains, as they all</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02905" /><CodeLine lineNumber="2905"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// require a vector loop at the moment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02906" /><CodeLine lineNumber="2906"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!State.Plan-&gt;getVectorLoopRegion())</Highlight></CodeLine>
<Link id="l02907" /><CodeLine lineNumber="2907"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02908" /><CodeLine lineNumber="2908"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02909" /><CodeLine lineNumber="2909"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PI : <a href="/docs/api/classes/llvm/innerloopvectorizer/#a47eab9fa7cfa73af0b164da3fca49a0f">PredicatedInstructions</a>)</Highlight></CodeLine>
<Link id="l02910" /><CodeLine lineNumber="2910"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0a5c60e5cebd520f95b9813fd9807016">sinkScalarOperands</a>(&amp;&#42;PI);</Highlight></CodeLine>
<Link id="l02911" /><CodeLine lineNumber="2911"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02912" /><CodeLine lineNumber="2912"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;VectorRegion = State.Plan-&gt;getVectorLoopRegion();</Highlight></CodeLine>
<Link id="l02913" /><CodeLine lineNumber="2913"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;HeaderVPBB = VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</Highlight></CodeLine>
<Link id="l02914" /><CodeLine lineNumber="2914"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;HeaderBB = State.CFG.VPBB2IRBB&#91;HeaderVPBB&#93;;</Highlight></CodeLine>
<Link id="l02915" /><CodeLine lineNumber="2915"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02916" /><CodeLine lineNumber="2916"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove redundant induction instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02917" /><CodeLine lineNumber="2917"><Highlight kind="normal">  <a href="#acc13ee8b8985399901ac09b51822e21a">cse</a>(HeaderBB);</Highlight></CodeLine>
<Link id="l02918" /><CodeLine lineNumber="2918"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02919" /><CodeLine lineNumber="2919"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Set/update profile weights for the vector and remainder loops as original</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02920" /><CodeLine lineNumber="2920"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// loop iterations are now distributed among them. Note that original loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02921" /><CodeLine lineNumber="2921"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// becomes the scalar remainder loop after vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02922" /><CodeLine lineNumber="2922"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02923" /><CodeLine lineNumber="2923"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For cases like foldTailByMasking() and requiresScalarEpiloque() we may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02924" /><CodeLine lineNumber="2924"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// end up getting slightly roughened result but that should be OK since</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02925" /><CodeLine lineNumber="2925"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// profile is not inherently precise anyway. Note also possible bypass of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02926" /><CodeLine lineNumber="2926"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vector code caused by legality checks is ignored, assigning all the weight</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02927" /><CodeLine lineNumber="2927"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to the vector loop, optimistically.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02928" /><CodeLine lineNumber="2928"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02929" /><CodeLine lineNumber="2929"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For scalable vectorization we can&#39;t know at compile time how many</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02930" /><CodeLine lineNumber="2930"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// iterations of the loop are handled in one vector iteration, so instead</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02931" /><CodeLine lineNumber="2931"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// assume a pessimistic vscale of &#39;1&#39;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02932" /><CodeLine lineNumber="2932"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;VectorLoop = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>-&gt;getLoopFor(HeaderBB);</Highlight></CodeLine>
<Link id="l02933" /><CodeLine lineNumber="2933"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#aaf345c258e6fd97a551e4d5b41607e32">setProfileInfoAfterUnrolling</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>, VectorLoop, <a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>,</Highlight></CodeLine>
<Link id="l02934" /><CodeLine lineNumber="2934"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.getKnownMinValue() &#42; <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>);</Highlight></CodeLine>
<Link id="l02935" /><CodeLine lineNumber="2935"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02936" /><CodeLine lineNumber="2936"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02937" /><CodeLine lineNumber="2937" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#a0a5c60e5cebd520f95b9813fd9807016"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a0a5c60e5cebd520f95b9813fd9807016">InnerLoopVectorizer::sinkScalarOperands</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PredInst) &#123;</Highlight></CodeLine>
<Link id="l02938" /><CodeLine lineNumber="2938"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The basic block and loop containing the predicated instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02939" /><CodeLine lineNumber="2939"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PredBB = PredInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l02940" /><CodeLine lineNumber="2940"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VectorLoop = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>-&gt;getLoopFor(PredBB);</Highlight></CodeLine>
<Link id="l02941" /><CodeLine lineNumber="2941"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02942" /><CodeLine lineNumber="2942"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Initialize a worklist with the operands of the predicated instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02943" /><CodeLine lineNumber="2943"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> Worklist(PredInst-&gt;<a href="/docs/api/classes/llvm/user/#a2eeb1c7ed1cfe403f2ae0470e36c07e2">op&#95;begin</a>(), PredInst-&gt;<a href="/docs/api/classes/llvm/user/#af41f58e730804d10b91fcff39b035f74">op&#95;end</a>());</Highlight></CodeLine>
<Link id="l02944" /><CodeLine lineNumber="2944"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02945" /><CodeLine lineNumber="2945"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Holds instructions that we need to analyze again. An instruction may be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02946" /><CodeLine lineNumber="2946"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reanalyzed if we don&#39;t yet know if we can sink it or not.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02947" /><CodeLine lineNumber="2947"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 8&gt;</a> InstsToReanalyze;</Highlight></CodeLine>
<Link id="l02948" /><CodeLine lineNumber="2948"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02949" /><CodeLine lineNumber="2949"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Returns true if a given use occurs in the predicated block. Phi nodes use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02950" /><CodeLine lineNumber="2950"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// their operands in their corresponding predecessor blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02951" /><CodeLine lineNumber="2951"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsBlockOfUsePredicated = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/use">Use</a> &amp;U) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02952" /><CodeLine lineNumber="2952"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U.getUser());</Highlight></CodeLine>
<Link id="l02953" /><CodeLine lineNumber="2953"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l02954" /><CodeLine lineNumber="2954"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l02955" /><CodeLine lineNumber="2955"><Highlight kind="normal">      BB = Phi-&gt;getIncomingBlock(</Highlight></CodeLine>
<Link id="l02956" /><CodeLine lineNumber="2956"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/phinode/#aca414c43a6d42c13998208463637a20d">PHINode::getIncomingValueNumForOperand</a>(U.getOperandNo()));</Highlight></CodeLine>
<Link id="l02957" /><CodeLine lineNumber="2957"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BB == PredBB;</Highlight></CodeLine>
<Link id="l02958" /><CodeLine lineNumber="2958"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l02959" /><CodeLine lineNumber="2959"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02960" /><CodeLine lineNumber="2960"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iteratively sink the scalarized operands of the predicated instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02961" /><CodeLine lineNumber="2961"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// into the block we created for it. When an instruction is sunk, it&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02962" /><CodeLine lineNumber="2962"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// operands are then added to the worklist. The algorithm ends after one pass</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02963" /><CodeLine lineNumber="2963"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// through the worklist doesn&#39;t sink a single instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02964" /><CodeLine lineNumber="2964"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>;</Highlight></CodeLine>
<Link id="l02965" /><CodeLine lineNumber="2965"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">do</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l02966" /><CodeLine lineNumber="2966"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add the instructions that need to be reanalyzed to the worklist, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02967" /><CodeLine lineNumber="2967"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// reset the changed indicator.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02968" /><CodeLine lineNumber="2968"><Highlight kind="normal">    Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(InstsToReanalyze.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), InstsToReanalyze.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</Highlight></CodeLine>
<Link id="l02969" /><CodeLine lineNumber="2969"><Highlight kind="normal">    InstsToReanalyze.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</Highlight></CodeLine>
<Link id="l02970" /><CodeLine lineNumber="2970"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02971" /><CodeLine lineNumber="2971"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02972" /><CodeLine lineNumber="2972"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l02973" /><CodeLine lineNumber="2973"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Worklist.<a href="/docs/api/classes/llvm/setvector/#af9880d625c506aacc716ee1c9a29ff8b">pop&#95;back&#95;val</a>());</Highlight></CodeLine>
<Link id="l02974" /><CodeLine lineNumber="2974"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02975" /><CodeLine lineNumber="2975"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We can&#39;t sink an instruction if it is a phi node, is not in the loop,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02976" /><CodeLine lineNumber="2976"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// may have side effects or may read from memory.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02977" /><CodeLine lineNumber="2977"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: Could do more granular checking to allow sinking</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02978" /><CodeLine lineNumber="2978"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// a load past non-store instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02979" /><CodeLine lineNumber="2979"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || !VectorLoop-&gt;contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</Highlight></CodeLine>
<Link id="l02980" /><CodeLine lineNumber="2980"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayHaveSideEffects() || <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;mayReadFromMemory())</Highlight></CodeLine>
<Link id="l02981" /><CodeLine lineNumber="2981"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02982" /><CodeLine lineNumber="2982"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02983" /><CodeLine lineNumber="2983"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the instruction is already in PredBB, check if we can sink its</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02984" /><CodeLine lineNumber="2984"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// operands. In that case, VPlan&#39;s sinkScalarOperands() succeeded in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02985" /><CodeLine lineNumber="2985"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// sinking the scalar instruction I, hence it appears in PredBB; but it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02986" /><CodeLine lineNumber="2986"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// may have failed to sink I&#39;s operands (recursively), which we try</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02987" /><CodeLine lineNumber="2987"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// (again) here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02988" /><CodeLine lineNumber="2988"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == PredBB) &#123;</Highlight></CodeLine>
<Link id="l02989" /><CodeLine lineNumber="2989"><Highlight kind="normal">        Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;op&#95;begin(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;op&#95;end());</Highlight></CodeLine>
<Link id="l02990" /><CodeLine lineNumber="2990"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02991" /><CodeLine lineNumber="2991"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02992" /><CodeLine lineNumber="2992"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02993" /><CodeLine lineNumber="2993"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// It&#39;s legal to sink the instruction if all its uses occur in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02994" /><CodeLine lineNumber="2994"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// predicated block. Otherwise, there&#39;s nothing to do yet, and we may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02995" /><CodeLine lineNumber="2995"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// need to reanalyze the instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02996" /><CodeLine lineNumber="2996"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;uses(), IsBlockOfUsePredicated)) &#123;</Highlight></CodeLine>
<Link id="l02997" /><CodeLine lineNumber="2997"><Highlight kind="normal">        InstsToReanalyze.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l02998" /><CodeLine lineNumber="2998"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02999" /><CodeLine lineNumber="2999"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03000" /><CodeLine lineNumber="3000"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03001" /><CodeLine lineNumber="3001"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Move the instruction to the beginning of the predicated block, and add</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03002" /><CodeLine lineNumber="3002"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// it&#39;s operands to the worklist.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03003" /><CodeLine lineNumber="3003"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;moveBefore(PredBB-&gt;getFirstInsertionPt());</Highlight></CodeLine>
<Link id="l03004" /><CodeLine lineNumber="3004"><Highlight kind="normal">      Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;op&#95;begin(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;op&#95;end());</Highlight></CodeLine>
<Link id="l03005" /><CodeLine lineNumber="3005"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03006" /><CodeLine lineNumber="3006"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The sinking may have enabled other instructions to be sunk, so we will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03007" /><CodeLine lineNumber="3007"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// need to iterate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03008" /><CodeLine lineNumber="3008"><Highlight kind="normal">      <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03009" /><CodeLine lineNumber="3009"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03010" /><CodeLine lineNumber="3010"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>);</Highlight></CodeLine>
<Link id="l03011" /><CodeLine lineNumber="3011"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03012" /><CodeLine lineNumber="3012"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03013" /><CodeLine lineNumber="3013" lineLink="/docs/api/classes/llvm/innerloopvectorizer/#accb5ce221150790c36b2d96af1be821c"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#accb5ce221150790c36b2d96af1be821c">InnerLoopVectorizer::fixNonInductionPHIs</a>(<a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State) &#123;</Highlight></CodeLine>
<Link id="l03014" /><CodeLine lineNumber="3014"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Iter = <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.getEntry());</Highlight></CodeLine>
<Link id="l03015" /><CodeLine lineNumber="3015"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(Iter)) &#123;</Highlight></CodeLine>
<Link id="l03016" /><CodeLine lineNumber="3016"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : VPBB-&gt;phis()) &#123;</Highlight></CodeLine>
<Link id="l03017" /><CodeLine lineNumber="3017"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpwidenphirecipe">VPWidenPHIRecipe</a> &#42;VPPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenPHIRecipe&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>);</Highlight></CodeLine>
<Link id="l03018" /><CodeLine lineNumber="3018"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VPPhi)</Highlight></CodeLine>
<Link id="l03019" /><CodeLine lineNumber="3019"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03020" /><CodeLine lineNumber="3020"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;NewPhi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(State.get(VPPhi));</Highlight></CodeLine>
<Link id="l03021" /><CodeLine lineNumber="3021"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Make sure the builder has a valid insert point.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03022" /><CodeLine lineNumber="3022"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.SetInsertPoint(NewPhi);</Highlight></CodeLine>
<Link id="l03023" /><CodeLine lineNumber="3023"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 0; Idx &lt; VPPhi-&gt;<a href="/docs/api/classes/llvm/vpuser/#a5b21038d9b822b20c59e7ce5b12582e1">getNumOperands</a>(); ++Idx) &#123;</Highlight></CodeLine>
<Link id="l03024" /><CodeLine lineNumber="3024"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Inc = VPPhi-&gt;<a href="/docs/api/classes/llvm/vpwidenphirecipe/#a48a84a2d77d942f724c87bc7657c4355">getIncomingValue</a>(Idx);</Highlight></CodeLine>
<Link id="l03025" /><CodeLine lineNumber="3025"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB = VPPhi-&gt;<a href="/docs/api/classes/llvm/vpwidenphirecipe/#afbde244c417036adb55cbc687de70971">getIncomingBlock</a>(Idx);</Highlight></CodeLine>
<Link id="l03026" /><CodeLine lineNumber="3026"><Highlight kind="normal">        NewPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(State.get(Inc), State.CFG.VPBB2IRBB&#91;VPBB&#93;);</Highlight></CodeLine>
<Link id="l03027" /><CodeLine lineNumber="3027"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03028" /><CodeLine lineNumber="3028"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03029" /><CodeLine lineNumber="3029"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03030" /><CodeLine lineNumber="3030"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03031" /><CodeLine lineNumber="3031"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03032" /><CodeLine lineNumber="3032"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> LoopVectorizationCostModel::collectLoopScalars(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l03033" /><CodeLine lineNumber="3033"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We should not collect Scalars more than once per VF. Right now, this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03034" /><CodeLine lineNumber="3034"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// function is called from collectUniformsAndScalars(), which already does</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03035" /><CodeLine lineNumber="3035"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// this check. Collecting Scalars for VF=1 does not make any sense.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03036" /><CodeLine lineNumber="3036"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; !Scalars.<a href="/docs/api/classes/llvm/densemapbase/#a836d9cba6deced0bb1fa7333ce5afd3a">contains</a>(VF) &amp;&amp;</Highlight></CodeLine>
<Link id="l03037" /><CodeLine lineNumber="3037"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;This function should not be visited twice for the same VF&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03038" /><CodeLine lineNumber="3038"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03039" /><CodeLine lineNumber="3039"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This avoids any chances of creating a REPLICATE recipe during planning</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03040" /><CodeLine lineNumber="3040"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// since that would result in generation of scalarized code during execution,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03041" /><CodeLine lineNumber="3041"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// which is not supported for scalable vectors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03042" /><CodeLine lineNumber="3042"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>()) &#123;</Highlight></CodeLine>
<Link id="l03043" /><CodeLine lineNumber="3043"><Highlight kind="normal">    Scalars&#91;VF&#93;.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(Uniforms&#91;VF&#93;.begin(), Uniforms&#91;VF&#93;.end());</Highlight></CodeLine>
<Link id="l03044" /><CodeLine lineNumber="3044"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03045" /><CodeLine lineNumber="3045"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03046" /><CodeLine lineNumber="3046"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03047" /><CodeLine lineNumber="3047"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;Instruction &#42;, 8&gt;</a> Worklist;</Highlight></CodeLine>
<Link id="l03048" /><CodeLine lineNumber="3048"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03049" /><CodeLine lineNumber="3049"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// These sets are used to seed the analysis with pointers used by memory</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03050" /><CodeLine lineNumber="3050"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// accesses that will remain scalar.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03051" /><CodeLine lineNumber="3051"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;Instruction &#42;, 8&gt;</a> ScalarPtrs;</Highlight></CodeLine>
<Link id="l03052" /><CodeLine lineNumber="3052"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 8&gt;</a> PossibleNonScalarPtrs;</Highlight></CodeLine>
<Link id="l03053" /><CodeLine lineNumber="3053"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Latch = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;<a href="/docs/api/classes/llvm/loopbase/#a1230fd674d2609b96527fe65eaf40b1b">getLoopLatch</a>();</Highlight></CodeLine>
<Link id="l03054" /><CodeLine lineNumber="3054"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03055" /><CodeLine lineNumber="3055"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A helper that returns true if the use of Ptr by MemAccess will be scalar.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03056" /><CodeLine lineNumber="3056"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The pointer operands of loads and stores will be scalar as long as the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03057" /><CodeLine lineNumber="3057"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// memory access is not a gather or scatter operation. The value operand of a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03058" /><CodeLine lineNumber="3058"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// store will remain scalar if the store is scalarized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03059" /><CodeLine lineNumber="3059"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsScalarUse = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;MemAccess, <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &#123;</Highlight></CodeLine>
<Link id="l03060" /><CodeLine lineNumber="3060"><Highlight kind="normal">    InstWidening WideningDecision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(MemAccess, VF);</Highlight></CodeLine>
<Link id="l03061" /><CodeLine lineNumber="3061"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(WideningDecision != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">CM&#95;Unknown</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l03062" /><CodeLine lineNumber="3062"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Widening decision should be ready at this moment&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03063" /><CodeLine lineNumber="3063"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Store = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(MemAccess))</Highlight></CodeLine>
<Link id="l03064" /><CodeLine lineNumber="3064"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> == Store-&gt;getValueOperand())</Highlight></CodeLine>
<Link id="l03065" /><CodeLine lineNumber="3065"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> WideningDecision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>;</Highlight></CodeLine>
<Link id="l03066" /><CodeLine lineNumber="3066"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> == <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(MemAccess) &amp;&amp;</Highlight></CodeLine>
<Link id="l03067" /><CodeLine lineNumber="3067"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Ptr is neither a value or pointer operand&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03068" /><CodeLine lineNumber="3068"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> WideningDecision != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ae849d400780f51424bc4e4c26ddf3000">CM&#95;GatherScatter</a>;</Highlight></CodeLine>
<Link id="l03069" /><CodeLine lineNumber="3069"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03070" /><CodeLine lineNumber="3070"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03071" /><CodeLine lineNumber="3071"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A helper that returns true if the given value is a getelementptr</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03072" /><CodeLine lineNumber="3072"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction contained in the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03073" /><CodeLine lineNumber="3073"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsLoopVaryingGEP = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>) &#123;</Highlight></CodeLine>
<Link id="l03074" /><CodeLine lineNumber="3074"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;GetElementPtrInst&gt;</a>(V) &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(V);</Highlight></CodeLine>
<Link id="l03075" /><CodeLine lineNumber="3075"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03076" /><CodeLine lineNumber="3076"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03077" /><CodeLine lineNumber="3077"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A helper that evaluates a memory access&#39;s use of a pointer. If the use will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03078" /><CodeLine lineNumber="3078"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// be a scalar use and the pointer is only used by memory accesses, we place</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03079" /><CodeLine lineNumber="3079"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the pointer in ScalarPtrs. Otherwise, the pointer is placed in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03080" /><CodeLine lineNumber="3080"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// PossibleNonScalarPtrs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03081" /><CodeLine lineNumber="3081"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> EvaluatePtrUse = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;MemAccess, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &#123;</Highlight></CodeLine>
<Link id="l03082" /><CodeLine lineNumber="3082"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We only care about bitcast and getelementptr instructions contained in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03083" /><CodeLine lineNumber="3083"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03084" /><CodeLine lineNumber="3084"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IsLoopVaryingGEP(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>))</Highlight></CodeLine>
<Link id="l03085" /><CodeLine lineNumber="3085"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03086" /><CodeLine lineNumber="3086"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03087" /><CodeLine lineNumber="3087"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the pointer has already been identified as scalar (e.g., if it was</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03088" /><CodeLine lineNumber="3088"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// also identified as uniform), there&#39;s nothing to do.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03089" /><CodeLine lineNumber="3089"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</Highlight></CodeLine>
<Link id="l03090" /><CodeLine lineNumber="3090"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Worklist.<a href="/docs/api/classes/llvm/setvector/#abb03e3b6c4fd937936a13afe4f60d291">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l03091" /><CodeLine lineNumber="3091"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03092" /><CodeLine lineNumber="3092"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03093" /><CodeLine lineNumber="3093"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the use of the pointer will be a scalar use, and all users of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03094" /><CodeLine lineNumber="3094"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// pointer are memory accesses, place the pointer in ScalarPtrs. Otherwise,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03095" /><CodeLine lineNumber="3095"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// place the pointer in PossibleNonScalarPtrs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03096" /><CodeLine lineNumber="3096"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsScalarUse(MemAccess, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l03097" /><CodeLine lineNumber="3097"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users(), <a href="/docs/api/namespaces/llvm/#af462c722ac0144c995057a2f6e616507">IsaPred&lt;LoadInst, StoreInst&gt;</a>))</Highlight></CodeLine>
<Link id="l03098" /><CodeLine lineNumber="3098"><Highlight kind="normal">      ScalarPtrs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03099" /><CodeLine lineNumber="3099"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03100" /><CodeLine lineNumber="3100"><Highlight kind="normal">      PossibleNonScalarPtrs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03101" /><CodeLine lineNumber="3101"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03102" /><CodeLine lineNumber="3102"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03103" /><CodeLine lineNumber="3103"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We seed the scalars analysis with three classes of instructions: (1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03104" /><CodeLine lineNumber="3104"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instructions marked uniform-after-vectorization and (2) bitcast,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03105" /><CodeLine lineNumber="3105"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// getelementptr and (pointer) phi instructions used by memory accesses</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03106" /><CodeLine lineNumber="3106"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// requiring a scalar use.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03107" /><CodeLine lineNumber="3107"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03108" /><CodeLine lineNumber="3108"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (1) Add to the worklist all instructions that have been identified as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03109" /><CodeLine lineNumber="3109"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// uniform-after-vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03110" /><CodeLine lineNumber="3110"><Highlight kind="normal">  Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Uniforms&#91;VF&#93;.<a href="/docs/api/namespaces/llvm/sandboxir/#a2fdb10193ae65fe59b4d8df288044864">begin</a>(), Uniforms&#91;VF&#93;.<a href="/docs/api/namespaces/llvm/sandboxir/#a64ac61287490361f2183faf1d7639ee9">end</a>());</Highlight></CodeLine>
<Link id="l03111" /><CodeLine lineNumber="3111"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03112" /><CodeLine lineNumber="3112"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (2) Add to the worklist all bitcast and getelementptr instructions used by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03113" /><CodeLine lineNumber="3113"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// memory accesses requiring a scalar use. The pointer operands of loads and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03114" /><CodeLine lineNumber="3114"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// stores will be scalar unless the operation is a gather or scatter.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03115" /><CodeLine lineNumber="3115"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The value operand of a store will remain scalar if the store is scalarized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03116" /><CodeLine lineNumber="3116"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks())</Highlight></CodeLine>
<Link id="l03117" /><CodeLine lineNumber="3117"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l03118" /><CodeLine lineNumber="3118"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Load = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l03119" /><CodeLine lineNumber="3119"><Highlight kind="normal">        EvaluatePtrUse(Load, <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a5069619ca8fdce305534f3fe85091a0f">Load</a>-&gt;getPointerOperand());</Highlight></CodeLine>
<Link id="l03120" /><CodeLine lineNumber="3120"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Store = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l03121" /><CodeLine lineNumber="3121"><Highlight kind="normal">        EvaluatePtrUse(Store, <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getPointerOperand());</Highlight></CodeLine>
<Link id="l03122" /><CodeLine lineNumber="3122"><Highlight kind="normal">        EvaluatePtrUse(Store, <a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a>-&gt;getValueOperand());</Highlight></CodeLine>
<Link id="l03123" /><CodeLine lineNumber="3123"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03124" /><CodeLine lineNumber="3124"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03125" /><CodeLine lineNumber="3125"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : ScalarPtrs)</Highlight></CodeLine>
<Link id="l03126" /><CodeLine lineNumber="3126"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PossibleNonScalarPtrs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l03127" /><CodeLine lineNumber="3127"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found scalar instruction: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03128" /><CodeLine lineNumber="3128"><Highlight kind="normal">      Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03129" /><CodeLine lineNumber="3129"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03130" /><CodeLine lineNumber="3130"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03131" /><CodeLine lineNumber="3131"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Insert the forced scalars.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03132" /><CodeLine lineNumber="3132"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: Currently VPWidenPHIRecipe() often creates a dead vector</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03133" /><CodeLine lineNumber="3133"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// induction variable when the PHI user is scalarized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03134" /><CodeLine lineNumber="3134"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ForcedScalar = ForcedScalars.find(VF);</Highlight></CodeLine>
<Link id="l03135" /><CodeLine lineNumber="3135"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ForcedScalar != ForcedScalars.end())</Highlight></CodeLine>
<Link id="l03136" /><CodeLine lineNumber="3136"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : ForcedScalar-&gt;second) &#123;</Highlight></CodeLine>
<Link id="l03137" /><CodeLine lineNumber="3137"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found (forced) scalar instruction: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03138" /><CodeLine lineNumber="3138"><Highlight kind="normal">      Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03139" /><CodeLine lineNumber="3139"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03140" /><CodeLine lineNumber="3140"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03141" /><CodeLine lineNumber="3141"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Expand the worklist by looking through any bitcasts and getelementptr</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03142" /><CodeLine lineNumber="3142"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instructions we&#39;ve already identified as scalar. This is similar to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03143" /><CodeLine lineNumber="3143"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// expansion step in collectLoopUniforms(); however, here we&#39;re only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03144" /><CodeLine lineNumber="3144"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// expanding to include additional bitcasts and getelementptr instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03145" /><CodeLine lineNumber="3145"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 0;</Highlight></CodeLine>
<Link id="l03146" /><CodeLine lineNumber="3146"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (Idx != Worklist.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>()) &#123;</Highlight></CodeLine>
<Link id="l03147" /><CodeLine lineNumber="3147"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a1448a68418666ed85e07646744af82ef">Dst</a> = Worklist&#91;Idx++&#93;;</Highlight></CodeLine>
<Link id="l03148" /><CodeLine lineNumber="3148"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IsLoopVaryingGEP(<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a1448a68418666ed85e07646744af82ef">Dst</a>-&gt;getOperand(0)))</Highlight></CodeLine>
<Link id="l03149" /><CodeLine lineNumber="3149"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03150" /><CodeLine lineNumber="3150"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a1448a68418666ed85e07646744af82ef">Dst</a>-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l03151" /><CodeLine lineNumber="3151"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(<a href="/docs/api/namespaces/anonymous-linkmodules-cpp-/#ab56eb2027bc9c069aa696e54de8b4298a276e79316561733d64abdf00f8e8ae48">Src</a>-&gt;users(), &#91;&amp;&#93;(User &#42;U) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03152" /><CodeLine lineNumber="3152"><Highlight kind="normal">          auto &#42;J = cast&lt;Instruction&gt;(U);</Highlight></CodeLine>
<Link id="l03153" /><CodeLine lineNumber="3153"><Highlight kind="normal">          return !TheLoop-&gt;contains(J) || Worklist.count(J) ||</Highlight></CodeLine>
<Link id="l03154" /><CodeLine lineNumber="3154"><Highlight kind="normal">                 ((isa&lt;LoadInst&gt;(J) || isa&lt;StoreInst&gt;(J)) &amp;&amp;</Highlight></CodeLine>
<Link id="l03155" /><CodeLine lineNumber="3155"><Highlight kind="normal">                  IsScalarUse(J, Src));</Highlight></CodeLine>
<Link id="l03156" /><CodeLine lineNumber="3156"><Highlight kind="normal">        &#125;)) &#123;</Highlight></CodeLine>
<Link id="l03157" /><CodeLine lineNumber="3157"><Highlight kind="normal">      Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Src);</Highlight></CodeLine>
<Link id="l03158" /><CodeLine lineNumber="3158"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found scalar instruction: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Src &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03159" /><CodeLine lineNumber="3159"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03160" /><CodeLine lineNumber="3160"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03161" /><CodeLine lineNumber="3161"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03162" /><CodeLine lineNumber="3162"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// An induction variable will remain scalar if all users of the induction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03163" /><CodeLine lineNumber="3163"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// variable and induction variable update remain scalar.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03164" /><CodeLine lineNumber="3164"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Induction : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getInductionVars()) &#123;</Highlight></CodeLine>
<Link id="l03165" /><CodeLine lineNumber="3165"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Ind = Induction.first;</Highlight></CodeLine>
<Link id="l03166" /><CodeLine lineNumber="3166"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IndUpdate = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Ind-&gt;getIncomingValueForBlock(Latch));</Highlight></CodeLine>
<Link id="l03167" /><CodeLine lineNumber="3167"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03168" /><CodeLine lineNumber="3168"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If tail-folding is applied, the primary induction variable will be used</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03169" /><CodeLine lineNumber="3169"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to feed a vector compare.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03170" /><CodeLine lineNumber="3170"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Ind == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getPrimaryInduction() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba">foldTailByMasking</a>())</Highlight></CodeLine>
<Link id="l03171" /><CodeLine lineNumber="3171"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03172" /><CodeLine lineNumber="3172"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03173" /><CodeLine lineNumber="3173"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Returns true if \\p Indvar is a pointer induction that is used directly by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03174" /><CodeLine lineNumber="3174"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// load/store instruction \\p I.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03175" /><CodeLine lineNumber="3175"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsDirectLoadStoreFromPtrIndvar = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;Indvar,</Highlight></CodeLine>
<Link id="l03176" /><CodeLine lineNumber="3176"><Highlight kind="normal">                                              <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l03177" /><CodeLine lineNumber="3177"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Induction.second.getKind() ==</Highlight></CodeLine>
<Link id="l03178" /><CodeLine lineNumber="3178"><Highlight kind="normal">                 <a href="/docs/api/classes/llvm/inductiondescriptor/#ac2d32589e2e153088b8a35db1a9eabccab61689ca7d0a024fc4ff52a74d691ae2">InductionDescriptor::IK&#95;PtrInduction</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l03179" /><CodeLine lineNumber="3179"><Highlight kind="normal">             (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</Highlight></CodeLine>
<Link id="l03180" /><CodeLine lineNumber="3180"><Highlight kind="normal">             Indvar == <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; IsScalarUse(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Indvar);</Highlight></CodeLine>
<Link id="l03181" /><CodeLine lineNumber="3181"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l03182" /><CodeLine lineNumber="3182"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03183" /><CodeLine lineNumber="3183"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Determine if all users of the induction variable are scalar after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03184" /><CodeLine lineNumber="3184"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03185" /><CodeLine lineNumber="3185"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ScalarInd = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(Ind-&gt;users(), &#91;&amp;&#93;(User &#42;U) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03186" /><CodeLine lineNumber="3186"><Highlight kind="normal">      auto &#42;I = cast&lt;Instruction&gt;(U);</Highlight></CodeLine>
<Link id="l03187" /><CodeLine lineNumber="3187"><Highlight kind="normal">      return I == IndUpdate || !TheLoop-&gt;contains(I) || Worklist.count(I) ||</Highlight></CodeLine>
<Link id="l03188" /><CodeLine lineNumber="3188"><Highlight kind="normal">             IsDirectLoadStoreFromPtrIndvar(Ind, I);</Highlight></CodeLine>
<Link id="l03189" /><CodeLine lineNumber="3189"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l03190" /><CodeLine lineNumber="3190"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ScalarInd)</Highlight></CodeLine>
<Link id="l03191" /><CodeLine lineNumber="3191"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03192" /><CodeLine lineNumber="3192"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03193" /><CodeLine lineNumber="3193"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the induction variable update is a fixed-order recurrence, neither the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03194" /><CodeLine lineNumber="3194"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// induction variable or its update should be marked scalar after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03195" /><CodeLine lineNumber="3195"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03196" /><CodeLine lineNumber="3196"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IndUpdatePhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(IndUpdate);</Highlight></CodeLine>
<Link id="l03197" /><CodeLine lineNumber="3197"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IndUpdatePhi &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isFixedOrderRecurrence(IndUpdatePhi))</Highlight></CodeLine>
<Link id="l03198" /><CodeLine lineNumber="3198"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03199" /><CodeLine lineNumber="3199"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03200" /><CodeLine lineNumber="3200"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Determine if all users of the induction variable update instruction are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03201" /><CodeLine lineNumber="3201"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// scalar after vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03202" /><CodeLine lineNumber="3202"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ScalarIndUpdate = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(IndUpdate-&gt;users(), &#91;&amp;&#93;(User &#42;U) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03203" /><CodeLine lineNumber="3203"><Highlight kind="normal">      auto &#42;I = cast&lt;Instruction&gt;(U);</Highlight></CodeLine>
<Link id="l03204" /><CodeLine lineNumber="3204"><Highlight kind="normal">      return I == Ind || !TheLoop-&gt;contains(I) || Worklist.count(I) ||</Highlight></CodeLine>
<Link id="l03205" /><CodeLine lineNumber="3205"><Highlight kind="normal">             IsDirectLoadStoreFromPtrIndvar(IndUpdate, I);</Highlight></CodeLine>
<Link id="l03206" /><CodeLine lineNumber="3206"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l03207" /><CodeLine lineNumber="3207"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ScalarIndUpdate)</Highlight></CodeLine>
<Link id="l03208" /><CodeLine lineNumber="3208"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03209" /><CodeLine lineNumber="3209"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03210" /><CodeLine lineNumber="3210"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The induction variable and its update instruction will remain scalar.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03211" /><CodeLine lineNumber="3211"><Highlight kind="normal">    Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Ind);</Highlight></CodeLine>
<Link id="l03212" /><CodeLine lineNumber="3212"><Highlight kind="normal">    Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(IndUpdate);</Highlight></CodeLine>
<Link id="l03213" /><CodeLine lineNumber="3213"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found scalar instruction: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Ind &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03214" /><CodeLine lineNumber="3214"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found scalar instruction: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;IndUpdate</Highlight></CodeLine>
<Link id="l03215" /><CodeLine lineNumber="3215"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03216" /><CodeLine lineNumber="3216"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03217" /><CodeLine lineNumber="3217"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03218" /><CodeLine lineNumber="3218"><Highlight kind="normal">  Scalars&#91;VF&#93;.insert(Worklist.<a href="/docs/api/classes/llvm/setvector/#ad0bf95396cec46a41371341460d14a1c">begin</a>(), Worklist.<a href="/docs/api/classes/llvm/setvector/#a889cc0df630d4b01e12d359517e26670">end</a>());</Highlight></CodeLine>
<Link id="l03219" /><CodeLine lineNumber="3219"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03220" /><CodeLine lineNumber="3220"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03221" /><CodeLine lineNumber="3221" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8">LoopVectorizationCostModel::isScalarWithPredication</a>(</Highlight></CodeLine>
<Link id="l03222" /><CodeLine lineNumber="3222"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03223" /><CodeLine lineNumber="3223"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">isPredicatedInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l03224" /><CodeLine lineNumber="3224"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03225" /><CodeLine lineNumber="3225"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03226" /><CodeLine lineNumber="3226"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do we have a non-scalar lowering for this predicated</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03227" /><CodeLine lineNumber="3227"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction? No - it is scalar with predication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03228" /><CodeLine lineNumber="3228"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal">(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l03229" /><CodeLine lineNumber="3229"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l03230" /><CodeLine lineNumber="3230"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03231" /><CodeLine lineNumber="3231"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Call:</Highlight></CodeLine>
<Link id="l03232" /><CodeLine lineNumber="3232"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</Highlight></CodeLine>
<Link id="l03233" /><CodeLine lineNumber="3233"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03234" /><CodeLine lineNumber="3234"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CallWideningDecisions.at(std::make&#95;pair(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), VF))</Highlight></CodeLine>
<Link id="l03235" /><CodeLine lineNumber="3235"><Highlight kind="normal">               .Kind == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>;</Highlight></CodeLine>
<Link id="l03236" /><CodeLine lineNumber="3236"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Load:</Highlight></CodeLine>
<Link id="l03237" /><CodeLine lineNumber="3237"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Store: &#123;</Highlight></CodeLine>
<Link id="l03238" /><CodeLine lineNumber="3238"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03239" /><CodeLine lineNumber="3239"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Ty = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03240" /><CodeLine lineNumber="3240"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;VTy = Ty;</Highlight></CodeLine>
<Link id="l03241" /><CodeLine lineNumber="3241"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>())</Highlight></CodeLine>
<Link id="l03242" /><CodeLine lineNumber="3242"><Highlight kind="normal">      VTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Ty, VF);</Highlight></CodeLine>
<Link id="l03243" /><CodeLine lineNumber="3243"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/align">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03244" /><CodeLine lineNumber="3244"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ? !(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a472c49074b0d81970f8eea07de4d7ad4">isLegalMaskedLoad</a>(Ty, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, Alignment) ||</Highlight></CodeLine>
<Link id="l03245" /><CodeLine lineNumber="3245"><Highlight kind="normal">                                <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedGather(VTy, Alignment))</Highlight></CodeLine>
<Link id="l03246" /><CodeLine lineNumber="3246"><Highlight kind="normal">                            : !(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c25146329f69e026508656cfb1280fa">isLegalMaskedStore</a>(Ty, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, Alignment) ||</Highlight></CodeLine>
<Link id="l03247" /><CodeLine lineNumber="3247"><Highlight kind="normal">                                <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedScatter(VTy, Alignment));</Highlight></CodeLine>
<Link id="l03248" /><CodeLine lineNumber="3248"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03249" /><CodeLine lineNumber="3249"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::UDiv:</Highlight></CodeLine>
<Link id="l03250" /><CodeLine lineNumber="3250"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SDiv:</Highlight></CodeLine>
<Link id="l03251" /><CodeLine lineNumber="3251"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SRem:</Highlight></CodeLine>
<Link id="l03252" /><CodeLine lineNumber="3252"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::URem: &#123;</Highlight></CodeLine>
<Link id="l03253" /><CodeLine lineNumber="3253"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We have the option to use the safe-divisor idiom to avoid predication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03254" /><CodeLine lineNumber="3254"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The cost based decision here will always select safe-divisor for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03255" /><CodeLine lineNumber="3255"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// scalable vectors as scalarization isn&#39;t legal.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03256" /><CodeLine lineNumber="3256"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#91;ScalarCost, SafeDivisorCost&#93; = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad8398a35cd187d6a75b460fcf54b5236">getDivRemSpeculationCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l03257" /><CodeLine lineNumber="3257"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#add43c346a11ae1deb49142ba968eb07e">isDivRemScalarWithPredication</a>(ScalarCost, SafeDivisorCost);</Highlight></CodeLine>
<Link id="l03258" /><CodeLine lineNumber="3258"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03259" /><CodeLine lineNumber="3259"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03260" /><CodeLine lineNumber="3260"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03261" /><CodeLine lineNumber="3261"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03262" /><CodeLine lineNumber="3262"><Highlight kind="normal"></Highlight><Highlight kind="comment">// TODO: Fold into LoopVectorizationLegality::isMaskRequired.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03263" /><CodeLine lineNumber="3263" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">LoopVectorizationCostModel::isPredicatedInst</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03264" /><CodeLine lineNumber="3264"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If predication is not needed, avoid it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03265" /><CodeLine lineNumber="3265"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: We can use the loop-preheader as context point here and get</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03266" /><CodeLine lineNumber="3266"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// context sensitive reasoning for isSafeToSpeculativelyExecute.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03267" /><CodeLine lineNumber="3267"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8c8de8f62b5d2b27c4878d3effd7273">blockNeedsPredicationForAnyReason</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()) ||</Highlight></CodeLine>
<Link id="l03268" /><CodeLine lineNumber="3268"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a8601ff0320b6e29a13a2194200853425">isSafeToSpeculativelyExecute</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</Highlight></CodeLine>
<Link id="l03269" /><CodeLine lineNumber="3269"><Highlight kind="normal">      (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst, StoreInst, CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) ||</Highlight></CodeLine>
<Link id="l03270" /><CodeLine lineNumber="3270"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst, SwitchInst, PHINode, AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l03271" /><CodeLine lineNumber="3271"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03272" /><CodeLine lineNumber="3272"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03273" /><CodeLine lineNumber="3273"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the instruction was executed conditionally in the original scalar loop,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03274" /><CodeLine lineNumber="3274"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// predication is needed with a mask whose lanes are all possibly inactive.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03275" /><CodeLine lineNumber="3275"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;blockNeedsPredication(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()))</Highlight></CodeLine>
<Link id="l03276" /><CodeLine lineNumber="3276"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03277" /><CodeLine lineNumber="3277"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03278" /><CodeLine lineNumber="3278"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// All that remain are instructions with side-effects originally executed in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03279" /><CodeLine lineNumber="3279"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the loop unconditionally, but now execute under a tail-fold mask (only)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03280" /><CodeLine lineNumber="3280"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// having at least one active lane (the first). If the side-effects of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03281" /><CodeLine lineNumber="3281"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction are invariant, executing it w/o (the tail-folding) mask is safe</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03282" /><CodeLine lineNumber="3282"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// - it will cause the same side-effects as when masked.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03283" /><CodeLine lineNumber="3283"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal">(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l03284" /><CodeLine lineNumber="3284"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l03285" /><CodeLine lineNumber="3285"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight></CodeLine>
<Link id="l03286" /><CodeLine lineNumber="3286"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;instruction should have been considered by earlier checks&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03287" /><CodeLine lineNumber="3287"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Call:</Highlight></CodeLine>
<Link id="l03288" /><CodeLine lineNumber="3288"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Side-effects of a Call are assumed to be non-invariant, needing a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03289" /><CodeLine lineNumber="3289"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (fold-tail) mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03290" /><CodeLine lineNumber="3290"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l03291" /><CodeLine lineNumber="3291"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;should have returned earlier for calls not needing a mask&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03292" /><CodeLine lineNumber="3292"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03293" /><CodeLine lineNumber="3293"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Load:</Highlight></CodeLine>
<Link id="l03294" /><CodeLine lineNumber="3294"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the address is loop invariant no predication is needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03295" /><CodeLine lineNumber="3295"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInvariant(<a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l03296" /><CodeLine lineNumber="3296"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Store: &#123;</Highlight></CodeLine>
<Link id="l03297" /><CodeLine lineNumber="3297"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For stores, we need to prove both speculation safety (which follows from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03298" /><CodeLine lineNumber="3298"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the same argument as loads), but also must prove the value being stored</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03299" /><CodeLine lineNumber="3299"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is correct.  The easiest form of the later is to require that all values</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03300" /><CodeLine lineNumber="3300"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// stored are the same.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03301" /><CodeLine lineNumber="3301"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInvariant(<a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</Highlight></CodeLine>
<Link id="l03302" /><CodeLine lineNumber="3302"><Highlight kind="normal">             <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getValueOperand()));</Highlight></CodeLine>
<Link id="l03303" /><CodeLine lineNumber="3303"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03304" /><CodeLine lineNumber="3304"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::UDiv:</Highlight></CodeLine>
<Link id="l03305" /><CodeLine lineNumber="3305"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SDiv:</Highlight></CodeLine>
<Link id="l03306" /><CodeLine lineNumber="3306"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SRem:</Highlight></CodeLine>
<Link id="l03307" /><CodeLine lineNumber="3307"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::URem:</Highlight></CodeLine>
<Link id="l03308" /><CodeLine lineNumber="3308"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the divisor is loop-invariant no predication is needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03309" /><CodeLine lineNumber="3309"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l03310" /><CodeLine lineNumber="3310"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03311" /><CodeLine lineNumber="3311"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03312" /><CodeLine lineNumber="3312"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03313" /><CodeLine lineNumber="3313"><Highlight kind="normal">std::pair&lt;InstructionCost, InstructionCost&gt;</Highlight></CodeLine>
<Link id="l03314" /><CodeLine lineNumber="3314" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad8398a35cd187d6a75b460fcf54b5236"><Highlight kind="normal"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad8398a35cd187d6a75b460fcf54b5236">LoopVectorizationCostModel::getDivRemSpeculationCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l03315" /><CodeLine lineNumber="3315"><Highlight kind="normal">                                                    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03316" /><CodeLine lineNumber="3316"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::UDiv ||</Highlight></CodeLine>
<Link id="l03317" /><CodeLine lineNumber="3317"><Highlight kind="normal">         <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::SDiv ||</Highlight></CodeLine>
<Link id="l03318" /><CodeLine lineNumber="3318"><Highlight kind="normal">         <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::SRem ||</Highlight></CodeLine>
<Link id="l03319" /><CodeLine lineNumber="3319"><Highlight kind="normal">         <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::URem);</Highlight></CodeLine>
<Link id="l03320" /><CodeLine lineNumber="3320"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a8601ff0320b6e29a13a2194200853425">isSafeToSpeculativelyExecute</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l03321" /><CodeLine lineNumber="3321"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03322" /><CodeLine lineNumber="3322"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Scalarization isn&#39;t legal for scalable vector types</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03323" /><CodeLine lineNumber="3323"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarizationCost = <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l03324" /><CodeLine lineNumber="3324"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>()) &#123;</Highlight></CodeLine>
<Link id="l03325" /><CodeLine lineNumber="3325"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Get the scalarization cost and scale this amount by the probability of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03326" /><CodeLine lineNumber="3326"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// executing the predicated block. If the instruction is not predicated,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03327" /><CodeLine lineNumber="3327"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we fall through to the next case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03328" /><CodeLine lineNumber="3328"><Highlight kind="normal">    ScalarizationCost = 0;</Highlight></CodeLine>
<Link id="l03329" /><CodeLine lineNumber="3329"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03330" /><CodeLine lineNumber="3330"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// These instructions have a non-void type, so account for the phi nodes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03331" /><CodeLine lineNumber="3331"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// that we will create. This cost is likely to be zero. The phi node</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03332" /><CodeLine lineNumber="3332"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// cost, if any, should be scaled by the block probability because it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03333" /><CodeLine lineNumber="3333"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// models a copy at the end of each predicated block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03334" /><CodeLine lineNumber="3334"><Highlight kind="normal">    ScalarizationCost += VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42;</Highlight></CodeLine>
<Link id="l03335" /><CodeLine lineNumber="3335"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCFInstrCost(Instruction::PHI, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l03336" /><CodeLine lineNumber="3336"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03337" /><CodeLine lineNumber="3337"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The cost of the non-predicated instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03338" /><CodeLine lineNumber="3338"><Highlight kind="normal">    ScalarizationCost += VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42;</Highlight></CodeLine>
<Link id="l03339" /><CodeLine lineNumber="3339"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l03340" /><CodeLine lineNumber="3340"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03341" /><CodeLine lineNumber="3341"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The cost of insertelement and extractelement instructions needed for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03342" /><CodeLine lineNumber="3342"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// scalarization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03343" /><CodeLine lineNumber="3343"><Highlight kind="normal">    ScalarizationCost += getScalarizationOverhead(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l03344" /><CodeLine lineNumber="3344"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03345" /><CodeLine lineNumber="3345"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Scale the cost by the probability of executing the predicated blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03346" /><CodeLine lineNumber="3346"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This assumes the predicated block for each vector lane is equally</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03347" /><CodeLine lineNumber="3347"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// likely.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03348" /><CodeLine lineNumber="3348"><Highlight kind="normal">    ScalarizationCost = ScalarizationCost / <a href="/docs/api/namespaces/llvm/#adb5d7cdf62c5d24e421899cd74c4550d">getReciprocalPredBlockProb</a>();</Highlight></CodeLine>
<Link id="l03349" /><CodeLine lineNumber="3349"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03350" /><CodeLine lineNumber="3350"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> SafeDivisorCost = 0;</Highlight></CodeLine>
<Link id="l03351" /><CodeLine lineNumber="3351"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03352" /><CodeLine lineNumber="3352"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VecTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), VF);</Highlight></CodeLine>
<Link id="l03353" /><CodeLine lineNumber="3353"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03354" /><CodeLine lineNumber="3354"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The cost of the select guard to ensure all lanes are well defined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03355" /><CodeLine lineNumber="3355"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// after we speculate above any internal control flow.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03356" /><CodeLine lineNumber="3356"><Highlight kind="normal">  SafeDivisorCost +=</Highlight></CodeLine>
<Link id="l03357" /><CodeLine lineNumber="3357"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCmpSelInstrCost(Instruction::Select, VecTy,</Highlight></CodeLine>
<Link id="l03358" /><CodeLine lineNumber="3358"><Highlight kind="normal">                             <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext()), VF),</Highlight></CodeLine>
<Link id="l03359" /><CodeLine lineNumber="3359"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">CmpInst::BAD&#95;ICMP&#95;PREDICATE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l03360" /><CodeLine lineNumber="3360"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03361" /><CodeLine lineNumber="3361"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Certain instructions can be cheaper to vectorize if they have a constant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03362" /><CodeLine lineNumber="3362"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// second vector operand. One example of this are shifts on x86.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03363" /><CodeLine lineNumber="3363"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op2 = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l03364" /><CodeLine lineNumber="3364"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Op2Info = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getOperandInfo(Op2);</Highlight></CodeLine>
<Link id="l03365" /><CodeLine lineNumber="3365"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op2Info.Kind == <a href="/docs/api/classes/llvm/targettransforminfo/#afa38851d75434d1476444ac93f94cb4ca9c0eecea29e9fa58e4dac7ee32b9b2ac">TargetTransformInfo::OK&#95;AnyValue</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l03366" /><CodeLine lineNumber="3366"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInvariant(Op2))</Highlight></CodeLine>
<Link id="l03367" /><CodeLine lineNumber="3367"><Highlight kind="normal">    Op2Info.Kind = <a href="/docs/api/classes/llvm/targettransforminfo/#afa38851d75434d1476444ac93f94cb4ca7aa61d9e9d33bdf28478754c69c59640">TargetTransformInfo::OK&#95;UniformValue</a>;</Highlight></CodeLine>
<Link id="l03368" /><CodeLine lineNumber="3368"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03369" /><CodeLine lineNumber="3369"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;, 4&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operand&#95;values());</Highlight></CodeLine>
<Link id="l03370" /><CodeLine lineNumber="3370"><Highlight kind="normal">  SafeDivisorCost += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(</Highlight></CodeLine>
<Link id="l03371" /><CodeLine lineNumber="3371"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VecTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>,</Highlight></CodeLine>
<Link id="l03372" /><CodeLine lineNumber="3372"><Highlight kind="normal">    &#123;TargetTransformInfo::OK&#95;AnyValue, TargetTransformInfo::OP&#95;None&#125;,</Highlight></CodeLine>
<Link id="l03373" /><CodeLine lineNumber="3373"><Highlight kind="normal">    Op2Info, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03374" /><CodeLine lineNumber="3374"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;ScalarizationCost, SafeDivisorCost&#125;;</Highlight></CodeLine>
<Link id="l03375" /><CodeLine lineNumber="3375"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03376" /><CodeLine lineNumber="3376"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03377" /><CodeLine lineNumber="3377" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5964ce9ba38fe5a4d372242ac39e3f1d"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5964ce9ba38fe5a4d372242ac39e3f1d">LoopVectorizationCostModel::interleavedAccessCanBeWidened</a>(</Highlight></CodeLine>
<Link id="l03378" /><CodeLine lineNumber="3378"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l03379" /><CodeLine lineNumber="3379"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85e3110b9fe54caf00fe4297d1b4f0b6">isAccessInterleaved</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expecting interleaved access.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03380" /><CodeLine lineNumber="3380"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">CM&#95;Unknown</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l03381" /><CodeLine lineNumber="3381"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Decision should not be set yet.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03382" /><CodeLine lineNumber="3382"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Group = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c">getInterleavedAccessGroup</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03383" /><CodeLine lineNumber="3383"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Group &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Must have a group.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03384" /><CodeLine lineNumber="3384"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> InterleaveFactor = Group-&gt;getFactor();</Highlight></CodeLine>
<Link id="l03385" /><CodeLine lineNumber="3385"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03386" /><CodeLine lineNumber="3386"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the instruction&#39;s allocated size doesn&#39;t equal its type size, it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03387" /><CodeLine lineNumber="3387"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// requires padding and will be scalarized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03388" /><CodeLine lineNumber="3388"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDataLayout();</Highlight></CodeLine>
<Link id="l03389" /><CodeLine lineNumber="3389"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ScalarTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03390" /><CodeLine lineNumber="3390"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#aa407c2e7d895ed29af8cc68563c03065">hasIrregularType</a>(ScalarTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</Highlight></CodeLine>
<Link id="l03391" /><CodeLine lineNumber="3391"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03392" /><CodeLine lineNumber="3392"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03393" /><CodeLine lineNumber="3393"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We currently only know how to emit interleave/deinterleave with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03394" /><CodeLine lineNumber="3394"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Factor=2 for scalable vectors. This is purely an implementation</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03395" /><CodeLine lineNumber="3395"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// limit.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03396" /><CodeLine lineNumber="3396"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp; InterleaveFactor != 2)</Highlight></CodeLine>
<Link id="l03397" /><CodeLine lineNumber="3397"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03398" /><CodeLine lineNumber="3398"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03399" /><CodeLine lineNumber="3399"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the group involves a non-integral pointer, we may not be able to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03400" /><CodeLine lineNumber="3400"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// losslessly cast all values to a common type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03401" /><CodeLine lineNumber="3401"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ScalarNI = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isNonIntegralPointerType(ScalarTy);</Highlight></CodeLine>
<Link id="l03402" /><CodeLine lineNumber="3402"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 0; Idx &lt; InterleaveFactor; Idx++) &#123;</Highlight></CodeLine>
<Link id="l03403" /><CodeLine lineNumber="3403"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Member = Group-&gt;getMember(Idx);</Highlight></CodeLine>
<Link id="l03404" /><CodeLine lineNumber="3404"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Member)</Highlight></CodeLine>
<Link id="l03405" /><CodeLine lineNumber="3405"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03406" /><CodeLine lineNumber="3406"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MemberTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(Member);</Highlight></CodeLine>
<Link id="l03407" /><CodeLine lineNumber="3407"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MemberNI = <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.isNonIntegralPointerType(MemberTy);</Highlight></CodeLine>
<Link id="l03408" /><CodeLine lineNumber="3408"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t coerce non-integral pointers to integers or vice versa.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03409" /><CodeLine lineNumber="3409"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MemberNI != ScalarNI)</Highlight></CodeLine>
<Link id="l03410" /><CodeLine lineNumber="3410"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: Consider adding special nullptr value case here</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03411" /><CodeLine lineNumber="3411"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03412" /><CodeLine lineNumber="3412"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MemberNI &amp;&amp; ScalarNI &amp;&amp;</Highlight></CodeLine>
<Link id="l03413" /><CodeLine lineNumber="3413"><Highlight kind="normal">        ScalarTy-&gt;getPointerAddressSpace() !=</Highlight></CodeLine>
<Link id="l03414" /><CodeLine lineNumber="3414"><Highlight kind="normal">            MemberTy-&gt;getPointerAddressSpace())</Highlight></CodeLine>
<Link id="l03415" /><CodeLine lineNumber="3415"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03416" /><CodeLine lineNumber="3416"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03417" /><CodeLine lineNumber="3417"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03418" /><CodeLine lineNumber="3418"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if masking is required.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03419" /><CodeLine lineNumber="3419"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A Group may need masking for one of two reasons: it resides in a block that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03420" /><CodeLine lineNumber="3420"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// needs predication, or it was decided to use masking to deal with gaps</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03421" /><CodeLine lineNumber="3421"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (either a gap at the end of a load-access that may result in a speculative</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03422" /><CodeLine lineNumber="3422"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// load, or any gaps in a store-access).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03423" /><CodeLine lineNumber="3423"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> PredicatedAccessRequiresMasking =</Highlight></CodeLine>
<Link id="l03424" /><CodeLine lineNumber="3424"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8c8de8f62b5d2b27c4878d3effd7273">blockNeedsPredicationForAnyReason</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()) &amp;&amp;</Highlight></CodeLine>
<Link id="l03425" /><CodeLine lineNumber="3425"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03426" /><CodeLine lineNumber="3426"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> LoadAccessWithGapsRequiresEpilogMasking =</Highlight></CodeLine>
<Link id="l03427" /><CodeLine lineNumber="3427"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; Group-&gt;requiresScalarEpilogue() &amp;&amp;</Highlight></CodeLine>
<Link id="l03428" /><CodeLine lineNumber="3428"><Highlight kind="normal">      !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af67062c22dbf5e0ab35164a778768476">isScalarEpilogueAllowed</a>();</Highlight></CodeLine>
<Link id="l03429" /><CodeLine lineNumber="3429"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> StoreAccessWithGapsRequiresMasking =</Highlight></CodeLine>
<Link id="l03430" /><CodeLine lineNumber="3430"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; (Group-&gt;getNumMembers() &lt; Group-&gt;getFactor());</Highlight></CodeLine>
<Link id="l03431" /><CodeLine lineNumber="3431"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PredicatedAccessRequiresMasking &amp;&amp;</Highlight></CodeLine>
<Link id="l03432" /><CodeLine lineNumber="3432"><Highlight kind="normal">      !LoadAccessWithGapsRequiresEpilogMasking &amp;&amp;</Highlight></CodeLine>
<Link id="l03433" /><CodeLine lineNumber="3433"><Highlight kind="normal">      !StoreAccessWithGapsRequiresMasking)</Highlight></CodeLine>
<Link id="l03434" /><CodeLine lineNumber="3434"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03435" /><CodeLine lineNumber="3435"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03436" /><CodeLine lineNumber="3436"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If masked interleaving is required, we expect that the user/target had</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03437" /><CodeLine lineNumber="3437"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// enabled it, because otherwise it either wouldn&#39;t have been created or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03438" /><CodeLine lineNumber="3438"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// it should have been invalidated by the CostModel.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03439" /><CodeLine lineNumber="3439"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="#adf8d8fb6f39b9c0cf21d55b7229d35e2">useMaskedInterleavedAccesses</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l03440" /><CodeLine lineNumber="3440"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Masked interleave-groups for predicated accesses are not enabled.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03441" /><CodeLine lineNumber="3441"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03442" /><CodeLine lineNumber="3442"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Group-&gt;isReverse())</Highlight></CodeLine>
<Link id="l03443" /><CodeLine lineNumber="3443"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03444" /><CodeLine lineNumber="3444"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03445" /><CodeLine lineNumber="3445"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Ty = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03446" /><CodeLine lineNumber="3446"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/align">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03447" /><CodeLine lineNumber="3447"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ? <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedLoad(Ty, Alignment)</Highlight></CodeLine>
<Link id="l03448" /><CodeLine lineNumber="3448"><Highlight kind="normal">                          : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isLegalMaskedStore(Ty, Alignment);</Highlight></CodeLine>
<Link id="l03449" /><CodeLine lineNumber="3449"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03450" /><CodeLine lineNumber="3450"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03451" /><CodeLine lineNumber="3451" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a59a6dd7531c8683174f886ff7698cc63"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a59a6dd7531c8683174f886ff7698cc63">LoopVectorizationCostModel::memoryInstructionCanBeWidened</a>(</Highlight></CodeLine>
<Link id="l03452" /><CodeLine lineNumber="3452"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l03453" /><CodeLine lineNumber="3453"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get and ensure we have a valid memory instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03454" /><CodeLine lineNumber="3454"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst, StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Invalid memory instruction&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03455" /><CodeLine lineNumber="3455"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03456" /><CodeLine lineNumber="3456"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03457" /><CodeLine lineNumber="3457"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ScalarTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03458" /><CodeLine lineNumber="3458"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03459" /><CodeLine lineNumber="3459"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// In order to be widened, the pointer should be consecutive, first of all.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03460" /><CodeLine lineNumber="3460"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isConsecutivePtr(ScalarTy, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>))</Highlight></CodeLine>
<Link id="l03461" /><CodeLine lineNumber="3461"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03462" /><CodeLine lineNumber="3462"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03463" /><CodeLine lineNumber="3463"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the instruction is a store located in a predicated block, it will be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03464" /><CodeLine lineNumber="3464"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// scalarized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03465" /><CodeLine lineNumber="3465"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8">isScalarWithPredication</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</Highlight></CodeLine>
<Link id="l03466" /><CodeLine lineNumber="3466"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03467" /><CodeLine lineNumber="3467"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03468" /><CodeLine lineNumber="3468"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the instruction&#39;s allocated size doesn&#39;t equal it&#39;s type size, it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03469" /><CodeLine lineNumber="3469"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// requires padding and will be scalarized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03470" /><CodeLine lineNumber="3470"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDataLayout();</Highlight></CodeLine>
<Link id="l03471" /><CodeLine lineNumber="3471"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#aa407c2e7d895ed29af8cc68563c03065">hasIrregularType</a>(ScalarTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>))</Highlight></CodeLine>
<Link id="l03472" /><CodeLine lineNumber="3472"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03473" /><CodeLine lineNumber="3473"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03474" /><CodeLine lineNumber="3474"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03475" /><CodeLine lineNumber="3475"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03476" /><CodeLine lineNumber="3476"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03477" /><CodeLine lineNumber="3477"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> LoopVectorizationCostModel::collectLoopUniforms(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l03478" /><CodeLine lineNumber="3478"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We should not collect Uniforms more than once per VF. Right now,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03479" /><CodeLine lineNumber="3479"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// this function is called from collectUniformsAndScalars(), which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03480" /><CodeLine lineNumber="3480"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// already does this check. Collecting Uniforms for VF=1 does not make any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03481" /><CodeLine lineNumber="3481"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// sense.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03482" /><CodeLine lineNumber="3482"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03483" /><CodeLine lineNumber="3483"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; !Uniforms.<a href="/docs/api/classes/llvm/densemapbase/#a836d9cba6deced0bb1fa7333ce5afd3a">contains</a>(VF) &amp;&amp;</Highlight></CodeLine>
<Link id="l03484" /><CodeLine lineNumber="3484"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;This function should not be visited twice for the same VF&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03485" /><CodeLine lineNumber="3485"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03486" /><CodeLine lineNumber="3486"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Visit the list of Uniforms. If we find no uniform value, we won&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03487" /><CodeLine lineNumber="3487"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// analyze again.  Uniforms.count(VF) will return 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03488" /><CodeLine lineNumber="3488"><Highlight kind="normal">  Uniforms&#91;VF&#93;.<a href="/docs/api/classes/llvm/densemapbase/#adf4e7878fc0b3b8dcde545178564190d">clear</a>();</Highlight></CodeLine>
<Link id="l03489" /><CodeLine lineNumber="3489"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03490" /><CodeLine lineNumber="3490"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now we know that the loop is vectorizable!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03491" /><CodeLine lineNumber="3491"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect instructions inside the loop that will remain uniform after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03492" /><CodeLine lineNumber="3492"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03493" /><CodeLine lineNumber="3493"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03494" /><CodeLine lineNumber="3494"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Global values, params and instructions outside of current loop are out of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03495" /><CodeLine lineNumber="3495"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// scope.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03496" /><CodeLine lineNumber="3496"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsOutOfScope = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;V) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03497" /><CodeLine lineNumber="3497"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V);</Highlight></CodeLine>
<Link id="l03498" /><CodeLine lineNumber="3498"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l03499" /><CodeLine lineNumber="3499"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03500" /><CodeLine lineNumber="3500"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03501" /><CodeLine lineNumber="3501"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Worklist containing uniform instructions demanding lane 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03502" /><CodeLine lineNumber="3502"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Instruction &#42;&gt;</a> Worklist;</Highlight></CodeLine>
<Link id="l03503" /><CodeLine lineNumber="3503"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03504" /><CodeLine lineNumber="3504"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add uniform instructions demanding lane 0 to the worklist. Instructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03505" /><CodeLine lineNumber="3505"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that require predication must not be considered uniform after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03506" /><CodeLine lineNumber="3506"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vectorization, because that would create an erroneous replicating region</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03507" /><CodeLine lineNumber="3507"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// where only a single instance out of VF should be formed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03508" /><CodeLine lineNumber="3508"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> AddToWorklistIfAllowed = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03509" /><CodeLine lineNumber="3509"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsOutOfScope(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l03510" /><CodeLine lineNumber="3510"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found not uniform due to scope: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03511" /><CodeLine lineNumber="3511"><Highlight kind="normal">                        &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03512" /><CodeLine lineNumber="3512"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03513" /><CodeLine lineNumber="3513"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03514" /><CodeLine lineNumber="3514"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">isPredicatedInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l03515" /><CodeLine lineNumber="3515"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l03516" /><CodeLine lineNumber="3516"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found not uniform due to requiring predication: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a></Highlight></CodeLine>
<Link id="l03517" /><CodeLine lineNumber="3517"><Highlight kind="normal">                 &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03518" /><CodeLine lineNumber="3518"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03519" /><CodeLine lineNumber="3519"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03520" /><CodeLine lineNumber="3520"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found uniform instruction: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03521" /><CodeLine lineNumber="3521"><Highlight kind="normal">    Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03522" /><CodeLine lineNumber="3522"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03523" /><CodeLine lineNumber="3523"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03524" /><CodeLine lineNumber="3524"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Start with the conditional branches exiting the loop. If the branch</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03525" /><CodeLine lineNumber="3525"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// condition is an instruction contained in the loop that is only used by the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03526" /><CodeLine lineNumber="3526"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// branch, it is uniform. Note conditions from uncountable early exits are not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03527" /><CodeLine lineNumber="3527"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// uniform.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03528" /><CodeLine lineNumber="3528"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;BasicBlock &#42;&gt;</a> Exiting;</Highlight></CodeLine>
<Link id="l03529" /><CodeLine lineNumber="3529"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getExitingBlocks(Exiting);</Highlight></CodeLine>
<Link id="l03530" /><CodeLine lineNumber="3530"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (BasicBlock &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> : Exiting) &#123;</Highlight></CodeLine>
<Link id="l03531" /><CodeLine lineNumber="3531"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;hasUncountableEarlyExit() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getLoopLatch() != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>)</Highlight></CodeLine>
<Link id="l03532" /><CodeLine lineNumber="3532"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03533" /><CodeLine lineNumber="3533"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>-&gt;getTerminator()-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l03534" /><CodeLine lineNumber="3534"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Cmp &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(Cmp) &amp;&amp; <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l03535" /><CodeLine lineNumber="3535"><Highlight kind="normal">      AddToWorklistIfAllowed(Cmp);</Highlight></CodeLine>
<Link id="l03536" /><CodeLine lineNumber="3536"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03537" /><CodeLine lineNumber="3537"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03538" /><CodeLine lineNumber="3538"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> PrevVF = VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ae7510a639ca53c1bfa1c90c6dfc7eb2e">divideCoefficientBy</a>(2);</Highlight></CodeLine>
<Link id="l03539" /><CodeLine lineNumber="3539"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Return true if all lanes perform the same memory operation, and we can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03540" /><CodeLine lineNumber="3540"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// thus choose to execute only one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03541" /><CodeLine lineNumber="3541"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsUniformMemOpUse = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l03542" /><CodeLine lineNumber="3542"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the value was already known to not be uniform for the previous</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03543" /><CodeLine lineNumber="3543"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (smaller VF), it cannot be uniform for the larger VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03544" /><CodeLine lineNumber="3544"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PrevVF.isVector()) &#123;</Highlight></CodeLine>
<Link id="l03545" /><CodeLine lineNumber="3545"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/anonymous-cskyconstantislandpass-cpp-/#a0bd7d621ba8de56e4052df49da823802">Iter</a> = Uniforms.find(PrevVF);</Highlight></CodeLine>
<Link id="l03546" /><CodeLine lineNumber="3546"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Iter != Uniforms.end() &amp;&amp; !<a href="/docs/api/namespaces/anonymous-cskyconstantislandpass-cpp-/#a0bd7d621ba8de56e4052df49da823802">Iter</a>-&gt;second.contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l03547" /><CodeLine lineNumber="3547"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03548" /><CodeLine lineNumber="3548"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03549" /><CodeLine lineNumber="3549"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isUniformMemOp(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</Highlight></CodeLine>
<Link id="l03550" /><CodeLine lineNumber="3550"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03551" /><CodeLine lineNumber="3551"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l03552" /><CodeLine lineNumber="3552"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Loading the same address always produces the same result - at least</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03553" /><CodeLine lineNumber="3553"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// assuming aliasing and ordering which have already been checked.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03554" /><CodeLine lineNumber="3554"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03555" /><CodeLine lineNumber="3555"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Storing the same value on every iteration.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03556" /><CodeLine lineNumber="3556"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getValueOperand());</Highlight></CodeLine>
<Link id="l03557" /><CodeLine lineNumber="3557"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03558" /><CodeLine lineNumber="3558"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03559" /><CodeLine lineNumber="3559"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsUniformDecision = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ElementCount VF) &#123;</Highlight></CodeLine>
<Link id="l03560" /><CodeLine lineNumber="3560"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> WideningDecision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l03561" /><CodeLine lineNumber="3561"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(WideningDecision != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">CM&#95;Unknown</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l03562" /><CodeLine lineNumber="3562"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Widening decision should be ready at this moment&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03563" /><CodeLine lineNumber="3563"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03564" /><CodeLine lineNumber="3564"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsUniformMemOpUse(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l03565" /><CodeLine lineNumber="3565"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03566" /><CodeLine lineNumber="3566"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03567" /><CodeLine lineNumber="3567"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> (WideningDecision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260adc468760c02910f77bad7525bc66c334">CM&#95;Widen</a> ||</Highlight></CodeLine>
<Link id="l03568" /><CodeLine lineNumber="3568"><Highlight kind="normal">            WideningDecision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a058eacbd3c28e2ecec2af7db726ce527">CM&#95;Widen&#95;Reverse</a> ||</Highlight></CodeLine>
<Link id="l03569" /><CodeLine lineNumber="3569"><Highlight kind="normal">            WideningDecision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971">CM&#95;Interleave</a>);</Highlight></CodeLine>
<Link id="l03570" /><CodeLine lineNumber="3570"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03571" /><CodeLine lineNumber="3571"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03572" /><CodeLine lineNumber="3572"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Returns true if Ptr is the pointer operand of a memory access instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03573" /><CodeLine lineNumber="3573"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// I, I is known to not require scalarization, and the pointer is not also</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03574" /><CodeLine lineNumber="3574"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// stored.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03575" /><CodeLine lineNumber="3575"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsVectorizedMemAccessUse = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03576" /><CodeLine lineNumber="3576"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0) == <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)</Highlight></CodeLine>
<Link id="l03577" /><CodeLine lineNumber="3577"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03578" /><CodeLine lineNumber="3578"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) == <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l03579" /><CodeLine lineNumber="3579"><Highlight kind="normal">           (IsUniformDecision(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) || <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInvariant(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>));</Highlight></CodeLine>
<Link id="l03580" /><CodeLine lineNumber="3580"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l03581" /><CodeLine lineNumber="3581"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03582" /><CodeLine lineNumber="3582"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Holds a list of values which are known to have at least one uniform use.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03583" /><CodeLine lineNumber="3583"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note that there may be other uses which aren&#39;t uniform.  A &quot;uniform use&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03584" /><CodeLine lineNumber="3584"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// here is something which only demands lane 0 of the unrolled iterations;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03585" /><CodeLine lineNumber="3585"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// it does not imply that all lanes produce the same value (e.g. this is not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03586" /><CodeLine lineNumber="3586"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the usual meaning of uniform)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03587" /><CodeLine lineNumber="3587"><Highlight kind="normal">  SetVector&lt;Value &#42;&gt; HasUniformUse;</Highlight></CodeLine>
<Link id="l03588" /><CodeLine lineNumber="3588"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03589" /><CodeLine lineNumber="3589"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Scan the loop for instructions which are either a) known to have only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03590" /><CodeLine lineNumber="3590"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// lane 0 demanded or b) are uses which demand only lane 0 of their operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03591" /><CodeLine lineNumber="3591"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks())</Highlight></CodeLine>
<Link id="l03592" /><CodeLine lineNumber="3592"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l03593" /><CodeLine lineNumber="3593"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IntrinsicInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l03594" /><CodeLine lineNumber="3594"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID()) &#123;</Highlight></CodeLine>
<Link id="l03595" /><CodeLine lineNumber="3595"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::sideeffect:</Highlight></CodeLine>
<Link id="l03596" /><CodeLine lineNumber="3596"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::experimental&#95;noalias&#95;scope&#95;decl:</Highlight></CodeLine>
<Link id="l03597" /><CodeLine lineNumber="3597"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::assume:</Highlight></CodeLine>
<Link id="l03598" /><CodeLine lineNumber="3598"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::lifetime&#95;start:</Highlight></CodeLine>
<Link id="l03599" /><CodeLine lineNumber="3599"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::lifetime&#95;end:</Highlight></CodeLine>
<Link id="l03600" /><CodeLine lineNumber="3600"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;hasLoopInvariantOperands(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l03601" /><CodeLine lineNumber="3601"><Highlight kind="normal">            AddToWorklistIfAllowed(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03602" /><CodeLine lineNumber="3602"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03603" /><CodeLine lineNumber="3603"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l03604" /><CodeLine lineNumber="3604"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03605" /><CodeLine lineNumber="3605"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l03606" /><CodeLine lineNumber="3606"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03607" /><CodeLine lineNumber="3607"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03608" /><CodeLine lineNumber="3608"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// ExtractValue instructions must be uniform, because the operands are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03609" /><CodeLine lineNumber="3609"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// known to be loop-invariant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03610" /><CodeLine lineNumber="3610"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;EVI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ExtractValueInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l03611" /><CodeLine lineNumber="3611"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IsOutOfScope(EVI-&gt;getAggregateOperand()) &amp;&amp;</Highlight></CodeLine>
<Link id="l03612" /><CodeLine lineNumber="3612"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;Expected aggregate value to be loop invariant&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03613" /><CodeLine lineNumber="3613"><Highlight kind="normal">        AddToWorklistIfAllowed(EVI);</Highlight></CodeLine>
<Link id="l03614" /><CodeLine lineNumber="3614"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03615" /><CodeLine lineNumber="3615"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l03616" /><CodeLine lineNumber="3616"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03617" /><CodeLine lineNumber="3617"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If there&#39;s no pointer operand, there&#39;s nothing to do.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03618" /><CodeLine lineNumber="3618"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03619" /><CodeLine lineNumber="3619"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)</Highlight></CodeLine>
<Link id="l03620" /><CodeLine lineNumber="3620"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03621" /><CodeLine lineNumber="3621"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03622" /><CodeLine lineNumber="3622"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsUniformMemOpUse(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l03623" /><CodeLine lineNumber="3623"><Highlight kind="normal">        AddToWorklistIfAllowed(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03624" /><CodeLine lineNumber="3624"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03625" /><CodeLine lineNumber="3625"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsVectorizedMemAccessUse(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>))</Highlight></CodeLine>
<Link id="l03626" /><CodeLine lineNumber="3626"><Highlight kind="normal">        HasUniformUse.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</Highlight></CodeLine>
<Link id="l03627" /><CodeLine lineNumber="3627"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03628" /><CodeLine lineNumber="3628"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03629" /><CodeLine lineNumber="3629"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add to the worklist any operands which have &#42;only&#42; uniform (e.g. lane 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03630" /><CodeLine lineNumber="3630"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// demanding) users.  Since loops are assumed to be in LCSSA form, this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03631" /><CodeLine lineNumber="3631"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// disallows uses outside the loop as well.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03632" /><CodeLine lineNumber="3632"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;V : HasUniformUse) &#123;</Highlight></CodeLine>
<Link id="l03633" /><CodeLine lineNumber="3633"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsOutOfScope(V))</Highlight></CodeLine>
<Link id="l03634" /><CodeLine lineNumber="3634"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03635" /><CodeLine lineNumber="3635"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(V);</Highlight></CodeLine>
<Link id="l03636" /><CodeLine lineNumber="3636"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> UsersAreMemAccesses = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users(), &#91;&amp;&#93;(User &#42;U) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03637" /><CodeLine lineNumber="3637"><Highlight kind="normal">      auto &#42;UI = cast&lt;Instruction&gt;(U);</Highlight></CodeLine>
<Link id="l03638" /><CodeLine lineNumber="3638"><Highlight kind="normal">      return TheLoop-&gt;contains(UI) &amp;&amp; IsVectorizedMemAccessUse(UI, V);</Highlight></CodeLine>
<Link id="l03639" /><CodeLine lineNumber="3639"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l03640" /><CodeLine lineNumber="3640"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UsersAreMemAccesses)</Highlight></CodeLine>
<Link id="l03641" /><CodeLine lineNumber="3641"><Highlight kind="normal">      AddToWorklistIfAllowed(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l03642" /><CodeLine lineNumber="3642"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03643" /><CodeLine lineNumber="3643"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03644" /><CodeLine lineNumber="3644"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Expand Worklist in topological order: whenever a new instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03645" /><CodeLine lineNumber="3645"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is added , its users should be already inside Worklist.  It ensures</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03646" /><CodeLine lineNumber="3646"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a uniform instruction will only be used by uniform instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03647" /><CodeLine lineNumber="3647"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 0;</Highlight></CodeLine>
<Link id="l03648" /><CodeLine lineNumber="3648"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (Idx != Worklist.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>()) &#123;</Highlight></CodeLine>
<Link id="l03649" /><CodeLine lineNumber="3649"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Worklist&#91;Idx++&#93;;</Highlight></CodeLine>
<Link id="l03650" /><CodeLine lineNumber="3650"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03651" /><CodeLine lineNumber="3651"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OV : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operand&#95;values()) &#123;</Highlight></CodeLine>
<Link id="l03652" /><CodeLine lineNumber="3652"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// isOutOfScope operands cannot be uniform instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03653" /><CodeLine lineNumber="3653"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsOutOfScope(OV))</Highlight></CodeLine>
<Link id="l03654" /><CodeLine lineNumber="3654"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03655" /><CodeLine lineNumber="3655"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// First order recurrence Phi&#39;s should typically be considered</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03656" /><CodeLine lineNumber="3656"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// non-uniform.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03657" /><CodeLine lineNumber="3657"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/include/include/llvm/include/llvm/sandboxir/instruction-h/#a0b0cd724f4b7f8589a602b17d6caa1fb">OP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(OV);</Highlight></CodeLine>
<Link id="l03658" /><CodeLine lineNumber="3658"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/include/include/llvm/include/llvm/sandboxir/instruction-h/#a0b0cd724f4b7f8589a602b17d6caa1fb">OP</a> &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isFixedOrderRecurrence(<a href="/docs/api/files/include/include/llvm/include/llvm/sandboxir/instruction-h/#a0b0cd724f4b7f8589a602b17d6caa1fb">OP</a>))</Highlight></CodeLine>
<Link id="l03659" /><CodeLine lineNumber="3659"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03660" /><CodeLine lineNumber="3660"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If all the users of the operand are uniform, then add the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03661" /><CodeLine lineNumber="3661"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// operand into the uniform worklist.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03662" /><CodeLine lineNumber="3662"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(OV);</Highlight></CodeLine>
<Link id="l03663" /><CodeLine lineNumber="3663"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(OI-&gt;users(), &#91;&amp;&#93;(User &#42;U) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03664" /><CodeLine lineNumber="3664"><Highlight kind="normal">            auto &#42;J = cast&lt;Instruction&gt;(U);</Highlight></CodeLine>
<Link id="l03665" /><CodeLine lineNumber="3665"><Highlight kind="normal">            return Worklist.count(J) || IsVectorizedMemAccessUse(J, OI);</Highlight></CodeLine>
<Link id="l03666" /><CodeLine lineNumber="3666"><Highlight kind="normal">          &#125;))</Highlight></CodeLine>
<Link id="l03667" /><CodeLine lineNumber="3667"><Highlight kind="normal">        AddToWorklistIfAllowed(OI);</Highlight></CodeLine>
<Link id="l03668" /><CodeLine lineNumber="3668"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03669" /><CodeLine lineNumber="3669"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03670" /><CodeLine lineNumber="3670"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03671" /><CodeLine lineNumber="3671"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For an instruction to be added into Worklist above, all its users inside</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03672" /><CodeLine lineNumber="3672"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the loop should also be in Worklist. However, this condition cannot be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03673" /><CodeLine lineNumber="3673"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// true for phi nodes that form a cyclic dependence. We must process phi</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03674" /><CodeLine lineNumber="3674"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// nodes separately. An induction variable will remain uniform if all users</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03675" /><CodeLine lineNumber="3675"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the induction variable and induction variable update remain uniform.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03676" /><CodeLine lineNumber="3676"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The code below handles both pointer and non-pointer induction variables.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03677" /><CodeLine lineNumber="3677"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;Latch = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getLoopLatch();</Highlight></CodeLine>
<Link id="l03678" /><CodeLine lineNumber="3678"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Induction : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getInductionVars()) &#123;</Highlight></CodeLine>
<Link id="l03679" /><CodeLine lineNumber="3679"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Ind = Induction.first;</Highlight></CodeLine>
<Link id="l03680" /><CodeLine lineNumber="3680"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IndUpdate = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Ind-&gt;getIncomingValueForBlock(Latch));</Highlight></CodeLine>
<Link id="l03681" /><CodeLine lineNumber="3681"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03682" /><CodeLine lineNumber="3682"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Determine if all users of the induction variable are uniform after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03683" /><CodeLine lineNumber="3683"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03684" /><CodeLine lineNumber="3684"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> UniformInd = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(Ind-&gt;users(), &#91;&amp;&#93;(User &#42;U) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03685" /><CodeLine lineNumber="3685"><Highlight kind="normal">      auto &#42;I = cast&lt;Instruction&gt;(U);</Highlight></CodeLine>
<Link id="l03686" /><CodeLine lineNumber="3686"><Highlight kind="normal">      return I == IndUpdate || !TheLoop-&gt;contains(I) || Worklist.count(I) ||</Highlight></CodeLine>
<Link id="l03687" /><CodeLine lineNumber="3687"><Highlight kind="normal">             IsVectorizedMemAccessUse(I, Ind);</Highlight></CodeLine>
<Link id="l03688" /><CodeLine lineNumber="3688"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l03689" /><CodeLine lineNumber="3689"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UniformInd)</Highlight></CodeLine>
<Link id="l03690" /><CodeLine lineNumber="3690"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03691" /><CodeLine lineNumber="3691"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03692" /><CodeLine lineNumber="3692"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Determine if all users of the induction variable update instruction are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03693" /><CodeLine lineNumber="3693"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// uniform after vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03694" /><CodeLine lineNumber="3694"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> UniformIndUpdate = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(IndUpdate-&gt;users(), &#91;&amp;&#93;(User &#42;U) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03695" /><CodeLine lineNumber="3695"><Highlight kind="normal">      auto &#42;I = cast&lt;Instruction&gt;(U);</Highlight></CodeLine>
<Link id="l03696" /><CodeLine lineNumber="3696"><Highlight kind="normal">      return I == Ind || Worklist.count(I) ||</Highlight></CodeLine>
<Link id="l03697" /><CodeLine lineNumber="3697"><Highlight kind="normal">             IsVectorizedMemAccessUse(I, IndUpdate);</Highlight></CodeLine>
<Link id="l03698" /><CodeLine lineNumber="3698"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l03699" /><CodeLine lineNumber="3699"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UniformIndUpdate)</Highlight></CodeLine>
<Link id="l03700" /><CodeLine lineNumber="3700"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03701" /><CodeLine lineNumber="3701"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03702" /><CodeLine lineNumber="3702"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The induction variable and its update instruction will remain uniform.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03703" /><CodeLine lineNumber="3703"><Highlight kind="normal">    AddToWorklistIfAllowed(Ind);</Highlight></CodeLine>
<Link id="l03704" /><CodeLine lineNumber="3704"><Highlight kind="normal">    AddToWorklistIfAllowed(IndUpdate);</Highlight></CodeLine>
<Link id="l03705" /><CodeLine lineNumber="3705"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03706" /><CodeLine lineNumber="3706"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03707" /><CodeLine lineNumber="3707"><Highlight kind="normal">  Uniforms&#91;VF&#93;.insert(Worklist.<a href="/docs/api/classes/llvm/setvector/#ad0bf95396cec46a41371341460d14a1c">begin</a>(), Worklist.<a href="/docs/api/classes/llvm/setvector/#a889cc0df630d4b01e12d359517e26670">end</a>());</Highlight></CodeLine>
<Link id="l03708" /><CodeLine lineNumber="3708"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03709" /><CodeLine lineNumber="3709"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03710" /><CodeLine lineNumber="3710" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#aad6239ca8b51657f5ebdbd6e51e6ea90"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aad6239ca8b51657f5ebdbd6e51e6ea90">LoopVectorizationCostModel::runtimeChecksRequired</a>() &#123;</Highlight></CodeLine>
<Link id="l03711" /><CodeLine lineNumber="3711"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Performing code size checks.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03712" /><CodeLine lineNumber="3712"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03713" /><CodeLine lineNumber="3713"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getRuntimePointerChecking()-&gt;Need) &#123;</Highlight></CodeLine>
<Link id="l03714" /><CodeLine lineNumber="3714"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight><Highlight kind="stringliteral">&quot;Runtime ptr check is required with -Os/-Oz&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03715" /><CodeLine lineNumber="3715"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;runtime pointer checks needed. Enable vectorization of this &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03716" /><CodeLine lineNumber="3716"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;loop with &#39;#pragma clang loop vectorize(enable)&#39; when &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03717" /><CodeLine lineNumber="3717"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;compiling with -Os/-Oz&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03718" /><CodeLine lineNumber="3718"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;CantVersionLoopWithOptForSize&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l03719" /><CodeLine lineNumber="3719"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03720" /><CodeLine lineNumber="3720"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03721" /><CodeLine lineNumber="3721"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03722" /><CodeLine lineNumber="3722"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getPredicate().isAlwaysTrue()) &#123;</Highlight></CodeLine>
<Link id="l03723" /><CodeLine lineNumber="3723"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight><Highlight kind="stringliteral">&quot;Runtime SCEV check is required with -Os/-Oz&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03724" /><CodeLine lineNumber="3724"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;runtime SCEV checks needed. Enable vectorization of this &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03725" /><CodeLine lineNumber="3725"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;loop with &#39;#pragma clang loop vectorize(enable)&#39; when &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03726" /><CodeLine lineNumber="3726"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;compiling with -Os/-Oz&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03727" /><CodeLine lineNumber="3727"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;CantVersionLoopWithOptForSize&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l03728" /><CodeLine lineNumber="3728"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03729" /><CodeLine lineNumber="3729"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03730" /><CodeLine lineNumber="3730"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03731" /><CodeLine lineNumber="3731"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: Avoid specializing for stride==1 instead of bailing out.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03732" /><CodeLine lineNumber="3732"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getLAI()-&gt;getSymbolicStrides().empty()) &#123;</Highlight></CodeLine>
<Link id="l03733" /><CodeLine lineNumber="3733"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight><Highlight kind="stringliteral">&quot;Runtime stride check for small trip count&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03734" /><CodeLine lineNumber="3734"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;runtime stride == 1 checks needed. Enable vectorization of &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03735" /><CodeLine lineNumber="3735"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;this loop without such check by compiling with -Os/-Oz&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03736" /><CodeLine lineNumber="3736"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;CantVersionLoopWithOptForSize&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l03737" /><CodeLine lineNumber="3737"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03738" /><CodeLine lineNumber="3738"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03739" /><CodeLine lineNumber="3739"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03740" /><CodeLine lineNumber="3740"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03741" /><CodeLine lineNumber="3741"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03742" /><CodeLine lineNumber="3742"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03743" /><CodeLine lineNumber="3743"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> LoopVectorizationCostModel::isScalableVectorizationAllowed() &#123;</Highlight></CodeLine>
<Link id="l03744" /><CodeLine lineNumber="3744"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsScalableVectorizationAllowed)</Highlight></CodeLine>
<Link id="l03745" /><CodeLine lineNumber="3745"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;IsScalableVectorizationAllowed;</Highlight></CodeLine>
<Link id="l03746" /><CodeLine lineNumber="3746"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03747" /><CodeLine lineNumber="3747"><Highlight kind="normal">  IsScalableVectorizationAllowed = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03748" /><CodeLine lineNumber="3748"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.supportsScalableVectors() &amp;&amp; !<a href="#a48035e22b43c905a2961c90e5470b2f0">ForceTargetSupportsScalableVectors</a>)</Highlight></CodeLine>
<Link id="l03749" /><CodeLine lineNumber="3749"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03750" /><CodeLine lineNumber="3750"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03751" /><CodeLine lineNumber="3751"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35e67974daa692cfd961904c151ad33d">Hints</a>-&gt;<a href="/docs/api/classes/llvm/loopvectorizehints/#a1289a2ba34766f399d81f71c0f6b3a94">isScalableVectorizationDisabled</a>()) &#123;</Highlight></CodeLine>
<Link id="l03752" /><CodeLine lineNumber="3752"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</Highlight><Highlight kind="stringliteral">&quot;Scalable vectorization is explicitly disabled&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03753" /><CodeLine lineNumber="3753"><Highlight kind="normal">                            </Highlight><Highlight kind="stringliteral">&quot;ScalableVectorizationDisabled&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l03754" /><CodeLine lineNumber="3754"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03755" /><CodeLine lineNumber="3755"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03756" /><CodeLine lineNumber="3756"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03757" /><CodeLine lineNumber="3757"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Scalable vectorization is available\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03758" /><CodeLine lineNumber="3758"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03759" /><CodeLine lineNumber="3759"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MaxScalableVF = <a href="/docs/api/classes/llvm/elementcount/#a1bddc4949ab247dd1474f79b9bc6e34e">ElementCount::getScalable</a>(</Highlight></CodeLine>
<Link id="l03760" /><CodeLine lineNumber="3760"><Highlight kind="normal">      std::numeric&#95;limits&lt;ElementCount::ScalarTy&gt;::max());</Highlight></CodeLine>
<Link id="l03761" /><CodeLine lineNumber="3761"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03762" /><CodeLine lineNumber="3762"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Test that the loop-vectorizer can legalize all operations for this MaxVF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03763" /><CodeLine lineNumber="3763"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: While for scalable vectors this is currently sufficient, this should</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03764" /><CodeLine lineNumber="3764"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// be replaced by a more detailed mechanism that filters out specific VFs,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03765" /><CodeLine lineNumber="3765"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instead of invalidating vectorization for a whole set of VFs based on the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03766" /><CodeLine lineNumber="3766"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// MaxVF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03767" /><CodeLine lineNumber="3767"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03768" /><CodeLine lineNumber="3768"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Disable scalable vectorization if the loop contains unsupported reductions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03769" /><CodeLine lineNumber="3769"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a07515d0542b797be2d1c87d4359ff8f6">canVectorizeReductions</a>(MaxScalableVF)) &#123;</Highlight></CodeLine>
<Link id="l03770" /><CodeLine lineNumber="3770"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</Highlight></CodeLine>
<Link id="l03771" /><CodeLine lineNumber="3771"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Scalable vectorization not supported for the reduction &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03772" /><CodeLine lineNumber="3772"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;operations found in this loop.&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03773" /><CodeLine lineNumber="3773"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;ScalableVFUnfeasible&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l03774" /><CodeLine lineNumber="3774"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03775" /><CodeLine lineNumber="3775"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03776" /><CodeLine lineNumber="3776"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03777" /><CodeLine lineNumber="3777"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Disable scalable vectorization if the loop contains any instructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03778" /><CodeLine lineNumber="3778"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// with element types not supported for scalable vectors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03779" /><CodeLine lineNumber="3779"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a00a28a503636abdbedf080f3896b937c">ElementTypesInLoop</a>, &#91;&amp;&#93;(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;Ty) &#123;</Highlight></CodeLine>
<Link id="l03780" /><CodeLine lineNumber="3780"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !Ty-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l03781" /><CodeLine lineNumber="3781"><Highlight kind="normal">               !this-&gt;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isElementTypeLegalForScalableVector(Ty);</Highlight></CodeLine>
<Link id="l03782" /><CodeLine lineNumber="3782"><Highlight kind="normal">      &#125;)) &#123;</Highlight></CodeLine>
<Link id="l03783" /><CodeLine lineNumber="3783"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</Highlight><Highlight kind="stringliteral">&quot;Scalable vectorization is not supported &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03784" /><CodeLine lineNumber="3784"><Highlight kind="normal">                            </Highlight><Highlight kind="stringliteral">&quot;for all element types found in this loop.&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03785" /><CodeLine lineNumber="3785"><Highlight kind="normal">                            </Highlight><Highlight kind="stringliteral">&quot;ScalableVFUnfeasible&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l03786" /><CodeLine lineNumber="3786"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03787" /><CodeLine lineNumber="3787"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03788" /><CodeLine lineNumber="3788"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03789" /><CodeLine lineNumber="3789"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isSafeForAnyVectorWidth() &amp;&amp; !<a href="#a604c96744d2e46447f11e2d3aab9a9b2">getMaxVScale</a>(&#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>)) &#123;</Highlight></CodeLine>
<Link id="l03790" /><CodeLine lineNumber="3790"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</Highlight><Highlight kind="stringliteral">&quot;The target does not provide maximum vscale value &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03791" /><CodeLine lineNumber="3791"><Highlight kind="normal">                            </Highlight><Highlight kind="stringliteral">&quot;for safe distance analysis.&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03792" /><CodeLine lineNumber="3792"><Highlight kind="normal">                            </Highlight><Highlight kind="stringliteral">&quot;ScalableVFUnfeasible&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l03793" /><CodeLine lineNumber="3793"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03794" /><CodeLine lineNumber="3794"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03795" /><CodeLine lineNumber="3795"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03796" /><CodeLine lineNumber="3796"><Highlight kind="normal">  IsScalableVectorizationAllowed = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03797" /><CodeLine lineNumber="3797"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03798" /><CodeLine lineNumber="3798"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03799" /><CodeLine lineNumber="3799"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03800" /><CodeLine lineNumber="3800"><Highlight kind="normal"><a href="/docs/api/classes/llvm/elementcount">ElementCount</a></Highlight></CodeLine>
<Link id="l03801" /><CodeLine lineNumber="3801"><Highlight kind="normal">LoopVectorizationCostModel::getMaxLegalScalableVF(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxSafeElements) &#123;</Highlight></CodeLine>
<Link id="l03802" /><CodeLine lineNumber="3802"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!isScalableVectorizationAllowed())</Highlight></CodeLine>
<Link id="l03803" /><CodeLine lineNumber="3803"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/elementcount/#a1bddc4949ab247dd1474f79b9bc6e34e">ElementCount::getScalable</a>(0);</Highlight></CodeLine>
<Link id="l03804" /><CodeLine lineNumber="3804"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03805" /><CodeLine lineNumber="3805"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MaxScalableVF = <a href="/docs/api/classes/llvm/elementcount/#a1bddc4949ab247dd1474f79b9bc6e34e">ElementCount::getScalable</a>(</Highlight></CodeLine>
<Link id="l03806" /><CodeLine lineNumber="3806"><Highlight kind="normal">      std::numeric&#95;limits&lt;ElementCount::ScalarTy&gt;::max());</Highlight></CodeLine>
<Link id="l03807" /><CodeLine lineNumber="3807"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isSafeForAnyVectorWidth())</Highlight></CodeLine>
<Link id="l03808" /><CodeLine lineNumber="3808"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MaxScalableVF;</Highlight></CodeLine>
<Link id="l03809" /><CodeLine lineNumber="3809"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03810" /><CodeLine lineNumber="3810"><Highlight kind="normal">  std::optional&lt;unsigned&gt; MaxVScale = <a href="#a604c96744d2e46447f11e2d3aab9a9b2">getMaxVScale</a>(&#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>);</Highlight></CodeLine>
<Link id="l03811" /><CodeLine lineNumber="3811"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Limit MaxScalableVF by the maximum safe dependence distance.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03812" /><CodeLine lineNumber="3812"><Highlight kind="normal">  MaxScalableVF = <a href="/docs/api/classes/llvm/elementcount/#a1bddc4949ab247dd1474f79b9bc6e34e">ElementCount::getScalable</a>(MaxSafeElements / &#42;MaxVScale);</Highlight></CodeLine>
<Link id="l03813" /><CodeLine lineNumber="3813"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03814" /><CodeLine lineNumber="3814"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MaxScalableVF)</Highlight></CodeLine>
<Link id="l03815" /><CodeLine lineNumber="3815"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</Highlight></CodeLine>
<Link id="l03816" /><CodeLine lineNumber="3816"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Max legal vector width too small, scalable vectorization &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03817" /><CodeLine lineNumber="3817"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;unfeasible.&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03818" /><CodeLine lineNumber="3818"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;ScalableVFUnfeasible&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l03819" /><CodeLine lineNumber="3819"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03820" /><CodeLine lineNumber="3820"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MaxScalableVF;</Highlight></CodeLine>
<Link id="l03821" /><CodeLine lineNumber="3821"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03822" /><CodeLine lineNumber="3822"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03823" /><CodeLine lineNumber="3823"><Highlight kind="normal"><a href="/docs/api/structs/llvm/fixedscalablevfpair">FixedScalableVFPair</a> LoopVectorizationCostModel::computeFeasibleMaxVF(</Highlight></CodeLine>
<Link id="l03824" /><CodeLine lineNumber="3824"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxTripCount, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> FoldTailByMasking) &#123;</Highlight></CodeLine>
<Link id="l03825" /><CodeLine lineNumber="3825"><Highlight kind="normal">  MinBWs = <a href="/docs/api/namespaces/llvm/#af7b6ae12af3578f7a20ccc11a4458f9f">computeMinimumValueSizes</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getBlocks(), &#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a58fd764accfd06df487cc6ec43d4f5fc">DB</a>, &amp;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>);</Highlight></CodeLine>
<Link id="l03826" /><CodeLine lineNumber="3826"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SmallestType, WidestType;</Highlight></CodeLine>
<Link id="l03827" /><CodeLine lineNumber="3827"><Highlight kind="normal">  std::tie(SmallestType, WidestType) = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a1fa63b37ad2ac06f289e9962a3703e9e">getSmallestAndWidestTypes</a>();</Highlight></CodeLine>
<Link id="l03828" /><CodeLine lineNumber="3828"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03829" /><CodeLine lineNumber="3829"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get the maximum safe dependence distance in bits computed by LAA.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03830" /><CodeLine lineNumber="3830"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// It is computed by MaxVF &#42; sizeOf(type) &#42; 8, where type is taken from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03831" /><CodeLine lineNumber="3831"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the memory accesses that is most restrictive (involved in the smallest</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03832" /><CodeLine lineNumber="3832"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// dependence distance).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03833" /><CodeLine lineNumber="3833"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxSafeElements =</Highlight></CodeLine>
<Link id="l03834" /><CodeLine lineNumber="3834"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">llvm::bit&#95;floor</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getMaxSafeVectorWidthInBits() / WidestType);</Highlight></CodeLine>
<Link id="l03835" /><CodeLine lineNumber="3835"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03836" /><CodeLine lineNumber="3836"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MaxSafeFixedVF = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(MaxSafeElements);</Highlight></CodeLine>
<Link id="l03837" /><CodeLine lineNumber="3837"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MaxSafeScalableVF = getMaxLegalScalableVF(MaxSafeElements);</Highlight></CodeLine>
<Link id="l03838" /><CodeLine lineNumber="3838"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isSafeForAnyVectorWidth())</Highlight></CodeLine>
<Link id="l03839" /><CodeLine lineNumber="3839"><Highlight kind="normal">    this-&gt;MaxSafeElements = MaxSafeElements;</Highlight></CodeLine>
<Link id="l03840" /><CodeLine lineNumber="3840"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03841" /><CodeLine lineNumber="3841"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: The max safe fixed VF is: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; MaxSafeFixedVF</Highlight></CodeLine>
<Link id="l03842" /><CodeLine lineNumber="3842"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03843" /><CodeLine lineNumber="3843"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: The max safe scalable VF is: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; MaxSafeScalableVF</Highlight></CodeLine>
<Link id="l03844" /><CodeLine lineNumber="3844"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03845" /><CodeLine lineNumber="3845"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03846" /><CodeLine lineNumber="3846"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// First analyze the UserVF, fall back if the UserVF should be ignored.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03847" /><CodeLine lineNumber="3847"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserVF) &#123;</Highlight></CodeLine>
<Link id="l03848" /><CodeLine lineNumber="3848"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MaxSafeUserVF =</Highlight></CodeLine>
<Link id="l03849" /><CodeLine lineNumber="3849"><Highlight kind="normal">        UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() ? MaxSafeScalableVF : MaxSafeFixedVF;</Highlight></CodeLine>
<Link id="l03850" /><CodeLine lineNumber="3850"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03851" /><CodeLine lineNumber="3851"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a338ba7ca7a526243ab1853d07d90fe38">ElementCount::isKnownLE</a>(UserVF, MaxSafeUserVF)) &#123;</Highlight></CodeLine>
<Link id="l03852" /><CodeLine lineNumber="3852"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If &#96;VF=vscale x N&#96; is safe, then so is &#96;VF=N&#96;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03853" /><CodeLine lineNumber="3853"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</Highlight></CodeLine>
<Link id="l03854" /><CodeLine lineNumber="3854"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> FixedScalableVFPair(</Highlight></CodeLine>
<Link id="l03855" /><CodeLine lineNumber="3855"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>()), UserVF);</Highlight></CodeLine>
<Link id="l03856" /><CodeLine lineNumber="3856"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03857" /><CodeLine lineNumber="3857"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> UserVF;</Highlight></CodeLine>
<Link id="l03858" /><CodeLine lineNumber="3858"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03859" /><CodeLine lineNumber="3859"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03860" /><CodeLine lineNumber="3860"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#addaa86bfa4ca26b7f366cbdd868f99bf">ElementCount::isKnownGT</a>(UserVF, MaxSafeUserVF));</Highlight></CodeLine>
<Link id="l03861" /><CodeLine lineNumber="3861"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03862" /><CodeLine lineNumber="3862"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Only clamp if the UserVF is not scalable. If the UserVF is scalable, it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03863" /><CodeLine lineNumber="3863"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is better to ignore the hint and let the compiler choose a suitable VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03864" /><CodeLine lineNumber="3864"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>()) &#123;</Highlight></CodeLine>
<Link id="l03865" /><CodeLine lineNumber="3865"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: User VF=&quot;</Highlight><Highlight kind="normal"> &lt;&lt; UserVF</Highlight></CodeLine>
<Link id="l03866" /><CodeLine lineNumber="3866"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; is unsafe, clamping to max safe VF=&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03867" /><CodeLine lineNumber="3867"><Highlight kind="normal">                        &lt;&lt; MaxSafeFixedVF &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03868" /><CodeLine lineNumber="3868"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l03869" /><CodeLine lineNumber="3869"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OptimizationRemarkAnalysis(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </Highlight><Highlight kind="stringliteral">&quot;VectorizationFactor&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03870" /><CodeLine lineNumber="3870"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getStartLoc(),</Highlight></CodeLine>
<Link id="l03871" /><CodeLine lineNumber="3871"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getHeader())</Highlight></CodeLine>
<Link id="l03872" /><CodeLine lineNumber="3872"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;User-specified vectorization factor &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03873" /><CodeLine lineNumber="3873"><Highlight kind="normal">               &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</Highlight><Highlight kind="stringliteral">&quot;UserVectorizationFactor&quot;</Highlight><Highlight kind="normal">, UserVF)</Highlight></CodeLine>
<Link id="l03874" /><CodeLine lineNumber="3874"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; is unsafe, clamping to maximum safe vectorization factor &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03875" /><CodeLine lineNumber="3875"><Highlight kind="normal">               &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</Highlight><Highlight kind="stringliteral">&quot;VectorizationFactor&quot;</Highlight><Highlight kind="normal">, MaxSafeFixedVF);</Highlight></CodeLine>
<Link id="l03876" /><CodeLine lineNumber="3876"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l03877" /><CodeLine lineNumber="3877"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MaxSafeFixedVF;</Highlight></CodeLine>
<Link id="l03878" /><CodeLine lineNumber="3878"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03879" /><CodeLine lineNumber="3879"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03880" /><CodeLine lineNumber="3880"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.supportsScalableVectors() &amp;&amp; !<a href="#a48035e22b43c905a2961c90e5470b2f0">ForceTargetSupportsScalableVectors</a>) &#123;</Highlight></CodeLine>
<Link id="l03881" /><CodeLine lineNumber="3881"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: User VF=&quot;</Highlight><Highlight kind="normal"> &lt;&lt; UserVF</Highlight></CodeLine>
<Link id="l03882" /><CodeLine lineNumber="3882"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; is ignored because scalable vectors are not &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03883" /><CodeLine lineNumber="3883"><Highlight kind="normal">                           </Highlight><Highlight kind="stringliteral">&quot;available.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03884" /><CodeLine lineNumber="3884"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l03885" /><CodeLine lineNumber="3885"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OptimizationRemarkAnalysis(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </Highlight><Highlight kind="stringliteral">&quot;VectorizationFactor&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03886" /><CodeLine lineNumber="3886"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getStartLoc(),</Highlight></CodeLine>
<Link id="l03887" /><CodeLine lineNumber="3887"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getHeader())</Highlight></CodeLine>
<Link id="l03888" /><CodeLine lineNumber="3888"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;User-specified vectorization factor &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03889" /><CodeLine lineNumber="3889"><Highlight kind="normal">               &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</Highlight><Highlight kind="stringliteral">&quot;UserVectorizationFactor&quot;</Highlight><Highlight kind="normal">, UserVF)</Highlight></CodeLine>
<Link id="l03890" /><CodeLine lineNumber="3890"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; is ignored because the target does not support scalable &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03891" /><CodeLine lineNumber="3891"><Highlight kind="normal">                  </Highlight><Highlight kind="stringliteral">&quot;vectors. The compiler will pick a more suitable value.&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03892" /><CodeLine lineNumber="3892"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l03893" /><CodeLine lineNumber="3893"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l03894" /><CodeLine lineNumber="3894"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: User VF=&quot;</Highlight><Highlight kind="normal"> &lt;&lt; UserVF</Highlight></CodeLine>
<Link id="l03895" /><CodeLine lineNumber="3895"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; is unsafe. Ignoring scalable UserVF.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03896" /><CodeLine lineNumber="3896"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l03897" /><CodeLine lineNumber="3897"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OptimizationRemarkAnalysis(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </Highlight><Highlight kind="stringliteral">&quot;VectorizationFactor&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03898" /><CodeLine lineNumber="3898"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getStartLoc(),</Highlight></CodeLine>
<Link id="l03899" /><CodeLine lineNumber="3899"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getHeader())</Highlight></CodeLine>
<Link id="l03900" /><CodeLine lineNumber="3900"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;User-specified vectorization factor &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03901" /><CodeLine lineNumber="3901"><Highlight kind="normal">               &lt;&lt; <a href="/docs/api/namespaces/llvm/ore/#a5ca06dfbc998afac005414d8e9b7c234">ore::NV</a>(</Highlight><Highlight kind="stringliteral">&quot;UserVectorizationFactor&quot;</Highlight><Highlight kind="normal">, UserVF)</Highlight></CodeLine>
<Link id="l03902" /><CodeLine lineNumber="3902"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; is unsafe. Ignoring the hint to let the compiler pick a &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03903" /><CodeLine lineNumber="3903"><Highlight kind="normal">                  </Highlight><Highlight kind="stringliteral">&quot;more suitable value.&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03904" /><CodeLine lineNumber="3904"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l03905" /><CodeLine lineNumber="3905"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03906" /><CodeLine lineNumber="3906"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03907" /><CodeLine lineNumber="3907"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03908" /><CodeLine lineNumber="3908"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: The Smallest and Widest types: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; SmallestType</Highlight></CodeLine>
<Link id="l03909" /><CodeLine lineNumber="3909"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; / &quot;</Highlight><Highlight kind="normal"> &lt;&lt; WidestType &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; bits.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03910" /><CodeLine lineNumber="3910"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03911" /><CodeLine lineNumber="3911"><Highlight kind="normal">  FixedScalableVFPair <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1),</Highlight></CodeLine>
<Link id="l03912" /><CodeLine lineNumber="3912"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/elementcount/#a1bddc4949ab247dd1474f79b9bc6e34e">ElementCount::getScalable</a>(0));</Highlight></CodeLine>
<Link id="l03913" /><CodeLine lineNumber="3913"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MaxVF =</Highlight></CodeLine>
<Link id="l03914" /><CodeLine lineNumber="3914"><Highlight kind="normal">          getMaximizedVFForTarget(MaxTripCount, SmallestType, WidestType,</Highlight></CodeLine>
<Link id="l03915" /><CodeLine lineNumber="3915"><Highlight kind="normal">                                  MaxSafeFixedVF, FoldTailByMasking))</Highlight></CodeLine>
<Link id="l03916" /><CodeLine lineNumber="3916"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.FixedVF = MaxVF;</Highlight></CodeLine>
<Link id="l03917" /><CodeLine lineNumber="3917"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03918" /><CodeLine lineNumber="3918"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MaxVF =</Highlight></CodeLine>
<Link id="l03919" /><CodeLine lineNumber="3919"><Highlight kind="normal">          getMaximizedVFForTarget(MaxTripCount, SmallestType, WidestType,</Highlight></CodeLine>
<Link id="l03920" /><CodeLine lineNumber="3920"><Highlight kind="normal">                                  MaxSafeScalableVF, FoldTailByMasking))</Highlight></CodeLine>
<Link id="l03921" /><CodeLine lineNumber="3921"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaxVF.isScalable()) &#123;</Highlight></CodeLine>
<Link id="l03922" /><CodeLine lineNumber="3922"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>.ScalableVF = MaxVF;</Highlight></CodeLine>
<Link id="l03923" /><CodeLine lineNumber="3923"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found feasible scalable VF = &quot;</Highlight><Highlight kind="normal"> &lt;&lt; MaxVF</Highlight></CodeLine>
<Link id="l03924" /><CodeLine lineNumber="3924"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03925" /><CodeLine lineNumber="3925"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l03926" /><CodeLine lineNumber="3926"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03927" /><CodeLine lineNumber="3927"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</Highlight></CodeLine>
<Link id="l03928" /><CodeLine lineNumber="3928"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l03929" /><CodeLine lineNumber="3929"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03930" /><CodeLine lineNumber="3930"><Highlight kind="normal"><a href="/docs/api/structs/llvm/fixedscalablevfpair">FixedScalableVFPair</a></Highlight></CodeLine>
<Link id="l03931" /><CodeLine lineNumber="3931" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a65ab4267c6c132d06451b5d97bc9ee83"><Highlight kind="normal"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a65ab4267c6c132d06451b5d97bc9ee83">LoopVectorizationCostModel::computeMaxVF</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> UserIC) &#123;</Highlight></CodeLine>
<Link id="l03932" /><CodeLine lineNumber="3932"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getRuntimePointerChecking()-&gt;Need &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.hasBranchDivergence()) &#123;</Highlight></CodeLine>
<Link id="l03933" /><CodeLine lineNumber="3933"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: It may be useful to do since it&#39;s still likely to be dynamically</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03934" /><CodeLine lineNumber="3934"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// uniform if the target can skip.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03935" /><CodeLine lineNumber="3935"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight></CodeLine>
<Link id="l03936" /><CodeLine lineNumber="3936"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Not inserting runtime ptr check for divergent target&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03937" /><CodeLine lineNumber="3937"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;runtime pointer checks needed. Not enabled for divergent target&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03938" /><CodeLine lineNumber="3938"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;CantVersionLoopWithDivergentTarget&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l03939" /><CodeLine lineNumber="3939"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</Highlight></CodeLine>
<Link id="l03940" /><CodeLine lineNumber="3940"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03941" /><CodeLine lineNumber="3941"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03942" /><CodeLine lineNumber="3942"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE();</Highlight></CodeLine>
<Link id="l03943" /><CodeLine lineNumber="3943"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> TC = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#abec0c616087c002528fcf80c6583eadd">getSmallConstantTripCount</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l03944" /><CodeLine lineNumber="3944"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxTC = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSmallConstantMaxTripCount();</Highlight></CodeLine>
<Link id="l03945" /><CodeLine lineNumber="3945"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found trip count: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; TC &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03946" /><CodeLine lineNumber="3946"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TC != MaxTC)</Highlight></CodeLine>
<Link id="l03947" /><CodeLine lineNumber="3947"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found maximum trip count: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; MaxTC &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03948" /><CodeLine lineNumber="3948"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TC == 1) &#123;</Highlight></CodeLine>
<Link id="l03949" /><CodeLine lineNumber="3949"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight><Highlight kind="stringliteral">&quot;Single iteration (non) loop&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03950" /><CodeLine lineNumber="3950"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;loop trip count is one, irrelevant for vectorization&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03951" /><CodeLine lineNumber="3951"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;SingleIterationLoop&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l03952" /><CodeLine lineNumber="3952"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</Highlight></CodeLine>
<Link id="l03953" /><CodeLine lineNumber="3953"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03954" /><CodeLine lineNumber="3954"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03955" /><CodeLine lineNumber="3955"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If BTC matches the widest induction type and is -1 then the trip count</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03956" /><CodeLine lineNumber="3956"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// computation will wrap to 0 and the vector trip count will be 0 Do not try</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03957" /><CodeLine lineNumber="3957"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to vectorize.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03958" /><CodeLine lineNumber="3958"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BTC = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a22d9bcbd44563106d7217f3bd9a4039e">getBackedgeTakenCount</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l03959" /><CodeLine lineNumber="3959"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(BTC) &amp;&amp;</Highlight></CodeLine>
<Link id="l03960" /><CodeLine lineNumber="3960"><Highlight kind="normal">      BTC-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &gt;=</Highlight></CodeLine>
<Link id="l03961" /><CodeLine lineNumber="3961"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getWidestInductionType()-&gt;getScalarSizeInBits() &amp;&amp;</Highlight></CodeLine>
<Link id="l03962" /><CodeLine lineNumber="3962"><Highlight kind="normal">      SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#af74112dae88db73eb5484821b6f0fccd">isKnownPredicate</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP&#95;EQ</a>, BTC,</Highlight></CodeLine>
<Link id="l03963" /><CodeLine lineNumber="3963"><Highlight kind="normal">                           SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a8d5202095ab1b8b726dd1e9db728b997">getMinusOne</a>(BTC-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()))) &#123;</Highlight></CodeLine>
<Link id="l03964" /><CodeLine lineNumber="3964"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight></CodeLine>
<Link id="l03965" /><CodeLine lineNumber="3965"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Trip count computation wrapped&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03966" /><CodeLine lineNumber="3966"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;backedge-taken count is -1, loop trip count wrapped to 0&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l03967" /><CodeLine lineNumber="3967"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;TripCountWrapped&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l03968" /><CodeLine lineNumber="3968"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</Highlight></CodeLine>
<Link id="l03969" /><CodeLine lineNumber="3969"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03970" /><CodeLine lineNumber="3970"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03971" /><CodeLine lineNumber="3971"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (ScalarEpilogueStatus) &#123;</Highlight></CodeLine>
<Link id="l03972" /><CodeLine lineNumber="3972"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>:</Highlight></CodeLine>
<Link id="l03973" /><CodeLine lineNumber="3973"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> computeFeasibleMaxVF(MaxTC, UserVF, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03974" /><CodeLine lineNumber="3974"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9dab8edd8f39c728bd8b0045b64768ef206">CM&#95;ScalarEpilogueNotAllowedUsePredicate</a>:</Highlight></CodeLine>
<Link id="l03975" /><CodeLine lineNumber="3975"><Highlight kind="normal">    &#91;&#91;fallthrough&#93;&#93;;</Highlight></CodeLine>
<Link id="l03976" /><CodeLine lineNumber="3976"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>:</Highlight></CodeLine>
<Link id="l03977" /><CodeLine lineNumber="3977"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l03978" /><CodeLine lineNumber="3978"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: vector predicate hint/switch found.\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03979" /><CodeLine lineNumber="3979"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Not allowing scalar epilogue, creating predicated &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03980" /><CodeLine lineNumber="3980"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;vector loop.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03981" /><CodeLine lineNumber="3981"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03982" /><CodeLine lineNumber="3982"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da0a5c3a3ea2de39aa77f3e6da8de4d5bd">CM&#95;ScalarEpilogueNotAllowedLowTripLoop</a>:</Highlight></CodeLine>
<Link id="l03983" /><CodeLine lineNumber="3983"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// fallthrough as a special case of OptForSize</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03984" /><CodeLine lineNumber="3984"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da4f61afe29426363c5cf62d4ee93199b7">CM&#95;ScalarEpilogueNotAllowedOptSize</a>:</Highlight></CodeLine>
<Link id="l03985" /><CodeLine lineNumber="3985"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ScalarEpilogueStatus == <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da4f61afe29426363c5cf62d4ee93199b7">CM&#95;ScalarEpilogueNotAllowedOptSize</a>)</Highlight></CodeLine>
<Link id="l03986" /><CodeLine lineNumber="3986"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l03987" /><CodeLine lineNumber="3987"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Not allowing scalar epilogue due to -Os/-Oz.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03988" /><CodeLine lineNumber="3988"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03989" /><CodeLine lineNumber="3989"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Not allowing scalar epilogue due to low trip &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03990" /><CodeLine lineNumber="3990"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;count.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l03991" /><CodeLine lineNumber="3991"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03992" /><CodeLine lineNumber="3992"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Bail if runtime checks are required, which are not good when optimising</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03993" /><CodeLine lineNumber="3993"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// for size.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03994" /><CodeLine lineNumber="3994"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aad6239ca8b51657f5ebdbd6e51e6ea90">runtimeChecksRequired</a>())</Highlight></CodeLine>
<Link id="l03995" /><CodeLine lineNumber="3995"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</Highlight></CodeLine>
<Link id="l03996" /><CodeLine lineNumber="3996"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l03997" /><CodeLine lineNumber="3997"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l03998" /><CodeLine lineNumber="3998"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l03999" /><CodeLine lineNumber="3999"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04000" /><CodeLine lineNumber="4000"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The only loops we can vectorize without a scalar epilogue, are loops with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04001" /><CodeLine lineNumber="4001"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a bottom-test and a single exiting block. We&#39;d have to handle the fact</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04002" /><CodeLine lineNumber="4002"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that not every instruction executes on the last iteration.  This will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04003" /><CodeLine lineNumber="4003"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// require a lane mask which varies through the vector loop body.  (TODO)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04004" /><CodeLine lineNumber="4004"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getExitingBlock() != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getLoopLatch()) &#123;</Highlight></CodeLine>
<Link id="l04005" /><CodeLine lineNumber="4005"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If there was a tail-folding hint/switch, but we can&#39;t fold the tail by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04006" /><CodeLine lineNumber="4006"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// masking, fallback to a vectorization with a scalar epilogue.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04007" /><CodeLine lineNumber="4007"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ScalarEpilogueStatus == <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>) &#123;</Highlight></CodeLine>
<Link id="l04008" /><CodeLine lineNumber="4008"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Cannot fold tail by masking: vectorize with a &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04009" /><CodeLine lineNumber="4009"><Highlight kind="normal">                           </Highlight><Highlight kind="stringliteral">&quot;scalar epilogue instead.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04010" /><CodeLine lineNumber="4010"><Highlight kind="normal">      ScalarEpilogueStatus = <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>;</Highlight></CodeLine>
<Link id="l04011" /><CodeLine lineNumber="4011"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> computeFeasibleMaxVF(MaxTC, UserVF, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04012" /><CodeLine lineNumber="4012"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04013" /><CodeLine lineNumber="4013"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</Highlight></CodeLine>
<Link id="l04014" /><CodeLine lineNumber="4014"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04015" /><CodeLine lineNumber="4015"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04016" /><CodeLine lineNumber="4016"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now try the tail folding</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04017" /><CodeLine lineNumber="4017"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04018" /><CodeLine lineNumber="4018"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Invalidate interleave groups that require an epilogue if we can&#39;t mask</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04019" /><CodeLine lineNumber="4019"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the interleave-group.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04020" /><CodeLine lineNumber="4020"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#adf8d8fb6f39b9c0cf21d55b7229d35e2">useMaskedInterleavedAccesses</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>)) &#123;</Highlight></CodeLine>
<Link id="l04021" /><CodeLine lineNumber="4021"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(WideningDecisions.empty() &amp;&amp; Uniforms.empty() &amp;&amp; Scalars.empty() &amp;&amp;</Highlight></CodeLine>
<Link id="l04022" /><CodeLine lineNumber="4022"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;No decisions should have been taken at this point&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04023" /><CodeLine lineNumber="4023"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Note: There is no need to invalidate any cost modeling decisions here, as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04024" /><CodeLine lineNumber="4024"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// none were taken so far.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04025" /><CodeLine lineNumber="4025"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7a98f0c17229446d76997f158d896aad">InterleaveInfo</a>.invalidateGroupsRequiringScalarEpilogue();</Highlight></CodeLine>
<Link id="l04026" /><CodeLine lineNumber="4026"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04027" /><CodeLine lineNumber="4027"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04028" /><CodeLine lineNumber="4028"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/fixedscalablevfpair">FixedScalableVFPair</a> MaxFactors = computeFeasibleMaxVF(MaxTC, UserVF, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04029" /><CodeLine lineNumber="4029"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04030" /><CodeLine lineNumber="4030"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Avoid tail folding if the trip count is known to be a multiple of any VF</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04031" /><CodeLine lineNumber="4031"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we choose.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04032" /><CodeLine lineNumber="4032"><Highlight kind="normal">  std::optional&lt;unsigned&gt; MaxPowerOf2RuntimeVF =</Highlight></CodeLine>
<Link id="l04033" /><CodeLine lineNumber="4033"><Highlight kind="normal">      MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25a62c28e80eac3b4cc08470ae0770bd">FixedVF</a>.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>();</Highlight></CodeLine>
<Link id="l04034" /><CodeLine lineNumber="4034"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25f82f8ef3355c335a7ddae4ad0b6965">ScalableVF</a>) &#123;</Highlight></CodeLine>
<Link id="l04035" /><CodeLine lineNumber="4035"><Highlight kind="normal">    std::optional&lt;unsigned&gt; MaxVScale = <a href="#a604c96744d2e46447f11e2d3aab9a9b2">getMaxVScale</a>(&#42;<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>);</Highlight></CodeLine>
<Link id="l04036" /><CodeLine lineNumber="4036"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaxVScale &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.isVScaleKnownToBeAPowerOfTwo()) &#123;</Highlight></CodeLine>
<Link id="l04037" /><CodeLine lineNumber="4037"><Highlight kind="normal">      MaxPowerOf2RuntimeVF = std::max&lt;unsigned&gt;(</Highlight></CodeLine>
<Link id="l04038" /><CodeLine lineNumber="4038"><Highlight kind="normal">          &#42;MaxPowerOf2RuntimeVF,</Highlight></CodeLine>
<Link id="l04039" /><CodeLine lineNumber="4039"><Highlight kind="normal">          &#42;MaxVScale &#42; MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25f82f8ef3355c335a7ddae4ad0b6965">ScalableVF</a>.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>());</Highlight></CodeLine>
<Link id="l04040" /><CodeLine lineNumber="4040"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04041" /><CodeLine lineNumber="4041"><Highlight kind="normal">      MaxPowerOf2RuntimeVF = std::nullopt; </Highlight><Highlight kind="comment">// Stick with tail-folding for now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04042" /><CodeLine lineNumber="4042"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04043" /><CodeLine lineNumber="4043"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04044" /><CodeLine lineNumber="4044"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaxPowerOf2RuntimeVF &amp;&amp; &#42;MaxPowerOf2RuntimeVF &gt; 0) &#123;</Highlight></CodeLine>
<Link id="l04045" /><CodeLine lineNumber="4045"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a5cafb166cf7c4937f5647a084c4eaee2">isNonZero</a>() || <a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(&#42;MaxPowerOf2RuntimeVF)) &amp;&amp;</Highlight></CodeLine>
<Link id="l04046" /><CodeLine lineNumber="4046"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;MaxFixedVF must be a power of 2&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04047" /><CodeLine lineNumber="4047"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxVFtimesIC =</Highlight></CodeLine>
<Link id="l04048" /><CodeLine lineNumber="4048"><Highlight kind="normal">        UserIC ? &#42;MaxPowerOf2RuntimeVF &#42; UserIC : &#42;MaxPowerOf2RuntimeVF;</Highlight></CodeLine>
<Link id="l04049" /><CodeLine lineNumber="4049"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE();</Highlight></CodeLine>
<Link id="l04050" /><CodeLine lineNumber="4050"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Currently only loops with countable exits are vectorized, but calling</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04051" /><CodeLine lineNumber="4051"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// getSymbolicMaxBackedgeTakenCount allows enablement work for loops with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04052" /><CodeLine lineNumber="4052"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// uncountable exits whilst also ensuring the symbolic maximum and known</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04053" /><CodeLine lineNumber="4053"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// back-edge taken count remain identical for loops with countable exits.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04054" /><CodeLine lineNumber="4054"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;BackedgeTakenCount = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSymbolicMaxBackedgeTakenCount();</Highlight></CodeLine>
<Link id="l04055" /><CodeLine lineNumber="4055"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BackedgeTakenCount == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getBackedgeTakenCount() &amp;&amp;</Highlight></CodeLine>
<Link id="l04056" /><CodeLine lineNumber="4056"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Invalid loop count&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04057" /><CodeLine lineNumber="4057"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;ExitCount = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#aef6d2bea715d1793e956f41ddeea2320">getAddExpr</a>(</Highlight></CodeLine>
<Link id="l04058" /><CodeLine lineNumber="4058"><Highlight kind="normal">        BackedgeTakenCount, SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a3fbe8f529d36d76730550905d730a2a7">getOne</a>(BackedgeTakenCount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>()));</Highlight></CodeLine>
<Link id="l04059" /><CodeLine lineNumber="4059"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;Rem = SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a13b9eb961d35ad9ecb3b633f5703253a">getURemExpr</a>(</Highlight></CodeLine>
<Link id="l04060" /><CodeLine lineNumber="4060"><Highlight kind="normal">        SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#ad146072469181af4ccb7ef03c28999ba">applyLoopGuards</a>(ExitCount, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>),</Highlight></CodeLine>
<Link id="l04061" /><CodeLine lineNumber="4061"><Highlight kind="normal">        SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(BackedgeTakenCount-&gt;<a href="/docs/api/classes/llvm/scev/#aefeda9454a5e8dfcec3deb106964832a">getType</a>(), MaxVFtimesIC));</Highlight></CodeLine>
<Link id="l04062" /><CodeLine lineNumber="4062"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Rem-&gt;<a href="/docs/api/classes/llvm/scev/#a4541962f9c18aacceb7243520eb15e1f">isZero</a>()) &#123;</Highlight></CodeLine>
<Link id="l04063" /><CodeLine lineNumber="4063"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Accept MaxFixedVF if we do not have a tail.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04064" /><CodeLine lineNumber="4064"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: No tail will remain for any chosen VF.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04065" /><CodeLine lineNumber="4065"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MaxFactors;</Highlight></CodeLine>
<Link id="l04066" /><CodeLine lineNumber="4066"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04067" /><CodeLine lineNumber="4067"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04068" /><CodeLine lineNumber="4068"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04069" /><CodeLine lineNumber="4069"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we don&#39;t know the precise trip count, or if the trip count that we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04070" /><CodeLine lineNumber="4070"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// found modulo the vectorization factor is not zero, try to fold the tail</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04071" /><CodeLine lineNumber="4071"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// by masking.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04072" /><CodeLine lineNumber="4072"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: look for a smaller MaxVF that does divide TC rather than masking.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04073" /><CodeLine lineNumber="4073"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8eb89837d2853e4853ea14379ae3972">setTailFoldingStyles</a>(MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25f82f8ef3355c335a7ddae4ad0b6965">ScalableVF</a>.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>(), UserIC);</Highlight></CodeLine>
<Link id="l04074" /><CodeLine lineNumber="4074"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba">foldTailByMasking</a>()) &#123;</Highlight></CodeLine>
<Link id="l04075" /><CodeLine lineNumber="4075"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a738b994c87e0e816cf5f323e0e2b6c07">getTailFoldingStyle</a>() == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6ae67872a709ea2e3175802518fc4e71">TailFoldingStyle::DataWithEVL</a>) &#123;</Highlight></CodeLine>
<Link id="l04076" /><CodeLine lineNumber="4076"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l04077" /><CodeLine lineNumber="4077"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</Highlight></CodeLine>
<Link id="l04078" /><CodeLine lineNumber="4078"><Highlight kind="normal">          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: tail is folded with EVL, forcing unroll factor to be 1 Will &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04079" /><CodeLine lineNumber="4079"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;try to generate VP Intrinsics with scalable vector &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04080" /><CodeLine lineNumber="4080"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;factors only.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04081" /><CodeLine lineNumber="4081"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Tail folded loop using VP intrinsics restricts the VF to be scalable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04082" /><CodeLine lineNumber="4082"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// for now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04083" /><CodeLine lineNumber="4083"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: extend it for fixed vectors, if required.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04084" /><CodeLine lineNumber="4084"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25f82f8ef3355c335a7ddae4ad0b6965">ScalableVF</a>.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l04085" /><CodeLine lineNumber="4085"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Expected scalable vector factor.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04086" /><CodeLine lineNumber="4086"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04087" /><CodeLine lineNumber="4087"><Highlight kind="normal">      MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25a62c28e80eac3b4cc08470ae0770bd">FixedVF</a> = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1);</Highlight></CodeLine>
<Link id="l04088" /><CodeLine lineNumber="4088"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04089" /><CodeLine lineNumber="4089"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MaxFactors;</Highlight></CodeLine>
<Link id="l04090" /><CodeLine lineNumber="4090"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04091" /><CodeLine lineNumber="4091"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04092" /><CodeLine lineNumber="4092"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there was a tail-folding hint/switch, but we can&#39;t fold the tail by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04093" /><CodeLine lineNumber="4093"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// masking, fallback to a vectorization with a scalar epilogue.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04094" /><CodeLine lineNumber="4094"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ScalarEpilogueStatus == <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>) &#123;</Highlight></CodeLine>
<Link id="l04095" /><CodeLine lineNumber="4095"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Cannot fold tail by masking: vectorize with a &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04096" /><CodeLine lineNumber="4096"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;scalar epilogue instead.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04097" /><CodeLine lineNumber="4097"><Highlight kind="normal">    ScalarEpilogueStatus = <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>;</Highlight></CodeLine>
<Link id="l04098" /><CodeLine lineNumber="4098"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MaxFactors;</Highlight></CodeLine>
<Link id="l04099" /><CodeLine lineNumber="4099"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04100" /><CodeLine lineNumber="4100"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04101" /><CodeLine lineNumber="4101"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ScalarEpilogueStatus == <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9dab8edd8f39c728bd8b0045b64768ef206">CM&#95;ScalarEpilogueNotAllowedUsePredicate</a>) &#123;</Highlight></CodeLine>
<Link id="l04102" /><CodeLine lineNumber="4102"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Can&#39;t fold tail by masking: don&#39;t vectorize\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04103" /><CodeLine lineNumber="4103"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</Highlight></CodeLine>
<Link id="l04104" /><CodeLine lineNumber="4104"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04105" /><CodeLine lineNumber="4105"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04106" /><CodeLine lineNumber="4106"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TC == 0) &#123;</Highlight></CodeLine>
<Link id="l04107" /><CodeLine lineNumber="4107"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight></CodeLine>
<Link id="l04108" /><CodeLine lineNumber="4108"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;unable to calculate the loop count due to complex control flow&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l04109" /><CodeLine lineNumber="4109"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;UnknownLoopCountComplexCFG&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l04110" /><CodeLine lineNumber="4110"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</Highlight></CodeLine>
<Link id="l04111" /><CodeLine lineNumber="4111"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04112" /><CodeLine lineNumber="4112"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04113" /><CodeLine lineNumber="4113"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight></CodeLine>
<Link id="l04114" /><CodeLine lineNumber="4114"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;Cannot optimize for size and vectorize at the same time.&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l04115" /><CodeLine lineNumber="4115"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;cannot optimize for size and vectorize at the same time. &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04116" /><CodeLine lineNumber="4116"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;Enable vectorization of this loop with &#39;#pragma clang loop &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04117" /><CodeLine lineNumber="4117"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;vectorize(enable)&#39; when compiling with -Os/-Oz&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l04118" /><CodeLine lineNumber="4118"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;NoTailLoopWithOptForSize&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8b0171a0d29e72189ffad26b9770c464">ORE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l04119" /><CodeLine lineNumber="4119"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/fixedscalablevfpair/#aa2acd0d0943f4e488516ad21848f9be3">FixedScalableVFPair::getNone</a>();</Highlight></CodeLine>
<Link id="l04120" /><CodeLine lineNumber="4120"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04121" /><CodeLine lineNumber="4121"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04122" /><CodeLine lineNumber="4122"><Highlight kind="normal"><a href="/docs/api/classes/llvm/elementcount">ElementCount</a> LoopVectorizationCostModel::getMaximizedVFForTarget(</Highlight></CodeLine>
<Link id="l04123" /><CodeLine lineNumber="4123"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxTripCount, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SmallestType, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> WidestType,</Highlight></CodeLine>
<Link id="l04124" /><CodeLine lineNumber="4124"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MaxSafeVF, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> FoldTailByMasking) &#123;</Highlight></CodeLine>
<Link id="l04125" /><CodeLine lineNumber="4125"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ComputeScalableMaxVF = MaxSafeVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>();</Highlight></CodeLine>
<Link id="l04126" /><CodeLine lineNumber="4126"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/typesize">TypeSize</a> WidestRegister = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getRegisterBitWidth(</Highlight></CodeLine>
<Link id="l04127" /><CodeLine lineNumber="4127"><Highlight kind="normal">      ComputeScalableMaxVF ? <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166a331413d3887a08546d0973091f6a4993">TargetTransformInfo::RGK&#95;ScalableVector</a></Highlight></CodeLine>
<Link id="l04128" /><CodeLine lineNumber="4128"><Highlight kind="normal">                           : <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166a183020fbea95c99db23f6d3594f4c4af">TargetTransformInfo::RGK&#95;FixedWidthVector</a>);</Highlight></CodeLine>
<Link id="l04129" /><CodeLine lineNumber="4129"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04130" /><CodeLine lineNumber="4130"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Convenience function to return the minimum of two ElementCounts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04131" /><CodeLine lineNumber="4131"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MinVF = &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> &amp;LHS, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> &amp;RHS) &#123;</Highlight></CodeLine>
<Link id="l04132" /><CodeLine lineNumber="4132"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((LHS.isScalable() == RHS.isScalable()) &amp;&amp;</Highlight></CodeLine>
<Link id="l04133" /><CodeLine lineNumber="4133"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Scalable flags must match&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04134" /><CodeLine lineNumber="4134"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a83e6442f8ebefccdb5e089732fe397ac">ElementCount::isKnownLT</a>(LHS, RHS) ? LHS : RHS;</Highlight></CodeLine>
<Link id="l04135" /><CodeLine lineNumber="4135"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l04136" /><CodeLine lineNumber="4136"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04137" /><CodeLine lineNumber="4137"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Ensure MaxVF is a power of 2; the dependence distance bound may not be.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04138" /><CodeLine lineNumber="4138"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note that both WidestRegister and WidestType may not be a powers of 2</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04139" /><CodeLine lineNumber="4139"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MaxVectorElementCount = <a href="/docs/api/classes/llvm/elementcount/#a79ea372f9aa69492fccfafc0e5a1589c">ElementCount::get</a>(</Highlight></CodeLine>
<Link id="l04140" /><CodeLine lineNumber="4140"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">llvm::bit&#95;floor</a>(WidestRegister.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() / WidestType),</Highlight></CodeLine>
<Link id="l04141" /><CodeLine lineNumber="4141"><Highlight kind="normal">      ComputeScalableMaxVF);</Highlight></CodeLine>
<Link id="l04142" /><CodeLine lineNumber="4142"><Highlight kind="normal">  MaxVectorElementCount = MinVF(MaxVectorElementCount, MaxSafeVF);</Highlight></CodeLine>
<Link id="l04143" /><CodeLine lineNumber="4143"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: The Widest register safe to use is: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04144" /><CodeLine lineNumber="4144"><Highlight kind="normal">                    &lt;&lt; (MaxVectorElementCount &#42; WidestType) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; bits.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04145" /><CodeLine lineNumber="4145"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04146" /><CodeLine lineNumber="4146"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MaxVectorElementCount) &#123;</Highlight></CodeLine>
<Link id="l04147" /><CodeLine lineNumber="4147"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: The target has no &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04148" /><CodeLine lineNumber="4148"><Highlight kind="normal">                      &lt;&lt; (ComputeScalableMaxVF ? </Highlight><Highlight kind="stringliteral">&quot;scalable&quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;fixed&quot;</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l04149" /><CodeLine lineNumber="4149"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; vector registers.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04150" /><CodeLine lineNumber="4150"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1);</Highlight></CodeLine>
<Link id="l04151" /><CodeLine lineNumber="4151"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04152" /><CodeLine lineNumber="4152"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04153" /><CodeLine lineNumber="4153"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> WidestRegisterMinEC = MaxVectorElementCount.getKnownMinValue();</Highlight></CodeLine>
<Link id="l04154" /><CodeLine lineNumber="4154"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaxVectorElementCount.isScalable() &amp;&amp;</Highlight></CodeLine>
<Link id="l04155" /><CodeLine lineNumber="4155"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>-&gt;hasFnAttribute(Attribute::VScaleRange)) &#123;</Highlight></CodeLine>
<Link id="l04156" /><CodeLine lineNumber="4156"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Attr = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>-&gt;getFnAttribute(Attribute::VScaleRange);</Highlight></CodeLine>
<Link id="l04157" /><CodeLine lineNumber="4157"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Min = Attr.getVScaleRangeMin();</Highlight></CodeLine>
<Link id="l04158" /><CodeLine lineNumber="4158"><Highlight kind="normal">    WidestRegisterMinEC &#42;= Min;</Highlight></CodeLine>
<Link id="l04159" /><CodeLine lineNumber="4159"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04160" /><CodeLine lineNumber="4160"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04161" /><CodeLine lineNumber="4161"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// When a scalar epilogue is required, at least one iteration of the scalar</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04162" /><CodeLine lineNumber="4162"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// loop has to execute. Adjust MaxTripCount accordingly to avoid picking a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04163" /><CodeLine lineNumber="4163"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// max VF that results in a dead vector loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04164" /><CodeLine lineNumber="4164"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaxTripCount &gt; 0 &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a913ab9c8291000dd3a1c3739194b03e4">requiresScalarEpilogue</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">))</Highlight></CodeLine>
<Link id="l04165" /><CodeLine lineNumber="4165"><Highlight kind="normal">    MaxTripCount -= 1;</Highlight></CodeLine>
<Link id="l04166" /><CodeLine lineNumber="4166"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04167" /><CodeLine lineNumber="4167"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaxTripCount &amp;&amp; MaxTripCount &lt;= WidestRegisterMinEC &amp;&amp;</Highlight></CodeLine>
<Link id="l04168" /><CodeLine lineNumber="4168"><Highlight kind="normal">      (!FoldTailByMasking || <a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(MaxTripCount))) &#123;</Highlight></CodeLine>
<Link id="l04169" /><CodeLine lineNumber="4169"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If upper bound loop trip count (TC) is known at compile time there is no</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04170" /><CodeLine lineNumber="4170"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// point in choosing VF greater than TC (as done in the loop below). Select</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04171" /><CodeLine lineNumber="4171"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// maximum power of two which doesn&#39;t exceed TC. If MaxVectorElementCount is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04172" /><CodeLine lineNumber="4172"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// scalable, we only fall back on a fixed VF when the TC is less than or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04173" /><CodeLine lineNumber="4173"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// equal to the known number of lanes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04174" /><CodeLine lineNumber="4174"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ClampedUpperTripCount = <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">llvm::bit&#95;floor</a>(MaxTripCount);</Highlight></CodeLine>
<Link id="l04175" /><CodeLine lineNumber="4175"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Clamping the MaxVF to maximum power of two not &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04176" /><CodeLine lineNumber="4176"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;exceeding the constant trip count: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04177" /><CodeLine lineNumber="4177"><Highlight kind="normal">                      &lt;&lt; ClampedUpperTripCount &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04178" /><CodeLine lineNumber="4178"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/elementcount/#a79ea372f9aa69492fccfafc0e5a1589c">ElementCount::get</a>(</Highlight></CodeLine>
<Link id="l04179" /><CodeLine lineNumber="4179"><Highlight kind="normal">        ClampedUpperTripCount,</Highlight></CodeLine>
<Link id="l04180" /><CodeLine lineNumber="4180"><Highlight kind="normal">        FoldTailByMasking ? MaxVectorElementCount.isScalable() : </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04181" /><CodeLine lineNumber="4181"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04182" /><CodeLine lineNumber="4182"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04183" /><CodeLine lineNumber="4183"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166">TargetTransformInfo::RegisterKind</a> <a href="/docs/api/namespaces/anonymous-aarch64asmparser-cpp-/#afecbf44fe4e0f0e4e4294a38ed025957">RegKind</a> =</Highlight></CodeLine>
<Link id="l04184" /><CodeLine lineNumber="4184"><Highlight kind="normal">      ComputeScalableMaxVF ? <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166a331413d3887a08546d0973091f6a4993">TargetTransformInfo::RGK&#95;ScalableVector</a></Highlight></CodeLine>
<Link id="l04185" /><CodeLine lineNumber="4185"><Highlight kind="normal">                           : <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166a183020fbea95c99db23f6d3594f4c4af">TargetTransformInfo::RGK&#95;FixedWidthVector</a>;</Highlight></CodeLine>
<Link id="l04186" /><CodeLine lineNumber="4186"><Highlight kind="normal">  ElementCount MaxVF = MaxVectorElementCount;</Highlight></CodeLine>
<Link id="l04187" /><CodeLine lineNumber="4187"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#afe9b34c22ec9e2cc84d61d437f82936d">MaximizeBandwidth</a> ||</Highlight></CodeLine>
<Link id="l04188" /><CodeLine lineNumber="4188"><Highlight kind="normal">      (<a href="#afe9b34c22ec9e2cc84d61d437f82936d">MaximizeBandwidth</a>.<a href="/docs/api/classes/llvm/cl/option/#a2dc75fafb68e7669e776e19da7857cdf">getNumOccurrences</a>() == 0 &amp;&amp;</Highlight></CodeLine>
<Link id="l04189" /><CodeLine lineNumber="4189"><Highlight kind="normal">       (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.shouldMaximizeVectorBandwidth(RegKind) ||</Highlight></CodeLine>
<Link id="l04190" /><CodeLine lineNumber="4190"><Highlight kind="normal">        (<a href="#a639c83322f3d5f0e24e9bde998a516fd">UseWiderVFIfCallVariantsPresent</a> &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;hasVectorCallVariants())))) &#123;</Highlight></CodeLine>
<Link id="l04191" /><CodeLine lineNumber="4191"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MaxVectorElementCountMaxBW = <a href="/docs/api/classes/llvm/elementcount/#a79ea372f9aa69492fccfafc0e5a1589c">ElementCount::get</a>(</Highlight></CodeLine>
<Link id="l04192" /><CodeLine lineNumber="4192"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">llvm::bit&#95;floor</a>(WidestRegister.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() / SmallestType),</Highlight></CodeLine>
<Link id="l04193" /><CodeLine lineNumber="4193"><Highlight kind="normal">        ComputeScalableMaxVF);</Highlight></CodeLine>
<Link id="l04194" /><CodeLine lineNumber="4194"><Highlight kind="normal">    MaxVectorElementCountMaxBW = MinVF(MaxVectorElementCountMaxBW, MaxSafeVF);</Highlight></CodeLine>
<Link id="l04195" /><CodeLine lineNumber="4195"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04196" /><CodeLine lineNumber="4196"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Collect all viable vectorization factors larger than the default MaxVF</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04197" /><CodeLine lineNumber="4197"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (i.e. MaxVectorElementCount).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04198" /><CodeLine lineNumber="4198"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;ElementCount, 8&gt;</a> VFs;</Highlight></CodeLine>
<Link id="l04199" /><CodeLine lineNumber="4199"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (ElementCount VS = MaxVectorElementCount &#42; 2;</Highlight></CodeLine>
<Link id="l04200" /><CodeLine lineNumber="4200"><Highlight kind="normal">         <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a338ba7ca7a526243ab1853d07d90fe38">ElementCount::isKnownLE</a>(VS, MaxVectorElementCountMaxBW); <a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28a9f54e5976c204d779cee3d87cabf0b02">VS</a> &#42;= 2)</Highlight></CodeLine>
<Link id="l04201" /><CodeLine lineNumber="4201"><Highlight kind="normal">      VFs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VS);</Highlight></CodeLine>
<Link id="l04202" /><CodeLine lineNumber="4202"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04203" /><CodeLine lineNumber="4203"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For each VF calculate its register usage.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04204" /><CodeLine lineNumber="4204"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> RUs = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91466f7a82e967ed765e6d876415a3b7">calculateRegisterUsage</a>(VFs);</Highlight></CodeLine>
<Link id="l04205" /><CodeLine lineNumber="4205"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04206" /><CodeLine lineNumber="4206"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Select the largest VF which doesn&#39;t require more registers than existing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04207" /><CodeLine lineNumber="4207"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// ones.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04208" /><CodeLine lineNumber="4208"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = RUs.size() - 1; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &gt;= 0; --<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l04209" /><CodeLine lineNumber="4209"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;MLU = RUs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;.MaxLocalUsers;</Highlight></CodeLine>
<Link id="l04210" /><CodeLine lineNumber="4210"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(MLU, &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">decltype</Highlight><Highlight kind="normal">(MLU.front()) &amp;LU) &#123;</Highlight></CodeLine>
<Link id="l04211" /><CodeLine lineNumber="4211"><Highlight kind="normal">            return LU.second &lt;= TTI.getNumberOfRegisters(LU.first);</Highlight></CodeLine>
<Link id="l04212" /><CodeLine lineNumber="4212"><Highlight kind="normal">          &#125;)) &#123;</Highlight></CodeLine>
<Link id="l04213" /><CodeLine lineNumber="4213"><Highlight kind="normal">        MaxVF = VFs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l04214" /><CodeLine lineNumber="4214"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04215" /><CodeLine lineNumber="4215"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04216" /><CodeLine lineNumber="4216"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04217" /><CodeLine lineNumber="4217"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ElementCount MinVF =</Highlight></CodeLine>
<Link id="l04218" /><CodeLine lineNumber="4218"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMinimumVF(SmallestType, ComputeScalableMaxVF)) &#123;</Highlight></CodeLine>
<Link id="l04219" /><CodeLine lineNumber="4219"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a83e6442f8ebefccdb5e089732fe397ac">ElementCount::isKnownLT</a>(MaxVF, MinVF)) &#123;</Highlight></CodeLine>
<Link id="l04220" /><CodeLine lineNumber="4220"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Overriding calculated MaxVF(&quot;</Highlight><Highlight kind="normal"> &lt;&lt; MaxVF</Highlight></CodeLine>
<Link id="l04221" /><CodeLine lineNumber="4221"><Highlight kind="normal">                          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;) with target&#39;s minimum: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; MinVF &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04222" /><CodeLine lineNumber="4222"><Highlight kind="normal">        MaxVF = MinVF;</Highlight></CodeLine>
<Link id="l04223" /><CodeLine lineNumber="4223"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04224" /><CodeLine lineNumber="4224"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04225" /><CodeLine lineNumber="4225"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04226" /><CodeLine lineNumber="4226"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Invalidate any widening decisions we might have made, in case the loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04227" /><CodeLine lineNumber="4227"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// requires prediction (decided later), but we have already made some</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04228" /><CodeLine lineNumber="4228"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// load/store widening decisions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04229" /><CodeLine lineNumber="4229"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85afe07533e500a31222b17f80b540fe">invalidateCostModelingDecisions</a>();</Highlight></CodeLine>
<Link id="l04230" /><CodeLine lineNumber="4230"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04231" /><CodeLine lineNumber="4231"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MaxVF;</Highlight></CodeLine>
<Link id="l04232" /><CodeLine lineNumber="4232"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04233" /><CodeLine lineNumber="4233"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04234" /><CodeLine lineNumber="4234"><Highlight kind="comment">/// Convenience function that returns the value of vscale&#95;range iff</Highlight></CodeLine>
<Link id="l04235" /><CodeLine lineNumber="4235"><Highlight kind="comment">/// vscale&#95;range.min == vscale&#95;range.max or otherwise returns the value</Highlight></CodeLine>
<Link id="l04236" /><CodeLine lineNumber="4236"><Highlight kind="comment">/// returned by the corresponding TTI method.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04237" /><CodeLine lineNumber="4237"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> std::optional&lt;unsigned&gt;</Highlight></CodeLine>
<Link id="l04238" /><CodeLine lineNumber="4238" lineLink="#a4e108201f94f2fe89865e7868390bbf6"><Highlight kind="normal"><a href="#a4e108201f94f2fe89865e7868390bbf6">getVScaleForTuning</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</Highlight></CodeLine>
<Link id="l04239" /><CodeLine lineNumber="4239"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;Fn = L-&gt;getHeader()-&gt;getParent();</Highlight></CodeLine>
<Link id="l04240" /><CodeLine lineNumber="4240"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Fn-&gt;<a href="/docs/api/classes/llvm/function/#afb28a4deafe2954b0534cc6399ce518b">hasFnAttribute</a>(Attribute::VScaleRange)) &#123;</Highlight></CodeLine>
<Link id="l04241" /><CodeLine lineNumber="4241"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Attr = Fn-&gt;<a href="/docs/api/classes/llvm/function/#a4c319db4fe05c27cfe55bd133a87414d">getFnAttribute</a>(Attribute::VScaleRange);</Highlight></CodeLine>
<Link id="l04242" /><CodeLine lineNumber="4242"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Min = Attr.<a href="/docs/api/classes/llvm/attribute/#a2340c9d2c47ffa7fc07568ba059b62a2">getVScaleRangeMin</a>();</Highlight></CodeLine>
<Link id="l04243" /><CodeLine lineNumber="4243"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Max = Attr.getVScaleRangeMax();</Highlight></CodeLine>
<Link id="l04244" /><CodeLine lineNumber="4244"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Max &amp;&amp; Min == Max)</Highlight></CodeLine>
<Link id="l04245" /><CodeLine lineNumber="4245"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Max;</Highlight></CodeLine>
<Link id="l04246" /><CodeLine lineNumber="4246"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04247" /><CodeLine lineNumber="4247"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04248" /><CodeLine lineNumber="4248"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getVScaleForTuning();</Highlight></CodeLine>
<Link id="l04249" /><CodeLine lineNumber="4249"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04250" /><CodeLine lineNumber="4250"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04251" /><CodeLine lineNumber="4251"><Highlight kind="comment">/// This function attempts to return a value that represents the vectorization</Highlight></CodeLine>
<Link id="l04252" /><CodeLine lineNumber="4252"><Highlight kind="comment">/// factor at runtime. For fixed-width VFs we know this precisely at compile</Highlight></CodeLine>
<Link id="l04253" /><CodeLine lineNumber="4253"><Highlight kind="comment">/// time, but for scalable VFs we calculate it based on an estimate of the</Highlight></CodeLine>
<Link id="l04254" /><CodeLine lineNumber="4254"><Highlight kind="comment">/// vscale value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04255" /><CodeLine lineNumber="4255" lineLink="#ab3df41ae1ed3978e3b825bc4dd50ae8d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</Highlight></CodeLine>
<Link id="l04256" /><CodeLine lineNumber="4256"><Highlight kind="normal">                                      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</Highlight></CodeLine>
<Link id="l04257" /><CodeLine lineNumber="4257"><Highlight kind="normal">                                      <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l04258" /><CodeLine lineNumber="4258"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> EstimatedVF = VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>();</Highlight></CodeLine>
<Link id="l04259" /><CodeLine lineNumber="4259"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</Highlight></CodeLine>
<Link id="l04260" /><CodeLine lineNumber="4260"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (std::optional&lt;unsigned&gt; VScale = <a href="#a4e108201f94f2fe89865e7868390bbf6">getVScaleForTuning</a>(L, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>))</Highlight></CodeLine>
<Link id="l04261" /><CodeLine lineNumber="4261"><Highlight kind="normal">      EstimatedVF &#42;= &#42;VScale;</Highlight></CodeLine>
<Link id="l04262" /><CodeLine lineNumber="4262"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EstimatedVF &gt;= 1 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Estimated VF shouldn&#39;t be less than 1&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04263" /><CodeLine lineNumber="4263"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> EstimatedVF;</Highlight></CodeLine>
<Link id="l04264" /><CodeLine lineNumber="4264"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04265" /><CodeLine lineNumber="4265"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04266" /><CodeLine lineNumber="4266"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> LoopVectorizationPlanner::isMoreProfitable(</Highlight></CodeLine>
<Link id="l04267" /><CodeLine lineNumber="4267"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>,</Highlight></CodeLine>
<Link id="l04268" /><CodeLine lineNumber="4268"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxTripCount)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l04269" /><CodeLine lineNumber="4269"><Highlight kind="normal">  InstructionCost CostA = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Cost;</Highlight></CodeLine>
<Link id="l04270" /><CodeLine lineNumber="4270"><Highlight kind="normal">  InstructionCost CostB = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.Cost;</Highlight></CodeLine>
<Link id="l04271" /><CodeLine lineNumber="4271"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04272" /><CodeLine lineNumber="4272"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Improve estimate for the vector width if it is scalable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04273" /><CodeLine lineNumber="4273"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> EstimatedWidthA = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Width.getKnownMinValue();</Highlight></CodeLine>
<Link id="l04274" /><CodeLine lineNumber="4274"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> EstimatedWidthB = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.Width.getKnownMinValue();</Highlight></CodeLine>
<Link id="l04275" /><CodeLine lineNumber="4275"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (std::optional&lt;unsigned&gt; VScale = <a href="#a4e108201f94f2fe89865e7868390bbf6">getVScaleForTuning</a>(OrigLoop, TTI)) &#123;</Highlight></CodeLine>
<Link id="l04276" /><CodeLine lineNumber="4276"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Width.isScalable())</Highlight></CodeLine>
<Link id="l04277" /><CodeLine lineNumber="4277"><Highlight kind="normal">      EstimatedWidthA &#42;= &#42;VScale;</Highlight></CodeLine>
<Link id="l04278" /><CodeLine lineNumber="4278"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.Width.isScalable())</Highlight></CodeLine>
<Link id="l04279" /><CodeLine lineNumber="4279"><Highlight kind="normal">      EstimatedWidthB &#42;= &#42;VScale;</Highlight></CodeLine>
<Link id="l04280" /><CodeLine lineNumber="4280"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04281" /><CodeLine lineNumber="4281"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04282" /><CodeLine lineNumber="4282"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Assume vscale may be larger than 1 (or the value being tuned for),</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04283" /><CodeLine lineNumber="4283"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// so that scalable vectorization is slightly favorable over fixed-width</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04284" /><CodeLine lineNumber="4284"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04285" /><CodeLine lineNumber="4285"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> PreferScalable = !TTI.preferFixedOverScalableIfEqualCost() &amp;&amp;</Highlight></CodeLine>
<Link id="l04286" /><CodeLine lineNumber="4286"><Highlight kind="normal">                        <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.Width.isScalable() &amp;&amp; !<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.Width.isScalable();</Highlight></CodeLine>
<Link id="l04287" /><CodeLine lineNumber="4287"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04288" /><CodeLine lineNumber="4288"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CmpFn = &#91;PreferScalable&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> InstructionCost &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a>,</Highlight></CodeLine>
<Link id="l04289" /><CodeLine lineNumber="4289"><Highlight kind="normal">                                </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> InstructionCost &amp;<a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>) &#123;</Highlight></CodeLine>
<Link id="l04290" /><CodeLine lineNumber="4290"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> PreferScalable ? <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> &lt;= <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a> : <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a9e1483f7215664a2315c53c3558d9a8d">LHS</a> &lt; <a href="/docs/api/files/lib/lib/target/lib/target/x86/x86partialreduction-cpp/#a87b8bfbbe9d8f7146d7f20a5fb42efd0">RHS</a>;</Highlight></CodeLine>
<Link id="l04291" /><CodeLine lineNumber="4291"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l04292" /><CodeLine lineNumber="4292"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04293" /><CodeLine lineNumber="4293"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// To avoid the need for FP division:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04294" /><CodeLine lineNumber="4294"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//      (CostA / EstimatedWidthA) &lt; (CostB / EstimatedWidthB)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04295" /><CodeLine lineNumber="4295"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &lt;=&gt;  (CostA &#42; EstimatedWidthB) &lt; (CostB &#42; EstimatedWidthA)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04296" /><CodeLine lineNumber="4296"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MaxTripCount)</Highlight></CodeLine>
<Link id="l04297" /><CodeLine lineNumber="4297"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CmpFn(CostA &#42; EstimatedWidthB, CostB &#42; EstimatedWidthA);</Highlight></CodeLine>
<Link id="l04298" /><CodeLine lineNumber="4298"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04299" /><CodeLine lineNumber="4299"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GetCostForTC = &#91;MaxTripCount, </Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> VF,</Highlight></CodeLine>
<Link id="l04300" /><CodeLine lineNumber="4300"><Highlight kind="normal">                                           InstructionCost VectorCost,</Highlight></CodeLine>
<Link id="l04301" /><CodeLine lineNumber="4301"><Highlight kind="normal">                                           InstructionCost ScalarCost) &#123;</Highlight></CodeLine>
<Link id="l04302" /><CodeLine lineNumber="4302"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the trip count is a known (possibly small) constant, the trip count</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04303" /><CodeLine lineNumber="4303"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// will be rounded up to an integer number of iterations under</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04304" /><CodeLine lineNumber="4304"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// FoldTailByMasking. The total cost in that case will be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04305" /><CodeLine lineNumber="4305"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// VecCost&#42;ceil(TripCount/VF). When not folding the tail, the total</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04306" /><CodeLine lineNumber="4306"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// cost will be VecCost&#42;floor(TC/VF) + ScalarCost&#42;(TC%VF). There will be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04307" /><CodeLine lineNumber="4307"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// some extra overheads, but for the purpose of comparing the costs of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04308" /><CodeLine lineNumber="4308"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// different VFs we can use this to compare the total loop-body cost</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04309" /><CodeLine lineNumber="4309"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// expected after vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04310" /><CodeLine lineNumber="4310"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CM.foldTailByMasking())</Highlight></CodeLine>
<Link id="l04311" /><CodeLine lineNumber="4311"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> VectorCost &#42; <a href="/docs/api/namespaces/llvm/#a9dda4472ee0b7ea92ab49eedf6e13d50">divideCeil</a>(MaxTripCount, VF);</Highlight></CodeLine>
<Link id="l04312" /><CodeLine lineNumber="4312"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> VectorCost &#42; (MaxTripCount / VF) + ScalarCost &#42; (MaxTripCount % VF);</Highlight></CodeLine>
<Link id="l04313" /><CodeLine lineNumber="4313"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l04314" /><CodeLine lineNumber="4314"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04315" /><CodeLine lineNumber="4315"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> RTCostA = GetCostForTC(EstimatedWidthA, CostA, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.ScalarCost);</Highlight></CodeLine>
<Link id="l04316" /><CodeLine lineNumber="4316"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> RTCostB = GetCostForTC(EstimatedWidthB, CostB, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.ScalarCost);</Highlight></CodeLine>
<Link id="l04317" /><CodeLine lineNumber="4317"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CmpFn(RTCostA, RTCostB);</Highlight></CodeLine>
<Link id="l04318" /><CodeLine lineNumber="4318"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04319" /><CodeLine lineNumber="4319"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04320" /><CodeLine lineNumber="4320"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> LoopVectorizationPlanner::isMoreProfitable(</Highlight></CodeLine>
<Link id="l04321" /><CodeLine lineNumber="4321"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l04322" /><CodeLine lineNumber="4322"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxTripCount = PSE.getSmallConstantMaxTripCount();</Highlight></CodeLine>
<Link id="l04323" /><CodeLine lineNumber="4323"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> LoopVectorizationPlanner::isMoreProfitable(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>, MaxTripCount);</Highlight></CodeLine>
<Link id="l04324" /><CodeLine lineNumber="4324"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04325" /><CodeLine lineNumber="4325"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04326" /><CodeLine lineNumber="4326" lineLink="/docs/api/classes/llvm/loopvectorizationplanner/#aa216c2cbc8d9610dc20db065aca671d3"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationplanner/#aa216c2cbc8d9610dc20db065aca671d3">LoopVectorizationPlanner::emitInvalidCostRemarks</a>(</Highlight></CodeLine>
<Link id="l04327" /><CodeLine lineNumber="4327"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE) &#123;</Highlight></CodeLine>
<Link id="l04328" /><CodeLine lineNumber="4328"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal">RecipeVFPair = std::pair&lt;VPRecipeBase &#42;, ElementCount&gt;;</Highlight></CodeLine>
<Link id="l04329" /><CodeLine lineNumber="4329"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;RecipeVFPair&gt;</a> InvalidCosts;</Highlight></CodeLine>
<Link id="l04330" /><CodeLine lineNumber="4330"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Plan : VPlans) &#123;</Highlight></CodeLine>
<Link id="l04331" /><CodeLine lineNumber="4331"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF : Plan-&gt;vectorFactors()) &#123;</Highlight></CodeLine>
<Link id="l04332" /><CodeLine lineNumber="4332"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/vpcostcontext">VPCostContext</a> CostCtx(CM.TTI, &#42;CM.TLI, Legal-&gt;getWidestInductionType(),</Highlight></CodeLine>
<Link id="l04333" /><CodeLine lineNumber="4333"><Highlight kind="normal">                            CM, CM.CostKind);</Highlight></CodeLine>
<Link id="l04334" /><CodeLine lineNumber="4334"><Highlight kind="normal">      precomputeCosts(&#42;Plan, VF, CostCtx);</Highlight></CodeLine>
<Link id="l04335" /><CodeLine lineNumber="4335"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Iter = <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan-&gt;getVectorLoopRegion()-&gt;getEntry());</Highlight></CodeLine>
<Link id="l04336" /><CodeLine lineNumber="4336"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(Iter)) &#123;</Highlight></CodeLine>
<Link id="l04337" /><CodeLine lineNumber="4337"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;R : &#42;VPBB) &#123;</Highlight></CodeLine>
<Link id="l04338" /><CodeLine lineNumber="4338"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!R.cost(VF, CostCtx).isValid())</Highlight></CodeLine>
<Link id="l04339" /><CodeLine lineNumber="4339"><Highlight kind="normal">            InvalidCosts.<a href="/docs/api/classes/llvm/smallvectorimpl/#a396fcfee6914c76974b73c3d203da6a5">emplace&#95;back</a>(&amp;R, VF);</Highlight></CodeLine>
<Link id="l04340" /><CodeLine lineNumber="4340"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l04341" /><CodeLine lineNumber="4341"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04342" /><CodeLine lineNumber="4342"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04343" /><CodeLine lineNumber="4343"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04344" /><CodeLine lineNumber="4344"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InvalidCosts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</Highlight></CodeLine>
<Link id="l04345" /><CodeLine lineNumber="4345"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04346" /><CodeLine lineNumber="4346"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04347" /><CodeLine lineNumber="4347"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Emit a report of VFs with invalid costs in the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04348" /><CodeLine lineNumber="4348"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04349" /><CodeLine lineNumber="4349"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Group the remarks per recipe, keeping the recipe order from InvalidCosts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04350" /><CodeLine lineNumber="4350"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;VPRecipeBase &#42;, unsigned&gt;</a> Numbering;</Highlight></CodeLine>
<Link id="l04351" /><CodeLine lineNumber="4351"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0;</Highlight></CodeLine>
<Link id="l04352" /><CodeLine lineNumber="4352"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Pair : InvalidCosts)</Highlight></CodeLine>
<Link id="l04353" /><CodeLine lineNumber="4353"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Numbering.<a href="/docs/api/classes/llvm/densemapbase/#a53408c95a7bfb5443b43fb2134c3eb23">count</a>(Pair.first))</Highlight></CodeLine>
<Link id="l04354" /><CodeLine lineNumber="4354"><Highlight kind="normal">      Numbering&#91;Pair.first&#93; = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++;</Highlight></CodeLine>
<Link id="l04355" /><CodeLine lineNumber="4355"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04356" /><CodeLine lineNumber="4356"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Sort the list, first on recipe(number) then on VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04357" /><CodeLine lineNumber="4357"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a74cdbd1e4f731e7d7cd83461b8b1de0b">sort</a>(InvalidCosts, &#91;&amp;Numbering&#93;(RecipeVFPair &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, RecipeVFPair &amp;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>) &#123;</Highlight></CodeLine>
<Link id="l04358" /><CodeLine lineNumber="4358"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Numbering&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.first&#93; != Numbering&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.first&#93;)</Highlight></CodeLine>
<Link id="l04359" /><CodeLine lineNumber="4359"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Numbering&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.first&#93; &lt; Numbering&#91;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.first&#93;;</Highlight></CodeLine>
<Link id="l04360" /><CodeLine lineNumber="4360"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;LHS = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>.second;</Highlight></CodeLine>
<Link id="l04361" /><CodeLine lineNumber="4361"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;RHS = <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>.second;</Highlight></CodeLine>
<Link id="l04362" /><CodeLine lineNumber="4362"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::make&#95;tuple(LHS.isScalable(), LHS.getKnownMinValue()) &lt;</Highlight></CodeLine>
<Link id="l04363" /><CodeLine lineNumber="4363"><Highlight kind="normal">           std::make&#95;tuple(RHS.isScalable(), RHS.getKnownMinValue());</Highlight></CodeLine>
<Link id="l04364" /><CodeLine lineNumber="4364"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l04365" /><CodeLine lineNumber="4365"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04366" /><CodeLine lineNumber="4366"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For a list of ordered recipe-VF pairs:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04367" /><CodeLine lineNumber="4367"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   &#91;(load, VF1), (load, VF2), (store, VF1)&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04368" /><CodeLine lineNumber="4368"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// group the recipes together to emit separate remarks for:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04369" /><CodeLine lineNumber="4369"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   load  (VF1, VF2)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04370" /><CodeLine lineNumber="4370"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   store (VF1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04371" /><CodeLine lineNumber="4371"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a> = <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef&lt;RecipeVFPair&gt;</a>(InvalidCosts);</Highlight></CodeLine>
<Link id="l04372" /><CodeLine lineNumber="4372"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Subset = <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef&lt;RecipeVFPair&gt;</a>();</Highlight></CodeLine>
<Link id="l04373" /><CodeLine lineNumber="4373"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">do</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l04374" /><CodeLine lineNumber="4374"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Subset.empty())</Highlight></CodeLine>
<Link id="l04375" /><CodeLine lineNumber="4375"><Highlight kind="normal">      Subset = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a>.take&#95;front(1);</Highlight></CodeLine>
<Link id="l04376" /><CodeLine lineNumber="4376"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04377" /><CodeLine lineNumber="4377"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;R = Subset.front().first;</Highlight></CodeLine>
<Link id="l04378" /><CodeLine lineNumber="4378"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04379" /><CodeLine lineNumber="4379"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Opcode =</Highlight></CodeLine>
<Link id="l04380" /><CodeLine lineNumber="4380"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/typeswitch">TypeSwitch&lt;const VPRecipeBase &#42;, unsigned&gt;</a>(R)</Highlight></CodeLine>
<Link id="l04381" /><CodeLine lineNumber="4381"><Highlight kind="normal">            .<a href="/docs/api/classes/llvm/typeswitch/#a78c545287cbe57529ce7751e25c815a5">Case</a>&lt;<a href="/docs/api/classes/llvm/vpheaderphirecipe">VPHeaderPHIRecipe</a>&gt;(</Highlight></CodeLine>
<Link id="l04382" /><CodeLine lineNumber="4382"><Highlight kind="normal">                &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;R) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Instruction::PHI; &#125;)</Highlight></CodeLine>
<Link id="l04383" /><CodeLine lineNumber="4383"><Highlight kind="normal">            .Case&lt;VPWidenSelectRecipe&gt;(</Highlight></CodeLine>
<Link id="l04384" /><CodeLine lineNumber="4384"><Highlight kind="normal">                &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;R) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Instruction::Select; &#125;)</Highlight></CodeLine>
<Link id="l04385" /><CodeLine lineNumber="4385"><Highlight kind="normal">            .Case&lt;VPWidenStoreRecipe&gt;(</Highlight></CodeLine>
<Link id="l04386" /><CodeLine lineNumber="4386"><Highlight kind="normal">                &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;R) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Instruction::Store; &#125;)</Highlight></CodeLine>
<Link id="l04387" /><CodeLine lineNumber="4387"><Highlight kind="normal">            .Case&lt;VPWidenLoadRecipe&gt;(</Highlight></CodeLine>
<Link id="l04388" /><CodeLine lineNumber="4388"><Highlight kind="normal">                &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;R) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Instruction::Load; &#125;)</Highlight></CodeLine>
<Link id="l04389" /><CodeLine lineNumber="4389"><Highlight kind="normal">            .Case&lt;VPWidenCallRecipe, VPWidenIntrinsicRecipe&gt;(</Highlight></CodeLine>
<Link id="l04390" /><CodeLine lineNumber="4390"><Highlight kind="normal">                &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;R) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Instruction::Call; &#125;)</Highlight></CodeLine>
<Link id="l04391" /><CodeLine lineNumber="4391"><Highlight kind="normal">            .Case&lt;<a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a>, <a href="/docs/api/classes/llvm/vpwidenrecipe">VPWidenRecipe</a>, <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a>,</Highlight></CodeLine>
<Link id="l04392" /><CodeLine lineNumber="4392"><Highlight kind="normal">                  <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>&gt;(</Highlight></CodeLine>
<Link id="l04393" /><CodeLine lineNumber="4393"><Highlight kind="normal">                &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;R) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> R-&gt;getOpcode(); &#125;)</Highlight></CodeLine>
<Link id="l04394" /><CodeLine lineNumber="4394"><Highlight kind="normal">            .Case&lt;VPInterleaveRecipe&gt;(&#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpinterleaverecipe">VPInterleaveRecipe</a> &#42;R) &#123;</Highlight></CodeLine>
<Link id="l04395" /><CodeLine lineNumber="4395"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> R-&gt;getStoredValues().empty() ? Instruction::Load</Highlight></CodeLine>
<Link id="l04396" /><CodeLine lineNumber="4396"><Highlight kind="normal">                                                  : Instruction::Store;</Highlight></CodeLine>
<Link id="l04397" /><CodeLine lineNumber="4397"><Highlight kind="normal">            &#125;);</Highlight></CodeLine>
<Link id="l04398" /><CodeLine lineNumber="4398"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04399" /><CodeLine lineNumber="4399"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the next recipe is different, or if there are no other pairs,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04400" /><CodeLine lineNumber="4400"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// emit a remark for the collated subset. e.g.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04401" /><CodeLine lineNumber="4401"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   &#91;(load, VF1), (load, VF2))&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04402" /><CodeLine lineNumber="4402"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to emit:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04403" /><CodeLine lineNumber="4403"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  remark: invalid costs for &#39;load&#39; at VF=(VF1, VF2)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04404" /><CodeLine lineNumber="4404"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Subset == <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a> || <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a>&#91;Subset.size()&#93;.first != R) &#123;</Highlight></CodeLine>
<Link id="l04405" /><CodeLine lineNumber="4405"><Highlight kind="normal">      std::string OutString;</Highlight></CodeLine>
<Link id="l04406" /><CodeLine lineNumber="4406"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/raw-string-ostream">raw&#95;string&#95;ostream</a> OS(OutString);</Highlight></CodeLine>
<Link id="l04407" /><CodeLine lineNumber="4407"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Subset.empty() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unexpected empty range&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04408" /><CodeLine lineNumber="4408"><Highlight kind="normal">      OS &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Recipe with invalid costs prevented vectorization at VF=(&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04409" /><CodeLine lineNumber="4409"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Pair : Subset)</Highlight></CodeLine>
<Link id="l04410" /><CodeLine lineNumber="4410"><Highlight kind="normal">        OS &lt;&lt; (Pair.second == Subset.front().second ? </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;, &quot;</Highlight><Highlight kind="normal">) &lt;&lt; Pair.second;</Highlight></CodeLine>
<Link id="l04411" /><CodeLine lineNumber="4411"><Highlight kind="normal">      OS &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;):&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04412" /><CodeLine lineNumber="4412"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Opcode == Instruction::Call) &#123;</Highlight></CodeLine>
<Link id="l04413" /><CodeLine lineNumber="4413"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name = </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04414" /><CodeLine lineNumber="4414"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a637b69dea56f804278aa50e975337e01">Int</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenIntrinsicRecipe&gt;</a>(R)) &#123;</Highlight></CodeLine>
<Link id="l04415" /><CodeLine lineNumber="4415"><Highlight kind="normal">          Name = <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a637b69dea56f804278aa50e975337e01">Int</a>-&gt;getIntrinsicName();</Highlight></CodeLine>
<Link id="l04416" /><CodeLine lineNumber="4416"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l04417" /><CodeLine lineNumber="4417"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WidenCall = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenCallRecipe&gt;</a>(R);</Highlight></CodeLine>
<Link id="l04418" /><CodeLine lineNumber="4418"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/function">Function</a> &#42;CalledFn =</Highlight></CodeLine>
<Link id="l04419" /><CodeLine lineNumber="4419"><Highlight kind="normal">              WidenCall ? WidenCall-&gt;getCalledScalarFunction()</Highlight></CodeLine>
<Link id="l04420" /><CodeLine lineNumber="4420"><Highlight kind="normal">                        : <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Function&gt;</a>(R-&gt;getOperand(R-&gt;getNumOperands() - 1)</Highlight></CodeLine>
<Link id="l04421" /><CodeLine lineNumber="4421"><Highlight kind="normal">                                             -&gt;getLiveInIRValue());</Highlight></CodeLine>
<Link id="l04422" /><CodeLine lineNumber="4422"><Highlight kind="normal">          Name = CalledFn-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>();</Highlight></CodeLine>
<Link id="l04423" /><CodeLine lineNumber="4423"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l04424" /><CodeLine lineNumber="4424"><Highlight kind="normal">        OS &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; call to &quot;</Highlight><Highlight kind="normal"> &lt;&lt; Name;</Highlight></CodeLine>
<Link id="l04425" /><CodeLine lineNumber="4425"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04426" /><CodeLine lineNumber="4426"><Highlight kind="normal">        OS &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/classes/llvm/instruction/#a9affd129d19aae669647eb0d1c91f793">Instruction::getOpcodeName</a>(Opcode);</Highlight></CodeLine>
<Link id="l04427" /><CodeLine lineNumber="4427"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(OutString, </Highlight><Highlight kind="stringliteral">&quot;InvalidCost&quot;</Highlight><Highlight kind="normal">, ORE, OrigLoop, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l04428" /><CodeLine lineNumber="4428"><Highlight kind="normal">                              R-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l04429" /><CodeLine lineNumber="4429"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a> = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a>.drop&#95;front(Subset.size());</Highlight></CodeLine>
<Link id="l04430" /><CodeLine lineNumber="4430"><Highlight kind="normal">      Subset = &#123;&#125;;</Highlight></CodeLine>
<Link id="l04431" /><CodeLine lineNumber="4431"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04432" /><CodeLine lineNumber="4432"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Grow the subset by one element</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04433" /><CodeLine lineNumber="4433"><Highlight kind="normal">      Subset = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a>.take&#95;front(Subset.size() + 1);</Highlight></CodeLine>
<Link id="l04434" /><CodeLine lineNumber="4434"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cad6e9c0ff694f0fca0222e79e772b647e">Tail</a>.empty());</Highlight></CodeLine>
<Link id="l04435" /><CodeLine lineNumber="4435"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04436" /><CodeLine lineNumber="4436"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l04437" /><CodeLine lineNumber="4437"><Highlight kind="comment">/// Check if any recipe of \\p Plan will generate a vector value, which will be</Highlight></CodeLine>
<Link id="l04438" /><CodeLine lineNumber="4438"><Highlight kind="comment">/// assigned a vector register.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04439" /><CodeLine lineNumber="4439" lineLink="#af378bb1e037306d9cfd4bb0b49ba55f9"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#af378bb1e037306d9cfd4bb0b49ba55f9">willGenerateVectors</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF,</Highlight></CodeLine>
<Link id="l04440" /><CodeLine lineNumber="4440"><Highlight kind="normal">                                </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>) &#123;</Highlight></CodeLine>
<Link id="l04441" /><CodeLine lineNumber="4441"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Checking a scalar VF?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04442" /><CodeLine lineNumber="4442"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>());</Highlight></CodeLine>
<Link id="l04443" /><CodeLine lineNumber="4443"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;VPRecipeBase &#42;&gt;</a> EphemeralRecipes;</Highlight></CodeLine>
<Link id="l04444" /><CodeLine lineNumber="4444"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a62219a4c97e27d64593245e4e9187cd1">collectEphemeralRecipesForVPlan</a>(Plan, EphemeralRecipes);</Highlight></CodeLine>
<Link id="l04445" /><CodeLine lineNumber="4445"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Set of already visited types.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04446" /><CodeLine lineNumber="4446"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;Type &#42;&gt;</a> Visited;</Highlight></CodeLine>
<Link id="l04447" /><CodeLine lineNumber="4447"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(</Highlight></CodeLine>
<Link id="l04448" /><CodeLine lineNumber="4448"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#a4474bfb1e0ca062e5bfe2a35980e7d19">vp&#95;depth&#95;first&#95;shallow</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#a1ae2cb3c63b4d67324ddc947fb9696fc">getEntry</a>()))) &#123;</Highlight></CodeLine>
<Link id="l04449" /><CodeLine lineNumber="4449"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : &#42;VPBB) &#123;</Highlight></CodeLine>
<Link id="l04450" /><CodeLine lineNumber="4450"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EphemeralRecipes.<a href="/docs/api/classes/llvm/detail/densesetimpl/#ad409c2de8502b94c8a0b1193307c63b6">contains</a>(&amp;R))</Highlight></CodeLine>
<Link id="l04451" /><CodeLine lineNumber="4451"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04452" /><CodeLine lineNumber="4452"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Continue early if the recipe is considered to not produce a vector</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04453" /><CodeLine lineNumber="4453"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// result. Note that this includes VPInstruction where some opcodes may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04454" /><CodeLine lineNumber="4454"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// produce a vector, to preserve existing behavior as VPInstructions model</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04455" /><CodeLine lineNumber="4455"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// aspects not directly mapped to existing IR instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04456" /><CodeLine lineNumber="4456"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (R.getVPDefID()) &#123;</Highlight></CodeLine>
<Link id="l04457" /><CodeLine lineNumber="4457"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPDerivedIVSC:</Highlight></CodeLine>
<Link id="l04458" /><CodeLine lineNumber="4458"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPScalarIVStepsSC:</Highlight></CodeLine>
<Link id="l04459" /><CodeLine lineNumber="4459"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPScalarCastSC:</Highlight></CodeLine>
<Link id="l04460" /><CodeLine lineNumber="4460"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPReplicateSC:</Highlight></CodeLine>
<Link id="l04461" /><CodeLine lineNumber="4461"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPInstructionSC:</Highlight></CodeLine>
<Link id="l04462" /><CodeLine lineNumber="4462"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPCanonicalIVPHISC:</Highlight></CodeLine>
<Link id="l04463" /><CodeLine lineNumber="4463"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPVectorPointerSC:</Highlight></CodeLine>
<Link id="l04464" /><CodeLine lineNumber="4464"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPReverseVectorPointerSC:</Highlight></CodeLine>
<Link id="l04465" /><CodeLine lineNumber="4465"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPExpandSCEVSC:</Highlight></CodeLine>
<Link id="l04466" /><CodeLine lineNumber="4466"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPEVLBasedIVPHISC:</Highlight></CodeLine>
<Link id="l04467" /><CodeLine lineNumber="4467"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPPredInstPHISC:</Highlight></CodeLine>
<Link id="l04468" /><CodeLine lineNumber="4468"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPBranchOnMaskSC:</Highlight></CodeLine>
<Link id="l04469" /><CodeLine lineNumber="4469"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04470" /><CodeLine lineNumber="4470"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPReductionSC:</Highlight></CodeLine>
<Link id="l04471" /><CodeLine lineNumber="4471"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPActiveLaneMaskPHISC:</Highlight></CodeLine>
<Link id="l04472" /><CodeLine lineNumber="4472"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPWidenCallSC:</Highlight></CodeLine>
<Link id="l04473" /><CodeLine lineNumber="4473"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPWidenCanonicalIVSC:</Highlight></CodeLine>
<Link id="l04474" /><CodeLine lineNumber="4474"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPWidenCastSC:</Highlight></CodeLine>
<Link id="l04475" /><CodeLine lineNumber="4475"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPWidenGEPSC:</Highlight></CodeLine>
<Link id="l04476" /><CodeLine lineNumber="4476"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPWidenIntrinsicSC:</Highlight></CodeLine>
<Link id="l04477" /><CodeLine lineNumber="4477"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPWidenSC:</Highlight></CodeLine>
<Link id="l04478" /><CodeLine lineNumber="4478"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPWidenSelectSC:</Highlight></CodeLine>
<Link id="l04479" /><CodeLine lineNumber="4479"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPBlendSC:</Highlight></CodeLine>
<Link id="l04480" /><CodeLine lineNumber="4480"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPFirstOrderRecurrencePHISC:</Highlight></CodeLine>
<Link id="l04481" /><CodeLine lineNumber="4481"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPWidenPHISC:</Highlight></CodeLine>
<Link id="l04482" /><CodeLine lineNumber="4482"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPWidenIntOrFpInductionSC:</Highlight></CodeLine>
<Link id="l04483" /><CodeLine lineNumber="4483"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPWidenPointerInductionSC:</Highlight></CodeLine>
<Link id="l04484" /><CodeLine lineNumber="4484"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPReductionPHISC:</Highlight></CodeLine>
<Link id="l04485" /><CodeLine lineNumber="4485"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPInterleaveSC:</Highlight></CodeLine>
<Link id="l04486" /><CodeLine lineNumber="4486"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPWidenLoadEVLSC:</Highlight></CodeLine>
<Link id="l04487" /><CodeLine lineNumber="4487"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPWidenLoadSC:</Highlight></CodeLine>
<Link id="l04488" /><CodeLine lineNumber="4488"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPWidenStoreEVLSC:</Highlight></CodeLine>
<Link id="l04489" /><CodeLine lineNumber="4489"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> VPDef::VPWidenStoreSC:</Highlight></CodeLine>
<Link id="l04490" /><CodeLine lineNumber="4490"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04491" /><CodeLine lineNumber="4491"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l04492" /><CodeLine lineNumber="4492"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;unhandled recipe&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04493" /><CodeLine lineNumber="4493"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04494" /><CodeLine lineNumber="4494"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04495" /><CodeLine lineNumber="4495"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> WillWiden = &#91;&amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, VF&#93;(<a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarTy) &#123;</Highlight></CodeLine>
<Link id="l04496" /><CodeLine lineNumber="4496"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/type">Type</a> &#42;VectorTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ScalarTy, VF);</Highlight></CodeLine>
<Link id="l04497" /><CodeLine lineNumber="4497"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumLegalParts = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getNumberOfParts(VectorTy);</Highlight></CodeLine>
<Link id="l04498" /><CodeLine lineNumber="4498"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NumLegalParts)</Highlight></CodeLine>
<Link id="l04499" /><CodeLine lineNumber="4499"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04500" /><CodeLine lineNumber="4500"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>()) &#123;</Highlight></CodeLine>
<Link id="l04501" /><CodeLine lineNumber="4501"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// &lt;vscale x 1 x iN&gt; is assumed to be profitable over iN because</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04502" /><CodeLine lineNumber="4502"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// scalable registers are a distinct register class from scalar</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04503" /><CodeLine lineNumber="4503"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// ones. If we ever find a target which wants to lower scalable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04504" /><CodeLine lineNumber="4504"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// vectors back to scalars, we&#39;ll need to update this code to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04505" /><CodeLine lineNumber="4505"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// explicitly ask TTI about the register class uses for each part.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04506" /><CodeLine lineNumber="4506"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NumLegalParts &lt;= VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>();</Highlight></CodeLine>
<Link id="l04507" /><CodeLine lineNumber="4507"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l04508" /><CodeLine lineNumber="4508"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Two or more parts that share a register - are vectorized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04509" /><CodeLine lineNumber="4509"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> NumLegalParts &lt; VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>();</Highlight></CodeLine>
<Link id="l04510" /><CodeLine lineNumber="4510"><Highlight kind="normal">      &#125;;</Highlight></CodeLine>
<Link id="l04511" /><CodeLine lineNumber="4511"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04512" /><CodeLine lineNumber="4512"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If no def nor is a store, e.g., branches, continue - no value to check.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04513" /><CodeLine lineNumber="4513"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (R.getNumDefinedValues() == 0 &amp;&amp;</Highlight></CodeLine>
<Link id="l04514" /><CodeLine lineNumber="4514"><Highlight kind="normal">          !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenStoreRecipe, VPWidenStoreEVLRecipe, VPInterleaveRecipe&gt;</a>(</Highlight></CodeLine>
<Link id="l04515" /><CodeLine lineNumber="4515"><Highlight kind="normal">              &amp;R))</Highlight></CodeLine>
<Link id="l04516" /><CodeLine lineNumber="4516"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04517" /><CodeLine lineNumber="4517"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// For multi-def recipes, currently only interleaved loads, suffice to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04518" /><CodeLine lineNumber="4518"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// check first def only.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04519" /><CodeLine lineNumber="4519"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// For stores check their stored value; for interleaved stores suffice</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04520" /><CodeLine lineNumber="4520"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the check first stored value only. In all cases this is the second</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04521" /><CodeLine lineNumber="4521"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04522" /><CodeLine lineNumber="4522"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;ToCheck =</Highlight></CodeLine>
<Link id="l04523" /><CodeLine lineNumber="4523"><Highlight kind="normal">          R.getNumDefinedValues() &gt;= 1 ? R.getVPValue(0) : R.getOperand(1);</Highlight></CodeLine>
<Link id="l04524" /><CodeLine lineNumber="4524"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarTy = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(ToCheck);</Highlight></CodeLine>
<Link id="l04525" /><CodeLine lineNumber="4525"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Visited.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(&#123;ScalarTy&#125;).second)</Highlight></CodeLine>
<Link id="l04526" /><CodeLine lineNumber="4526"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04527" /><CodeLine lineNumber="4527"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (WillWiden(ScalarTy))</Highlight></CodeLine>
<Link id="l04528" /><CodeLine lineNumber="4528"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04529" /><CodeLine lineNumber="4529"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04530" /><CodeLine lineNumber="4530"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04531" /><CodeLine lineNumber="4531"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04532" /><CodeLine lineNumber="4532"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04533" /><CodeLine lineNumber="4533"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04534" /><CodeLine lineNumber="4534"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04535" /><CodeLine lineNumber="4535"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04536" /><CodeLine lineNumber="4536"><Highlight kind="normal"><a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> LoopVectorizationPlanner::selectVectorizationFactor() &#123;</Highlight></CodeLine>
<Link id="l04537" /><CodeLine lineNumber="4537"><Highlight kind="normal">  InstructionCost ExpectedCost = CM.expectedCost(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1));</Highlight></CodeLine>
<Link id="l04538" /><CodeLine lineNumber="4538"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Scalar loop costs: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; ExpectedCost &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04539" /><CodeLine lineNumber="4539"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExpectedCost.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unexpected invalid cost for scalar loop&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04540" /><CodeLine lineNumber="4540"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(VPlans,</Highlight></CodeLine>
<Link id="l04541" /><CodeLine lineNumber="4541"><Highlight kind="normal">                &#91;&#93;(std::unique&#95;ptr&lt;VPlan&gt; &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>) &#123;</Highlight></CodeLine>
<Link id="l04542" /><CodeLine lineNumber="4542"><Highlight kind="normal">                  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;hasVF(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1));</Highlight></CodeLine>
<Link id="l04543" /><CodeLine lineNumber="4543"><Highlight kind="normal">                &#125;) &amp;&amp;</Highlight></CodeLine>
<Link id="l04544" /><CodeLine lineNumber="4544"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Expected Scalar VF to be a candidate&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04545" /><CodeLine lineNumber="4545"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04546" /><CodeLine lineNumber="4546"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/analysis/loopaccessanalysis-cpp/#a8f125edbbaab03487fd1acbc5fa1c8b4">VectorizationFactor</a> ScalarCost(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1), ExpectedCost,</Highlight></CodeLine>
<Link id="l04547" /><CodeLine lineNumber="4547"><Highlight kind="normal">                                       ExpectedCost);</Highlight></CodeLine>
<Link id="l04548" /><CodeLine lineNumber="4548"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/analysis/loopaccessanalysis-cpp/#a8f125edbbaab03487fd1acbc5fa1c8b4">VectorizationFactor</a> ChosenFactor = ScalarCost;</Highlight></CodeLine>
<Link id="l04549" /><CodeLine lineNumber="4549"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04550" /><CodeLine lineNumber="4550"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ForceVectorization = Hints.getForce() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a>;</Highlight></CodeLine>
<Link id="l04551" /><CodeLine lineNumber="4551"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ForceVectorization &amp;&amp;</Highlight></CodeLine>
<Link id="l04552" /><CodeLine lineNumber="4552"><Highlight kind="normal">      (VPlans.size() &gt; 1 || !VPlans&#91;0&#93;-&gt;hasScalarVFOnly())) &#123;</Highlight></CodeLine>
<Link id="l04553" /><CodeLine lineNumber="4553"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Ignore scalar width, because the user explicitly wants vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04554" /><CodeLine lineNumber="4554"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Initialize cost to max so that VF = 2 is, at least, chosen during cost</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04555" /><CodeLine lineNumber="4555"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// evaluation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04556" /><CodeLine lineNumber="4556"><Highlight kind="normal">    ChosenFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a048d568675a5cc69c3fb85206882316d">Cost</a> = <a href="/docs/api/classes/llvm/instructioncost/#a6de26b938774385a0a4fb0d0b2a32d48">InstructionCost::getMax</a>();</Highlight></CodeLine>
<Link id="l04557" /><CodeLine lineNumber="4557"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04558" /><CodeLine lineNumber="4558"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04559" /><CodeLine lineNumber="4559"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : VPlans) &#123;</Highlight></CodeLine>
<Link id="l04560" /><CodeLine lineNumber="4560"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (ElementCount VF : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;vectorFactors()) &#123;</Highlight></CodeLine>
<Link id="l04561" /><CodeLine lineNumber="4561"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The cost for scalar VF=1 is already calculated, so ignore it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04562" /><CodeLine lineNumber="4562"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.isScalar())</Highlight></CodeLine>
<Link id="l04563" /><CodeLine lineNumber="4563"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04564" /><CodeLine lineNumber="4564"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04565" /><CodeLine lineNumber="4565"><Highlight kind="normal">      InstructionCost <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = CM.expectedCost(VF);</Highlight></CodeLine>
<Link id="l04566" /><CodeLine lineNumber="4566"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/analysis/loopaccessanalysis-cpp/#a8f125edbbaab03487fd1acbc5fa1c8b4">VectorizationFactor</a> Candidate(VF, <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>, ScalarCost.ScalarCost);</Highlight></CodeLine>
<Link id="l04567" /><CodeLine lineNumber="4567"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04568" /><CodeLine lineNumber="4568"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Width = <a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a>(OrigLoop, TTI, Candidate.Width);</Highlight></CodeLine>
<Link id="l04569" /><CodeLine lineNumber="4569"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Vector loop of width &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF</Highlight></CodeLine>
<Link id="l04570" /><CodeLine lineNumber="4570"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; costs: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; (Candidate.Cost / Width));</Highlight></CodeLine>
<Link id="l04571" /><CodeLine lineNumber="4571"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.isScalable())</Highlight></CodeLine>
<Link id="l04572" /><CodeLine lineNumber="4572"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; (assuming a minimum vscale of &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04573" /><CodeLine lineNumber="4573"><Highlight kind="normal">                          &lt;&lt; <a href="#a4e108201f94f2fe89865e7868390bbf6">getVScaleForTuning</a>(OrigLoop, TTI).value&#95;or(1)</Highlight></CodeLine>
<Link id="l04574" /><CodeLine lineNumber="4574"><Highlight kind="normal">                          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;)&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04575" /><CodeLine lineNumber="4575"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04576" /><CodeLine lineNumber="4576"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04577" /><CodeLine lineNumber="4577"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ForceVectorization &amp;&amp; !<a href="#af378bb1e037306d9cfd4bb0b49ba55f9">willGenerateVectors</a>(&#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, VF, TTI)) &#123;</Highlight></CodeLine>
<Link id="l04578" /><CodeLine lineNumber="4578"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l04579" /><CodeLine lineNumber="4579"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</Highlight></CodeLine>
<Link id="l04580" /><CodeLine lineNumber="4580"><Highlight kind="normal">            &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Not considering vector loop of width &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF</Highlight></CodeLine>
<Link id="l04581" /><CodeLine lineNumber="4581"><Highlight kind="normal">            &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; because it will not generate any vector instructions.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04582" /><CodeLine lineNumber="4582"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04583" /><CodeLine lineNumber="4583"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04584" /><CodeLine lineNumber="4584"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04585" /><CodeLine lineNumber="4585"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (isMoreProfitable(Candidate, ChosenFactor))</Highlight></CodeLine>
<Link id="l04586" /><CodeLine lineNumber="4586"><Highlight kind="normal">        ChosenFactor = Candidate;</Highlight></CodeLine>
<Link id="l04587" /><CodeLine lineNumber="4587"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04588" /><CodeLine lineNumber="4588"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04589" /><CodeLine lineNumber="4589"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04590" /><CodeLine lineNumber="4590"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a1b67aba558e56b48dbb2891b6e5fe5b8">EnableCondStoresVectorization</a> &amp;&amp; CM.hasPredStores()) &#123;</Highlight></CodeLine>
<Link id="l04591" /><CodeLine lineNumber="4591"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight></CodeLine>
<Link id="l04592" /><CodeLine lineNumber="4592"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;There are conditional stores.&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l04593" /><CodeLine lineNumber="4593"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;store that is conditionally executed prevents vectorization&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l04594" /><CodeLine lineNumber="4594"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;ConditionalStore&quot;</Highlight><Highlight kind="normal">, ORE, OrigLoop);</Highlight></CodeLine>
<Link id="l04595" /><CodeLine lineNumber="4595"><Highlight kind="normal">    ChosenFactor = ScalarCost;</Highlight></CodeLine>
<Link id="l04596" /><CodeLine lineNumber="4596"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04597" /><CodeLine lineNumber="4597"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04598" /><CodeLine lineNumber="4598"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ForceVectorization &amp;&amp; !ChosenFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l04599" /><CodeLine lineNumber="4599"><Highlight kind="normal">                 !isMoreProfitable(ChosenFactor, ScalarCost)) <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</Highlight></CodeLine>
<Link id="l04600" /><CodeLine lineNumber="4600"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Vectorization seems to be not beneficial, &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04601" /><CodeLine lineNumber="4601"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;but was forced by a user.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04602" /><CodeLine lineNumber="4602"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ChosenFactor;</Highlight></CodeLine>
<Link id="l04603" /><CodeLine lineNumber="4603"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04604" /><CodeLine lineNumber="4604"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04605" /><CodeLine lineNumber="4605"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04606" /><CodeLine lineNumber="4606"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> LoopVectorizationPlanner::isCandidateForEpilogueVectorization(</Highlight></CodeLine>
<Link id="l04607" /><CodeLine lineNumber="4607"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l04608" /><CodeLine lineNumber="4608"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Cross iteration phis such as reductions need special handling and are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04609" /><CodeLine lineNumber="4609"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// currently unsupported.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04610" /><CodeLine lineNumber="4610"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(OrigLoop-&gt;getHeader()-&gt;phis(),</Highlight></CodeLine>
<Link id="l04611" /><CodeLine lineNumber="4611"><Highlight kind="normal">             &#91;&amp;&#93;(PHINode &amp;Phi) &#123; return Legal-&gt;isFixedOrderRecurrence(&amp;Phi); &#125;))</Highlight></CodeLine>
<Link id="l04612" /><CodeLine lineNumber="4612"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04613" /><CodeLine lineNumber="4613"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04614" /><CodeLine lineNumber="4614"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Phis with uses outside of the loop require special handling and are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04615" /><CodeLine lineNumber="4615"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// currently unsupported.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04616" /><CodeLine lineNumber="4616"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Entry : Legal-&gt;getInductionVars()) &#123;</Highlight></CodeLine>
<Link id="l04617" /><CodeLine lineNumber="4617"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Look for uses of the value of the induction at the last iteration.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04618" /><CodeLine lineNumber="4618"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arc/arcinstrinfo-cpp/#a5d6e37f3d036496321824378223ad718a1673ee57164ca23d9545b629b55e08d2">PostInc</a> =</Highlight></CodeLine>
<Link id="l04619" /><CodeLine lineNumber="4619"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Entry</a>.first-&gt;getIncomingValueForBlock(OrigLoop-&gt;getLoopLatch());</Highlight></CodeLine>
<Link id="l04620" /><CodeLine lineNumber="4620"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (User &#42;U : <a href="/docs/api/files/lib/lib/target/lib/target/arc/arcinstrinfo-cpp/#a5d6e37f3d036496321824378223ad718a1673ee57164ca23d9545b629b55e08d2">PostInc</a>-&gt;users())</Highlight></CodeLine>
<Link id="l04621" /><CodeLine lineNumber="4621"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OrigLoop-&gt;contains(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U)))</Highlight></CodeLine>
<Link id="l04622" /><CodeLine lineNumber="4622"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04623" /><CodeLine lineNumber="4623"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Look for uses of penultimate value of the induction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04624" /><CodeLine lineNumber="4624"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (User &#42;U : <a href="/docs/api/namespaces/llvm/coff/#ae7629a0652411dc2be61aea4fee2b39caadd024eaaab0666500593f30456bbc43">Entry</a>.first-&gt;users())</Highlight></CodeLine>
<Link id="l04625" /><CodeLine lineNumber="4625"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OrigLoop-&gt;contains(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U)))</Highlight></CodeLine>
<Link id="l04626" /><CodeLine lineNumber="4626"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04627" /><CodeLine lineNumber="4627"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04628" /><CodeLine lineNumber="4628"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04629" /><CodeLine lineNumber="4629"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Don&#39;t vectorize the epilogue, if there are FindLastIV recurrences with a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04630" /><CodeLine lineNumber="4630"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// start value may be undef or poison. Such start values would need freezing.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04631" /><CodeLine lineNumber="4631"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(Legal-&gt;getReductionVars(), &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>) &#123;</Highlight></CodeLine>
<Link id="l04632" /><CodeLine lineNumber="4632"><Highlight kind="normal">        return RecurrenceDescriptor::isFindLastIVRecurrenceKind(</Highlight></CodeLine>
<Link id="l04633" /><CodeLine lineNumber="4633"><Highlight kind="normal">                   P.second.getRecurrenceKind()) &amp;&amp;</Highlight></CodeLine>
<Link id="l04634" /><CodeLine lineNumber="4634"><Highlight kind="normal">               !isGuaranteedNotToBeUndefOrPoison(</Highlight></CodeLine>
<Link id="l04635" /><CodeLine lineNumber="4635"><Highlight kind="normal">                   P.second.getRecurrenceStartValue());</Highlight></CodeLine>
<Link id="l04636" /><CodeLine lineNumber="4636"><Highlight kind="normal">      &#125;))</Highlight></CodeLine>
<Link id="l04637" /><CodeLine lineNumber="4637"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04638" /><CodeLine lineNumber="4638"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04639" /><CodeLine lineNumber="4639"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Epilogue vectorization code has not been auditted to ensure it handles</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04640" /><CodeLine lineNumber="4640"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// non-latch exits properly.  It may be fine, but it needs auditted and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04641" /><CodeLine lineNumber="4641"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// tested.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04642" /><CodeLine lineNumber="4642"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Add support for loops with an early exit.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04643" /><CodeLine lineNumber="4643"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OrigLoop-&gt;getExitingBlock() != OrigLoop-&gt;getLoopLatch())</Highlight></CodeLine>
<Link id="l04644" /><CodeLine lineNumber="4644"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04645" /><CodeLine lineNumber="4645"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04646" /><CodeLine lineNumber="4646"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04647" /><CodeLine lineNumber="4647"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04648" /><CodeLine lineNumber="4648"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04649" /><CodeLine lineNumber="4649" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a07db8a5919c9879e3327549f20cda2f9"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a07db8a5919c9879e3327549f20cda2f9">LoopVectorizationCostModel::isEpilogueVectorizationProfitable</a>(</Highlight></CodeLine>
<Link id="l04650" /><CodeLine lineNumber="4650"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IC)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l04651" /><CodeLine lineNumber="4651"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: We need a much better cost-model to take different parameters such</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04652" /><CodeLine lineNumber="4652"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// as register pressure, code size increase and cost of extra branches into</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04653" /><CodeLine lineNumber="4653"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// account. For now we apply a very crude heuristic and only consider loops</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04654" /><CodeLine lineNumber="4654"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// with vectorization factors larger than a certain value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04655" /><CodeLine lineNumber="4655"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04656" /><CodeLine lineNumber="4656"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Allow the target to opt out entirely.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04657" /><CodeLine lineNumber="4657"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.preferEpilogueVectorization())</Highlight></CodeLine>
<Link id="l04658" /><CodeLine lineNumber="4658"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04659" /><CodeLine lineNumber="4659"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04660" /><CodeLine lineNumber="4660"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We also consider epilogue vectorization unprofitable for targets that don&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04661" /><CodeLine lineNumber="4661"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// consider interleaving beneficial (eg. MVE).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04662" /><CodeLine lineNumber="4662"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMaxInterleaveFactor(VF) &lt;= 1)</Highlight></CodeLine>
<Link id="l04663" /><CodeLine lineNumber="4663"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04664" /><CodeLine lineNumber="4664"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04665" /><CodeLine lineNumber="4665"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: PR #108190 introduced a discrepancy between fixed-width and scalable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04666" /><CodeLine lineNumber="4666"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// VFs when deciding profitability.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04667" /><CodeLine lineNumber="4667"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// See related &quot;TODO: extend to support scalable VFs.&quot; in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04668" /><CodeLine lineNumber="4668"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// selectEpilogueVectorizationFactor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04669" /><CodeLine lineNumber="4669"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Multiplier = VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#aab9a9b0568c1c524f01499c7930b3bf9">isFixed</a>() ? IC : 1;</Highlight></CodeLine>
<Link id="l04670" /><CodeLine lineNumber="4670"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MinVFThreshold = <a href="#a01070590fdc156c181654c2db7b9ddcc">EpilogueVectorizationMinVF</a>.getNumOccurrences() &gt; 0</Highlight></CodeLine>
<Link id="l04671" /><CodeLine lineNumber="4671"><Highlight kind="normal">                                ? <a href="#a01070590fdc156c181654c2db7b9ddcc">EpilogueVectorizationMinVF</a></Highlight></CodeLine>
<Link id="l04672" /><CodeLine lineNumber="4672"><Highlight kind="normal">                                : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getEpilogueVectorizationMinVF();</Highlight></CodeLine>
<Link id="l04673" /><CodeLine lineNumber="4673"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>, VF &#42; Multiplier) &gt;= MinVFThreshold;</Highlight></CodeLine>
<Link id="l04674" /><CodeLine lineNumber="4674"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04675" /><CodeLine lineNumber="4675"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04676" /><CodeLine lineNumber="4676" lineLink="/docs/api/classes/llvm/loopvectorizationplanner/#a0b6b1ae088cb8ca3aa4f26c4098daa3d"><Highlight kind="normal"><a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> <a href="/docs/api/classes/llvm/loopvectorizationplanner/#a0b6b1ae088cb8ca3aa4f26c4098daa3d">LoopVectorizationPlanner::selectEpilogueVectorizationFactor</a>(</Highlight></CodeLine>
<Link id="l04677" /><CodeLine lineNumber="4677"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MainLoopVF, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IC) &#123;</Highlight></CodeLine>
<Link id="l04678" /><CodeLine lineNumber="4678"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> Result = <a href="/docs/api/structs/llvm/vectorizationfactor/#acd24dfdad4f887e1f7b10c9039a05930">VectorizationFactor::Disabled</a>();</Highlight></CodeLine>
<Link id="l04679" /><CodeLine lineNumber="4679"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a8bb0da83afffaf803b396b1d055ba5e0">EnableEpilogueVectorization</a>) &#123;</Highlight></CodeLine>
<Link id="l04680" /><CodeLine lineNumber="4680"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LEV: Epilogue vectorization is disabled.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04681" /><CodeLine lineNumber="4681"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Result;</Highlight></CodeLine>
<Link id="l04682" /><CodeLine lineNumber="4682"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04683" /><CodeLine lineNumber="4683"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04684" /><CodeLine lineNumber="4684"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CM.isScalarEpilogueAllowed()) &#123;</Highlight></CodeLine>
<Link id="l04685" /><CodeLine lineNumber="4685"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LEV: Unable to vectorize epilogue because no &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04686" /><CodeLine lineNumber="4686"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;epilogue is allowed.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04687" /><CodeLine lineNumber="4687"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Result;</Highlight></CodeLine>
<Link id="l04688" /><CodeLine lineNumber="4688"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04689" /><CodeLine lineNumber="4689"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04690" /><CodeLine lineNumber="4690"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Not really a cost consideration, but check for unsupported cases here to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04691" /><CodeLine lineNumber="4691"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// simplify the logic.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04692" /><CodeLine lineNumber="4692"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!isCandidateForEpilogueVectorization(MainLoopVF)) &#123;</Highlight></CodeLine>
<Link id="l04693" /><CodeLine lineNumber="4693"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LEV: Unable to vectorize epilogue because the loop &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04694" /><CodeLine lineNumber="4694"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;is not a supported candidate.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04695" /><CodeLine lineNumber="4695"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Result;</Highlight></CodeLine>
<Link id="l04696" /><CodeLine lineNumber="4696"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04697" /><CodeLine lineNumber="4697"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04698" /><CodeLine lineNumber="4698"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a01340df86c9d26b281ff1ab9288c28ce">EpilogueVectorizationForceVF</a> &gt; 1) &#123;</Highlight></CodeLine>
<Link id="l04699" /><CodeLine lineNumber="4699"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LEV: Epilogue vectorization factor is forced.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04700" /><CodeLine lineNumber="4700"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> ForcedEC = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(<a href="#a01340df86c9d26b281ff1ab9288c28ce">EpilogueVectorizationForceVF</a>);</Highlight></CodeLine>
<Link id="l04701" /><CodeLine lineNumber="4701"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationplanner/#adce80172b05bc0a227fbd5e3d7bb80f2">hasPlanWithVF</a>(ForcedEC))</Highlight></CodeLine>
<Link id="l04702" /><CodeLine lineNumber="4702"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;ForcedEC, 0, 0&#125;;</Highlight></CodeLine>
<Link id="l04703" /><CodeLine lineNumber="4703"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04704" /><CodeLine lineNumber="4704"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LEV: Epilogue vectorization forced factor is not &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04705" /><CodeLine lineNumber="4705"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;viable.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04706" /><CodeLine lineNumber="4706"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Result;</Highlight></CodeLine>
<Link id="l04707" /><CodeLine lineNumber="4707"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04708" /><CodeLine lineNumber="4708"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04709" /><CodeLine lineNumber="4709"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OrigLoop-&gt;getHeader()-&gt;getParent()-&gt;hasOptSize() ||</Highlight></CodeLine>
<Link id="l04710" /><CodeLine lineNumber="4710"><Highlight kind="normal">      OrigLoop-&gt;getHeader()-&gt;getParent()-&gt;hasMinSize()) &#123;</Highlight></CodeLine>
<Link id="l04711" /><CodeLine lineNumber="4711"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l04712" /><CodeLine lineNumber="4712"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LEV: Epilogue vectorization skipped due to opt for size.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04713" /><CodeLine lineNumber="4713"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Result;</Highlight></CodeLine>
<Link id="l04714" /><CodeLine lineNumber="4714"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04715" /><CodeLine lineNumber="4715"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04716" /><CodeLine lineNumber="4716"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CM.isEpilogueVectorizationProfitable(MainLoopVF, IC)) &#123;</Highlight></CodeLine>
<Link id="l04717" /><CodeLine lineNumber="4717"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LEV: Epilogue vectorization is not profitable for &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04718" /><CodeLine lineNumber="4718"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;this loop\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04719" /><CodeLine lineNumber="4719"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Result;</Highlight></CodeLine>
<Link id="l04720" /><CodeLine lineNumber="4720"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04721" /><CodeLine lineNumber="4721"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04722" /><CodeLine lineNumber="4722"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If MainLoopVF = vscale x 2, and vscale is expected to be 4, then we know</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04723" /><CodeLine lineNumber="4723"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the main loop handles 8 lanes per iteration. We could still benefit from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04724" /><CodeLine lineNumber="4724"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vectorizing the epilogue loop with VF=4.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04725" /><CodeLine lineNumber="4725"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> EstimatedRuntimeVF =</Highlight></CodeLine>
<Link id="l04726" /><CodeLine lineNumber="4726"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(<a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a>(OrigLoop, TTI, MainLoopVF));</Highlight></CodeLine>
<Link id="l04727" /><CodeLine lineNumber="4727"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04728" /><CodeLine lineNumber="4728"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE = &#42;PSE.getSE();</Highlight></CodeLine>
<Link id="l04729" /><CodeLine lineNumber="4729"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;TCType = Legal-&gt;getWidestInductionType();</Highlight></CodeLine>
<Link id="l04730" /><CodeLine lineNumber="4730"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;RemainingIterations = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04731" /><CodeLine lineNumber="4731"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxTripCount = 0;</Highlight></CodeLine>
<Link id="l04732" /><CodeLine lineNumber="4732"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;NextVF : ProfitableVFs) &#123;</Highlight></CodeLine>
<Link id="l04733" /><CodeLine lineNumber="4733"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Skip candidate VFs without a corresponding VPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04734" /><CodeLine lineNumber="4734"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationplanner/#adce80172b05bc0a227fbd5e3d7bb80f2">hasPlanWithVF</a>(NextVF.Width))</Highlight></CodeLine>
<Link id="l04735" /><CodeLine lineNumber="4735"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04736" /><CodeLine lineNumber="4736"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04737" /><CodeLine lineNumber="4737"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Skip candidate VFs with widths &gt;= the (estimated) runtime VF (scalable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04738" /><CodeLine lineNumber="4738"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// vectors) or &gt; the VF of the main loop (fixed vectors).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04739" /><CodeLine lineNumber="4739"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((!NextVF.Width.isScalable() &amp;&amp; MainLoopVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l04740" /><CodeLine lineNumber="4740"><Highlight kind="normal">         <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#afb486f9022a26e1cc53ff189710dbde5">ElementCount::isKnownGE</a>(NextVF.Width, EstimatedRuntimeVF)) ||</Highlight></CodeLine>
<Link id="l04741" /><CodeLine lineNumber="4741"><Highlight kind="normal">        (NextVF.Width.isScalable() &amp;&amp;</Highlight></CodeLine>
<Link id="l04742" /><CodeLine lineNumber="4742"><Highlight kind="normal">         <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#afb486f9022a26e1cc53ff189710dbde5">ElementCount::isKnownGE</a>(NextVF.Width, MainLoopVF)) ||</Highlight></CodeLine>
<Link id="l04743" /><CodeLine lineNumber="4743"><Highlight kind="normal">        (!NextVF.Width.isScalable() &amp;&amp; !MainLoopVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l04744" /><CodeLine lineNumber="4744"><Highlight kind="normal">         <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#addaa86bfa4ca26b7f366cbdd868f99bf">ElementCount::isKnownGT</a>(NextVF.Width, MainLoopVF)))</Highlight></CodeLine>
<Link id="l04745" /><CodeLine lineNumber="4745"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04746" /><CodeLine lineNumber="4746"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04747" /><CodeLine lineNumber="4747"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If NextVF is greater than the number of remaining iterations, the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04748" /><CodeLine lineNumber="4748"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// epilogue loop would be dead. Skip such factors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04749" /><CodeLine lineNumber="4749"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MainLoopVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp; !NextVF.Width.isScalable()) &#123;</Highlight></CodeLine>
<Link id="l04750" /><CodeLine lineNumber="4750"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: extend to support scalable VFs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04751" /><CodeLine lineNumber="4751"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RemainingIterations) &#123;</Highlight></CodeLine>
<Link id="l04752" /><CodeLine lineNumber="4752"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;TC = <a href="/docs/api/namespaces/llvm/vputils/#a5999b0390c92ee4af2544fe9772454bf">vputils::getSCEVExprForVPValue</a>(</Highlight></CodeLine>
<Link id="l04753" /><CodeLine lineNumber="4753"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(NextVF.Width).<a href="/docs/api/classes/llvm/vplan/#a2f5fc19caa67daeca8a1316c7e055e3c">getTripCount</a>(), SE);</Highlight></CodeLine>
<Link id="l04754" /><CodeLine lineNumber="4754"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(TC) &amp;&amp;</Highlight></CodeLine>
<Link id="l04755" /><CodeLine lineNumber="4755"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;Trip count SCEV must be computable&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04756" /><CodeLine lineNumber="4756"><Highlight kind="normal">        RemainingIterations = SE.<a href="/docs/api/classes/llvm/scalarevolution/#a13b9eb961d35ad9ecb3b633f5703253a">getURemExpr</a>(</Highlight></CodeLine>
<Link id="l04757" /><CodeLine lineNumber="4757"><Highlight kind="normal">            TC, SE.<a href="/docs/api/classes/llvm/scalarevolution/#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(TCType, MainLoopVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42; IC));</Highlight></CodeLine>
<Link id="l04758" /><CodeLine lineNumber="4758"><Highlight kind="normal">        MaxTripCount = MainLoopVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42; IC - 1;</Highlight></CodeLine>
<Link id="l04759" /><CodeLine lineNumber="4759"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SE.<a href="/docs/api/classes/llvm/scalarevolution/#af74112dae88db73eb5484821b6f0fccd">isKnownPredicate</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">CmpInst::ICMP&#95;ULT</a>, RemainingIterations,</Highlight></CodeLine>
<Link id="l04760" /><CodeLine lineNumber="4760"><Highlight kind="normal">                                SE.<a href="/docs/api/classes/llvm/scalarevolution/#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(TCType, MaxTripCount))) &#123;</Highlight></CodeLine>
<Link id="l04761" /><CodeLine lineNumber="4761"><Highlight kind="normal">          MaxTripCount =</Highlight></CodeLine>
<Link id="l04762" /><CodeLine lineNumber="4762"><Highlight kind="normal">              SE.<a href="/docs/api/classes/llvm/scalarevolution/#ac8de32f4d40eae96f0e26f0728682c2e">getUnsignedRangeMax</a>(RemainingIterations).<a href="/docs/api/classes/llvm/apint/#a217e0207d9cc8e046c2dccbf0e4bb198">getZExtValue</a>();</Highlight></CodeLine>
<Link id="l04763" /><CodeLine lineNumber="4763"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l04764" /><CodeLine lineNumber="4764"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LEV: Maximum Trip Count for Epilogue: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04765" /><CodeLine lineNumber="4765"><Highlight kind="normal">                          &lt;&lt; MaxTripCount &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04766" /><CodeLine lineNumber="4766"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04767" /><CodeLine lineNumber="4767"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SE.<a href="/docs/api/classes/llvm/scalarevolution/#af74112dae88db73eb5484821b6f0fccd">isKnownPredicate</a>(</Highlight></CodeLine>
<Link id="l04768" /><CodeLine lineNumber="4768"><Highlight kind="normal">              <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba607cecdc5172814382033e001ed11fad">CmpInst::ICMP&#95;UGT</a>,</Highlight></CodeLine>
<Link id="l04769" /><CodeLine lineNumber="4769"><Highlight kind="normal">              SE.<a href="/docs/api/classes/llvm/scalarevolution/#a2eb94d079d8416118f4aaed865ab05d7">getConstant</a>(TCType, NextVF.Width.getKnownMinValue()),</Highlight></CodeLine>
<Link id="l04770" /><CodeLine lineNumber="4770"><Highlight kind="normal">              RemainingIterations))</Highlight></CodeLine>
<Link id="l04771" /><CodeLine lineNumber="4771"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04772" /><CodeLine lineNumber="4772"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04773" /><CodeLine lineNumber="4773"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04774" /><CodeLine lineNumber="4774"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Result.Width.isScalar() ||</Highlight></CodeLine>
<Link id="l04775" /><CodeLine lineNumber="4775"><Highlight kind="normal">        isMoreProfitable(NextVF, Result, MaxTripCount))</Highlight></CodeLine>
<Link id="l04776" /><CodeLine lineNumber="4776"><Highlight kind="normal">      Result = NextVF;</Highlight></CodeLine>
<Link id="l04777" /><CodeLine lineNumber="4777"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04778" /><CodeLine lineNumber="4778"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04779" /><CodeLine lineNumber="4779"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Result != <a href="/docs/api/structs/llvm/vectorizationfactor/#acd24dfdad4f887e1f7b10c9039a05930">VectorizationFactor::Disabled</a>())</Highlight></CodeLine>
<Link id="l04780" /><CodeLine lineNumber="4780"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LEV: Vectorizing epilogue loop with VF = &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04781" /><CodeLine lineNumber="4781"><Highlight kind="normal">                      &lt;&lt; Result.Width &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04782" /><CodeLine lineNumber="4782"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Result;</Highlight></CodeLine>
<Link id="l04783" /><CodeLine lineNumber="4783"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04784" /><CodeLine lineNumber="4784"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04785" /><CodeLine lineNumber="4785"><Highlight kind="normal">std::pair&lt;unsigned, unsigned&gt;</Highlight></CodeLine>
<Link id="l04786" /><CodeLine lineNumber="4786" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a1fa63b37ad2ac06f289e9962a3703e9e"><Highlight kind="normal"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a1fa63b37ad2ac06f289e9962a3703e9e">LoopVectorizationCostModel::getSmallestAndWidestTypes</a>() &#123;</Highlight></CodeLine>
<Link id="l04787" /><CodeLine lineNumber="4787"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MinWidth = -1U;</Highlight></CodeLine>
<Link id="l04788" /><CodeLine lineNumber="4788"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxWidth = 8;</Highlight></CodeLine>
<Link id="l04789" /><CodeLine lineNumber="4789"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/datalayout">DataLayout</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4384debcd154f44445005e6866afba4a">TheFunction</a>-&gt;getDataLayout();</Highlight></CodeLine>
<Link id="l04790" /><CodeLine lineNumber="4790"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For in-loop reductions, no element types are added to ElementTypesInLoop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04791" /><CodeLine lineNumber="4791"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// if there are no loads/stores in the loop. In this case, check through the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04792" /><CodeLine lineNumber="4792"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reduction variables to determine the maximum width.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04793" /><CodeLine lineNumber="4793"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a00a28a503636abdbedf080f3896b937c">ElementTypesInLoop</a>.empty() &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars().empty()) &#123;</Highlight></CodeLine>
<Link id="l04794" /><CodeLine lineNumber="4794"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Reset MaxWidth so that we can find the smallest type used by recurrences</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04795" /><CodeLine lineNumber="4795"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// in the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04796" /><CodeLine lineNumber="4796"><Highlight kind="normal">    MaxWidth = -1U;</Highlight></CodeLine>
<Link id="l04797" /><CodeLine lineNumber="4797"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;PhiDescriptorPair : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars()) &#123;</Highlight></CodeLine>
<Link id="l04798" /><CodeLine lineNumber="4798"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc = PhiDescriptorPair.second;</Highlight></CodeLine>
<Link id="l04799" /><CodeLine lineNumber="4799"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// When finding the min width used by the recurrence we need to account</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04800" /><CodeLine lineNumber="4800"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// for casts on the input operands of the recurrence.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04801" /><CodeLine lineNumber="4801"><Highlight kind="normal">      MaxWidth = std::min&lt;unsigned&gt;(</Highlight></CodeLine>
<Link id="l04802" /><CodeLine lineNumber="4802"><Highlight kind="normal">          MaxWidth, std::min&lt;unsigned&gt;(</Highlight></CodeLine>
<Link id="l04803" /><CodeLine lineNumber="4803"><Highlight kind="normal">                        RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a5f64b98dd7b1371ddda6c24bf2163be6">getMinWidthCastToRecurrenceTypeInBits</a>(),</Highlight></CodeLine>
<Link id="l04804" /><CodeLine lineNumber="4804"><Highlight kind="normal">                        RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>()));</Highlight></CodeLine>
<Link id="l04805" /><CodeLine lineNumber="4805"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04806" /><CodeLine lineNumber="4806"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l04807" /><CodeLine lineNumber="4807"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a00a28a503636abdbedf080f3896b937c">ElementTypesInLoop</a>) &#123;</Highlight></CodeLine>
<Link id="l04808" /><CodeLine lineNumber="4808"><Highlight kind="normal">      MinWidth = std::min&lt;unsigned&gt;(</Highlight></CodeLine>
<Link id="l04809" /><CodeLine lineNumber="4809"><Highlight kind="normal">          MinWidth, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;getScalarType()).getFixedValue());</Highlight></CodeLine>
<Link id="l04810" /><CodeLine lineNumber="4810"><Highlight kind="normal">      MaxWidth = std::max&lt;unsigned&gt;(</Highlight></CodeLine>
<Link id="l04811" /><CodeLine lineNumber="4811"><Highlight kind="normal">          MaxWidth, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getTypeSizeInBits(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;getScalarType()).getFixedValue());</Highlight></CodeLine>
<Link id="l04812" /><CodeLine lineNumber="4812"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04813" /><CodeLine lineNumber="4813"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04814" /><CodeLine lineNumber="4814"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;MinWidth, MaxWidth&#125;;</Highlight></CodeLine>
<Link id="l04815" /><CodeLine lineNumber="4815"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04816" /><CodeLine lineNumber="4816"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04817" /><CodeLine lineNumber="4817" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a06f5d9725a2b1f7b06e8bf51f7d31417"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a06f5d9725a2b1f7b06e8bf51f7d31417">LoopVectorizationCostModel::collectElementTypesForWidening</a>() &#123;</Highlight></CodeLine>
<Link id="l04818" /><CodeLine lineNumber="4818"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a00a28a503636abdbedf080f3896b937c">ElementTypesInLoop</a>.clear();</Highlight></CodeLine>
<Link id="l04819" /><CodeLine lineNumber="4819"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For each block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04820" /><CodeLine lineNumber="4820"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks()) &#123;</Highlight></CodeLine>
<Link id="l04821" /><CodeLine lineNumber="4821"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For each instruction in the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04822" /><CodeLine lineNumber="4822"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB-&gt;instructionsWithoutDebug()) &#123;</Highlight></CodeLine>
<Link id="l04823" /><CodeLine lineNumber="4823"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getType();</Highlight></CodeLine>
<Link id="l04824" /><CodeLine lineNumber="4824"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04825" /><CodeLine lineNumber="4825"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Skip ignored values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04826" /><CodeLine lineNumber="4826"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>.count(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l04827" /><CodeLine lineNumber="4827"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04828" /><CodeLine lineNumber="4828"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04829" /><CodeLine lineNumber="4829"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Only examine Loads, Stores and PHINodes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04830" /><CodeLine lineNumber="4830"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l04831" /><CodeLine lineNumber="4831"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04832" /><CodeLine lineNumber="4832"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04833" /><CodeLine lineNumber="4833"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Examine PHI nodes that are reduction variables. Update the type to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04834" /><CodeLine lineNumber="4834"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// account for the recurrence type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04835" /><CodeLine lineNumber="4835"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l04836" /><CodeLine lineNumber="4836"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isReductionVariable(PN))</Highlight></CodeLine>
<Link id="l04837" /><CodeLine lineNumber="4837"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04838" /><CodeLine lineNumber="4838"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc =</Highlight></CodeLine>
<Link id="l04839" /><CodeLine lineNumber="4839"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars().find(PN)-&gt;second;</Highlight></CodeLine>
<Link id="l04840" /><CodeLine lineNumber="4840"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a96ef6bd4742763bf1b85aaf1a4150620">PreferInLoopReductions</a> || <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad508b8cfa31c0e7a1ac8f9d733bb8eed">useOrderedReductions</a>(RdxDesc) ||</Highlight></CodeLine>
<Link id="l04841" /><CodeLine lineNumber="4841"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.preferInLoopReduction(RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a30ee597b72598bc7939d3a40d2a5ba20">getOpcode</a>(),</Highlight></CodeLine>
<Link id="l04842" /><CodeLine lineNumber="4842"><Highlight kind="normal">                                      RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>(),</Highlight></CodeLine>
<Link id="l04843" /><CodeLine lineNumber="4843"><Highlight kind="normal">                                      <a href="/docs/api/structs/llvm/targettransforminfo/reductionflags">TargetTransformInfo::ReductionFlags</a>()))</Highlight></CodeLine>
<Link id="l04844" /><CodeLine lineNumber="4844"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l04845" /><CodeLine lineNumber="4845"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>();</Highlight></CodeLine>
<Link id="l04846" /><CodeLine lineNumber="4846"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l04847" /><CodeLine lineNumber="4847"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04848" /><CodeLine lineNumber="4848"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Examine the stored values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04849" /><CodeLine lineNumber="4849"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ST = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l04850" /><CodeLine lineNumber="4850"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a> = ST-&gt;getValueOperand()-&gt;getType();</Highlight></CodeLine>
<Link id="l04851" /><CodeLine lineNumber="4851"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04852" /><CodeLine lineNumber="4852"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>-&gt;isSized() &amp;&amp;</Highlight></CodeLine>
<Link id="l04853" /><CodeLine lineNumber="4853"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Expected the load/store/recurrence type to be sized&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04854" /><CodeLine lineNumber="4854"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04855" /><CodeLine lineNumber="4855"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a00a28a503636abdbedf080f3896b937c">ElementTypesInLoop</a>.insert(<a href="/docs/api/files/lib/lib/target/lib/target/mips/mips16isellowering-cpp/#a0acb682b8260ab1c60b918599864e2e5">T</a>);</Highlight></CodeLine>
<Link id="l04856" /><CodeLine lineNumber="4856"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04857" /><CodeLine lineNumber="4857"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04858" /><CodeLine lineNumber="4858"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l04859" /><CodeLine lineNumber="4859"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04860" /><CodeLine lineNumber="4860"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04861" /><CodeLine lineNumber="4861" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#af9f62350ccdebd24858be552f3fc051c"><Highlight kind="normal"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af9f62350ccdebd24858be552f3fc051c">LoopVectorizationCostModel::selectInterleaveCount</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF,</Highlight></CodeLine>
<Link id="l04862" /><CodeLine lineNumber="4862"><Highlight kind="normal">                                                  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> LoopCost) &#123;</Highlight></CodeLine>
<Link id="l04863" /><CodeLine lineNumber="4863"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// -- The interleave heuristics --</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04864" /><CodeLine lineNumber="4864"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We interleave the loop in order to expose ILP and reduce the loop overhead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04865" /><CodeLine lineNumber="4865"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// There are many micro-architectural considerations that we can&#39;t predict</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04866" /><CodeLine lineNumber="4866"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// at this level. For example, frontend pressure (on decode or fetch) due to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04867" /><CodeLine lineNumber="4867"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// code size, or the number and capabilities of the execution ports.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04868" /><CodeLine lineNumber="4868"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04869" /><CodeLine lineNumber="4869"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We use the following heuristics to select the interleave count:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04870" /><CodeLine lineNumber="4870"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 1 If the code has reductions, then we interleave to break the cross</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04871" /><CodeLine lineNumber="4871"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// iteration dependency.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04872" /><CodeLine lineNumber="4872"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 2 If the loop is really small, then we interleave to reduce the loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04873" /><CodeLine lineNumber="4873"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// overhead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04874" /><CodeLine lineNumber="4874"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 3 We don&#39;t interleave if we think that we will spill registers to memory</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04875" /><CodeLine lineNumber="4875"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// due to the increased register pressure.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04876" /><CodeLine lineNumber="4876"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04877" /><CodeLine lineNumber="4877"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af67062c22dbf5e0ab35164a778768476">isScalarEpilogueAllowed</a>())</Highlight></CodeLine>
<Link id="l04878" /><CodeLine lineNumber="4878"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 1;</Highlight></CodeLine>
<Link id="l04879" /><CodeLine lineNumber="4879"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04880" /><CodeLine lineNumber="4880"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do not interleave if EVL is preferred and no User IC is specified.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04881" /><CodeLine lineNumber="4881"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab0c7e793ca1b6b8a4f8c00a1bc1cb32f">foldTailWithEVL</a>()) &#123;</Highlight></CodeLine>
<Link id="l04882" /><CodeLine lineNumber="4882"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Preference for VP intrinsics indicated. &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04883" /><CodeLine lineNumber="4883"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;Unroll factor forced to be 1.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04884" /><CodeLine lineNumber="4884"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 1;</Highlight></CodeLine>
<Link id="l04885" /><CodeLine lineNumber="4885"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04886" /><CodeLine lineNumber="4886"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04887" /><CodeLine lineNumber="4887"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We used the distance for the interleave count.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04888" /><CodeLine lineNumber="4888"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isSafeForAnyVectorWidth())</Highlight></CodeLine>
<Link id="l04889" /><CodeLine lineNumber="4889"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 1;</Highlight></CodeLine>
<Link id="l04890" /><CodeLine lineNumber="4890"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04891" /><CodeLine lineNumber="4891"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We don&#39;t attempt to perform interleaving for loops with uncountable early</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04892" /><CodeLine lineNumber="4892"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// exits because the VPInstruction::AnyOf code cannot currently handle</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04893" /><CodeLine lineNumber="4893"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// multiple parts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04894" /><CodeLine lineNumber="4894"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;hasUncountableEarlyExit())</Highlight></CodeLine>
<Link id="l04895" /><CodeLine lineNumber="4895"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 1;</Highlight></CodeLine>
<Link id="l04896" /><CodeLine lineNumber="4896"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04897" /><CodeLine lineNumber="4897"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> BestKnownTC = <a href="#a84375e6536d9214c7895013078055aff">getSmallBestKnownTC</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l04898" /><CodeLine lineNumber="4898"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasReductions = !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars().empty();</Highlight></CodeLine>
<Link id="l04899" /><CodeLine lineNumber="4899"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04900" /><CodeLine lineNumber="4900"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we did not calculate the cost for VF (because the user selected the VF)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04901" /><CodeLine lineNumber="4901"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// then we calculate the cost of VF here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04902" /><CodeLine lineNumber="4902"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LoopCost == 0) &#123;</Highlight></CodeLine>
<Link id="l04903" /><CodeLine lineNumber="4903"><Highlight kind="normal">    LoopCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae4c50e6300599d50ba706c0d2b780502">expectedCost</a>(VF);</Highlight></CodeLine>
<Link id="l04904" /><CodeLine lineNumber="4904"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LoopCost.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected to have chosen a VF with valid cost&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04905" /><CodeLine lineNumber="4905"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04906" /><CodeLine lineNumber="4906"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Loop body is free and there is no need for interleaving.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04907" /><CodeLine lineNumber="4907"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LoopCost == 0)</Highlight></CodeLine>
<Link id="l04908" /><CodeLine lineNumber="4908"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 1;</Highlight></CodeLine>
<Link id="l04909" /><CodeLine lineNumber="4909"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04910" /><CodeLine lineNumber="4910"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04911" /><CodeLine lineNumber="4911"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage">RegisterUsage</a> R = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91466f7a82e967ed765e6d876415a3b7">calculateRegisterUsage</a>(&#123;VF&#125;)&#91;0&#93;;</Highlight></CodeLine>
<Link id="l04912" /><CodeLine lineNumber="4912"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We divide by these constants so assume that we have at least one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04913" /><CodeLine lineNumber="4913"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction that uses at least one register.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04914" /><CodeLine lineNumber="4914"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Pair : R.MaxLocalUsers) &#123;</Highlight></CodeLine>
<Link id="l04915" /><CodeLine lineNumber="4915"><Highlight kind="normal">    Pair.second = std::max(Pair.second, 1U);</Highlight></CodeLine>
<Link id="l04916" /><CodeLine lineNumber="4916"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04917" /><CodeLine lineNumber="4917"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04918" /><CodeLine lineNumber="4918"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We calculate the interleave count using the following formula.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04919" /><CodeLine lineNumber="4919"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Subtract the number of loop invariants from the number of available</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04920" /><CodeLine lineNumber="4920"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// registers. These registers are used by all of the interleaved instances.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04921" /><CodeLine lineNumber="4921"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Next, divide the remaining registers by the number of registers that is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04922" /><CodeLine lineNumber="4922"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// required by the loop, in order to estimate how many parallel instances</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04923" /><CodeLine lineNumber="4923"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// fit without causing spills. All of this is rounded down if necessary to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04924" /><CodeLine lineNumber="4924"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// a power of two. We want power of two interleave count to simplify any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04925" /><CodeLine lineNumber="4925"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// addressing operations or alignment considerations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04926" /><CodeLine lineNumber="4926"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We also want power of two interleave counts to ensure that the induction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04927" /><CodeLine lineNumber="4927"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// variable of the vector loop wraps to zero, when tail is folded by masking;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04928" /><CodeLine lineNumber="4928"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// this currently happens when OptForSize, in which case IC is set to 1 above.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04929" /><CodeLine lineNumber="4929"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IC = UINT&#95;MAX;</Highlight></CodeLine>
<Link id="l04930" /><CodeLine lineNumber="4930"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04931" /><CodeLine lineNumber="4931"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Pair : R.MaxLocalUsers) &#123;</Highlight></CodeLine>
<Link id="l04932" /><CodeLine lineNumber="4932"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> TargetNumRegisters = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getNumberOfRegisters(Pair.first);</Highlight></CodeLine>
<Link id="l04933" /><CodeLine lineNumber="4933"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: The target has &quot;</Highlight><Highlight kind="normal"> &lt;&lt; TargetNumRegisters</Highlight></CodeLine>
<Link id="l04934" /><CodeLine lineNumber="4934"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; registers of &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04935" /><CodeLine lineNumber="4935"><Highlight kind="normal">                      &lt;&lt; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getRegisterClassName(Pair.first)</Highlight></CodeLine>
<Link id="l04936" /><CodeLine lineNumber="4936"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; register class\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l04937" /><CodeLine lineNumber="4937"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>()) &#123;</Highlight></CodeLine>
<Link id="l04938" /><CodeLine lineNumber="4938"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a62baadf3a5bf03eddf58bf048724acb1">ForceTargetNumScalarRegs</a>.getNumOccurrences() &gt; 0)</Highlight></CodeLine>
<Link id="l04939" /><CodeLine lineNumber="4939"><Highlight kind="normal">        TargetNumRegisters = <a href="#a62baadf3a5bf03eddf58bf048724acb1">ForceTargetNumScalarRegs</a>;</Highlight></CodeLine>
<Link id="l04940" /><CodeLine lineNumber="4940"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l04941" /><CodeLine lineNumber="4941"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a7d952aa72676eecd8065aa2c29ea458c">ForceTargetNumVectorRegs</a>.getNumOccurrences() &gt; 0)</Highlight></CodeLine>
<Link id="l04942" /><CodeLine lineNumber="4942"><Highlight kind="normal">        TargetNumRegisters = <a href="#a7d952aa72676eecd8065aa2c29ea458c">ForceTargetNumVectorRegs</a>;</Highlight></CodeLine>
<Link id="l04943" /><CodeLine lineNumber="4943"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04944" /><CodeLine lineNumber="4944"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxLocalUsers = Pair.second;</Highlight></CodeLine>
<Link id="l04945" /><CodeLine lineNumber="4945"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> LoopInvariantRegs = 0;</Highlight></CodeLine>
<Link id="l04946" /><CodeLine lineNumber="4946"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (R.LoopInvariantRegs.find(Pair.first) != R.LoopInvariantRegs.end())</Highlight></CodeLine>
<Link id="l04947" /><CodeLine lineNumber="4947"><Highlight kind="normal">      LoopInvariantRegs = R.LoopInvariantRegs&#91;Pair.first&#93;;</Highlight></CodeLine>
<Link id="l04948" /><CodeLine lineNumber="4948"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04949" /><CodeLine lineNumber="4949"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> TmpIC = <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">llvm::bit&#95;floor</a>((TargetNumRegisters - LoopInvariantRegs) /</Highlight></CodeLine>
<Link id="l04950" /><CodeLine lineNumber="4950"><Highlight kind="normal">                                     MaxLocalUsers);</Highlight></CodeLine>
<Link id="l04951" /><CodeLine lineNumber="4951"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Don&#39;t count the induction variable as interleaved.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04952" /><CodeLine lineNumber="4952"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a8122656ed2c776067b43d9ae34ccecb6">EnableIndVarRegisterHeur</a>) &#123;</Highlight></CodeLine>
<Link id="l04953" /><CodeLine lineNumber="4953"><Highlight kind="normal">      TmpIC = <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">llvm::bit&#95;floor</a>((TargetNumRegisters - LoopInvariantRegs - 1) /</Highlight></CodeLine>
<Link id="l04954" /><CodeLine lineNumber="4954"><Highlight kind="normal">                              std::max(1U, (MaxLocalUsers - 1)));</Highlight></CodeLine>
<Link id="l04955" /><CodeLine lineNumber="4955"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l04956" /><CodeLine lineNumber="4956"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04957" /><CodeLine lineNumber="4957"><Highlight kind="normal">    IC = std::min(IC, TmpIC);</Highlight></CodeLine>
<Link id="l04958" /><CodeLine lineNumber="4958"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04959" /><CodeLine lineNumber="4959"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04960" /><CodeLine lineNumber="4960"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Clamp the interleave ranges to reasonable counts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04961" /><CodeLine lineNumber="4961"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MaxInterleaveCount = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMaxInterleaveFactor(VF);</Highlight></CodeLine>
<Link id="l04962" /><CodeLine lineNumber="4962"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04963" /><CodeLine lineNumber="4963"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if the user has overridden the max.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04964" /><CodeLine lineNumber="4964"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>()) &#123;</Highlight></CodeLine>
<Link id="l04965" /><CodeLine lineNumber="4965"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#aee1082071c43958a6ef5e6e9f665ae4a">ForceTargetMaxScalarInterleaveFactor</a>.getNumOccurrences() &gt; 0)</Highlight></CodeLine>
<Link id="l04966" /><CodeLine lineNumber="4966"><Highlight kind="normal">      MaxInterleaveCount = <a href="#aee1082071c43958a6ef5e6e9f665ae4a">ForceTargetMaxScalarInterleaveFactor</a>;</Highlight></CodeLine>
<Link id="l04967" /><CodeLine lineNumber="4967"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l04968" /><CodeLine lineNumber="4968"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#ade5aad46b91dc51c831acf1e69ee9863">ForceTargetMaxVectorInterleaveFactor</a>.getNumOccurrences() &gt; 0)</Highlight></CodeLine>
<Link id="l04969" /><CodeLine lineNumber="4969"><Highlight kind="normal">      MaxInterleaveCount = <a href="#ade5aad46b91dc51c831acf1e69ee9863">ForceTargetMaxVectorInterleaveFactor</a>;</Highlight></CodeLine>
<Link id="l04970" /><CodeLine lineNumber="4970"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l04971" /><CodeLine lineNumber="4971"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04972" /><CodeLine lineNumber="4972"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> EstimatedVF = <a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>, VF);</Highlight></CodeLine>
<Link id="l04973" /><CodeLine lineNumber="4973"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> KnownTC = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE()-&gt;getSmallConstantTripCount(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l04974" /><CodeLine lineNumber="4974"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (KnownTC &gt; 0) &#123;</Highlight></CodeLine>
<Link id="l04975" /><CodeLine lineNumber="4975"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// At least one iteration must be scalar when this constraint holds. So the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04976" /><CodeLine lineNumber="4976"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// maximum available iterations for interleaving is one less.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04977" /><CodeLine lineNumber="4977"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AvailableTC =</Highlight></CodeLine>
<Link id="l04978" /><CodeLine lineNumber="4978"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a913ab9c8291000dd3a1c3739194b03e4">requiresScalarEpilogue</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()) ? KnownTC - 1 : KnownTC;</Highlight></CodeLine>
<Link id="l04979" /><CodeLine lineNumber="4979"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04980" /><CodeLine lineNumber="4980"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If trip count is known we select between two prospective ICs, where</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04981" /><CodeLine lineNumber="4981"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// 1) the aggressive IC is capped by the trip count divided by VF</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04982" /><CodeLine lineNumber="4982"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// 2) the conservative IC is capped by the trip count divided by (VF &#42; 2)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04983" /><CodeLine lineNumber="4983"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The final IC is selected in a way that the epilogue loop trip count is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04984" /><CodeLine lineNumber="4984"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// minimized while maximizing the IC itself, so that we either run the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04985" /><CodeLine lineNumber="4985"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// vector loop at least once if it generates a small epilogue loop, or else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04986" /><CodeLine lineNumber="4986"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we run the vector loop at least twice.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04987" /><CodeLine lineNumber="4987"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04988" /><CodeLine lineNumber="4988"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> InterleaveCountUB = <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">bit&#95;floor</a>(</Highlight></CodeLine>
<Link id="l04989" /><CodeLine lineNumber="4989"><Highlight kind="normal">        std::max(1u, std::min(AvailableTC / EstimatedVF, MaxInterleaveCount)));</Highlight></CodeLine>
<Link id="l04990" /><CodeLine lineNumber="4990"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> InterleaveCountLB = <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">bit&#95;floor</a>(std::max(</Highlight></CodeLine>
<Link id="l04991" /><CodeLine lineNumber="4991"><Highlight kind="normal">        1u, std::min(AvailableTC / (EstimatedVF &#42; 2), MaxInterleaveCount)));</Highlight></CodeLine>
<Link id="l04992" /><CodeLine lineNumber="4992"><Highlight kind="normal">    MaxInterleaveCount = InterleaveCountLB;</Highlight></CodeLine>
<Link id="l04993" /><CodeLine lineNumber="4993"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l04994" /><CodeLine lineNumber="4994"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InterleaveCountUB != InterleaveCountLB) &#123;</Highlight></CodeLine>
<Link id="l04995" /><CodeLine lineNumber="4995"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> TailTripCountUB =</Highlight></CodeLine>
<Link id="l04996" /><CodeLine lineNumber="4996"><Highlight kind="normal">          (AvailableTC % (EstimatedVF &#42; InterleaveCountUB));</Highlight></CodeLine>
<Link id="l04997" /><CodeLine lineNumber="4997"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> TailTripCountLB =</Highlight></CodeLine>
<Link id="l04998" /><CodeLine lineNumber="4998"><Highlight kind="normal">          (AvailableTC % (EstimatedVF &#42; InterleaveCountLB));</Highlight></CodeLine>
<Link id="l04999" /><CodeLine lineNumber="4999"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If both produce same scalar tail, maximize the IC to do the same work</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05000" /><CodeLine lineNumber="5000"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// in fewer vector loop iterations</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05001" /><CodeLine lineNumber="5001"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (TailTripCountUB == TailTripCountLB)</Highlight></CodeLine>
<Link id="l05002" /><CodeLine lineNumber="5002"><Highlight kind="normal">        MaxInterleaveCount = InterleaveCountUB;</Highlight></CodeLine>
<Link id="l05003" /><CodeLine lineNumber="5003"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05004" /><CodeLine lineNumber="5004"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BestKnownTC &amp;&amp; &#42;BestKnownTC &gt; 0) &#123;</Highlight></CodeLine>
<Link id="l05005" /><CodeLine lineNumber="5005"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// At least one iteration must be scalar when this constraint holds. So the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05006" /><CodeLine lineNumber="5006"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// maximum available iterations for interleaving is one less.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05007" /><CodeLine lineNumber="5007"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AvailableTC = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a913ab9c8291000dd3a1c3739194b03e4">requiresScalarEpilogue</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>())</Highlight></CodeLine>
<Link id="l05008" /><CodeLine lineNumber="5008"><Highlight kind="normal">                               ? (&#42;BestKnownTC) - 1</Highlight></CodeLine>
<Link id="l05009" /><CodeLine lineNumber="5009"><Highlight kind="normal">                               : &#42;BestKnownTC;</Highlight></CodeLine>
<Link id="l05010" /><CodeLine lineNumber="5010"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05011" /><CodeLine lineNumber="5011"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If trip count is an estimated compile time constant, limit the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05012" /><CodeLine lineNumber="5012"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// IC to be capped by the trip count divided by VF &#42; 2, such that the vector</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05013" /><CodeLine lineNumber="5013"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// loop runs at least twice to make interleaving seem profitable when there</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05014" /><CodeLine lineNumber="5014"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is an epilogue loop present. Since exact Trip count is not known we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05015" /><CodeLine lineNumber="5015"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// choose to be conservative in our IC estimate.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05016" /><CodeLine lineNumber="5016"><Highlight kind="normal">    MaxInterleaveCount = <a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">bit&#95;floor</a>(std::max(</Highlight></CodeLine>
<Link id="l05017" /><CodeLine lineNumber="5017"><Highlight kind="normal">        1u, std::min(AvailableTC / (EstimatedVF &#42; 2), MaxInterleaveCount)));</Highlight></CodeLine>
<Link id="l05018" /><CodeLine lineNumber="5018"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05019" /><CodeLine lineNumber="5019"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05020" /><CodeLine lineNumber="5020"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(MaxInterleaveCount &gt; 0 &amp;&amp;</Highlight></CodeLine>
<Link id="l05021" /><CodeLine lineNumber="5021"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Maximum interleave count must be greater than 0&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05022" /><CodeLine lineNumber="5022"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05023" /><CodeLine lineNumber="5023"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Clamp the calculated IC to be between the 1 and the max interleave count</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05024" /><CodeLine lineNumber="5024"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that the target and trip count allows.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05025" /><CodeLine lineNumber="5025"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IC &gt; MaxInterleaveCount)</Highlight></CodeLine>
<Link id="l05026" /><CodeLine lineNumber="5026"><Highlight kind="normal">    IC = MaxInterleaveCount;</Highlight></CodeLine>
<Link id="l05027" /><CodeLine lineNumber="5027"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05028" /><CodeLine lineNumber="5028"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Make sure IC is greater than 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05029" /><CodeLine lineNumber="5029"><Highlight kind="normal">    IC = std::max(1u, IC);</Highlight></CodeLine>
<Link id="l05030" /><CodeLine lineNumber="5030"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05031" /><CodeLine lineNumber="5031"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IC &gt; 0 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Interleave count must be greater than 0.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05032" /><CodeLine lineNumber="5032"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05033" /><CodeLine lineNumber="5033"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Interleave if we vectorized this loop and there is a reduction that could</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05034" /><CodeLine lineNumber="5034"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// benefit from interleaving.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05035" /><CodeLine lineNumber="5035"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; HasReductions) &#123;</Highlight></CodeLine>
<Link id="l05036" /><CodeLine lineNumber="5036"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Interleaving because of reductions.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05037" /><CodeLine lineNumber="5037"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> IC;</Highlight></CodeLine>
<Link id="l05038" /><CodeLine lineNumber="5038"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05039" /><CodeLine lineNumber="5039"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05040" /><CodeLine lineNumber="5040"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For any scalar loop that either requires runtime checks or predication we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05041" /><CodeLine lineNumber="5041"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// are better off leaving this to the unroller. Note that if we&#39;ve already</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05042" /><CodeLine lineNumber="5042"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vectorized the loop we will have done the runtime check and so interleaving</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05043" /><CodeLine lineNumber="5043"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// won&#39;t require further checks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05044" /><CodeLine lineNumber="5044"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ScalarInterleavingRequiresPredication =</Highlight></CodeLine>
<Link id="l05045" /><CodeLine lineNumber="5045"><Highlight kind="normal">      (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks(), &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l05046" /><CodeLine lineNumber="5046"><Highlight kind="normal">         return Legal-&gt;blockNeedsPredication(BB);</Highlight></CodeLine>
<Link id="l05047" /><CodeLine lineNumber="5047"><Highlight kind="normal">       &#125;));</Highlight></CodeLine>
<Link id="l05048" /><CodeLine lineNumber="5048"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ScalarInterleavingRequiresRuntimePointerCheck =</Highlight></CodeLine>
<Link id="l05049" /><CodeLine lineNumber="5049"><Highlight kind="normal">      (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getRuntimePointerChecking()-&gt;Need);</Highlight></CodeLine>
<Link id="l05050" /><CodeLine lineNumber="5050"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05051" /><CodeLine lineNumber="5051"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We want to interleave small loops in order to reduce the loop overhead and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05052" /><CodeLine lineNumber="5052"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// potentially expose ILP opportunities.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05053" /><CodeLine lineNumber="5053"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Loop cost is &quot;</Highlight><Highlight kind="normal"> &lt;&lt; LoopCost &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05054" /><CodeLine lineNumber="5054"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: IC is &quot;</Highlight><Highlight kind="normal"> &lt;&lt; IC &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05055" /><CodeLine lineNumber="5055"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: VF is &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05056" /><CodeLine lineNumber="5056"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AggressivelyInterleaveReductions =</Highlight></CodeLine>
<Link id="l05057" /><CodeLine lineNumber="5057"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.enableAggressiveInterleaving(HasReductions);</Highlight></CodeLine>
<Link id="l05058" /><CodeLine lineNumber="5058"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ScalarInterleavingRequiresRuntimePointerCheck &amp;&amp;</Highlight></CodeLine>
<Link id="l05059" /><CodeLine lineNumber="5059"><Highlight kind="normal">      !ScalarInterleavingRequiresPredication &amp;&amp; LoopCost &lt; <a href="#a71899f6c73fcc8e2fc977dadc1fb1520">SmallLoopCost</a>) &#123;</Highlight></CodeLine>
<Link id="l05060" /><CodeLine lineNumber="5060"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We assume that the cost overhead is 1 and we use the cost model</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05061" /><CodeLine lineNumber="5061"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to estimate the cost of the loop and interleave until the cost of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05062" /><CodeLine lineNumber="5062"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// loop overhead is about 5% of the cost of the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05063" /><CodeLine lineNumber="5063"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SmallIC = std::min(IC, (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal">)<a href="/docs/api/namespaces/llvm/#ae22967d11b695d268992470debfae4b2">llvm::bit&#95;floor&lt;uint64&#95;t&gt;</a>(</Highlight></CodeLine>
<Link id="l05064" /><CodeLine lineNumber="5064"><Highlight kind="normal">                                        <a href="#a71899f6c73fcc8e2fc977dadc1fb1520">SmallLoopCost</a> / &#42;LoopCost.<a href="/docs/api/classes/llvm/instructioncost/#a9b642067999075ba996ecdee40b52b68">getValue</a>()));</Highlight></CodeLine>
<Link id="l05065" /><CodeLine lineNumber="5065"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05066" /><CodeLine lineNumber="5066"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Interleave until store/load ports (estimated by max interleave count) are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05067" /><CodeLine lineNumber="5067"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// saturated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05068" /><CodeLine lineNumber="5068"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumStores = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getNumStores();</Highlight></CodeLine>
<Link id="l05069" /><CodeLine lineNumber="5069"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumLoads = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getNumLoads();</Highlight></CodeLine>
<Link id="l05070" /><CodeLine lineNumber="5070"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> StoresIC = IC / (NumStores ? NumStores : 1);</Highlight></CodeLine>
<Link id="l05071" /><CodeLine lineNumber="5071"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> LoadsIC = IC / (NumLoads ? NumLoads : 1);</Highlight></CodeLine>
<Link id="l05072" /><CodeLine lineNumber="5072"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05073" /><CodeLine lineNumber="5073"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// There is little point in interleaving for reductions containing selects</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05074" /><CodeLine lineNumber="5074"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// and compares when VF=1 since it may just create more overhead than it&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05075" /><CodeLine lineNumber="5075"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// worth for loops with small trip counts. This is because we still have to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05076" /><CodeLine lineNumber="5076"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// do the final reduction after the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05077" /><CodeLine lineNumber="5077"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasSelectCmpReductions =</Highlight></CodeLine>
<Link id="l05078" /><CodeLine lineNumber="5078"><Highlight kind="normal">        HasReductions &amp;&amp;</Highlight></CodeLine>
<Link id="l05079" /><CodeLine lineNumber="5079"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars(), &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05080" /><CodeLine lineNumber="5080"><Highlight kind="normal">          const RecurrenceDescriptor &amp;RdxDesc = Reduction.second;</Highlight></CodeLine>
<Link id="l05081" /><CodeLine lineNumber="5081"><Highlight kind="normal">          RecurKind RK = RdxDesc.getRecurrenceKind();</Highlight></CodeLine>
<Link id="l05082" /><CodeLine lineNumber="5082"><Highlight kind="normal">          return RecurrenceDescriptor::isAnyOfRecurrenceKind(RK) ||</Highlight></CodeLine>
<Link id="l05083" /><CodeLine lineNumber="5083"><Highlight kind="normal">                 RecurrenceDescriptor::isFindLastIVRecurrenceKind(RK);</Highlight></CodeLine>
<Link id="l05084" /><CodeLine lineNumber="5084"><Highlight kind="normal">        &#125;);</Highlight></CodeLine>
<Link id="l05085" /><CodeLine lineNumber="5085"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasSelectCmpReductions) &#123;</Highlight></CodeLine>
<Link id="l05086" /><CodeLine lineNumber="5086"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Not interleaving select-cmp reductions.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05087" /><CodeLine lineNumber="5087"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 1;</Highlight></CodeLine>
<Link id="l05088" /><CodeLine lineNumber="5088"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05089" /><CodeLine lineNumber="5089"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05090" /><CodeLine lineNumber="5090"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we have a scalar reduction (vector reductions are already dealt with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05091" /><CodeLine lineNumber="5091"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// by this point), we can increase the critical path length if the loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05092" /><CodeLine lineNumber="5092"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// we&#39;re interleaving is inside another loop. For tree-wise reductions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05093" /><CodeLine lineNumber="5093"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// set the limit to 2, and for ordered reductions it&#39;s best to disable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05094" /><CodeLine lineNumber="5094"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// interleaving entirely.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05095" /><CodeLine lineNumber="5095"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasReductions &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getLoopDepth() &gt; 1) &#123;</Highlight></CodeLine>
<Link id="l05096" /><CodeLine lineNumber="5096"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasOrderedReductions =</Highlight></CodeLine>
<Link id="l05097" /><CodeLine lineNumber="5097"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars(), &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05098" /><CodeLine lineNumber="5098"><Highlight kind="normal">            const RecurrenceDescriptor &amp;RdxDesc = Reduction.second;</Highlight></CodeLine>
<Link id="l05099" /><CodeLine lineNumber="5099"><Highlight kind="normal">            return RdxDesc.isOrdered();</Highlight></CodeLine>
<Link id="l05100" /><CodeLine lineNumber="5100"><Highlight kind="normal">          &#125;);</Highlight></CodeLine>
<Link id="l05101" /><CodeLine lineNumber="5101"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HasOrderedReductions) &#123;</Highlight></CodeLine>
<Link id="l05102" /><CodeLine lineNumber="5102"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l05103" /><CodeLine lineNumber="5103"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Not interleaving scalar ordered reductions.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05104" /><CodeLine lineNumber="5104"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 1;</Highlight></CodeLine>
<Link id="l05105" /><CodeLine lineNumber="5105"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05106" /><CodeLine lineNumber="5106"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05107" /><CodeLine lineNumber="5107"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(<a href="#ae75965df4671fa34c6ffc5a6e404843a">MaxNestedScalarReductionIC</a>);</Highlight></CodeLine>
<Link id="l05108" /><CodeLine lineNumber="5108"><Highlight kind="normal">      SmallIC = std::min(SmallIC, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05109" /><CodeLine lineNumber="5109"><Highlight kind="normal">      StoresIC = std::min(StoresIC, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05110" /><CodeLine lineNumber="5110"><Highlight kind="normal">      LoadsIC = std::min(LoadsIC, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l05111" /><CodeLine lineNumber="5111"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05112" /><CodeLine lineNumber="5112"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05113" /><CodeLine lineNumber="5113"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a99a396adb2c0f9fb93b7ff8ea8b2e2ef">EnableLoadStoreRuntimeInterleave</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l05114" /><CodeLine lineNumber="5114"><Highlight kind="normal">        std::max(StoresIC, LoadsIC) &gt; SmallIC) &#123;</Highlight></CodeLine>
<Link id="l05115" /><CodeLine lineNumber="5115"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l05116" /><CodeLine lineNumber="5116"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Interleaving to saturate store or load ports.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05117" /><CodeLine lineNumber="5117"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::max(StoresIC, LoadsIC);</Highlight></CodeLine>
<Link id="l05118" /><CodeLine lineNumber="5118"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05119" /><CodeLine lineNumber="5119"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05120" /><CodeLine lineNumber="5120"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If there are scalar reductions and TTI has enabled aggressive</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05121" /><CodeLine lineNumber="5121"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// interleaving for reductions, we will interleave to expose ILP.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05122" /><CodeLine lineNumber="5122"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; AggressivelyInterleaveReductions) &#123;</Highlight></CodeLine>
<Link id="l05123" /><CodeLine lineNumber="5123"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Interleaving to expose ILP.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05124" /><CodeLine lineNumber="5124"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Interleave no less than SmallIC but not as aggressive as the normal IC</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05125" /><CodeLine lineNumber="5125"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// to satisfy the rare situation when resources are too limited.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05126" /><CodeLine lineNumber="5126"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::max(IC / 2, SmallIC);</Highlight></CodeLine>
<Link id="l05127" /><CodeLine lineNumber="5127"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05128" /><CodeLine lineNumber="5128"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05129" /><CodeLine lineNumber="5129"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Interleaving to reduce branch cost.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05130" /><CodeLine lineNumber="5130"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> SmallIC;</Highlight></CodeLine>
<Link id="l05131" /><CodeLine lineNumber="5131"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05132" /><CodeLine lineNumber="5132"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05133" /><CodeLine lineNumber="5133"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Interleave if this is a large loop (small loops are already dealt with by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05134" /><CodeLine lineNumber="5134"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// this point) that could benefit from interleaving.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05135" /><CodeLine lineNumber="5135"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AggressivelyInterleaveReductions) &#123;</Highlight></CodeLine>
<Link id="l05136" /><CodeLine lineNumber="5136"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Interleaving to expose ILP.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05137" /><CodeLine lineNumber="5137"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> IC;</Highlight></CodeLine>
<Link id="l05138" /><CodeLine lineNumber="5138"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05139" /><CodeLine lineNumber="5139"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05140" /><CodeLine lineNumber="5140"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Not Interleaving.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05141" /><CodeLine lineNumber="5141"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 1;</Highlight></CodeLine>
<Link id="l05142" /><CodeLine lineNumber="5142"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05143" /><CodeLine lineNumber="5143"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05144" /><CodeLine lineNumber="5144"><Highlight kind="normal"><a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;LoopVectorizationCostModel::RegisterUsage, 8&gt;</a></Highlight></CodeLine>
<Link id="l05145" /><CodeLine lineNumber="5145" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91466f7a82e967ed765e6d876415a3b7"><Highlight kind="normal"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91466f7a82e967ed765e6d876415a3b7">LoopVectorizationCostModel::calculateRegisterUsage</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;ElementCount&gt;</a> VFs) &#123;</Highlight></CodeLine>
<Link id="l05146" /><CodeLine lineNumber="5146"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This function calculates the register usage by measuring the highest number</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05147" /><CodeLine lineNumber="5147"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of values that are alive at a single location. Obviously, this is a very</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05148" /><CodeLine lineNumber="5148"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// rough estimation. We scan the loop in a topological order in order and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05149" /><CodeLine lineNumber="5149"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// assign a number to each instruction. We use RPO to ensure that defs are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05150" /><CodeLine lineNumber="5150"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// met before their users. We assume that each instruction that has in-loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05151" /><CodeLine lineNumber="5151"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// users starts an interval. We record every time that an in-loop value is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05152" /><CodeLine lineNumber="5152"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// used, so we have a list of the first and last occurrences of each</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05153" /><CodeLine lineNumber="5153"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction. Next, we transpose this data structure into a multi map that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05154" /><CodeLine lineNumber="5154"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// holds the list of intervals that &#42;end&#42; at a specific location. This multi</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05155" /><CodeLine lineNumber="5155"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// map allows us to perform a linear search. We scan the instructions linearly</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05156" /><CodeLine lineNumber="5156"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and record each time that a new interval starts, by placing it in a set.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05157" /><CodeLine lineNumber="5157"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we find this value in the multi-map then we remove it from the set.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05158" /><CodeLine lineNumber="5158"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The max register usage is the maximum size of the set.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05159" /><CodeLine lineNumber="5159"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We also search for instructions that are defined outside the loop, but are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05160" /><CodeLine lineNumber="5160"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// used inside the loop. We need this number separately from the max-interval</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05161" /><CodeLine lineNumber="5161"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// usage number because when we unroll, loop-invariant values do not take</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05162" /><CodeLine lineNumber="5162"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// more register.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05163" /><CodeLine lineNumber="5163"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopblocksdfs">LoopBlocksDFS</a> DFS(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l05164" /><CodeLine lineNumber="5164"><Highlight kind="normal">  DFS.<a href="/docs/api/classes/llvm/loopblocksdfs/#adc85a5f08fb0f5dc3e053975995c9d29">perform</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a>);</Highlight></CodeLine>
<Link id="l05165" /><CodeLine lineNumber="5165"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05166" /><CodeLine lineNumber="5166"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage">RegisterUsage</a> RU;</Highlight></CodeLine>
<Link id="l05167" /><CodeLine lineNumber="5167"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05168" /><CodeLine lineNumber="5168"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Each &#39;key&#39; in the map opens a new interval. The values</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05169" /><CodeLine lineNumber="5169"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the map are the index of the &#39;last seen&#39; usage of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05170" /><CodeLine lineNumber="5170"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction that is the key.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05171" /><CodeLine lineNumber="5171"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/intervalmap">IntervalMap</a> = <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;Instruction &#42;, unsigned, 16&gt;</a>;</Highlight></CodeLine>
<Link id="l05172" /><CodeLine lineNumber="5172"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05173" /><CodeLine lineNumber="5173"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Maps instruction to its index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05174" /><CodeLine lineNumber="5174"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 64&gt;</a> IdxToInstr;</Highlight></CodeLine>
<Link id="l05175" /><CodeLine lineNumber="5175"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Marks the end of each interval.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05176" /><CodeLine lineNumber="5176"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/intervalmap">IntervalMap</a> EndPoint;</Highlight></CodeLine>
<Link id="l05177" /><CodeLine lineNumber="5177"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Saves the list of instruction indices that are used in the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05178" /><CodeLine lineNumber="5178"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 8&gt;</a> Ends;</Highlight></CodeLine>
<Link id="l05179" /><CodeLine lineNumber="5179"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Saves the list of values that are used in the loop but are defined outside</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05180" /><CodeLine lineNumber="5180"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the loop (not including non-instruction values such as arguments and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05181" /><CodeLine lineNumber="5181"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// constants).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05182" /><CodeLine lineNumber="5182"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallsetvector">SmallSetVector&lt;Instruction &#42;, 8&gt;</a> LoopInvariants;</Highlight></CodeLine>
<Link id="l05183" /><CodeLine lineNumber="5183"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05184" /><CodeLine lineNumber="5184"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(DFS.<a href="/docs/api/classes/llvm/loopblocksdfs/#a003fe6215d300fc9720b1b056cdf4c23">beginRPO</a>(), DFS.<a href="/docs/api/classes/llvm/loopblocksdfs/#aeebda6b0288bea7cd706111624ca73f6">endRPO</a>())) &#123;</Highlight></CodeLine>
<Link id="l05185" /><CodeLine lineNumber="5185"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB-&gt;instructionsWithoutDebug()) &#123;</Highlight></CodeLine>
<Link id="l05186" /><CodeLine lineNumber="5186"><Highlight kind="normal">      IdxToInstr.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05187" /><CodeLine lineNumber="5187"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05188" /><CodeLine lineNumber="5188"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Save the end location of each USE.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05189" /><CodeLine lineNumber="5189"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.operands()) &#123;</Highlight></CodeLine>
<Link id="l05190" /><CodeLine lineNumber="5190"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Instr = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l05191" /><CodeLine lineNumber="5191"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05192" /><CodeLine lineNumber="5192"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Ignore non-instruction values such as arguments, constants, etc.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05193" /><CodeLine lineNumber="5193"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// FIXME: Might need some motivation why these values are ignored. If</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05194" /><CodeLine lineNumber="5194"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// for example an argument is used inside the loop it will increase the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05195" /><CodeLine lineNumber="5195"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// register pressure (so shouldn&#39;t we add it to LoopInvariants).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05196" /><CodeLine lineNumber="5196"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Instr)</Highlight></CodeLine>
<Link id="l05197" /><CodeLine lineNumber="5197"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05198" /><CodeLine lineNumber="5198"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05199" /><CodeLine lineNumber="5199"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If this instruction is outside the loop then record it and continue.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05200" /><CodeLine lineNumber="5200"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(Instr)) &#123;</Highlight></CodeLine>
<Link id="l05201" /><CodeLine lineNumber="5201"><Highlight kind="normal">          LoopInvariants.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Instr);</Highlight></CodeLine>
<Link id="l05202" /><CodeLine lineNumber="5202"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05203" /><CodeLine lineNumber="5203"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l05204" /><CodeLine lineNumber="5204"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05205" /><CodeLine lineNumber="5205"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Overwrite previous end points.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05206" /><CodeLine lineNumber="5206"><Highlight kind="normal">        EndPoint&#91;Instr&#93; = IdxToInstr.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</Highlight></CodeLine>
<Link id="l05207" /><CodeLine lineNumber="5207"><Highlight kind="normal">        Ends.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Instr);</Highlight></CodeLine>
<Link id="l05208" /><CodeLine lineNumber="5208"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05209" /><CodeLine lineNumber="5209"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05210" /><CodeLine lineNumber="5210"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05211" /><CodeLine lineNumber="5211"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05212" /><CodeLine lineNumber="5212"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Saves the list of intervals that end with the index in &#39;key&#39;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05213" /><CodeLine lineNumber="5213"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal">InstrList = <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 2&gt;</a>;</Highlight></CodeLine>
<Link id="l05214" /><CodeLine lineNumber="5214"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;unsigned, InstrList, 16&gt;</a> TransposeEnds;</Highlight></CodeLine>
<Link id="l05215" /><CodeLine lineNumber="5215"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05216" /><CodeLine lineNumber="5216"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Transpose the EndPoints to a list of values that end at each index.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05217" /><CodeLine lineNumber="5217"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/msf/mappedblockstream-cpp/#a4ab9bd667f674c16b2cee01ab8823644">Interval</a> : EndPoint)</Highlight></CodeLine>
<Link id="l05218" /><CodeLine lineNumber="5218"><Highlight kind="normal">    TransposeEnds&#91;<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/msf/mappedblockstream-cpp/#a4ab9bd667f674c16b2cee01ab8823644">Interval</a>.second&#93;.push&#95;back(<a href="/docs/api/files/lib/lib/debuginfo/lib/debuginfo/msf/mappedblockstream-cpp/#a4ab9bd667f674c16b2cee01ab8823644">Interval</a>.first);</Highlight></CodeLine>
<Link id="l05219" /><CodeLine lineNumber="5219"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05220" /><CodeLine lineNumber="5220"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 8&gt;</a> OpenIntervals;</Highlight></CodeLine>
<Link id="l05221" /><CodeLine lineNumber="5221"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;RegisterUsage, 8&gt;</a> RUs(VFs.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</Highlight></CodeLine>
<Link id="l05222" /><CodeLine lineNumber="5222"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;SmallMapVector&lt;unsigned, unsigned, 4&gt;</a>, 8&gt; MaxUsages(VFs.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>());</Highlight></CodeLine>
<Link id="l05223" /><CodeLine lineNumber="5223"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05224" /><CodeLine lineNumber="5224"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV(REG): Calculating max register usage:\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05225" /><CodeLine lineNumber="5225"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05226" /><CodeLine lineNumber="5226"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;TTICapture = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>;</Highlight></CodeLine>
<Link id="l05227" /><CodeLine lineNumber="5227"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GetRegUsage = &#91;&amp;TTICapture&#93;(<a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) -&gt; </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05228" /><CodeLine lineNumber="5228"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Ty-&gt;isTokenTy() || !<a href="/docs/api/classes/llvm/vectortype/#aa6a2194fc011669faabe43322d7c6c5f">VectorType::isValidElementType</a>(Ty) ||</Highlight></CodeLine>
<Link id="l05229" /><CodeLine lineNumber="5229"><Highlight kind="normal">        (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l05230" /><CodeLine lineNumber="5230"><Highlight kind="normal">         !TTICapture.isElementTypeLegalForScalableVector(Ty)))</Highlight></CodeLine>
<Link id="l05231" /><CodeLine lineNumber="5231"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 0;</Highlight></CodeLine>
<Link id="l05232" /><CodeLine lineNumber="5232"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> TTICapture.getRegUsageForType(<a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Ty, VF));</Highlight></CodeLine>
<Link id="l05233" /><CodeLine lineNumber="5233"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l05234" /><CodeLine lineNumber="5234"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05235" /><CodeLine lineNumber="5235"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> Idx = 0, Sz = IdxToInstr.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); Idx &lt; Sz; ++Idx) &#123;</Highlight></CodeLine>
<Link id="l05236" /><CodeLine lineNumber="5236"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = IdxToInstr&#91;Idx&#93;;</Highlight></CodeLine>
<Link id="l05237" /><CodeLine lineNumber="5237"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05238" /><CodeLine lineNumber="5238"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remove all of the instructions that end at this location.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05239" /><CodeLine lineNumber="5239"><Highlight kind="normal">    InstrList &amp;<a href="/docs/api/namespaces/llvm/#acefe92adee8725ad904c7c43649790e8a4ee29ca12c7d126654bd0e5275de6135">List</a> = TransposeEnds&#91;Idx&#93;;</Highlight></CodeLine>
<Link id="l05240" /><CodeLine lineNumber="5240"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armlowoverheadloops-cpp/#a3bf42baf773b375802538951c88d8e12">ToRemove</a> : <a href="/docs/api/namespaces/llvm/#acefe92adee8725ad904c7c43649790e8a4ee29ca12c7d126654bd0e5275de6135">List</a>)</Highlight></CodeLine>
<Link id="l05241" /><CodeLine lineNumber="5241"><Highlight kind="normal">      OpenIntervals.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a11045c7973ab24a8d6315b61fa337d4e">erase</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armlowoverheadloops-cpp/#a3bf42baf773b375802538951c88d8e12">ToRemove</a>);</Highlight></CodeLine>
<Link id="l05242" /><CodeLine lineNumber="5242"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05243" /><CodeLine lineNumber="5243"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Ignore instructions that are never used within the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05244" /><CodeLine lineNumber="5244"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Ends.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l05245" /><CodeLine lineNumber="5245"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05246" /><CodeLine lineNumber="5246"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05247" /><CodeLine lineNumber="5247"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Skip ignored values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05248" /><CodeLine lineNumber="5248"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>.count(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l05249" /><CodeLine lineNumber="5249"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05250" /><CodeLine lineNumber="5250"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05251" /><CodeLine lineNumber="5251"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a12d2850f420726c4acb262b626e95b7d">collectInLoopReductions</a>();</Highlight></CodeLine>
<Link id="l05252" /><CodeLine lineNumber="5252"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05253" /><CodeLine lineNumber="5253"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For each VF find the maximum usage of registers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05254" /><CodeLine lineNumber="5254"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> J = 0, E = VFs.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); J &lt; E; ++J) &#123;</Highlight></CodeLine>
<Link id="l05255" /><CodeLine lineNumber="5255"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Count the number of registers used, per register class, given all open</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05256" /><CodeLine lineNumber="5256"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// intervals.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05257" /><CodeLine lineNumber="5257"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Note that elements in this SmallMapVector will be default constructed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05258" /><CodeLine lineNumber="5258"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// as 0 So we can use &quot;RegUsage&#91;ClassID&#93; += n&quot; in the code below even if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05259" /><CodeLine lineNumber="5259"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// there is no previous entry for ClassID.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05260" /><CodeLine lineNumber="5260"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/smallmapvector">SmallMapVector&lt;unsigned, unsigned, 4&gt;</a> <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06aefdc051657574f00e43b0fa1f87e7336">RegUsage</a>;</Highlight></CodeLine>
<Link id="l05261" /><CodeLine lineNumber="5261"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05262" /><CodeLine lineNumber="5262"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VFs&#91;J&#93;.isScalar()) &#123;</Highlight></CodeLine>
<Link id="l05263" /><CodeLine lineNumber="5263"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Inst : OpenIntervals) &#123;</Highlight></CodeLine>
<Link id="l05264" /><CodeLine lineNumber="5264"><Highlight kind="normal">          </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ClassID =</Highlight></CodeLine>
<Link id="l05265" /><CodeLine lineNumber="5265"><Highlight kind="normal">              <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getRegisterClassForType(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, Inst-&gt;getType());</Highlight></CodeLine>
<Link id="l05266" /><CodeLine lineNumber="5266"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// FIXME: The target might use more than one register for the type</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05267" /><CodeLine lineNumber="5267"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// even in the scalar case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05268" /><CodeLine lineNumber="5268"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06aefdc051657574f00e43b0fa1f87e7336">RegUsage</a>&#91;ClassID&#93; += 1;</Highlight></CodeLine>
<Link id="l05269" /><CodeLine lineNumber="5269"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l05270" /><CodeLine lineNumber="5270"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05271" /><CodeLine lineNumber="5271"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab4a3f06ac8f2aff57b864c2d8ace97d8">collectUniformsAndScalars</a>(VFs&#91;J&#93;);</Highlight></CodeLine>
<Link id="l05272" /><CodeLine lineNumber="5272"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Inst : OpenIntervals) &#123;</Highlight></CodeLine>
<Link id="l05273" /><CodeLine lineNumber="5273"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Skip ignored values for VF &gt; 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05274" /><CodeLine lineNumber="5274"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.count(Inst))</Highlight></CodeLine>
<Link id="l05275" /><CodeLine lineNumber="5275"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05276" /><CodeLine lineNumber="5276"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(Inst, VFs&#91;J&#93;)) &#123;</Highlight></CodeLine>
<Link id="l05277" /><CodeLine lineNumber="5277"><Highlight kind="normal">            </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ClassID =</Highlight></CodeLine>
<Link id="l05278" /><CodeLine lineNumber="5278"><Highlight kind="normal">                <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getRegisterClassForType(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, Inst-&gt;getType());</Highlight></CodeLine>
<Link id="l05279" /><CodeLine lineNumber="5279"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// FIXME: The target might use more than one register for the type</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05280" /><CodeLine lineNumber="5280"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// even in the scalar case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05281" /><CodeLine lineNumber="5281"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06aefdc051657574f00e43b0fa1f87e7336">RegUsage</a>&#91;ClassID&#93; += 1;</Highlight></CodeLine>
<Link id="l05282" /><CodeLine lineNumber="5282"><Highlight kind="normal">          &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05283" /><CodeLine lineNumber="5283"><Highlight kind="normal">            </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ClassID =</Highlight></CodeLine>
<Link id="l05284" /><CodeLine lineNumber="5284"><Highlight kind="normal">                <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getRegisterClassForType(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, Inst-&gt;getType());</Highlight></CodeLine>
<Link id="l05285" /><CodeLine lineNumber="5285"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06aefdc051657574f00e43b0fa1f87e7336">RegUsage</a>&#91;ClassID&#93; += GetRegUsage(Inst-&gt;getType(), VFs&#91;J&#93;);</Highlight></CodeLine>
<Link id="l05286" /><CodeLine lineNumber="5286"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l05287" /><CodeLine lineNumber="5287"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l05288" /><CodeLine lineNumber="5288"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05289" /><CodeLine lineNumber="5289"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05290" /><CodeLine lineNumber="5290"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Pair : <a href="/docs/api/namespaces/llvm/#a1eb5609345b906d024fbf9e4bc1adc06aefdc051657574f00e43b0fa1f87e7336">RegUsage</a>) &#123;</Highlight></CodeLine>
<Link id="l05291" /><CodeLine lineNumber="5291"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Entry = MaxUsages&#91;J&#93;&#91;Pair.first&#93;;</Highlight></CodeLine>
<Link id="l05292" /><CodeLine lineNumber="5292"><Highlight kind="normal">        Entry = std::max(Entry, Pair.second);</Highlight></CodeLine>
<Link id="l05293" /><CodeLine lineNumber="5293"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05294" /><CodeLine lineNumber="5294"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05295" /><CodeLine lineNumber="5295"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05296" /><CodeLine lineNumber="5296"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV(REG): At #&quot;</Highlight><Highlight kind="normal"> &lt;&lt; Idx &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; Interval # &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05297" /><CodeLine lineNumber="5297"><Highlight kind="normal">                      &lt;&lt; OpenIntervals.<a href="/docs/api/classes/llvm/smallptrsetimplbase/#a0e1c3175b0ac22fe3853651c28e1ecb8">size</a>() &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05298" /><CodeLine lineNumber="5298"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05299" /><CodeLine lineNumber="5299"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add the current instruction to the list of open intervals.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05300" /><CodeLine lineNumber="5300"><Highlight kind="normal">    OpenIntervals.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05301" /><CodeLine lineNumber="5301"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05302" /><CodeLine lineNumber="5302"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05303" /><CodeLine lineNumber="5303"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 0, End = VFs.<a href="/docs/api/classes/llvm/arrayref/#a85ffb6531d4cda988ea81f18d4e56fb7">size</a>(); Idx &lt; End; ++Idx) &#123;</Highlight></CodeLine>
<Link id="l05304" /><CodeLine lineNumber="5304"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Note that elements in this SmallMapVector will be default constructed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05305" /><CodeLine lineNumber="5305"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// as 0 So we can use &quot;Invariant&#91;ClassID&#93; += n&quot; in the code below even if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05306" /><CodeLine lineNumber="5306"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// there is no previous entry for ClassID.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05307" /><CodeLine lineNumber="5307"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/smallmapvector">SmallMapVector&lt;unsigned, unsigned, 4&gt;</a> Invariant;</Highlight></CodeLine>
<Link id="l05308" /><CodeLine lineNumber="5308"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05309" /><CodeLine lineNumber="5309"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Inst : LoopInvariants) &#123;</Highlight></CodeLine>
<Link id="l05310" /><CodeLine lineNumber="5310"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// FIXME: The target might use more than one register for the type</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05311" /><CodeLine lineNumber="5311"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// even in the scalar case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05312" /><CodeLine lineNumber="5312"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsScalar = <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(Inst-&gt;users(), &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l05313" /><CodeLine lineNumber="5313"><Highlight kind="normal">        auto &#42;I = cast&lt;Instruction&gt;(U);</Highlight></CodeLine>
<Link id="l05314" /><CodeLine lineNumber="5314"><Highlight kind="normal">        return TheLoop != LI-&gt;getLoopFor(I-&gt;getParent()) ||</Highlight></CodeLine>
<Link id="l05315" /><CodeLine lineNumber="5315"><Highlight kind="normal">               isScalarAfterVectorization(I, VFs&#91;Idx&#93;);</Highlight></CodeLine>
<Link id="l05316" /><CodeLine lineNumber="5316"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l05317" /><CodeLine lineNumber="5317"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05318" /><CodeLine lineNumber="5318"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF = IsScalar ? <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1) : VFs&#91;Idx&#93;;</Highlight></CodeLine>
<Link id="l05319" /><CodeLine lineNumber="5319"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ClassID =</Highlight></CodeLine>
<Link id="l05320" /><CodeLine lineNumber="5320"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getRegisterClassForType(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>(), Inst-&gt;getType());</Highlight></CodeLine>
<Link id="l05321" /><CodeLine lineNumber="5321"><Highlight kind="normal">      Invariant&#91;ClassID&#93; += GetRegUsage(Inst-&gt;getType(), VF);</Highlight></CodeLine>
<Link id="l05322" /><CodeLine lineNumber="5322"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05323" /><CodeLine lineNumber="5323"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05324" /><CodeLine lineNumber="5324"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</Highlight></CodeLine>
<Link id="l05325" /><CodeLine lineNumber="5325"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV(REG): VF = &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VFs&#91;Idx&#93; &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05326" /><CodeLine lineNumber="5326"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV(REG): Found max usage: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; MaxUsages&#91;Idx&#93;.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>()</Highlight></CodeLine>
<Link id="l05327" /><CodeLine lineNumber="5327"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; item\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05328" /><CodeLine lineNumber="5328"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;pair : MaxUsages&#91;Idx&#93;) &#123;</Highlight></CodeLine>
<Link id="l05329" /><CodeLine lineNumber="5329"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV(REG): RegisterClass: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05330" /><CodeLine lineNumber="5330"><Highlight kind="normal">               &lt;&lt; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getRegisterClassName(pair.first) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;, &quot;</Highlight><Highlight kind="normal"> &lt;&lt; pair.second</Highlight></CodeLine>
<Link id="l05331" /><CodeLine lineNumber="5331"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; registers\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05332" /><CodeLine lineNumber="5332"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05333" /><CodeLine lineNumber="5333"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV(REG): Found invariant usage: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; Invariant.<a href="/docs/api/classes/llvm/mapvector/#acf4c09e1f30cdd4e0b5b1b8a236ead34">size</a>()</Highlight></CodeLine>
<Link id="l05334" /><CodeLine lineNumber="5334"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; item\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05335" /><CodeLine lineNumber="5335"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;pair : Invariant) &#123;</Highlight></CodeLine>
<Link id="l05336" /><CodeLine lineNumber="5336"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV(REG): RegisterClass: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05337" /><CodeLine lineNumber="5337"><Highlight kind="normal">               &lt;&lt; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getRegisterClassName(pair.first) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;, &quot;</Highlight><Highlight kind="normal"> &lt;&lt; pair.second</Highlight></CodeLine>
<Link id="l05338" /><CodeLine lineNumber="5338"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; registers\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05339" /><CodeLine lineNumber="5339"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05340" /><CodeLine lineNumber="5340"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l05341" /><CodeLine lineNumber="5341"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05342" /><CodeLine lineNumber="5342"><Highlight kind="normal">    RU.<a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage/#a12f1d225b87b9cb583e78478d9ef3b9c">LoopInvariantRegs</a> = Invariant;</Highlight></CodeLine>
<Link id="l05343" /><CodeLine lineNumber="5343"><Highlight kind="normal">    RU.<a href="/docs/api/structs/llvm/loopvectorizationcostmodel/registerusage/#a0ae3b197ca92417681a2865b605e56a9">MaxLocalUsers</a> = MaxUsages&#91;Idx&#93;;</Highlight></CodeLine>
<Link id="l05344" /><CodeLine lineNumber="5344"><Highlight kind="normal">    RUs&#91;Idx&#93; = RU;</Highlight></CodeLine>
<Link id="l05345" /><CodeLine lineNumber="5345"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05346" /><CodeLine lineNumber="5346"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05347" /><CodeLine lineNumber="5347"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> RUs;</Highlight></CodeLine>
<Link id="l05348" /><CodeLine lineNumber="5348"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05349" /><CodeLine lineNumber="5349"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05350" /><CodeLine lineNumber="5350"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> LoopVectorizationCostModel::useEmulatedMaskMemRefHack(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l05351" /><CodeLine lineNumber="5351"><Highlight kind="normal">                                                           <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l05352" /><CodeLine lineNumber="5352"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Cost model for emulated masked load/store is completely</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05353" /><CodeLine lineNumber="5353"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// broken. This hack guides the cost model to use an artificially</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05354" /><CodeLine lineNumber="5354"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// high enough value to practically disable vectorization with such</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05355" /><CodeLine lineNumber="5355"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// operations, except where previously deployed legality hack allowed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05356" /><CodeLine lineNumber="5356"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// using very low cost values. This is to avoid regressions coming simply</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05357" /><CodeLine lineNumber="5357"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// from moving &quot;masked load/store&quot; check from legality to cost model.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05358" /><CodeLine lineNumber="5358"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Masked Load/Gather emulation was previously never allowed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05359" /><CodeLine lineNumber="5359"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Limited number of Masked Store/Scatter emulation was allowed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05360" /><CodeLine lineNumber="5360"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">isPredicatedInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</Highlight></CodeLine>
<Link id="l05361" /><CodeLine lineNumber="5361"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Expecting a scalar emulated instruction&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05362" /><CodeLine lineNumber="5362"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</Highlight></CodeLine>
<Link id="l05363" /><CodeLine lineNumber="5363"><Highlight kind="normal">         (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l05364" /><CodeLine lineNumber="5364"><Highlight kind="normal">          NumPredStores &gt; <a href="#ae11c08aa35785a118bda788836cab423">NumberOfStoresToPredicate</a>);</Highlight></CodeLine>
<Link id="l05365" /><CodeLine lineNumber="5365"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05366" /><CodeLine lineNumber="5366"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05367" /><CodeLine lineNumber="5367" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#afcbf4a19be078644e784b539379d59b7"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#afcbf4a19be078644e784b539379d59b7">LoopVectorizationCostModel::collectInstsToScalarize</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l05368" /><CodeLine lineNumber="5368"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we aren&#39;t vectorizing the loop, or if we&#39;ve already collected the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05369" /><CodeLine lineNumber="5369"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instructions to scalarize, there&#39;s nothing to do. Collection may already</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05370" /><CodeLine lineNumber="5370"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// have occurred if we have a user-selected VF and are now computing the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05371" /><CodeLine lineNumber="5371"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// expected cost for interleaving.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05372" /><CodeLine lineNumber="5372"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ad96fee81c3174ef427bf779d73fb1ef2">isZero</a>() || InstsToScalarize.contains(VF))</Highlight></CodeLine>
<Link id="l05373" /><CodeLine lineNumber="5373"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05374" /><CodeLine lineNumber="5374"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05375" /><CodeLine lineNumber="5375"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Initialize a mapping for VF in InstsToScalalarize. If we find that it&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05376" /><CodeLine lineNumber="5376"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// not profitable to scalarize any instructions, the presence of VF in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05377" /><CodeLine lineNumber="5377"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// map will indicate that we&#39;ve analyzed it already.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05378" /><CodeLine lineNumber="5378"><Highlight kind="normal">  ScalarCostsTy &amp;ScalarCostsVF = InstsToScalarize&#91;VF&#93;;</Highlight></CodeLine>
<Link id="l05379" /><CodeLine lineNumber="5379"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05380" /><CodeLine lineNumber="5380"><Highlight kind="normal">  PredicatedBBsAfterVectorization&#91;VF&#93;.clear();</Highlight></CodeLine>
<Link id="l05381" /><CodeLine lineNumber="5381"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05382" /><CodeLine lineNumber="5382"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find all the instructions that are scalar with predication in the loop and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05383" /><CodeLine lineNumber="5383"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// determine if it would be better to not if-convert the blocks they are in.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05384" /><CodeLine lineNumber="5384"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If so, we also record the instructions to scalarize.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05385" /><CodeLine lineNumber="5385"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks()) &#123;</Highlight></CodeLine>
<Link id="l05386" /><CodeLine lineNumber="5386"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8c8de8f62b5d2b27c4878d3effd7273">blockNeedsPredicationForAnyReason</a>(BB))</Highlight></CodeLine>
<Link id="l05387" /><CodeLine lineNumber="5387"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05388" /><CodeLine lineNumber="5388"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB)</Highlight></CodeLine>
<Link id="l05389" /><CodeLine lineNumber="5389"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8">isScalarWithPredication</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</Highlight></CodeLine>
<Link id="l05390" /><CodeLine lineNumber="5390"><Highlight kind="normal">        ScalarCostsTy ScalarCosts;</Highlight></CodeLine>
<Link id="l05391" /><CodeLine lineNumber="5391"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Do not apply discount logic for:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05392" /><CodeLine lineNumber="5392"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// 1 Scalars after vectorization, as there will only be a single copy</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05393" /><CodeLine lineNumber="5393"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// of the instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05394" /><CodeLine lineNumber="5394"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// 2 Scalable VF, as that would lead to invalid scalarization costs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05395" /><CodeLine lineNumber="5395"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// 3 Emulated masked memrefs, if a hacked cost is needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05396" /><CodeLine lineNumber="5396"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) &amp;&amp; !VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l05397" /><CodeLine lineNumber="5397"><Highlight kind="normal">            !useEmulatedMaskMemRefHack(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) &amp;&amp;</Highlight></CodeLine>
<Link id="l05398" /><CodeLine lineNumber="5398"><Highlight kind="normal">            computePredInstDiscount(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, ScalarCosts, VF) &gt;= 0) &#123;</Highlight></CodeLine>
<Link id="l05399" /><CodeLine lineNumber="5399"><Highlight kind="normal">          ScalarCostsVF.<a href="/docs/api/classes/llvm/densemapbase/#adb33f3ede2f5bfc9b3ee658aaf648492">insert</a>(ScalarCosts.<a href="/docs/api/classes/llvm/densemapbase/#a50d461a887e200e704e5157d3b21514d">begin</a>(), ScalarCosts.<a href="/docs/api/classes/llvm/densemapbase/#a65520b9c67759099e313d0f4e7b5ff9e">end</a>());</Highlight></CodeLine>
<Link id="l05400" /><CodeLine lineNumber="5400"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// Check if we decided to scalarize a call. If so, update the widening</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05401" /><CodeLine lineNumber="5401"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// decision of the call to CM&#95;Scalarize with the computed scalar cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05402" /><CodeLine lineNumber="5402"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>&#93; : ScalarCosts) &#123;</Highlight></CodeLine>
<Link id="l05403" /><CodeLine lineNumber="5403"><Highlight kind="normal">            </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05404" /><CodeLine lineNumber="5404"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CI || !CallWideningDecisions.contains(&#123;CI, VF&#125;))</Highlight></CodeLine>
<Link id="l05405" /><CodeLine lineNumber="5405"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05406" /><CodeLine lineNumber="5406"><Highlight kind="normal">            CallWideningDecisions&#91;&#123;CI, VF&#125;&#93;.Kind = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>;</Highlight></CodeLine>
<Link id="l05407" /><CodeLine lineNumber="5407"><Highlight kind="normal">            CallWideningDecisions&#91;&#123;CI, VF&#125;&#93;.Cost = ScalarCosts&#91;CI&#93;;</Highlight></CodeLine>
<Link id="l05408" /><CodeLine lineNumber="5408"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l05409" /><CodeLine lineNumber="5409"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l05410" /><CodeLine lineNumber="5410"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Remember that BB will remain after vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05411" /><CodeLine lineNumber="5411"><Highlight kind="normal">        PredicatedBBsAfterVectorization&#91;VF&#93;.insert(BB);</Highlight></CodeLine>
<Link id="l05412" /><CodeLine lineNumber="5412"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB)) &#123;</Highlight></CodeLine>
<Link id="l05413" /><CodeLine lineNumber="5413"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Pred-&gt;getSingleSuccessor() == BB)</Highlight></CodeLine>
<Link id="l05414" /><CodeLine lineNumber="5414"><Highlight kind="normal">            PredicatedBBsAfterVectorization&#91;VF&#93;.insert(Pred);</Highlight></CodeLine>
<Link id="l05415" /><CodeLine lineNumber="5415"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l05416" /><CodeLine lineNumber="5416"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05417" /><CodeLine lineNumber="5417"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05418" /><CodeLine lineNumber="5418"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05419" /><CodeLine lineNumber="5419"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05420" /><CodeLine lineNumber="5420"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> LoopVectorizationCostModel::computePredInstDiscount(</Highlight></CodeLine>
<Link id="l05421" /><CodeLine lineNumber="5421"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PredInst, ScalarCostsTy &amp;ScalarCosts, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l05422" /><CodeLine lineNumber="5422"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a20d7c96738b8f59692aec029895f8eb9">isUniformAfterVectorization</a>(PredInst, VF) &amp;&amp;</Highlight></CodeLine>
<Link id="l05423" /><CodeLine lineNumber="5423"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Instruction marked uniform-after-vectorization will be predicated&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05424" /><CodeLine lineNumber="5424"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05425" /><CodeLine lineNumber="5425"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Initialize the discount to zero, meaning that the scalar version and the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05426" /><CodeLine lineNumber="5426"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vector version cost the same.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05427" /><CodeLine lineNumber="5427"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> Discount = 0;</Highlight></CodeLine>
<Link id="l05428" /><CodeLine lineNumber="5428"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05429" /><CodeLine lineNumber="5429"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Holds instructions to analyze. The instructions we visit are mapped in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05430" /><CodeLine lineNumber="5430"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ScalarCosts. Those instructions are the ones that would be scalarized if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05431" /><CodeLine lineNumber="5431"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we find that the scalar version costs less.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05432" /><CodeLine lineNumber="5432"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 8&gt;</a> Worklist;</Highlight></CodeLine>
<Link id="l05433" /><CodeLine lineNumber="5433"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05434" /><CodeLine lineNumber="5434"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Returns true if the given instruction can be scalarized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05435" /><CodeLine lineNumber="5435"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CanBeScalarized = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05436" /><CodeLine lineNumber="5436"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We only attempt to scalarize instructions forming a single-use chain</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05437" /><CodeLine lineNumber="5437"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// from the original predicated block that would otherwise be vectorized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05438" /><CodeLine lineNumber="5438"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Although not strictly necessary, we give up on instructions we know will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05439" /><CodeLine lineNumber="5439"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// already be scalar to avoid traversing chains that are unlikely to be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05440" /><CodeLine lineNumber="5440"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// beneficial.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05441" /><CodeLine lineNumber="5441"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse() || PredInst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() ||</Highlight></CodeLine>
<Link id="l05442" /><CodeLine lineNumber="5442"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</Highlight></CodeLine>
<Link id="l05443" /><CodeLine lineNumber="5443"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05444" /><CodeLine lineNumber="5444"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05445" /><CodeLine lineNumber="5445"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the instruction is scalar with predication, it will be analyzed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05446" /><CodeLine lineNumber="5446"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// separately. We ignore it within the context of PredInst.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05447" /><CodeLine lineNumber="5447"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8">isScalarWithPredication</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</Highlight></CodeLine>
<Link id="l05448" /><CodeLine lineNumber="5448"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05449" /><CodeLine lineNumber="5449"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05450" /><CodeLine lineNumber="5450"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If any of the instruction&#39;s operands are uniform after vectorization,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05451" /><CodeLine lineNumber="5451"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the instruction cannot be scalarized. This prevents, for example, a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05452" /><CodeLine lineNumber="5452"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// masked load from being scalarized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05453" /><CodeLine lineNumber="5453"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05454" /><CodeLine lineNumber="5454"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We assume we will only emit a value for lane zero of an instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05455" /><CodeLine lineNumber="5455"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// marked uniform after vectorization, rather than VF identical values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05456" /><CodeLine lineNumber="5456"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Thus, if we scalarize an instruction that uses a uniform, we would</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05457" /><CodeLine lineNumber="5457"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// create uses of values corresponding to the lanes we aren&#39;t emitting code</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05458" /><CodeLine lineNumber="5458"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// for. This behavior can be changed by allowing getScalarValue to clone</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05459" /><CodeLine lineNumber="5459"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the lane zero values for uniforms rather than asserting.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05460" /><CodeLine lineNumber="5460"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</Highlight></CodeLine>
<Link id="l05461" /><CodeLine lineNumber="5461"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;J = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U.get()))</Highlight></CodeLine>
<Link id="l05462" /><CodeLine lineNumber="5462"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a20d7c96738b8f59692aec029895f8eb9">isUniformAfterVectorization</a>(J, VF))</Highlight></CodeLine>
<Link id="l05463" /><CodeLine lineNumber="5463"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05464" /><CodeLine lineNumber="5464"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05465" /><CodeLine lineNumber="5465"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise, we can scalarize the instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05466" /><CodeLine lineNumber="5466"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05467" /><CodeLine lineNumber="5467"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l05468" /><CodeLine lineNumber="5468"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05469" /><CodeLine lineNumber="5469"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Compute the expected cost discount from scalarizing the entire expression</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05470" /><CodeLine lineNumber="5470"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// feeding the predicated instruction. We currently only consider expressions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05471" /><CodeLine lineNumber="5471"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that are single-use instruction chains.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05472" /><CodeLine lineNumber="5472"><Highlight kind="normal">  Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PredInst);</Highlight></CodeLine>
<Link id="l05473" /><CodeLine lineNumber="5473"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l05474" /><CodeLine lineNumber="5474"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l05475" /><CodeLine lineNumber="5475"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05476" /><CodeLine lineNumber="5476"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we&#39;ve already analyzed the instruction, there&#39;s nothing to do.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05477" /><CodeLine lineNumber="5477"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ScalarCosts.contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l05478" /><CodeLine lineNumber="5478"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05479" /><CodeLine lineNumber="5479"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05480" /><CodeLine lineNumber="5480"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Compute the cost of the vector instruction. Note that this cost already</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05481" /><CodeLine lineNumber="5481"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// includes the scalarization overhead of the predicated instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05482" /><CodeLine lineNumber="5482"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> VectorCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a556ec90a0fa1e168a9f22db1deb1fee6">getInstructionCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l05483" /><CodeLine lineNumber="5483"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05484" /><CodeLine lineNumber="5484"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Compute the cost of the scalarized instruction. This cost is the cost of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05485" /><CodeLine lineNumber="5485"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the instruction as if it wasn&#39;t if-converted and instead remained in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05486" /><CodeLine lineNumber="5486"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// predicated block. We will scale this cost by block probability after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05487" /><CodeLine lineNumber="5487"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// computing the scalarization overhead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05488" /><CodeLine lineNumber="5488"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarCost =</Highlight></CodeLine>
<Link id="l05489" /><CodeLine lineNumber="5489"><Highlight kind="normal">        VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>() &#42; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a556ec90a0fa1e168a9f22db1deb1fee6">getInstructionCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1));</Highlight></CodeLine>
<Link id="l05490" /><CodeLine lineNumber="5490"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05491" /><CodeLine lineNumber="5491"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Compute the scalarization overhead of needed insertelement instructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05492" /><CodeLine lineNumber="5492"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// and phi nodes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05493" /><CodeLine lineNumber="5493"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8">isScalarWithPredication</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) &amp;&amp; !<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isVoidTy()) &#123;</Highlight></CodeLine>
<Link id="l05494" /><CodeLine lineNumber="5494"><Highlight kind="normal">      ScalarCost += <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getScalarizationOverhead(</Highlight></CodeLine>
<Link id="l05495" /><CodeLine lineNumber="5495"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), VF)),</Highlight></CodeLine>
<Link id="l05496" /><CodeLine lineNumber="5496"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>()), </Highlight><Highlight kind="comment">/&#42;Insert&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l05497" /><CodeLine lineNumber="5497"><Highlight kind="normal">          </Highlight><Highlight kind="comment">/&#42;Extract&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>);</Highlight></CodeLine>
<Link id="l05498" /><CodeLine lineNumber="5498"><Highlight kind="normal">      ScalarCost +=</Highlight></CodeLine>
<Link id="l05499" /><CodeLine lineNumber="5499"><Highlight kind="normal">          VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>() &#42; <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getCFInstrCost(Instruction::PHI, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>);</Highlight></CodeLine>
<Link id="l05500" /><CodeLine lineNumber="5500"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05501" /><CodeLine lineNumber="5501"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05502" /><CodeLine lineNumber="5502"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Compute the scalarization overhead of needed extractelement</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05503" /><CodeLine lineNumber="5503"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instructions. For each of the instruction&#39;s operands, if the operand can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05504" /><CodeLine lineNumber="5504"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// be scalarized, add it to the worklist; otherwise, account for the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05505" /><CodeLine lineNumber="5505"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// overhead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05506" /><CodeLine lineNumber="5506"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Use &amp;U : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</Highlight></CodeLine>
<Link id="l05507" /><CodeLine lineNumber="5507"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;J = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>.get())) &#123;</Highlight></CodeLine>
<Link id="l05508" /><CodeLine lineNumber="5508"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/vectortype/#aa6a2194fc011669faabe43322d7c6c5f">VectorType::isValidElementType</a>(J-&gt;getType()) &amp;&amp;</Highlight></CodeLine>
<Link id="l05509" /><CodeLine lineNumber="5509"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;Instruction has non-scalar type&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05510" /><CodeLine lineNumber="5510"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CanBeScalarized(J))</Highlight></CodeLine>
<Link id="l05511" /><CodeLine lineNumber="5511"><Highlight kind="normal">          Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(J);</Highlight></CodeLine>
<Link id="l05512" /><CodeLine lineNumber="5512"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (needsExtract(J, VF)) &#123;</Highlight></CodeLine>
<Link id="l05513" /><CodeLine lineNumber="5513"><Highlight kind="normal">          ScalarCost += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getScalarizationOverhead(</Highlight></CodeLine>
<Link id="l05514" /><CodeLine lineNumber="5514"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(J-&gt;getType(), VF)),</Highlight></CodeLine>
<Link id="l05515" /><CodeLine lineNumber="5515"><Highlight kind="normal">              <a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>()), </Highlight><Highlight kind="comment">/&#42;Insert&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l05516" /><CodeLine lineNumber="5516"><Highlight kind="normal">              </Highlight><Highlight kind="comment">/&#42;Extract&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05517" /><CodeLine lineNumber="5517"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l05518" /><CodeLine lineNumber="5518"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05519" /><CodeLine lineNumber="5519"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05520" /><CodeLine lineNumber="5520"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Scale the total scalar cost by block probability.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05521" /><CodeLine lineNumber="5521"><Highlight kind="normal">    ScalarCost /= <a href="/docs/api/namespaces/llvm/#adb5d7cdf62c5d24e421899cd74c4550d">getReciprocalPredBlockProb</a>();</Highlight></CodeLine>
<Link id="l05522" /><CodeLine lineNumber="5522"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05523" /><CodeLine lineNumber="5523"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Compute the discount. A non-negative discount means the vector version</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05524" /><CodeLine lineNumber="5524"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// of the instruction costs more, and scalarizing would be beneficial.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05525" /><CodeLine lineNumber="5525"><Highlight kind="normal">    Discount += VectorCost - ScalarCost;</Highlight></CodeLine>
<Link id="l05526" /><CodeLine lineNumber="5526"><Highlight kind="normal">    ScalarCosts&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = ScalarCost;</Highlight></CodeLine>
<Link id="l05527" /><CodeLine lineNumber="5527"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05528" /><CodeLine lineNumber="5528"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05529" /><CodeLine lineNumber="5529"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Discount;</Highlight></CodeLine>
<Link id="l05530" /><CodeLine lineNumber="5530"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05531" /><CodeLine lineNumber="5531"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05532" /><CodeLine lineNumber="5532" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae4c50e6300599d50ba706c0d2b780502"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae4c50e6300599d50ba706c0d2b780502">LoopVectorizationCostModel::expectedCost</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l05533" /><CodeLine lineNumber="5533"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l05534" /><CodeLine lineNumber="5534"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05535" /><CodeLine lineNumber="5535"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the vector loop gets executed exactly once with the given VF, ignore the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05536" /><CodeLine lineNumber="5536"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// costs of comparison and induction instructions, as they&#39;ll get simplified</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05537" /><CodeLine lineNumber="5537"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// away.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05538" /><CodeLine lineNumber="5538"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 2&gt;</a> ValuesToIgnoreForVF;</Highlight></CodeLine>
<Link id="l05539" /><CodeLine lineNumber="5539"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> TC = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE()-&gt;getSmallConstantTripCount(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l05540" /><CodeLine lineNumber="5540"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#aab9a9b0568c1c524f01499c7930b3bf9">isFixed</a>() &amp;&amp; TC == VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>() &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba">foldTailByMasking</a>())</Highlight></CodeLine>
<Link id="l05541" /><CodeLine lineNumber="5541"><Highlight kind="normal">    <a href="#ababcaf6e2e00fc3fc8791ea2c3acbda5">addFullyUnrolledInstructionsToIgnore</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getInductionVars(),</Highlight></CodeLine>
<Link id="l05542" /><CodeLine lineNumber="5542"><Highlight kind="normal">                                         ValuesToIgnoreForVF);</Highlight></CodeLine>
<Link id="l05543" /><CodeLine lineNumber="5543"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05544" /><CodeLine lineNumber="5544"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For each block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05545" /><CodeLine lineNumber="5545"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks()) &#123;</Highlight></CodeLine>
<Link id="l05546" /><CodeLine lineNumber="5546"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> BlockCost;</Highlight></CodeLine>
<Link id="l05547" /><CodeLine lineNumber="5547"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05548" /><CodeLine lineNumber="5548"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For each instruction in the old loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05549" /><CodeLine lineNumber="5549"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : BB-&gt;instructionsWithoutDebug()) &#123;</Highlight></CodeLine>
<Link id="l05550" /><CodeLine lineNumber="5550"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Skip ignored values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05551" /><CodeLine lineNumber="5551"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>.count(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || ValuesToIgnoreForVF.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</Highlight></CodeLine>
<Link id="l05552" /><CodeLine lineNumber="5552"><Highlight kind="normal">          (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.count(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)))</Highlight></CodeLine>
<Link id="l05553" /><CodeLine lineNumber="5553"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05554" /><CodeLine lineNumber="5554"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05555" /><CodeLine lineNumber="5555"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a556ec90a0fa1e168a9f22db1deb1fee6">getInstructionCost</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l05556" /><CodeLine lineNumber="5556"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05557" /><CodeLine lineNumber="5557"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Check if we should override the cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05558" /><CodeLine lineNumber="5558"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.isValid() &amp;&amp; <a href="#a5eae6074e6a1bb62e365ef65f3e26196">ForceTargetInstructionCost</a>.getNumOccurrences() &gt; 0)</Highlight></CodeLine>
<Link id="l05559" /><CodeLine lineNumber="5559"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a>(<a href="#a5eae6074e6a1bb62e365ef65f3e26196">ForceTargetInstructionCost</a>);</Highlight></CodeLine>
<Link id="l05560" /><CodeLine lineNumber="5560"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05561" /><CodeLine lineNumber="5561"><Highlight kind="normal">      BlockCost += <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>;</Highlight></CodeLine>
<Link id="l05562" /><CodeLine lineNumber="5562"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found an estimated cost of &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; for VF &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05563" /><CodeLine lineNumber="5563"><Highlight kind="normal">                        &lt;&lt; VF &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; For instruction: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05564" /><CodeLine lineNumber="5564"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05565" /><CodeLine lineNumber="5565"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05566" /><CodeLine lineNumber="5566"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we are vectorizing a predicated block, it will have been</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05567" /><CodeLine lineNumber="5567"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// if-converted. This means that the block&#39;s instructions (aside from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05568" /><CodeLine lineNumber="5568"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// stores and instructions that may divide by zero) will now be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05569" /><CodeLine lineNumber="5569"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// unconditionally executed. For the scalar case, we may not always execute</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05570" /><CodeLine lineNumber="5570"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the predicated block, if it is an if-else block. Thus, scale the block&#39;s</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05571" /><CodeLine lineNumber="5571"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// cost by the probability of executing it. blockNeedsPredication from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05572" /><CodeLine lineNumber="5572"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Legal is used so as to not include all blocks in tail folded loops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05573" /><CodeLine lineNumber="5573"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;blockNeedsPredication(BB))</Highlight></CodeLine>
<Link id="l05574" /><CodeLine lineNumber="5574"><Highlight kind="normal">      BlockCost /= <a href="/docs/api/namespaces/llvm/#adb5d7cdf62c5d24e421899cd74c4550d">getReciprocalPredBlockProb</a>();</Highlight></CodeLine>
<Link id="l05575" /><CodeLine lineNumber="5575"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05576" /><CodeLine lineNumber="5576"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += BlockCost;</Highlight></CodeLine>
<Link id="l05577" /><CodeLine lineNumber="5577"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05578" /><CodeLine lineNumber="5578"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05579" /><CodeLine lineNumber="5579"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l05580" /><CodeLine lineNumber="5580"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05581" /><CodeLine lineNumber="5581"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l05582" /><CodeLine lineNumber="5582"><Highlight kind="comment">/// Gets Address Access SCEV after verifying that the access pattern</Highlight></CodeLine>
<Link id="l05583" /><CodeLine lineNumber="5583"><Highlight kind="comment">/// is loop invariant except the induction variable dependence.</Highlight></CodeLine>
<Link id="l05584" /><CodeLine lineNumber="5584"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l05585" /><CodeLine lineNumber="5585"><Highlight kind="comment">/// This SCEV can be sent to the Target in order to estimate the address</Highlight></CodeLine>
<Link id="l05586" /><CodeLine lineNumber="5586"><Highlight kind="comment">/// calculation cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05587" /><CodeLine lineNumber="5587" lineLink="#ad27a81251d238dbfdc4d0253a64d6267"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;<a href="#ad27a81251d238dbfdc4d0253a64d6267">getAddressAccessSCEV</a>(</Highlight></CodeLine>
<Link id="l05588" /><CodeLine lineNumber="5588"><Highlight kind="normal">              <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>,</Highlight></CodeLine>
<Link id="l05589" /><CodeLine lineNumber="5589"><Highlight kind="normal">              <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;<a href="/docs/api/namespaces/llvm/irsimilarity/#af46430106334db52bfa7a4107e53a0bda8f7357506e00d8cd0694f948f909865d">Legal</a>,</Highlight></CodeLine>
<Link id="l05590" /><CodeLine lineNumber="5590"><Highlight kind="normal">              <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;PSE,</Highlight></CodeLine>
<Link id="l05591" /><CodeLine lineNumber="5591"><Highlight kind="normal">              </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;TheLoop) &#123;</Highlight></CodeLine>
<Link id="l05592" /><CodeLine lineNumber="5592"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05593" /><CodeLine lineNumber="5593"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Gep = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</Highlight></CodeLine>
<Link id="l05594" /><CodeLine lineNumber="5594"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Gep)</Highlight></CodeLine>
<Link id="l05595" /><CodeLine lineNumber="5595"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05596" /><CodeLine lineNumber="5596"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05597" /><CodeLine lineNumber="5597"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We are looking for a gep with all loop invariant indices except for one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05598" /><CodeLine lineNumber="5598"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// which should be an induction variable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05599" /><CodeLine lineNumber="5599"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;SE = PSE.<a href="/docs/api/classes/llvm/predicatedscalarevolution/#a10ca5eacc61b5669880de2f8b0cff33c">getSE</a>();</Highlight></CodeLine>
<Link id="l05600" /><CodeLine lineNumber="5600"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumOperands = Gep-&gt;getNumOperands();</Highlight></CodeLine>
<Link id="l05601" /><CodeLine lineNumber="5601"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Idx = 1; Idx &lt; NumOperands; ++Idx) &#123;</Highlight></CodeLine>
<Link id="l05602" /><CodeLine lineNumber="5602"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Opd = Gep-&gt;getOperand(Idx);</Highlight></CodeLine>
<Link id="l05603" /><CodeLine lineNumber="5603"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SE-&gt;isLoopInvariant(SE-&gt;getSCEV(Opd), TheLoop) &amp;&amp;</Highlight></CodeLine>
<Link id="l05604" /><CodeLine lineNumber="5604"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/irsimilarity/#af46430106334db52bfa7a4107e53a0bda8f7357506e00d8cd0694f948f909865d">Legal</a>-&gt;isInductionVariable(Opd))</Highlight></CodeLine>
<Link id="l05605" /><CodeLine lineNumber="5605"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l05606" /><CodeLine lineNumber="5606"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05607" /><CodeLine lineNumber="5607"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05608" /><CodeLine lineNumber="5608"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now we know we have a GEP ptr, %inv, %ind, %inv. return the Ptr SCEV.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05609" /><CodeLine lineNumber="5609"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> PSE.<a href="/docs/api/classes/llvm/predicatedscalarevolution/#ae0994d8207b94ad22ecebc1a6bc580f1">getSCEV</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</Highlight></CodeLine>
<Link id="l05610" /><CodeLine lineNumber="5610"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05611" /><CodeLine lineNumber="5611"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05612" /><CodeLine lineNumber="5612"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></Highlight></CodeLine>
<Link id="l05613" /><CodeLine lineNumber="5613"><Highlight kind="normal">LoopVectorizationCostModel::getMemInstScalarizationCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l05614" /><CodeLine lineNumber="5614"><Highlight kind="normal">                                                        <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l05615" /><CodeLine lineNumber="5615"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l05616" /><CodeLine lineNumber="5616"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Scalarization cost of instruction implies vectorization.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05617" /><CodeLine lineNumber="5617"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</Highlight></CodeLine>
<Link id="l05618" /><CodeLine lineNumber="5618"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l05619" /><CodeLine lineNumber="5619"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05620" /><CodeLine lineNumber="5620"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ValTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05621" /><CodeLine lineNumber="5621"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;SE = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE();</Highlight></CodeLine>
<Link id="l05622" /><CodeLine lineNumber="5622"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05623" /><CodeLine lineNumber="5623"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS = <a href="/docs/api/namespaces/llvm/#a0d97f0780a320d53641729a2d8371b74">getLoadStoreAddressSpace</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05624" /><CodeLine lineNumber="5624"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05625" /><CodeLine lineNumber="5625"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PtrTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getType(), VF);</Highlight></CodeLine>
<Link id="l05626" /><CodeLine lineNumber="5626"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// NOTE: PtrTy is a vector to signal &#96;TTI::getAddressComputationCost&#96;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05627" /><CodeLine lineNumber="5627"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//       that it is being called from this specific place.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05628" /><CodeLine lineNumber="5628"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05629" /><CodeLine lineNumber="5629"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Figure out whether the access is strided and get the stride value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05630" /><CodeLine lineNumber="5630"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// if it&#39;s known in compile time</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05631" /><CodeLine lineNumber="5631"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SCEV &#42;PtrSCEV = <a href="#ad27a81251d238dbfdc4d0253a64d6267">getAddressAccessSCEV</a>(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l05632" /><CodeLine lineNumber="5632"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05633" /><CodeLine lineNumber="5633"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get the cost of the scalar memory instruction and address computation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05634" /><CodeLine lineNumber="5634"><Highlight kind="normal">  InstructionCost <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> =</Highlight></CodeLine>
<Link id="l05635" /><CodeLine lineNumber="5635"><Highlight kind="normal">      VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getAddressComputationCost(PtrTy, SE, PtrSCEV);</Highlight></CodeLine>
<Link id="l05636" /><CodeLine lineNumber="5636"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05637" /><CodeLine lineNumber="5637"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Don&#39;t pass &#42;I here, since it is scalar but will actually be part of a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05638" /><CodeLine lineNumber="5638"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vectorized loop where the user of it is a vectorized instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05639" /><CodeLine lineNumber="5639"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05640" /><CodeLine lineNumber="5640"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMemoryOpCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(),</Highlight></CodeLine>
<Link id="l05641" /><CodeLine lineNumber="5641"><Highlight kind="normal">                                                      ValTy-&gt;<a href="/docs/api/classes/llvm/type/#a7c742b32ebcd73d6dc851afac295b0f2">getScalarType</a>(),</Highlight></CodeLine>
<Link id="l05642" /><CodeLine lineNumber="5642"><Highlight kind="normal">                                                      Alignment, AS, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05643" /><CodeLine lineNumber="5643"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05644" /><CodeLine lineNumber="5644"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get the overhead of the extractelement and insertelement instructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05645" /><CodeLine lineNumber="5645"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we might create due to scalarization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05646" /><CodeLine lineNumber="5646"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += getScalarizationOverhead(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l05647" /><CodeLine lineNumber="5647"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05648" /><CodeLine lineNumber="5648"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we have a predicated load/store, it will need extra i1 extracts and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05649" /><CodeLine lineNumber="5649"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// conditional branches, but may not be executed for each vector lane. Scale</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05650" /><CodeLine lineNumber="5650"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the cost by the probability of executing the predicated block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05651" /><CodeLine lineNumber="5651"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">isPredicatedInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l05652" /><CodeLine lineNumber="5652"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> /= <a href="/docs/api/namespaces/llvm/#adb5d7cdf62c5d24e421899cd74c4550d">getReciprocalPredBlockProb</a>();</Highlight></CodeLine>
<Link id="l05653" /><CodeLine lineNumber="5653"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05654" /><CodeLine lineNumber="5654"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add the cost of an i1 extract and a branch</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05655" /><CodeLine lineNumber="5655"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VecI1Ty =</Highlight></CodeLine>
<Link id="l05656" /><CodeLine lineNumber="5656"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">IntegerType::getInt1Ty</a>(ValTy-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>()), VF);</Highlight></CodeLine>
<Link id="l05657" /><CodeLine lineNumber="5657"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getScalarizationOverhead(</Highlight></CodeLine>
<Link id="l05658" /><CodeLine lineNumber="5658"><Highlight kind="normal">        VecI1Ty, <a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>()),</Highlight></CodeLine>
<Link id="l05659" /><CodeLine lineNumber="5659"><Highlight kind="normal">        </Highlight><Highlight kind="comment">/&#42;Insert=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="comment">/&#42;Extract=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05660" /><CodeLine lineNumber="5660"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCFInstrCost(Instruction::Br, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05661" /><CodeLine lineNumber="5661"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05662" /><CodeLine lineNumber="5662"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (useEmulatedMaskMemRefHack(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</Highlight></CodeLine>
<Link id="l05663" /><CodeLine lineNumber="5663"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Artificially setting to a high enough value to practically disable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05664" /><CodeLine lineNumber="5664"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// vectorization with such operations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05665" /><CodeLine lineNumber="5665"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = 3000000;</Highlight></CodeLine>
<Link id="l05666" /><CodeLine lineNumber="5666"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05667" /><CodeLine lineNumber="5667"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05668" /><CodeLine lineNumber="5668"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l05669" /><CodeLine lineNumber="5669"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05670" /><CodeLine lineNumber="5670"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05671" /><CodeLine lineNumber="5671"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></Highlight></CodeLine>
<Link id="l05672" /><CodeLine lineNumber="5672"><Highlight kind="normal">LoopVectorizationCostModel::getConsecutiveMemOpCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l05673" /><CodeLine lineNumber="5673"><Highlight kind="normal">                                                    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l05674" /><CodeLine lineNumber="5674"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ValTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05675" /><CodeLine lineNumber="5675"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VectorTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ValTy, VF));</Highlight></CodeLine>
<Link id="l05676" /><CodeLine lineNumber="5676"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05677" /><CodeLine lineNumber="5677"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS = <a href="/docs/api/namespaces/llvm/#a0d97f0780a320d53641729a2d8371b74">getLoadStoreAddressSpace</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05678" /><CodeLine lineNumber="5678"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> ConsecutiveStride = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isConsecutivePtr(ValTy, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>);</Highlight></CodeLine>
<Link id="l05679" /><CodeLine lineNumber="5679"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05680" /><CodeLine lineNumber="5680"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((ConsecutiveStride == 1 || ConsecutiveStride == -1) &amp;&amp;</Highlight></CodeLine>
<Link id="l05681" /><CodeLine lineNumber="5681"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Stride should be 1 or -1 for consecutive memory access&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05682" /><CodeLine lineNumber="5682"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05683" /><CodeLine lineNumber="5683"><Highlight kind="normal">  InstructionCost <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = 0;</Highlight></CodeLine>
<Link id="l05684" /><CodeLine lineNumber="5684"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l05685" /><CodeLine lineNumber="5685"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMaskedMemoryOpCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, Alignment, AS,</Highlight></CodeLine>
<Link id="l05686" /><CodeLine lineNumber="5686"><Highlight kind="normal">                                      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05687" /><CodeLine lineNumber="5687"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05688" /><CodeLine lineNumber="5688"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/targettransforminfo/operandvalueinfo">TTI::OperandValueInfo</a> OpInfo = <a href="/docs/api/classes/llvm/targettransforminfo/#a5fecba95c1ba20950ea8e2139127e621">TTI::getOperandInfo</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l05689" /><CodeLine lineNumber="5689"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMemoryOpCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, Alignment, AS,</Highlight></CodeLine>
<Link id="l05690" /><CodeLine lineNumber="5690"><Highlight kind="normal">                                <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, OpInfo, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05691" /><CodeLine lineNumber="5691"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05692" /><CodeLine lineNumber="5692"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05693" /><CodeLine lineNumber="5693"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a1200affbcdb869bf32076f90ad9d0eafa67f115c1fddc4ce1aeb1c754001585bc">Reverse</a> = ConsecutiveStride &lt; 0;</Highlight></CodeLine>
<Link id="l05694" /><CodeLine lineNumber="5694"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a1200affbcdb869bf32076f90ad9d0eafa67f115c1fddc4ce1aeb1c754001585bc">Reverse</a>)</Highlight></CodeLine>
<Link id="l05695" /><CodeLine lineNumber="5695"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getShuffleCost(<a href="/docs/api/classes/llvm/targettransforminfo/#af46433d0e36d3f80afc3a8c67b5c53ecaea788d98147161f25d5adc3ec6ce7e1f">TargetTransformInfo::SK&#95;Reverse</a>, VectorTy, &#123;&#125;,</Highlight></CodeLine>
<Link id="l05696" /><CodeLine lineNumber="5696"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, 0);</Highlight></CodeLine>
<Link id="l05697" /><CodeLine lineNumber="5697"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l05698" /><CodeLine lineNumber="5698"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05699" /><CodeLine lineNumber="5699"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05700" /><CodeLine lineNumber="5700"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></Highlight></CodeLine>
<Link id="l05701" /><CodeLine lineNumber="5701"><Highlight kind="normal">LoopVectorizationCostModel::getUniformMemOpCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l05702" /><CodeLine lineNumber="5702"><Highlight kind="normal">                                                <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l05703" /><CodeLine lineNumber="5703"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isUniformMemOp(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF));</Highlight></CodeLine>
<Link id="l05704" /><CodeLine lineNumber="5704"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05705" /><CodeLine lineNumber="5705"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ValTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05706" /><CodeLine lineNumber="5706"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VectorTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ValTy, VF));</Highlight></CodeLine>
<Link id="l05707" /><CodeLine lineNumber="5707"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05708" /><CodeLine lineNumber="5708"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS = <a href="/docs/api/namespaces/llvm/#a0d97f0780a320d53641729a2d8371b74">getLoadStoreAddressSpace</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05709" /><CodeLine lineNumber="5709"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l05710" /><CodeLine lineNumber="5710"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getAddressComputationCost(ValTy) +</Highlight></CodeLine>
<Link id="l05711" /><CodeLine lineNumber="5711"><Highlight kind="normal">           <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMemoryOpCost(Instruction::Load, ValTy, Alignment, AS,</Highlight></CodeLine>
<Link id="l05712" /><CodeLine lineNumber="5712"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>) +</Highlight></CodeLine>
<Link id="l05713" /><CodeLine lineNumber="5713"><Highlight kind="normal">           <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getShuffleCost(<a href="/docs/api/classes/llvm/targettransforminfo/#af46433d0e36d3f80afc3a8c67b5c53ecab1ac8982cdb119f39a5fe74610a46796">TargetTransformInfo::SK&#95;Broadcast</a>, VectorTy, &#123;&#125;,</Highlight></CodeLine>
<Link id="l05714" /><CodeLine lineNumber="5714"><Highlight kind="normal">                              <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05715" /><CodeLine lineNumber="5715"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05716" /><CodeLine lineNumber="5716"><Highlight kind="normal">  StoreInst &#42;<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05717" /><CodeLine lineNumber="5717"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05718" /><CodeLine lineNumber="5718"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsLoopInvariantStoreValue = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInvariant(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getValueOperand());</Highlight></CodeLine>
<Link id="l05719" /><CodeLine lineNumber="5719"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getAddressComputationCost(ValTy) +</Highlight></CodeLine>
<Link id="l05720" /><CodeLine lineNumber="5720"><Highlight kind="normal">         <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMemoryOpCost(Instruction::Store, ValTy, Alignment, AS,</Highlight></CodeLine>
<Link id="l05721" /><CodeLine lineNumber="5721"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>) +</Highlight></CodeLine>
<Link id="l05722" /><CodeLine lineNumber="5722"><Highlight kind="normal">         (IsLoopInvariantStoreValue</Highlight></CodeLine>
<Link id="l05723" /><CodeLine lineNumber="5723"><Highlight kind="normal">              ? 0</Highlight></CodeLine>
<Link id="l05724" /><CodeLine lineNumber="5724"><Highlight kind="normal">              : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getVectorInstrCost(Instruction::ExtractElement, VectorTy,</Highlight></CodeLine>
<Link id="l05725" /><CodeLine lineNumber="5725"><Highlight kind="normal">                                       <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() - 1));</Highlight></CodeLine>
<Link id="l05726" /><CodeLine lineNumber="5726"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05727" /><CodeLine lineNumber="5727"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05728" /><CodeLine lineNumber="5728"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></Highlight></CodeLine>
<Link id="l05729" /><CodeLine lineNumber="5729"><Highlight kind="normal">LoopVectorizationCostModel::getGatherScatterCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l05730" /><CodeLine lineNumber="5730"><Highlight kind="normal">                                                 <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l05731" /><CodeLine lineNumber="5731"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ValTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05732" /><CodeLine lineNumber="5732"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VectorTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ValTy, VF));</Highlight></CodeLine>
<Link id="l05733" /><CodeLine lineNumber="5733"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/amdgpu/hsamd/kernel/arg/key/#a6b334a5f83504ebc99cc59f4f333ff98">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05734" /><CodeLine lineNumber="5734"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05735" /><CodeLine lineNumber="5735"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05736" /><CodeLine lineNumber="5736"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getAddressComputationCost(VectorTy) +</Highlight></CodeLine>
<Link id="l05737" /><CodeLine lineNumber="5737"><Highlight kind="normal">         <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getGatherScatterOpCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>,</Highlight></CodeLine>
<Link id="l05738" /><CodeLine lineNumber="5738"><Highlight kind="normal">                                    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), Alignment,</Highlight></CodeLine>
<Link id="l05739" /><CodeLine lineNumber="5739"><Highlight kind="normal">                                    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05740" /><CodeLine lineNumber="5740"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05741" /><CodeLine lineNumber="5741"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05742" /><CodeLine lineNumber="5742"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></Highlight></CodeLine>
<Link id="l05743" /><CodeLine lineNumber="5743"><Highlight kind="normal">LoopVectorizationCostModel::getInterleaveGroupCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l05744" /><CodeLine lineNumber="5744"><Highlight kind="normal">                                                   <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l05745" /><CodeLine lineNumber="5745"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Group = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c">getInterleavedAccessGroup</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05746" /><CodeLine lineNumber="5746"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Group &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Fail to get an interleaved access group.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05747" /><CodeLine lineNumber="5747"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05748" /><CodeLine lineNumber="5748"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;InsertPos = Group-&gt;getInsertPos();</Highlight></CodeLine>
<Link id="l05749" /><CodeLine lineNumber="5749"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;ValTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(InsertPos);</Highlight></CodeLine>
<Link id="l05750" /><CodeLine lineNumber="5750"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VectorTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(<a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ValTy, VF));</Highlight></CodeLine>
<Link id="l05751" /><CodeLine lineNumber="5751"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS = <a href="/docs/api/namespaces/llvm/#a0d97f0780a320d53641729a2d8371b74">getLoadStoreAddressSpace</a>(InsertPos);</Highlight></CodeLine>
<Link id="l05752" /><CodeLine lineNumber="5752"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05753" /><CodeLine lineNumber="5753"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> InterleaveFactor = Group-&gt;getFactor();</Highlight></CodeLine>
<Link id="l05754" /><CodeLine lineNumber="5754"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WideVecTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(ValTy, VF &#42; InterleaveFactor);</Highlight></CodeLine>
<Link id="l05755" /><CodeLine lineNumber="5755"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05756" /><CodeLine lineNumber="5756"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Holds the indices of existing members in the interleaved group.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05757" /><CodeLine lineNumber="5757"><Highlight kind="normal">  SmallVector&lt;unsigned, 4&gt; Indices;</Highlight></CodeLine>
<Link id="l05758" /><CodeLine lineNumber="5758"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IF = 0; <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eac5f4a93ee302ab324b2d6be4da7d1995">IF</a> &lt; InterleaveFactor; <a href="/docs/api/namespaces/llvm/amdgpuisd/#a739d53294bc38cd6b0b23332f9994c0eac5f4a93ee302ab324b2d6be4da7d1995">IF</a>++)</Highlight></CodeLine>
<Link id="l05759" /><CodeLine lineNumber="5759"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Group-&gt;getMember(IF))</Highlight></CodeLine>
<Link id="l05760" /><CodeLine lineNumber="5760"><Highlight kind="normal">      Indices.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(IF);</Highlight></CodeLine>
<Link id="l05761" /><CodeLine lineNumber="5761"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05762" /><CodeLine lineNumber="5762"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Calculate the cost of the whole interleaved group.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05763" /><CodeLine lineNumber="5763"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> UseMaskForGaps =</Highlight></CodeLine>
<Link id="l05764" /><CodeLine lineNumber="5764"><Highlight kind="normal">      (Group-&gt;requiresScalarEpilogue() &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af67062c22dbf5e0ab35164a778768476">isScalarEpilogueAllowed</a>()) ||</Highlight></CodeLine>
<Link id="l05765" /><CodeLine lineNumber="5765"><Highlight kind="normal">      (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; (Group-&gt;getNumMembers() &lt; Group-&gt;getFactor()));</Highlight></CodeLine>
<Link id="l05766" /><CodeLine lineNumber="5766"><Highlight kind="normal">  InstructionCost <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getInterleavedMemoryOpCost(</Highlight></CodeLine>
<Link id="l05767" /><CodeLine lineNumber="5767"><Highlight kind="normal">      InsertPos-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), WideVecTy, Group-&gt;getFactor(), Indices,</Highlight></CodeLine>
<Link id="l05768" /><CodeLine lineNumber="5768"><Highlight kind="normal">      Group-&gt;getAlign(), AS, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>),</Highlight></CodeLine>
<Link id="l05769" /><CodeLine lineNumber="5769"><Highlight kind="normal">      UseMaskForGaps);</Highlight></CodeLine>
<Link id="l05770" /><CodeLine lineNumber="5770"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05771" /><CodeLine lineNumber="5771"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Group-&gt;isReverse()) &#123;</Highlight></CodeLine>
<Link id="l05772" /><CodeLine lineNumber="5772"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Add support for reversed masked interleaved access.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05773" /><CodeLine lineNumber="5773"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l05774" /><CodeLine lineNumber="5774"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Reverse masked interleaved access not supported.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l05775" /><CodeLine lineNumber="5775"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += Group-&gt;getNumMembers() &#42;</Highlight></CodeLine>
<Link id="l05776" /><CodeLine lineNumber="5776"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getShuffleCost(<a href="/docs/api/classes/llvm/targettransforminfo/#af46433d0e36d3f80afc3a8c67b5c53ecaea788d98147161f25d5adc3ec6ce7e1f">TargetTransformInfo::SK&#95;Reverse</a>, VectorTy, &#123;&#125;,</Highlight></CodeLine>
<Link id="l05777" /><CodeLine lineNumber="5777"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, 0);</Highlight></CodeLine>
<Link id="l05778" /><CodeLine lineNumber="5778"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05779" /><CodeLine lineNumber="5779"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l05780" /><CodeLine lineNumber="5780"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05781" /><CodeLine lineNumber="5781"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05782" /><CodeLine lineNumber="5782"><Highlight kind="normal">std::optional&lt;InstructionCost&gt;</Highlight></CodeLine>
<Link id="l05783" /><CodeLine lineNumber="5783" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4e307866e6d65e87d1e6884b0d13306c"><Highlight kind="normal"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4e307866e6d65e87d1e6884b0d13306c">LoopVectorizationCostModel::getReductionPatternCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l05784" /><CodeLine lineNumber="5784"><Highlight kind="normal">                                                    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF,</Highlight></CodeLine>
<Link id="l05785" /><CodeLine lineNumber="5785"><Highlight kind="normal">                                                    <a href="/docs/api/classes/llvm/type">Type</a> &#42;Ty)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l05786" /><CodeLine lineNumber="5786"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</Highlight></CodeLine>
<Link id="l05787" /><CodeLine lineNumber="5787"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Early exit for no inloop reductions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05788" /><CodeLine lineNumber="5788"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InLoopReductions.empty() || VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VectorType&gt;</a>(Ty))</Highlight></CodeLine>
<Link id="l05789" /><CodeLine lineNumber="5789"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l05790" /><CodeLine lineNumber="5790"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VectorTy = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(Ty);</Highlight></CodeLine>
<Link id="l05791" /><CodeLine lineNumber="5791"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05792" /><CodeLine lineNumber="5792"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We are looking for a pattern of, and finding the minimal acceptable cost:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05793" /><CodeLine lineNumber="5793"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  reduce(mul(ext(A), ext(B))) or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05794" /><CodeLine lineNumber="5794"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  reduce(mul(A, B)) or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05795" /><CodeLine lineNumber="5795"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  reduce(ext(A)) or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05796" /><CodeLine lineNumber="5796"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  reduce(A).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05797" /><CodeLine lineNumber="5797"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The basic idea is that we walk down the tree to do that, finding the root</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05798" /><CodeLine lineNumber="5798"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reduction instruction in InLoopReductionImmediateChains. From there we find</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05799" /><CodeLine lineNumber="5799"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the pattern of mul/ext and test the cost of the entire pattern vs the cost</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05800" /><CodeLine lineNumber="5800"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of the components. If the reduction cost is lower then we return it for the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05801" /><CodeLine lineNumber="5801"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reduction instruction and 0 for the other instructions in the pattern. If</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05802" /><CodeLine lineNumber="5802"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// it is not we return an invalid cost specifying the orignal cost method</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05803" /><CodeLine lineNumber="5803"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// should be used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05804" /><CodeLine lineNumber="5804"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;RetI = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l05805" /><CodeLine lineNumber="5805"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RetI, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()))) &#123;</Highlight></CodeLine>
<Link id="l05806" /><CodeLine lineNumber="5806"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RetI-&gt;<a href="/docs/api/classes/llvm/value/#a2e987c6af902aad6baa39bd5b7ef322c">hasOneUser</a>())</Highlight></CodeLine>
<Link id="l05807" /><CodeLine lineNumber="5807"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l05808" /><CodeLine lineNumber="5808"><Highlight kind="normal">    RetI = RetI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>();</Highlight></CodeLine>
<Link id="l05809" /><CodeLine lineNumber="5809"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05810" /><CodeLine lineNumber="5810"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05811" /><CodeLine lineNumber="5811"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RetI, <a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a532515120d78196926b68c48460087ab">m&#95;Mul</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()))) &amp;&amp;</Highlight></CodeLine>
<Link id="l05812" /><CodeLine lineNumber="5812"><Highlight kind="normal">      RetI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Instruction::Add) &#123;</Highlight></CodeLine>
<Link id="l05813" /><CodeLine lineNumber="5813"><Highlight kind="normal">    RetI = RetI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6609528bd67d5506a9bf9a2cce2d6f58">user&#95;back</a>();</Highlight></CodeLine>
<Link id="l05814" /><CodeLine lineNumber="5814"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05815" /><CodeLine lineNumber="5815"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05816" /><CodeLine lineNumber="5816"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Test if the found instruction is a reduction, and if not return an invalid</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05817" /><CodeLine lineNumber="5817"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cost specifying the parent to use the original cost modelling.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05818" /><CodeLine lineNumber="5818"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!InLoopReductionImmediateChains.count(RetI))</Highlight></CodeLine>
<Link id="l05819" /><CodeLine lineNumber="5819"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> std::nullopt;</Highlight></CodeLine>
<Link id="l05820" /><CodeLine lineNumber="5820"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05821" /><CodeLine lineNumber="5821"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find the reduction this chain is a part of and calculate the basic cost of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05822" /><CodeLine lineNumber="5822"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the reduction on its own.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05823" /><CodeLine lineNumber="5823"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;LastChain = InLoopReductionImmediateChains.at(RetI);</Highlight></CodeLine>
<Link id="l05824" /><CodeLine lineNumber="5824"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ReductionPhi = LastChain;</Highlight></CodeLine>
<Link id="l05825" /><CodeLine lineNumber="5825"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(ReductionPhi))</Highlight></CodeLine>
<Link id="l05826" /><CodeLine lineNumber="5826"><Highlight kind="normal">    ReductionPhi = InLoopReductionImmediateChains.at(ReductionPhi);</Highlight></CodeLine>
<Link id="l05827" /><CodeLine lineNumber="5827"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05828" /><CodeLine lineNumber="5828"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc =</Highlight></CodeLine>
<Link id="l05829" /><CodeLine lineNumber="5829"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars().find(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(ReductionPhi))-&gt;second;</Highlight></CodeLine>
<Link id="l05830" /><CodeLine lineNumber="5830"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05831" /><CodeLine lineNumber="5831"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> BaseCost;</Highlight></CodeLine>
<Link id="l05832" /><CodeLine lineNumber="5832"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> RK = RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>();</Highlight></CodeLine>
<Link id="l05833" /><CodeLine lineNumber="5833"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#af08d243545b64f4b77161992d0e2366e">RecurrenceDescriptor::isMinMaxRecurrenceKind</a>(RK)) &#123;</Highlight></CodeLine>
<Link id="l05834" /><CodeLine lineNumber="5834"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> MinMaxID = <a href="/docs/api/namespaces/llvm/#a0e4b6546560e7fb6d37f6318d3236bb9">getMinMaxReductionIntrinsicOp</a>(RK);</Highlight></CodeLine>
<Link id="l05835" /><CodeLine lineNumber="5835"><Highlight kind="normal">    BaseCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMinMaxReductionCost(MinMaxID, VectorTy,</Highlight></CodeLine>
<Link id="l05836" /><CodeLine lineNumber="5836"><Highlight kind="normal">                                          RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a0d5c759e770c1c6032d077a1b9cf7172">getFastMathFlags</a>(), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05837" /><CodeLine lineNumber="5837"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l05838" /><CodeLine lineNumber="5838"><Highlight kind="normal">    BaseCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticReductionCost(</Highlight></CodeLine>
<Link id="l05839" /><CodeLine lineNumber="5839"><Highlight kind="normal">        RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a30ee597b72598bc7939d3a40d2a5ba20">getOpcode</a>(), VectorTy, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a0d5c759e770c1c6032d077a1b9cf7172">getFastMathFlags</a>(), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05840" /><CodeLine lineNumber="5840"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05841" /><CodeLine lineNumber="5841"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05842" /><CodeLine lineNumber="5842"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For a call to the llvm.fmuladd intrinsic we need to add the cost of a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05843" /><CodeLine lineNumber="5843"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// normal fmul instruction to the cost of the fadd reduction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05844" /><CodeLine lineNumber="5844"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RK == <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaa7dad289ea38506fb1c9b5b148405d0c">RecurKind::FMulAdd</a>)</Highlight></CodeLine>
<Link id="l05845" /><CodeLine lineNumber="5845"><Highlight kind="normal">    BaseCost +=</Highlight></CodeLine>
<Link id="l05846" /><CodeLine lineNumber="5846"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(Instruction::FMul, VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05847" /><CodeLine lineNumber="5847"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05848" /><CodeLine lineNumber="5848"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we&#39;re using ordered reductions then we can just return the base cost</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05849" /><CodeLine lineNumber="5849"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// here, since getArithmeticReductionCost calculates the full ordered</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05850" /><CodeLine lineNumber="5850"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reduction cost when FP reassociation is not allowed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05851" /><CodeLine lineNumber="5851"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad508b8cfa31c0e7a1ac8f9d733bb8eed">useOrderedReductions</a>(RdxDesc))</Highlight></CodeLine>
<Link id="l05852" /><CodeLine lineNumber="5852"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BaseCost;</Highlight></CodeLine>
<Link id="l05853" /><CodeLine lineNumber="5853"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05854" /><CodeLine lineNumber="5854"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get the operand that was not the reduction chain and match it to one of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05855" /><CodeLine lineNumber="5855"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// patterns, returning the better cost if it is found.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05856" /><CodeLine lineNumber="5856"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;RedOp = RetI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1) == LastChain</Highlight></CodeLine>
<Link id="l05857" /><CodeLine lineNumber="5857"><Highlight kind="normal">                           ? <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(RetI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0))</Highlight></CodeLine>
<Link id="l05858" /><CodeLine lineNumber="5858"><Highlight kind="normal">                           : <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(RetI-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(1));</Highlight></CodeLine>
<Link id="l05859" /><CodeLine lineNumber="5859"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05860" /><CodeLine lineNumber="5860"><Highlight kind="normal">  VectorTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType(), VectorTy);</Highlight></CodeLine>
<Link id="l05861" /><CodeLine lineNumber="5861"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05862" /><CodeLine lineNumber="5862"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Op0, &#42;Op1;</Highlight></CodeLine>
<Link id="l05863" /><CodeLine lineNumber="5863"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RedOp &amp;&amp; RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a30ee597b72598bc7939d3a40d2a5ba20">getOpcode</a>() == Instruction::Add &amp;&amp;</Highlight></CodeLine>
<Link id="l05864" /><CodeLine lineNumber="5864"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RedOp,</Highlight></CodeLine>
<Link id="l05865" /><CodeLine lineNumber="5865"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a532515120d78196926b68c48460087ab">m&#95;Mul</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(Op1)))) &amp;&amp;</Highlight></CodeLine>
<Link id="l05866" /><CodeLine lineNumber="5866"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())) &amp;&amp;</Highlight></CodeLine>
<Link id="l05867" /><CodeLine lineNumber="5867"><Highlight kind="normal">      Op0-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Op1-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l05868" /><CodeLine lineNumber="5868"><Highlight kind="normal">      Op0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() == Op1-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l05869" /><CodeLine lineNumber="5869"><Highlight kind="normal">      !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(Op0) &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(Op1) &amp;&amp;</Highlight></CodeLine>
<Link id="l05870" /><CodeLine lineNumber="5870"><Highlight kind="normal">      (Op0-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == RedOp-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() || Op0 == Op1)) &#123;</Highlight></CodeLine>
<Link id="l05871" /><CodeLine lineNumber="5871"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05872" /><CodeLine lineNumber="5872"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Matched reduce.add(ext(mul(ext(A), ext(B)))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05873" /><CodeLine lineNumber="5873"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Note that the extend opcodes need to all match, or if A==B they will have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05874" /><CodeLine lineNumber="5874"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// been converted to zext(mul(sext(A), sext(A))) as it is known positive,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05875" /><CodeLine lineNumber="5875"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// which is equally fine.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05876" /><CodeLine lineNumber="5876"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsUnsigned = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(Op0);</Highlight></CodeLine>
<Link id="l05877" /><CodeLine lineNumber="5877"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExtType = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Op0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), VectorTy);</Highlight></CodeLine>
<Link id="l05878" /><CodeLine lineNumber="5878"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MulType = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Op0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), VectorTy);</Highlight></CodeLine>
<Link id="l05879" /><CodeLine lineNumber="5879"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05880" /><CodeLine lineNumber="5880"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ExtCost =</Highlight></CodeLine>
<Link id="l05881" /><CodeLine lineNumber="5881"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(Op0-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), MulType, ExtType,</Highlight></CodeLine>
<Link id="l05882" /><CodeLine lineNumber="5882"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, Op0);</Highlight></CodeLine>
<Link id="l05883" /><CodeLine lineNumber="5883"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> MulCost =</Highlight></CodeLine>
<Link id="l05884" /><CodeLine lineNumber="5884"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(Instruction::Mul, MulType, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05885" /><CodeLine lineNumber="5885"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> Ext2Cost =</Highlight></CodeLine>
<Link id="l05886" /><CodeLine lineNumber="5886"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(RedOp-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), VectorTy, MulType,</Highlight></CodeLine>
<Link id="l05887" /><CodeLine lineNumber="5887"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, RedOp);</Highlight></CodeLine>
<Link id="l05888" /><CodeLine lineNumber="5888"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05889" /><CodeLine lineNumber="5889"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMulAccReductionCost(</Highlight></CodeLine>
<Link id="l05890" /><CodeLine lineNumber="5890"><Highlight kind="normal">        IsUnsigned, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>(), ExtType, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05891" /><CodeLine lineNumber="5891"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05892" /><CodeLine lineNumber="5892"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RedCost.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l05893" /><CodeLine lineNumber="5893"><Highlight kind="normal">        RedCost &lt; ExtCost &#42; 2 + MulCost + Ext2Cost + BaseCost)</Highlight></CodeLine>
<Link id="l05894" /><CodeLine lineNumber="5894"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == RetI ? RedCost : 0;</Highlight></CodeLine>
<Link id="l05895" /><CodeLine lineNumber="5895"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RedOp &amp;&amp; <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RedOp, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())) &amp;&amp;</Highlight></CodeLine>
<Link id="l05896" /><CodeLine lineNumber="5896"><Highlight kind="normal">             !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(RedOp)) &#123;</Highlight></CodeLine>
<Link id="l05897" /><CodeLine lineNumber="5897"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Matched reduce(ext(A))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05898" /><CodeLine lineNumber="5898"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsUnsigned = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(RedOp);</Highlight></CodeLine>
<Link id="l05899" /><CodeLine lineNumber="5899"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExtType = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(RedOp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), VectorTy);</Highlight></CodeLine>
<Link id="l05900" /><CodeLine lineNumber="5900"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getExtendedReductionCost(</Highlight></CodeLine>
<Link id="l05901" /><CodeLine lineNumber="5901"><Highlight kind="normal">        RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a30ee597b72598bc7939d3a40d2a5ba20">getOpcode</a>(), IsUnsigned, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>(), ExtType,</Highlight></CodeLine>
<Link id="l05902" /><CodeLine lineNumber="5902"><Highlight kind="normal">        RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a0d5c759e770c1c6032d077a1b9cf7172">getFastMathFlags</a>(), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05903" /><CodeLine lineNumber="5903"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05904" /><CodeLine lineNumber="5904"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ExtCost =</Highlight></CodeLine>
<Link id="l05905" /><CodeLine lineNumber="5905"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(RedOp-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), VectorTy, ExtType,</Highlight></CodeLine>
<Link id="l05906" /><CodeLine lineNumber="5906"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, RedOp);</Highlight></CodeLine>
<Link id="l05907" /><CodeLine lineNumber="5907"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RedCost.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>() &amp;&amp; RedCost &lt; BaseCost + ExtCost)</Highlight></CodeLine>
<Link id="l05908" /><CodeLine lineNumber="5908"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == RetI ? RedCost : 0;</Highlight></CodeLine>
<Link id="l05909" /><CodeLine lineNumber="5909"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RedOp &amp;&amp; RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a30ee597b72598bc7939d3a40d2a5ba20">getOpcode</a>() == Instruction::Add &amp;&amp;</Highlight></CodeLine>
<Link id="l05910" /><CodeLine lineNumber="5910"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(RedOp, <a href="/docs/api/namespaces/llvm/patternmatch/#a532515120d78196926b68c48460087ab">m&#95;Mul</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#a2adca0e23c974dbb32019dccb22547bc">m&#95;Instruction</a>(Op1)))) &#123;</Highlight></CodeLine>
<Link id="l05911" /><CodeLine lineNumber="5911"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Op0, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>())) &amp;&amp;</Highlight></CodeLine>
<Link id="l05912" /><CodeLine lineNumber="5912"><Highlight kind="normal">        Op0-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() == Op1-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l05913" /><CodeLine lineNumber="5913"><Highlight kind="normal">        !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(Op0) &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(Op1)) &#123;</Highlight></CodeLine>
<Link id="l05914" /><CodeLine lineNumber="5914"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsUnsigned = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ZExtInst&gt;</a>(Op0);</Highlight></CodeLine>
<Link id="l05915" /><CodeLine lineNumber="5915"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;Op0Ty = Op0-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l05916" /><CodeLine lineNumber="5916"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;Op1Ty = Op1-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l05917" /><CodeLine lineNumber="5917"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;LargestOpTy =</Highlight></CodeLine>
<Link id="l05918" /><CodeLine lineNumber="5918"><Highlight kind="normal">          Op0Ty-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() &lt; Op1Ty-&gt;<a href="/docs/api/classes/llvm/type/#a13e877ef779ba7a0688081079f4f9b03">getIntegerBitWidth</a>() ? Op1Ty</Highlight></CodeLine>
<Link id="l05919" /><CodeLine lineNumber="5919"><Highlight kind="normal">                                                                    : Op0Ty;</Highlight></CodeLine>
<Link id="l05920" /><CodeLine lineNumber="5920"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExtType = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(LargestOpTy, VectorTy);</Highlight></CodeLine>
<Link id="l05921" /><CodeLine lineNumber="5921"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05922" /><CodeLine lineNumber="5922"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Matched reduce.add(mul(ext(A), ext(B))), where the two ext may be of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05923" /><CodeLine lineNumber="5923"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// different sizes. We take the largest type as the ext to reduce, and add</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05924" /><CodeLine lineNumber="5924"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the remaining cost as, for example reduce(mul(ext(ext(A)), ext(B))).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05925" /><CodeLine lineNumber="5925"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ExtCost0 = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(</Highlight></CodeLine>
<Link id="l05926" /><CodeLine lineNumber="5926"><Highlight kind="normal">          Op0-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), VectorTy, <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Op0Ty, VectorTy),</Highlight></CodeLine>
<Link id="l05927" /><CodeLine lineNumber="5927"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, Op0);</Highlight></CodeLine>
<Link id="l05928" /><CodeLine lineNumber="5928"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ExtCost1 = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(</Highlight></CodeLine>
<Link id="l05929" /><CodeLine lineNumber="5929"><Highlight kind="normal">          Op1-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), VectorTy, <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(Op1Ty, VectorTy),</Highlight></CodeLine>
<Link id="l05930" /><CodeLine lineNumber="5930"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, Op1);</Highlight></CodeLine>
<Link id="l05931" /><CodeLine lineNumber="5931"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> MulCost =</Highlight></CodeLine>
<Link id="l05932" /><CodeLine lineNumber="5932"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(Instruction::Mul, VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05933" /><CodeLine lineNumber="5933"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05934" /><CodeLine lineNumber="5934"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMulAccReductionCost(</Highlight></CodeLine>
<Link id="l05935" /><CodeLine lineNumber="5935"><Highlight kind="normal">          IsUnsigned, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>(), ExtType, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05936" /><CodeLine lineNumber="5936"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ExtraExtCost = 0;</Highlight></CodeLine>
<Link id="l05937" /><CodeLine lineNumber="5937"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op0Ty != LargestOpTy || Op1Ty != LargestOpTy) &#123;</Highlight></CodeLine>
<Link id="l05938" /><CodeLine lineNumber="5938"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;ExtraExtOp = (Op0Ty != LargestOpTy) ? Op0 : Op1;</Highlight></CodeLine>
<Link id="l05939" /><CodeLine lineNumber="5939"><Highlight kind="normal">        ExtraExtCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(</Highlight></CodeLine>
<Link id="l05940" /><CodeLine lineNumber="5940"><Highlight kind="normal">            ExtraExtOp-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), ExtType,</Highlight></CodeLine>
<Link id="l05941" /><CodeLine lineNumber="5941"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(ExtraExtOp-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), VectorTy),</Highlight></CodeLine>
<Link id="l05942" /><CodeLine lineNumber="5942"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, ExtraExtOp);</Highlight></CodeLine>
<Link id="l05943" /><CodeLine lineNumber="5943"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l05944" /><CodeLine lineNumber="5944"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05945" /><CodeLine lineNumber="5945"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RedCost.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l05946" /><CodeLine lineNumber="5946"><Highlight kind="normal">          (RedCost + ExtraExtCost) &lt; (ExtCost0 + ExtCost1 + MulCost + BaseCost))</Highlight></CodeLine>
<Link id="l05947" /><CodeLine lineNumber="5947"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == RetI ? RedCost : 0;</Highlight></CodeLine>
<Link id="l05948" /><CodeLine lineNumber="5948"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>()))) &#123;</Highlight></CodeLine>
<Link id="l05949" /><CodeLine lineNumber="5949"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Matched reduce.add(mul())</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05950" /><CodeLine lineNumber="5950"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> MulCost =</Highlight></CodeLine>
<Link id="l05951" /><CodeLine lineNumber="5951"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(Instruction::Mul, VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05952" /><CodeLine lineNumber="5952"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05953" /><CodeLine lineNumber="5953"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getMulAccReductionCost(</Highlight></CodeLine>
<Link id="l05954" /><CodeLine lineNumber="5954"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>(), VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l05955" /><CodeLine lineNumber="5955"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05956" /><CodeLine lineNumber="5956"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RedCost.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>() &amp;&amp; RedCost &lt; MulCost + BaseCost)</Highlight></CodeLine>
<Link id="l05957" /><CodeLine lineNumber="5957"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == RetI ? RedCost : 0;</Highlight></CodeLine>
<Link id="l05958" /><CodeLine lineNumber="5958"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l05959" /><CodeLine lineNumber="5959"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05960" /><CodeLine lineNumber="5960"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05961" /><CodeLine lineNumber="5961"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> == RetI ? std::optional&lt;InstructionCost&gt;(BaseCost) : std::nullopt;</Highlight></CodeLine>
<Link id="l05962" /><CodeLine lineNumber="5962"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05963" /><CodeLine lineNumber="5963"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05964" /><CodeLine lineNumber="5964"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></Highlight></CodeLine>
<Link id="l05965" /><CodeLine lineNumber="5965"><Highlight kind="normal">LoopVectorizationCostModel::getMemoryInstructionCost(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l05966" /><CodeLine lineNumber="5966"><Highlight kind="normal">                                                     <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l05967" /><CodeLine lineNumber="5967"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Calculate scalar cost only. Vectorization cost should be ready at this</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05968" /><CodeLine lineNumber="5968"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// moment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05969" /><CodeLine lineNumber="5969"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>()) &#123;</Highlight></CodeLine>
<Link id="l05970" /><CodeLine lineNumber="5970"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ValTy = <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05971" /><CodeLine lineNumber="5971"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/align">Align</a> Alignment = <a href="/docs/api/namespaces/llvm/#a4370c1523db2ede8d9791b76da2ab798">getLoadStoreAlignment</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05972" /><CodeLine lineNumber="5972"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AS = <a href="/docs/api/namespaces/llvm/#a0d97f0780a320d53641729a2d8371b74">getLoadStoreAddressSpace</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05973" /><CodeLine lineNumber="5973"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05974" /><CodeLine lineNumber="5974"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/targettransforminfo/operandvalueinfo">TTI::OperandValueInfo</a> OpInfo = <a href="/docs/api/classes/llvm/targettransforminfo/#a5fecba95c1ba20950ea8e2139127e621">TTI::getOperandInfo</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l05975" /><CodeLine lineNumber="5975"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getAddressComputationCost(ValTy) +</Highlight></CodeLine>
<Link id="l05976" /><CodeLine lineNumber="5976"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getMemoryOpCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), ValTy, Alignment, AS, <a href="/docs/api/files/lib/lib/analysis/costmodel-cpp/#a162d8b2b3865594d1e14d828d2b8336a">CostKind</a>,</Highlight></CodeLine>
<Link id="l05977" /><CodeLine lineNumber="5977"><Highlight kind="normal">                               OpInfo, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l05978" /><CodeLine lineNumber="5978"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l05979" /><CodeLine lineNumber="5979"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af7844564539b9f0f917e8f2380a064b3">getWideningCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l05980" /><CodeLine lineNumber="5980"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l05981" /><CodeLine lineNumber="5981"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05982" /><CodeLine lineNumber="5982"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></Highlight></CodeLine>
<Link id="l05983" /><CodeLine lineNumber="5983"><Highlight kind="normal">LoopVectorizationCostModel::getScalarizationOverhead(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l05984" /><CodeLine lineNumber="5984"><Highlight kind="normal">                                                     <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l05985" /><CodeLine lineNumber="5985"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05986" /><CodeLine lineNumber="5986"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// There is no mechanism yet to create a scalable scalarization loop,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05987" /><CodeLine lineNumber="5987"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// so this is currently Invalid.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05988" /><CodeLine lineNumber="5988"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</Highlight></CodeLine>
<Link id="l05989" /><CodeLine lineNumber="5989"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l05990" /><CodeLine lineNumber="5990"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05991" /><CodeLine lineNumber="5991"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</Highlight></CodeLine>
<Link id="l05992" /><CodeLine lineNumber="5992"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 0;</Highlight></CodeLine>
<Link id="l05993" /><CodeLine lineNumber="5993"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l05994" /><CodeLine lineNumber="5994"><Highlight kind="normal">  InstructionCost <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = 0;</Highlight></CodeLine>
<Link id="l05995" /><CodeLine lineNumber="5995"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;RetTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), VF);</Highlight></CodeLine>
<Link id="l05996" /><CodeLine lineNumber="5996"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RetTy-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l05997" /><CodeLine lineNumber="5997"><Highlight kind="normal">      (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.supportsEfficientVectorElementLoadStore()))</Highlight></CodeLine>
<Link id="l05998" /><CodeLine lineNumber="5998"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getScalarizationOverhead(</Highlight></CodeLine>
<Link id="l05999" /><CodeLine lineNumber="5999"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(RetTy), <a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>()),</Highlight></CodeLine>
<Link id="l06000" /><CodeLine lineNumber="6000"><Highlight kind="normal">        </Highlight><Highlight kind="comment">/&#42;Insert&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l06001" /><CodeLine lineNumber="6001"><Highlight kind="normal">        </Highlight><Highlight kind="comment">/&#42;Extract&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l06002" /><CodeLine lineNumber="6002"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06003" /><CodeLine lineNumber="6003"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Some targets keep addresses scalar.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06004" /><CodeLine lineNumber="6004"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.prefersVectorizedAddressing())</Highlight></CodeLine>
<Link id="l06005" /><CodeLine lineNumber="6005"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l06006" /><CodeLine lineNumber="6006"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06007" /><CodeLine lineNumber="6007"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Some targets support efficient element stores.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06008" /><CodeLine lineNumber="6008"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.supportsEfficientVectorElementLoadStore())</Highlight></CodeLine>
<Link id="l06009" /><CodeLine lineNumber="6009"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l06010" /><CodeLine lineNumber="6010"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06011" /><CodeLine lineNumber="6011"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect operands to consider.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06012" /><CodeLine lineNumber="6012"><Highlight kind="normal">  CallInst &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06013" /><CodeLine lineNumber="6013"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/user/#a917548288129e24325af275795e4622f">Instruction::op&#95;range</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a> = CI ? CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>() : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands();</Highlight></CodeLine>
<Link id="l06014" /><CodeLine lineNumber="6014"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06015" /><CodeLine lineNumber="6015"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Skip operands that do not require extraction/scalarization and do not incur</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06016" /><CodeLine lineNumber="6016"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// any overhead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06017" /><CodeLine lineNumber="6017"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;Type &#42;&gt;</a> <a href="/docs/api/namespaces/llvm/intrinsic/#a042f275033dbeb7761b82e5368e871bf">Tys</a>;</Highlight></CodeLine>
<Link id="l06018" /><CodeLine lineNumber="6018"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;V : filterExtractingOperands(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, VF))</Highlight></CodeLine>
<Link id="l06019" /><CodeLine lineNumber="6019"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/intrinsic/#a042f275033dbeb7761b82e5368e871bf">Tys</a>.push&#95;back(<a href="#a83114915b4f7fec94a20efa3834a8250">maybeVectorizeType</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType(), VF));</Highlight></CodeLine>
<Link id="l06020" /><CodeLine lineNumber="6020"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> + <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getOperandsScalarizationOverhead(</Highlight></CodeLine>
<Link id="l06021" /><CodeLine lineNumber="6021"><Highlight kind="normal">                    filterExtractingOperands(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, VF), Tys, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l06022" /><CodeLine lineNumber="6022"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06023" /><CodeLine lineNumber="6023"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06024" /><CodeLine lineNumber="6024" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae8d11752355845a0e271111de7be7d3a"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ae8d11752355845a0e271111de7be7d3a">LoopVectorizationCostModel::setCostBasedWideningDecision</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l06025" /><CodeLine lineNumber="6025"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</Highlight></CodeLine>
<Link id="l06026" /><CodeLine lineNumber="6026"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06027" /><CodeLine lineNumber="6027"><Highlight kind="normal">  NumPredStores = 0;</Highlight></CodeLine>
<Link id="l06028" /><CodeLine lineNumber="6028"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks()) &#123;</Highlight></CodeLine>
<Link id="l06029" /><CodeLine lineNumber="6029"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For each instruction in the old loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06030" /><CodeLine lineNumber="6030"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l06031" /><CodeLine lineNumber="6031"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> =  <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06032" /><CodeLine lineNumber="6032"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>)</Highlight></CodeLine>
<Link id="l06033" /><CodeLine lineNumber="6033"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06034" /><CodeLine lineNumber="6034"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06035" /><CodeLine lineNumber="6035"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: We should generate better code and update the cost model for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06036" /><CodeLine lineNumber="6036"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// predicated uniform stores. Today they are treated as any other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06037" /><CodeLine lineNumber="6037"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// predicated store (see added test cases in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06038" /><CodeLine lineNumber="6038"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// invariant-store-vectorization.ll).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06039" /><CodeLine lineNumber="6039"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ac864682b9dcdc0ce83df845bf6cfb2e8">isScalarWithPredication</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</Highlight></CodeLine>
<Link id="l06040" /><CodeLine lineNumber="6040"><Highlight kind="normal">        NumPredStores++;</Highlight></CodeLine>
<Link id="l06041" /><CodeLine lineNumber="6041"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06042" /><CodeLine lineNumber="6042"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isUniformMemOp(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</Highlight></CodeLine>
<Link id="l06043" /><CodeLine lineNumber="6043"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsLegalToScalarize = &#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l06044" /><CodeLine lineNumber="6044"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</Highlight></CodeLine>
<Link id="l06045" /><CodeLine lineNumber="6045"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// Scalarization of fixed length vectors &quot;just works&quot;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06046" /><CodeLine lineNumber="6046"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06047" /><CodeLine lineNumber="6047"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06048" /><CodeLine lineNumber="6048"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// We have dedicated lowering for unpredicated uniform loads and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06049" /><CodeLine lineNumber="6049"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// stores.  Note that even with tail folding we know that at least</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06050" /><CodeLine lineNumber="6050"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// one lane is active (i.e. generalized predication is not possible</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06051" /><CodeLine lineNumber="6051"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// here), and the logic below depends on this fact.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06052" /><CodeLine lineNumber="6052"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba">foldTailByMasking</a>())</Highlight></CodeLine>
<Link id="l06053" /><CodeLine lineNumber="6053"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06054" /><CodeLine lineNumber="6054"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06055" /><CodeLine lineNumber="6055"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// For scalable vectors, a uniform memop load is always</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06056" /><CodeLine lineNumber="6056"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// uniform-by-parts  and we know how to scalarize that.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06057" /><CodeLine lineNumber="6057"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l06058" /><CodeLine lineNumber="6058"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06059" /><CodeLine lineNumber="6059"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06060" /><CodeLine lineNumber="6060"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// A uniform store isn&#39;t neccessarily uniform-by-part</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06061" /><CodeLine lineNumber="6061"><Highlight kind="normal">          </Highlight><Highlight kind="comment">// and we can&#39;t assume scalarization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06062" /><CodeLine lineNumber="6062"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06063" /><CodeLine lineNumber="6063"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(<a href="/docs/api/namespaces/llvm/si">SI</a>.getValueOperand());</Highlight></CodeLine>
<Link id="l06064" /><CodeLine lineNumber="6064"><Highlight kind="normal">        &#125;;</Highlight></CodeLine>
<Link id="l06065" /><CodeLine lineNumber="6065"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06066" /><CodeLine lineNumber="6066"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> GatherScatterCost =</Highlight></CodeLine>
<Link id="l06067" /><CodeLine lineNumber="6067"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa650124eefba1fd45866d05306385129">isLegalGatherOrScatter</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) ?</Highlight></CodeLine>
<Link id="l06068" /><CodeLine lineNumber="6068"><Highlight kind="normal">          getGatherScatterCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) : <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l06069" /><CodeLine lineNumber="6069"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06070" /><CodeLine lineNumber="6070"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Load: Scalar load + broadcast</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06071" /><CodeLine lineNumber="6071"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Store: Scalar store + isLoopInvariantStoreValue ? 0 : extract</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06072" /><CodeLine lineNumber="6072"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// FIXME: This cost is a significant under-estimate for tail folded</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06073" /><CodeLine lineNumber="6073"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// memory ops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06074" /><CodeLine lineNumber="6074"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarizationCost =</Highlight></CodeLine>
<Link id="l06075" /><CodeLine lineNumber="6075"><Highlight kind="normal">            IsLegalToScalarize() ? getUniformMemOpCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)</Highlight></CodeLine>
<Link id="l06076" /><CodeLine lineNumber="6076"><Highlight kind="normal">                                 : <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l06077" /><CodeLine lineNumber="6077"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06078" /><CodeLine lineNumber="6078"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Choose better solution for the current VF,  Note that Invalid</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06079" /><CodeLine lineNumber="6079"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// costs compare as maximumal large.  If both are invalid, we get</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06080" /><CodeLine lineNumber="6080"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// scalable invalid which signals a failure and a vectorization abort.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06081" /><CodeLine lineNumber="6081"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GatherScatterCost &lt; ScalarizationCost)</Highlight></CodeLine>
<Link id="l06082" /><CodeLine lineNumber="6082"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ae849d400780f51424bc4e4c26ddf3000">CM&#95;GatherScatter</a>, GatherScatterCost);</Highlight></CodeLine>
<Link id="l06083" /><CodeLine lineNumber="6083"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06084" /><CodeLine lineNumber="6084"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>, ScalarizationCost);</Highlight></CodeLine>
<Link id="l06085" /><CodeLine lineNumber="6085"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06086" /><CodeLine lineNumber="6086"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06087" /><CodeLine lineNumber="6087"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06088" /><CodeLine lineNumber="6088"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We assume that widening is the best solution when possible.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06089" /><CodeLine lineNumber="6089"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a59a6dd7531c8683174f886ff7698cc63">memoryInstructionCanBeWidened</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</Highlight></CodeLine>
<Link id="l06090" /><CodeLine lineNumber="6090"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = getConsecutiveMemOpCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l06091" /><CodeLine lineNumber="6091"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">int</Highlight><Highlight kind="normal"> ConsecutiveStride = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isConsecutivePtr(</Highlight></CodeLine>
<Link id="l06092" /><CodeLine lineNumber="6092"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l06093" /><CodeLine lineNumber="6093"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((ConsecutiveStride == 1 || ConsecutiveStride == -1) &amp;&amp;</Highlight></CodeLine>
<Link id="l06094" /><CodeLine lineNumber="6094"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;Expected consecutive stride.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06095" /><CodeLine lineNumber="6095"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> Decision =</Highlight></CodeLine>
<Link id="l06096" /><CodeLine lineNumber="6096"><Highlight kind="normal">            ConsecutiveStride == 1 ? <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260adc468760c02910f77bad7525bc66c334">CM&#95;Widen</a> : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a058eacbd3c28e2ecec2af7db726ce527">CM&#95;Widen&#95;Reverse</a>;</Highlight></CodeLine>
<Link id="l06097" /><CodeLine lineNumber="6097"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, Decision, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>);</Highlight></CodeLine>
<Link id="l06098" /><CodeLine lineNumber="6098"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06099" /><CodeLine lineNumber="6099"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06100" /><CodeLine lineNumber="6100"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06101" /><CodeLine lineNumber="6101"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Choose between Interleaving, Gather/Scatter or Scalarization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06102" /><CodeLine lineNumber="6102"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> InterleaveCost = <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l06103" /><CodeLine lineNumber="6103"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumAccesses = 1;</Highlight></CodeLine>
<Link id="l06104" /><CodeLine lineNumber="6104"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85e3110b9fe54caf00fe4297d1b4f0b6">isAccessInterleaved</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l06105" /><CodeLine lineNumber="6105"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Group = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c">getInterleavedAccessGroup</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06106" /><CodeLine lineNumber="6106"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Group &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Fail to get an interleaved access group.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06107" /><CodeLine lineNumber="6107"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06108" /><CodeLine lineNumber="6108"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Make one decision for the whole group.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06109" /><CodeLine lineNumber="6109"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">CM&#95;Unknown</a>)</Highlight></CodeLine>
<Link id="l06110" /><CodeLine lineNumber="6110"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06111" /><CodeLine lineNumber="6111"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06112" /><CodeLine lineNumber="6112"><Highlight kind="normal">        NumAccesses = Group-&gt;getNumMembers();</Highlight></CodeLine>
<Link id="l06113" /><CodeLine lineNumber="6113"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5964ce9ba38fe5a4d372242ac39e3f1d">interleavedAccessCanBeWidened</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</Highlight></CodeLine>
<Link id="l06114" /><CodeLine lineNumber="6114"><Highlight kind="normal">          InterleaveCost = getInterleaveGroupCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l06115" /><CodeLine lineNumber="6115"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06116" /><CodeLine lineNumber="6116"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06117" /><CodeLine lineNumber="6117"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> GatherScatterCost =</Highlight></CodeLine>
<Link id="l06118" /><CodeLine lineNumber="6118"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa650124eefba1fd45866d05306385129">isLegalGatherOrScatter</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)</Highlight></CodeLine>
<Link id="l06119" /><CodeLine lineNumber="6119"><Highlight kind="normal">              ? getGatherScatterCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) &#42; NumAccesses</Highlight></CodeLine>
<Link id="l06120" /><CodeLine lineNumber="6120"><Highlight kind="normal">              : <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l06121" /><CodeLine lineNumber="6121"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06122" /><CodeLine lineNumber="6122"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarizationCost =</Highlight></CodeLine>
<Link id="l06123" /><CodeLine lineNumber="6123"><Highlight kind="normal">          getMemInstScalarizationCost(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) &#42; NumAccesses;</Highlight></CodeLine>
<Link id="l06124" /><CodeLine lineNumber="6124"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06125" /><CodeLine lineNumber="6125"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Choose better solution for the current VF,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06126" /><CodeLine lineNumber="6126"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// write down this decision and use it during vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06127" /><CodeLine lineNumber="6127"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l06128" /><CodeLine lineNumber="6128"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> Decision;</Highlight></CodeLine>
<Link id="l06129" /><CodeLine lineNumber="6129"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InterleaveCost &lt;= GatherScatterCost &amp;&amp;</Highlight></CodeLine>
<Link id="l06130" /><CodeLine lineNumber="6130"><Highlight kind="normal">          InterleaveCost &lt; ScalarizationCost) &#123;</Highlight></CodeLine>
<Link id="l06131" /><CodeLine lineNumber="6131"><Highlight kind="normal">        Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971">CM&#95;Interleave</a>;</Highlight></CodeLine>
<Link id="l06132" /><CodeLine lineNumber="6132"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = InterleaveCost;</Highlight></CodeLine>
<Link id="l06133" /><CodeLine lineNumber="6133"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (GatherScatterCost &lt; ScalarizationCost) &#123;</Highlight></CodeLine>
<Link id="l06134" /><CodeLine lineNumber="6134"><Highlight kind="normal">        Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ae849d400780f51424bc4e4c26ddf3000">CM&#95;GatherScatter</a>;</Highlight></CodeLine>
<Link id="l06135" /><CodeLine lineNumber="6135"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = GatherScatterCost;</Highlight></CodeLine>
<Link id="l06136" /><CodeLine lineNumber="6136"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06137" /><CodeLine lineNumber="6137"><Highlight kind="normal">        Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>;</Highlight></CodeLine>
<Link id="l06138" /><CodeLine lineNumber="6138"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = ScalarizationCost;</Highlight></CodeLine>
<Link id="l06139" /><CodeLine lineNumber="6139"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06140" /><CodeLine lineNumber="6140"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the instructions belongs to an interleave group, the whole group</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06141" /><CodeLine lineNumber="6141"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// receives the same decision. The whole group receives the cost, but</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06142" /><CodeLine lineNumber="6142"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the cost will actually be assigned to one instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06143" /><CodeLine lineNumber="6143"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Group = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c">getInterleavedAccessGroup</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l06144" /><CodeLine lineNumber="6144"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(Group, VF, Decision, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>);</Highlight></CodeLine>
<Link id="l06145" /><CodeLine lineNumber="6145"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06146" /><CodeLine lineNumber="6146"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, Decision, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>);</Highlight></CodeLine>
<Link id="l06147" /><CodeLine lineNumber="6147"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06148" /><CodeLine lineNumber="6148"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06149" /><CodeLine lineNumber="6149"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06150" /><CodeLine lineNumber="6150"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Make sure that any load of address and any other address computation</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06151" /><CodeLine lineNumber="6151"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// remains scalar unless there is gather/scatter support. This avoids</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06152" /><CodeLine lineNumber="6152"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// inevitable extracts into address registers, and also has the benefit of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06153" /><CodeLine lineNumber="6153"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// activating LSR more, since that pass can&#39;t optimize vectorized</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06154" /><CodeLine lineNumber="6154"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// addresses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06155" /><CodeLine lineNumber="6155"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.prefersVectorizedAddressing())</Highlight></CodeLine>
<Link id="l06156" /><CodeLine lineNumber="6156"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06157" /><CodeLine lineNumber="6157"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06158" /><CodeLine lineNumber="6158"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Start with all scalar pointer uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06159" /><CodeLine lineNumber="6159"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;Instruction &#42;, 8&gt;</a> AddrDefs;</Highlight></CodeLine>
<Link id="l06160" /><CodeLine lineNumber="6160"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks())</Highlight></CodeLine>
<Link id="l06161" /><CodeLine lineNumber="6161"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l06162" /><CodeLine lineNumber="6162"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PtrDef =</Highlight></CodeLine>
<Link id="l06163" /><CodeLine lineNumber="6163"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l06164" /><CodeLine lineNumber="6164"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PtrDef &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(PtrDef) &amp;&amp;</Highlight></CodeLine>
<Link id="l06165" /><CodeLine lineNumber="6165"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ae849d400780f51424bc4e4c26ddf3000">CM&#95;GatherScatter</a>)</Highlight></CodeLine>
<Link id="l06166" /><CodeLine lineNumber="6166"><Highlight kind="normal">        AddrDefs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(PtrDef);</Highlight></CodeLine>
<Link id="l06167" /><CodeLine lineNumber="6167"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06168" /><CodeLine lineNumber="6168"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06169" /><CodeLine lineNumber="6169"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add all instructions used to generate the addresses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06170" /><CodeLine lineNumber="6170"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> Worklist;</Highlight></CodeLine>
<Link id="l06171" /><CodeLine lineNumber="6171"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a39d3d23a084c4544ee5903203db10e8a">append&#95;range</a>(Worklist, AddrDefs);</Highlight></CodeLine>
<Link id="l06172" /><CodeLine lineNumber="6172"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l06173" /><CodeLine lineNumber="6173"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l06174" /><CodeLine lineNumber="6174"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</Highlight></CodeLine>
<Link id="l06175" /><CodeLine lineNumber="6175"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;InstOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</Highlight></CodeLine>
<Link id="l06176" /><CodeLine lineNumber="6176"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((InstOp-&gt;getParent() == <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(InstOp) &amp;&amp;</Highlight></CodeLine>
<Link id="l06177" /><CodeLine lineNumber="6177"><Highlight kind="normal">            AddrDefs.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(InstOp).second)</Highlight></CodeLine>
<Link id="l06178" /><CodeLine lineNumber="6178"><Highlight kind="normal">          Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(InstOp);</Highlight></CodeLine>
<Link id="l06179" /><CodeLine lineNumber="6179"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06180" /><CodeLine lineNumber="6180"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06181" /><CodeLine lineNumber="6181"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : AddrDefs) &#123;</Highlight></CodeLine>
<Link id="l06182" /><CodeLine lineNumber="6182"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l06183" /><CodeLine lineNumber="6183"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Setting the desired widening decision should ideally be handled in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06184" /><CodeLine lineNumber="6184"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// by cost functions, but since this involves the task of finding out</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06185" /><CodeLine lineNumber="6185"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// if the loaded register is involved in an address computation, it is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06186" /><CodeLine lineNumber="6186"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// instead changed here when we know this is the case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06187" /><CodeLine lineNumber="6187"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l06188" /><CodeLine lineNumber="6188"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Decision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260adc468760c02910f77bad7525bc66c334">CM&#95;Widen</a> || Decision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a058eacbd3c28e2ecec2af7db726ce527">CM&#95;Widen&#95;Reverse</a>)</Highlight></CodeLine>
<Link id="l06189" /><CodeLine lineNumber="6189"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Scalarize a widened load of address.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06190" /><CodeLine lineNumber="6190"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(</Highlight></CodeLine>
<Link id="l06191" /><CodeLine lineNumber="6191"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>,</Highlight></CodeLine>
<Link id="l06192" /><CodeLine lineNumber="6192"><Highlight kind="normal">            (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42;</Highlight></CodeLine>
<Link id="l06193" /><CodeLine lineNumber="6193"><Highlight kind="normal">             getMemoryInstructionCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1))));</Highlight></CodeLine>
<Link id="l06194" /><CodeLine lineNumber="6194"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Group = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c">getInterleavedAccessGroup</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l06195" /><CodeLine lineNumber="6195"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Scalarize an interleave group of address loads.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06196" /><CodeLine lineNumber="6196"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; Group-&gt;getFactor(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l06197" /><CodeLine lineNumber="6197"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Member = Group-&gt;getMember(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l06198" /><CodeLine lineNumber="6198"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abc1b952dd1661ccba4f999610bf9732e">setWideningDecision</a>(</Highlight></CodeLine>
<Link id="l06199" /><CodeLine lineNumber="6199"><Highlight kind="normal">                Member, VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>,</Highlight></CodeLine>
<Link id="l06200" /><CodeLine lineNumber="6200"><Highlight kind="normal">                (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() &#42;</Highlight></CodeLine>
<Link id="l06201" /><CodeLine lineNumber="6201"><Highlight kind="normal">                 getMemoryInstructionCost(Member, <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1))));</Highlight></CodeLine>
<Link id="l06202" /><CodeLine lineNumber="6202"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l06203" /><CodeLine lineNumber="6203"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06204" /><CodeLine lineNumber="6204"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06205" /><CodeLine lineNumber="6205"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Make sure I gets scalarized and a cost estimate without</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06206" /><CodeLine lineNumber="6206"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// scalarization overhead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06207" /><CodeLine lineNumber="6207"><Highlight kind="normal">      ForcedScalars&#91;VF&#93;.insert(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06208" /><CodeLine lineNumber="6208"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06209" /><CodeLine lineNumber="6209"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06210" /><CodeLine lineNumber="6210"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06211" /><CodeLine lineNumber="6211" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8178cc5e49d5251d7ca3413b8a434f8f"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8178cc5e49d5251d7ca3413b8a434f8f">LoopVectorizationCostModel::setVectorizedCallDecision</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l06212" /><CodeLine lineNumber="6212"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l06213" /><CodeLine lineNumber="6213"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Trying to set a vectorization decision for a scalar VF&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06214" /><CodeLine lineNumber="6214"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06215" /><CodeLine lineNumber="6215"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ForcedScalar = ForcedScalars.find(VF);</Highlight></CodeLine>
<Link id="l06216" /><CodeLine lineNumber="6216"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;blocks()) &#123;</Highlight></CodeLine>
<Link id="l06217" /><CodeLine lineNumber="6217"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For each instruction in the old loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06218" /><CodeLine lineNumber="6218"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l06219" /><CodeLine lineNumber="6219"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06220" /><CodeLine lineNumber="6220"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06221" /><CodeLine lineNumber="6221"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CI)</Highlight></CodeLine>
<Link id="l06222" /><CodeLine lineNumber="6222"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06223" /><CodeLine lineNumber="6223"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06224" /><CodeLine lineNumber="6224"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarCost = <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l06225" /><CodeLine lineNumber="6225"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> VectorCost = <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l06226" /><CodeLine lineNumber="6226"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> IntrinsicCost = <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l06227" /><CodeLine lineNumber="6227"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/function">Function</a> &#42;ScalarFunc = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a2b1ae7cf1bafdd43d1fee4c6ad0a2913">getCalledFunction</a>();</Highlight></CodeLine>
<Link id="l06228" /><CodeLine lineNumber="6228"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarRetTy = CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l06229" /><CodeLine lineNumber="6229"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Type &#42;, 4&gt;</a> Tys, ScalarTys;</Highlight></CodeLine>
<Link id="l06230" /><CodeLine lineNumber="6230"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;ArgOp : CI-&gt;<a href="/docs/api/classes/llvm/callbase/#ad027ea8803d83ee19b9a2e13aec6d655">args</a>())</Highlight></CodeLine>
<Link id="l06231" /><CodeLine lineNumber="6231"><Highlight kind="normal">        ScalarTys.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(ArgOp-&gt;getType());</Highlight></CodeLine>
<Link id="l06232" /><CodeLine lineNumber="6232"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06233" /><CodeLine lineNumber="6233"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Estimate cost of scalarized vector call. The source operands are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06234" /><CodeLine lineNumber="6234"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// assumed to be vectors, so we need to extract individual elements from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06235" /><CodeLine lineNumber="6235"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// there, execute VF scalar calls, and then gather the result into the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06236" /><CodeLine lineNumber="6236"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// vector return value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06237" /><CodeLine lineNumber="6237"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarCallCost =</Highlight></CodeLine>
<Link id="l06238" /><CodeLine lineNumber="6238"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCallInstrCost(ScalarFunc, ScalarRetTy, ScalarTys, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l06239" /><CodeLine lineNumber="6239"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06240" /><CodeLine lineNumber="6240"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Compute costs of unpacking argument values for the scalar calls and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06241" /><CodeLine lineNumber="6241"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// packing the return values to a vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06242" /><CodeLine lineNumber="6242"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarizationCost = getScalarizationOverhead(CI, VF);</Highlight></CodeLine>
<Link id="l06243" /><CodeLine lineNumber="6243"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06244" /><CodeLine lineNumber="6244"><Highlight kind="normal">      ScalarCost = ScalarCallCost &#42; VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() + ScalarizationCost;</Highlight></CodeLine>
<Link id="l06245" /><CodeLine lineNumber="6245"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Honor ForcedScalars and UniformAfterVectorization decisions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06246" /><CodeLine lineNumber="6246"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: For calls, it might still be more profitable to widen. Use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06247" /><CodeLine lineNumber="6247"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// VPlan-based cost model to compare different options.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06248" /><CodeLine lineNumber="6248"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; ((ForcedScalar != ForcedScalars.end() &amp;&amp;</Highlight></CodeLine>
<Link id="l06249" /><CodeLine lineNumber="6249"><Highlight kind="normal">                             ForcedScalar-&gt;second.contains(CI)) ||</Highlight></CodeLine>
<Link id="l06250" /><CodeLine lineNumber="6250"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a20d7c96738b8f59692aec029895f8eb9">isUniformAfterVectorization</a>(CI, VF))) &#123;</Highlight></CodeLine>
<Link id="l06251" /><CodeLine lineNumber="6251"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8e5bf6d340d3b3f704b6398996ae51c">setCallWideningDecision</a>(CI, VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l06252" /><CodeLine lineNumber="6252"><Highlight kind="normal">                                <a href="/docs/api/namespaces/llvm/intrinsic/#a35fedf4db6d756bd82501607f93c1e79aab5fb650050f184fa7c19c26abde5226">Intrinsic::not&#95;intrinsic</a>, std::nullopt,</Highlight></CodeLine>
<Link id="l06253" /><CodeLine lineNumber="6253"><Highlight kind="normal">                                ScalarCost);</Highlight></CodeLine>
<Link id="l06254" /><CodeLine lineNumber="6254"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06255" /><CodeLine lineNumber="6255"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06256" /><CodeLine lineNumber="6256"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06257" /><CodeLine lineNumber="6257"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> MaskRequired = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(CI);</Highlight></CodeLine>
<Link id="l06258" /><CodeLine lineNumber="6258"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Compute corresponding vector type for return value and arguments.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06259" /><CodeLine lineNumber="6259"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ScalarRetTy, VF);</Highlight></CodeLine>
<Link id="l06260" /><CodeLine lineNumber="6260"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarTy : ScalarTys)</Highlight></CodeLine>
<Link id="l06261" /><CodeLine lineNumber="6261"><Highlight kind="normal">        Tys.push&#95;back(<a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ScalarTy, VF));</Highlight></CodeLine>
<Link id="l06262" /><CodeLine lineNumber="6262"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06263" /><CodeLine lineNumber="6263"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// An in-loop reduction using an fmuladd intrinsic is a special case;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06264" /><CodeLine lineNumber="6264"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// we don&#39;t want the normal cost for that intrinsic.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06265" /><CodeLine lineNumber="6265"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a08416fb970e8c177c7d78452d927c606">RecurrenceDescriptor::isFMulAddIntrinsic</a>(CI))</Highlight></CodeLine>
<Link id="l06266" /><CodeLine lineNumber="6266"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4e307866e6d65e87d1e6884b0d13306c">getReductionPatternCost</a>(CI, VF, RetTy)) &#123;</Highlight></CodeLine>
<Link id="l06267" /><CodeLine lineNumber="6267"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8e5bf6d340d3b3f704b6398996ae51c">setCallWideningDecision</a>(CI, VF, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a679b46cebdf2f87b9efd0413c960314a">CM&#95;IntrinsicCall</a>, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l06268" /><CodeLine lineNumber="6268"><Highlight kind="normal">                                  <a href="/docs/api/namespaces/llvm/#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>),</Highlight></CodeLine>
<Link id="l06269" /><CodeLine lineNumber="6269"><Highlight kind="normal">                                  std::nullopt, &#42;RedCost);</Highlight></CodeLine>
<Link id="l06270" /><CodeLine lineNumber="6270"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06271" /><CodeLine lineNumber="6271"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l06272" /><CodeLine lineNumber="6272"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06273" /><CodeLine lineNumber="6273"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Find the cost of vectorizing the call, if we can find a suitable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06274" /><CodeLine lineNumber="6274"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// vector variant of the function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06275" /><CodeLine lineNumber="6275"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/vfinfo">VFInfo</a> FuncInfo;</Highlight></CodeLine>
<Link id="l06276" /><CodeLine lineNumber="6276"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/function">Function</a> &#42;VecFunc = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06277" /><CodeLine lineNumber="6277"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Search through any available variants for one we can use at this VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06278" /><CodeLine lineNumber="6278"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/vfinfo">VFInfo</a> &amp;Info : <a href="/docs/api/classes/llvm/vfdatabase/#ab3e99bee894f145998d620d3d2a2f900">VFDatabase::getMappings</a>(&#42;CI)) &#123;</Highlight></CodeLine>
<Link id="l06279" /><CodeLine lineNumber="6279"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Must match requested VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06280" /><CodeLine lineNumber="6280"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Info.Shape.VF != VF)</Highlight></CodeLine>
<Link id="l06281" /><CodeLine lineNumber="6281"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06282" /><CodeLine lineNumber="6282"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06283" /><CodeLine lineNumber="6283"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Must take a mask argument if one is required</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06284" /><CodeLine lineNumber="6284"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaskRequired &amp;&amp; !Info.isMasked())</Highlight></CodeLine>
<Link id="l06285" /><CodeLine lineNumber="6285"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06286" /><CodeLine lineNumber="6286"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06287" /><CodeLine lineNumber="6287"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Check that all parameter kinds are supported</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06288" /><CodeLine lineNumber="6288"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ParamsOk = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06289" /><CodeLine lineNumber="6289"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/vfparameter">VFParameter</a> Param : Info.Shape.Parameters) &#123;</Highlight></CodeLine>
<Link id="l06290" /><CodeLine lineNumber="6290"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (Param.ParamKind) &#123;</Highlight></CodeLine>
<Link id="l06291" /><CodeLine lineNumber="6291"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#add480f2ed87faa59c16d4c01ffb4bf39a57dea6f5039281b7fee517fc43bf3110">VFParamKind::Vector</a>:</Highlight></CodeLine>
<Link id="l06292" /><CodeLine lineNumber="6292"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06293" /><CodeLine lineNumber="6293"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#add480f2ed87faa59c16d4c01ffb4bf39acbf35bbdad5d09f9072d0e83e78e90e4">VFParamKind::OMP&#95;Uniform</a>: &#123;</Highlight></CodeLine>
<Link id="l06294" /><CodeLine lineNumber="6294"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/value">Value</a> &#42;ScalarParam = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(Param.ParamPos);</Highlight></CodeLine>
<Link id="l06295" /><CodeLine lineNumber="6295"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// Make sure the scalar parameter in the loop is invariant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06296" /><CodeLine lineNumber="6296"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE()-&gt;isLoopInvariant(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSCEV(ScalarParam),</Highlight></CodeLine>
<Link id="l06297" /><CodeLine lineNumber="6297"><Highlight kind="normal">                                              <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>))</Highlight></CodeLine>
<Link id="l06298" /><CodeLine lineNumber="6298"><Highlight kind="normal">              ParamsOk = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06299" /><CodeLine lineNumber="6299"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06300" /><CodeLine lineNumber="6300"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l06301" /><CodeLine lineNumber="6301"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#add480f2ed87faa59c16d4c01ffb4bf39a16454c62ab71c641dedda0971980c9d5">VFParamKind::OMP&#95;Linear</a>: &#123;</Highlight></CodeLine>
<Link id="l06302" /><CodeLine lineNumber="6302"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/value">Value</a> &#42;ScalarParam = CI-&gt;<a href="/docs/api/classes/llvm/callbase/#aabd76e6a8a23a5af1ce4d3c310d88bcd">getArgOperand</a>(Param.ParamPos);</Highlight></CodeLine>
<Link id="l06303" /><CodeLine lineNumber="6303"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// Find the stride for the scalar parameter in this loop and see if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06304" /><CodeLine lineNumber="6304"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// it matches the stride for the variant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06305" /><CodeLine lineNumber="6305"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// TODO: do we need to figure out the cost of an extract to get the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06306" /><CodeLine lineNumber="6306"><Highlight kind="normal">            </Highlight><Highlight kind="comment">// first lane? Or do we hope that it will be folded away?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06307" /><CodeLine lineNumber="6307"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &#42;SE = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE();</Highlight></CodeLine>
<Link id="l06308" /><CodeLine lineNumber="6308"><Highlight kind="normal">            </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;SAR =</Highlight></CodeLine>
<Link id="l06309" /><CodeLine lineNumber="6309"><Highlight kind="normal">                <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVAddRecExpr&gt;</a>(SE-&gt;<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(ScalarParam));</Highlight></CodeLine>
<Link id="l06310" /><CodeLine lineNumber="6310"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06311" /><CodeLine lineNumber="6311"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SAR || SAR-&gt;getLoop() != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>) &#123;</Highlight></CodeLine>
<Link id="l06312" /><CodeLine lineNumber="6312"><Highlight kind="normal">              ParamsOk = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06313" /><CodeLine lineNumber="6313"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06314" /><CodeLine lineNumber="6314"><Highlight kind="normal">            &#125;</Highlight></CodeLine>
<Link id="l06315" /><CodeLine lineNumber="6315"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06316" /><CodeLine lineNumber="6316"><Highlight kind="normal">            </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scevconstant">SCEVConstant</a> &#42;Step =</Highlight></CodeLine>
<Link id="l06317" /><CodeLine lineNumber="6317"><Highlight kind="normal">                <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(SAR-&gt;getStepRecurrence(&#42;SE));</Highlight></CodeLine>
<Link id="l06318" /><CodeLine lineNumber="6318"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06319" /><CodeLine lineNumber="6319"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Step ||</Highlight></CodeLine>
<Link id="l06320" /><CodeLine lineNumber="6320"><Highlight kind="normal">                Step-&gt;<a href="/docs/api/classes/llvm/scevconstant/#a6caf7f3a0a4303e4c0bc06ed8e205126">getAPInt</a>().<a href="/docs/api/classes/llvm/apint/#af2daa0ee117afefed4c82eee55bf97b7">getSExtValue</a>() != Param.LinearStepOrPos)</Highlight></CodeLine>
<Link id="l06321" /><CodeLine lineNumber="6321"><Highlight kind="normal">              ParamsOk = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06322" /><CodeLine lineNumber="6322"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06323" /><CodeLine lineNumber="6323"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06324" /><CodeLine lineNumber="6324"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l06325" /><CodeLine lineNumber="6325"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#add480f2ed87faa59c16d4c01ffb4bf39adf3e3249ad10ccf5bf901eb83c105cc3">VFParamKind::GlobalPredicate</a>:</Highlight></CodeLine>
<Link id="l06326" /><CodeLine lineNumber="6326"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06327" /><CodeLine lineNumber="6327"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l06328" /><CodeLine lineNumber="6328"><Highlight kind="normal">            ParamsOk = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06329" /><CodeLine lineNumber="6329"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06330" /><CodeLine lineNumber="6330"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l06331" /><CodeLine lineNumber="6331"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l06332" /><CodeLine lineNumber="6332"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06333" /><CodeLine lineNumber="6333"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ParamsOk)</Highlight></CodeLine>
<Link id="l06334" /><CodeLine lineNumber="6334"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06335" /><CodeLine lineNumber="6335"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06336" /><CodeLine lineNumber="6336"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Found a suitable candidate, stop here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06337" /><CodeLine lineNumber="6337"><Highlight kind="normal">        VecFunc = CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4ba3a5be6c0e9b9e8a525de055836733">getModule</a>()-&gt;<a href="/docs/api/classes/llvm/module/#a209a615a3a32241323420cca24b5520a">getFunction</a>(Info.VectorName);</Highlight></CodeLine>
<Link id="l06338" /><CodeLine lineNumber="6338"><Highlight kind="normal">        FuncInfo = Info;</Highlight></CodeLine>
<Link id="l06339" /><CodeLine lineNumber="6339"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06340" /><CodeLine lineNumber="6340"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06341" /><CodeLine lineNumber="6341"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06342" /><CodeLine lineNumber="6342"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a> &amp;&amp; VecFunc &amp;&amp; !CI-&gt;<a href="/docs/api/classes/llvm/callbase/#a1fb374eb65dcf7cd3d1671efb2616f76">isNoBuiltin</a>())</Highlight></CodeLine>
<Link id="l06343" /><CodeLine lineNumber="6343"><Highlight kind="normal">        VectorCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCallInstrCost(</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, RetTy, Tys, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l06344" /><CodeLine lineNumber="6344"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06345" /><CodeLine lineNumber="6345"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Find the cost of an intrinsic; some targets may have instructions that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06346" /><CodeLine lineNumber="6346"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// perform the operation without needing an actual call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06347" /><CodeLine lineNumber="6347"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> IID = <a href="/docs/api/namespaces/llvm/#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>);</Highlight></CodeLine>
<Link id="l06348" /><CodeLine lineNumber="6348"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IID != <a href="/docs/api/namespaces/llvm/intrinsic/#a35fedf4db6d756bd82501607f93c1e79aab5fb650050f184fa7c19c26abde5226">Intrinsic::not&#95;intrinsic</a>)</Highlight></CodeLine>
<Link id="l06349" /><CodeLine lineNumber="6349"><Highlight kind="normal">        IntrinsicCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5abced3ab870d7abf57f2b35a02cd041">getVectorIntrinsicCost</a>(CI, VF);</Highlight></CodeLine>
<Link id="l06350" /><CodeLine lineNumber="6350"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06351" /><CodeLine lineNumber="6351"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = ScalarCost;</Highlight></CodeLine>
<Link id="l06352" /><CodeLine lineNumber="6352"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>;</Highlight></CodeLine>
<Link id="l06353" /><CodeLine lineNumber="6353"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06354" /><CodeLine lineNumber="6354"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VectorCost &lt;= <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>) &#123;</Highlight></CodeLine>
<Link id="l06355" /><CodeLine lineNumber="6355"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = VectorCost;</Highlight></CodeLine>
<Link id="l06356" /><CodeLine lineNumber="6356"><Highlight kind="normal">        Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ab6fd5f45ab6e363de6c3f42472d439ac">CM&#95;VectorCall</a>;</Highlight></CodeLine>
<Link id="l06357" /><CodeLine lineNumber="6357"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06358" /><CodeLine lineNumber="6358"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06359" /><CodeLine lineNumber="6359"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IntrinsicCost &lt;= <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>) &#123;</Highlight></CodeLine>
<Link id="l06360" /><CodeLine lineNumber="6360"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = IntrinsicCost;</Highlight></CodeLine>
<Link id="l06361" /><CodeLine lineNumber="6361"><Highlight kind="normal">        Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a679b46cebdf2f87b9efd0413c960314a">CM&#95;IntrinsicCall</a>;</Highlight></CodeLine>
<Link id="l06362" /><CodeLine lineNumber="6362"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06363" /><CodeLine lineNumber="6363"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06364" /><CodeLine lineNumber="6364"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8e5bf6d340d3b3f704b6398996ae51c">setCallWideningDecision</a>(CI, VF, Decision, VecFunc, IID,</Highlight></CodeLine>
<Link id="l06365" /><CodeLine lineNumber="6365"><Highlight kind="normal">                              FuncInfo.getParamIndexForOptionalMask(), <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>);</Highlight></CodeLine>
<Link id="l06366" /><CodeLine lineNumber="6366"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06367" /><CodeLine lineNumber="6367"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06368" /><CodeLine lineNumber="6368"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06369" /><CodeLine lineNumber="6369"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06370" /><CodeLine lineNumber="6370" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#aadd9a9d699ede62468422c7cfab66e99"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aadd9a9d699ede62468422c7cfab66e99">LoopVectorizationCostModel::shouldConsiderInvariant</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123;</Highlight></CodeLine>
<Link id="l06371" /><CodeLine lineNumber="6371"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInvariant(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</Highlight></CodeLine>
<Link id="l06372" /><CodeLine lineNumber="6372"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06373" /><CodeLine lineNumber="6373"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Consider Op invariant, if it or its operands aren&#39;t predicated</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06374" /><CodeLine lineNumber="6374"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instruction in the loop. In that case, it is not trivially hoistable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06375" /><CodeLine lineNumber="6375"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l06376" /><CodeLine lineNumber="6376"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !OpI || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(OpI) ||</Highlight></CodeLine>
<Link id="l06377" /><CodeLine lineNumber="6377"><Highlight kind="normal">         (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">isPredicatedInst</a>(OpI) &amp;&amp;</Highlight></CodeLine>
<Link id="l06378" /><CodeLine lineNumber="6378"><Highlight kind="normal">          (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(OpI) || OpI-&gt;getParent() != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getHeader()) &amp;&amp;</Highlight></CodeLine>
<Link id="l06379" /><CodeLine lineNumber="6379"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(OpI-&gt;operands(),</Highlight></CodeLine>
<Link id="l06380" /><CodeLine lineNumber="6380"><Highlight kind="normal">                 &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123; return shouldConsiderInvariant(Op); &#125;));</Highlight></CodeLine>
<Link id="l06381" /><CodeLine lineNumber="6381"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06382" /><CodeLine lineNumber="6382"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06383" /><CodeLine lineNumber="6383"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></Highlight></CodeLine>
<Link id="l06384" /><CodeLine lineNumber="6384" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a556ec90a0fa1e168a9f22db1deb1fee6"><Highlight kind="normal"><a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a556ec90a0fa1e168a9f22db1deb1fee6">LoopVectorizationCostModel::getInstructionCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l06385" /><CodeLine lineNumber="6385"><Highlight kind="normal">                                               <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123;</Highlight></CodeLine>
<Link id="l06386" /><CodeLine lineNumber="6386"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we know that this instruction will remain uniform, check the cost of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06387" /><CodeLine lineNumber="6387"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the scalar version.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06388" /><CodeLine lineNumber="6388"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a20d7c96738b8f59692aec029895f8eb9">isUniformAfterVectorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</Highlight></CodeLine>
<Link id="l06389" /><CodeLine lineNumber="6389"><Highlight kind="normal">    VF = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1);</Highlight></CodeLine>
<Link id="l06390" /><CodeLine lineNumber="6390"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06391" /><CodeLine lineNumber="6391"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9a6fbca8c965adeb8016a03ca3de2cac">isProfitableToScalarize</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</Highlight></CodeLine>
<Link id="l06392" /><CodeLine lineNumber="6392"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> InstsToScalarize&#91;VF&#93;&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l06393" /><CodeLine lineNumber="6393"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06394" /><CodeLine lineNumber="6394"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Forced scalars do not have any scalarization overhead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06395" /><CodeLine lineNumber="6395"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ForcedScalar = ForcedScalars.find(VF);</Highlight></CodeLine>
<Link id="l06396" /><CodeLine lineNumber="6396"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; ForcedScalar != ForcedScalars.end()) &#123;</Highlight></CodeLine>
<Link id="l06397" /><CodeLine lineNumber="6397"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> InstSet = ForcedScalar-&gt;second;</Highlight></CodeLine>
<Link id="l06398" /><CodeLine lineNumber="6398"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InstSet.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a1f475b0df44ebd7169e720fa1bf9169e">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l06399" /><CodeLine lineNumber="6399"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a556ec90a0fa1e168a9f22db1deb1fee6">getInstructionCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1)) &#42;</Highlight></CodeLine>
<Link id="l06400" /><CodeLine lineNumber="6400"><Highlight kind="normal">             VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>();</Highlight></CodeLine>
<Link id="l06401" /><CodeLine lineNumber="6401"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06402" /><CodeLine lineNumber="6402"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06403" /><CodeLine lineNumber="6403"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;RetTy = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType();</Highlight></CodeLine>
<Link id="l06404" /><CodeLine lineNumber="6404"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa8c00664c6be2042407f13e4fcad950b">canTruncateToMinimalBitwidth</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</Highlight></CodeLine>
<Link id="l06405" /><CodeLine lineNumber="6405"><Highlight kind="normal">    RetTy = <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(RetTy-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>(), MinBWs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</Highlight></CodeLine>
<Link id="l06406" /><CodeLine lineNumber="6406"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;SE = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE();</Highlight></CodeLine>
<Link id="l06407" /><CodeLine lineNumber="6407"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06408" /><CodeLine lineNumber="6408"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> HasSingleCopyAfterVectorization = &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l06409" /><CodeLine lineNumber="6409"><Highlight kind="normal">                                                <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l06410" /><CodeLine lineNumber="6410"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</Highlight></CodeLine>
<Link id="l06411" /><CodeLine lineNumber="6411"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06412" /><CodeLine lineNumber="6412"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06413" /><CodeLine lineNumber="6413"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Scalarized = InstsToScalarize.find(VF);</Highlight></CodeLine>
<Link id="l06414" /><CodeLine lineNumber="6414"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Scalarized != InstsToScalarize.end() &amp;&amp;</Highlight></CodeLine>
<Link id="l06415" /><CodeLine lineNumber="6415"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;VF not yet analyzed for scalarization profitability&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06416" /><CodeLine lineNumber="6416"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !Scalarized-&gt;second.count(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l06417" /><CodeLine lineNumber="6417"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">llvm::all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;users(), &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l06418" /><CodeLine lineNumber="6418"><Highlight kind="normal">             auto &#42;UI = cast&lt;Instruction&gt;(U);</Highlight></CodeLine>
<Link id="l06419" /><CodeLine lineNumber="6419"><Highlight kind="normal">             return !Scalarized-&gt;second.count(UI);</Highlight></CodeLine>
<Link id="l06420" /><CodeLine lineNumber="6420"><Highlight kind="normal">           &#125;);</Highlight></CodeLine>
<Link id="l06421" /><CodeLine lineNumber="6421"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l06422" /><CodeLine lineNumber="6422"><Highlight kind="normal">  (void)HasSingleCopyAfterVectorization;</Highlight></CodeLine>
<Link id="l06423" /><CodeLine lineNumber="6423"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06424" /><CodeLine lineNumber="6424"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;VectorTy;</Highlight></CodeLine>
<Link id="l06425" /><CodeLine lineNumber="6425"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</Highlight></CodeLine>
<Link id="l06426" /><CodeLine lineNumber="6426"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// With the exception of GEPs and PHIs, after scalarization there should</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06427" /><CodeLine lineNumber="6427"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// only be one copy of the instruction generated in the loop. This is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06428" /><CodeLine lineNumber="6428"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// because the VF is either 1, or any instructions that need scalarizing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06429" /><CodeLine lineNumber="6429"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// have already been dealt with by the time we get here. As a result,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06430" /><CodeLine lineNumber="6430"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// it means we don&#39;t have to multiply the instruction cost by VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06431" /><CodeLine lineNumber="6431"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::GetElementPtr ||</Highlight></CodeLine>
<Link id="l06432" /><CodeLine lineNumber="6432"><Highlight kind="normal">           <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::PHI ||</Highlight></CodeLine>
<Link id="l06433" /><CodeLine lineNumber="6433"><Highlight kind="normal">           (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::BitCast &amp;&amp;</Highlight></CodeLine>
<Link id="l06434" /><CodeLine lineNumber="6434"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isPointerTy()) ||</Highlight></CodeLine>
<Link id="l06435" /><CodeLine lineNumber="6435"><Highlight kind="normal">           HasSingleCopyAfterVectorization(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF));</Highlight></CodeLine>
<Link id="l06436" /><CodeLine lineNumber="6436"><Highlight kind="normal">    VectorTy = RetTy;</Highlight></CodeLine>
<Link id="l06437" /><CodeLine lineNumber="6437"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06438" /><CodeLine lineNumber="6438"><Highlight kind="normal">    VectorTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(RetTy, VF);</Highlight></CodeLine>
<Link id="l06439" /><CodeLine lineNumber="6439"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06440" /><CodeLine lineNumber="6440"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; VectorTy-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l06441" /><CodeLine lineNumber="6441"><Highlight kind="normal">      !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getNumberOfParts(VectorTy))</Highlight></CodeLine>
<Link id="l06442" /><CodeLine lineNumber="6442"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l06443" /><CodeLine lineNumber="6443"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06444" /><CodeLine lineNumber="6444"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: We need to estimate the cost of intrinsic calls.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06445" /><CodeLine lineNumber="6445"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l06446" /><CodeLine lineNumber="6446"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::GetElementPtr:</Highlight></CodeLine>
<Link id="l06447" /><CodeLine lineNumber="6447"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We mark this instruction as zero-cost because the cost of GEPs in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06448" /><CodeLine lineNumber="6448"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// vectorized code depends on whether the corresponding memory instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06449" /><CodeLine lineNumber="6449"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is scalarized or not. Therefore, we handle GEPs with the memory</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06450" /><CodeLine lineNumber="6450"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instruction cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06451" /><CodeLine lineNumber="6451"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 0;</Highlight></CodeLine>
<Link id="l06452" /><CodeLine lineNumber="6452"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Br: &#123;</Highlight></CodeLine>
<Link id="l06453" /><CodeLine lineNumber="6453"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// In cases of scalarized and predicated instructions, there will be VF</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06454" /><CodeLine lineNumber="6454"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// predicated blocks in the vectorized loop. Each branch around these</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06455" /><CodeLine lineNumber="6455"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// blocks requires also an extract of its vector compare i1 element.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06456" /><CodeLine lineNumber="6456"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Note that the conditional branch from the loop latch will be replaced by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06457" /><CodeLine lineNumber="6457"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// a single branch controlling the loop, so there is no extra overhead from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06458" /><CodeLine lineNumber="6458"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// scalarization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06459" /><CodeLine lineNumber="6459"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ScalarPredicatedBB = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06460" /><CodeLine lineNumber="6460"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06461" /><CodeLine lineNumber="6461"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l06462" /><CodeLine lineNumber="6462"><Highlight kind="normal">        (PredicatedBBsAfterVectorization&#91;VF&#93;.count(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0)) ||</Highlight></CodeLine>
<Link id="l06463" /><CodeLine lineNumber="6463"><Highlight kind="normal">         PredicatedBBsAfterVectorization&#91;VF&#93;.count(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1))) &amp;&amp;</Highlight></CodeLine>
<Link id="l06464" /><CodeLine lineNumber="6464"><Highlight kind="normal">        BI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>() != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getLoopLatch())</Highlight></CodeLine>
<Link id="l06465" /><CodeLine lineNumber="6465"><Highlight kind="normal">      ScalarPredicatedBB = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06466" /><CodeLine lineNumber="6466"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06467" /><CodeLine lineNumber="6467"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ScalarPredicatedBB) &#123;</Highlight></CodeLine>
<Link id="l06468" /><CodeLine lineNumber="6468"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Not possible to scalarize scalable vector with predicated instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06469" /><CodeLine lineNumber="6469"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</Highlight></CodeLine>
<Link id="l06470" /><CodeLine lineNumber="6470"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l06471" /><CodeLine lineNumber="6471"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Return cost for branches around scalarized and predicated blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06472" /><CodeLine lineNumber="6472"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VecI1Ty =</Highlight></CodeLine>
<Link id="l06473" /><CodeLine lineNumber="6473"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">IntegerType::getInt1Ty</a>(RetTy-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>()), VF);</Highlight></CodeLine>
<Link id="l06474" /><CodeLine lineNumber="6474"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> (</Highlight></CodeLine>
<Link id="l06475" /><CodeLine lineNumber="6475"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getScalarizationOverhead(</Highlight></CodeLine>
<Link id="l06476" /><CodeLine lineNumber="6476"><Highlight kind="normal">              VecI1Ty, <a href="/docs/api/classes/llvm/apint/#a071e8d814b2b30b02544fad964227b8e">APInt::getAllOnes</a>(VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>()),</Highlight></CodeLine>
<Link id="l06477" /><CodeLine lineNumber="6477"><Highlight kind="normal">              </Highlight><Highlight kind="comment">/&#42;Insert&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="comment">/&#42;Extract&#42;/</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>) +</Highlight></CodeLine>
<Link id="l06478" /><CodeLine lineNumber="6478"><Highlight kind="normal">          (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCFInstrCost(Instruction::Br, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>) &#42; VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>()));</Highlight></CodeLine>
<Link id="l06479" /><CodeLine lineNumber="6479"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06480" /><CodeLine lineNumber="6480"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06481" /><CodeLine lineNumber="6481"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent() == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getLoopLatch() || VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</Highlight></CodeLine>
<Link id="l06482" /><CodeLine lineNumber="6482"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The back-edge branch will remain, as will all scalar branches.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06483" /><CodeLine lineNumber="6483"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCFInstrCost(Instruction::Br, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l06484" /><CodeLine lineNumber="6484"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06485" /><CodeLine lineNumber="6485"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This branch will be eliminated by if-conversion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06486" /><CodeLine lineNumber="6486"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 0;</Highlight></CodeLine>
<Link id="l06487" /><CodeLine lineNumber="6487"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Note: We currently assume zero cost for an unconditional branch inside</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06488" /><CodeLine lineNumber="6488"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// a predicated block since it will become a fall-through, although we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06489" /><CodeLine lineNumber="6489"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// may decide in the future to call TTI for all branches.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06490" /><CodeLine lineNumber="6490"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06491" /><CodeLine lineNumber="6491"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Switch: &#123;</Highlight></CodeLine>
<Link id="l06492" /><CodeLine lineNumber="6492"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</Highlight></CodeLine>
<Link id="l06493" /><CodeLine lineNumber="6493"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCFInstrCost(Instruction::Switch, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l06494" /><CodeLine lineNumber="6494"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Switch = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SwitchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06495" /><CodeLine lineNumber="6495"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Switch-&gt;getNumCases() &#42;</Highlight></CodeLine>
<Link id="l06496" /><CodeLine lineNumber="6496"><Highlight kind="normal">           <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCmpSelInstrCost(</Highlight></CodeLine>
<Link id="l06497" /><CodeLine lineNumber="6497"><Highlight kind="normal">               Instruction::ICmp,</Highlight></CodeLine>
<Link id="l06498" /><CodeLine lineNumber="6498"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(Switch-&gt;getCondition()-&gt;getType(), VF),</Highlight></CodeLine>
<Link id="l06499" /><CodeLine lineNumber="6499"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext()), VF),</Highlight></CodeLine>
<Link id="l06500" /><CodeLine lineNumber="6500"><Highlight kind="normal">               <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP&#95;EQ</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l06501" /><CodeLine lineNumber="6501"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06502" /><CodeLine lineNumber="6502"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::PHI: &#123;</Highlight></CodeLine>
<Link id="l06503" /><CodeLine lineNumber="6503"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06504" /><CodeLine lineNumber="6504"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06505" /><CodeLine lineNumber="6505"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// First-order recurrences are replaced by vector shuffles inside the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06506" /><CodeLine lineNumber="6506"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isFixedOrderRecurrence(Phi)) &#123;</Highlight></CodeLine>
<Link id="l06507" /><CodeLine lineNumber="6507"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// For &lt;vscale x 1 x i64&gt;, if vscale = 1 we are unable to extract the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06508" /><CodeLine lineNumber="6508"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// penultimate value of the recurrence.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06509" /><CodeLine lineNumber="6509"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: Consider vscale&#95;range info.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06510" /><CodeLine lineNumber="6510"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp; VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() == 1)</Highlight></CodeLine>
<Link id="l06511" /><CodeLine lineNumber="6511"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l06512" /><CodeLine lineNumber="6512"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;int&gt;</a> Mask(VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>());</Highlight></CodeLine>
<Link id="l06513" /><CodeLine lineNumber="6513"><Highlight kind="normal">      std::iota(Mask.begin(), Mask.end(), VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() - 1);</Highlight></CodeLine>
<Link id="l06514" /><CodeLine lineNumber="6514"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getShuffleCost(<a href="/docs/api/classes/llvm/targettransforminfo/#af46433d0e36d3f80afc3a8c67b5c53ecaa9e18b2636661e341804da24971997df">TargetTransformInfo::SK&#95;Splice</a>,</Highlight></CodeLine>
<Link id="l06515" /><CodeLine lineNumber="6515"><Highlight kind="normal">                                <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VectorType&gt;</a>(VectorTy), Mask, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>,</Highlight></CodeLine>
<Link id="l06516" /><CodeLine lineNumber="6516"><Highlight kind="normal">                                VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>() - 1);</Highlight></CodeLine>
<Link id="l06517" /><CodeLine lineNumber="6517"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06518" /><CodeLine lineNumber="6518"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06519" /><CodeLine lineNumber="6519"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Phi nodes in non-header blocks (not inductions, reductions, etc.) are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06520" /><CodeLine lineNumber="6520"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// converted into select instructions. We require N - 1 selects per phi</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06521" /><CodeLine lineNumber="6521"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// node, where N is the number of incoming values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06522" /><CodeLine lineNumber="6522"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; Phi-&gt;getParent() != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getHeader()) &#123;</Highlight></CodeLine>
<Link id="l06523" /><CodeLine lineNumber="6523"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;ResultTy = Phi-&gt;getType();</Highlight></CodeLine>
<Link id="l06524" /><CodeLine lineNumber="6524"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06525" /><CodeLine lineNumber="6525"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// All instructions in an Any-of reduction chain are narrowed to bool.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06526" /><CodeLine lineNumber="6526"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Check if that is the case for this phi node.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06527" /><CodeLine lineNumber="6527"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;HeaderUser = <a href="/docs/api/namespaces/llvm/#a07be078de4a2c223bd6a76e24e1c02db">cast&#95;if&#95;present&lt;PHINode&gt;</a>(</Highlight></CodeLine>
<Link id="l06528" /><CodeLine lineNumber="6528"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a8f6975e193997c4e0183e96774a7cb39">find&#95;singleton&lt;User&gt;</a>(Phi-&gt;users(), &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal">) -&gt; <a href="/docs/api/classes/llvm/user">User</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l06529" /><CodeLine lineNumber="6529"><Highlight kind="normal">            auto &#42;Phi = dyn&#95;cast&lt;PHINode&gt;(U);</Highlight></CodeLine>
<Link id="l06530" /><CodeLine lineNumber="6530"><Highlight kind="normal">            if (Phi &amp;&amp; Phi-&gt;getParent() == TheLoop-&gt;getHeader())</Highlight></CodeLine>
<Link id="l06531" /><CodeLine lineNumber="6531"><Highlight kind="normal">              return Phi;</Highlight></CodeLine>
<Link id="l06532" /><CodeLine lineNumber="6532"><Highlight kind="normal">            return nullptr;</Highlight></CodeLine>
<Link id="l06533" /><CodeLine lineNumber="6533"><Highlight kind="normal">          &#125;));</Highlight></CodeLine>
<Link id="l06534" /><CodeLine lineNumber="6534"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (HeaderUser) &#123;</Highlight></CodeLine>
<Link id="l06535" /><CodeLine lineNumber="6535"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;ReductionVars = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars();</Highlight></CodeLine>
<Link id="l06536" /><CodeLine lineNumber="6536"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Iter = ReductionVars.find(HeaderUser);</Highlight></CodeLine>
<Link id="l06537" /><CodeLine lineNumber="6537"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Iter != ReductionVars.end() &amp;&amp;</Highlight></CodeLine>
<Link id="l06538" /><CodeLine lineNumber="6538"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/recurrencedescriptor/#a69df67c7d92481ae63a5d8017e96c716">RecurrenceDescriptor::isAnyOfRecurrenceKind</a>(</Highlight></CodeLine>
<Link id="l06539" /><CodeLine lineNumber="6539"><Highlight kind="normal">                Iter-&gt;second.getRecurrenceKind()))</Highlight></CodeLine>
<Link id="l06540" /><CodeLine lineNumber="6540"><Highlight kind="normal">          ResultTy = <a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(Phi-&gt;getContext());</Highlight></CodeLine>
<Link id="l06541" /><CodeLine lineNumber="6541"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06542" /><CodeLine lineNumber="6542"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> (Phi-&gt;getNumIncomingValues() - 1) &#42;</Highlight></CodeLine>
<Link id="l06543" /><CodeLine lineNumber="6543"><Highlight kind="normal">             <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCmpSelInstrCost(</Highlight></CodeLine>
<Link id="l06544" /><CodeLine lineNumber="6544"><Highlight kind="normal">                 Instruction::Select, <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ResultTy, VF),</Highlight></CodeLine>
<Link id="l06545" /><CodeLine lineNumber="6545"><Highlight kind="normal">                 <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(Phi-&gt;getContext()), VF),</Highlight></CodeLine>
<Link id="l06546" /><CodeLine lineNumber="6546"><Highlight kind="normal">                 <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">CmpInst::BAD&#95;ICMP&#95;PREDICATE</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l06547" /><CodeLine lineNumber="6547"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06548" /><CodeLine lineNumber="6548"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06549" /><CodeLine lineNumber="6549"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// When tail folding with EVL, if the phi is part of an out of loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06550" /><CodeLine lineNumber="6550"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// reduction then it will be transformed into a wide vp&#95;merge.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06551" /><CodeLine lineNumber="6551"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab0c7e793ca1b6b8a4f8c00a1bc1cb32f">foldTailWithEVL</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l06552" /><CodeLine lineNumber="6552"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars().contains(Phi) &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9819226a3ff242635fd99bf22b50bd97">isInLoopReduction</a>(Phi)) &#123;</Highlight></CodeLine>
<Link id="l06553" /><CodeLine lineNumber="6553"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/intrinsiccostattributes">IntrinsicCostAttributes</a> ICA(</Highlight></CodeLine>
<Link id="l06554" /><CodeLine lineNumber="6554"><Highlight kind="normal">          Intrinsic::vp&#95;merge, <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(Phi-&gt;getType(), VF),</Highlight></CodeLine>
<Link id="l06555" /><CodeLine lineNumber="6555"><Highlight kind="normal">          &#123;toVectorTy(Type::getInt1Ty(Phi-&gt;getContext()), VF)&#125;);</Highlight></CodeLine>
<Link id="l06556" /><CodeLine lineNumber="6556"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getIntrinsicInstrCost(ICA, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l06557" /><CodeLine lineNumber="6557"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06558" /><CodeLine lineNumber="6558"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06559" /><CodeLine lineNumber="6559"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCFInstrCost(Instruction::PHI, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l06560" /><CodeLine lineNumber="6560"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06561" /><CodeLine lineNumber="6561"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::UDiv:</Highlight></CodeLine>
<Link id="l06562" /><CodeLine lineNumber="6562"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SDiv:</Highlight></CodeLine>
<Link id="l06563" /><CodeLine lineNumber="6563"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::URem:</Highlight></CodeLine>
<Link id="l06564" /><CodeLine lineNumber="6564"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SRem:</Highlight></CodeLine>
<Link id="l06565" /><CodeLine lineNumber="6565"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0a96f040b7fc3eae004aa6dc2af8f522">isPredicatedInst</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l06566" /><CodeLine lineNumber="6566"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#91;ScalarCost, SafeDivisorCost&#93; = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad8398a35cd187d6a75b460fcf54b5236">getDivRemSpeculationCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l06567" /><CodeLine lineNumber="6567"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#add43c346a11ae1deb49142ba968eb07e">isDivRemScalarWithPredication</a>(ScalarCost, SafeDivisorCost) ?</Highlight></CodeLine>
<Link id="l06568" /><CodeLine lineNumber="6568"><Highlight kind="normal">        ScalarCost : SafeDivisorCost;</Highlight></CodeLine>
<Link id="l06569" /><CodeLine lineNumber="6569"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06570" /><CodeLine lineNumber="6570"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We&#39;ve proven all lanes safe to speculate, fall through.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06571" /><CodeLine lineNumber="6571"><Highlight kind="normal">    &#91;&#91;fallthrough&#93;&#93;;</Highlight></CodeLine>
<Link id="l06572" /><CodeLine lineNumber="6572"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Add:</Highlight></CodeLine>
<Link id="l06573" /><CodeLine lineNumber="6573"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Sub: &#123;</Highlight></CodeLine>
<Link id="l06574" /><CodeLine lineNumber="6574"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Info = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getHistogramInfo(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06575" /><CodeLine lineNumber="6575"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Info &amp;&amp; VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()) &#123;</Highlight></CodeLine>
<Link id="l06576" /><CodeLine lineNumber="6576"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/histograminfo">HistogramInfo</a> &#42;HGram = Info.value();</Highlight></CodeLine>
<Link id="l06577" /><CodeLine lineNumber="6577"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Assume that a non-constant update value (or a constant != 1) requires</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06578" /><CodeLine lineNumber="6578"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// a multiply, and add that into the cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06579" /><CodeLine lineNumber="6579"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> MulCost = <a href="/docs/api/classes/llvm/targettransforminfo/#ac44f6b9fdbb5f9cc199f8329cb0b272ca89f768b1267e3083b4eb05b4ab77e717">TTI::TCC&#95;Free</a>;</Highlight></CodeLine>
<Link id="l06580" /><CodeLine lineNumber="6580"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/constantint">ConstantInt</a> &#42;RHS = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ConstantInt&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l06581" /><CodeLine lineNumber="6581"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!RHS || RHS-&gt;getZExtValue() != 1)</Highlight></CodeLine>
<Link id="l06582" /><CodeLine lineNumber="6582"><Highlight kind="normal">        MulCost =</Highlight></CodeLine>
<Link id="l06583" /><CodeLine lineNumber="6583"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(Instruction::Mul, VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l06584" /><CodeLine lineNumber="6584"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06585" /><CodeLine lineNumber="6585"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Find the cost of the histogram operation itself.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06586" /><CodeLine lineNumber="6586"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;PtrTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(HGram-&gt;<a href="/docs/api/structs/llvm/histograminfo/#a18ad617fc2ebb0c359d7a7364a226926">Load</a>-&gt;<a href="/docs/api/classes/llvm/loadinst/#a945c21ff70f310de538153db17e7b857">getPointerOperandType</a>(), VF);</Highlight></CodeLine>
<Link id="l06587" /><CodeLine lineNumber="6587"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarTy = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType();</Highlight></CodeLine>
<Link id="l06588" /><CodeLine lineNumber="6588"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;MaskTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext()), VF);</Highlight></CodeLine>
<Link id="l06589" /><CodeLine lineNumber="6589"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/intrinsiccostattributes">IntrinsicCostAttributes</a> ICA(Intrinsic::experimental&#95;vector&#95;histogram&#95;add,</Highlight></CodeLine>
<Link id="l06590" /><CodeLine lineNumber="6590"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/type/#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getContext()),</Highlight></CodeLine>
<Link id="l06591" /><CodeLine lineNumber="6591"><Highlight kind="normal">                                  &#123;PtrTy, ScalarTy, MaskTy&#125;);</Highlight></CodeLine>
<Link id="l06592" /><CodeLine lineNumber="6592"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06593" /><CodeLine lineNumber="6593"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Add the costs together with the add/sub operation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06594" /><CodeLine lineNumber="6594"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getIntrinsicInstrCost(ICA, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>) + MulCost +</Highlight></CodeLine>
<Link id="l06595" /><CodeLine lineNumber="6595"><Highlight kind="normal">             <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l06596" /><CodeLine lineNumber="6596"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06597" /><CodeLine lineNumber="6597"><Highlight kind="normal">    &#91;&#91;fallthrough&#93;&#93;;</Highlight></CodeLine>
<Link id="l06598" /><CodeLine lineNumber="6598"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06599" /><CodeLine lineNumber="6599"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FAdd:</Highlight></CodeLine>
<Link id="l06600" /><CodeLine lineNumber="6600"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FSub:</Highlight></CodeLine>
<Link id="l06601" /><CodeLine lineNumber="6601"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Mul:</Highlight></CodeLine>
<Link id="l06602" /><CodeLine lineNumber="6602"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FMul:</Highlight></CodeLine>
<Link id="l06603" /><CodeLine lineNumber="6603"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FDiv:</Highlight></CodeLine>
<Link id="l06604" /><CodeLine lineNumber="6604"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FRem:</Highlight></CodeLine>
<Link id="l06605" /><CodeLine lineNumber="6605"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Shl:</Highlight></CodeLine>
<Link id="l06606" /><CodeLine lineNumber="6606"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::LShr:</Highlight></CodeLine>
<Link id="l06607" /><CodeLine lineNumber="6607"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::AShr:</Highlight></CodeLine>
<Link id="l06608" /><CodeLine lineNumber="6608"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::And:</Highlight></CodeLine>
<Link id="l06609" /><CodeLine lineNumber="6609"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Or:</Highlight></CodeLine>
<Link id="l06610" /><CodeLine lineNumber="6610"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Xor: &#123;</Highlight></CodeLine>
<Link id="l06611" /><CodeLine lineNumber="6611"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If we&#39;re speculating on the stride being 1, the multiplication may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06612" /><CodeLine lineNumber="6612"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// fold away.  We can generalize this for all operations using the notion</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06613" /><CodeLine lineNumber="6613"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// of neutral elements.  (TODO)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06614" /><CodeLine lineNumber="6614"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::Mul &amp;&amp;</Highlight></CodeLine>
<Link id="l06615" /><CodeLine lineNumber="6615"><Highlight kind="normal">        ((<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)) &amp;&amp;</Highlight></CodeLine>
<Link id="l06616" /><CodeLine lineNumber="6616"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSCEV(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0))-&gt;isOne()) ||</Highlight></CodeLine>
<Link id="l06617" /><CodeLine lineNumber="6617"><Highlight kind="normal">         (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;isLoopInvariant(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1)) &amp;&amp;</Highlight></CodeLine>
<Link id="l06618" /><CodeLine lineNumber="6618"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSCEV(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1))-&gt;isOne())))</Highlight></CodeLine>
<Link id="l06619" /><CodeLine lineNumber="6619"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 0;</Highlight></CodeLine>
<Link id="l06620" /><CodeLine lineNumber="6620"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06621" /><CodeLine lineNumber="6621"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Detect reduction patterns</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06622" /><CodeLine lineNumber="6622"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4e307866e6d65e87d1e6884b0d13306c">getReductionPatternCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, VectorTy))</Highlight></CodeLine>
<Link id="l06623" /><CodeLine lineNumber="6623"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;RedCost;</Highlight></CodeLine>
<Link id="l06624" /><CodeLine lineNumber="6624"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06625" /><CodeLine lineNumber="6625"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Certain instructions can be cheaper to vectorize if they have a constant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06626" /><CodeLine lineNumber="6626"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// second vector operand. One example of this are shifts on x86.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06627" /><CodeLine lineNumber="6627"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op2 = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l06628" /><CodeLine lineNumber="6628"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Op2) &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSE()-&gt;isSCEVable(Op2-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l06629" /><CodeLine lineNumber="6629"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVConstant&gt;</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSCEV(Op2))) &#123;</Highlight></CodeLine>
<Link id="l06630" /><CodeLine lineNumber="6630"><Highlight kind="normal">      Op2 = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SCEVConstant&gt;</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a35372cc43a297f286fc6c679b14c61d2">PSE</a>.getSCEV(Op2))-&gt;getValue();</Highlight></CodeLine>
<Link id="l06631" /><CodeLine lineNumber="6631"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06632" /><CodeLine lineNumber="6632"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Op2Info = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getOperandInfo(Op2);</Highlight></CodeLine>
<Link id="l06633" /><CodeLine lineNumber="6633"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Op2Info.Kind == <a href="/docs/api/classes/llvm/targettransforminfo/#afa38851d75434d1476444ac93f94cb4ca9c0eecea29e9fa58e4dac7ee32b9b2ac">TargetTransformInfo::OK&#95;AnyValue</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l06634" /><CodeLine lineNumber="6634"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aadd9a9d699ede62468422c7cfab66e99">shouldConsiderInvariant</a>(Op2))</Highlight></CodeLine>
<Link id="l06635" /><CodeLine lineNumber="6635"><Highlight kind="normal">      Op2Info.Kind = <a href="/docs/api/classes/llvm/targettransforminfo/#afa38851d75434d1476444ac93f94cb4ca7aa61d9e9d33bdf28478754c69c59640">TargetTransformInfo::OK&#95;UniformValue</a>;</Highlight></CodeLine>
<Link id="l06636" /><CodeLine lineNumber="6636"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06637" /><CodeLine lineNumber="6637"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;, 4&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operand&#95;values());</Highlight></CodeLine>
<Link id="l06638" /><CodeLine lineNumber="6638"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(</Highlight></CodeLine>
<Link id="l06639" /><CodeLine lineNumber="6639"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>,</Highlight></CodeLine>
<Link id="l06640" /><CodeLine lineNumber="6640"><Highlight kind="normal">        &#123;TargetTransformInfo::OK&#95;AnyValue, TargetTransformInfo::OP&#95;None&#125;,</Highlight></CodeLine>
<Link id="l06641" /><CodeLine lineNumber="6641"><Highlight kind="normal">        Op2Info, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>);</Highlight></CodeLine>
<Link id="l06642" /><CodeLine lineNumber="6642"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06643" /><CodeLine lineNumber="6643"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FNeg: &#123;</Highlight></CodeLine>
<Link id="l06644" /><CodeLine lineNumber="6644"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(</Highlight></CodeLine>
<Link id="l06645" /><CodeLine lineNumber="6645"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>,</Highlight></CodeLine>
<Link id="l06646" /><CodeLine lineNumber="6646"><Highlight kind="normal">        &#123;TargetTransformInfo::OK&#95;AnyValue, TargetTransformInfo::OP&#95;None&#125;,</Highlight></CodeLine>
<Link id="l06647" /><CodeLine lineNumber="6647"><Highlight kind="normal">        &#123;TargetTransformInfo::OK&#95;AnyValue, TargetTransformInfo::OP&#95;None&#125;,</Highlight></CodeLine>
<Link id="l06648" /><CodeLine lineNumber="6648"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0), <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06649" /><CodeLine lineNumber="6649"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06650" /><CodeLine lineNumber="6650"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Select: &#123;</Highlight></CodeLine>
<Link id="l06651" /><CodeLine lineNumber="6651"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/selectinst">SelectInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SelectInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06652" /><CodeLine lineNumber="6652"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/scev">SCEV</a> &#42;CondSCEV = SE-&gt;getSCEV(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition());</Highlight></CodeLine>
<Link id="l06653" /><CodeLine lineNumber="6653"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ScalarCond = (SE-&gt;isLoopInvariant(CondSCEV, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>));</Highlight></CodeLine>
<Link id="l06654" /><CodeLine lineNumber="6654"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06655" /><CodeLine lineNumber="6655"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/value">Value</a> &#42;Op0, &#42;Op1;</Highlight></CodeLine>
<Link id="l06656" /><CodeLine lineNumber="6656"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</Highlight></CodeLine>
<Link id="l06657" /><CodeLine lineNumber="6657"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ScalarCond &amp;&amp; (<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#acf8c16eed89e5ee1a10b6dfc08a33b3a">m&#95;LogicalAnd</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op1))) ||</Highlight></CodeLine>
<Link id="l06658" /><CodeLine lineNumber="6658"><Highlight kind="normal">                        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op0), <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Op1))))) &#123;</Highlight></CodeLine>
<Link id="l06659" /><CodeLine lineNumber="6659"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// select x, y, false --&gt; x &amp; y</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06660" /><CodeLine lineNumber="6660"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// select x, true, y --&gt; x | y</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06661" /><CodeLine lineNumber="6661"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#91;Op1VK, Op1VP&#93; = <a href="/docs/api/classes/llvm/targettransforminfo/#a5fecba95c1ba20950ea8e2139127e621">TTI::getOperandInfo</a>(Op0);</Highlight></CodeLine>
<Link id="l06662" /><CodeLine lineNumber="6662"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#91;Op2VK, Op2VP&#93; = <a href="/docs/api/classes/llvm/targettransforminfo/#a5fecba95c1ba20950ea8e2139127e621">TTI::getOperandInfo</a>(Op1);</Highlight></CodeLine>
<Link id="l06663" /><CodeLine lineNumber="6663"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Op0-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() == 1 &amp;&amp;</Highlight></CodeLine>
<Link id="l06664" /><CodeLine lineNumber="6664"><Highlight kind="normal">              Op1-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() == 1);</Highlight></CodeLine>
<Link id="l06665" /><CodeLine lineNumber="6665"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06666" /><CodeLine lineNumber="6666"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;const Value &#42;, 2&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#123;Op0, Op1&#125;;</Highlight></CodeLine>
<Link id="l06667" /><CodeLine lineNumber="6667"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(</Highlight></CodeLine>
<Link id="l06668" /><CodeLine lineNumber="6668"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a5cce7a41c7581ff15a23ab90eb3b403a">m&#95;LogicalOr</a>()) ? Instruction::Or : Instruction::And, VectorTy,</Highlight></CodeLine>
<Link id="l06669" /><CodeLine lineNumber="6669"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, &#123;Op1VK, Op1VP&#125;, &#123;Op2VK, Op2VP&#125;, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06670" /><CodeLine lineNumber="6670"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06671" /><CodeLine lineNumber="6671"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06672" /><CodeLine lineNumber="6672"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;CondTy = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition()-&gt;getType();</Highlight></CodeLine>
<Link id="l06673" /><CodeLine lineNumber="6673"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ScalarCond)</Highlight></CodeLine>
<Link id="l06674" /><CodeLine lineNumber="6674"><Highlight kind="normal">      CondTy = <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(CondTy, VF);</Highlight></CodeLine>
<Link id="l06675" /><CodeLine lineNumber="6675"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06676" /><CodeLine lineNumber="6676"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78b">CmpInst::Predicate</a> Pred = <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba07aee43ffb66908a25c55c77ce4c0d05">CmpInst::BAD&#95;ICMP&#95;PREDICATE</a>;</Highlight></CodeLine>
<Link id="l06677" /><CodeLine lineNumber="6677"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CmpInst&gt;</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition()))</Highlight></CodeLine>
<Link id="l06678" /><CodeLine lineNumber="6678"><Highlight kind="normal">      Pred = Cmp-&gt;getPredicate();</Highlight></CodeLine>
<Link id="l06679" /><CodeLine lineNumber="6679"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCmpSelInstrCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, CondTy, Pred,</Highlight></CodeLine>
<Link id="l06680" /><CodeLine lineNumber="6680"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, &#123;TTI::OK&#95;AnyValue, TTI::OP&#95;None&#125;,</Highlight></CodeLine>
<Link id="l06681" /><CodeLine lineNumber="6681"><Highlight kind="normal">                                  &#123;TTI::OK&#95;AnyValue, TTI::OP&#95;None&#125;, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06682" /><CodeLine lineNumber="6682"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06683" /><CodeLine lineNumber="6683"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ICmp:</Highlight></CodeLine>
<Link id="l06684" /><CodeLine lineNumber="6684"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FCmp: &#123;</Highlight></CodeLine>
<Link id="l06685" /><CodeLine lineNumber="6685"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;ValTy = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType();</Highlight></CodeLine>
<Link id="l06686" /><CodeLine lineNumber="6686"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06687" /><CodeLine lineNumber="6687"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa8c00664c6be2042407f13e4fcad950b">canTruncateToMinimalBitwidth</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</Highlight></CodeLine>
<Link id="l06688" /><CodeLine lineNumber="6688"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Op0AsInstruction = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l06689" /><CodeLine lineNumber="6689"><Highlight kind="normal">      (void)Op0AsInstruction;</Highlight></CodeLine>
<Link id="l06690" /><CodeLine lineNumber="6690"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa8c00664c6be2042407f13e4fcad950b">canTruncateToMinimalBitwidth</a>(Op0AsInstruction, VF) ||</Highlight></CodeLine>
<Link id="l06691" /><CodeLine lineNumber="6691"><Highlight kind="normal">              MinBWs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; == MinBWs&#91;Op0AsInstruction&#93;) &amp;&amp;</Highlight></CodeLine>
<Link id="l06692" /><CodeLine lineNumber="6692"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;if both the operand and the compare are marked for &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06693" /><CodeLine lineNumber="6693"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;truncation, they must have the same bitwidth&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06694" /><CodeLine lineNumber="6694"><Highlight kind="normal">      ValTy = <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(ValTy-&gt;getContext(), MinBWs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</Highlight></CodeLine>
<Link id="l06695" /><CodeLine lineNumber="6695"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06696" /><CodeLine lineNumber="6696"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06697" /><CodeLine lineNumber="6697"><Highlight kind="normal">    VectorTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(ValTy, VF);</Highlight></CodeLine>
<Link id="l06698" /><CodeLine lineNumber="6698"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCmpSelInstrCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode(), VectorTy, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l06699" /><CodeLine lineNumber="6699"><Highlight kind="normal">                                  <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CmpInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;getPredicate(), <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>,</Highlight></CodeLine>
<Link id="l06700" /><CodeLine lineNumber="6700"><Highlight kind="normal">                                  &#123;TTI::OK&#95;AnyValue, TTI::OP&#95;None&#125;,</Highlight></CodeLine>
<Link id="l06701" /><CodeLine lineNumber="6701"><Highlight kind="normal">                                  &#123;TTI::OK&#95;AnyValue, TTI::OP&#95;None&#125;, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06702" /><CodeLine lineNumber="6702"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06703" /><CodeLine lineNumber="6703"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Store:</Highlight></CodeLine>
<Link id="l06704" /><CodeLine lineNumber="6704"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Load: &#123;</Highlight></CodeLine>
<Link id="l06705" /><CodeLine lineNumber="6705"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> Width = VF;</Highlight></CodeLine>
<Link id="l06706" /><CodeLine lineNumber="6706"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Width.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()) &#123;</Highlight></CodeLine>
<Link id="l06707" /><CodeLine lineNumber="6707"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">InstWidening</a> Decision = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Width);</Highlight></CodeLine>
<Link id="l06708" /><CodeLine lineNumber="6708"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Decision != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">CM&#95;Unknown</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l06709" /><CodeLine lineNumber="6709"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;CM decision should be taken at this point&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06710" /><CodeLine lineNumber="6710"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af7844564539b9f0f917e8f2380a064b3">getWideningCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) == <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>())</Highlight></CodeLine>
<Link id="l06711" /><CodeLine lineNumber="6711"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l06712" /><CodeLine lineNumber="6712"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Decision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">CM&#95;Scalarize</a>)</Highlight></CodeLine>
<Link id="l06713" /><CodeLine lineNumber="6713"><Highlight kind="normal">        Width = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1);</Highlight></CodeLine>
<Link id="l06714" /><CodeLine lineNumber="6714"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06715" /><CodeLine lineNumber="6715"><Highlight kind="normal">    VectorTy = <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), Width);</Highlight></CodeLine>
<Link id="l06716" /><CodeLine lineNumber="6716"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> getMemoryInstructionCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l06717" /><CodeLine lineNumber="6717"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06718" /><CodeLine lineNumber="6718"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::BitCast:</Highlight></CodeLine>
<Link id="l06719" /><CodeLine lineNumber="6719"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType()-&gt;isPointerTy())</Highlight></CodeLine>
<Link id="l06720" /><CodeLine lineNumber="6720"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 0;</Highlight></CodeLine>
<Link id="l06721" /><CodeLine lineNumber="6721"><Highlight kind="normal">    &#91;&#91;fallthrough&#93;&#93;;</Highlight></CodeLine>
<Link id="l06722" /><CodeLine lineNumber="6722"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ZExt:</Highlight></CodeLine>
<Link id="l06723" /><CodeLine lineNumber="6723"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SExt:</Highlight></CodeLine>
<Link id="l06724" /><CodeLine lineNumber="6724"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPToUI:</Highlight></CodeLine>
<Link id="l06725" /><CodeLine lineNumber="6725"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPToSI:</Highlight></CodeLine>
<Link id="l06726" /><CodeLine lineNumber="6726"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPExt:</Highlight></CodeLine>
<Link id="l06727" /><CodeLine lineNumber="6727"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::PtrToInt:</Highlight></CodeLine>
<Link id="l06728" /><CodeLine lineNumber="6728"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::IntToPtr:</Highlight></CodeLine>
<Link id="l06729" /><CodeLine lineNumber="6729"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SIToFP:</Highlight></CodeLine>
<Link id="l06730" /><CodeLine lineNumber="6730"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::UIToFP:</Highlight></CodeLine>
<Link id="l06731" /><CodeLine lineNumber="6731"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Trunc:</Highlight></CodeLine>
<Link id="l06732" /><CodeLine lineNumber="6732"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FPTrunc: &#123;</Highlight></CodeLine>
<Link id="l06733" /><CodeLine lineNumber="6733"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Computes the CastContextHint from a Load/Store instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06734" /><CodeLine lineNumber="6734"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ComputeCCH = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64">TTI::CastContextHint</a> &#123;</Highlight></CodeLine>
<Link id="l06735" /><CodeLine lineNumber="6735"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</Highlight></CodeLine>
<Link id="l06736" /><CodeLine lineNumber="6736"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Expected a load or a store!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06737" /><CodeLine lineNumber="6737"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06738" /><CodeLine lineNumber="6738"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l06739" /><CodeLine lineNumber="6739"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a960b44c579bc2f6818d2daaf9e4c16f0">TTI::CastContextHint::Normal</a>;</Highlight></CodeLine>
<Link id="l06740" /><CodeLine lineNumber="6740"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06741" /><CodeLine lineNumber="6741"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</Highlight></CodeLine>
<Link id="l06742" /><CodeLine lineNumber="6742"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ae849d400780f51424bc4e4c26ddf3000">LoopVectorizationCostModel::CM&#95;GatherScatter</a>:</Highlight></CodeLine>
<Link id="l06743" /><CodeLine lineNumber="6743"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64afc2e3edeec59afcdc10f55205713f14b">TTI::CastContextHint::GatherScatter</a>;</Highlight></CodeLine>
<Link id="l06744" /><CodeLine lineNumber="6744"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971">LoopVectorizationCostModel::CM&#95;Interleave</a>:</Highlight></CodeLine>
<Link id="l06745" /><CodeLine lineNumber="6745"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64ad392556b3674a98332cc2938ba0bfeb7">TTI::CastContextHint::Interleave</a>;</Highlight></CodeLine>
<Link id="l06746" /><CodeLine lineNumber="6746"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">LoopVectorizationCostModel::CM&#95;Scalarize</a>:</Highlight></CodeLine>
<Link id="l06747" /><CodeLine lineNumber="6747"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260adc468760c02910f77bad7525bc66c334">LoopVectorizationCostModel::CM&#95;Widen</a>:</Highlight></CodeLine>
<Link id="l06748" /><CodeLine lineNumber="6748"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ? <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6864311f985d160ad4bd46a9fbe4a4d4">TTI::CastContextHint::Masked</a></Highlight></CodeLine>
<Link id="l06749" /><CodeLine lineNumber="6749"><Highlight kind="normal">                                        : <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a960b44c579bc2f6818d2daaf9e4c16f0">TTI::CastContextHint::Normal</a>;</Highlight></CodeLine>
<Link id="l06750" /><CodeLine lineNumber="6750"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a058eacbd3c28e2ecec2af7db726ce527">LoopVectorizationCostModel::CM&#95;Widen&#95;Reverse</a>:</Highlight></CodeLine>
<Link id="l06751" /><CodeLine lineNumber="6751"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a030aa94015bd11d183b897ddb541e4e3">TTI::CastContextHint::Reversed</a>;</Highlight></CodeLine>
<Link id="l06752" /><CodeLine lineNumber="6752"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">LoopVectorizationCostModel::CM&#95;Unknown</a>:</Highlight></CodeLine>
<Link id="l06753" /><CodeLine lineNumber="6753"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;Instr did not go through cost modelling?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06754" /><CodeLine lineNumber="6754"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ab6fd5f45ab6e363de6c3f42472d439ac">LoopVectorizationCostModel::CM&#95;VectorCall</a>:</Highlight></CodeLine>
<Link id="l06755" /><CodeLine lineNumber="6755"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a679b46cebdf2f87b9efd0413c960314a">LoopVectorizationCostModel::CM&#95;IntrinsicCall</a>:</Highlight></CodeLine>
<Link id="l06756" /><CodeLine lineNumber="6756"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a8cb1f2bd469f8a823857a1cf1447a0e3">llvm&#95;unreachable&#95;internal</a>(</Highlight><Highlight kind="stringliteral">&quot;Instr has invalid widening decision&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06757" /><CodeLine lineNumber="6757"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06758" /><CodeLine lineNumber="6758"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06759" /><CodeLine lineNumber="6759"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;Unhandled case!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06760" /><CodeLine lineNumber="6760"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l06761" /><CodeLine lineNumber="6761"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06762" /><CodeLine lineNumber="6762"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Opcode = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode();</Highlight></CodeLine>
<Link id="l06763" /><CodeLine lineNumber="6763"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64">TTI::CastContextHint</a> CCH = <a href="/docs/api/classes/llvm/targettransforminfo/#af84cce349a77262269fd3f6756f37a64a6adf97f83acf6453d4a6a4b1070f3754">TTI::CastContextHint::None</a>;</Highlight></CodeLine>
<Link id="l06764" /><CodeLine lineNumber="6764"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For Trunc, the context is the only user, which must be a StoreInst.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06765" /><CodeLine lineNumber="6765"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Opcode == Instruction::Trunc || Opcode == Instruction::FPTrunc) &#123;</Highlight></CodeLine>
<Link id="l06766" /><CodeLine lineNumber="6766"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l06767" /><CodeLine lineNumber="6767"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;Store = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;user&#95;begin()))</Highlight></CodeLine>
<Link id="l06768" /><CodeLine lineNumber="6768"><Highlight kind="normal">          CCH = ComputeCCH(Store);</Highlight></CodeLine>
<Link id="l06769" /><CodeLine lineNumber="6769"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06770" /><CodeLine lineNumber="6770"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For Z/Sext, the context is the operand, which must be a LoadInst.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06771" /><CodeLine lineNumber="6771"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Opcode == Instruction::ZExt || Opcode == Instruction::SExt ||</Highlight></CodeLine>
<Link id="l06772" /><CodeLine lineNumber="6772"><Highlight kind="normal">             Opcode == Instruction::FPExt) &#123;</Highlight></CodeLine>
<Link id="l06773" /><CodeLine lineNumber="6773"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;Load = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)))</Highlight></CodeLine>
<Link id="l06774" /><CodeLine lineNumber="6774"><Highlight kind="normal">        CCH = ComputeCCH(Load);</Highlight></CodeLine>
<Link id="l06775" /><CodeLine lineNumber="6775"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06776" /><CodeLine lineNumber="6776"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06777" /><CodeLine lineNumber="6777"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We optimize the truncation of induction variables having constant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06778" /><CodeLine lineNumber="6778"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// integer steps. The cost of these truncations is the same as the scalar</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06779" /><CodeLine lineNumber="6779"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// operation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06780" /><CodeLine lineNumber="6780"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a61375f5189558cc261186f388d31fe92">isOptimizableIVTruncate</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</Highlight></CodeLine>
<Link id="l06781" /><CodeLine lineNumber="6781"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Trunc = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;TruncInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06782" /><CodeLine lineNumber="6782"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(Instruction::Trunc, Trunc-&gt;getDestTy(),</Highlight></CodeLine>
<Link id="l06783" /><CodeLine lineNumber="6783"><Highlight kind="normal">                                  Trunc-&gt;getSrcTy(), CCH, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, Trunc);</Highlight></CodeLine>
<Link id="l06784" /><CodeLine lineNumber="6784"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06785" /><CodeLine lineNumber="6785"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06786" /><CodeLine lineNumber="6786"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Detect reduction patterns</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06787" /><CodeLine lineNumber="6787"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> RedCost = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4e307866e6d65e87d1e6884b0d13306c">getReductionPatternCost</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, VectorTy))</Highlight></CodeLine>
<Link id="l06788" /><CodeLine lineNumber="6788"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#42;RedCost;</Highlight></CodeLine>
<Link id="l06789" /><CodeLine lineNumber="6789"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06790" /><CodeLine lineNumber="6790"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcScalarTy = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0)-&gt;getType();</Highlight></CodeLine>
<Link id="l06791" /><CodeLine lineNumber="6791"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Op0AsInstruction = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l06792" /><CodeLine lineNumber="6792"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa8c00664c6be2042407f13e4fcad950b">canTruncateToMinimalBitwidth</a>(Op0AsInstruction, VF))</Highlight></CodeLine>
<Link id="l06793" /><CodeLine lineNumber="6793"><Highlight kind="normal">      SrcScalarTy =</Highlight></CodeLine>
<Link id="l06794" /><CodeLine lineNumber="6794"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/integertype/#a14f7b4f1aed38192fb6b7772eb506bdb">IntegerType::get</a>(SrcScalarTy-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>(), MinBWs&#91;Op0AsInstruction&#93;);</Highlight></CodeLine>
<Link id="l06795" /><CodeLine lineNumber="6795"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/type">Type</a> &#42;SrcVecTy =</Highlight></CodeLine>
<Link id="l06796" /><CodeLine lineNumber="6796"><Highlight kind="normal">        VectorTy-&gt;<a href="/docs/api/classes/llvm/type/#a1bc022868b23918efa44df511f4d5b61">isVectorTy</a>() ? <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(SrcScalarTy, VF) : SrcScalarTy;</Highlight></CodeLine>
<Link id="l06797" /><CodeLine lineNumber="6797"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06798" /><CodeLine lineNumber="6798"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aa8c00664c6be2042407f13e4fcad950b">canTruncateToMinimalBitwidth</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF)) &#123;</Highlight></CodeLine>
<Link id="l06799" /><CodeLine lineNumber="6799"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the result type is &lt;= the source type, there will be no extend</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06800" /><CodeLine lineNumber="6800"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// after truncating the users to the minimal required bitwidth.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06801" /><CodeLine lineNumber="6801"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VectorTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &lt;= SrcVecTy-&gt;<a href="/docs/api/classes/llvm/type/#a9f382207d841377156d4c7868b66b9a5">getScalarSizeInBits</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l06802" /><CodeLine lineNumber="6802"><Highlight kind="normal">          (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::ZExt ||</Highlight></CodeLine>
<Link id="l06803" /><CodeLine lineNumber="6803"><Highlight kind="normal">           <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::SExt))</Highlight></CodeLine>
<Link id="l06804" /><CodeLine lineNumber="6804"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> 0;</Highlight></CodeLine>
<Link id="l06805" /><CodeLine lineNumber="6805"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06806" /><CodeLine lineNumber="6806"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06807" /><CodeLine lineNumber="6807"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getCastInstrCost(Opcode, VectorTy, SrcVecTy, CCH, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06808" /><CodeLine lineNumber="6808"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06809" /><CodeLine lineNumber="6809"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Call:</Highlight></CodeLine>
<Link id="l06810" /><CodeLine lineNumber="6810"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad1f0755693a05c2b008e9a576c3b162b">getVectorCallCost</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), VF);</Highlight></CodeLine>
<Link id="l06811" /><CodeLine lineNumber="6811"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ExtractValue:</Highlight></CodeLine>
<Link id="l06812" /><CodeLine lineNumber="6812"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getInstructionCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l06813" /><CodeLine lineNumber="6813"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Alloca:</Highlight></CodeLine>
<Link id="l06814" /><CodeLine lineNumber="6814"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We cannot easily widen alloca to a scalable alloca, as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06815" /><CodeLine lineNumber="6815"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the result would need to be a vector of pointers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06816" /><CodeLine lineNumber="6816"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>())</Highlight></CodeLine>
<Link id="l06817" /><CodeLine lineNumber="6817"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncost/#a57207993e2fe6ec98912e8072e4600bc">InstructionCost::getInvalid</a>();</Highlight></CodeLine>
<Link id="l06818" /><CodeLine lineNumber="6818"><Highlight kind="normal">    &#91;&#91;fallthrough&#93;&#93;;</Highlight></CodeLine>
<Link id="l06819" /><CodeLine lineNumber="6819"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l06820" /><CodeLine lineNumber="6820"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This opcode is unknown. Assume that it is the same as &#39;mul&#39;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06821" /><CodeLine lineNumber="6821"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.getArithmeticInstrCost(Instruction::Mul, VectorTy, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l06822" /><CodeLine lineNumber="6822"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="comment">// end of switch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06823" /><CodeLine lineNumber="6823"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06824" /><CodeLine lineNumber="6824"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06825" /><CodeLine lineNumber="6825" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0ac5df8f0304981180d602dacb13512c"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a0ac5df8f0304981180d602dacb13512c">LoopVectorizationCostModel::collectValuesToIgnore</a>() &#123;</Highlight></CodeLine>
<Link id="l06826" /><CodeLine lineNumber="6826"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Ignore ephemeral values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06827" /><CodeLine lineNumber="6827"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/codemetrics/#a7e174506b52ad46ea1f746a7f727d999">CodeMetrics::collectEphemeralValues</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aba357162dc28acb3a399731e1e397614">AC</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>);</Highlight></CodeLine>
<Link id="l06828" /><CodeLine lineNumber="6828"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06829" /><CodeLine lineNumber="6829"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> DeadInterleavePointerOps;</Highlight></CodeLine>
<Link id="l06830" /><CodeLine lineNumber="6830"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Value &#42;, 4&gt;</a> DeadOps;</Highlight></CodeLine>
<Link id="l06831" /><CodeLine lineNumber="6831"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06832" /><CodeLine lineNumber="6832"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If a scalar epilogue is required, users outside the loop won&#39;t use</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06833" /><CodeLine lineNumber="6833"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// live-outs from the vector loop but from the scalar epilogue. Ignore them if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06834" /><CodeLine lineNumber="6834"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that is the case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06835" /><CodeLine lineNumber="6835"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> RequiresScalarEpilogue = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a913ab9c8291000dd3a1c3739194b03e4">requiresScalarEpilogue</a>(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l06836" /><CodeLine lineNumber="6836"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsLiveOutDead = &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, RequiresScalarEpilogue&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l06837" /><CodeLine lineNumber="6837"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> RequiresScalarEpilogue &amp;&amp;</Highlight></CodeLine>
<Link id="l06838" /><CodeLine lineNumber="6838"><Highlight kind="normal">           !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>());</Highlight></CodeLine>
<Link id="l06839" /><CodeLine lineNumber="6839"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l06840" /><CodeLine lineNumber="6840"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06841" /><CodeLine lineNumber="6841"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopblocksdfs">LoopBlocksDFS</a> DFS(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l06842" /><CodeLine lineNumber="6842"><Highlight kind="normal">  DFS.<a href="/docs/api/classes/llvm/loopblocksdfs/#adc85a5f08fb0f5dc3e053975995c9d29">perform</a>(<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a8c62d3e36a2d815cbfac5a1579ccbb01">LI</a>);</Highlight></CodeLine>
<Link id="l06843" /><CodeLine lineNumber="6843"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;Value &#42;, SmallVector&lt;Value &#42;&gt;</a>&gt; DeadInvariantStoreOps;</Highlight></CodeLine>
<Link id="l06844" /><CodeLine lineNumber="6844"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(<a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(DFS.<a href="/docs/api/classes/llvm/loopblocksdfs/#a003fe6215d300fc9720b1b056cdf4c23">beginRPO</a>(), DFS.<a href="/docs/api/classes/llvm/loopblocksdfs/#aeebda6b0288bea7cd706111624ca73f6">endRPO</a>())))</Highlight></CodeLine>
<Link id="l06845" /><CodeLine lineNumber="6845"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(&#42;BB)) &#123;</Highlight></CodeLine>
<Link id="l06846" /><CodeLine lineNumber="6846"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Find all stores to invariant variables. Since they are going to sink</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06847" /><CodeLine lineNumber="6847"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// outside the loop we do not need calculate cost for them.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06848" /><CodeLine lineNumber="6848"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>;</Highlight></CodeLine>
<Link id="l06849" /><CodeLine lineNumber="6849"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</Highlight></CodeLine>
<Link id="l06850" /><CodeLine lineNumber="6850"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;isInvariantAddressOfReduction(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand())) &#123;</Highlight></CodeLine>
<Link id="l06851" /><CodeLine lineNumber="6851"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>.insert(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06852" /><CodeLine lineNumber="6852"><Highlight kind="normal">        DeadInvariantStoreOps&#91;<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand()&#93;.push&#95;back(</Highlight></CodeLine>
<Link id="l06853" /><CodeLine lineNumber="6853"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getValueOperand());</Highlight></CodeLine>
<Link id="l06854" /><CodeLine lineNumber="6854"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06855" /><CodeLine lineNumber="6855"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06856" /><CodeLine lineNumber="6856"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.contains(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>.contains(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l06857" /><CodeLine lineNumber="6857"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06858" /><CodeLine lineNumber="6858"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06859" /><CodeLine lineNumber="6859"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Add instructions that would be trivially dead and are only used by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06860" /><CodeLine lineNumber="6860"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// values already ignored to DeadOps to seed worklist.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06861" /><CodeLine lineNumber="6861"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a845142f96a84f067cb6bf639e37980d0">wouldInstructionBeTriviallyDead</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l06862" /><CodeLine lineNumber="6862"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.users(), &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, IsLiveOutDead&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l06863" /><CodeLine lineNumber="6863"><Highlight kind="normal">            return VecValuesToIgnore.contains(U) ||</Highlight></CodeLine>
<Link id="l06864" /><CodeLine lineNumber="6864"><Highlight kind="normal">                   ValuesToIgnore.contains(U) || IsLiveOutDead(U);</Highlight></CodeLine>
<Link id="l06865" /><CodeLine lineNumber="6865"><Highlight kind="normal">          &#125;))</Highlight></CodeLine>
<Link id="l06866" /><CodeLine lineNumber="6866"><Highlight kind="normal">        DeadOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06867" /><CodeLine lineNumber="6867"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06868" /><CodeLine lineNumber="6868"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// For interleave groups, we only create a pointer for the start of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06869" /><CodeLine lineNumber="6869"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// interleave group. Queue up addresses of group members except the insert</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06870" /><CodeLine lineNumber="6870"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// position for further processing.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06871" /><CodeLine lineNumber="6871"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a85e3110b9fe54caf00fe4297d1b4f0b6">isAccessInterleaved</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l06872" /><CodeLine lineNumber="6872"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Group = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5a1e4ba873eb1b26dd3649a530a3e36c">getInterleavedAccessGroup</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06873" /><CodeLine lineNumber="6873"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Group-&gt;getInsertPos() == &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l06874" /><CodeLine lineNumber="6874"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06875" /><CodeLine lineNumber="6875"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;PointerOp = <a href="/docs/api/namespaces/llvm/#a2922c0c507ccec5bea4642aff9e2e328">getLoadStorePointerOperand</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06876" /><CodeLine lineNumber="6876"><Highlight kind="normal">        DeadInterleavePointerOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(PointerOp);</Highlight></CodeLine>
<Link id="l06877" /><CodeLine lineNumber="6877"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06878" /><CodeLine lineNumber="6878"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06879" /><CodeLine lineNumber="6879"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Queue branches for analysis. They are dead, if their successors only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06880" /><CodeLine lineNumber="6880"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// contain dead instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06881" /><CodeLine lineNumber="6881"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Br = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l06882" /><CodeLine lineNumber="6882"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Br-&gt;isConditional())</Highlight></CodeLine>
<Link id="l06883" /><CodeLine lineNumber="6883"><Highlight kind="normal">          DeadOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l06884" /><CodeLine lineNumber="6884"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06885" /><CodeLine lineNumber="6885"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06886" /><CodeLine lineNumber="6886"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06887" /><CodeLine lineNumber="6887"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Mark ops feeding interleave group members as free, if they are only used</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06888" /><CodeLine lineNumber="6888"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// by other dead computations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06889" /><CodeLine lineNumber="6889"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != DeadInterleavePointerOps.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l06890" /><CodeLine lineNumber="6890"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(DeadInterleavePointerOps&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</Highlight></CodeLine>
<Link id="l06891" /><CodeLine lineNumber="6891"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) || <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;users(), &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l06892" /><CodeLine lineNumber="6892"><Highlight kind="normal">          Instruction &#42;UI = cast&lt;Instruction&gt;(U);</Highlight></CodeLine>
<Link id="l06893" /><CodeLine lineNumber="6893"><Highlight kind="normal">          return !VecValuesToIgnore.contains(U) &amp;&amp;</Highlight></CodeLine>
<Link id="l06894" /><CodeLine lineNumber="6894"><Highlight kind="normal">                 (!isAccessInterleaved(UI) ||</Highlight></CodeLine>
<Link id="l06895" /><CodeLine lineNumber="6895"><Highlight kind="normal">                  getInterleavedAccessGroup(UI)-&gt;getInsertPos() == UI);</Highlight></CodeLine>
<Link id="l06896" /><CodeLine lineNumber="6896"><Highlight kind="normal">        &#125;))</Highlight></CodeLine>
<Link id="l06897" /><CodeLine lineNumber="6897"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06898" /><CodeLine lineNumber="6898"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.insert(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l06899" /><CodeLine lineNumber="6899"><Highlight kind="normal">    DeadInterleavePointerOps.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;op&#95;begin(), <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;op&#95;end());</Highlight></CodeLine>
<Link id="l06900" /><CodeLine lineNumber="6900"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06901" /><CodeLine lineNumber="6901"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06902" /><CodeLine lineNumber="6902"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#93; : DeadInvariantStoreOps) &#123;</Highlight></CodeLine>
<Link id="l06903" /><CodeLine lineNumber="6903"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/namespaces/llvm/#ab9c6b351507d3c0730f4290919d43a12">ArrayRef</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>).drop&#95;back())</Highlight></CodeLine>
<Link id="l06904" /><CodeLine lineNumber="6904"><Highlight kind="normal">      DeadOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l06905" /><CodeLine lineNumber="6905"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06906" /><CodeLine lineNumber="6906"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Mark ops that would be trivially dead and are only used by ignored</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06907" /><CodeLine lineNumber="6907"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instructions as free.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06908" /><CodeLine lineNumber="6908"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Header = <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;getHeader();</Highlight></CodeLine>
<Link id="l06909" /><CodeLine lineNumber="6909"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06910" /><CodeLine lineNumber="6910"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Returns true if the block contains only dead instructions. Such blocks will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06911" /><CodeLine lineNumber="6911"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// be removed by VPlan-to-VPlan transforms and won&#39;t be considered by the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06912" /><CodeLine lineNumber="6912"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// VPlan-based cost model, so skip them in the legacy cost-model as well.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06913" /><CodeLine lineNumber="6913"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp/#a87d0fbdabd17122a3febe35d7fbefb60">IsEmptyBlock</a> = &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l06914" /><CodeLine lineNumber="6914"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(&#42;BB, &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l06915" /><CodeLine lineNumber="6915"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>.contains(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.contains(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ||</Highlight></CodeLine>
<Link id="l06916" /><CodeLine lineNumber="6916"><Highlight kind="normal">             (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;isConditional());</Highlight></CodeLine>
<Link id="l06917" /><CodeLine lineNumber="6917"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l06918" /><CodeLine lineNumber="6918"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l06919" /><CodeLine lineNumber="6919"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != DeadOps.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l06920" /><CodeLine lineNumber="6920"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(DeadOps&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;);</Highlight></CodeLine>
<Link id="l06921" /><CodeLine lineNumber="6921"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06922" /><CodeLine lineNumber="6922"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if the branch should be considered dead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06923" /><CodeLine lineNumber="6923"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Br = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;BranchInst&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) &#123;</Highlight></CodeLine>
<Link id="l06924" /><CodeLine lineNumber="6924"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ThenBB = Br-&gt;getSuccessor(0);</Highlight></CodeLine>
<Link id="l06925" /><CodeLine lineNumber="6925"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ElseBB = Br-&gt;getSuccessor(1);</Highlight></CodeLine>
<Link id="l06926" /><CodeLine lineNumber="6926"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Don&#39;t considers branches leaving the loop for simplification.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06927" /><CodeLine lineNumber="6927"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(ThenBB) || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(ElseBB))</Highlight></CodeLine>
<Link id="l06928" /><CodeLine lineNumber="6928"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06929" /><CodeLine lineNumber="6929"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ThenEmpty = <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp/#a87d0fbdabd17122a3febe35d7fbefb60">IsEmptyBlock</a>(ThenBB);</Highlight></CodeLine>
<Link id="l06930" /><CodeLine lineNumber="6930"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ElseEmpty = <a href="/docs/api/files/lib/lib/codegen/branchfolding-cpp/#a87d0fbdabd17122a3febe35d7fbefb60">IsEmptyBlock</a>(ElseBB);</Highlight></CodeLine>
<Link id="l06931" /><CodeLine lineNumber="6931"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((ThenEmpty &amp;&amp; ElseEmpty) ||</Highlight></CodeLine>
<Link id="l06932" /><CodeLine lineNumber="6932"><Highlight kind="normal">          (ThenEmpty &amp;&amp; ThenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>() == ElseBB &amp;&amp;</Highlight></CodeLine>
<Link id="l06933" /><CodeLine lineNumber="6933"><Highlight kind="normal">           ElseBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>().empty()) ||</Highlight></CodeLine>
<Link id="l06934" /><CodeLine lineNumber="6934"><Highlight kind="normal">          (ElseEmpty &amp;&amp; ElseBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a79c007dcf9fff57e1569e778d7885b5e">getSingleSuccessor</a>() == ThenBB &amp;&amp;</Highlight></CodeLine>
<Link id="l06935" /><CodeLine lineNumber="6935"><Highlight kind="normal">           ThenBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>().empty())) &#123;</Highlight></CodeLine>
<Link id="l06936" /><CodeLine lineNumber="6936"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.insert(Br);</Highlight></CodeLine>
<Link id="l06937" /><CodeLine lineNumber="6937"><Highlight kind="normal">        DeadOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Br-&gt;getCondition());</Highlight></CodeLine>
<Link id="l06938" /><CodeLine lineNumber="6938"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l06939" /><CodeLine lineNumber="6939"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06940" /><CodeLine lineNumber="6940"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l06941" /><CodeLine lineNumber="6941"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06942" /><CodeLine lineNumber="6942"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Skip any op that shouldn&#39;t be considered dead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06943" /><CodeLine lineNumber="6943"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> || !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) ||</Highlight></CodeLine>
<Link id="l06944" /><CodeLine lineNumber="6944"><Highlight kind="normal">        (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &amp;&amp; <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getParent() == Header) ||</Highlight></CodeLine>
<Link id="l06945" /><CodeLine lineNumber="6945"><Highlight kind="normal">        !<a href="/docs/api/namespaces/llvm/#a845142f96a84f067cb6bf639e37980d0">wouldInstructionBeTriviallyDead</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a598f8ca344de1cfac7a7985b212bb66b">TLI</a>) ||</Highlight></CodeLine>
<Link id="l06946" /><CodeLine lineNumber="6946"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;users(), &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, IsLiveOutDead&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l06947" /><CodeLine lineNumber="6947"><Highlight kind="normal">          return !VecValuesToIgnore.contains(U) &amp;&amp;</Highlight></CodeLine>
<Link id="l06948" /><CodeLine lineNumber="6948"><Highlight kind="normal">                 !ValuesToIgnore.contains(U) &amp;&amp; !IsLiveOutDead(U);</Highlight></CodeLine>
<Link id="l06949" /><CodeLine lineNumber="6949"><Highlight kind="normal">        &#125;))</Highlight></CodeLine>
<Link id="l06950" /><CodeLine lineNumber="6950"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06951" /><CodeLine lineNumber="6951"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06952" /><CodeLine lineNumber="6952"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;contains(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getParent()))</Highlight></CodeLine>
<Link id="l06953" /><CodeLine lineNumber="6953"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06954" /><CodeLine lineNumber="6954"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06955" /><CodeLine lineNumber="6955"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If all of Op&#39;s users are in ValuesToIgnore, add it to ValuesToIgnore</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06956" /><CodeLine lineNumber="6956"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// which applies for both scalar and vector versions. Otherwise it is only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06957" /><CodeLine lineNumber="6957"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// dead in vector versions, so only add it to VecValuesToIgnore.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06958" /><CodeLine lineNumber="6958"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;users(),</Highlight></CodeLine>
<Link id="l06959" /><CodeLine lineNumber="6959"><Highlight kind="normal">               &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123; return ValuesToIgnore.contains(U); &#125;))</Highlight></CodeLine>
<Link id="l06960" /><CodeLine lineNumber="6960"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a7e207263ca75f2bfc5eb562a213bc575">ValuesToIgnore</a>.insert(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l06961" /><CodeLine lineNumber="6961"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06962" /><CodeLine lineNumber="6962"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.insert(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l06963" /><CodeLine lineNumber="6963"><Highlight kind="normal">    DeadOps.<a href="/docs/api/classes/llvm/smallvectorimpl/#a7efd1f0c1206d95e4fe01a9b49a57b82">append</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;op&#95;begin(), <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;op&#95;end());</Highlight></CodeLine>
<Link id="l06964" /><CodeLine lineNumber="6964"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06965" /><CodeLine lineNumber="6965"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06966" /><CodeLine lineNumber="6966"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Ignore type-promoting instructions we identified during reduction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06967" /><CodeLine lineNumber="6967"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// detection.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06968" /><CodeLine lineNumber="6968"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a> : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars()) &#123;</Highlight></CodeLine>
<Link id="l06969" /><CodeLine lineNumber="6969"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RedDes = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>.second;</Highlight></CodeLine>
<Link id="l06970" /><CodeLine lineNumber="6970"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallptrsetimpl">SmallPtrSetImpl&lt;Instruction &#42;&gt;</a> &amp;Casts = RedDes.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a5691507e6742c90b796d82fb8cb2d70d">getCastInsts</a>();</Highlight></CodeLine>
<Link id="l06971" /><CodeLine lineNumber="6971"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.insert(Casts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#abf73a826b5d6f739eb4af48ddf14c5b4">begin</a>(), Casts.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a7004354fbee1c8cd74ed9001915e1db5">end</a>());</Highlight></CodeLine>
<Link id="l06972" /><CodeLine lineNumber="6972"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06973" /><CodeLine lineNumber="6973"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Ignore type-casting instructions we identified during induction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06974" /><CodeLine lineNumber="6974"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// detection.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06975" /><CodeLine lineNumber="6975"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Induction : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getInductionVars()) &#123;</Highlight></CodeLine>
<Link id="l06976" /><CodeLine lineNumber="6976"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp;IndDes = Induction.second;</Highlight></CodeLine>
<Link id="l06977" /><CodeLine lineNumber="6977"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl&lt;Instruction &#42;&gt;</a> &amp;Casts = IndDes.<a href="/docs/api/classes/llvm/inductiondescriptor/#ae7e8084b6da14960ba7c5b2cb7bd5f66">getCastInsts</a>();</Highlight></CodeLine>
<Link id="l06978" /><CodeLine lineNumber="6978"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a91945cb39ed4c6676d991a9528dcd2d0">VecValuesToIgnore</a>.insert(Casts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), Casts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>());</Highlight></CodeLine>
<Link id="l06979" /><CodeLine lineNumber="6979"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l06980" /><CodeLine lineNumber="6980"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l06981" /><CodeLine lineNumber="6981"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06982" /><CodeLine lineNumber="6982" lineLink="/docs/api/classes/llvm/loopvectorizationcostmodel/#a12d2850f420726c4acb262b626e95b7d"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a12d2850f420726c4acb262b626e95b7d">LoopVectorizationCostModel::collectInLoopReductions</a>() &#123;</Highlight></CodeLine>
<Link id="l06983" /><CodeLine lineNumber="6983"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a> : <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a4714bf2e30b65997d553264e047245f1">Legal</a>-&gt;getReductionVars()) &#123;</Highlight></CodeLine>
<Link id="l06984" /><CodeLine lineNumber="6984"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>.first;</Highlight></CodeLine>
<Link id="l06985" /><CodeLine lineNumber="6985"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc = <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>.second;</Highlight></CodeLine>
<Link id="l06986" /><CodeLine lineNumber="6986"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06987" /><CodeLine lineNumber="6987"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We don&#39;t collect reductions that are type promoted (yet).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06988" /><CodeLine lineNumber="6988"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>() != Phi-&gt;getType())</Highlight></CodeLine>
<Link id="l06989" /><CodeLine lineNumber="6989"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06990" /><CodeLine lineNumber="6990"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06991" /><CodeLine lineNumber="6991"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the target would prefer this reduction to happen &quot;in-loop&quot;, then we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06992" /><CodeLine lineNumber="6992"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// want to record it as such.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06993" /><CodeLine lineNumber="6993"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Opcode = RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a30ee597b72598bc7939d3a40d2a5ba20">getOpcode</a>();</Highlight></CodeLine>
<Link id="l06994" /><CodeLine lineNumber="6994"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a96ef6bd4742763bf1b85aaf1a4150620">PreferInLoopReductions</a> &amp;&amp; !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ad508b8cfa31c0e7a1ac8f9d733bb8eed">useOrderedReductions</a>(RdxDesc) &amp;&amp;</Highlight></CodeLine>
<Link id="l06995" /><CodeLine lineNumber="6995"><Highlight kind="normal">        !<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a3dfa67eb67a32ca048b4af8fae5c898d">TTI</a>.preferInLoopReduction(Opcode, Phi-&gt;getType(),</Highlight></CodeLine>
<Link id="l06996" /><CodeLine lineNumber="6996"><Highlight kind="normal">                                   <a href="/docs/api/structs/llvm/targettransforminfo/reductionflags">TargetTransformInfo::ReductionFlags</a>()))</Highlight></CodeLine>
<Link id="l06997" /><CodeLine lineNumber="6997"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l06998" /><CodeLine lineNumber="6998"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l06999" /><CodeLine lineNumber="6999"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check that we can correctly put the reductions into the loop, by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07000" /><CodeLine lineNumber="7000"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// finding the chain of operations that leads from the phi to the loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07001" /><CodeLine lineNumber="7001"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// exit value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07002" /><CodeLine lineNumber="7002"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> ReductionOperations =</Highlight></CodeLine>
<Link id="l07003" /><CodeLine lineNumber="7003"><Highlight kind="normal">        RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a6415fb68bc55f3a316aa414a5c2c0ab2">getReductionOpChain</a>(Phi, <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>);</Highlight></CodeLine>
<Link id="l07004" /><CodeLine lineNumber="7004"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> InLoop = !ReductionOperations.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>();</Highlight></CodeLine>
<Link id="l07005" /><CodeLine lineNumber="7005"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07006" /><CodeLine lineNumber="7006"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InLoop) &#123;</Highlight></CodeLine>
<Link id="l07007" /><CodeLine lineNumber="7007"><Highlight kind="normal">      InLoopReductions.insert(Phi);</Highlight></CodeLine>
<Link id="l07008" /><CodeLine lineNumber="7008"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Add the elements to InLoopReductionImmediateChains for cost modelling.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07009" /><CodeLine lineNumber="7009"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;LastChain = Phi;</Highlight></CodeLine>
<Link id="l07010" /><CodeLine lineNumber="7010"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : ReductionOperations) &#123;</Highlight></CodeLine>
<Link id="l07011" /><CodeLine lineNumber="7011"><Highlight kind="normal">        InLoopReductionImmediateChains&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93; = LastChain;</Highlight></CodeLine>
<Link id="l07012" /><CodeLine lineNumber="7012"><Highlight kind="normal">        LastChain = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l07013" /><CodeLine lineNumber="7013"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l07014" /><CodeLine lineNumber="7014"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07015" /><CodeLine lineNumber="7015"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Using &quot;</Highlight><Highlight kind="normal"> &lt;&lt; (InLoop ? </Highlight><Highlight kind="stringliteral">&quot;inloop&quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;out of loop&quot;</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l07016" /><CodeLine lineNumber="7016"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; reduction for phi: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Phi &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07017" /><CodeLine lineNumber="7017"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07018" /><CodeLine lineNumber="7018"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07019" /><CodeLine lineNumber="7019"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07020" /><CodeLine lineNumber="7020"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This function will select a scalable VF if the target supports scalable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07021" /><CodeLine lineNumber="7021"><Highlight kind="normal"></Highlight><Highlight kind="comment">// vectors and a fixed one otherwise.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07022" /><CodeLine lineNumber="7022"><Highlight kind="normal"></Highlight><Highlight kind="comment">// TODO: we could return a pair of values that specify the max VF and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07023" /><CodeLine lineNumber="7023"><Highlight kind="normal"></Highlight><Highlight kind="comment">// min VF, to be used in &#96;buildVPlans(MinVF, MaxVF)&#96; instead of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07024" /><CodeLine lineNumber="7024"><Highlight kind="normal"></Highlight><Highlight kind="comment">// &#96;buildVPlans(VF, VF)&#96;. We cannot do it because VPLAN at the moment</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07025" /><CodeLine lineNumber="7025"><Highlight kind="normal"></Highlight><Highlight kind="comment">// doesn&#39;t have a cost model that can choose which plan to execute if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07026" /><CodeLine lineNumber="7026"><Highlight kind="normal"></Highlight><Highlight kind="comment">// more than one is generated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07027" /><CodeLine lineNumber="7027" lineLink="#a0b91e092434338369b2e1995b87f0c5b"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> <a href="#a0b91e092434338369b2e1995b87f0c5b">determineVPlanVF</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</Highlight></CodeLine>
<Link id="l07028" /><CodeLine lineNumber="7028"><Highlight kind="normal">                                     <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> &amp;CM) &#123;</Highlight></CodeLine>
<Link id="l07029" /><CodeLine lineNumber="7029"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> WidestType;</Highlight></CodeLine>
<Link id="l07030" /><CodeLine lineNumber="7030"><Highlight kind="normal">  std::tie(std::ignore, WidestType) = CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a1fa63b37ad2ac06f289e9962a3703e9e">getSmallestAndWidestTypes</a>();</Highlight></CodeLine>
<Link id="l07031" /><CodeLine lineNumber="7031"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07032" /><CodeLine lineNumber="7032"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166">TargetTransformInfo::RegisterKind</a> RegKind =</Highlight></CodeLine>
<Link id="l07033" /><CodeLine lineNumber="7033"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.enableScalableVectorization()</Highlight></CodeLine>
<Link id="l07034" /><CodeLine lineNumber="7034"><Highlight kind="normal">          ? <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166a331413d3887a08546d0973091f6a4993">TargetTransformInfo::RGK&#95;ScalableVector</a></Highlight></CodeLine>
<Link id="l07035" /><CodeLine lineNumber="7035"><Highlight kind="normal">          : <a href="/docs/api/classes/llvm/targettransforminfo/#a8bb3b1ccf19b8c85429b777dfa4a0166a183020fbea95c99db23f6d3594f4c4af">TargetTransformInfo::RGK&#95;FixedWidthVector</a>;</Highlight></CodeLine>
<Link id="l07036" /><CodeLine lineNumber="7036"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07037" /><CodeLine lineNumber="7037"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/typesize">TypeSize</a> <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a9c374320ed4e895f9afa199987182bd2">RegSize</a> = <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>.getRegisterBitWidth(RegKind);</Highlight></CodeLine>
<Link id="l07038" /><CodeLine lineNumber="7038"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a> = <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a9c374320ed4e895f9afa199987182bd2">RegSize</a>.getKnownMinValue() / WidestType;</Highlight></CodeLine>
<Link id="l07039" /><CodeLine lineNumber="7039"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/elementcount/#a79ea372f9aa69492fccfafc0e5a1589c">ElementCount::get</a>(<a href="/docs/api/files/lib/lib/support/regcomp-c/#a0240ac851181b84ac374872dc5434ee4">N</a>, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64mipeepholeopt-cpp/#a9c374320ed4e895f9afa199987182bd2">RegSize</a>.isScalable());</Highlight></CodeLine>
<Link id="l07040" /><CodeLine lineNumber="7040"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07041" /><CodeLine lineNumber="7041"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07042" /><CodeLine lineNumber="7042"><Highlight kind="normal"><a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a></Highlight></CodeLine>
<Link id="l07043" /><CodeLine lineNumber="7043" lineLink="/docs/api/classes/llvm/loopvectorizationplanner/#a2206e77c573f4947146faa681ea8855e"><Highlight kind="normal"><a href="/docs/api/classes/llvm/loopvectorizationplanner/#a2206e77c573f4947146faa681ea8855e">LoopVectorizationPlanner::planInVPlanNativePath</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF) &#123;</Highlight></CodeLine>
<Link id="l07044" /><CodeLine lineNumber="7044"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF = UserVF;</Highlight></CodeLine>
<Link id="l07045" /><CodeLine lineNumber="7045"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Outer loop handling: They may require CFG and instruction level</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07046" /><CodeLine lineNumber="7046"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// transformations before even evaluating whether vectorization is profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07047" /><CodeLine lineNumber="7047"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Since we cannot modify the incoming IR, we need to build VPlan upfront in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07048" /><CodeLine lineNumber="7048"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the vectorization pipeline.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07049" /><CodeLine lineNumber="7049"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OrigLoop-&gt;isInnermost()) &#123;</Highlight></CodeLine>
<Link id="l07050" /><CodeLine lineNumber="7050"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the user doesn&#39;t provide a vectorization factor, determine a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07051" /><CodeLine lineNumber="7051"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// reasonable one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07052" /><CodeLine lineNumber="7052"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ad96fee81c3174ef427bf779d73fb1ef2">isZero</a>()) &#123;</Highlight></CodeLine>
<Link id="l07053" /><CodeLine lineNumber="7053"><Highlight kind="normal">      VF = <a href="#a0b91e092434338369b2e1995b87f0c5b">determineVPlanVF</a>(TTI, CM);</Highlight></CodeLine>
<Link id="l07054" /><CodeLine lineNumber="7054"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: VPlan computed VF &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07055" /><CodeLine lineNumber="7055"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07056" /><CodeLine lineNumber="7056"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Make sure we have a VF &gt; 1 for stress testing.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07057" /><CodeLine lineNumber="7057"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a9f30855a6efcd4a12875deb88880b510">VPlanBuildStressTest</a> &amp;&amp; (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ad96fee81c3174ef427bf779d73fb1ef2">isZero</a>())) &#123;</Highlight></CodeLine>
<Link id="l07058" /><CodeLine lineNumber="7058"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: VPlan stress testing: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07059" /><CodeLine lineNumber="7059"><Highlight kind="normal">                          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;overriding computed VF.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07060" /><CodeLine lineNumber="7060"><Highlight kind="normal">        VF = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(4);</Highlight></CodeLine>
<Link id="l07061" /><CodeLine lineNumber="7061"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l07062" /><CodeLine lineNumber="7062"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() &amp;&amp; !TTI.supportsScalableVectors() &amp;&amp;</Highlight></CodeLine>
<Link id="l07063" /><CodeLine lineNumber="7063"><Highlight kind="normal">               !<a href="#a48035e22b43c905a2961c90e5470b2f0">ForceTargetSupportsScalableVectors</a>) &#123;</Highlight></CodeLine>
<Link id="l07064" /><CodeLine lineNumber="7064"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Not vectorizing. Scalable VF requested, but &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07065" /><CodeLine lineNumber="7065"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;not supported by the target.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07066" /><CodeLine lineNumber="7066"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight></CodeLine>
<Link id="l07067" /><CodeLine lineNumber="7067"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Scalable vectorization requested but not supported by the target&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l07068" /><CodeLine lineNumber="7068"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;the scalable user-specified vectorization width for outer-loop &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07069" /><CodeLine lineNumber="7069"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;vectorization cannot be used because the target does not support &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07070" /><CodeLine lineNumber="7070"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;scalable vectors.&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l07071" /><CodeLine lineNumber="7071"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;ScalableVFUnfeasible&quot;</Highlight><Highlight kind="normal">, ORE, OrigLoop);</Highlight></CodeLine>
<Link id="l07072" /><CodeLine lineNumber="7072"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vectorizationfactor/#acd24dfdad4f887e1f7b10c9039a05930">VectorizationFactor::Disabled</a>();</Highlight></CodeLine>
<Link id="l07073" /><CodeLine lineNumber="7073"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07074" /><CodeLine lineNumber="7074"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;VPlan-native path is not enabled.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07075" /><CodeLine lineNumber="7075"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l07076" /><CodeLine lineNumber="7076"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;VF needs to be a power of two&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07077" /><CodeLine lineNumber="7077"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Using &quot;</Highlight><Highlight kind="normal"> &lt;&lt; (!UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ad96fee81c3174ef427bf779d73fb1ef2">isZero</a>() ? </Highlight><Highlight kind="stringliteral">&quot;user &quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l07078" /><CodeLine lineNumber="7078"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;VF &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; to build VPlans.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07079" /><CodeLine lineNumber="7079"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationplanner/#a36d6728b8c3cfca0a9bd02c3f0273477">buildVPlans</a>(VF, VF);</Highlight></CodeLine>
<Link id="l07080" /><CodeLine lineNumber="7080"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07081" /><CodeLine lineNumber="7081"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For VPlan build stress testing, we bail out after VPlan construction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07082" /><CodeLine lineNumber="7082"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a9f30855a6efcd4a12875deb88880b510">VPlanBuildStressTest</a>)</Highlight></CodeLine>
<Link id="l07083" /><CodeLine lineNumber="7083"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vectorizationfactor/#acd24dfdad4f887e1f7b10c9039a05930">VectorizationFactor::Disabled</a>();</Highlight></CodeLine>
<Link id="l07084" /><CodeLine lineNumber="7084"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07085" /><CodeLine lineNumber="7085"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;VF, 0 </Highlight><Highlight kind="comment">/&#42;Cost&#42;/</Highlight><Highlight kind="normal">, 0 </Highlight><Highlight kind="comment">/&#42; ScalarCost &#42;/</Highlight><Highlight kind="normal">&#125;;</Highlight></CodeLine>
<Link id="l07086" /><CodeLine lineNumber="7086"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07087" /><CodeLine lineNumber="7087"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07088" /><CodeLine lineNumber="7088"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l07089" /><CodeLine lineNumber="7089"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Not vectorizing. Inner loops aren&#39;t supported in the &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07090" /><CodeLine lineNumber="7090"><Highlight kind="normal">                </Highlight><Highlight kind="stringliteral">&quot;VPlan-native path.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07091" /><CodeLine lineNumber="7091"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vectorizationfactor/#acd24dfdad4f887e1f7b10c9039a05930">VectorizationFactor::Disabled</a>();</Highlight></CodeLine>
<Link id="l07092" /><CodeLine lineNumber="7092"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07093" /><CodeLine lineNumber="7093"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07094" /><CodeLine lineNumber="7094" lineLink="/docs/api/classes/llvm/loopvectorizationplanner/#aca6160bb3d669e9ce01f91b124e7e0a1"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizationplanner/#aca6160bb3d669e9ce01f91b124e7e0a1">LoopVectorizationPlanner::plan</a>(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> UserIC) &#123;</Highlight></CodeLine>
<Link id="l07095" /><CodeLine lineNumber="7095"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OrigLoop-&gt;isInnermost() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Inner loop expected.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07096" /><CodeLine lineNumber="7096"><Highlight kind="normal">  CM.collectValuesToIgnore();</Highlight></CodeLine>
<Link id="l07097" /><CodeLine lineNumber="7097"><Highlight kind="normal">  CM.collectElementTypesForWidening();</Highlight></CodeLine>
<Link id="l07098" /><CodeLine lineNumber="7098"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07099" /><CodeLine lineNumber="7099"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/fixedscalablevfpair">FixedScalableVFPair</a> MaxFactors = CM.computeMaxVF(UserVF, UserIC);</Highlight></CodeLine>
<Link id="l07100" /><CodeLine lineNumber="7100"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MaxFactors) </Highlight><Highlight kind="comment">// Cases that should not to be vectorized nor interleaved.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07101" /><CodeLine lineNumber="7101"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07102" /><CodeLine lineNumber="7102"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07103" /><CodeLine lineNumber="7103"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Invalidate interleave groups if all blocks of loop will be predicated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07104" /><CodeLine lineNumber="7104"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CM.blockNeedsPredicationForAnyReason(OrigLoop-&gt;getHeader()) &amp;&amp;</Highlight></CodeLine>
<Link id="l07105" /><CodeLine lineNumber="7105"><Highlight kind="normal">      !<a href="#adf8d8fb6f39b9c0cf21d55b7229d35e2">useMaskedInterleavedAccesses</a>(TTI)) &#123;</Highlight></CodeLine>
<Link id="l07106" /><CodeLine lineNumber="7106"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l07107" /><CodeLine lineNumber="7107"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</Highlight></CodeLine>
<Link id="l07108" /><CodeLine lineNumber="7108"><Highlight kind="normal">        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Invalidate all interleaved groups due to fold-tail by masking &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07109" /><CodeLine lineNumber="7109"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;which requires masked-interleaved support.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07110" /><CodeLine lineNumber="7110"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CM.InterleaveInfo.invalidateGroups())</Highlight></CodeLine>
<Link id="l07111" /><CodeLine lineNumber="7111"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Invalidating interleave groups also requires invalidating all decisions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07112" /><CodeLine lineNumber="7112"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// based on them, which includes widening decisions and uniform and scalar</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07113" /><CodeLine lineNumber="7113"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07114" /><CodeLine lineNumber="7114"><Highlight kind="normal">      CM.invalidateCostModelingDecisions();</Highlight></CodeLine>
<Link id="l07115" /><CodeLine lineNumber="7115"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07116" /><CodeLine lineNumber="7116"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07117" /><CodeLine lineNumber="7117"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CM.foldTailByMasking())</Highlight></CodeLine>
<Link id="l07118" /><CodeLine lineNumber="7118"><Highlight kind="normal">    Legal-&gt;prepareToFoldTailByMasking();</Highlight></CodeLine>
<Link id="l07119" /><CodeLine lineNumber="7119"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07120" /><CodeLine lineNumber="7120"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MaxUserVF =</Highlight></CodeLine>
<Link id="l07121" /><CodeLine lineNumber="7121"><Highlight kind="normal">      UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() ? MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25f82f8ef3355c335a7ddae4ad0b6965">ScalableVF</a> : MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25a62c28e80eac3b4cc08470ae0770bd">FixedVF</a>;</Highlight></CodeLine>
<Link id="l07122" /><CodeLine lineNumber="7122"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserVF) &#123;</Highlight></CodeLine>
<Link id="l07123" /><CodeLine lineNumber="7123"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a338ba7ca7a526243ab1853d07d90fe38">ElementCount::isKnownLE</a>(UserVF, MaxUserVF)) &#123;</Highlight></CodeLine>
<Link id="l07124" /><CodeLine lineNumber="7124"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</Highlight></CodeLine>
<Link id="l07125" /><CodeLine lineNumber="7125"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;UserVF ignored because it may be larger than the maximal safe VF&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l07126" /><CodeLine lineNumber="7126"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;InvalidUserVF&quot;</Highlight><Highlight kind="normal">, ORE, OrigLoop);</Highlight></CodeLine>
<Link id="l07127" /><CodeLine lineNumber="7127"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l07128" /><CodeLine lineNumber="7128"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a6dec2b5d3e04b47adf4d918d678e81c9">isPowerOf2&#95;32</a>(UserVF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#ac4ab9dd9440c55bee1aa4a1195cee759">getKnownMinValue</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l07129" /><CodeLine lineNumber="7129"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;VF needs to be a power of two&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07130" /><CodeLine lineNumber="7130"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Collect the instructions (and their associated costs) that will be more</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07131" /><CodeLine lineNumber="7131"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// profitable to scalarize.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07132" /><CodeLine lineNumber="7132"><Highlight kind="normal">      CM.collectInLoopReductions();</Highlight></CodeLine>
<Link id="l07133" /><CodeLine lineNumber="7133"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CM.selectUserVectorizationFactor(UserVF)) &#123;</Highlight></CodeLine>
<Link id="l07134" /><CodeLine lineNumber="7134"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Using user VF &quot;</Highlight><Highlight kind="normal"> &lt;&lt; UserVF &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07135" /><CodeLine lineNumber="7135"><Highlight kind="normal">        buildVPlansWithVPRecipes(UserVF, UserVF);</Highlight></CodeLine>
<Link id="l07136" /><CodeLine lineNumber="7136"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/classes/llvm/loopvectorizationplanner/#ac3a6a342405e61ad992020460a530dc4">printPlans</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</Highlight></CodeLine>
<Link id="l07137" /><CodeLine lineNumber="7137"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07138" /><CodeLine lineNumber="7138"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l07139" /><CodeLine lineNumber="7139"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#aa22517ece6258e8db44e22e5a8d85249">reportVectorizationInfo</a>(</Highlight><Highlight kind="stringliteral">&quot;UserVF ignored because of invalid costs.&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l07140" /><CodeLine lineNumber="7140"><Highlight kind="normal">                              </Highlight><Highlight kind="stringliteral">&quot;InvalidCost&quot;</Highlight><Highlight kind="normal">, ORE, OrigLoop);</Highlight></CodeLine>
<Link id="l07141" /><CodeLine lineNumber="7141"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07142" /><CodeLine lineNumber="7142"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07143" /><CodeLine lineNumber="7143"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07144" /><CodeLine lineNumber="7144"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect the Vectorization Factor Candidates.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07145" /><CodeLine lineNumber="7145"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;ElementCount&gt;</a> VFCandidates;</Highlight></CodeLine>
<Link id="l07146" /><CodeLine lineNumber="7146"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> VF = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1);</Highlight></CodeLine>
<Link id="l07147" /><CodeLine lineNumber="7147"><Highlight kind="normal">       <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a338ba7ca7a526243ab1853d07d90fe38">ElementCount::isKnownLE</a>(VF, MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25a62c28e80eac3b4cc08470ae0770bd">FixedVF</a>); VF &#42;= 2)</Highlight></CodeLine>
<Link id="l07148" /><CodeLine lineNumber="7148"><Highlight kind="normal">    VFCandidates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VF);</Highlight></CodeLine>
<Link id="l07149" /><CodeLine lineNumber="7149"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> VF = <a href="/docs/api/classes/llvm/elementcount/#a1bddc4949ab247dd1474f79b9bc6e34e">ElementCount::getScalable</a>(1);</Highlight></CodeLine>
<Link id="l07150" /><CodeLine lineNumber="7150"><Highlight kind="normal">       <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a338ba7ca7a526243ab1853d07d90fe38">ElementCount::isKnownLE</a>(VF, MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25f82f8ef3355c335a7ddae4ad0b6965">ScalableVF</a>); VF &#42;= 2)</Highlight></CodeLine>
<Link id="l07151" /><CodeLine lineNumber="7151"><Highlight kind="normal">    VFCandidates.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(VF);</Highlight></CodeLine>
<Link id="l07152" /><CodeLine lineNumber="7152"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07153" /><CodeLine lineNumber="7153"><Highlight kind="normal">  CM.collectInLoopReductions();</Highlight></CodeLine>
<Link id="l07154" /><CodeLine lineNumber="7154"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;VF : VFCandidates) &#123;</Highlight></CodeLine>
<Link id="l07155" /><CodeLine lineNumber="7155"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Collect Uniform and Scalar instructions after vectorization with VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07156" /><CodeLine lineNumber="7156"><Highlight kind="normal">    CM.collectUniformsAndScalars(VF);</Highlight></CodeLine>
<Link id="l07157" /><CodeLine lineNumber="7157"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07158" /><CodeLine lineNumber="7158"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Collect the instructions (and their associated costs) that will be more</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07159" /><CodeLine lineNumber="7159"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// profitable to scalarize.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07160" /><CodeLine lineNumber="7160"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>())</Highlight></CodeLine>
<Link id="l07161" /><CodeLine lineNumber="7161"><Highlight kind="normal">      CM.collectInstsToScalarize(VF);</Highlight></CodeLine>
<Link id="l07162" /><CodeLine lineNumber="7162"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07163" /><CodeLine lineNumber="7163"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07164" /><CodeLine lineNumber="7164"><Highlight kind="normal">  buildVPlansWithVPRecipes(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1), MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25a62c28e80eac3b4cc08470ae0770bd">FixedVF</a>);</Highlight></CodeLine>
<Link id="l07165" /><CodeLine lineNumber="7165"><Highlight kind="normal">  buildVPlansWithVPRecipes(<a href="/docs/api/classes/llvm/elementcount/#a1bddc4949ab247dd1474f79b9bc6e34e">ElementCount::getScalable</a>(1), MaxFactors.<a href="/docs/api/structs/llvm/fixedscalablevfpair/#a25f82f8ef3355c335a7ddae4ad0b6965">ScalableVF</a>);</Highlight></CodeLine>
<Link id="l07166" /><CodeLine lineNumber="7166"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07167" /><CodeLine lineNumber="7167"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/classes/llvm/loopvectorizationplanner/#ac3a6a342405e61ad992020460a530dc4">printPlans</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</Highlight></CodeLine>
<Link id="l07168" /><CodeLine lineNumber="7168"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07169" /><CodeLine lineNumber="7169"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07170" /><CodeLine lineNumber="7170" lineLink="/docs/api/structs/llvm/vpcostcontext/#a79d75561901a5fc0d187b229afd5a745"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/structs/llvm/vpcostcontext/#a79d75561901a5fc0d187b229afd5a745">VPCostContext::getLegacyCost</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI,</Highlight></CodeLine>
<Link id="l07171" /><CodeLine lineNumber="7171"><Highlight kind="normal">                                             <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l07172" /><CodeLine lineNumber="7172"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a5eae6074e6a1bb62e365ef65f3e26196">ForceTargetInstructionCost</a>.getNumOccurrences())</Highlight></CodeLine>
<Link id="l07173" /><CodeLine lineNumber="7173"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a>(<a href="#a5eae6074e6a1bb62e365ef65f3e26196">ForceTargetInstructionCost</a>.getNumOccurrences());</Highlight></CodeLine>
<Link id="l07174" /><CodeLine lineNumber="7174"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vpcostcontext/#a311ad8e3c775be69bcc47aa3e766606d">CM</a>.getInstructionCost(UI, VF);</Highlight></CodeLine>
<Link id="l07175" /><CodeLine lineNumber="7175"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07176" /><CodeLine lineNumber="7176"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07177" /><CodeLine lineNumber="7177" lineLink="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756">VPCostContext::skipCostComputation</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsVector)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l07178" /><CodeLine lineNumber="7178"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vpcostcontext/#a311ad8e3c775be69bcc47aa3e766606d">CM</a>.ValuesToIgnore.contains(UI) ||</Highlight></CodeLine>
<Link id="l07179" /><CodeLine lineNumber="7179"><Highlight kind="normal">         (IsVector &amp;&amp; <a href="/docs/api/structs/llvm/vpcostcontext/#a311ad8e3c775be69bcc47aa3e766606d">CM</a>.VecValuesToIgnore.contains(UI)) ||</Highlight></CodeLine>
<Link id="l07180" /><CodeLine lineNumber="7180"><Highlight kind="normal">         <a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.contains(UI);</Highlight></CodeLine>
<Link id="l07181" /><CodeLine lineNumber="7181"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07182" /><CodeLine lineNumber="7182"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07183" /><CodeLine lineNumber="7183"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a></Highlight></CodeLine>
<Link id="l07184" /><CodeLine lineNumber="7184"><Highlight kind="normal">LoopVectorizationPlanner::precomputeCosts(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF,</Highlight></CodeLine>
<Link id="l07185" /><CodeLine lineNumber="7185"><Highlight kind="normal">                                          <a href="/docs/api/structs/llvm/vpcostcontext">VPCostContext</a> &amp;CostCtx)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l07186" /><CodeLine lineNumber="7186"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l07187" /><CodeLine lineNumber="7187"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Cost modeling for inductions is inaccurate in the legacy cost model</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07188" /><CodeLine lineNumber="7188"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// compared to the recipes that are generated. To match here initially during</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07189" /><CodeLine lineNumber="7189"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// VPlan cost model bring up directly use the induction costs from the legacy</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07190" /><CodeLine lineNumber="7190"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cost model. Note that we do this as pre-processing; the VPlan may not have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07191" /><CodeLine lineNumber="7191"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// any recipes associated with the original induction increment instruction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07192" /><CodeLine lineNumber="7192"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and may replace truncates with VPWidenIntOrFpInductionRecipe. We precompute</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07193" /><CodeLine lineNumber="7193"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the cost of induction phis and increments (both that are represented by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07194" /><CodeLine lineNumber="7194"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// recipes and those that are not), to avoid distinguishing between them here,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07195" /><CodeLine lineNumber="7195"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and skip all recipes that represent induction phis and increments (the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07196" /><CodeLine lineNumber="7196"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// former case) later on, if they exist, to avoid counting them twice.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07197" /><CodeLine lineNumber="7197"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Similarly we pre-compute the cost of any optimized truncates.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07198" /><CodeLine lineNumber="7198"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Switch to more accurate costing based on VPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07199" /><CodeLine lineNumber="7199"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>, IndDesc&#93; : <a href="/docs/api/namespaces/llvm/irsimilarity/#af46430106334db52bfa7a4107e53a0bda8f7357506e00d8cd0694f948f909865d">Legal</a>-&gt;getInductionVars()) &#123;</Highlight></CodeLine>
<Link id="l07200" /><CodeLine lineNumber="7200"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;IVInc = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(</Highlight></CodeLine>
<Link id="l07201" /><CodeLine lineNumber="7201"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getIncomingValueForBlock(OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a1230fd674d2609b96527fe65eaf40b1b">getLoopLatch</a>()));</Highlight></CodeLine>
<Link id="l07202" /><CodeLine lineNumber="7202"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;&gt;</a> IVInsts = &#123;IVInc&#125;;</Highlight></CodeLine>
<Link id="l07203" /><CodeLine lineNumber="7203"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != IVInsts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>++) &#123;</Highlight></CodeLine>
<Link id="l07204" /><CodeLine lineNumber="7204"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : IVInsts&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;-&gt;operands()) &#123;</Highlight></CodeLine>
<Link id="l07205" /><CodeLine lineNumber="7205"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l07206" /><CodeLine lineNumber="7206"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> || !OpI || !OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(OpI) || !<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l07207" /><CodeLine lineNumber="7207"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07208" /><CodeLine lineNumber="7208"><Highlight kind="normal">        IVInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpI);</Highlight></CodeLine>
<Link id="l07209" /><CodeLine lineNumber="7209"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l07210" /><CodeLine lineNumber="7210"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07211" /><CodeLine lineNumber="7211"><Highlight kind="normal">    IVInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>);</Highlight></CodeLine>
<Link id="l07212" /><CodeLine lineNumber="7212"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (User &#42;U : <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l07213" /><CodeLine lineNumber="7213"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l07214" /><CodeLine lineNumber="7214"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a311ad8e3c775be69bcc47aa3e766606d">CM</a>.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a61375f5189558cc261186f388d31fe92">isOptimizableIVTruncate</a>(CI, VF))</Highlight></CodeLine>
<Link id="l07215" /><CodeLine lineNumber="7215"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07216" /><CodeLine lineNumber="7216"><Highlight kind="normal">      IVInsts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CI);</Highlight></CodeLine>
<Link id="l07217" /><CodeLine lineNumber="7217"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07218" /><CodeLine lineNumber="7218"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07219" /><CodeLine lineNumber="7219"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the vector loop gets executed exactly once with the given VF, ignore</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07220" /><CodeLine lineNumber="7220"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the costs of comparison and induction instructions, as they&#39;ll get</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07221" /><CodeLine lineNumber="7221"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// simplified away.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07222" /><CodeLine lineNumber="7222"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Remove this code after stepping away from the legacy cost model and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07223" /><CodeLine lineNumber="7223"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// adding code to simplify VPlans before calculating their costs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07224" /><CodeLine lineNumber="7224"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> TC = PSE.getSE()-&gt;getSmallConstantTripCount(OrigLoop);</Highlight></CodeLine>
<Link id="l07225" /><CodeLine lineNumber="7225"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#aab9a9b0568c1c524f01499c7930b3bf9">isFixed</a>() &amp;&amp; TC == VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a33880aaca0ad05e5f1557f079305bde5">getFixedValue</a>() &amp;&amp; !CM.foldTailByMasking())</Highlight></CodeLine>
<Link id="l07226" /><CodeLine lineNumber="7226"><Highlight kind="normal">      <a href="#ababcaf6e2e00fc3fc8791ea2c3acbda5">addFullyUnrolledInstructionsToIgnore</a>(OrigLoop, Legal-&gt;getInductionVars(),</Highlight></CodeLine>
<Link id="l07227" /><CodeLine lineNumber="7227"><Highlight kind="normal">                                           CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>);</Highlight></CodeLine>
<Link id="l07228" /><CodeLine lineNumber="7228"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07229" /><CodeLine lineNumber="7229"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Instruction &#42;IVInst : IVInsts) &#123;</Highlight></CodeLine>
<Link id="l07230" /><CodeLine lineNumber="7230"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756">skipCostComputation</a>(IVInst, VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()))</Highlight></CodeLine>
<Link id="l07231" /><CodeLine lineNumber="7231"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07232" /><CodeLine lineNumber="7232"><Highlight kind="normal">      InstructionCost InductionCost = CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a79d75561901a5fc0d187b229afd5a745">getLegacyCost</a>(IVInst, VF);</Highlight></CodeLine>
<Link id="l07233" /><CodeLine lineNumber="7233"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</Highlight></CodeLine>
<Link id="l07234" /><CodeLine lineNumber="7234"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Cost of &quot;</Highlight><Highlight kind="normal"> &lt;&lt; InductionCost &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; for VF &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF</Highlight></CodeLine>
<Link id="l07235" /><CodeLine lineNumber="7235"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;: induction instruction &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;IVInst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07236" /><CodeLine lineNumber="7236"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l07237" /><CodeLine lineNumber="7237"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += InductionCost;</Highlight></CodeLine>
<Link id="l07238" /><CodeLine lineNumber="7238"><Highlight kind="normal">      CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(IVInst);</Highlight></CodeLine>
<Link id="l07239" /><CodeLine lineNumber="7239"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07240" /><CodeLine lineNumber="7240"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07241" /><CodeLine lineNumber="7241"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07242" /><CodeLine lineNumber="7242"><Highlight kind="comment">  /// Compute the cost of all exiting conditions of the loop using the legacy</Highlight></CodeLine>
<Link id="l07243" /><CodeLine lineNumber="7243"><Highlight kind="comment">  /// cost model. This is to match the legacy behavior, which adds the cost of</Highlight></CodeLine>
<Link id="l07244" /><CodeLine lineNumber="7244"><Highlight kind="comment">  /// all exit conditions. Note that this over-estimates the cost, as there will</Highlight></CodeLine>
<Link id="l07245" /><CodeLine lineNumber="7245"><Highlight kind="comment">  /// be a single condition to control the vector loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07246" /><CodeLine lineNumber="7246"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;BasicBlock &#42;&gt;</a> Exiting;</Highlight></CodeLine>
<Link id="l07247" /><CodeLine lineNumber="7247"><Highlight kind="normal">  CM.TheLoop-&gt;getExitingBlocks(Exiting);</Highlight></CodeLine>
<Link id="l07248" /><CodeLine lineNumber="7248"><Highlight kind="normal">  SetVector&lt;Instruction &#42;&gt; ExitInstrs;</Highlight></CodeLine>
<Link id="l07249" /><CodeLine lineNumber="7249"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect all exit conditions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07250" /><CodeLine lineNumber="7250"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (BasicBlock &#42;EB : Exiting) &#123;</Highlight></CodeLine>
<Link id="l07251" /><CodeLine lineNumber="7251"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/m68kbeads/#abf9ad6053d17fcef3b68af71aa681944a27d0e059322508a76f918503800ef1bd">Term</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(EB-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l07252" /><CodeLine lineNumber="7252"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Term || CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756">skipCostComputation</a>(Term, VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()))</Highlight></CodeLine>
<Link id="l07253" /><CodeLine lineNumber="7253"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07254" /><CodeLine lineNumber="7254"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CondI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/m68kbeads/#abf9ad6053d17fcef3b68af71aa681944a27d0e059322508a76f918503800ef1bd">Term</a>-&gt;getOperand(0))) &#123;</Highlight></CodeLine>
<Link id="l07255" /><CodeLine lineNumber="7255"><Highlight kind="normal">      ExitInstrs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(CondI);</Highlight></CodeLine>
<Link id="l07256" /><CodeLine lineNumber="7256"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07257" /><CodeLine lineNumber="7257"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07258" /><CodeLine lineNumber="7258"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Compute the cost of all instructions only feeding the exit conditions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07259" /><CodeLine lineNumber="7259"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != ExitInstrs.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l07260" /><CodeLine lineNumber="7260"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;CondI = ExitInstrs&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l07261" /><CodeLine lineNumber="7261"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OrigLoop-&gt;contains(CondI) ||</Highlight></CodeLine>
<Link id="l07262" /><CodeLine lineNumber="7262"><Highlight kind="normal">        !CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(CondI).second)</Highlight></CodeLine>
<Link id="l07263" /><CodeLine lineNumber="7263"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07264" /><CodeLine lineNumber="7264"><Highlight kind="normal">    InstructionCost CondICost = CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a79d75561901a5fc0d187b229afd5a745">getLegacyCost</a>(CondI, VF);</Highlight></CodeLine>
<Link id="l07265" /><CodeLine lineNumber="7265"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</Highlight></CodeLine>
<Link id="l07266" /><CodeLine lineNumber="7266"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Cost of &quot;</Highlight><Highlight kind="normal"> &lt;&lt; CondICost &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; for VF &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF</Highlight></CodeLine>
<Link id="l07267" /><CodeLine lineNumber="7267"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;: exit condition instruction &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;CondI &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07268" /><CodeLine lineNumber="7268"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l07269" /><CodeLine lineNumber="7269"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += CondICost;</Highlight></CodeLine>
<Link id="l07270" /><CodeLine lineNumber="7270"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : CondI-&gt;<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>()) &#123;</Highlight></CodeLine>
<Link id="l07271" /><CodeLine lineNumber="7271"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l07272" /><CodeLine lineNumber="7272"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OpI || CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756">skipCostComputation</a>(OpI, VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()) ||</Highlight></CodeLine>
<Link id="l07273" /><CodeLine lineNumber="7273"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(OpI-&gt;users(), &#91;&amp;ExitInstrs, </Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(User &#42;U) &#123;</Highlight></CodeLine>
<Link id="l07274" /><CodeLine lineNumber="7274"><Highlight kind="normal">            return OrigLoop-&gt;contains(cast&lt;Instruction&gt;(U)-&gt;getParent()) &amp;&amp;</Highlight></CodeLine>
<Link id="l07275" /><CodeLine lineNumber="7275"><Highlight kind="normal">                   !ExitInstrs.contains(cast&lt;Instruction&gt;(U));</Highlight></CodeLine>
<Link id="l07276" /><CodeLine lineNumber="7276"><Highlight kind="normal">          &#125;))</Highlight></CodeLine>
<Link id="l07277" /><CodeLine lineNumber="7277"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07278" /><CodeLine lineNumber="7278"><Highlight kind="normal">      ExitInstrs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(OpI);</Highlight></CodeLine>
<Link id="l07279" /><CodeLine lineNumber="7279"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07280" /><CodeLine lineNumber="7280"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07281" /><CodeLine lineNumber="7281"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07282" /><CodeLine lineNumber="7282"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The legacy cost model has special logic to compute the cost of in-loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07283" /><CodeLine lineNumber="7283"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reductions, which may be smaller than the sum of all instructions involved</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07284" /><CodeLine lineNumber="7284"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in the reduction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07285" /><CodeLine lineNumber="7285"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Switch to costing based on VPlan once the logic has been ported.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07286" /><CodeLine lineNumber="7286"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;RedPhi, RdxDesc&#93; : Legal-&gt;getReductionVars()) &#123;</Highlight></CodeLine>
<Link id="l07287" /><CodeLine lineNumber="7287"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a5eae6074e6a1bb62e365ef65f3e26196">ForceTargetInstructionCost</a>.getNumOccurrences())</Highlight></CodeLine>
<Link id="l07288" /><CodeLine lineNumber="7288"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07289" /><CodeLine lineNumber="7289"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07290" /><CodeLine lineNumber="7290"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CM.isInLoopReduction(RedPhi))</Highlight></CodeLine>
<Link id="l07291" /><CodeLine lineNumber="7291"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07292" /><CodeLine lineNumber="7292"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07293" /><CodeLine lineNumber="7293"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;ChainOps = RdxDesc.getReductionOpChain(RedPhi, OrigLoop);</Highlight></CodeLine>
<Link id="l07294" /><CodeLine lineNumber="7294"><Highlight kind="normal">    SetVector&lt;Instruction &#42;&gt; ChainOpsAndOperands(ChainOps.begin(),</Highlight></CodeLine>
<Link id="l07295" /><CodeLine lineNumber="7295"><Highlight kind="normal">                                                 ChainOps.end());</Highlight></CodeLine>
<Link id="l07296" /><CodeLine lineNumber="7296"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsZExtOrSExt = &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Opcode) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l07297" /><CodeLine lineNumber="7297"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Opcode == Instruction::ZExt || Opcode == Instruction::SExt;</Highlight></CodeLine>
<Link id="l07298" /><CodeLine lineNumber="7298"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l07299" /><CodeLine lineNumber="7299"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Also include the operands of instructions in the chain, as the cost-model</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07300" /><CodeLine lineNumber="7300"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// may mark extends as free.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07301" /><CodeLine lineNumber="7301"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07302" /><CodeLine lineNumber="7302"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For ARM, some of the instruction can folded into the reducion</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07303" /><CodeLine lineNumber="7303"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instruction. So we need to mark all folded instructions free.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07304" /><CodeLine lineNumber="7304"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For example: We can fold reduce(mul(ext(A), ext(B))) into one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07305" /><CodeLine lineNumber="7305"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07306" /><CodeLine lineNumber="7306"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ChainOp : ChainOps) &#123;</Highlight></CodeLine>
<Link id="l07307" /><CodeLine lineNumber="7307"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : ChainOp-&gt;operands()) &#123;</Highlight></CodeLine>
<Link id="l07308" /><CodeLine lineNumber="7308"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) &#123;</Highlight></CodeLine>
<Link id="l07309" /><CodeLine lineNumber="7309"><Highlight kind="normal">          ChainOpsAndOperands.insert(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l07310" /><CodeLine lineNumber="7310"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::Mul) &#123;</Highlight></CodeLine>
<Link id="l07311" /><CodeLine lineNumber="7311"><Highlight kind="normal">            </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Ext0 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l07312" /><CodeLine lineNumber="7312"><Highlight kind="normal">            </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Ext1 = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l07313" /><CodeLine lineNumber="7313"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Ext0 &amp;&amp; IsZExtOrSExt(Ext0-&gt;getOpcode()) &amp;&amp; Ext1 &amp;&amp;</Highlight></CodeLine>
<Link id="l07314" /><CodeLine lineNumber="7314"><Highlight kind="normal">                Ext0-&gt;getOpcode() == Ext1-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l07315" /><CodeLine lineNumber="7315"><Highlight kind="normal">              ChainOpsAndOperands.insert(Ext0);</Highlight></CodeLine>
<Link id="l07316" /><CodeLine lineNumber="7316"><Highlight kind="normal">              ChainOpsAndOperands.insert(Ext1);</Highlight></CodeLine>
<Link id="l07317" /><CodeLine lineNumber="7317"><Highlight kind="normal">            &#125;</Highlight></CodeLine>
<Link id="l07318" /><CodeLine lineNumber="7318"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l07319" /><CodeLine lineNumber="7319"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l07320" /><CodeLine lineNumber="7320"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l07321" /><CodeLine lineNumber="7321"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07322" /><CodeLine lineNumber="7322"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07323" /><CodeLine lineNumber="7323"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Pre-compute the cost for I, if it has a reduction pattern cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07324" /><CodeLine lineNumber="7324"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : ChainOpsAndOperands) &#123;</Highlight></CodeLine>
<Link id="l07325" /><CodeLine lineNumber="7325"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ReductionCost =</Highlight></CodeLine>
<Link id="l07326" /><CodeLine lineNumber="7326"><Highlight kind="normal">          CM.getReductionPatternCost(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF, <a href="/docs/api/namespaces/llvm/#ae5262cc0e3a55bc74891cb8751d3b188">toVectorTy</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), VF));</Highlight></CodeLine>
<Link id="l07327" /><CodeLine lineNumber="7327"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ReductionCost)</Highlight></CodeLine>
<Link id="l07328" /><CodeLine lineNumber="7328"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07329" /><CodeLine lineNumber="7329"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07330" /><CodeLine lineNumber="7330"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.<a href="/docs/api/classes/llvm/smallptrsetimpl/#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l07331" /><CodeLine lineNumber="7331"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;reduction op visited multiple times&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07332" /><CodeLine lineNumber="7332"><Highlight kind="normal">      CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l07333" /><CodeLine lineNumber="7333"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Cost of &quot;</Highlight><Highlight kind="normal"> &lt;&lt; ReductionCost &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; for VF &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF</Highlight></CodeLine>
<Link id="l07334" /><CodeLine lineNumber="7334"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;:\\n in-loop reduction &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07335" /><CodeLine lineNumber="7335"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += &#42;ReductionCost;</Highlight></CodeLine>
<Link id="l07336" /><CodeLine lineNumber="7336"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07337" /><CodeLine lineNumber="7337"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07338" /><CodeLine lineNumber="7338"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07339" /><CodeLine lineNumber="7339"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Pre-compute the costs for branches except for the backedge, as the number</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07340" /><CodeLine lineNumber="7340"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of replicate regions in a VPlan may not directly match the number of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07341" /><CodeLine lineNumber="7341"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// branches, which would lead to different decisions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07342" /><CodeLine lineNumber="7342"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Compute cost of branches for each replicate region in the VPlan,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07343" /><CodeLine lineNumber="7343"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// which is more accurate than the legacy cost model.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07344" /><CodeLine lineNumber="7344"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (BasicBlock &#42;BB : OrigLoop-&gt;blocks()) &#123;</Highlight></CodeLine>
<Link id="l07345" /><CodeLine lineNumber="7345"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756">skipCostComputation</a>(BB-&gt;getTerminator(), VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()))</Highlight></CodeLine>
<Link id="l07346" /><CodeLine lineNumber="7346"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07347" /><CodeLine lineNumber="7347"><Highlight kind="normal">    CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(BB-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l07348" /><CodeLine lineNumber="7348"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB == OrigLoop-&gt;getLoopLatch())</Highlight></CodeLine>
<Link id="l07349" /><CodeLine lineNumber="7349"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07350" /><CodeLine lineNumber="7350"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> BranchCost = CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a79d75561901a5fc0d187b229afd5a745">getLegacyCost</a>(BB-&gt;getTerminator(), VF);</Highlight></CodeLine>
<Link id="l07351" /><CodeLine lineNumber="7351"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += BranchCost;</Highlight></CodeLine>
<Link id="l07352" /><CodeLine lineNumber="7352"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07353" /><CodeLine lineNumber="7353"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07354" /><CodeLine lineNumber="7354"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Pre-compute costs for instructions that are forced-scalar or profitable to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07355" /><CodeLine lineNumber="7355"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// scalarize. Their costs will be computed separately in the legacy cost</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07356" /><CodeLine lineNumber="7356"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// model.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07357" /><CodeLine lineNumber="7357"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Instruction &#42;ForcedScalar : CM.ForcedScalars&#91;VF&#93;) &#123;</Highlight></CodeLine>
<Link id="l07358" /><CodeLine lineNumber="7358"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756">skipCostComputation</a>(ForcedScalar, VF.isVector()))</Highlight></CodeLine>
<Link id="l07359" /><CodeLine lineNumber="7359"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07360" /><CodeLine lineNumber="7360"><Highlight kind="normal">    CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(ForcedScalar);</Highlight></CodeLine>
<Link id="l07361" /><CodeLine lineNumber="7361"><Highlight kind="normal">    InstructionCost ForcedCost = CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a79d75561901a5fc0d187b229afd5a745">getLegacyCost</a>(ForcedScalar, VF);</Highlight></CodeLine>
<Link id="l07362" /><CodeLine lineNumber="7362"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</Highlight></CodeLine>
<Link id="l07363" /><CodeLine lineNumber="7363"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Cost of &quot;</Highlight><Highlight kind="normal"> &lt;&lt; ForcedCost &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; for VF &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF</Highlight></CodeLine>
<Link id="l07364" /><CodeLine lineNumber="7364"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;: forced scalar &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;ForcedScalar &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07365" /><CodeLine lineNumber="7365"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l07366" /><CodeLine lineNumber="7366"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += ForcedCost;</Highlight></CodeLine>
<Link id="l07367" /><CodeLine lineNumber="7367"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07368" /><CodeLine lineNumber="7368"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;Scalarized, ScalarCost&#93; : CM.InstsToScalarize&#91;VF&#93;) &#123;</Highlight></CodeLine>
<Link id="l07369" /><CodeLine lineNumber="7369"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#a63e22afb86cb9352134896452820d756">skipCostComputation</a>(Scalarized, VF.isVector()))</Highlight></CodeLine>
<Link id="l07370" /><CodeLine lineNumber="7370"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07371" /><CodeLine lineNumber="7371"><Highlight kind="normal">    CostCtx.<a href="/docs/api/structs/llvm/vpcostcontext/#af5bbd658e6d49d141ac83dd0bc65a92d">SkipCostComputation</a>.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Scalarized);</Highlight></CodeLine>
<Link id="l07372" /><CodeLine lineNumber="7372"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</Highlight></CodeLine>
<Link id="l07373" /><CodeLine lineNumber="7373"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Cost of &quot;</Highlight><Highlight kind="normal"> &lt;&lt; ScalarCost &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; for VF &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF</Highlight></CodeLine>
<Link id="l07374" /><CodeLine lineNumber="7374"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;: profitable to scalarize &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;Scalarized &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07375" /><CodeLine lineNumber="7375"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l07376" /><CodeLine lineNumber="7376"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += ScalarCost;</Highlight></CodeLine>
<Link id="l07377" /><CodeLine lineNumber="7377"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07378" /><CodeLine lineNumber="7378"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07379" /><CodeLine lineNumber="7379"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l07380" /><CodeLine lineNumber="7380"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07381" /><CodeLine lineNumber="7381"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07382" /><CodeLine lineNumber="7382"><Highlight kind="normal"><a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> LoopVectorizationPlanner::cost(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan,</Highlight></CodeLine>
<Link id="l07383" /><CodeLine lineNumber="7383"><Highlight kind="normal">                                               <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l07384" /><CodeLine lineNumber="7384"><Highlight kind="normal">  VPCostContext CostCtx(CM.TTI, &#42;CM.TLI, Legal-&gt;getWidestInductionType(), CM,</Highlight></CodeLine>
<Link id="l07385" /><CodeLine lineNumber="7385"><Highlight kind="normal">                        CM.CostKind);</Highlight></CodeLine>
<Link id="l07386" /><CodeLine lineNumber="7386"><Highlight kind="normal">  InstructionCost <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = precomputeCosts(Plan, VF, CostCtx);</Highlight></CodeLine>
<Link id="l07387" /><CodeLine lineNumber="7387"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07388" /><CodeLine lineNumber="7388"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now compute and add the VPlan-based cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07389" /><CodeLine lineNumber="7389"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> += Plan.<a href="/docs/api/classes/llvm/vplan/#a8d2ce995a1feaa7a65ff40f77f073db3">cost</a>(VF, CostCtx);</Highlight></CodeLine>
<Link id="l07390" /><CodeLine lineNumber="7390"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07391" /><CodeLine lineNumber="7391"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> EstimatedWidth = <a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a>(OrigLoop, CM.TTI, VF);</Highlight></CodeLine>
<Link id="l07392" /><CodeLine lineNumber="7392"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Cost for VF &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a></Highlight></CodeLine>
<Link id="l07393" /><CodeLine lineNumber="7393"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; (Estimated cost per lane: &quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07394" /><CodeLine lineNumber="7394"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>()) &#123;</Highlight></CodeLine>
<Link id="l07395" /><CodeLine lineNumber="7395"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">double</Highlight><Highlight kind="normal"> CostPerLane = double(&#42;<a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>.<a href="/docs/api/classes/llvm/instructioncost/#a9b642067999075ba996ecdee40b52b68">getValue</a>()) / EstimatedWidth;</Highlight></CodeLine>
<Link id="l07396" /><CodeLine lineNumber="7396"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; <a href="/docs/api/namespaces/llvm/#a939bc2108d47080767f0c06ba56caec7">format</a>(</Highlight><Highlight kind="stringliteral">&quot;%.1f&quot;</Highlight><Highlight kind="normal">, CostPerLane));</Highlight></CodeLine>
<Link id="l07397" /><CodeLine lineNumber="7397"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42; No point dividing an invalid cost - it will still be invalid &#42;/</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07398" /><CodeLine lineNumber="7398"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Invalid&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07399" /><CodeLine lineNumber="7399"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;)\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07400" /><CodeLine lineNumber="7400"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07401" /><CodeLine lineNumber="7401"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>;</Highlight></CodeLine>
<Link id="l07402" /><CodeLine lineNumber="7402"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07403" /><CodeLine lineNumber="7403"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07404" /><CodeLine lineNumber="7404"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07405" /><CodeLine lineNumber="7405"><Highlight kind="comment">/// Return true if the original loop \\ TheLoop contains any instructions that do</Highlight></CodeLine>
<Link id="l07406" /><CodeLine lineNumber="7406"><Highlight kind="comment">/// not have corresponding recipes in \\p Plan and are not marked to be ignored</Highlight></CodeLine>
<Link id="l07407" /><CodeLine lineNumber="7407"><Highlight kind="comment">/// in \\p CostCtx. This means the VPlan contains simplification that the legacy</Highlight></CodeLine>
<Link id="l07408" /><CodeLine lineNumber="7408"><Highlight kind="comment">/// cost-model did not account for.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07409" /><CodeLine lineNumber="7409" lineLink="#a696283c30308704d020a9d86065aa3ae"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a696283c30308704d020a9d86065aa3ae">planContainsAdditionalSimplifications</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan,</Highlight></CodeLine>
<Link id="l07410" /><CodeLine lineNumber="7410"><Highlight kind="normal">                                                  <a href="/docs/api/structs/llvm/vpcostcontext">VPCostContext</a> &amp;CostCtx,</Highlight></CodeLine>
<Link id="l07411" /><CodeLine lineNumber="7411"><Highlight kind="normal">                                                  <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;TheLoop) &#123;</Highlight></CodeLine>
<Link id="l07412" /><CodeLine lineNumber="7412"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// First collect all instructions for the recipes in Plan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07413" /><CodeLine lineNumber="7413"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GetInstructionForCost = &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;R) -&gt; <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l07414" /><CodeLine lineNumber="7414"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;S = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPSingleDefRecipe&gt;</a>(R))</Highlight></CodeLine>
<Link id="l07415" /><CodeLine lineNumber="7415"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;Instruction&gt;</a>(S-&gt;getUnderlyingValue());</Highlight></CodeLine>
<Link id="l07416" /><CodeLine lineNumber="7416"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WidenMem = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenMemoryRecipe&gt;</a>(R))</Highlight></CodeLine>
<Link id="l07417" /><CodeLine lineNumber="7417"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &amp;WidenMem-&gt;getIngredient();</Highlight></CodeLine>
<Link id="l07418" /><CodeLine lineNumber="7418"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07419" /><CodeLine lineNumber="7419"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l07420" /><CodeLine lineNumber="7420"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07421" /><CodeLine lineNumber="7421"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/denseset">DenseSet&lt;Instruction &#42;&gt;</a> SeenInstrs;</Highlight></CodeLine>
<Link id="l07422" /><CodeLine lineNumber="7422"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Iter = <a href="/docs/api/namespaces/llvm/#a495c27cd70886cb8647df0ecdd9cc63d">vp&#95;depth&#95;first&#95;deep</a>(Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpregionblock/#a1ae2cb3c63b4d67324ddc947fb9696fc">getEntry</a>());</Highlight></CodeLine>
<Link id="l07423" /><CodeLine lineNumber="7423"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB : <a href="/docs/api/classes/llvm/vpblockutils/#a0360eea6cebcb1470f84b11f7ba51f16">VPBlockUtils::blocksOnly&lt;VPBasicBlock&gt;</a>(Iter)) &#123;</Highlight></CodeLine>
<Link id="l07424" /><CodeLine lineNumber="7424"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : &#42;VPBB) &#123;</Highlight></CodeLine>
<Link id="l07425" /><CodeLine lineNumber="7425"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/legalizer-cpp/#a05ab4853f7153e537774d02580e761ec">IR</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPInterleaveRecipe&gt;</a>(&amp;R)) &#123;</Highlight></CodeLine>
<Link id="l07426" /><CodeLine lineNumber="7426"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IG = <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/legalizer-cpp/#a05ab4853f7153e537774d02580e761ec">IR</a>-&gt;getInterleaveGroup();</Highlight></CodeLine>
<Link id="l07427" /><CodeLine lineNumber="7427"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumMembers = IG-&gt;getNumMembers();</Highlight></CodeLine>
<Link id="l07428" /><CodeLine lineNumber="7428"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != NumMembers; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l07429" /><CodeLine lineNumber="7429"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;M = IG-&gt;getMember(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l07430" /><CodeLine lineNumber="7430"><Highlight kind="normal">            SeenInstrs.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(M);</Highlight></CodeLine>
<Link id="l07431" /><CodeLine lineNumber="7431"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l07432" /><CodeLine lineNumber="7432"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07433" /><CodeLine lineNumber="7433"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l07434" /><CodeLine lineNumber="7434"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The VPlan-based cost model is more accurate for partial reduction and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07435" /><CodeLine lineNumber="7435"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// comparing against the legacy cost isn&#39;t desirable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07436" /><CodeLine lineNumber="7436"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPPartialReductionRecipe&gt;</a>(&amp;R))</Highlight></CodeLine>
<Link id="l07437" /><CodeLine lineNumber="7437"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07438" /><CodeLine lineNumber="7438"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = GetInstructionForCost(&amp;R))</Highlight></CodeLine>
<Link id="l07439" /><CodeLine lineNumber="7439"><Highlight kind="normal">        SeenInstrs.<a href="/docs/api/classes/llvm/detail/densesetimpl/#a1b0f3ebdced8fce4b22c6a63b25d9525">insert</a>(UI);</Highlight></CodeLine>
<Link id="l07440" /><CodeLine lineNumber="7440"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07441" /><CodeLine lineNumber="7441"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07442" /><CodeLine lineNumber="7442"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07443" /><CodeLine lineNumber="7443"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Return true if the loop contains any instructions that are not also part of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07444" /><CodeLine lineNumber="7444"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the VPlan or are skipped for VPlan-based cost computations. This indicates</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07445" /><CodeLine lineNumber="7445"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that the VPlan contains extra simplifications.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07446" /><CodeLine lineNumber="7446"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(TheLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a78bec3084b9a47ee11cc2e56f9004717">blocks</a>(), &#91;&amp;SeenInstrs, &amp;CostCtx,</Highlight></CodeLine>
<Link id="l07447" /><CodeLine lineNumber="7447"><Highlight kind="normal">                                    TheLoop&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l07448" /><CodeLine lineNumber="7448"><Highlight kind="normal">    return any&#95;of(&#42;BB, &#91;&amp;SeenInstrs, &amp;CostCtx, TheLoop, BB&#93;(Instruction &amp;I) &#123;</Highlight></CodeLine>
<Link id="l07449" /><CodeLine lineNumber="7449"><Highlight kind="normal">      if (isa&lt;PHINode&gt;(&amp;I) &amp;&amp; BB == TheLoop-&gt;getHeader())</Highlight></CodeLine>
<Link id="l07450" /><CodeLine lineNumber="7450"><Highlight kind="normal">        return false;</Highlight></CodeLine>
<Link id="l07451" /><CodeLine lineNumber="7451"><Highlight kind="normal">      return !SeenInstrs.contains(&amp;I) &amp;&amp; !CostCtx.skipCostComputation(&amp;I, true);</Highlight></CodeLine>
<Link id="l07452" /><CodeLine lineNumber="7452"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l07453" /><CodeLine lineNumber="7453"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l07454" /><CodeLine lineNumber="7454"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07455" /><CodeLine lineNumber="7455"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07456" /><CodeLine lineNumber="7456"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07457" /><CodeLine lineNumber="7457" lineLink="/docs/api/classes/llvm/loopvectorizationplanner/#a4adc69fc8f74164e990cce6afc1e061b"><Highlight kind="normal"><a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> <a href="/docs/api/classes/llvm/loopvectorizationplanner/#a4adc69fc8f74164e990cce6afc1e061b">LoopVectorizationPlanner::computeBestVF</a>() &#123;</Highlight></CodeLine>
<Link id="l07458" /><CodeLine lineNumber="7458"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VPlans.empty())</Highlight></CodeLine>
<Link id="l07459" /><CodeLine lineNumber="7459"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vectorizationfactor/#acd24dfdad4f887e1f7b10c9039a05930">VectorizationFactor::Disabled</a>();</Highlight></CodeLine>
<Link id="l07460" /><CodeLine lineNumber="7460"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there is a single VPlan with a single VF, return it directly.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07461" /><CodeLine lineNumber="7461"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;FirstPlan = &#42;VPlans&#91;0&#93;;</Highlight></CodeLine>
<Link id="l07462" /><CodeLine lineNumber="7462"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VPlans.size() == 1 &amp;&amp; <a href="/docs/api/namespaces/llvm/#a10f3d955592ae2bc745f57e5b48ae115">size</a>(FirstPlan.<a href="/docs/api/classes/llvm/vplan/#a3aac2593ea2eaac537de30053e8e05fd">vectorFactors</a>()) == 1)</Highlight></CodeLine>
<Link id="l07463" /><CodeLine lineNumber="7463"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;&#42;FirstPlan.<a href="/docs/api/classes/llvm/vplan/#a3aac2593ea2eaac537de30053e8e05fd">vectorFactors</a>().begin(), 0, 0&#125;;</Highlight></CodeLine>
<Link id="l07464" /><CodeLine lineNumber="7464"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07465" /><CodeLine lineNumber="7465"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Computing best VF using cost kind: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07466" /><CodeLine lineNumber="7466"><Highlight kind="normal">                    &lt;&lt; (CM.CostKind == <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba59b32ea7b6f10564abd40ad90602ca5b">TTI::TCK&#95;RecipThroughput</a></Highlight></CodeLine>
<Link id="l07467" /><CodeLine lineNumber="7467"><Highlight kind="normal">                            ? </Highlight><Highlight kind="stringliteral">&quot;Reciprocal Throughput\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07468" /><CodeLine lineNumber="7468"><Highlight kind="normal">                        : CM.CostKind == <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba81b2c6f1f1e13e4a575e6d1c8b29b6e1">TTI::TCK&#95;Latency</a></Highlight></CodeLine>
<Link id="l07469" /><CodeLine lineNumber="7469"><Highlight kind="normal">                            ? </Highlight><Highlight kind="stringliteral">&quot;Instruction Latency\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07470" /><CodeLine lineNumber="7470"><Highlight kind="normal">                        : CM.CostKind == <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba737cfc93e5a2ff961677d57186167e7c">TTI::TCK&#95;CodeSize</a> ? </Highlight><Highlight kind="stringliteral">&quot;Code Size\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07471" /><CodeLine lineNumber="7471"><Highlight kind="normal">                        : CM.CostKind == <a href="/docs/api/classes/llvm/targettransforminfo/#a706f223f760b55668fbae74202b816bba7f80055e1969cb850739546467460ad8">TTI::TCK&#95;SizeAndLatency</a></Highlight></CodeLine>
<Link id="l07472" /><CodeLine lineNumber="7472"><Highlight kind="normal">                            ? </Highlight><Highlight kind="stringliteral">&quot;Code Size and Latency\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07473" /><CodeLine lineNumber="7473"><Highlight kind="normal">                            : </Highlight><Highlight kind="stringliteral">&quot;Unknown\\n&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l07474" /><CodeLine lineNumber="7474"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07475" /><CodeLine lineNumber="7475"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> ScalarVF = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1);</Highlight></CodeLine>
<Link id="l07476" /><CodeLine lineNumber="7476"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/loopvectorizationplanner/#adce80172b05bc0a227fbd5e3d7bb80f2">hasPlanWithVF</a>(ScalarVF) &amp;&amp;</Highlight></CodeLine>
<Link id="l07477" /><CodeLine lineNumber="7477"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;More than a single plan/VF w/o any plan having scalar VF&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07478" /><CodeLine lineNumber="7478"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07479" /><CodeLine lineNumber="7479"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Compute scalar cost using VPlan-based cost model.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07480" /><CodeLine lineNumber="7480"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> ScalarCost = CM.expectedCost(ScalarVF);</Highlight></CodeLine>
<Link id="l07481" /><CodeLine lineNumber="7481"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Scalar loop costs: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; ScalarCost &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07482" /><CodeLine lineNumber="7482"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> ScalarFactor(ScalarVF, ScalarCost, ScalarCost);</Highlight></CodeLine>
<Link id="l07483" /><CodeLine lineNumber="7483"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> BestFactor = ScalarFactor;</Highlight></CodeLine>
<Link id="l07484" /><CodeLine lineNumber="7484"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07485" /><CodeLine lineNumber="7485"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ForceVectorization = Hints.getForce() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a>;</Highlight></CodeLine>
<Link id="l07486" /><CodeLine lineNumber="7486"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ForceVectorization) &#123;</Highlight></CodeLine>
<Link id="l07487" /><CodeLine lineNumber="7487"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Ignore scalar width, because the user explicitly wants vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07488" /><CodeLine lineNumber="7488"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Initialize cost to max so that VF = 2 is, at least, chosen during cost</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07489" /><CodeLine lineNumber="7489"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// evaluation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07490" /><CodeLine lineNumber="7490"><Highlight kind="normal">    BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a048d568675a5cc69c3fb85206882316d">Cost</a> = <a href="/docs/api/classes/llvm/instructioncost/#a6de26b938774385a0a4fb0d0b2a32d48">InstructionCost::getMax</a>();</Highlight></CodeLine>
<Link id="l07491" /><CodeLine lineNumber="7491"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07492" /><CodeLine lineNumber="7492"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07493" /><CodeLine lineNumber="7493"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : VPlans) &#123;</Highlight></CodeLine>
<Link id="l07494" /><CodeLine lineNumber="7494"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF : <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>-&gt;vectorFactors()) &#123;</Highlight></CodeLine>
<Link id="l07495" /><CodeLine lineNumber="7495"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>())</Highlight></CodeLine>
<Link id="l07496" /><CodeLine lineNumber="7496"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07497" /><CodeLine lineNumber="7497"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ForceVectorization &amp;&amp; !<a href="#af378bb1e037306d9cfd4bb0b49ba55f9">willGenerateVectors</a>(&#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, VF, TTI)) &#123;</Highlight></CodeLine>
<Link id="l07498" /><CodeLine lineNumber="7498"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l07499" /><CodeLine lineNumber="7499"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</Highlight></CodeLine>
<Link id="l07500" /><CodeLine lineNumber="7500"><Highlight kind="normal">            &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Not considering vector loop of width &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF</Highlight></CodeLine>
<Link id="l07501" /><CodeLine lineNumber="7501"><Highlight kind="normal">            &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; because it will not generate any vector instructions.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07502" /><CodeLine lineNumber="7502"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07503" /><CodeLine lineNumber="7503"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l07504" /><CodeLine lineNumber="7504"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07505" /><CodeLine lineNumber="7505"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = cost(&#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, VF);</Highlight></CodeLine>
<Link id="l07506" /><CodeLine lineNumber="7506"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> CurrentFactor(VF, <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>, ScalarCost);</Highlight></CodeLine>
<Link id="l07507" /><CodeLine lineNumber="7507"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (isMoreProfitable(CurrentFactor, BestFactor))</Highlight></CodeLine>
<Link id="l07508" /><CodeLine lineNumber="7508"><Highlight kind="normal">        BestFactor = CurrentFactor;</Highlight></CodeLine>
<Link id="l07509" /><CodeLine lineNumber="7509"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07510" /><CodeLine lineNumber="7510"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If profitable add it to ProfitableVF list.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07511" /><CodeLine lineNumber="7511"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (isMoreProfitable(CurrentFactor, ScalarFactor))</Highlight></CodeLine>
<Link id="l07512" /><CodeLine lineNumber="7512"><Highlight kind="normal">        ProfitableVFs.push&#95;back(CurrentFactor);</Highlight></CodeLine>
<Link id="l07513" /><CodeLine lineNumber="7513"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07514" /><CodeLine lineNumber="7514"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07515" /><CodeLine lineNumber="7515"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07516" /><CodeLine lineNumber="7516"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07517" /><CodeLine lineNumber="7517"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Select the optimal vectorization factor according to the legacy cost-model.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07518" /><CodeLine lineNumber="7518"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is now only used to verify the decisions by the new VPlan-based</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07519" /><CodeLine lineNumber="7519"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cost-model and will be retired once the VPlan-based cost-model is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07520" /><CodeLine lineNumber="7520"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// stabilized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07521" /><CodeLine lineNumber="7521"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> LegacyVF = selectVectorizationFactor();</Highlight></CodeLine>
<Link id="l07522" /><CodeLine lineNumber="7522"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;BestPlan = <a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>);</Highlight></CodeLine>
<Link id="l07523" /><CodeLine lineNumber="7523"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07524" /><CodeLine lineNumber="7524"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Pre-compute the cost and use it to check if BestPlan contains any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07525" /><CodeLine lineNumber="7525"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// simplifications not accounted for in the legacy cost model. If that&#39;s the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07526" /><CodeLine lineNumber="7526"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// case, don&#39;t trigger the assertion, as the extra simplifications may cause a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07527" /><CodeLine lineNumber="7527"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// different VF to be picked by the VPlan-based cost model.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07528" /><CodeLine lineNumber="7528"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vpcostcontext">VPCostContext</a> CostCtx(CM.TTI, &#42;CM.TLI, Legal-&gt;getWidestInductionType(), CM,</Highlight></CodeLine>
<Link id="l07529" /><CodeLine lineNumber="7529"><Highlight kind="normal">                        CM.CostKind);</Highlight></CodeLine>
<Link id="l07530" /><CodeLine lineNumber="7530"><Highlight kind="normal">  precomputeCosts(BestPlan, BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, CostCtx);</Highlight></CodeLine>
<Link id="l07531" /><CodeLine lineNumber="7531"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a> == LegacyVF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a> ||</Highlight></CodeLine>
<Link id="l07532" /><CodeLine lineNumber="7532"><Highlight kind="normal">          <a href="#a696283c30308704d020a9d86065aa3ae">planContainsAdditionalSimplifications</a>(<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>),</Highlight></CodeLine>
<Link id="l07533" /><CodeLine lineNumber="7533"><Highlight kind="normal">                                                CostCtx, OrigLoop) ||</Highlight></CodeLine>
<Link id="l07534" /><CodeLine lineNumber="7534"><Highlight kind="normal">          <a href="#a696283c30308704d020a9d86065aa3ae">planContainsAdditionalSimplifications</a>(<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(LegacyVF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>),</Highlight></CodeLine>
<Link id="l07535" /><CodeLine lineNumber="7535"><Highlight kind="normal">                                                CostCtx, OrigLoop)) &amp;&amp;</Highlight></CodeLine>
<Link id="l07536" /><CodeLine lineNumber="7536"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot; VPlan cost model and legacy cost model disagreed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07537" /><CodeLine lineNumber="7537"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a76f716c04dfa813b98e1c112bc642d34">ScalarCost</a> &gt; 0) &amp;&amp;</Highlight></CodeLine>
<Link id="l07538" /><CodeLine lineNumber="7538"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;when vectorizing, the scalar cost must be computed.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07539" /><CodeLine lineNumber="7539"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07540" /><CodeLine lineNumber="7540"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07541" /><CodeLine lineNumber="7541"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Selecting VF: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; BestFactor.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07542" /><CodeLine lineNumber="7542"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BestFactor;</Highlight></CodeLine>
<Link id="l07543" /><CodeLine lineNumber="7543"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07544" /><CodeLine lineNumber="7544"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07545" /><CodeLine lineNumber="7545" lineLink="#a033bb363914fbd3c2cd990330959036c"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a033bb363914fbd3c2cd990330959036c">addRuntimeUnrollDisableMetaData</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123;</Highlight></CodeLine>
<Link id="l07546" /><CodeLine lineNumber="7546"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Metadata &#42;, 4&gt;</a> MDs;</Highlight></CodeLine>
<Link id="l07547" /><CodeLine lineNumber="7547"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Reserve first location for self reference to the LoopID metadata node.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07548" /><CodeLine lineNumber="7548"><Highlight kind="normal">  MDs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07549" /><CodeLine lineNumber="7549"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsUnrollMetadata = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07550" /><CodeLine lineNumber="7550"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;LoopID = L-&gt;getLoopID();</Highlight></CodeLine>
<Link id="l07551" /><CodeLine lineNumber="7551"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LoopID) &#123;</Highlight></CodeLine>
<Link id="l07552" /><CodeLine lineNumber="7552"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// First find existing loop unrolling disable metadata.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07553" /><CodeLine lineNumber="7553"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 1, IE = LoopID-&gt;<a href="/docs/api/classes/llvm/mdnode/#aa4068e37ec583962685e3567dc102ae5">getNumOperands</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; IE; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l07554" /><CodeLine lineNumber="7554"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MD = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MDNode&gt;</a>(LoopID-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l07555" /><CodeLine lineNumber="7555"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MD) &#123;</Highlight></CodeLine>
<Link id="l07556" /><CodeLine lineNumber="7556"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;S = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;MDString&gt;</a>(MD-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l07557" /><CodeLine lineNumber="7557"><Highlight kind="normal">        IsUnrollMetadata =</Highlight></CodeLine>
<Link id="l07558" /><CodeLine lineNumber="7558"><Highlight kind="normal">            S &amp;&amp; S-&gt;getString().starts&#95;with(</Highlight><Highlight kind="stringliteral">&quot;llvm.loop.unroll.disable&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07559" /><CodeLine lineNumber="7559"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l07560" /><CodeLine lineNumber="7560"><Highlight kind="normal">      MDs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(LoopID-&gt;<a href="/docs/api/classes/llvm/mdnode/#a42409838a49255a3770da1469872f20b">getOperand</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>));</Highlight></CodeLine>
<Link id="l07561" /><CodeLine lineNumber="7561"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07562" /><CodeLine lineNumber="7562"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07563" /><CodeLine lineNumber="7563"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07564" /><CodeLine lineNumber="7564"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IsUnrollMetadata) &#123;</Highlight></CodeLine>
<Link id="l07565" /><CodeLine lineNumber="7565"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Add runtime unroll disable metadata.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07566" /><CodeLine lineNumber="7566"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Context = L-&gt;getHeader()-&gt;getContext();</Highlight></CodeLine>
<Link id="l07567" /><CodeLine lineNumber="7567"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Metadata &#42;, 1&gt;</a> DisableOperands;</Highlight></CodeLine>
<Link id="l07568" /><CodeLine lineNumber="7568"><Highlight kind="normal">    DisableOperands.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(</Highlight></CodeLine>
<Link id="l07569" /><CodeLine lineNumber="7569"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/mdstring/#affbb7e2e9ad8d18114816f2443d672b9">MDString::get</a>(Context, </Highlight><Highlight kind="stringliteral">&quot;llvm.loop.unroll.runtime.disable&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l07570" /><CodeLine lineNumber="7570"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;DisableNode = <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Context, DisableOperands);</Highlight></CodeLine>
<Link id="l07571" /><CodeLine lineNumber="7571"><Highlight kind="normal">    MDs.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(DisableNode);</Highlight></CodeLine>
<Link id="l07572" /><CodeLine lineNumber="7572"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;NewLoopID = <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">MDNode::get</a>(Context, MDs);</Highlight></CodeLine>
<Link id="l07573" /><CodeLine lineNumber="7573"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Set operand 0 to refer to the loop id itself.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07574" /><CodeLine lineNumber="7574"><Highlight kind="normal">    NewLoopID-&gt;<a href="/docs/api/classes/llvm/mdnode/#a160e9e1a4fd597f83034c8b2ba316984">replaceOperandWith</a>(0, NewLoopID);</Highlight></CodeLine>
<Link id="l07575" /><CodeLine lineNumber="7575"><Highlight kind="normal">    L-&gt;setLoopID(NewLoopID);</Highlight></CodeLine>
<Link id="l07576" /><CodeLine lineNumber="7576"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07577" /><CodeLine lineNumber="7577"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07578" /><CodeLine lineNumber="7578"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07579" /><CodeLine lineNumber="7579"><Highlight kind="normal"></Highlight><Highlight kind="comment">// If \\p R is a ComputeReductionResult when vectorizing the epilog loop,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07580" /><CodeLine lineNumber="7580"><Highlight kind="normal"></Highlight><Highlight kind="comment">// fix the reduction&#39;s scalar PHI node by adding the incoming value from the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07581" /><CodeLine lineNumber="7581"><Highlight kind="normal"></Highlight><Highlight kind="comment">// main vector loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07582" /><CodeLine lineNumber="7582" lineLink="#a90ad8ccd396152c749068f986f2b751a"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a90ad8ccd396152c749068f986f2b751a">fixReductionScalarResumeWhenVectorizingEpilog</a>(</Highlight></CodeLine>
<Link id="l07583" /><CodeLine lineNumber="7583"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;R, <a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopMiddleBlock,</Highlight></CodeLine>
<Link id="l07584" /><CodeLine lineNumber="7584"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BypassBlock) &#123;</Highlight></CodeLine>
<Link id="l07585" /><CodeLine lineNumber="7585"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;EpiRedResult = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPInstruction&gt;</a>(R);</Highlight></CodeLine>
<Link id="l07586" /><CodeLine lineNumber="7586"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!EpiRedResult ||</Highlight></CodeLine>
<Link id="l07587" /><CodeLine lineNumber="7587"><Highlight kind="normal">      EpiRedResult-&gt;getOpcode() != <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2ad9b4011dc2ac58da0fecd16d99f1f17d">VPInstruction::ComputeReductionResult</a>)</Highlight></CodeLine>
<Link id="l07588" /><CodeLine lineNumber="7588"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07589" /><CodeLine lineNumber="7589"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07590" /><CodeLine lineNumber="7590"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;EpiRedHeaderPhi =</Highlight></CodeLine>
<Link id="l07591" /><CodeLine lineNumber="7591"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPReductionPHIRecipe&gt;</a>(EpiRedResult-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l07592" /><CodeLine lineNumber="7592"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc =</Highlight></CodeLine>
<Link id="l07593" /><CodeLine lineNumber="7593"><Highlight kind="normal">      EpiRedHeaderPhi-&gt;getRecurrenceDescriptor();</Highlight></CodeLine>
<Link id="l07594" /><CodeLine lineNumber="7594"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;MainResumeValue =</Highlight></CodeLine>
<Link id="l07595" /><CodeLine lineNumber="7595"><Highlight kind="normal">      EpiRedHeaderPhi-&gt;getStartValue()-&gt;getUnderlyingValue();</Highlight></CodeLine>
<Link id="l07596" /><CodeLine lineNumber="7596"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a69df67c7d92481ae63a5d8017e96c716">RecurrenceDescriptor::isAnyOfRecurrenceKind</a>(</Highlight></CodeLine>
<Link id="l07597" /><CodeLine lineNumber="7597"><Highlight kind="normal">          RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>())) &#123;</Highlight></CodeLine>
<Link id="l07598" /><CodeLine lineNumber="7598"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Cmp = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;ICmpInst&gt;</a>(MainResumeValue);</Highlight></CodeLine>
<Link id="l07599" /><CodeLine lineNumber="7599"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Cmp-&gt;getPredicate() == <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bac17897ebf2f6a6986280fc3bdf28a30a">CmpInst::ICMP&#95;NE</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l07600" /><CodeLine lineNumber="7600"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;AnyOf expected to start with ICMP&#95;NE&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07601" /><CodeLine lineNumber="7601"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Cmp-&gt;getOperand(1) == RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a61351428b7eb226cbad866ccf2382817">getRecurrenceStartValue</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l07602" /><CodeLine lineNumber="7602"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;AnyOf expected to start by comparing main resume value to original &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07603" /><CodeLine lineNumber="7603"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;start value&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07604" /><CodeLine lineNumber="7604"><Highlight kind="normal">    MainResumeValue = Cmp-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l07605" /><CodeLine lineNumber="7605"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a7bc46d4489f4d6cb4a4e486ce5f6184b">RecurrenceDescriptor::isFindLastIVRecurrenceKind</a>(</Highlight></CodeLine>
<Link id="l07606" /><CodeLine lineNumber="7606"><Highlight kind="normal">                 RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>())) &#123;</Highlight></CodeLine>
<Link id="l07607" /><CodeLine lineNumber="7607"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</Highlight></CodeLine>
<Link id="l07608" /><CodeLine lineNumber="7608"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;Cmp, &#42;OrigResumeV;</Highlight></CodeLine>
<Link id="l07609" /><CodeLine lineNumber="7609"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsExpectedPattern =</Highlight></CodeLine>
<Link id="l07610" /><CodeLine lineNumber="7610"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(MainResumeValue, <a href="/docs/api/namespaces/llvm/patternmatch/#a3ccd94f6a7507492b47c7351e3fb78c6">m&#95;Select</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#a5be13f3abb6bddf7ad9747b077da5a0e">m&#95;OneUse</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(Cmp)),</Highlight></CodeLine>
<Link id="l07611" /><CodeLine lineNumber="7611"><Highlight kind="normal">                                        <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#aed10715d943d3e1b4ca75b585ea96ab8">getSentinelValue</a>()),</Highlight></CodeLine>
<Link id="l07612" /><CodeLine lineNumber="7612"><Highlight kind="normal">                                        <a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(OrigResumeV))) &amp;&amp;</Highlight></CodeLine>
<Link id="l07613" /><CodeLine lineNumber="7613"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(Cmp,</Highlight></CodeLine>
<Link id="l07614" /><CodeLine lineNumber="7614"><Highlight kind="normal">              <a href="/docs/api/namespaces/llvm/patternmatch/#a6924ab881778c340b66e1e693154b1a8">m&#95;SpecificICmp</a>(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">ICmpInst::ICMP&#95;EQ</a>, <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(OrigResumeV),</Highlight></CodeLine>
<Link id="l07615" /><CodeLine lineNumber="7615"><Highlight kind="normal">                             <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a61351428b7eb226cbad866ccf2382817">getRecurrenceStartValue</a>())));</Highlight></CodeLine>
<Link id="l07616" /><CodeLine lineNumber="7616"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IsExpectedPattern &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unexpected reduction resume pattern&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07617" /><CodeLine lineNumber="7617"><Highlight kind="normal">    (void)IsExpectedPattern;</Highlight></CodeLine>
<Link id="l07618" /><CodeLine lineNumber="7618"><Highlight kind="normal">    MainResumeValue = OrigResumeV;</Highlight></CodeLine>
<Link id="l07619" /><CodeLine lineNumber="7619"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07620" /><CodeLine lineNumber="7620"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;MainResumePhi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(MainResumeValue);</Highlight></CodeLine>
<Link id="l07621" /><CodeLine lineNumber="7621"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07622" /><CodeLine lineNumber="7622"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// When fixing reductions in the epilogue loop we should already have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07623" /><CodeLine lineNumber="7623"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// created a bc.merge.rdx Phi after the main vector body. Ensure that we carry</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07624" /><CodeLine lineNumber="7624"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// over the incoming values correctly.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07625" /><CodeLine lineNumber="7625"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">VPlanPatternMatch</a>;</Highlight></CodeLine>
<Link id="l07626" /><CodeLine lineNumber="7626"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsResumePhi = &#91;&#93;(<a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l07627" /><CodeLine lineNumber="7627"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(</Highlight></CodeLine>
<Link id="l07628" /><CodeLine lineNumber="7628"><Highlight kind="normal">        U, m&#95;VPInstruction&lt;VPInstruction::ResumePhi&gt;(m&#95;VPValue(), m&#95;VPValue()));</Highlight></CodeLine>
<Link id="l07629" /><CodeLine lineNumber="7629"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l07630" /><CodeLine lineNumber="7630"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac214df91cdc242f4710ea5a93939c678">count&#95;if</a>(EpiRedResult-&gt;users(), IsResumePhi) == 1 &amp;&amp;</Highlight></CodeLine>
<Link id="l07631" /><CodeLine lineNumber="7631"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;ResumePhi must have a single user&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07632" /><CodeLine lineNumber="7632"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;EpiResumePhiVPI =</Highlight></CodeLine>
<Link id="l07633" /><CodeLine lineNumber="7633"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPInstruction&gt;</a>(&#42;<a href="/docs/api/namespaces/llvm/#ac78c09ae232b2ce188ff590d51e3c268">find&#95;if</a>(EpiRedResult-&gt;users(), IsResumePhi));</Highlight></CodeLine>
<Link id="l07634" /><CodeLine lineNumber="7634"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;EpiResumePhi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(State.get(EpiResumePhiVPI, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l07635" /><CodeLine lineNumber="7635"><Highlight kind="normal">  EpiResumePhi-&gt;setIncomingValueForBlock(</Highlight></CodeLine>
<Link id="l07636" /><CodeLine lineNumber="7636"><Highlight kind="normal">      BypassBlock, MainResumePhi-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(BypassBlock));</Highlight></CodeLine>
<Link id="l07637" /><CodeLine lineNumber="7637"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07638" /><CodeLine lineNumber="7638"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07639" /><CodeLine lineNumber="7639" lineLink="/docs/api/classes/llvm/loopvectorizationplanner/#acbe2feb9e960936a43c845a1fa8eaba4"><Highlight kind="normal"><a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const SCEV &#42;, Value &#42;&gt;</a> <a href="/docs/api/classes/llvm/loopvectorizationplanner/#acbe2feb9e960936a43c845a1fa8eaba4">LoopVectorizationPlanner::executePlan</a>(</Highlight></CodeLine>
<Link id="l07640" /><CodeLine lineNumber="7640"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> BestVF, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> BestUF, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;BestVPlan,</Highlight></CodeLine>
<Link id="l07641" /><CodeLine lineNumber="7641"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopvectorizer">InnerLoopVectorizer</a> &amp;ILV, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> VectorizingEpilogue,</Highlight></CodeLine>
<Link id="l07642" /><CodeLine lineNumber="7642"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const SCEV &#42;, Value &#42;&gt;</a> &#42;ExpandedSCEVs) &#123;</Highlight></CodeLine>
<Link id="l07643" /><CodeLine lineNumber="7643"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a633dd97e642c10e8aa1dff2bd2874edb">hasVF</a>(BestVF) &amp;&amp;</Highlight></CodeLine>
<Link id="l07644" /><CodeLine lineNumber="7644"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Trying to execute plan with unsupported VF&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07645" /><CodeLine lineNumber="7645"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a6e9c2a69cd9bc0e46626f5302a03d3da">hasUF</a>(BestUF) &amp;&amp;</Highlight></CodeLine>
<Link id="l07646" /><CodeLine lineNumber="7646"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Trying to execute plan with unsupported UF&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07647" /><CodeLine lineNumber="7647"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l07648" /><CodeLine lineNumber="7648"><Highlight kind="normal">      ((VectorizingEpilogue &amp;&amp; ExpandedSCEVs) ||</Highlight></CodeLine>
<Link id="l07649" /><CodeLine lineNumber="7649"><Highlight kind="normal">       (!VectorizingEpilogue &amp;&amp; !ExpandedSCEVs)) &amp;&amp;</Highlight></CodeLine>
<Link id="l07650" /><CodeLine lineNumber="7650"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;expanded SCEVs to reuse can only be used during epilogue vectorization&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07651" /><CodeLine lineNumber="7651"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07652" /><CodeLine lineNumber="7652"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Move to VPlan transform stage once the transition to the VPlan-based</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07653" /><CodeLine lineNumber="7653"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cost model is complete for better cost estimates.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07654" /><CodeLine lineNumber="7654"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vplantransforms/#a7a1cca51bb9bce4efad1063dcf158967">VPlanTransforms::unrollByUF</a>(BestVPlan, BestUF,</Highlight></CodeLine>
<Link id="l07655" /><CodeLine lineNumber="7655"><Highlight kind="normal">                              OrigLoop-&gt;getHeader()-&gt;getContext());</Highlight></CodeLine>
<Link id="l07656" /><CodeLine lineNumber="7656"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vplantransforms/#af25d938764b8634e70e95ff3f0c35129">VPlanTransforms::optimizeForVFAndUF</a>(BestVPlan, BestVF, BestUF, PSE);</Highlight></CodeLine>
<Link id="l07657" /><CodeLine lineNumber="7657"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vplantransforms/#a63e564d621011fac5978d18138121e5c">VPlanTransforms::convertToConcreteRecipes</a>(BestVPlan);</Highlight></CodeLine>
<Link id="l07658" /><CodeLine lineNumber="7658"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07659" /><CodeLine lineNumber="7659"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Perform the actual loop transformation.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07660" /><CodeLine lineNumber="7660"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> State(&amp;TTI, BestVF, BestUF, LI, DT, ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>, &amp;ILV,</Highlight></CodeLine>
<Link id="l07661" /><CodeLine lineNumber="7661"><Highlight kind="normal">                         &amp;BestVPlan, OrigLoop-&gt;getParentLoop(),</Highlight></CodeLine>
<Link id="l07662" /><CodeLine lineNumber="7662"><Highlight kind="normal">                         Legal-&gt;getWidestInductionType());</Highlight></CodeLine>
<Link id="l07663" /><CodeLine lineNumber="7663"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07664" /><CodeLine lineNumber="7664"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifdef EXPENSIVE&#95;CHECKS</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07665" /><CodeLine lineNumber="7665"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(DT-&gt;verify(DominatorTree::VerificationLevel::Fast));</Highlight></CodeLine>
<Link id="l07666" /><CodeLine lineNumber="7666"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07667" /><CodeLine lineNumber="7667"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07668" /><CodeLine lineNumber="7668"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 0 Generate SCEV-dependent code in the entry, including TripCount, before</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07669" /><CodeLine lineNumber="7669"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// making any changes to the CFG.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07670" /><CodeLine lineNumber="7670"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#aeb3dd295f833ecc508d7586df94a76f3">empty</a>())</Highlight></CodeLine>
<Link id="l07671" /><CodeLine lineNumber="7671"><Highlight kind="normal">    BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a305d2f13922c7da4206b299861370a80">execute</a>(&amp;State);</Highlight></CodeLine>
<Link id="l07672" /><CodeLine lineNumber="7672"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07673" /><CodeLine lineNumber="7673"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696">getTripCount</a>())</Highlight></CodeLine>
<Link id="l07674" /><CodeLine lineNumber="7674"><Highlight kind="normal">    ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a9160ed9f749a9c4df711061181288e13">setTripCount</a>(State.get(BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a2f5fc19caa67daeca8a1316c7e055e3c">getTripCount</a>(), <a href="/docs/api/classes/llvm/vplane">VPLane</a>(0)));</Highlight></CodeLine>
<Link id="l07675" /><CodeLine lineNumber="7675"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07676" /><CodeLine lineNumber="7676"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VectorizingEpilogue &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;should only re-use the existing trip &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07677" /><CodeLine lineNumber="7677"><Highlight kind="normal">                                  </Highlight><Highlight kind="stringliteral">&quot;count during epilogue vectorization&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07678" /><CodeLine lineNumber="7678"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07679" /><CodeLine lineNumber="7679"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 1 Set up the skeleton for vectorization, including vector pre-header and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07680" /><CodeLine lineNumber="7680"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// middle block. The vector loop is created during VPlan execution.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07681" /><CodeLine lineNumber="7681"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VectorPH =</Highlight></CodeLine>
<Link id="l07682" /><CodeLine lineNumber="7682"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>());</Highlight></CodeLine>
<Link id="l07683" /><CodeLine lineNumber="7683"><Highlight kind="normal">  State.CFG.PrevBB = ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a31f933a6eada9926c9e320db27dfb775">createVectorizedLoopSkeleton</a>(</Highlight></CodeLine>
<Link id="l07684" /><CodeLine lineNumber="7684"><Highlight kind="normal">      ExpandedSCEVs ? &#42;ExpandedSCEVs : State.ExpandedSCEVs);</Highlight></CodeLine>
<Link id="l07685" /><CodeLine lineNumber="7685"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VectorizingEpilogue)</Highlight></CodeLine>
<Link id="l07686" /><CodeLine lineNumber="7686"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/vplantransforms/#aaca9dd97d4c523d8c65274654abe4eb9">VPlanTransforms::removeDeadRecipes</a>(BestVPlan);</Highlight></CodeLine>
<Link id="l07687" /><CodeLine lineNumber="7687"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07688" /><CodeLine lineNumber="7688"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Only use noalias metadata when using memory checks guaranteeing no overlap</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07689" /><CodeLine lineNumber="7689"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// across all iterations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07690" /><CodeLine lineNumber="7690"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopaccessinfo">LoopAccessInfo</a> &#42;LAI = ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a6bb946cd99f8c37f0145265914aea778">Legal</a>-&gt;<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab5632546144c4db5bbe1f975aeebd9d2">getLAI</a>();</Highlight></CodeLine>
<Link id="l07691" /><CodeLine lineNumber="7691"><Highlight kind="normal">  std::unique&#95;ptr&lt;LoopVersioning&gt; LVer = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07692" /><CodeLine lineNumber="7692"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LAI &amp;&amp; !LAI-&gt;<a href="/docs/api/classes/llvm/loopaccessinfo/#a3aedf5694dc5b1e81a79658b126a9b43">getRuntimePointerChecking</a>()-&gt;<a href="/docs/api/classes/llvm/runtimepointerchecking/#ac837a7d2828c8fe9e84140095d003d51">getChecks</a>().<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l07693" /><CodeLine lineNumber="7693"><Highlight kind="normal">      !LAI-&gt;<a href="/docs/api/classes/llvm/loopaccessinfo/#a3aedf5694dc5b1e81a79658b126a9b43">getRuntimePointerChecking</a>()-&gt;<a href="/docs/api/classes/llvm/runtimepointerchecking/#a741849368bb652fdaba99d70c36b527f">getDiffChecks</a>()) &#123;</Highlight></CodeLine>
<Link id="l07694" /><CodeLine lineNumber="7694"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07695" /><CodeLine lineNumber="7695"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  We currently don&#39;t use LoopVersioning for the actual loop cloning but we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07696" /><CodeLine lineNumber="7696"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  still use it to add the noalias metadata.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07697" /><CodeLine lineNumber="7697"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  TODO: Find a better way to re-use LoopVersioning functionality to add</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07698" /><CodeLine lineNumber="7698"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//        metadata.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07699" /><CodeLine lineNumber="7699"><Highlight kind="normal">    LVer = std::make&#95;unique&lt;LoopVersioning&gt;(</Highlight></CodeLine>
<Link id="l07700" /><CodeLine lineNumber="7700"><Highlight kind="normal">        &#42;LAI, LAI-&gt;<a href="/docs/api/classes/llvm/loopaccessinfo/#a3aedf5694dc5b1e81a79658b126a9b43">getRuntimePointerChecking</a>()-&gt;<a href="/docs/api/classes/llvm/runtimepointerchecking/#ac837a7d2828c8fe9e84140095d003d51">getChecks</a>(), OrigLoop, LI, DT,</Highlight></CodeLine>
<Link id="l07701" /><CodeLine lineNumber="7701"><Highlight kind="normal">        PSE.getSE());</Highlight></CodeLine>
<Link id="l07702" /><CodeLine lineNumber="7702"><Highlight kind="normal">    State.LVer = &amp;&#42;LVer;</Highlight></CodeLine>
<Link id="l07703" /><CodeLine lineNumber="7703"><Highlight kind="normal">    State.LVer-&gt;prepareNoAliasMetadata();</Highlight></CodeLine>
<Link id="l07704" /><CodeLine lineNumber="7704"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07705" /><CodeLine lineNumber="7705"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07706" /><CodeLine lineNumber="7706"><Highlight kind="normal">  ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a00579d597c88e5f3c51754bcd9ec5658">printDebugTracesAtStart</a>();</Highlight></CodeLine>
<Link id="l07707" /><CodeLine lineNumber="7707"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07708" /><CodeLine lineNumber="7708"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//===------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07709" /><CodeLine lineNumber="7709"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07710" /><CodeLine lineNumber="7710"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Notice: any optimization or new instruction that go</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07711" /><CodeLine lineNumber="7711"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// into the code below should also be implemented in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07712" /><CodeLine lineNumber="7712"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the cost-model.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07713" /><CodeLine lineNumber="7713"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07714" /><CodeLine lineNumber="7714"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//===------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07715" /><CodeLine lineNumber="7715"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07716" /><CodeLine lineNumber="7716"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 2 Copy and widen instructions from the old loop into the new loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07717" /><CodeLine lineNumber="7717"><Highlight kind="normal">  BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a143bc5faeb35f7363570e97bccf76e53">prepareToExecute</a>(</Highlight></CodeLine>
<Link id="l07718" /><CodeLine lineNumber="7718"><Highlight kind="normal">      ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696">getTripCount</a>(),</Highlight></CodeLine>
<Link id="l07719" /><CodeLine lineNumber="7719"><Highlight kind="normal">      ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#aa83b181aa14d5afe1390faad388f91a4">getOrCreateVectorTripCount</a>(ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>), State);</Highlight></CodeLine>
<Link id="l07720" /><CodeLine lineNumber="7720"><Highlight kind="normal">  <a href="#a3a8743a69fac5e7fa9c2b02604b2cf2f">replaceVPBBWithIRVPBB</a>(VectorPH, State.CFG.PrevBB);</Highlight></CodeLine>
<Link id="l07721" /><CodeLine lineNumber="7721"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07722" /><CodeLine lineNumber="7722"><Highlight kind="normal">  BestVPlan.<a href="/docs/api/classes/llvm/vplan/#ad80b94848142a7c633976aff96d4c408">execute</a>(&amp;State);</Highlight></CodeLine>
<Link id="l07723" /><CodeLine lineNumber="7723"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07724" /><CodeLine lineNumber="7724"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MiddleVPBB = BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>();</Highlight></CodeLine>
<Link id="l07725" /><CodeLine lineNumber="7725"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 2.5 When vectorizing the epilogue, fix reduction and induction resume</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07726" /><CodeLine lineNumber="7726"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// values from the additional bypass block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07727" /><CodeLine lineNumber="7727"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VectorizingEpilogue) &#123;</Highlight></CodeLine>
<Link id="l07728" /><CodeLine lineNumber="7728"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a6bb946cd99f8c37f0145265914aea778">Legal</a>-&gt;<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab22ff9e23f7f27234c8f6ec76db0c1f3">hasUncountableEarlyExit</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l07729" /><CodeLine lineNumber="7729"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Epilogue vectorisation not yet supported with early exits&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07730" /><CodeLine lineNumber="7730"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BypassBlock = ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a8f2e87f456c35fdad0ec24e7c71a92a5">getAdditionalBypassBlock</a>();</Highlight></CodeLine>
<Link id="l07731" /><CodeLine lineNumber="7731"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : &#42;MiddleVPBB) &#123;</Highlight></CodeLine>
<Link id="l07732" /><CodeLine lineNumber="7732"><Highlight kind="normal">      <a href="#a90ad8ccd396152c749068f986f2b751a">fixReductionScalarResumeWhenVectorizingEpilog</a>(</Highlight></CodeLine>
<Link id="l07733" /><CodeLine lineNumber="7733"><Highlight kind="normal">          &amp;R, State, State.CFG.VPBB2IRBB&#91;MiddleVPBB&#93;, BypassBlock);</Highlight></CodeLine>
<Link id="l07734" /><CodeLine lineNumber="7734"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07735" /><CodeLine lineNumber="7735"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PH = OrigLoop-&gt;getLoopPreheader();</Highlight></CodeLine>
<Link id="l07736" /><CodeLine lineNumber="7736"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;IVPhi, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>&#93; : Legal-&gt;getInductionVars()) &#123;</Highlight></CodeLine>
<Link id="l07737" /><CodeLine lineNumber="7737"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Inc = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(IVPhi-&gt;getIncomingValueForBlock(PH));</Highlight></CodeLine>
<Link id="l07738" /><CodeLine lineNumber="7738"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a86acbbb5785d46e5a10d2ed34c779dd9">getInductionAdditionalBypassValue</a>(IVPhi);</Highlight></CodeLine>
<Link id="l07739" /><CodeLine lineNumber="7739"><Highlight kind="normal">      Inc-&gt;setIncomingValueForBlock(BypassBlock, V);</Highlight></CodeLine>
<Link id="l07740" /><CodeLine lineNumber="7740"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07741" /><CodeLine lineNumber="7741"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07742" /><CodeLine lineNumber="7742"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07743" /><CodeLine lineNumber="7743"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 2.6. Maintain Loop Hints</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07744" /><CodeLine lineNumber="7744"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Keep all loop hints from the original loop on the vector loop (we&#39;ll</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07745" /><CodeLine lineNumber="7745"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// replace the vectorizer-specific hints below).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07746" /><CodeLine lineNumber="7746"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LoopRegion = BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()) &#123;</Highlight></CodeLine>
<Link id="l07747" /><CodeLine lineNumber="7747"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;OrigLoopID = OrigLoop-&gt;getLoopID();</Highlight></CodeLine>
<Link id="l07748" /><CodeLine lineNumber="7748"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07749" /><CodeLine lineNumber="7749"><Highlight kind="normal">    std::optional&lt;MDNode &#42;&gt; VectorizedLoopID =</Highlight></CodeLine>
<Link id="l07750" /><CodeLine lineNumber="7750"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a368216c9c116e3f30d8dd352ce1370fc">makeFollowupLoopID</a>(OrigLoopID, &#123;<a href="#a3bf55ccbbeedcfb8cd2a1bd62c0ad91a">LLVMLoopVectorizeFollowupAll</a>,</Highlight></CodeLine>
<Link id="l07751" /><CodeLine lineNumber="7751"><Highlight kind="normal">                                        <a href="#a99050b417d193e1cc1117e5bbd4bfbce">LLVMLoopVectorizeFollowupVectorized</a>&#125;);</Highlight></CodeLine>
<Link id="l07752" /><CodeLine lineNumber="7752"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07753" /><CodeLine lineNumber="7753"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;HeaderVPBB = LoopRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</Highlight></CodeLine>
<Link id="l07754" /><CodeLine lineNumber="7754"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = LI-&gt;getLoopFor(State.CFG.VPBB2IRBB&#91;HeaderVPBB&#93;);</Highlight></CodeLine>
<Link id="l07755" /><CodeLine lineNumber="7755"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VectorizedLoopID) &#123;</Highlight></CodeLine>
<Link id="l07756" /><CodeLine lineNumber="7756"><Highlight kind="normal">      L-&gt;setLoopID(&#42;VectorizedLoopID);</Highlight></CodeLine>
<Link id="l07757" /><CodeLine lineNumber="7757"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l07758" /><CodeLine lineNumber="7758"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Keep all loop hints from the original loop on the vector loop (we&#39;ll</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07759" /><CodeLine lineNumber="7759"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// replace the vectorizer-specific hints below).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07760" /><CodeLine lineNumber="7760"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;LID = OrigLoop-&gt;getLoopID())</Highlight></CodeLine>
<Link id="l07761" /><CodeLine lineNumber="7761"><Highlight kind="normal">        L-&gt;setLoopID(LID);</Highlight></CodeLine>
<Link id="l07762" /><CodeLine lineNumber="7762"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07763" /><CodeLine lineNumber="7763"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> Hints(L, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, &#42;ORE);</Highlight></CodeLine>
<Link id="l07764" /><CodeLine lineNumber="7764"><Highlight kind="normal">      Hints.setAlreadyVectorized();</Highlight></CodeLine>
<Link id="l07765" /><CodeLine lineNumber="7765"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07766" /><CodeLine lineNumber="7766"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences">TargetTransformInfo::UnrollingPreferences</a> UP;</Highlight></CodeLine>
<Link id="l07767" /><CodeLine lineNumber="7767"><Highlight kind="normal">    TTI.getUnrollingPreferences(L, &#42;PSE.getSE(), UP, ORE);</Highlight></CodeLine>
<Link id="l07768" /><CodeLine lineNumber="7768"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UP.<a href="/docs/api/structs/llvm/targettransforminfo/unrollingpreferences/#a5d4cb9fb552657b2138b925b44315d21">UnrollVectorizedLoop</a> || VectorizingEpilogue)</Highlight></CodeLine>
<Link id="l07769" /><CodeLine lineNumber="7769"><Highlight kind="normal">      <a href="#a033bb363914fbd3c2cd990330959036c">addRuntimeUnrollDisableMetaData</a>(L);</Highlight></CodeLine>
<Link id="l07770" /><CodeLine lineNumber="7770"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07771" /><CodeLine lineNumber="7771"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07772" /><CodeLine lineNumber="7772"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 3 Fix the vectorized code: take care of header phi&#39;s, live-outs,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07773" /><CodeLine lineNumber="7773"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    predication, updating analyses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07774" /><CodeLine lineNumber="7774"><Highlight kind="normal">  ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a9484786140efebf774cde8f072894246">fixVectorizedLoop</a>(State);</Highlight></CodeLine>
<Link id="l07775" /><CodeLine lineNumber="7775"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07776" /><CodeLine lineNumber="7776"><Highlight kind="normal">  ILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a9e275f16680d4f09dbcc0dd7d323a075">printDebugTracesAtEnd</a>();</Highlight></CodeLine>
<Link id="l07777" /><CodeLine lineNumber="7777"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07778" /><CodeLine lineNumber="7778"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 4 Adjust branch weight of the branch in the middle block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07779" /><CodeLine lineNumber="7779"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()) &#123;</Highlight></CodeLine>
<Link id="l07780" /><CodeLine lineNumber="7780"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MiddleVPBB = BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>();</Highlight></CodeLine>
<Link id="l07781" /><CodeLine lineNumber="7781"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MiddleTerm =</Highlight></CodeLine>
<Link id="l07782" /><CodeLine lineNumber="7782"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;BranchInst&gt;</a>(State.CFG.VPBB2IRBB&#91;MiddleVPBB&#93;-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l07783" /><CodeLine lineNumber="7783"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MiddleTerm-&gt;isConditional() &amp;&amp;</Highlight></CodeLine>
<Link id="l07784" /><CodeLine lineNumber="7784"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;OrigLoop-&gt;getLoopLatch()-&gt;getTerminator())) &#123;</Highlight></CodeLine>
<Link id="l07785" /><CodeLine lineNumber="7785"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Assume that &#96;Count % VectorTripCount&#96; is equally distributed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07786" /><CodeLine lineNumber="7786"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> TripCount = BestVPlan.<a href="/docs/api/classes/llvm/vplan/#a532045d23e6f3efd21732fd342f99f09">getUF</a>() &#42; State.VF.getKnownMinValue();</Highlight></CodeLine>
<Link id="l07787" /><CodeLine lineNumber="7787"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(TripCount &gt; 0 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;trip count should not be zero&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07788" /><CodeLine lineNumber="7788"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> uint32&#95;t Weights&#91;&#93; = &#123;1, TripCount - 1&#125;;</Highlight></CodeLine>
<Link id="l07789" /><CodeLine lineNumber="7789"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(&#42;MiddleTerm, Weights, </Highlight><Highlight kind="comment">/&#42;IsExpected=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07790" /><CodeLine lineNumber="7790"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l07791" /><CodeLine lineNumber="7791"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07792" /><CodeLine lineNumber="7792"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07793" /><CodeLine lineNumber="7793"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> State.ExpandedSCEVs;</Highlight></CodeLine>
<Link id="l07794" /><CodeLine lineNumber="7794"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07795" /><CodeLine lineNumber="7795"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07796" /><CodeLine lineNumber="7796"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===--------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07797" /><CodeLine lineNumber="7797"><Highlight kind="normal"></Highlight><Highlight kind="comment">// EpilogueVectorizerMainLoop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07798" /><CodeLine lineNumber="7798"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===--------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07799" /><CodeLine lineNumber="7799"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07800" /><CodeLine lineNumber="7800"><Highlight kind="comment">/// This function is partially responsible for generating the control flow</Highlight></CodeLine>
<Link id="l07801" /><CodeLine lineNumber="7801"><Highlight kind="comment">/// depicted in https://llvm.org/docs/Vectorizers.html#epilogue-vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07802" /><CodeLine lineNumber="7802" lineLink="/docs/api/classes/llvm/epiloguevectorizermainloop/#aa8b67f13fbf902634ecd95060a1cd85f"><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aa8b67f13fbf902634ecd95060a1cd85f">EpilogueVectorizerMainLoop::createEpilogueVectorizedLoopSkeleton</a>(</Highlight></CodeLine>
<Link id="l07803" /><CodeLine lineNumber="7803"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SCEV2ValueTy &amp;ExpandedSCEVs) &#123;</Highlight></CodeLine>
<Link id="l07804" /><CodeLine lineNumber="7804"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5e719da4709193fd5b4632da4bc69795">createVectorLoopSkeleton</a>(</Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07805" /><CodeLine lineNumber="7805"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07806" /><CodeLine lineNumber="7806"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Generate the code to check the minimum iteration count of the vector</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07807" /><CodeLine lineNumber="7807"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// epilogue (see below).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07808" /><CodeLine lineNumber="7808"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueIterationCountCheck =</Highlight></CodeLine>
<Link id="l07809" /><CodeLine lineNumber="7809"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aeeb47f904372b9e25b9f7ba606158b25">emitIterationCountCheck</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07810" /><CodeLine lineNumber="7810"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueIterationCountCheck-&gt;setName(</Highlight><Highlight kind="stringliteral">&quot;iter.check&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07811" /><CodeLine lineNumber="7811"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07812" /><CodeLine lineNumber="7812"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Generate the code to check any assumptions that we&#39;ve made for SCEV</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07813" /><CodeLine lineNumber="7813"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// expressions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07814" /><CodeLine lineNumber="7814"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.SCEVSafetyCheck = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a30c4bcea7beb42c7eb075a578bc3bc3e">emitSCEVChecks</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</Highlight></CodeLine>
<Link id="l07815" /><CodeLine lineNumber="7815"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07816" /><CodeLine lineNumber="7816"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Generate the code that checks at runtime if arrays overlap. We put the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07817" /><CodeLine lineNumber="7817"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// checks into a separate block to make the more common case of few elements</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07818" /><CodeLine lineNumber="7818"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// faster.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07819" /><CodeLine lineNumber="7819"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MemSafetyCheck = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a625caa931f0d8ef201041febbfe42cca">emitMemRuntimeChecks</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</Highlight></CodeLine>
<Link id="l07820" /><CodeLine lineNumber="7820"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07821" /><CodeLine lineNumber="7821"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Generate the iteration count check for the main loop, &#42;after&#42; the check</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07822" /><CodeLine lineNumber="7822"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// for the epilogue loop, so that the path-length is shorter for the case</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07823" /><CodeLine lineNumber="7823"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that goes directly through the vector epilogue. The longer-path length for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07824" /><CodeLine lineNumber="7824"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the main loop is compensated for, by the gain from vectorizing the larger</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07825" /><CodeLine lineNumber="7825"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// trip count. Note: the branch will get updated later on when we vectorize</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07826" /><CodeLine lineNumber="7826"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the epilogue.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07827" /><CodeLine lineNumber="7827"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopIterationCountCheck =</Highlight></CodeLine>
<Link id="l07828" /><CodeLine lineNumber="7828"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aeeb47f904372b9e25b9f7ba606158b25">emitIterationCountCheck</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07829" /><CodeLine lineNumber="7829"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07830" /><CodeLine lineNumber="7830"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Generate the induction variable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07831" /><CodeLine lineNumber="7831"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.VectorTripCount = <a href="/docs/api/classes/llvm/innerloopvectorizer/#aa83b181aa14d5afe1390faad388f91a4">getOrCreateVectorTripCount</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>);</Highlight></CodeLine>
<Link id="l07832" /><CodeLine lineNumber="7832"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07833" /><CodeLine lineNumber="7833"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>;</Highlight></CodeLine>
<Link id="l07834" /><CodeLine lineNumber="7834"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07835" /><CodeLine lineNumber="7835"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07836" /><CodeLine lineNumber="7836" lineLink="/docs/api/classes/llvm/epiloguevectorizermainloop/#aad9eb57dcbd9a2c3fd1993685783d7f7"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aad9eb57dcbd9a2c3fd1993685783d7f7">EpilogueVectorizerMainLoop::printDebugTracesAtStart</a>() &#123;</Highlight></CodeLine>
<Link id="l07837" /><CodeLine lineNumber="7837"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</Highlight></CodeLine>
<Link id="l07838" /><CodeLine lineNumber="7838"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Create Skeleton for epilogue vectorized loop (first pass)\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07839" /><CodeLine lineNumber="7839"><Highlight kind="normal">           &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Main Loop VF:&quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopVF</Highlight></CodeLine>
<Link id="l07840" /><CodeLine lineNumber="7840"><Highlight kind="normal">           &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;, Main Loop UF:&quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopUF</Highlight></CodeLine>
<Link id="l07841" /><CodeLine lineNumber="7841"><Highlight kind="normal">           &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;, Epilogue Loop VF:&quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueVF</Highlight></CodeLine>
<Link id="l07842" /><CodeLine lineNumber="7842"><Highlight kind="normal">           &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;, Epilogue Loop UF:&quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueUF &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07843" /><CodeLine lineNumber="7843"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l07844" /><CodeLine lineNumber="7844"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07845" /><CodeLine lineNumber="7845"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07846" /><CodeLine lineNumber="7846" lineLink="/docs/api/classes/llvm/epiloguevectorizermainloop/#a87a0c8bda4e9e23e896e46d0a2208c17"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#a87a0c8bda4e9e23e896e46d0a2208c17">EpilogueVectorizerMainLoop::printDebugTracesAtEnd</a>() &#123;</Highlight></CodeLine>
<Link id="l07847" /><CodeLine lineNumber="7847"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a3fcdc9f30e5e8b9ea4da99868a8ae4a9">DEBUG&#95;WITH&#95;TYPE</a>(<a href="/docs/api/files/lib/lib/analysis/loopnestanalysis-cpp/#ab3595005ef7c117f30d4c18201190bbb">VerboseDebug</a>, &#123;</Highlight></CodeLine>
<Link id="l07848" /><CodeLine lineNumber="7848"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;intermediate fn:\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07849" /><CodeLine lineNumber="7849"><Highlight kind="normal">           &lt;&lt; &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getHeader()-&gt;getParent() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07850" /><CodeLine lineNumber="7850"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l07851" /><CodeLine lineNumber="7851"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07852" /><CodeLine lineNumber="7852"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07853" /><CodeLine lineNumber="7853"><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l07854" /><CodeLine lineNumber="7854" lineLink="/docs/api/classes/llvm/epiloguevectorizermainloop/#aeeb47f904372b9e25b9f7ba606158b25"><Highlight kind="normal"><a href="/docs/api/classes/llvm/epiloguevectorizermainloop/#aeeb47f904372b9e25b9f7ba606158b25">EpilogueVectorizerMainLoop::emitIterationCountCheck</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass,</Highlight></CodeLine>
<Link id="l07855" /><CodeLine lineNumber="7855"><Highlight kind="normal">                                                    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ForEpilogue) &#123;</Highlight></CodeLine>
<Link id="l07856" /><CodeLine lineNumber="7856"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Bypass &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Expected valid bypass basic block.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07857" /><CodeLine lineNumber="7857"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VFactor = ForEpilogue ? <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueVF : <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>;</Highlight></CodeLine>
<Link id="l07858" /><CodeLine lineNumber="7858"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> UFactor = ForEpilogue ? <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueUF : <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a>;</Highlight></CodeLine>
<Link id="l07859" /><CodeLine lineNumber="7859"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696">getTripCount</a>();</Highlight></CodeLine>
<Link id="l07860" /><CodeLine lineNumber="7860"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Reuse existing vector loop preheader for TC checks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07861" /><CodeLine lineNumber="7861"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note that new preheader block is generated for vector loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07862" /><CodeLine lineNumber="7862"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> TCCheckBlock = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>;</Highlight></CodeLine>
<Link id="l07863" /><CodeLine lineNumber="7863"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>(TCCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>());</Highlight></CodeLine>
<Link id="l07864" /><CodeLine lineNumber="7864"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07865" /><CodeLine lineNumber="7865"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Generate code to check if the loop&#39;s trip count is less than VF &#42; UF of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07866" /><CodeLine lineNumber="7866"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// main vector loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07867" /><CodeLine lineNumber="7867"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>-&gt;requiresScalarEpilogue(ForEpilogue ? <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueVF.isVector()</Highlight></CodeLine>
<Link id="l07868" /><CodeLine lineNumber="7868"><Highlight kind="normal">                                                    : <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.isVector())</Highlight></CodeLine>
<Link id="l07869" /><CodeLine lineNumber="7869"><Highlight kind="normal">               ? <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">ICmpInst::ICMP&#95;ULE</a></Highlight></CodeLine>
<Link id="l07870" /><CodeLine lineNumber="7870"><Highlight kind="normal">               : <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>;</Highlight></CodeLine>
<Link id="l07871" /><CodeLine lineNumber="7871"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07872" /><CodeLine lineNumber="7872"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CheckMinIters = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateICmp(</Highlight></CodeLine>
<Link id="l07873" /><CodeLine lineNumber="7873"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>, <a href="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e">createStepForVF</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>, <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>-&gt;getType(), VFactor, UFactor),</Highlight></CodeLine>
<Link id="l07874" /><CodeLine lineNumber="7874"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;min.iters.check&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07875" /><CodeLine lineNumber="7875"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07876" /><CodeLine lineNumber="7876"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ForEpilogue)</Highlight></CodeLine>
<Link id="l07877" /><CodeLine lineNumber="7877"><Highlight kind="normal">    TCCheckBlock-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(</Highlight><Highlight kind="stringliteral">&quot;vector.main.loop.iter.check&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07878" /><CodeLine lineNumber="7878"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07879" /><CodeLine lineNumber="7879"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create new preheader for vector loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07880" /><CodeLine lineNumber="7880"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a> = <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(TCCheckBlock, TCCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(),</Highlight></CodeLine>
<Link id="l07881" /><CodeLine lineNumber="7881"><Highlight kind="normal">                                   <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="stringliteral">&quot;vector.ph&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07882" /><CodeLine lineNumber="7882"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07883" /><CodeLine lineNumber="7883"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ForEpilogue) &#123;</Highlight></CodeLine>
<Link id="l07884" /><CodeLine lineNumber="7884"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;properlyDominates(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;getNode(TCCheckBlock),</Highlight></CodeLine>
<Link id="l07885" /><CodeLine lineNumber="7885"><Highlight kind="normal">                                 <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;getNode(Bypass)-&gt;getIDom()) &amp;&amp;</Highlight></CodeLine>
<Link id="l07886" /><CodeLine lineNumber="7886"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;TC check is expected to dominate Bypass&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07887" /><CodeLine lineNumber="7887"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07888" /><CodeLine lineNumber="7888"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(TCCheckBlock);</Highlight></CodeLine>
<Link id="l07889" /><CodeLine lineNumber="7889"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07890" /><CodeLine lineNumber="7890"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Save the trip count so we don&#39;t have to regenerate it in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07891" /><CodeLine lineNumber="7891"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// vec.epilog.iter.check. This is safe to do because the trip count</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07892" /><CodeLine lineNumber="7892"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// generated here dominates the vector epilog iter check.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07893" /><CodeLine lineNumber="7893"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.TripCount = <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>;</Highlight></CodeLine>
<Link id="l07894" /><CodeLine lineNumber="7894"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07895" /><CodeLine lineNumber="7895"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07896" /><CodeLine lineNumber="7896"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &amp;BI =</Highlight></CodeLine>
<Link id="l07897" /><CodeLine lineNumber="7897"><Highlight kind="normal">      &#42;<a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(Bypass, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>, CheckMinIters);</Highlight></CodeLine>
<Link id="l07898" /><CodeLine lineNumber="7898"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getLoopLatch()-&gt;getTerminator()))</Highlight></CodeLine>
<Link id="l07899" /><CodeLine lineNumber="7899"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(BI, <a href="#a629884e9a99a9f49106db9e5e6252fcb">MinItersBypassWeights</a>, </Highlight><Highlight kind="comment">/&#42;IsExpected=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07900" /><CodeLine lineNumber="7900"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a016a85f7487f995fe80141e102a7a5ae">ReplaceInstWithInst</a>(TCCheckBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>(), &amp;BI);</Highlight></CodeLine>
<Link id="l07901" /><CodeLine lineNumber="7901"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07902" /><CodeLine lineNumber="7902"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9">introduceCheckBlockInVPlan</a>(TCCheckBlock);</Highlight></CodeLine>
<Link id="l07903" /><CodeLine lineNumber="7903"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> TCCheckBlock;</Highlight></CodeLine>
<Link id="l07904" /><CodeLine lineNumber="7904"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07905" /><CodeLine lineNumber="7905"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07906" /><CodeLine lineNumber="7906"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===--------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07907" /><CodeLine lineNumber="7907"><Highlight kind="normal"></Highlight><Highlight kind="comment">// EpilogueVectorizerEpilogueLoop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07908" /><CodeLine lineNumber="7908"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===--------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07909" /><CodeLine lineNumber="7909"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l07910" /><CodeLine lineNumber="7910"><Highlight kind="comment">/// This function is partially responsible for generating the control flow</Highlight></CodeLine>
<Link id="l07911" /><CodeLine lineNumber="7911"><Highlight kind="comment">/// depicted in https://llvm.org/docs/Vectorizers.html#epilogue-vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07912" /><CodeLine lineNumber="7912"><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l07913" /><CodeLine lineNumber="7913" lineLink="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#ad1b4c0caba0fac3a1486890cd2445040"><Highlight kind="normal"><a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#ad1b4c0caba0fac3a1486890cd2445040">EpilogueVectorizerEpilogueLoop::createEpilogueVectorizedLoopSkeleton</a>(</Highlight></CodeLine>
<Link id="l07914" /><CodeLine lineNumber="7914"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SCEV2ValueTy &amp;ExpandedSCEVs) &#123;</Highlight></CodeLine>
<Link id="l07915" /><CodeLine lineNumber="7915"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5e719da4709193fd5b4632da4bc69795">createVectorLoopSkeleton</a>(</Highlight><Highlight kind="stringliteral">&quot;vec.epilog.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07916" /><CodeLine lineNumber="7916"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07917" /><CodeLine lineNumber="7917"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now, compare the remaining count and if there aren&#39;t enough iterations to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07918" /><CodeLine lineNumber="7918"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// execute the vectorized epilogue skip to the scalar part.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07919" /><CodeLine lineNumber="7919"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>-&gt;setName(</Highlight><Highlight kind="stringliteral">&quot;vec.epilog.ph&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07920" /><CodeLine lineNumber="7920"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;VecEpilogueIterationCountCheck =</Highlight></CodeLine>
<Link id="l07921" /><CodeLine lineNumber="7921"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>-&gt;begin(), <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7d4ba65978a0ecb42764cb2b25edc071">LI</a>,</Highlight></CodeLine>
<Link id="l07922" /><CodeLine lineNumber="7922"><Highlight kind="normal">                 </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="stringliteral">&quot;vec.epilog.iter.check&quot;</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07923" /><CodeLine lineNumber="7923"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a04c0081718b0f5113134aa563e1a56ca">emitMinimumVectorEpilogueIterCountCheck</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>,</Highlight></CodeLine>
<Link id="l07924" /><CodeLine lineNumber="7924"><Highlight kind="normal">                                          VecEpilogueIterationCountCheck);</Highlight></CodeLine>
<Link id="l07925" /><CodeLine lineNumber="7925"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a329ce2a6185c5e632406d1d2fc75610e">AdditionalBypassBlock</a> = VecEpilogueIterationCountCheck;</Highlight></CodeLine>
<Link id="l07926" /><CodeLine lineNumber="7926"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07927" /><CodeLine lineNumber="7927"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Adjust the control flow taking the state info from the main loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07928" /><CodeLine lineNumber="7928"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vectorization into account.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07929" /><CodeLine lineNumber="7929"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopIterationCountCheck &amp;&amp; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueIterationCountCheck &amp;&amp;</Highlight></CodeLine>
<Link id="l07930" /><CodeLine lineNumber="7930"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;expected this to be saved from the previous pass.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07931" /><CodeLine lineNumber="7931"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MainLoopIterationCountCheck-&gt;getTerminator()-&gt;replaceUsesOfWith(</Highlight></CodeLine>
<Link id="l07932" /><CodeLine lineNumber="7932"><Highlight kind="normal">      VecEpilogueIterationCountCheck, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>);</Highlight></CodeLine>
<Link id="l07933" /><CodeLine lineNumber="7933"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07934" /><CodeLine lineNumber="7934"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueIterationCountCheck-&gt;getTerminator()-&gt;replaceUsesOfWith(</Highlight></CodeLine>
<Link id="l07935" /><CodeLine lineNumber="7935"><Highlight kind="normal">      VecEpilogueIterationCountCheck, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</Highlight></CodeLine>
<Link id="l07936" /><CodeLine lineNumber="7936"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07937" /><CodeLine lineNumber="7937"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.SCEVSafetyCheck)</Highlight></CodeLine>
<Link id="l07938" /><CodeLine lineNumber="7938"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.SCEVSafetyCheck-&gt;getTerminator()-&gt;replaceUsesOfWith(</Highlight></CodeLine>
<Link id="l07939" /><CodeLine lineNumber="7939"><Highlight kind="normal">        VecEpilogueIterationCountCheck, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</Highlight></CodeLine>
<Link id="l07940" /><CodeLine lineNumber="7940"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MemSafetyCheck)</Highlight></CodeLine>
<Link id="l07941" /><CodeLine lineNumber="7941"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MemSafetyCheck-&gt;getTerminator()-&gt;replaceUsesOfWith(</Highlight></CodeLine>
<Link id="l07942" /><CodeLine lineNumber="7942"><Highlight kind="normal">        VecEpilogueIterationCountCheck, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>);</Highlight></CodeLine>
<Link id="l07943" /><CodeLine lineNumber="7943"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07944" /><CodeLine lineNumber="7944"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;changeImmediateDominator(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a68ebc27127cd32d3fa276621fb69342b">LoopScalarPreHeader</a>,</Highlight></CodeLine>
<Link id="l07945" /><CodeLine lineNumber="7945"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueIterationCountCheck);</Highlight></CodeLine>
<Link id="l07946" /><CodeLine lineNumber="7946"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Keep track of bypass blocks, as they feed start values to the induction and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07947" /><CodeLine lineNumber="7947"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reduction phis in the scalar loop preheader.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07948" /><CodeLine lineNumber="7948"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.SCEVSafetyCheck)</Highlight></CodeLine>
<Link id="l07949" /><CodeLine lineNumber="7949"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.SCEVSafetyCheck);</Highlight></CodeLine>
<Link id="l07950" /><CodeLine lineNumber="7950"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MemSafetyCheck)</Highlight></CodeLine>
<Link id="l07951" /><CodeLine lineNumber="7951"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MemSafetyCheck);</Highlight></CodeLine>
<Link id="l07952" /><CodeLine lineNumber="7952"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueIterationCountCheck);</Highlight></CodeLine>
<Link id="l07953" /><CodeLine lineNumber="7953"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07954" /><CodeLine lineNumber="7954"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The vec.epilog.iter.check block may contain Phi nodes from inductions or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07955" /><CodeLine lineNumber="7955"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reductions which merge control-flow from the latch block and the middle</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07956" /><CodeLine lineNumber="7956"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block. Update the incoming values here and move the Phi into the preheader.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07957" /><CodeLine lineNumber="7957"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;PHINode &#42;, 4&gt;</a> PhisInBlock;</Highlight></CodeLine>
<Link id="l07958" /><CodeLine lineNumber="7958"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;Phi : VecEpilogueIterationCountCheck-&gt;<a href="/docs/api/classes/llvm/basicblock/#a13da92d2694197fbcb5b95fd94e7570d">phis</a>())</Highlight></CodeLine>
<Link id="l07959" /><CodeLine lineNumber="7959"><Highlight kind="normal">    PhisInBlock.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;Phi);</Highlight></CodeLine>
<Link id="l07960" /><CodeLine lineNumber="7960"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07961" /><CodeLine lineNumber="7961"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi : PhisInBlock) &#123;</Highlight></CodeLine>
<Link id="l07962" /><CodeLine lineNumber="7962"><Highlight kind="normal">    Phi-&gt;moveBefore(<a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>-&gt;getFirstNonPHIIt());</Highlight></CodeLine>
<Link id="l07963" /><CodeLine lineNumber="7963"><Highlight kind="normal">    Phi-&gt;replaceIncomingBlockWith(</Highlight></CodeLine>
<Link id="l07964" /><CodeLine lineNumber="7964"><Highlight kind="normal">        VecEpilogueIterationCountCheck-&gt;<a href="/docs/api/classes/llvm/basicblock/#a59fb91d1691350f7d1b8e8a114e3f2a4">getSinglePredecessor</a>(),</Highlight></CodeLine>
<Link id="l07965" /><CodeLine lineNumber="7965"><Highlight kind="normal">        VecEpilogueIterationCountCheck);</Highlight></CodeLine>
<Link id="l07966" /><CodeLine lineNumber="7966"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07967" /><CodeLine lineNumber="7967"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the phi doesn&#39;t have an incoming value from the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07968" /><CodeLine lineNumber="7968"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// EpilogueIterationCountCheck, we are done. Otherwise remove the incoming</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07969" /><CodeLine lineNumber="7969"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// value and also those from other check blocks. This is needed for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07970" /><CodeLine lineNumber="7970"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// reduction phis only.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07971" /><CodeLine lineNumber="7971"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(Phi-&gt;blocks(), &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;IncB) &#123;</Highlight></CodeLine>
<Link id="l07972" /><CodeLine lineNumber="7972"><Highlight kind="normal">          return EPI.EpilogueIterationCountCheck == IncB;</Highlight></CodeLine>
<Link id="l07973" /><CodeLine lineNumber="7973"><Highlight kind="normal">        &#125;))</Highlight></CodeLine>
<Link id="l07974" /><CodeLine lineNumber="7974"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l07975" /><CodeLine lineNumber="7975"><Highlight kind="normal">    Phi-&gt;removeIncomingValue(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueIterationCountCheck);</Highlight></CodeLine>
<Link id="l07976" /><CodeLine lineNumber="7976"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.SCEVSafetyCheck)</Highlight></CodeLine>
<Link id="l07977" /><CodeLine lineNumber="7977"><Highlight kind="normal">      Phi-&gt;removeIncomingValue(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.SCEVSafetyCheck);</Highlight></CodeLine>
<Link id="l07978" /><CodeLine lineNumber="7978"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MemSafetyCheck)</Highlight></CodeLine>
<Link id="l07979" /><CodeLine lineNumber="7979"><Highlight kind="normal">      Phi-&gt;removeIncomingValue(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.MemSafetyCheck);</Highlight></CodeLine>
<Link id="l07980" /><CodeLine lineNumber="7980"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l07981" /><CodeLine lineNumber="7981"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07982" /><CodeLine lineNumber="7982"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Generate bypass values from the additional bypass block. Note that when the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07983" /><CodeLine lineNumber="7983"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vectorized epilogue is skipped due to iteration count check, then the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07984" /><CodeLine lineNumber="7984"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// resume value for the induction variable comes from the trip count of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07985" /><CodeLine lineNumber="7985"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// main vector loop, passed as the second argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07986" /><CodeLine lineNumber="7986"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a69c116deda6ae831a71558a4630323cb">createInductionAdditionalBypassValues</a>(ExpandedSCEVs, <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.VectorTripCount);</Highlight></CodeLine>
<Link id="l07987" /><CodeLine lineNumber="7987"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>;</Highlight></CodeLine>
<Link id="l07988" /><CodeLine lineNumber="7988"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l07989" /><CodeLine lineNumber="7989"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07990" /><CodeLine lineNumber="7990"><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l07991" /><CodeLine lineNumber="7991" lineLink="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a04c0081718b0f5113134aa563e1a56ca"><Highlight kind="normal"><a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a04c0081718b0f5113134aa563e1a56ca">EpilogueVectorizerEpilogueLoop::emitMinimumVectorEpilogueIterCountCheck</a>(</Highlight></CodeLine>
<Link id="l07992" /><CodeLine lineNumber="7992"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Bypass, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Insert) &#123;</Highlight></CodeLine>
<Link id="l07993" /><CodeLine lineNumber="7993"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l07994" /><CodeLine lineNumber="7994"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.TripCount &amp;&amp;</Highlight></CodeLine>
<Link id="l07995" /><CodeLine lineNumber="7995"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Expected trip count to have been saved in the first pass.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l07996" /><CodeLine lineNumber="7996"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l07997" /><CodeLine lineNumber="7997"><Highlight kind="normal">      (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.TripCount) ||</Highlight></CodeLine>
<Link id="l07998" /><CodeLine lineNumber="7998"><Highlight kind="normal">       <a href="/docs/api/classes/llvm/innerloopvectorizer/#a909bc9150f12c6ee1f276b2bb58508ff">DT</a>-&gt;dominates(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.TripCount)-&gt;getParent(), Insert)) &amp;&amp;</Highlight></CodeLine>
<Link id="l07999" /><CodeLine lineNumber="7999"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;saved trip count does not dominate insertion point.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08000" /><CodeLine lineNumber="8000"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;TC = <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.TripCount;</Highlight></CodeLine>
<Link id="l08001" /><CodeLine lineNumber="8001"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>(Insert-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l08002" /><CodeLine lineNumber="8002"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateSub(TC, <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.VectorTripCount, </Highlight><Highlight kind="stringliteral">&quot;n.vec.remaining&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08003" /><CodeLine lineNumber="8003"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08004" /><CodeLine lineNumber="8004"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Generate code to check if the loop&#39;s trip count is less than VF &#42; UF of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08005" /><CodeLine lineNumber="8005"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vector epilogue loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08006" /><CodeLine lineNumber="8006"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> = <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>-&gt;requiresScalarEpilogue(<a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueVF.isVector())</Highlight></CodeLine>
<Link id="l08007" /><CodeLine lineNumber="8007"><Highlight kind="normal">               ? <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">ICmpInst::ICMP&#95;ULE</a></Highlight></CodeLine>
<Link id="l08008" /><CodeLine lineNumber="8008"><Highlight kind="normal">               : <a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78ba91d86a4753c8bd7624e01bf565d87f8e">ICmpInst::ICMP&#95;ULT</a>;</Highlight></CodeLine>
<Link id="l08009" /><CodeLine lineNumber="8009"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08010" /><CodeLine lineNumber="8010"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;CheckMinIters =</Highlight></CodeLine>
<Link id="l08011" /><CodeLine lineNumber="8011"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>.CreateICmp(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>,</Highlight></CodeLine>
<Link id="l08012" /><CodeLine lineNumber="8012"><Highlight kind="normal">                         <a href="/docs/api/namespaces/llvm/#ac4156fb8bcc6a7e29ee021b01d22551e">createStepForVF</a>(<a href="/docs/api/classes/llvm/innerloopvectorizer/#ac3679e1fff2d21c2034c7ce14df24bf7">Builder</a>, <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>-&gt;getType(),</Highlight></CodeLine>
<Link id="l08013" /><CodeLine lineNumber="8013"><Highlight kind="normal">                                         <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueVF, <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueUF),</Highlight></CodeLine>
<Link id="l08014" /><CodeLine lineNumber="8014"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;min.epilog.iters.check&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08015" /><CodeLine lineNumber="8015"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08016" /><CodeLine lineNumber="8016"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &amp;BI =</Highlight></CodeLine>
<Link id="l08017" /><CodeLine lineNumber="8017"><Highlight kind="normal">      &#42;<a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(Bypass, <a href="/docs/api/classes/llvm/innerloopvectorizer/#a99d1430a4b51d71f77d78febb40f9d32">LoopVectorPreHeader</a>, CheckMinIters);</Highlight></CodeLine>
<Link id="l08018" /><CodeLine lineNumber="8018"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getLoopLatch()-&gt;getTerminator())) &#123;</Highlight></CodeLine>
<Link id="l08019" /><CodeLine lineNumber="8019"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> MainLoopStep = <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae1d8518bd0c514e739180737faf538be">UF</a> &#42; <a href="/docs/api/classes/llvm/innerloopvectorizer/#af3ab15d9c94890e913009977bae315ce">VF</a>.getKnownMinValue();</Highlight></CodeLine>
<Link id="l08020" /><CodeLine lineNumber="8020"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> EpilogueLoopStep =</Highlight></CodeLine>
<Link id="l08021" /><CodeLine lineNumber="8021"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueUF &#42; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueVF.getKnownMinValue();</Highlight></CodeLine>
<Link id="l08022" /><CodeLine lineNumber="8022"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We assume the remaining &#96;Count&#96; is equally distributed in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08023" /><CodeLine lineNumber="8023"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#91;0, MainLoopStep)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08024" /><CodeLine lineNumber="8024"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// So the probability for &#96;Count &lt; EpilogueLoopStep&#96; should be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08025" /><CodeLine lineNumber="8025"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// min(MainLoopStep, EpilogueLoopStep) / MainLoopStep</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08026" /><CodeLine lineNumber="8026"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> EstimatedSkipCount = std::min(MainLoopStep, EpilogueLoopStep);</Highlight></CodeLine>
<Link id="l08027" /><CodeLine lineNumber="8027"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> uint32&#95;t Weights&#91;&#93; = &#123;EstimatedSkipCount,</Highlight></CodeLine>
<Link id="l08028" /><CodeLine lineNumber="8028"><Highlight kind="normal">                                MainLoopStep - EstimatedSkipCount&#125;;</Highlight></CodeLine>
<Link id="l08029" /><CodeLine lineNumber="8029"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a6cf82c052d63a1b464be8e48ff38c48e">setBranchWeights</a>(BI, Weights, </Highlight><Highlight kind="comment">/&#42;IsExpected=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08030" /><CodeLine lineNumber="8030"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08031" /><CodeLine lineNumber="8031"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a016a85f7487f995fe80141e102a7a5ae">ReplaceInstWithInst</a>(Insert-&gt;getTerminator(), &amp;BI);</Highlight></CodeLine>
<Link id="l08032" /><CodeLine lineNumber="8032"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#ae7cdd6a7370c1f81936d1b17a6f7c701">LoopBypassBlocks</a>.push&#95;back(Insert);</Highlight></CodeLine>
<Link id="l08033" /><CodeLine lineNumber="8033"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08034" /><CodeLine lineNumber="8034"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A new entry block has been created for the epilogue VPlan. Hook it in, as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08035" /><CodeLine lineNumber="8035"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// otherwise we would try to modify the entry to the main vector loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08036" /><CodeLine lineNumber="8036"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> &#42;NewEntry = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.createVPIRBasicBlock(Insert);</Highlight></CodeLine>
<Link id="l08037" /><CodeLine lineNumber="8037"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;OldEntry = <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.getEntry();</Highlight></CodeLine>
<Link id="l08038" /><CodeLine lineNumber="8038"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpblockutils/#a63345282cd67ea46202fb33523be1408">VPBlockUtils::reassociateBlocks</a>(OldEntry, NewEntry);</Highlight></CodeLine>
<Link id="l08039" /><CodeLine lineNumber="8039"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a7084dff77ae071151848a0ca10125184">Plan</a>.setEntry(NewEntry);</Highlight></CodeLine>
<Link id="l08040" /><CodeLine lineNumber="8040"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// OldEntry is now dead and will be cleaned up when the plan gets destroyed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08041" /><CodeLine lineNumber="8041"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08042" /><CodeLine lineNumber="8042"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/innerloopvectorizer/#a5222866a9b2208ea05c3e3ed61a313e9">introduceCheckBlockInVPlan</a>(Insert);</Highlight></CodeLine>
<Link id="l08043" /><CodeLine lineNumber="8043"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Insert;</Highlight></CodeLine>
<Link id="l08044" /><CodeLine lineNumber="8044"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08045" /><CodeLine lineNumber="8045"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08046" /><CodeLine lineNumber="8046" lineLink="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a9d4052b05414daf596711bada5c5e94b"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a9d4052b05414daf596711bada5c5e94b">EpilogueVectorizerEpilogueLoop::printDebugTracesAtStart</a>() &#123;</Highlight></CodeLine>
<Link id="l08047" /><CodeLine lineNumber="8047"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</Highlight></CodeLine>
<Link id="l08048" /><CodeLine lineNumber="8048"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Create Skeleton for epilogue vectorized loop (second pass)\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08049" /><CodeLine lineNumber="8049"><Highlight kind="normal">           &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Epilogue Loop VF:&quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueVF</Highlight></CodeLine>
<Link id="l08050" /><CodeLine lineNumber="8050"><Highlight kind="normal">           &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;, Epilogue Loop UF:&quot;</Highlight><Highlight kind="normal"> &lt;&lt; <a href="/docs/api/classes/llvm/innerloopandepiloguevectorizer/#ae920fcb4fb4b5099acbbf972af04447e">EPI</a>.EpilogueUF &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08051" /><CodeLine lineNumber="8051"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l08052" /><CodeLine lineNumber="8052"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08053" /><CodeLine lineNumber="8053"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08054" /><CodeLine lineNumber="8054" lineLink="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a07454ac2b11a89ba60771243779a58e4"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop/#a07454ac2b11a89ba60771243779a58e4">EpilogueVectorizerEpilogueLoop::printDebugTracesAtEnd</a>() &#123;</Highlight></CodeLine>
<Link id="l08055" /><CodeLine lineNumber="8055"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a3fcdc9f30e5e8b9ea4da99868a8ae4a9">DEBUG&#95;WITH&#95;TYPE</a>(<a href="/docs/api/files/lib/lib/analysis/loopnestanalysis-cpp/#ab3595005ef7c117f30d4c18201190bbb">VerboseDebug</a>, &#123;</Highlight></CodeLine>
<Link id="l08056" /><CodeLine lineNumber="8056"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;final fn:\\n&quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/classes/llvm/innerloopvectorizer/#af550e4457b9c8a2840a80627713611a9">OrigLoop</a>-&gt;getHeader()-&gt;getParent() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08057" /><CodeLine lineNumber="8057"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l08058" /><CodeLine lineNumber="8058"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08059" /><CodeLine lineNumber="8059"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08060" /><CodeLine lineNumber="8060"><Highlight kind="normal"><a href="/docs/api/classes/llvm/iterator-range">iterator&#95;range</a>&lt;<a href="/docs/api/classes/llvm/mapped-iterator">mapped&#95;iterator</a>&lt;<a href="/docs/api/classes/llvm/use">Use</a> &#42;, std::function&lt;<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;)&gt;&gt;&gt;</Highlight></CodeLine>
<Link id="l08061" /><CodeLine lineNumber="8061" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a537d8b3b5160caeb94b20a21a9f6dcff"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vprecipebuilder/#a537d8b3b5160caeb94b20a21a9f6dcff">VPRecipeBuilder::mapToVPValues</a>(<a href="/docs/api/classes/llvm/user/#a917548288129e24325af275795e4622f">User::op&#95;range</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>) &#123;</Highlight></CodeLine>
<Link id="l08062" /><CodeLine lineNumber="8062"><Highlight kind="normal">  std::function&lt;<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;)&gt; Fn = &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123;</Highlight></CodeLine>
<Link id="l08063" /><CodeLine lineNumber="8063"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l08064" /><CodeLine lineNumber="8064"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l08065" /><CodeLine lineNumber="8065"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a51c7cbd21e1104ee6841c18d7daa6edb">map&#95;range</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, Fn);</Highlight></CodeLine>
<Link id="l08066" /><CodeLine lineNumber="8066"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08067" /><CodeLine lineNumber="8067"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08068" /><CodeLine lineNumber="8068" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a2e7e2adb0e2bd1c35df6aee471fc1db7"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vprecipebuilder/#a2e7e2adb0e2bd1c35df6aee471fc1db7">VPRecipeBuilder::createSwitchEdgeMasks</a>(<a href="/docs/api/classes/llvm/switchinst">SwitchInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>) &#123;</Highlight></CodeLine>
<Link id="l08069" /><CodeLine lineNumber="8069"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Src = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getParent();</Highlight></CodeLine>
<Link id="l08070" /><CodeLine lineNumber="8070"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!OrigLoop-&gt;isLoopExiting(Src) &amp;&amp;</Highlight></CodeLine>
<Link id="l08071" /><CodeLine lineNumber="8071"><Highlight kind="normal">         <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(Src),</Highlight></CodeLine>
<Link id="l08072" /><CodeLine lineNumber="8072"><Highlight kind="normal">                &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ) &#123;</Highlight></CodeLine>
<Link id="l08073" /><CodeLine lineNumber="8073"><Highlight kind="normal">                  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> OrigLoop-&gt;getHeader() != Succ;</Highlight></CodeLine>
<Link id="l08074" /><CodeLine lineNumber="8074"><Highlight kind="normal">                &#125;) &amp;&amp;</Highlight></CodeLine>
<Link id="l08075" /><CodeLine lineNumber="8075"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;unsupported switch either exiting loop or continuing to header&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08076" /><CodeLine lineNumber="8076"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create masks where the terminator in Src is a switch. We create mask for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08077" /><CodeLine lineNumber="8077"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// all edges at the same time. This is more efficient, as we can create and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08078" /><CodeLine lineNumber="8078"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// collect compares for all cases once.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08079" /><CodeLine lineNumber="8079"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = <a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getCondition());</Highlight></CodeLine>
<Link id="l08080" /><CodeLine lineNumber="8080"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;DefaultDst = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getDefaultDest();</Highlight></CodeLine>
<Link id="l08081" /><CodeLine lineNumber="8081"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mapvector">MapVector&lt;BasicBlock &#42;, SmallVector&lt;VPValue &#42;&gt;</a>&gt; Dst2Compares;</Highlight></CodeLine>
<Link id="l08082" /><CodeLine lineNumber="8082"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> : <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;cases()) &#123;</Highlight></CodeLine>
<Link id="l08083" /><CodeLine lineNumber="8083"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dst = <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getCaseSuccessor();</Highlight></CodeLine>
<Link id="l08084" /><CodeLine lineNumber="8084"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!EdgeMaskCache.contains(&#123;Src, Dst&#125;) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Edge masks already created&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08085" /><CodeLine lineNumber="8085"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Cases whose destination is the same as default are redundant and can be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08086" /><CodeLine lineNumber="8086"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// ignored - they will get there anyhow.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08087" /><CodeLine lineNumber="8087"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Dst == DefaultDst)</Highlight></CodeLine>
<Link id="l08088" /><CodeLine lineNumber="8088"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08089" /><CodeLine lineNumber="8089"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Compares = Dst2Compares&#91;Dst&#93;;</Highlight></CodeLine>
<Link id="l08090" /><CodeLine lineNumber="8090"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;V = <a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>.getCaseValue());</Highlight></CodeLine>
<Link id="l08091" /><CodeLine lineNumber="8091"><Highlight kind="normal">    Compares.push&#95;back(Builder.createICmp(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78baa719225e2de4059f93fd3209e1f48218">CmpInst::ICMP&#95;EQ</a>, <a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, V));</Highlight></CodeLine>
<Link id="l08092" /><CodeLine lineNumber="8092"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08093" /><CodeLine lineNumber="8093"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08094" /><CodeLine lineNumber="8094"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We need to handle 2 separate cases below for all entries in Dst2Compares,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08095" /><CodeLine lineNumber="8095"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// which excludes destinations matching the default destination.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08096" /><CodeLine lineNumber="8096"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;SrcMask = <a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(Src);</Highlight></CodeLine>
<Link id="l08097" /><CodeLine lineNumber="8097"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;DefaultMask = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08098" /><CodeLine lineNumber="8098"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;Dst, Conds&#93; : Dst2Compares) &#123;</Highlight></CodeLine>
<Link id="l08099" /><CodeLine lineNumber="8099"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// 1 Dst is not the default destination. Dst is reached if any of the cases</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08100" /><CodeLine lineNumber="8100"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// with destination == Dst are taken. Join the conditions for each case</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08101" /><CodeLine lineNumber="8101"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// whose destination == Dst using an OR.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08102" /><CodeLine lineNumber="8102"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Mask = Conds&#91;0&#93;;</Highlight></CodeLine>
<Link id="l08103" /><CodeLine lineNumber="8103"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;V : <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a>(Conds).drop&#95;front())</Highlight></CodeLine>
<Link id="l08104" /><CodeLine lineNumber="8104"><Highlight kind="normal">      Mask = Builder.createOr(Mask, V);</Highlight></CodeLine>
<Link id="l08105" /><CodeLine lineNumber="8105"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SrcMask)</Highlight></CodeLine>
<Link id="l08106" /><CodeLine lineNumber="8106"><Highlight kind="normal">      Mask = Builder.createLogicalAnd(SrcMask, Mask);</Highlight></CodeLine>
<Link id="l08107" /><CodeLine lineNumber="8107"><Highlight kind="normal">    EdgeMaskCache&#91;&#123;Src, Dst&#125;&#93; = Mask;</Highlight></CodeLine>
<Link id="l08108" /><CodeLine lineNumber="8108"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08109" /><CodeLine lineNumber="8109"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// 2 Create the mask for the default destination, which is reached if none</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08110" /><CodeLine lineNumber="8110"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// of the cases with destination != default destination are taken. Join the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08111" /><CodeLine lineNumber="8111"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// conditions for each case where the destination is != Dst using an OR and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08112" /><CodeLine lineNumber="8112"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// negate it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08113" /><CodeLine lineNumber="8113"><Highlight kind="normal">    DefaultMask = DefaultMask ? Builder.createOr(DefaultMask, Mask) : Mask;</Highlight></CodeLine>
<Link id="l08114" /><CodeLine lineNumber="8114"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08115" /><CodeLine lineNumber="8115"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08116" /><CodeLine lineNumber="8116"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DefaultMask) &#123;</Highlight></CodeLine>
<Link id="l08117" /><CodeLine lineNumber="8117"><Highlight kind="normal">    DefaultMask = Builder.createNot(DefaultMask);</Highlight></CodeLine>
<Link id="l08118" /><CodeLine lineNumber="8118"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SrcMask)</Highlight></CodeLine>
<Link id="l08119" /><CodeLine lineNumber="8119"><Highlight kind="normal">      DefaultMask = Builder.createLogicalAnd(SrcMask, DefaultMask);</Highlight></CodeLine>
<Link id="l08120" /><CodeLine lineNumber="8120"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08121" /><CodeLine lineNumber="8121"><Highlight kind="normal">  EdgeMaskCache&#91;&#123;Src, DefaultDst&#125;&#93; = DefaultMask;</Highlight></CodeLine>
<Link id="l08122" /><CodeLine lineNumber="8122"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08123" /><CodeLine lineNumber="8123"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08124" /><CodeLine lineNumber="8124" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a0775987674a0fc922481db1966a5fdf5"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/classes/llvm/vprecipebuilder/#a0775987674a0fc922481db1966a5fdf5">VPRecipeBuilder::createEdgeMask</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Src, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dst) &#123;</Highlight></CodeLine>
<Link id="l08125" /><CodeLine lineNumber="8125"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(Dst), Src) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Invalid edge&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08126" /><CodeLine lineNumber="8126"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08127" /><CodeLine lineNumber="8127"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Look for cached value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08128" /><CodeLine lineNumber="8128"><Highlight kind="normal">  std::pair&lt;BasicBlock &#42;, BasicBlock &#42;&gt; Edge(Src, Dst);</Highlight></CodeLine>
<Link id="l08129" /><CodeLine lineNumber="8129"><Highlight kind="normal">  EdgeMaskCacheTy::iterator ECEntryIt = EdgeMaskCache.find(Edge);</Highlight></CodeLine>
<Link id="l08130" /><CodeLine lineNumber="8130"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ECEntryIt != EdgeMaskCache.end())</Highlight></CodeLine>
<Link id="l08131" /><CodeLine lineNumber="8131"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ECEntryIt-&gt;second;</Highlight></CodeLine>
<Link id="l08132" /><CodeLine lineNumber="8132"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08133" /><CodeLine lineNumber="8133"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SwitchInst&gt;</a>(Src-&gt;getTerminator())) &#123;</Highlight></CodeLine>
<Link id="l08134" /><CodeLine lineNumber="8134"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vprecipebuilder/#a2e7e2adb0e2bd1c35df6aee471fc1db7">createSwitchEdgeMasks</a>(<a href="/docs/api/namespaces/llvm/si">SI</a>);</Highlight></CodeLine>
<Link id="l08135" /><CodeLine lineNumber="8135"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EdgeMaskCache.contains(Edge) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Mask for Edge not created?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08136" /><CodeLine lineNumber="8136"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> EdgeMaskCache&#91;Edge&#93;;</Highlight></CodeLine>
<Link id="l08137" /><CodeLine lineNumber="8137"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08138" /><CodeLine lineNumber="8138"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08139" /><CodeLine lineNumber="8139"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;SrcMask = <a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(Src);</Highlight></CodeLine>
<Link id="l08140" /><CodeLine lineNumber="8140"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08141" /><CodeLine lineNumber="8141"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The terminator has to be a branch inst!</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08142" /><CodeLine lineNumber="8142"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/branchinst">BranchInst</a> &#42;BI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BranchInst&gt;</a>(Src-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l08143" /><CodeLine lineNumber="8143"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BI &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unexpected terminator found&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08144" /><CodeLine lineNumber="8144"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#a7e4be8b16fbd68c9045a388904044e01">isConditional</a>() || BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) == BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(1))</Highlight></CodeLine>
<Link id="l08145" /><CodeLine lineNumber="8145"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> EdgeMaskCache&#91;Edge&#93; = SrcMask;</Highlight></CodeLine>
<Link id="l08146" /><CodeLine lineNumber="8146"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08147" /><CodeLine lineNumber="8147"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If source is an exiting block, we know the exit edge is dynamically dead</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08148" /><CodeLine lineNumber="8148"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in the vector loop, and thus we don&#39;t need to restrict the mask.  Avoid</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08149" /><CodeLine lineNumber="8149"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// adding uses of an otherwise potentially dead instruction unless we are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08150" /><CodeLine lineNumber="8150"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vectorizing a loop with uncountable exits. In that case, we always</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08151" /><CodeLine lineNumber="8151"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// materialize the mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08152" /><CodeLine lineNumber="8152"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OrigLoop-&gt;isLoopExiting(Src) &amp;&amp;</Highlight></CodeLine>
<Link id="l08153" /><CodeLine lineNumber="8153"><Highlight kind="normal">      Src != Legal-&gt;getUncountableEarlyExitingBlock())</Highlight></CodeLine>
<Link id="l08154" /><CodeLine lineNumber="8154"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> EdgeMaskCache&#91;Edge&#93; = SrcMask;</Highlight></CodeLine>
<Link id="l08155" /><CodeLine lineNumber="8155"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08156" /><CodeLine lineNumber="8156"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;EdgeMask = <a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aebd4af5642453ce3169094f08dd3d7b8">getCondition</a>());</Highlight></CodeLine>
<Link id="l08157" /><CodeLine lineNumber="8157"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EdgeMask &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;No Edge Mask found for condition&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08158" /><CodeLine lineNumber="8158"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08159" /><CodeLine lineNumber="8159"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BI-&gt;<a href="/docs/api/classes/llvm/branchinst/#aa05da2b94b366573d1651d5b163c521e">getSuccessor</a>(0) != Dst)</Highlight></CodeLine>
<Link id="l08160" /><CodeLine lineNumber="8160"><Highlight kind="normal">    EdgeMask = Builder.createNot(EdgeMask, BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l08161" /><CodeLine lineNumber="8161"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08162" /><CodeLine lineNumber="8162"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SrcMask) &#123; </Highlight><Highlight kind="comment">// Otherwise block in-mask is all-one, no need to AND.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08163" /><CodeLine lineNumber="8163"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The bitwise &#39;And&#39; of SrcMask and EdgeMask introduces new UB if SrcMask</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08164" /><CodeLine lineNumber="8164"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// is false and EdgeMask is poison. Avoid that by using &#39;LogicalAnd&#39;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08165" /><CodeLine lineNumber="8165"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instead which generates &#39;select i1 SrcMask, i1 EdgeMask, i1 false&#39;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08166" /><CodeLine lineNumber="8166"><Highlight kind="normal">    EdgeMask = Builder.createLogicalAnd(SrcMask, EdgeMask, BI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l08167" /><CodeLine lineNumber="8167"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08168" /><CodeLine lineNumber="8168"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08169" /><CodeLine lineNumber="8169"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> EdgeMaskCache&#91;Edge&#93; = EdgeMask;</Highlight></CodeLine>
<Link id="l08170" /><CodeLine lineNumber="8170"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08171" /><CodeLine lineNumber="8171"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08172" /><CodeLine lineNumber="8172" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a4a24061cba79c1c33396b71076a7379e"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/classes/llvm/vprecipebuilder/#a4a24061cba79c1c33396b71076a7379e">VPRecipeBuilder::getEdgeMask</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Src, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Dst)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l08173" /><CodeLine lineNumber="8173"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#acd1cd968cb420c82d70926920fcdc7d7">is&#95;contained</a>(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(Dst), Src) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Invalid edge&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08174" /><CodeLine lineNumber="8174"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08175" /><CodeLine lineNumber="8175"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Look for cached value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08176" /><CodeLine lineNumber="8176"><Highlight kind="normal">  std::pair&lt;BasicBlock &#42;, BasicBlock &#42;&gt; Edge(Src, Dst);</Highlight></CodeLine>
<Link id="l08177" /><CodeLine lineNumber="8177"><Highlight kind="normal">  EdgeMaskCacheTy::const&#95;iterator ECEntryIt = EdgeMaskCache.find(Edge);</Highlight></CodeLine>
<Link id="l08178" /><CodeLine lineNumber="8178"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ECEntryIt != EdgeMaskCache.end() &amp;&amp;</Highlight></CodeLine>
<Link id="l08179" /><CodeLine lineNumber="8179"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;looking up mask for edge which has not been created&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08180" /><CodeLine lineNumber="8180"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ECEntryIt-&gt;second;</Highlight></CodeLine>
<Link id="l08181" /><CodeLine lineNumber="8181"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08182" /><CodeLine lineNumber="8182"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08183" /><CodeLine lineNumber="8183" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a826173bded23a3839e30074a98ad34a1"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vprecipebuilder/#a826173bded23a3839e30074a98ad34a1">VPRecipeBuilder::createHeaderMask</a>() &#123;</Highlight></CodeLine>
<Link id="l08184" /><CodeLine lineNumber="8184"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Header = OrigLoop-&gt;getHeader();</Highlight></CodeLine>
<Link id="l08185" /><CodeLine lineNumber="8185"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08186" /><CodeLine lineNumber="8186"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// When not folding the tail, use nullptr to model all-true mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08187" /><CodeLine lineNumber="8187"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CM.foldTailByMasking()) &#123;</Highlight></CodeLine>
<Link id="l08188" /><CodeLine lineNumber="8188"><Highlight kind="normal">    BlockMaskCache&#91;Header&#93; = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08189" /><CodeLine lineNumber="8189"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08190" /><CodeLine lineNumber="8190"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08191" /><CodeLine lineNumber="8191"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08192" /><CodeLine lineNumber="8192"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Introduce the early-exit compare IV &lt;= BTC to form header block mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08193" /><CodeLine lineNumber="8193"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is used instead of IV &lt; TC because TC may wrap, unlike BTC. Start by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08194" /><CodeLine lineNumber="8194"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// constructing the desired canonical IV in the header block as its first</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08195" /><CodeLine lineNumber="8195"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// non-phi instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08196" /><CodeLine lineNumber="8196"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08197" /><CodeLine lineNumber="8197"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;HeaderVPBB = Plan.getVectorLoopRegion()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</Highlight></CodeLine>
<Link id="l08198" /><CodeLine lineNumber="8198"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NewInsertionPoint = HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>();</Highlight></CodeLine>
<Link id="l08199" /><CodeLine lineNumber="8199"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidencanonicalivrecipe">VPWidenCanonicalIVRecipe</a>(Plan.getCanonicalIV());</Highlight></CodeLine>
<Link id="l08200" /><CodeLine lineNumber="8200"><Highlight kind="normal">  HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#adfdd504b078cce3b90e7c5cf1f5164db">insert</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>, NewInsertionPoint);</Highlight></CodeLine>
<Link id="l08201" /><CodeLine lineNumber="8201"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08202" /><CodeLine lineNumber="8202"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder/insertpointguard">VPBuilder::InsertPointGuard</a> Guard(Builder);</Highlight></CodeLine>
<Link id="l08203" /><CodeLine lineNumber="8203"><Highlight kind="normal">  Builder.setInsertPoint(HeaderVPBB, NewInsertionPoint);</Highlight></CodeLine>
<Link id="l08204" /><CodeLine lineNumber="8204"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;BlockMask = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08205" /><CodeLine lineNumber="8205"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;BTC = Plan.getOrCreateBackedgeTakenCount();</Highlight></CodeLine>
<Link id="l08206" /><CodeLine lineNumber="8206"><Highlight kind="normal">  BlockMask = Builder.createICmp(<a href="/docs/api/classes/llvm/cmpinst/#a2be3583dac92a031fa1458d4d992c78bad92f160316221fd4090520bb2b3cefc5">CmpInst::ICMP&#95;ULE</a>, <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>, BTC);</Highlight></CodeLine>
<Link id="l08207" /><CodeLine lineNumber="8207"><Highlight kind="normal">  BlockMaskCache&#91;Header&#93; = BlockMask;</Highlight></CodeLine>
<Link id="l08208" /><CodeLine lineNumber="8208"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08209" /><CodeLine lineNumber="8209"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08210" /><CodeLine lineNumber="8210" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">VPRecipeBuilder::getBlockInMask</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l08211" /><CodeLine lineNumber="8211"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Return the cached value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08212" /><CodeLine lineNumber="8212"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemapbase/#a5784c312872bef21d9344dae0a0e8fc0">BlockMaskCacheTy::const&#95;iterator</a> BCEntryIt = BlockMaskCache.find(BB);</Highlight></CodeLine>
<Link id="l08213" /><CodeLine lineNumber="8213"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BCEntryIt != BlockMaskCache.end() &amp;&amp;</Highlight></CodeLine>
<Link id="l08214" /><CodeLine lineNumber="8214"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Trying to access mask for block without one.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08215" /><CodeLine lineNumber="8215"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> BCEntryIt-&gt;second;</Highlight></CodeLine>
<Link id="l08216" /><CodeLine lineNumber="8216"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08217" /><CodeLine lineNumber="8217"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08218" /><CodeLine lineNumber="8218" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a8a4bd8661b898e837b18df553e937311"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vprecipebuilder/#a8a4bd8661b898e837b18df553e937311">VPRecipeBuilder::createBlockInMask</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l08219" /><CodeLine lineNumber="8219"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OrigLoop-&gt;contains(BB) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Block is not a part of a loop&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08220" /><CodeLine lineNumber="8220"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BlockMaskCache.count(BB) == 0 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Mask for block already computed&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08221" /><CodeLine lineNumber="8221"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OrigLoop-&gt;getHeader() != BB &amp;&amp;</Highlight></CodeLine>
<Link id="l08222" /><CodeLine lineNumber="8222"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Loop header must have cached block mask&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08223" /><CodeLine lineNumber="8223"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08224" /><CodeLine lineNumber="8224"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// All-one mask is modelled as no-mask following the convention for masked</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08225" /><CodeLine lineNumber="8225"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// load/store/gather/scatter. Initialize BlockMask to no-mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08226" /><CodeLine lineNumber="8226"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;BlockMask = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08227" /><CodeLine lineNumber="8227"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This is the block mask. We OR all unique incoming edges.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08228" /><CodeLine lineNumber="8228"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Predecessor :</Highlight></CodeLine>
<Link id="l08229" /><CodeLine lineNumber="8229"><Highlight kind="normal">       <a href="/docs/api/classes/llvm/setvector">SetVector&lt;BasicBlock &#42;&gt;</a>(<a href="/docs/api/namespaces/llvm/#ac3e549d97549636a7f08779d5cd98540">pred&#95;begin</a>(BB), <a href="/docs/api/namespaces/llvm/#a2103c335fa6ab933312c3871c82b0106">pred&#95;end</a>(BB))) &#123;</Highlight></CodeLine>
<Link id="l08230" /><CodeLine lineNumber="8230"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;EdgeMask = <a href="/docs/api/classes/llvm/vprecipebuilder/#a0775987674a0fc922481db1966a5fdf5">createEdgeMask</a>(Predecessor, BB);</Highlight></CodeLine>
<Link id="l08231" /><CodeLine lineNumber="8231"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!EdgeMask) &#123; </Highlight><Highlight kind="comment">// Mask of predecessor is all-one so mask of block is too.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08232" /><CodeLine lineNumber="8232"><Highlight kind="normal">      BlockMaskCache&#91;BB&#93; = EdgeMask;</Highlight></CodeLine>
<Link id="l08233" /><CodeLine lineNumber="8233"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08234" /><CodeLine lineNumber="8234"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08235" /><CodeLine lineNumber="8235"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08236" /><CodeLine lineNumber="8236"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BlockMask) &#123; </Highlight><Highlight kind="comment">// BlockMask has its initialized nullptr value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08237" /><CodeLine lineNumber="8237"><Highlight kind="normal">      BlockMask = EdgeMask;</Highlight></CodeLine>
<Link id="l08238" /><CodeLine lineNumber="8238"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08239" /><CodeLine lineNumber="8239"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08240" /><CodeLine lineNumber="8240"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08241" /><CodeLine lineNumber="8241"><Highlight kind="normal">    BlockMask = Builder.createOr(BlockMask, EdgeMask, &#123;&#125;);</Highlight></CodeLine>
<Link id="l08242" /><CodeLine lineNumber="8242"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08243" /><CodeLine lineNumber="8243"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08244" /><CodeLine lineNumber="8244"><Highlight kind="normal">  BlockMaskCache&#91;BB&#93; = BlockMask;</Highlight></CodeLine>
<Link id="l08245" /><CodeLine lineNumber="8245"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08246" /><CodeLine lineNumber="8246"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08247" /><CodeLine lineNumber="8247"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vpwidenmemoryrecipe">VPWidenMemoryRecipe</a> &#42;</Highlight></CodeLine>
<Link id="l08248" /><CodeLine lineNumber="8248"><Highlight kind="normal">VPRecipeBuilder::tryToWidenMemory(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>,</Highlight></CodeLine>
<Link id="l08249" /><CodeLine lineNumber="8249"><Highlight kind="normal">                                  <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</Highlight></CodeLine>
<Link id="l08250" /><CodeLine lineNumber="8250"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</Highlight></CodeLine>
<Link id="l08251" /><CodeLine lineNumber="8251"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Must be called with either a load or store&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08252" /><CodeLine lineNumber="8252"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08253" /><CodeLine lineNumber="8253"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> WillWiden = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l08254" /><CodeLine lineNumber="8254"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">LoopVectorizationCostModel::InstWidening</a> Decision =</Highlight></CodeLine>
<Link id="l08255" /><CodeLine lineNumber="8255"><Highlight kind="normal">        CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l08256" /><CodeLine lineNumber="8256"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Decision != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260af974de6a8aba0481a82335fb93471a39">LoopVectorizationCostModel::CM&#95;Unknown</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l08257" /><CodeLine lineNumber="8257"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;CM decision should be taken at this point.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08258" /><CodeLine lineNumber="8258"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Decision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971">LoopVectorizationCostModel::CM&#95;Interleave</a>)</Highlight></CodeLine>
<Link id="l08259" /><CodeLine lineNumber="8259"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08260" /><CodeLine lineNumber="8260"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a5f5d6f7a1f29874d1e77a889510c879c">isScalarAfterVectorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) ||</Highlight></CodeLine>
<Link id="l08261" /><CodeLine lineNumber="8261"><Highlight kind="normal">        CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9a6fbca8c965adeb8016a03ca3de2cac">isProfitableToScalarize</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF))</Highlight></CodeLine>
<Link id="l08262" /><CodeLine lineNumber="8262"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08263" /><CodeLine lineNumber="8263"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Decision != <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a03c0934d38787b1773c050deee484126">LoopVectorizationCostModel::CM&#95;Scalarize</a>;</Highlight></CodeLine>
<Link id="l08264" /><CodeLine lineNumber="8264"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l08265" /><CodeLine lineNumber="8265"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08266" /><CodeLine lineNumber="8266"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(WillWiden, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>))</Highlight></CodeLine>
<Link id="l08267" /><CodeLine lineNumber="8267"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08268" /><CodeLine lineNumber="8268"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08269" /><CodeLine lineNumber="8269"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Mask = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08270" /><CodeLine lineNumber="8270"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/irsimilarity/#af46430106334db52bfa7a4107e53a0bda8f7357506e00d8cd0694f948f909865d">Legal</a>-&gt;isMaskRequired(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l08271" /><CodeLine lineNumber="8271"><Highlight kind="normal">    Mask = <a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</Highlight></CodeLine>
<Link id="l08272" /><CodeLine lineNumber="8272"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08273" /><CodeLine lineNumber="8273"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Determine if the pointer operand of the access is either consecutive or</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08274" /><CodeLine lineNumber="8274"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reverse consecutive.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08275" /><CodeLine lineNumber="8275"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260">LoopVectorizationCostModel::InstWidening</a> Decision =</Highlight></CodeLine>
<Link id="l08276" /><CodeLine lineNumber="8276"><Highlight kind="normal">      CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af01e065313d5fcaba9570458faf32429">getWideningDecision</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>.Start);</Highlight></CodeLine>
<Link id="l08277" /><CodeLine lineNumber="8277"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a1200affbcdb869bf32076f90ad9d0eafa67f115c1fddc4ce1aeb1c754001585bc">Reverse</a> = Decision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a058eacbd3c28e2ecec2af7db726ce527">LoopVectorizationCostModel::CM&#95;Widen&#95;Reverse</a>;</Highlight></CodeLine>
<Link id="l08278" /><CodeLine lineNumber="8278"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Consecutive =</Highlight></CodeLine>
<Link id="l08279" /><CodeLine lineNumber="8279"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a1200affbcdb869bf32076f90ad9d0eafa67f115c1fddc4ce1aeb1c754001585bc">Reverse</a> || Decision == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260adc468760c02910f77bad7525bc66c334">LoopVectorizationCostModel::CM&#95;Widen</a>;</Highlight></CodeLine>
<Link id="l08280" /><CodeLine lineNumber="8280"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08281" /><CodeLine lineNumber="8281"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) ? <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;0&#93; : <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;1&#93;;</Highlight></CodeLine>
<Link id="l08282" /><CodeLine lineNumber="8282"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Consecutive) &#123;</Highlight></CodeLine>
<Link id="l08283" /><CodeLine lineNumber="8283"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(</Highlight></CodeLine>
<Link id="l08284" /><CodeLine lineNumber="8284"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>-&gt;getUnderlyingValue()-&gt;stripPointerCasts());</Highlight></CodeLine>
<Link id="l08285" /><CodeLine lineNumber="8285"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpsingledefrecipe">VPSingleDefRecipe</a> &#42;VectorPtr;</Highlight></CodeLine>
<Link id="l08286" /><CodeLine lineNumber="8286"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a1200affbcdb869bf32076f90ad9d0eafa67f115c1fddc4ce1aeb1c754001585bc">Reverse</a>) &#123;</Highlight></CodeLine>
<Link id="l08287" /><CodeLine lineNumber="8287"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// When folding the tail, we may compute an address that we don&#39;t in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08288" /><CodeLine lineNumber="8288"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// original scalar loop and it may not be inbounds. Drop Inbounds in that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08289" /><CodeLine lineNumber="8289"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// case.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08290" /><CodeLine lineNumber="8290"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/gepnowrapflags">GEPNoWrapFlags</a> Flags =</Highlight></CodeLine>
<Link id="l08291" /><CodeLine lineNumber="8291"><Highlight kind="normal">          (CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#aaf371382a45e4756dbc1753d162324ba">foldTailByMasking</a>() || !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> || !<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;isInBounds())</Highlight></CodeLine>
<Link id="l08292" /><CodeLine lineNumber="8292"><Highlight kind="normal">              ? <a href="/docs/api/classes/llvm/gepnowrapflags/#ad41d3c975038ec4a4fc791601729124e">GEPNoWrapFlags::none</a>()</Highlight></CodeLine>
<Link id="l08293" /><CodeLine lineNumber="8293"><Highlight kind="normal">              : <a href="/docs/api/classes/llvm/gepnowrapflags">GEPNoWrapFlags</a>::inBounds();</Highlight></CodeLine>
<Link id="l08294" /><CodeLine lineNumber="8294"><Highlight kind="normal">      VectorPtr = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpreversevectorpointerrecipe">VPReverseVectorPointerRecipe</a>(</Highlight></CodeLine>
<Link id="l08295" /><CodeLine lineNumber="8295"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, &amp;Plan.<a href="/docs/api/classes/llvm/vplan/#a2dffed680cc551f7ac6d92b3cd365d11">getVF</a>(), <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), Flags, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l08296" /><CodeLine lineNumber="8296"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l08297" /><CodeLine lineNumber="8297"><Highlight kind="normal">      VectorPtr = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPVectorPointerRecipe(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/namespaces/llvm/#ad12126a4bea94833696dc67e0431e829">getLoadStoreType</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>),</Highlight></CodeLine>
<Link id="l08298" /><CodeLine lineNumber="8298"><Highlight kind="normal">                                            <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> ? <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;getNoWrapFlags()</Highlight></CodeLine>
<Link id="l08299" /><CodeLine lineNumber="8299"><Highlight kind="normal">                                                : <a href="/docs/api/classes/llvm/gepnowrapflags/#ad41d3c975038ec4a4fc791601729124e">GEPNoWrapFlags::none</a>(),</Highlight></CodeLine>
<Link id="l08300" /><CodeLine lineNumber="8300"><Highlight kind="normal">                                            <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l08301" /><CodeLine lineNumber="8301"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08302" /><CodeLine lineNumber="8302"><Highlight kind="normal">    Builder.getInsertBlock()-&gt;appendRecipe(VectorPtr);</Highlight></CodeLine>
<Link id="l08303" /><CodeLine lineNumber="8303"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a> = VectorPtr;</Highlight></CodeLine>
<Link id="l08304" /><CodeLine lineNumber="8304"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08305" /><CodeLine lineNumber="8305"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LoadInst &#42;Load = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l08306" /><CodeLine lineNumber="8306"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPWidenLoadRecipe(&#42;Load, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, Mask, Consecutive, <a href="/docs/api/namespaces/llvm/#a1200affbcdb869bf32076f90ad9d0eafa67f115c1fddc4ce1aeb1c754001585bc">Reverse</a>,</Highlight></CodeLine>
<Link id="l08307" /><CodeLine lineNumber="8307"><Highlight kind="normal">                                 <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l08308" /><CodeLine lineNumber="8308"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08309" /><CodeLine lineNumber="8309"><Highlight kind="normal">  StoreInst &#42;<a href="/docs/api/namespaces/llvm/spii/#ad2b7483c625986ac800ae1c31ae4cce7a36b3dd3b84fde3f8494a9b18af131856">Store</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l08310" /><CodeLine lineNumber="8310"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPWidenStoreRecipe(&#42;Store, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a11dbf501abf829b3ab7049c2d3a8a053">Ptr</a>, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;0&#93;, Mask, Consecutive,</Highlight></CodeLine>
<Link id="l08311" /><CodeLine lineNumber="8311"><Highlight kind="normal">                                <a href="/docs/api/namespaces/llvm/#a1200affbcdb869bf32076f90ad9d0eafa67f115c1fddc4ce1aeb1c754001585bc">Reverse</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l08312" /><CodeLine lineNumber="8312"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08313" /><CodeLine lineNumber="8313"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08314" /><CodeLine lineNumber="8314"><Highlight kind="comment">/// Creates a VPWidenIntOrFpInductionRecpipe for \\p Phi. If needed, it will also</Highlight></CodeLine>
<Link id="l08315" /><CodeLine lineNumber="8315"><Highlight kind="comment">/// insert a recipe to expand the step for the induction recipe.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08316" /><CodeLine lineNumber="8316"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidenintorfpinductionrecipe">VPWidenIntOrFpInductionRecipe</a> &#42;</Highlight></CodeLine>
<Link id="l08317" /><CodeLine lineNumber="8317" lineLink="#a9336eb7b4fbcee561dbb8c52d9eabe64"><Highlight kind="normal"><a href="#a9336eb7b4fbcee561dbb8c52d9eabe64">createWidenInductionRecipes</a>(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;PhiOrTrunc,</Highlight></CodeLine>
<Link id="l08318" /><CodeLine lineNumber="8318"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Start, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp;IndDesc,</Highlight></CodeLine>
<Link id="l08319" /><CodeLine lineNumber="8319"><Highlight kind="normal">                            <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/scalarevolution">ScalarEvolution</a> &amp;SE, <a href="/docs/api/classes/llvm/loop">Loop</a> &amp;OrigLoop) &#123;</Highlight></CodeLine>
<Link id="l08320" /><CodeLine lineNumber="8320"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IndDesc.<a href="/docs/api/classes/llvm/inductiondescriptor/#aea63dae61a488e20e237f5f517ed1491">getStartValue</a>() ==</Highlight></CodeLine>
<Link id="l08321" /><CodeLine lineNumber="8321"><Highlight kind="normal">         Phi-&gt;getIncomingValueForBlock(OrigLoop.<a href="/docs/api/classes/llvm/loopbase/#ac3280e7f76f955403fe17eacf126b90d">getLoopPreheader</a>()));</Highlight></CodeLine>
<Link id="l08322" /><CodeLine lineNumber="8322"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(SE.<a href="/docs/api/classes/llvm/scalarevolution/#a5a19768af81df7e5fe571bc08dcd48b3">isLoopInvariant</a>(IndDesc.<a href="/docs/api/classes/llvm/inductiondescriptor/#a83b5b65084a0c1de3a76f36f198b1b0c">getStep</a>(), &amp;OrigLoop) &amp;&amp;</Highlight></CodeLine>
<Link id="l08323" /><CodeLine lineNumber="8323"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;step must be loop invariant&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08324" /><CodeLine lineNumber="8324"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08325" /><CodeLine lineNumber="8325"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Step =</Highlight></CodeLine>
<Link id="l08326" /><CodeLine lineNumber="8326"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/vputils/#a064976a6c7458b10c24021b7334cec2a">vputils::getOrCreateVPValueForSCEVExpr</a>(Plan, IndDesc.<a href="/docs/api/classes/llvm/inductiondescriptor/#a83b5b65084a0c1de3a76f36f198b1b0c">getStep</a>(), SE);</Highlight></CodeLine>
<Link id="l08327" /><CodeLine lineNumber="8327"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;TruncI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;TruncInst&gt;</a>(PhiOrTrunc)) &#123;</Highlight></CodeLine>
<Link id="l08328" /><CodeLine lineNumber="8328"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidenintorfpinductionrecipe">VPWidenIntOrFpInductionRecipe</a>(Phi, Start, Step, &amp;Plan.<a href="/docs/api/classes/llvm/vplan/#a2dffed680cc551f7ac6d92b3cd365d11">getVF</a>(),</Highlight></CodeLine>
<Link id="l08329" /><CodeLine lineNumber="8329"><Highlight kind="normal">                                             IndDesc, TruncI,</Highlight></CodeLine>
<Link id="l08330" /><CodeLine lineNumber="8330"><Highlight kind="normal">                                             TruncI-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l08331" /><CodeLine lineNumber="8331"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08332" /><CodeLine lineNumber="8332"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(PhiOrTrunc) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;must be a phi node here&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08333" /><CodeLine lineNumber="8333"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidenintorfpinductionrecipe">VPWidenIntOrFpInductionRecipe</a>(Phi, Start, Step, &amp;Plan.<a href="/docs/api/classes/llvm/vplan/#a2dffed680cc551f7ac6d92b3cd365d11">getVF</a>(),</Highlight></CodeLine>
<Link id="l08334" /><CodeLine lineNumber="8334"><Highlight kind="normal">                                           IndDesc, Phi-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l08335" /><CodeLine lineNumber="8335"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08336" /><CodeLine lineNumber="8336"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08337" /><CodeLine lineNumber="8337"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vpheaderphirecipe">VPHeaderPHIRecipe</a> &#42;VPRecipeBuilder::tryToOptimizeInductionPHI(</Highlight></CodeLine>
<Link id="l08338" /><CodeLine lineNumber="8338"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</Highlight></CodeLine>
<Link id="l08339" /><CodeLine lineNumber="8339"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08340" /><CodeLine lineNumber="8340"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if this is an integer or fp induction. If so, build the recipe that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08341" /><CodeLine lineNumber="8341"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// produces its scalar and vector values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08342" /><CodeLine lineNumber="8342"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = Legal-&gt;getIntOrFpInductionDescriptor(Phi))</Highlight></CodeLine>
<Link id="l08343" /><CodeLine lineNumber="8343"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a9336eb7b4fbcee561dbb8c52d9eabe64">createWidenInductionRecipes</a>(Phi, Phi, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;0&#93;, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, Plan,</Highlight></CodeLine>
<Link id="l08344" /><CodeLine lineNumber="8344"><Highlight kind="normal">                                       &#42;PSE.getSE(), &#42;OrigLoop);</Highlight></CodeLine>
<Link id="l08345" /><CodeLine lineNumber="8345"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08346" /><CodeLine lineNumber="8346"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if this is pointer induction. If so, build the recipe for it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08347" /><CodeLine lineNumber="8347"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = Legal-&gt;getPointerInductionDescriptor(Phi)) &#123;</Highlight></CodeLine>
<Link id="l08348" /><CodeLine lineNumber="8348"><Highlight kind="normal">    VPValue &#42;Step = <a href="/docs/api/namespaces/llvm/vputils/#a064976a6c7458b10c24021b7334cec2a">vputils::getOrCreateVPValueForSCEVExpr</a>(Plan, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getStep(),</Highlight></CodeLine>
<Link id="l08349" /><CodeLine lineNumber="8349"><Highlight kind="normal">                                                           &#42;PSE.getSE());</Highlight></CodeLine>
<Link id="l08350" /><CodeLine lineNumber="8350"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPWidenPointerInductionRecipe(</Highlight></CodeLine>
<Link id="l08351" /><CodeLine lineNumber="8351"><Highlight kind="normal">        Phi, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;0&#93;, Step, &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>,</Highlight></CodeLine>
<Link id="l08352" /><CodeLine lineNumber="8352"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</Highlight></CodeLine>
<Link id="l08353" /><CodeLine lineNumber="8353"><Highlight kind="normal">            &#91;&amp;&#93;(ElementCount VF) &#123;</Highlight></CodeLine>
<Link id="l08354" /><CodeLine lineNumber="8354"><Highlight kind="normal">              </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CM.isScalarAfterVectorization(Phi, VF);</Highlight></CodeLine>
<Link id="l08355" /><CodeLine lineNumber="8355"><Highlight kind="normal">            &#125;,</Highlight></CodeLine>
<Link id="l08356" /><CodeLine lineNumber="8356"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>),</Highlight></CodeLine>
<Link id="l08357" /><CodeLine lineNumber="8357"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l08358" /><CodeLine lineNumber="8358"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08359" /><CodeLine lineNumber="8359"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08360" /><CodeLine lineNumber="8360"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08361" /><CodeLine lineNumber="8361"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08362" /><CodeLine lineNumber="8362"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vpwidenintorfpinductionrecipe">VPWidenIntOrFpInductionRecipe</a> &#42;VPRecipeBuilder::tryToOptimizeInductionTruncate(</Highlight></CodeLine>
<Link id="l08363" /><CodeLine lineNumber="8363"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/truncinst">TruncInst</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</Highlight></CodeLine>
<Link id="l08364" /><CodeLine lineNumber="8364"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Optimize the special case where the source is a constant integer</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08365" /><CodeLine lineNumber="8365"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// induction variable. Notice that we can only optimize the &#39;trunc&#39; case</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08366" /><CodeLine lineNumber="8366"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// because (a) FP conversions lose precision, (b) sext/zext may wrap, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08367" /><CodeLine lineNumber="8367"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (c) other casts depend on pointer size.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08368" /><CodeLine lineNumber="8368"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08369" /><CodeLine lineNumber="8369"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Determine whether \\p K is a truncation based on an induction variable that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08370" /><CodeLine lineNumber="8370"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// can be optimized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08371" /><CodeLine lineNumber="8371"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsOptimizableIVTruncate =</Highlight></CodeLine>
<Link id="l08372" /><CodeLine lineNumber="8372"><Highlight kind="normal">      &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38eaa5f3c6a11b03839d46af9fb43c97c188">K</a>) -&gt; std::function&lt;</Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal">(ElementCount)&gt; &#123;</Highlight></CodeLine>
<Link id="l08373" /><CodeLine lineNumber="8373"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#91;=&#93;(ElementCount VF) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l08374" /><CodeLine lineNumber="8374"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CM.isOptimizableIVTruncate(K, VF);</Highlight></CodeLine>
<Link id="l08375" /><CodeLine lineNumber="8375"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l08376" /><CodeLine lineNumber="8376"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l08377" /><CodeLine lineNumber="8377"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08378" /><CodeLine lineNumber="8378"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</Highlight></CodeLine>
<Link id="l08379" /><CodeLine lineNumber="8379"><Highlight kind="normal">          IsOptimizableIVTruncate(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)) &#123;</Highlight></CodeLine>
<Link id="l08380" /><CodeLine lineNumber="8380"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08381" /><CodeLine lineNumber="8381"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l08382" /><CodeLine lineNumber="8382"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> InductionDescriptor &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = &#42;Legal-&gt;getIntOrFpInductionDescriptor(Phi);</Highlight></CodeLine>
<Link id="l08383" /><CodeLine lineNumber="8383"><Highlight kind="normal">    VPValue &#42;<a href="/docs/api/namespaces/llvm/memprof/#abee3ddc7c6eb611a3b96fb69489c81caaa6122a65eaa676f700ae68d393054a37">Start</a> = Plan.getOrAddLiveIn(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getStartValue());</Highlight></CodeLine>
<Link id="l08384" /><CodeLine lineNumber="8384"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#a9336eb7b4fbcee561dbb8c52d9eabe64">createWidenInductionRecipes</a>(Phi, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, Start, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>, Plan, &#42;PSE.getSE(),</Highlight></CodeLine>
<Link id="l08385" /><CodeLine lineNumber="8385"><Highlight kind="normal">                                       &#42;OrigLoop);</Highlight></CodeLine>
<Link id="l08386" /><CodeLine lineNumber="8386"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08387" /><CodeLine lineNumber="8387"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08388" /><CodeLine lineNumber="8388"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08389" /><CodeLine lineNumber="8389"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08390" /><CodeLine lineNumber="8390"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vpblendrecipe">VPBlendRecipe</a> &#42;VPRecipeBuilder::tryToBlend(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi,</Highlight></CodeLine>
<Link id="l08391" /><CodeLine lineNumber="8391"><Highlight kind="normal">                                           <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>) &#123;</Highlight></CodeLine>
<Link id="l08392" /><CodeLine lineNumber="8392"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumIncoming = <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getNumIncomingValues();</Highlight></CodeLine>
<Link id="l08393" /><CodeLine lineNumber="8393"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08394" /><CodeLine lineNumber="8394"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We know that all PHIs in non-header blocks are converted into selects, so</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08395" /><CodeLine lineNumber="8395"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// we don&#39;t have to worry about the insertion order and we can just use the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08396" /><CodeLine lineNumber="8396"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// builder. At this point we generate the predication tree. There may be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08397" /><CodeLine lineNumber="8397"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// duplications since this is a simple recursive scan, but future</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08398" /><CodeLine lineNumber="8398"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// optimizations will clean it up.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08399" /><CodeLine lineNumber="8399"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;VPValue &#42;, 2&gt;</a> OperandsWithMask;</Highlight></CodeLine>
<Link id="l08400" /><CodeLine lineNumber="8400"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08401" /><CodeLine lineNumber="8401"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> In = 0; <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a> &lt; NumIncoming; <a href="/docs/api/namespaces/llvm/tgtok/#abbc5259d649363016626e2529fabe0c5a5fa7b4069ef3bd1ceb9f2caa315cf5ac">In</a>++) &#123;</Highlight></CodeLine>
<Link id="l08402" /><CodeLine lineNumber="8402"><Highlight kind="normal">    OperandsWithMask.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;In&#93;);</Highlight></CodeLine>
<Link id="l08403" /><CodeLine lineNumber="8403"><Highlight kind="normal">    VPValue &#42;EdgeMask =</Highlight></CodeLine>
<Link id="l08404" /><CodeLine lineNumber="8404"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vprecipebuilder/#a4a24061cba79c1c33396b71076a7379e">getEdgeMask</a>(<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIncomingBlock(In), <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getParent());</Highlight></CodeLine>
<Link id="l08405" /><CodeLine lineNumber="8405"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!EdgeMask) &#123;</Highlight></CodeLine>
<Link id="l08406" /><CodeLine lineNumber="8406"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(In == 0 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Both null and non-null edge masks found&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08407" /><CodeLine lineNumber="8407"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ad78da75bd1f157e72100f97d1ecdc756">all&#95;equal</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l08408" /><CodeLine lineNumber="8408"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Distinct incoming values with one having a full mask&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08409" /><CodeLine lineNumber="8409"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08410" /><CodeLine lineNumber="8410"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08411" /><CodeLine lineNumber="8411"><Highlight kind="normal">    OperandsWithMask.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(EdgeMask);</Highlight></CodeLine>
<Link id="l08412" /><CodeLine lineNumber="8412"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08413" /><CodeLine lineNumber="8413"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPBlendRecipe(Phi, OperandsWithMask);</Highlight></CodeLine>
<Link id="l08414" /><CodeLine lineNumber="8414"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08415" /><CodeLine lineNumber="8415"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08416" /><CodeLine lineNumber="8416"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vpsingledefrecipe">VPSingleDefRecipe</a> &#42;VPRecipeBuilder::tryToWidenCall(<a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI,</Highlight></CodeLine>
<Link id="l08417" /><CodeLine lineNumber="8417"><Highlight kind="normal">                                                   <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>,</Highlight></CodeLine>
<Link id="l08418" /><CodeLine lineNumber="8418"><Highlight kind="normal">                                                   <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</Highlight></CodeLine>
<Link id="l08419" /><CodeLine lineNumber="8419"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsPredicated = <a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</Highlight></CodeLine>
<Link id="l08420" /><CodeLine lineNumber="8420"><Highlight kind="normal">      &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, CI&#93;(ElementCount VF) &#123;</Highlight></CodeLine>
<Link id="l08421" /><CodeLine lineNumber="8421"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CM.isScalarWithPredication(CI, VF);</Highlight></CodeLine>
<Link id="l08422" /><CodeLine lineNumber="8422"><Highlight kind="normal">      &#125;,</Highlight></CodeLine>
<Link id="l08423" /><CodeLine lineNumber="8423"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</Highlight></CodeLine>
<Link id="l08424" /><CodeLine lineNumber="8424"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08425" /><CodeLine lineNumber="8425"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsPredicated)</Highlight></CodeLine>
<Link id="l08426" /><CodeLine lineNumber="8426"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08427" /><CodeLine lineNumber="8427"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08428" /><CodeLine lineNumber="8428"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> = <a href="/docs/api/namespaces/llvm/#a11c66d01880f53332fc7ad53f565b039">getVectorIntrinsicIDForCall</a>(CI, TLI);</Highlight></CodeLine>
<Link id="l08429" /><CodeLine lineNumber="8429"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> &amp;&amp; (<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> == Intrinsic::assume || <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> == Intrinsic::lifetime&#95;end ||</Highlight></CodeLine>
<Link id="l08430" /><CodeLine lineNumber="8430"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> == Intrinsic::lifetime&#95;start || <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> == Intrinsic::sideeffect ||</Highlight></CodeLine>
<Link id="l08431" /><CodeLine lineNumber="8431"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> == Intrinsic::pseudoprobe ||</Highlight></CodeLine>
<Link id="l08432" /><CodeLine lineNumber="8432"><Highlight kind="normal">             <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> == Intrinsic::experimental&#95;noalias&#95;scope&#95;decl))</Highlight></CodeLine>
<Link id="l08433" /><CodeLine lineNumber="8433"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08434" /><CodeLine lineNumber="8434"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08435" /><CodeLine lineNumber="8435"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;VPValue &#42;, 4&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.take&#95;front(CI-&gt;<a href="/docs/api/classes/llvm/callbase/#adde2ea00dd2613ee41bfe91908e4e68e">arg&#95;size</a>()));</Highlight></CodeLine>
<Link id="l08436" /><CodeLine lineNumber="8436"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08437" /><CodeLine lineNumber="8437"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Is it beneficial to perform intrinsic call compared to lib call?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08438" /><CodeLine lineNumber="8438"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ShouldUseVectorIntrinsic =</Highlight></CodeLine>
<Link id="l08439" /><CodeLine lineNumber="8439"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> &amp;&amp; <a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</Highlight></CodeLine>
<Link id="l08440" /><CodeLine lineNumber="8440"><Highlight kind="normal">                &#91;&amp;&#93;(ElementCount VF) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l08441" /><CodeLine lineNumber="8441"><Highlight kind="normal">                  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CM.getCallWideningDecision(CI, VF).Kind ==</Highlight></CodeLine>
<Link id="l08442" /><CodeLine lineNumber="8442"><Highlight kind="normal">                         <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a679b46cebdf2f87b9efd0413c960314a">LoopVectorizationCostModel::CM&#95;IntrinsicCall</a>;</Highlight></CodeLine>
<Link id="l08443" /><CodeLine lineNumber="8443"><Highlight kind="normal">                &#125;,</Highlight></CodeLine>
<Link id="l08444" /><CodeLine lineNumber="8444"><Highlight kind="normal">                <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</Highlight></CodeLine>
<Link id="l08445" /><CodeLine lineNumber="8445"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ShouldUseVectorIntrinsic)</Highlight></CodeLine>
<Link id="l08446" /><CodeLine lineNumber="8446"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPWidenIntrinsicRecipe(&#42;CI, <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</Highlight></CodeLine>
<Link id="l08447" /><CodeLine lineNumber="8447"><Highlight kind="normal">                                      CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l08448" /><CodeLine lineNumber="8448"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08449" /><CodeLine lineNumber="8449"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;<a href="/docs/api/namespaces/llvm/loc/#aa1fa35229c3ab492b9ea826366f68350">Variant</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08450" /><CodeLine lineNumber="8450"><Highlight kind="normal">  std::optional&lt;unsigned&gt; MaskPos;</Highlight></CodeLine>
<Link id="l08451" /><CodeLine lineNumber="8451"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Is better to call a vectorized version of the function than to to scalarize</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08452" /><CodeLine lineNumber="8452"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the call?</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08453" /><CodeLine lineNumber="8453"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ShouldUseVectorCall = <a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</Highlight></CodeLine>
<Link id="l08454" /><CodeLine lineNumber="8454"><Highlight kind="normal">      &#91;&amp;&#93;(ElementCount VF) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l08455" /><CodeLine lineNumber="8455"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// The following case may be scalarized depending on the VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08456" /><CodeLine lineNumber="8456"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// The flag shows whether we can use a usual Call for vectorized</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08457" /><CodeLine lineNumber="8457"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// version of the instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08458" /><CodeLine lineNumber="8458"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08459" /><CodeLine lineNumber="8459"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If we&#39;ve found a variant at a previous VF, then stop looking. A</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08460" /><CodeLine lineNumber="8460"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// vectorized variant of a function expects input in a certain shape</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08461" /><CodeLine lineNumber="8461"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// -- basically the number of input registers, the number of lanes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08462" /><CodeLine lineNumber="8462"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// per register, and whether there&#39;s a mask required.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08463" /><CodeLine lineNumber="8463"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// We store a pointer to the variant in the VPWidenCallRecipe, so</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08464" /><CodeLine lineNumber="8464"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// once we have an appropriate variant it&#39;s only valid for that VF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08465" /><CodeLine lineNumber="8465"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// This will force a different vplan to be generated for each VF that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08466" /><CodeLine lineNumber="8466"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// finds a valid variant.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08467" /><CodeLine lineNumber="8467"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Variant)</Highlight></CodeLine>
<Link id="l08468" /><CodeLine lineNumber="8468"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08469" /><CodeLine lineNumber="8469"><Highlight kind="normal">        LoopVectorizationCostModel::CallWideningDecision Decision =</Highlight></CodeLine>
<Link id="l08470" /><CodeLine lineNumber="8470"><Highlight kind="normal">            CM.getCallWideningDecision(CI, VF);</Highlight></CodeLine>
<Link id="l08471" /><CodeLine lineNumber="8471"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Decision.<a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a970379530706280ef592e3e752195707">Kind</a> == <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260ab6fd5f45ab6e363de6c3f42472d439ac">LoopVectorizationCostModel::CM&#95;VectorCall</a>) &#123;</Highlight></CodeLine>
<Link id="l08472" /><CodeLine lineNumber="8472"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/loc/#aa1fa35229c3ab492b9ea826366f68350">Variant</a> = Decision.<a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#a7d0c66f91e19821438f6111292e4988a">Variant</a>;</Highlight></CodeLine>
<Link id="l08473" /><CodeLine lineNumber="8473"><Highlight kind="normal">          MaskPos = Decision.<a href="/docs/api/structs/llvm/loopvectorizationcostmodel/callwideningdecision/#acf57054d7a0afa002650a5f94c4a7432">MaskPos</a>;</Highlight></CodeLine>
<Link id="l08474" /><CodeLine lineNumber="8474"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08475" /><CodeLine lineNumber="8475"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l08476" /><CodeLine lineNumber="8476"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08477" /><CodeLine lineNumber="8477"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08478" /><CodeLine lineNumber="8478"><Highlight kind="normal">      &#125;,</Highlight></CodeLine>
<Link id="l08479" /><CodeLine lineNumber="8479"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</Highlight></CodeLine>
<Link id="l08480" /><CodeLine lineNumber="8480"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ShouldUseVectorCall) &#123;</Highlight></CodeLine>
<Link id="l08481" /><CodeLine lineNumber="8481"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MaskPos.has&#95;value()) &#123;</Highlight></CodeLine>
<Link id="l08482" /><CodeLine lineNumber="8482"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We have 2 cases that would require a mask:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08483" /><CodeLine lineNumber="8483"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   1) The block needs to be predicated, either due to a conditional</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08484" /><CodeLine lineNumber="8484"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//      in the scalar loop or use of an active lane mask with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08485" /><CodeLine lineNumber="8485"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//      tail-folding, and we use the appropriate mask for the block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08486" /><CodeLine lineNumber="8486"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   2) No mask is required for the block, but the only available</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08487" /><CodeLine lineNumber="8487"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//      vector variant at this VF requires a mask, so we synthesize an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08488" /><CodeLine lineNumber="8488"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//      all-true mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08489" /><CodeLine lineNumber="8489"><Highlight kind="normal">      VPValue &#42;<a href="/docs/api/namespaces/llvm/bitmaskenumdetail/#a4562904154aff9698a612bc7f6086a4c">Mask</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08490" /><CodeLine lineNumber="8490"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Legal-&gt;isMaskRequired(CI))</Highlight></CodeLine>
<Link id="l08491" /><CodeLine lineNumber="8491"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/bitmaskenumdetail/#a4562904154aff9698a612bc7f6086a4c">Mask</a> = <a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(CI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>());</Highlight></CodeLine>
<Link id="l08492" /><CodeLine lineNumber="8492"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08493" /><CodeLine lineNumber="8493"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/bitmaskenumdetail/#a4562904154aff9698a612bc7f6086a4c">Mask</a> = Plan.getOrAddLiveIn(</Highlight></CodeLine>
<Link id="l08494" /><CodeLine lineNumber="8494"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/constantint/#a82dbbd8e3688b0bc1eedb338864d0d0c">ConstantInt::getTrue</a>(<a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">IntegerType::getInt1Ty</a>(CI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>())));</Highlight></CodeLine>
<Link id="l08495" /><CodeLine lineNumber="8495"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08496" /><CodeLine lineNumber="8496"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.insert(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.begin() + &#42;MaskPos, Mask);</Highlight></CodeLine>
<Link id="l08497" /><CodeLine lineNumber="8497"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08498" /><CodeLine lineNumber="8498"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08499" /><CodeLine lineNumber="8499"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.push&#95;back(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.back());</Highlight></CodeLine>
<Link id="l08500" /><CodeLine lineNumber="8500"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPWidenCallRecipe(CI, Variant, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>, CI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l08501" /><CodeLine lineNumber="8501"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08502" /><CodeLine lineNumber="8502"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08503" /><CodeLine lineNumber="8503"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08504" /><CodeLine lineNumber="8504"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08505" /><CodeLine lineNumber="8505"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08506" /><CodeLine lineNumber="8506"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> VPRecipeBuilder::shouldWiden(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l08507" /><CodeLine lineNumber="8507"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BranchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l08508" /><CodeLine lineNumber="8508"><Highlight kind="normal">         !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Instruction should have been handled earlier&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08509" /><CodeLine lineNumber="8509"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Instruction should be widened, unless it is scalar after vectorization,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08510" /><CodeLine lineNumber="8510"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// scalarization is profitable or it is predicated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08511" /><CodeLine lineNumber="8511"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> WillScalarize = &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;(ElementCount VF) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l08512" /><CodeLine lineNumber="8512"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CM.isScalarAfterVectorization(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) ||</Highlight></CodeLine>
<Link id="l08513" /><CodeLine lineNumber="8513"><Highlight kind="normal">           CM.isProfitableToScalarize(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF) ||</Highlight></CodeLine>
<Link id="l08514" /><CodeLine lineNumber="8514"><Highlight kind="normal">           CM.isScalarWithPredication(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF);</Highlight></CodeLine>
<Link id="l08515" /><CodeLine lineNumber="8515"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l08516" /><CodeLine lineNumber="8516"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !<a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(WillScalarize,</Highlight></CodeLine>
<Link id="l08517" /><CodeLine lineNumber="8517"><Highlight kind="normal">                                                             <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</Highlight></CodeLine>
<Link id="l08518" /><CodeLine lineNumber="8518"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08519" /><CodeLine lineNumber="8519"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08520" /><CodeLine lineNumber="8520"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vpwidenrecipe">VPWidenRecipe</a> &#42;VPRecipeBuilder::tryToWiden(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l08521" /><CodeLine lineNumber="8521"><Highlight kind="normal">                                           <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>,</Highlight></CodeLine>
<Link id="l08522" /><CodeLine lineNumber="8522"><Highlight kind="normal">                                           <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB) &#123;</Highlight></CodeLine>
<Link id="l08523" /><CodeLine lineNumber="8523"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode()) &#123;</Highlight></CodeLine>
<Link id="l08524" /><CodeLine lineNumber="8524"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l08525" /><CodeLine lineNumber="8525"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08526" /><CodeLine lineNumber="8526"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SDiv:</Highlight></CodeLine>
<Link id="l08527" /><CodeLine lineNumber="8527"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::UDiv:</Highlight></CodeLine>
<Link id="l08528" /><CodeLine lineNumber="8528"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::SRem:</Highlight></CodeLine>
<Link id="l08529" /><CodeLine lineNumber="8529"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::URem: &#123;</Highlight></CodeLine>
<Link id="l08530" /><CodeLine lineNumber="8530"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If not provably safe, use a select to form a safe divisor before widening the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08531" /><CodeLine lineNumber="8531"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// div/rem operation itself.  Otherwise fall through to general handling below.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08532" /><CodeLine lineNumber="8532"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CM.isPredicatedInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l08533" /><CodeLine lineNumber="8533"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>);</Highlight></CodeLine>
<Link id="l08534" /><CodeLine lineNumber="8534"><Highlight kind="normal">      VPValue &#42;<a href="/docs/api/namespaces/llvm/bitmaskenumdetail/#a4562904154aff9698a612bc7f6086a4c">Mask</a> = <a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</Highlight></CodeLine>
<Link id="l08535" /><CodeLine lineNumber="8535"><Highlight kind="normal">      VPValue &#42;One =</Highlight></CodeLine>
<Link id="l08536" /><CodeLine lineNumber="8536"><Highlight kind="normal">          Plan.getOrAddLiveIn(ConstantInt::get(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getType(), 1u, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l08537" /><CodeLine lineNumber="8537"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;SafeRHS = Builder.createSelect(Mask, <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;1&#93;, One, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l08538" /><CodeLine lineNumber="8538"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>&#91;1&#93; = SafeRHS;</Highlight></CodeLine>
<Link id="l08539" /><CodeLine lineNumber="8539"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPWidenRecipe(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.begin(), <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a926d7ce2143863b7a2afda0fca4d2b65">Ops</a>.end()));</Highlight></CodeLine>
<Link id="l08540" /><CodeLine lineNumber="8540"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08541" /><CodeLine lineNumber="8541"><Highlight kind="normal">    &#91;&#91;fallthrough&#93;&#93;;</Highlight></CodeLine>
<Link id="l08542" /><CodeLine lineNumber="8542"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08543" /><CodeLine lineNumber="8543"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Add:</Highlight></CodeLine>
<Link id="l08544" /><CodeLine lineNumber="8544"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::And:</Highlight></CodeLine>
<Link id="l08545" /><CodeLine lineNumber="8545"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::AShr:</Highlight></CodeLine>
<Link id="l08546" /><CodeLine lineNumber="8546"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FAdd:</Highlight></CodeLine>
<Link id="l08547" /><CodeLine lineNumber="8547"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FCmp:</Highlight></CodeLine>
<Link id="l08548" /><CodeLine lineNumber="8548"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FDiv:</Highlight></CodeLine>
<Link id="l08549" /><CodeLine lineNumber="8549"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FMul:</Highlight></CodeLine>
<Link id="l08550" /><CodeLine lineNumber="8550"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FNeg:</Highlight></CodeLine>
<Link id="l08551" /><CodeLine lineNumber="8551"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FRem:</Highlight></CodeLine>
<Link id="l08552" /><CodeLine lineNumber="8552"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::FSub:</Highlight></CodeLine>
<Link id="l08553" /><CodeLine lineNumber="8553"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::ICmp:</Highlight></CodeLine>
<Link id="l08554" /><CodeLine lineNumber="8554"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::LShr:</Highlight></CodeLine>
<Link id="l08555" /><CodeLine lineNumber="8555"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Mul:</Highlight></CodeLine>
<Link id="l08556" /><CodeLine lineNumber="8556"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Or:</Highlight></CodeLine>
<Link id="l08557" /><CodeLine lineNumber="8557"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Select:</Highlight></CodeLine>
<Link id="l08558" /><CodeLine lineNumber="8558"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Shl:</Highlight></CodeLine>
<Link id="l08559" /><CodeLine lineNumber="8559"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Sub:</Highlight></CodeLine>
<Link id="l08560" /><CodeLine lineNumber="8560"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Xor:</Highlight></CodeLine>
<Link id="l08561" /><CodeLine lineNumber="8561"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Freeze:</Highlight></CodeLine>
<Link id="l08562" /><CodeLine lineNumber="8562"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;VPValue &#42;&gt;</a> NewOps(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>);</Highlight></CodeLine>
<Link id="l08563" /><CodeLine lineNumber="8563"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction/#a5c88132322ca3f46f242f7c023a57010">Instruction::isBinaryOp</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode())) &#123;</Highlight></CodeLine>
<Link id="l08564" /><CodeLine lineNumber="8564"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The legacy cost model uses SCEV to check if some of the operands are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08565" /><CodeLine lineNumber="8565"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// constants. To match the legacy cost model&#39;s behavior, use SCEV to try</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08566" /><CodeLine lineNumber="8566"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// to replace operands with constants.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08567" /><CodeLine lineNumber="8567"><Highlight kind="normal">      ScalarEvolution &amp;SE = &#42;PSE.getSE();</Highlight></CodeLine>
<Link id="l08568" /><CodeLine lineNumber="8568"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GetConstantViaSCEV = &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, &amp;SE&#93;(VPValue &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>) &#123;</Highlight></CodeLine>
<Link id="l08569" /><CodeLine lineNumber="8569"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;isLiveIn())</Highlight></CodeLine>
<Link id="l08570" /><CodeLine lineNumber="8570"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>;</Highlight></CodeLine>
<Link id="l08571" /><CodeLine lineNumber="8571"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a> = <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>-&gt;getUnderlyingValue();</Highlight></CodeLine>
<Link id="l08572" /><CodeLine lineNumber="8572"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(V) || !SE.<a href="/docs/api/classes/llvm/scalarevolution/#a6d8769a72303e2b06ef63129cb231855">isSCEVable</a>(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea5206560a306a2e085a437fd258eb57ce">V</a>-&gt;getType()))</Highlight></CodeLine>
<Link id="l08573" /><CodeLine lineNumber="8573"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>;</Highlight></CodeLine>
<Link id="l08574" /><CodeLine lineNumber="8574"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(SE.<a href="/docs/api/classes/llvm/scalarevolution/#a30bd18ac905eacf3601bc6a553a9ff49">getSCEV</a>(V));</Highlight></CodeLine>
<Link id="l08575" /><CodeLine lineNumber="8575"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>)</Highlight></CodeLine>
<Link id="l08576" /><CodeLine lineNumber="8576"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>;</Highlight></CodeLine>
<Link id="l08577" /><CodeLine lineNumber="8577"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Plan.getOrAddLiveIn(<a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>-&gt;getValue());</Highlight></CodeLine>
<Link id="l08578" /><CodeLine lineNumber="8578"><Highlight kind="normal">      &#125;;</Highlight></CodeLine>
<Link id="l08579" /><CodeLine lineNumber="8579"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// For Mul, the legacy cost model checks both operands.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08580" /><CodeLine lineNumber="8580"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOpcode() == Instruction::Mul)</Highlight></CodeLine>
<Link id="l08581" /><CodeLine lineNumber="8581"><Highlight kind="normal">        NewOps&#91;0&#93; = GetConstantViaSCEV(NewOps&#91;0&#93;);</Highlight></CodeLine>
<Link id="l08582" /><CodeLine lineNumber="8582"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// For other binops, the legacy cost model only checks the second operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08583" /><CodeLine lineNumber="8583"><Highlight kind="normal">      NewOps&#91;1&#93; = GetConstantViaSCEV(NewOps&#91;1&#93;);</Highlight></CodeLine>
<Link id="l08584" /><CodeLine lineNumber="8584"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08585" /><CodeLine lineNumber="8585"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPWidenRecipe(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(NewOps.begin(), NewOps.end()));</Highlight></CodeLine>
<Link id="l08586" /><CodeLine lineNumber="8586"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l08587" /><CodeLine lineNumber="8587"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08588" /><CodeLine lineNumber="8588"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08589" /><CodeLine lineNumber="8589"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vphistogramrecipe">VPHistogramRecipe</a> &#42;</Highlight></CodeLine>
<Link id="l08590" /><CodeLine lineNumber="8590"><Highlight kind="normal">VPRecipeBuilder::tryToWidenHistogram(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/histograminfo">HistogramInfo</a> &#42;HI,</Highlight></CodeLine>
<Link id="l08591" /><CodeLine lineNumber="8591"><Highlight kind="normal">                                     <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>) &#123;</Highlight></CodeLine>
<Link id="l08592" /><CodeLine lineNumber="8592"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: Support other operations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08593" /><CodeLine lineNumber="8593"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Opcode = <a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28aa5506efe3dc67f7b794331f0cbffddaf">HI</a>-&gt;Update-&gt;getOpcode();</Highlight></CodeLine>
<Link id="l08594" /><CodeLine lineNumber="8594"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Opcode == Instruction::Add || Opcode == Instruction::Sub) &amp;&amp;</Highlight></CodeLine>
<Link id="l08595" /><CodeLine lineNumber="8595"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Histogram update operation must be an Add or Sub&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08596" /><CodeLine lineNumber="8596"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08597" /><CodeLine lineNumber="8597"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;VPValue &#42;, 3&gt;</a> HGramOps;</Highlight></CodeLine>
<Link id="l08598" /><CodeLine lineNumber="8598"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Bucket address.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08599" /><CodeLine lineNumber="8599"><Highlight kind="normal">  HGramOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;1&#93;);</Highlight></CodeLine>
<Link id="l08600" /><CodeLine lineNumber="8600"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Increment value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08601" /><CodeLine lineNumber="8601"><Highlight kind="normal">  HGramOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(<a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28aa5506efe3dc67f7b794331f0cbffddaf">HI</a>-&gt;Update-&gt;getOperand(1)));</Highlight></CodeLine>
<Link id="l08602" /><CodeLine lineNumber="8602"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08603" /><CodeLine lineNumber="8603"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// In case of predicated execution (due to tail-folding, or conditional</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08604" /><CodeLine lineNumber="8604"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// execution, or both), pass the relevant mask.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08605" /><CodeLine lineNumber="8605"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Legal-&gt;isMaskRequired(<a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28aa5506efe3dc67f7b794331f0cbffddaf">HI</a>-&gt;Store))</Highlight></CodeLine>
<Link id="l08606" /><CodeLine lineNumber="8606"><Highlight kind="normal">    HGramOps.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(<a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28aa5506efe3dc67f7b794331f0cbffddaf">HI</a>-&gt;Store-&gt;getParent()));</Highlight></CodeLine>
<Link id="l08607" /><CodeLine lineNumber="8607"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08608" /><CodeLine lineNumber="8608"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPHistogramRecipe(Opcode,</Highlight></CodeLine>
<Link id="l08609" /><CodeLine lineNumber="8609"><Highlight kind="normal">                               <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(HGramOps.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a8a045d250952c0867382a9840ee18fdf">begin</a>(), HGramOps.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a075e34e98605d0e7c289763a104869ac">end</a>()),</Highlight></CodeLine>
<Link id="l08610" /><CodeLine lineNumber="8610"><Highlight kind="normal">                               <a href="/docs/api/namespaces/llvm/aarch64cc/#abfa1f7dce576430da99eed57807c7f28aa5506efe3dc67f7b794331f0cbffddaf">HI</a>-&gt;Store-&gt;getDebugLoc());</Highlight></CodeLine>
<Link id="l08611" /><CodeLine lineNumber="8611"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08612" /><CodeLine lineNumber="8612"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08613" /><CodeLine lineNumber="8613" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a6d8fbabf45554d7d598dc8eb4eca41cf"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vprecipebuilder/#a6d8fbabf45554d7d598dc8eb4eca41cf">VPRecipeBuilder::fixHeaderPhis</a>() &#123;</Highlight></CodeLine>
<Link id="l08614" /><CodeLine lineNumber="8614"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OrigLatch = OrigLoop-&gt;getLoopLatch();</Highlight></CodeLine>
<Link id="l08615" /><CodeLine lineNumber="8615"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpheaderphirecipe">VPHeaderPHIRecipe</a> &#42;R : PhisToFix) &#123;</Highlight></CodeLine>
<Link id="l08616" /><CodeLine lineNumber="8616"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(R-&gt;getUnderlyingValue());</Highlight></CodeLine>
<Link id="l08617" /><CodeLine lineNumber="8617"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;IncR =</Highlight></CodeLine>
<Link id="l08618" /><CodeLine lineNumber="8618"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vprecipebuilder/#af5f874dc688e86699e648825bfcbf495">getRecipe</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(PN-&gt;getIncomingValueForBlock(OrigLatch)));</Highlight></CodeLine>
<Link id="l08619" /><CodeLine lineNumber="8619"><Highlight kind="normal">    R-&gt;addOperand(IncR-&gt;<a href="/docs/api/classes/llvm/vpdef/#a76a983b694720483a3dd9fe57314e39b">getVPSingleValue</a>());</Highlight></CodeLine>
<Link id="l08620" /><CodeLine lineNumber="8620"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08621" /><CodeLine lineNumber="8621"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08622" /><CodeLine lineNumber="8622"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08623" /><CodeLine lineNumber="8623" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a2c36c7d44a38145e7c72340d1b0e34d8"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a> &#42;<a href="/docs/api/classes/llvm/vprecipebuilder/#a2c36c7d44a38145e7c72340d1b0e34d8">VPRecipeBuilder::handleReplication</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>,</Highlight></CodeLine>
<Link id="l08624" /><CodeLine lineNumber="8624"><Highlight kind="normal">                                                      <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</Highlight></CodeLine>
<Link id="l08625" /><CodeLine lineNumber="8625"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsUniform = <a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</Highlight></CodeLine>
<Link id="l08626" /><CodeLine lineNumber="8626"><Highlight kind="normal">      &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CM.isUniformAfterVectorization(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, VF); &#125;,</Highlight></CodeLine>
<Link id="l08627" /><CodeLine lineNumber="8627"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</Highlight></CodeLine>
<Link id="l08628" /><CodeLine lineNumber="8628"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08629" /><CodeLine lineNumber="8629"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsPredicated = CM.isPredicatedInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l08630" /><CodeLine lineNumber="8630"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08631" /><CodeLine lineNumber="8631"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Even if the instruction is not marked as uniform, there are certain</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08632" /><CodeLine lineNumber="8632"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// intrinsic calls that can be effectively treated as such, so we check for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08633" /><CodeLine lineNumber="8633"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// them here. Conservatively, we only do this for scalable vectors, since</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08634" /><CodeLine lineNumber="8634"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// for fixed-width VFs we can always fall back on full scalarization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08635" /><CodeLine lineNumber="8635"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IsUniform &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>.Start.isScalable() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l08636" /><CodeLine lineNumber="8636"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)-&gt;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64isellowering-cpp/#a62766c75f88612ffa652342472e755f6">getIntrinsicID</a>()) &#123;</Highlight></CodeLine>
<Link id="l08637" /><CodeLine lineNumber="8637"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::assume:</Highlight></CodeLine>
<Link id="l08638" /><CodeLine lineNumber="8638"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::lifetime&#95;start:</Highlight></CodeLine>
<Link id="l08639" /><CodeLine lineNumber="8639"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Intrinsic::lifetime&#95;end:</Highlight></CodeLine>
<Link id="l08640" /><CodeLine lineNumber="8640"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// For scalable vectors if one of the operands is variant then we still</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08641" /><CodeLine lineNumber="8641"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// want to mark as uniform, which will generate one instruction for just</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08642" /><CodeLine lineNumber="8642"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the first lane of the vector. We can&#39;t scalarize the call in the same</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08643" /><CodeLine lineNumber="8643"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// way as for fixed-width vectors because we don&#39;t know how many lanes</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08644" /><CodeLine lineNumber="8644"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// there are.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08645" /><CodeLine lineNumber="8645"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08646" /><CodeLine lineNumber="8646"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The reasons for doing it this way for scalable vectors are:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08647" /><CodeLine lineNumber="8647"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   1 For the assume intrinsic generating the instruction for the first</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08648" /><CodeLine lineNumber="8648"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//      lane is still be better than not generating any at all. For</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08649" /><CodeLine lineNumber="8649"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//      example, the input may be a splat across all lanes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08650" /><CodeLine lineNumber="8650"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//   2 For the lifetime start/end intrinsics the pointer operand only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08651" /><CodeLine lineNumber="8651"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//      does anything useful when the input comes from a stack object,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08652" /><CodeLine lineNumber="8652"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//      which suggests it should always be uniform. For non-stack objects</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08653" /><CodeLine lineNumber="8653"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//      the effect is to poison the object, which still allows us to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08654" /><CodeLine lineNumber="8654"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//      remove the call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08655" /><CodeLine lineNumber="8655"><Highlight kind="normal">      IsUniform = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08656" /><CodeLine lineNumber="8656"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08657" /><CodeLine lineNumber="8657"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l08658" /><CodeLine lineNumber="8658"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08659" /><CodeLine lineNumber="8659"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08660" /><CodeLine lineNumber="8660"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08661" /><CodeLine lineNumber="8661"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;BlockInMask = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08662" /><CodeLine lineNumber="8662"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IsPredicated) &#123;</Highlight></CodeLine>
<Link id="l08663" /><CodeLine lineNumber="8663"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Finalize the recipe for Instr, first if it is not predicated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08664" /><CodeLine lineNumber="8664"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Scalarizing:&quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08665" /><CodeLine lineNumber="8665"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l08666" /><CodeLine lineNumber="8666"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Scalarizing and predicating:&quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08667" /><CodeLine lineNumber="8667"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Instructions marked for predication are replicated and a mask operand is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08668" /><CodeLine lineNumber="8668"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// added initially. Masked replicate recipes will later be placed under an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08669" /><CodeLine lineNumber="8669"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// if-then construct to prevent side-effects. Generate recipes to compute</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08670" /><CodeLine lineNumber="8670"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the block mask for this region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08671" /><CodeLine lineNumber="8671"><Highlight kind="normal">    BlockInMask = <a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent());</Highlight></CodeLine>
<Link id="l08672" /><CodeLine lineNumber="8672"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08673" /><CodeLine lineNumber="8673"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08674" /><CodeLine lineNumber="8674"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Note that there is some custom logic to mark some intrinsics as uniform</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08675" /><CodeLine lineNumber="8675"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// manually above for scalable vectors, which this assert needs to account for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08676" /><CodeLine lineNumber="8676"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// as well.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08677" /><CodeLine lineNumber="8677"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>.Start.isScalar() || !IsUniform || !IsPredicated ||</Highlight></CodeLine>
<Link id="l08678" /><CodeLine lineNumber="8678"><Highlight kind="normal">          (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>.Start.isScalable() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;IntrinsicInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))) &amp;&amp;</Highlight></CodeLine>
<Link id="l08679" /><CodeLine lineNumber="8679"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Should not predicate a uniform recipe&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08680" /><CodeLine lineNumber="8680"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Recipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpreplicaterecipe">VPReplicateRecipe</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, <a href="/docs/api/classes/llvm/vprecipebuilder/#a537d8b3b5160caeb94b20a21a9f6dcff">mapToVPValues</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands()),</Highlight></CodeLine>
<Link id="l08681" /><CodeLine lineNumber="8681"><Highlight kind="normal">                                       IsUniform, BlockInMask);</Highlight></CodeLine>
<Link id="l08682" /><CodeLine lineNumber="8682"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Recipe;</Highlight></CodeLine>
<Link id="l08683" /><CodeLine lineNumber="8683"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08684" /><CodeLine lineNumber="8684"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08685" /><CodeLine lineNumber="8685"><Highlight kind="comment">/// Find all possible partial reductions in the loop and track all of those that</Highlight></CodeLine>
<Link id="l08686" /><CodeLine lineNumber="8686"><Highlight kind="comment">/// are valid so recipes can be formed later.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08687" /><CodeLine lineNumber="8687" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a8dc41af84f49f4b418bddf15547755af"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vprecipebuilder/#a8dc41af84f49f4b418bddf15547755af">VPRecipeBuilder::collectScaledReductions</a>(<a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</Highlight></CodeLine>
<Link id="l08688" /><CodeLine lineNumber="8688"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find all possible partial reductions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08689" /><CodeLine lineNumber="8689"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;std::pair&lt;PartialReductionChain, unsigned&gt;</a>&gt;</Highlight></CodeLine>
<Link id="l08690" /><CodeLine lineNumber="8690"><Highlight kind="normal">      PartialReductionChains;</Highlight></CodeLine>
<Link id="l08691" /><CodeLine lineNumber="8691"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;Phi, RdxDesc&#93; : Legal-&gt;getReductionVars()) &#123;</Highlight></CodeLine>
<Link id="l08692" /><CodeLine lineNumber="8692"><Highlight kind="normal">    getScaledReductions(Phi, RdxDesc.getLoopExitInstr(), <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>,</Highlight></CodeLine>
<Link id="l08693" /><CodeLine lineNumber="8693"><Highlight kind="normal">                        PartialReductionChains);</Highlight></CodeLine>
<Link id="l08694" /><CodeLine lineNumber="8694"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08695" /><CodeLine lineNumber="8695"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08696" /><CodeLine lineNumber="8696"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A partial reduction is invalid if any of its extends are used by</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08697" /><CodeLine lineNumber="8697"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// something that isn&#39;t another partial reduction. This is because the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08698" /><CodeLine lineNumber="8698"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// extends are intended to be lowered along with the reduction itself.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08699" /><CodeLine lineNumber="8699"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08700" /><CodeLine lineNumber="8700"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Build up a set of partial reduction bin ops for efficient use checking.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08701" /><CodeLine lineNumber="8701"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallset">SmallSet&lt;User &#42;, 4&gt;</a> PartialReductionBinOps;</Highlight></CodeLine>
<Link id="l08702" /><CodeLine lineNumber="8702"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;PartialRdx, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>&#93; : PartialReductionChains)</Highlight></CodeLine>
<Link id="l08703" /><CodeLine lineNumber="8703"><Highlight kind="normal">    PartialReductionBinOps.<a href="/docs/api/classes/llvm/smallset/#afcadfef2cf37c3e6dbdbc9cd7bea50a0">insert</a>(PartialRdx.BinOp);</Highlight></CodeLine>
<Link id="l08704" /><CodeLine lineNumber="8704"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08705" /><CodeLine lineNumber="8705"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ExtendIsOnlyUsedByPartialReductions =</Highlight></CodeLine>
<Link id="l08706" /><CodeLine lineNumber="8706"><Highlight kind="normal">      &#91;&amp;PartialReductionBinOps&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Extend) &#123;</Highlight></CodeLine>
<Link id="l08707" /><CodeLine lineNumber="8707"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(Extend-&gt;users(), &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l08708" /><CodeLine lineNumber="8708"><Highlight kind="normal">          return PartialReductionBinOps.contains(U);</Highlight></CodeLine>
<Link id="l08709" /><CodeLine lineNumber="8709"><Highlight kind="normal">        &#125;);</Highlight></CodeLine>
<Link id="l08710" /><CodeLine lineNumber="8710"><Highlight kind="normal">      &#125;;</Highlight></CodeLine>
<Link id="l08711" /><CodeLine lineNumber="8711"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08712" /><CodeLine lineNumber="8712"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if each use of a chain&#39;s two extends is a partial reduction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08713" /><CodeLine lineNumber="8713"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and only add those that don&#39;t have non-partial reduction users.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08714" /><CodeLine lineNumber="8714"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Pair : PartialReductionChains) &#123;</Highlight></CodeLine>
<Link id="l08715" /><CodeLine lineNumber="8715"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/partialreductionchain">PartialReductionChain</a> Chain = Pair.first;</Highlight></CodeLine>
<Link id="l08716" /><CodeLine lineNumber="8716"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExtendIsOnlyUsedByPartialReductions(Chain.ExtendA) &amp;&amp;</Highlight></CodeLine>
<Link id="l08717" /><CodeLine lineNumber="8717"><Highlight kind="normal">        ExtendIsOnlyUsedByPartialReductions(Chain.ExtendB))</Highlight></CodeLine>
<Link id="l08718" /><CodeLine lineNumber="8718"><Highlight kind="normal">      ScaledReductionMap.<a href="/docs/api/classes/llvm/smallvectorimpl/#a94d23373106467003722f7d6c17b1528">insert</a>(std::make&#95;pair(Chain.Reduction, Pair.second));</Highlight></CodeLine>
<Link id="l08719" /><CodeLine lineNumber="8719"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08720" /><CodeLine lineNumber="8720"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08721" /><CodeLine lineNumber="8721"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08722" /><CodeLine lineNumber="8722"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> VPRecipeBuilder::getScaledReductions(</Highlight></CodeLine>
<Link id="l08723" /><CodeLine lineNumber="8723"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;RdxExitInstr, <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>,</Highlight></CodeLine>
<Link id="l08724" /><CodeLine lineNumber="8724"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvectorimpl">SmallVectorImpl</a>&lt;std::pair&lt;PartialReductionChain, unsigned&gt;&gt; &amp;Chains) &#123;</Highlight></CodeLine>
<Link id="l08725" /><CodeLine lineNumber="8725"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08726" /><CodeLine lineNumber="8726"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a664dc60e31d9203d66c9d7a49787b63f">TheLoop</a>-&gt;<a href="/docs/api/classes/llvm/loopbase/#a04337b572d34ea413c35dbac5d75530b">contains</a>(RdxExitInstr))</Highlight></CodeLine>
<Link id="l08727" /><CodeLine lineNumber="8727"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08728" /><CodeLine lineNumber="8728"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08729" /><CodeLine lineNumber="8729"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Allow scaling reductions when predicating. The select at</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08730" /><CodeLine lineNumber="8730"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the end of the loop chooses between the phi value and most recent</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08731" /><CodeLine lineNumber="8731"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// reduction result, both of which have different VFs to the active lane</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08732" /><CodeLine lineNumber="8732"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// mask when scaling.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08733" /><CodeLine lineNumber="8733"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab8c8de8f62b5d2b27c4878d3effd7273">blockNeedsPredicationForAnyReason</a>(RdxExitInstr-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()))</Highlight></CodeLine>
<Link id="l08734" /><CodeLine lineNumber="8734"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08735" /><CodeLine lineNumber="8735"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08736" /><CodeLine lineNumber="8736"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Update = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(RdxExitInstr);</Highlight></CodeLine>
<Link id="l08737" /><CodeLine lineNumber="8737"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Update)</Highlight></CodeLine>
<Link id="l08738" /><CodeLine lineNumber="8738"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08739" /><CodeLine lineNumber="8739"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08740" /><CodeLine lineNumber="8740"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = Update-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l08741" /><CodeLine lineNumber="8741"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;PhiOp = Update-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l08742" /><CodeLine lineNumber="8742"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)</Highlight></CodeLine>
<Link id="l08743" /><CodeLine lineNumber="8743"><Highlight kind="normal">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, PhiOp);</Highlight></CodeLine>
<Link id="l08744" /><CodeLine lineNumber="8744"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08745" /><CodeLine lineNumber="8745"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Try and get a scaled reduction from the first non-phi operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08746" /><CodeLine lineNumber="8746"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If one is found, we use the discovered reduction instruction in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08747" /><CodeLine lineNumber="8747"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// place of the accumulator for costing.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08748" /><CodeLine lineNumber="8748"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>)) &#123;</Highlight></CodeLine>
<Link id="l08749" /><CodeLine lineNumber="8749"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (getScaledReductions(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>, OpInst, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>, Chains)) &#123;</Highlight></CodeLine>
<Link id="l08750" /><CodeLine lineNumber="8750"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a> = Chains.rbegin()-&gt;first.Reduction;</Highlight></CodeLine>
<Link id="l08751" /><CodeLine lineNumber="8751"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08752" /><CodeLine lineNumber="8752"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> = Update-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l08753" /><CodeLine lineNumber="8753"><Highlight kind="normal">      PhiOp = Update-&gt;getOperand(1);</Highlight></CodeLine>
<Link id="l08754" /><CodeLine lineNumber="8754"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> == <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)</Highlight></CodeLine>
<Link id="l08755" /><CodeLine lineNumber="8755"><Highlight kind="normal">        <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>, PhiOp);</Highlight></CodeLine>
<Link id="l08756" /><CodeLine lineNumber="8756"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08757" /><CodeLine lineNumber="8757"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08758" /><CodeLine lineNumber="8758"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PhiOp != <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>)</Highlight></CodeLine>
<Link id="l08759" /><CodeLine lineNumber="8759"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08760" /><CodeLine lineNumber="8760"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08761" /><CodeLine lineNumber="8761"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BinOp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;BinaryOperator&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>);</Highlight></CodeLine>
<Link id="l08762" /><CodeLine lineNumber="8762"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!BinOp || !BinOp-&gt;hasOneUse())</Highlight></CodeLine>
<Link id="l08763" /><CodeLine lineNumber="8763"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08764" /><CodeLine lineNumber="8764"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08765" /><CodeLine lineNumber="8765"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal">llvm::PatternMatch;</Highlight></CodeLine>
<Link id="l08766" /><CodeLine lineNumber="8766"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>, &#42;<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>;</Highlight></CodeLine>
<Link id="l08767" /><CodeLine lineNumber="8767"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BinOp-&gt;getOperand(0), <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>))) ||</Highlight></CodeLine>
<Link id="l08768" /><CodeLine lineNumber="8768"><Highlight kind="normal">      !<a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(BinOp-&gt;getOperand(1), <a href="/docs/api/namespaces/llvm/patternmatch/#ab9dc78a306f2befc7dc7f1da8c9eaca2">m&#95;ZExtOrSExt</a>(<a href="/docs/api/namespaces/llvm/patternmatch/#aaf522908fe903018eb9b087dd6e49296">m&#95;Value</a>(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>))))</Highlight></CodeLine>
<Link id="l08769" /><CodeLine lineNumber="8769"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08770" /><CodeLine lineNumber="8770"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08771" /><CodeLine lineNumber="8771"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExtA = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(BinOp-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l08772" /><CodeLine lineNumber="8772"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;ExtB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(BinOp-&gt;getOperand(1));</Highlight></CodeLine>
<Link id="l08773" /><CodeLine lineNumber="8773"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08774" /><CodeLine lineNumber="8774"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/targettransforminfo/#abd1dc2b46b5e2311e1f64d21b2991be9">TTI::PartialReductionExtendKind</a> OpAExtend =</Highlight></CodeLine>
<Link id="l08775" /><CodeLine lineNumber="8775"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/targettransforminfo/#a49120eb4a93d65c200b9aa5529f88448">TargetTransformInfo::getPartialReductionExtendKind</a>(ExtA);</Highlight></CodeLine>
<Link id="l08776" /><CodeLine lineNumber="8776"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/targettransforminfo/#abd1dc2b46b5e2311e1f64d21b2991be9">TTI::PartialReductionExtendKind</a> OpBExtend =</Highlight></CodeLine>
<Link id="l08777" /><CodeLine lineNumber="8777"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/targettransforminfo/#a49120eb4a93d65c200b9aa5529f88448">TargetTransformInfo::getPartialReductionExtendKind</a>(ExtB);</Highlight></CodeLine>
<Link id="l08778" /><CodeLine lineNumber="8778"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08779" /><CodeLine lineNumber="8779"><Highlight kind="normal">  PartialReductionChain <a href="/docs/api/namespaces/anonymous-loadstorevectorizer-cpp-/#afd1adfcbfce320e6265935ce4d6299a3">Chain</a>(RdxExitInstr, ExtA, ExtB, BinOp);</Highlight></CodeLine>
<Link id="l08780" /><CodeLine lineNumber="8780"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08781" /><CodeLine lineNumber="8781"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> TargetScaleFactor =</Highlight></CodeLine>
<Link id="l08782" /><CodeLine lineNumber="8782"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getType()-&gt;getPrimitiveSizeInBits().getKnownScalarFactor(</Highlight></CodeLine>
<Link id="l08783" /><CodeLine lineNumber="8783"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType()-&gt;getPrimitiveSizeInBits());</Highlight></CodeLine>
<Link id="l08784" /><CodeLine lineNumber="8784"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08785" /><CodeLine lineNumber="8785"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</Highlight></CodeLine>
<Link id="l08786" /><CodeLine lineNumber="8786"><Highlight kind="normal">          &#91;&amp;&#93;(ElementCount VF) &#123;</Highlight></CodeLine>
<Link id="l08787" /><CodeLine lineNumber="8787"><Highlight kind="normal">            InstructionCost <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a> = TTI-&gt;getPartialReductionCost(</Highlight></CodeLine>
<Link id="l08788" /><CodeLine lineNumber="8788"><Highlight kind="normal">                Update-&gt;getOpcode(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#a2e38c85003a042421cde1647632d0b72">A</a>-&gt;getType(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>-&gt;getType(), <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpurewriteundefforphi-cpp/#a2e83cb1bc3f5e8986cbd14575755a134">PHI</a>-&gt;getType(),</Highlight></CodeLine>
<Link id="l08789" /><CodeLine lineNumber="8789"><Highlight kind="normal">                VF, OpAExtend, OpBExtend,</Highlight></CodeLine>
<Link id="l08790" /><CodeLine lineNumber="8790"><Highlight kind="normal">                std::make&#95;optional(BinOp-&gt;getOpcode()));</Highlight></CodeLine>
<Link id="l08791" /><CodeLine lineNumber="8791"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a19921a3ceb99548f498d3df118eda9ed">Cost</a>.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>();</Highlight></CodeLine>
<Link id="l08792" /><CodeLine lineNumber="8792"><Highlight kind="normal">          &#125;,</Highlight></CodeLine>
<Link id="l08793" /><CodeLine lineNumber="8793"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)) &#123;</Highlight></CodeLine>
<Link id="l08794" /><CodeLine lineNumber="8794"><Highlight kind="normal">    Chains.push&#95;back(std::make&#95;pair(Chain, TargetScaleFactor));</Highlight></CodeLine>
<Link id="l08795" /><CodeLine lineNumber="8795"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08796" /><CodeLine lineNumber="8796"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08797" /><CodeLine lineNumber="8797"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08798" /><CodeLine lineNumber="8798"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08799" /><CodeLine lineNumber="8799"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08800" /><CodeLine lineNumber="8800"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08801" /><CodeLine lineNumber="8801"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;</Highlight></CodeLine>
<Link id="l08802" /><CodeLine lineNumber="8802" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a760fb390c24b907500c0a181fada9590"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vprecipebuilder/#a760fb390c24b907500c0a181fada9590">VPRecipeBuilder::tryToCreateWidenRecipe</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Instr,</Highlight></CodeLine>
<Link id="l08803" /><CodeLine lineNumber="8803"><Highlight kind="normal">                                        <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>,</Highlight></CodeLine>
<Link id="l08804" /><CodeLine lineNumber="8804"><Highlight kind="normal">                                        <a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>, <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;VPBB) &#123;</Highlight></CodeLine>
<Link id="l08805" /><CodeLine lineNumber="8805"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// First, check for specific widening recipes that deal with inductions, Phi</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08806" /><CodeLine lineNumber="8806"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// nodes, calls and memory operations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08807" /><CodeLine lineNumber="8807"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;Recipe;</Highlight></CodeLine>
<Link id="l08808" /><CodeLine lineNumber="8808"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Instr)) &#123;</Highlight></CodeLine>
<Link id="l08809" /><CodeLine lineNumber="8809"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Phi-&gt;getParent() != OrigLoop-&gt;getHeader())</Highlight></CodeLine>
<Link id="l08810" /><CodeLine lineNumber="8810"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> tryToBlend(Phi, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>);</Highlight></CodeLine>
<Link id="l08811" /><CodeLine lineNumber="8811"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08812" /><CodeLine lineNumber="8812"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((Recipe = tryToOptimizeInductionPHI(Phi, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)))</Highlight></CodeLine>
<Link id="l08813" /><CodeLine lineNumber="8813"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Recipe;</Highlight></CodeLine>
<Link id="l08814" /><CodeLine lineNumber="8814"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08815" /><CodeLine lineNumber="8815"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpheaderphirecipe">VPHeaderPHIRecipe</a> &#42;PhiRecipe = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08816" /><CodeLine lineNumber="8816"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((Legal-&gt;isReductionVariable(Phi) ||</Highlight></CodeLine>
<Link id="l08817" /><CodeLine lineNumber="8817"><Highlight kind="normal">            Legal-&gt;isFixedOrderRecurrence(Phi)) &amp;&amp;</Highlight></CodeLine>
<Link id="l08818" /><CodeLine lineNumber="8818"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;can only widen reductions and fixed-order recurrences here&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08819" /><CodeLine lineNumber="8819"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;StartV = <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;0&#93;;</Highlight></CodeLine>
<Link id="l08820" /><CodeLine lineNumber="8820"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Legal-&gt;isReductionVariable(Phi)) &#123;</Highlight></CodeLine>
<Link id="l08821" /><CodeLine lineNumber="8821"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc =</Highlight></CodeLine>
<Link id="l08822" /><CodeLine lineNumber="8822"><Highlight kind="normal">          Legal-&gt;getReductionVars().find(Phi)-&gt;second;</Highlight></CodeLine>
<Link id="l08823" /><CodeLine lineNumber="8823"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a61351428b7eb226cbad866ccf2382817">getRecurrenceStartValue</a>() ==</Highlight></CodeLine>
<Link id="l08824" /><CodeLine lineNumber="8824"><Highlight kind="normal">             Phi-&gt;getIncomingValueForBlock(OrigLoop-&gt;getLoopPreheader()));</Highlight></CodeLine>
<Link id="l08825" /><CodeLine lineNumber="8825"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08826" /><CodeLine lineNumber="8826"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the PHI is used by a partial reduction, set the scale factor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08827" /><CodeLine lineNumber="8827"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ScaleFactor =</Highlight></CodeLine>
<Link id="l08828" /><CodeLine lineNumber="8828"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/vprecipebuilder/#a830fac639095604081943918ff84f703">getScalingForReduction</a>(RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a2b34d6e86d376d6857ccf7dd75d7dcf2">getLoopExitInstr</a>()).value&#95;or(1);</Highlight></CodeLine>
<Link id="l08829" /><CodeLine lineNumber="8829"><Highlight kind="normal">      PhiRecipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpreductionphirecipe">VPReductionPHIRecipe</a>(</Highlight></CodeLine>
<Link id="l08830" /><CodeLine lineNumber="8830"><Highlight kind="normal">          Phi, RdxDesc, &#42;StartV, CM.isInLoopReduction(Phi),</Highlight></CodeLine>
<Link id="l08831" /><CodeLine lineNumber="8831"><Highlight kind="normal">          CM.useOrderedReductions(RdxDesc), ScaleFactor);</Highlight></CodeLine>
<Link id="l08832" /><CodeLine lineNumber="8832"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l08833" /><CodeLine lineNumber="8833"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: Currently fixed-order recurrences are modeled as chains of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08834" /><CodeLine lineNumber="8834"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// first-order recurrences. If there are no users of the intermediate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08835" /><CodeLine lineNumber="8835"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// recurrences in the chain, the fixed order recurrence should be modeled</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08836" /><CodeLine lineNumber="8836"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// directly, enabling more efficient codegen.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08837" /><CodeLine lineNumber="8837"><Highlight kind="normal">      PhiRecipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vpfirstorderrecurrencephirecipe">VPFirstOrderRecurrencePHIRecipe</a>(Phi, &#42;StartV);</Highlight></CodeLine>
<Link id="l08838" /><CodeLine lineNumber="8838"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08839" /><CodeLine lineNumber="8839"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08840" /><CodeLine lineNumber="8840"><Highlight kind="normal">    PhisToFix.push&#95;back(PhiRecipe);</Highlight></CodeLine>
<Link id="l08841" /><CodeLine lineNumber="8841"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> PhiRecipe;</Highlight></CodeLine>
<Link id="l08842" /><CodeLine lineNumber="8842"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08843" /><CodeLine lineNumber="8843"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08844" /><CodeLine lineNumber="8844"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(Instr) &amp;&amp; (Recipe = tryToOptimizeInductionTruncate(</Highlight></CodeLine>
<Link id="l08845" /><CodeLine lineNumber="8845"><Highlight kind="normal">                                    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;TruncInst&gt;</a>(Instr), <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)))</Highlight></CodeLine>
<Link id="l08846" /><CodeLine lineNumber="8846"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Recipe;</Highlight></CodeLine>
<Link id="l08847" /><CodeLine lineNumber="8847"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08848" /><CodeLine lineNumber="8848"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// All widen recipes below deal only with VF &gt; 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08849" /><CodeLine lineNumber="8849"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</Highlight></CodeLine>
<Link id="l08850" /><CodeLine lineNumber="8850"><Highlight kind="normal">          &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> VF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>(); &#125;, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>))</Highlight></CodeLine>
<Link id="l08851" /><CodeLine lineNumber="8851"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08852" /><CodeLine lineNumber="8852"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08853" /><CodeLine lineNumber="8853"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(Instr))</Highlight></CodeLine>
<Link id="l08854" /><CodeLine lineNumber="8854"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> tryToWidenCall(CI, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</Highlight></CodeLine>
<Link id="l08855" /><CodeLine lineNumber="8855"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08856" /><CodeLine lineNumber="8856"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(Instr))</Highlight></CodeLine>
<Link id="l08857" /><CodeLine lineNumber="8857"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> HistInfo = Legal-&gt;getHistogramInfo(<a href="/docs/api/namespaces/llvm/si">SI</a>))</Highlight></CodeLine>
<Link id="l08858" /><CodeLine lineNumber="8858"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> tryToWidenHistogram(&#42;HistInfo, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>);</Highlight></CodeLine>
<Link id="l08859" /><CodeLine lineNumber="8859"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08860" /><CodeLine lineNumber="8860"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;LoadInst&gt;</a>(Instr) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(Instr))</Highlight></CodeLine>
<Link id="l08861" /><CodeLine lineNumber="8861"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> tryToWidenMemory(Instr, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</Highlight></CodeLine>
<Link id="l08862" /><CodeLine lineNumber="8862"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08863" /><CodeLine lineNumber="8863"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebuilder/#a830fac639095604081943918ff84f703">getScalingForReduction</a>(Instr))</Highlight></CodeLine>
<Link id="l08864" /><CodeLine lineNumber="8864"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vprecipebuilder/#a06a097fb3e3b640d70709b4770408024">tryToCreatePartialReduction</a>(Instr, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>);</Highlight></CodeLine>
<Link id="l08865" /><CodeLine lineNumber="8865"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08866" /><CodeLine lineNumber="8866"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!shouldWiden(Instr, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>))</Highlight></CodeLine>
<Link id="l08867" /><CodeLine lineNumber="8867"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08868" /><CodeLine lineNumber="8868"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08869" /><CodeLine lineNumber="8869"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;GetElementPtrInst&gt;</a>(Instr))</Highlight></CodeLine>
<Link id="l08870" /><CodeLine lineNumber="8870"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidengeprecipe">VPWidenGEPRecipe</a>(<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>,</Highlight></CodeLine>
<Link id="l08871" /><CodeLine lineNumber="8871"><Highlight kind="normal">                                <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.begin(), <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.end()));</Highlight></CodeLine>
<Link id="l08872" /><CodeLine lineNumber="8872"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08873" /><CodeLine lineNumber="8873"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SelectInst&gt;</a>(Instr)) &#123;</Highlight></CodeLine>
<Link id="l08874" /><CodeLine lineNumber="8874"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vpwidenselectrecipe">VPWidenSelectRecipe</a>(</Highlight></CodeLine>
<Link id="l08875" /><CodeLine lineNumber="8875"><Highlight kind="normal">        &#42;<a href="/docs/api/namespaces/llvm/si">SI</a>, <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.begin(), <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.end()));</Highlight></CodeLine>
<Link id="l08876" /><CodeLine lineNumber="8876"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08877" /><CodeLine lineNumber="8877"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08878" /><CodeLine lineNumber="8878"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CastInst&gt;</a>(Instr)) &#123;</Highlight></CodeLine>
<Link id="l08879" /><CodeLine lineNumber="8879"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpwidencastrecipe">VPWidenCastRecipe</a>(CI-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>(), <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;0&#93;, CI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(),</Highlight></CodeLine>
<Link id="l08880" /><CodeLine lineNumber="8880"><Highlight kind="normal">                                 &#42;CI);</Highlight></CodeLine>
<Link id="l08881" /><CodeLine lineNumber="8881"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08882" /><CodeLine lineNumber="8882"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08883" /><CodeLine lineNumber="8883"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> tryToWiden(Instr, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, VPBB);</Highlight></CodeLine>
<Link id="l08884" /><CodeLine lineNumber="8884"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08885" /><CodeLine lineNumber="8885"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08886" /><CodeLine lineNumber="8886"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;</Highlight></CodeLine>
<Link id="l08887" /><CodeLine lineNumber="8887" lineLink="/docs/api/classes/llvm/vprecipebuilder/#a06a097fb3e3b640d70709b4770408024"><Highlight kind="normal"><a href="/docs/api/classes/llvm/vprecipebuilder/#a06a097fb3e3b640d70709b4770408024">VPRecipeBuilder::tryToCreatePartialReduction</a>(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>,</Highlight></CodeLine>
<Link id="l08888" /><CodeLine lineNumber="8888"><Highlight kind="normal">                                             <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;VPValue &#42;&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>) &#123;</Highlight></CodeLine>
<Link id="l08889" /><CodeLine lineNumber="8889"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.size() == 2 &amp;&amp;</Highlight></CodeLine>
<Link id="l08890" /><CodeLine lineNumber="8890"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Unexpected number of operands for partial reduction&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08891" /><CodeLine lineNumber="8891"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08892" /><CodeLine lineNumber="8892"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;BinOp = <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;0&#93;;</Highlight></CodeLine>
<Link id="l08893" /><CodeLine lineNumber="8893"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64instrinfo-cpp/#abb0a82cf9ab3cf0c256918c17512f987aa66d3974b6f2e3a542f896da144cd297">Accumulator</a> = <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>&#91;1&#93;;</Highlight></CodeLine>
<Link id="l08894" /><CodeLine lineNumber="8894"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;BinOpRecipe = BinOp-&gt;getDefiningRecipe();</Highlight></CodeLine>
<Link id="l08895" /><CodeLine lineNumber="8895"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPReductionPHIRecipe&gt;</a>(BinOpRecipe) ||</Highlight></CodeLine>
<Link id="l08896" /><CodeLine lineNumber="8896"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPPartialReductionRecipe&gt;</a>(BinOpRecipe))</Highlight></CodeLine>
<Link id="l08897" /><CodeLine lineNumber="8897"><Highlight kind="normal">    <a href="/docs/api/namespaces/std/#ab8424022895aee3e366fb9a32f2883cb">std::swap</a>(BinOp, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64instrinfo-cpp/#abb0a82cf9ab3cf0c256918c17512f987aa66d3974b6f2e3a542f896da144cd297">Accumulator</a>);</Highlight></CodeLine>
<Link id="l08898" /><CodeLine lineNumber="8898"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08899" /><CodeLine lineNumber="8899"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vppartialreductionrecipe">VPPartialReductionRecipe</a>(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>-&gt;getOpcode(), BinOp,</Highlight></CodeLine>
<Link id="l08900" /><CodeLine lineNumber="8900"><Highlight kind="normal">                                      <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64instrinfo-cpp/#abb0a82cf9ab3cf0c256918c17512f987aa66d3974b6f2e3a542f896da144cd297">Accumulator</a>, <a href="/docs/api/files/lib/lib/transforms/lib/transforms/scalar/loopstrengthreduce-cpp/#a175f1f53cc9c3619505ffbd13aca087f">Reduction</a>);</Highlight></CodeLine>
<Link id="l08901" /><CodeLine lineNumber="8901"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08902" /><CodeLine lineNumber="8902"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08903" /><CodeLine lineNumber="8903"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> LoopVectorizationPlanner::buildVPlansWithVPRecipes(<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MinVF,</Highlight></CodeLine>
<Link id="l08904" /><CodeLine lineNumber="8904"><Highlight kind="normal">                                                        <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MaxVF) &#123;</Highlight></CodeLine>
<Link id="l08905" /><CodeLine lineNumber="8905"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a16165c1e5da45acaa086c3a54a188d34">isInnermost</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Inner loop expected.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08906" /><CodeLine lineNumber="8906"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08907" /><CodeLine lineNumber="8907"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> MaxVFTimes2 = MaxVF &#42; 2;</Highlight></CodeLine>
<Link id="l08908" /><CodeLine lineNumber="8908"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/elementcount">ElementCount</a> VF = MinVF; <a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a83e6442f8ebefccdb5e089732fe397ac">ElementCount::isKnownLT</a>(VF, MaxVFTimes2);) &#123;</Highlight></CodeLine>
<Link id="l08909" /><CodeLine lineNumber="8909"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/vfrange">VFRange</a> SubRange = &#123;VF, MaxVFTimes2&#125;;</Highlight></CodeLine>
<Link id="l08910" /><CodeLine lineNumber="8910"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Plan = tryToBuildVPlanWithVPRecipes(SubRange)) &#123;</Highlight></CodeLine>
<Link id="l08911" /><CodeLine lineNumber="8911"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Now optimize the initial VPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08912" /><CodeLine lineNumber="8912"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Plan-&gt;<a href="/docs/api/classes/llvm/vplan/#a633dd97e642c10e8aa1dff2bd2874edb">hasVF</a>(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1)))</Highlight></CodeLine>
<Link id="l08913" /><CodeLine lineNumber="8913"><Highlight kind="normal">        <a href="/docs/api/structs/llvm/vplantransforms/#ae61793492431f138869f097a5f31bd32">VPlanTransforms::truncateToMinimalBitwidths</a>(&#42;Plan,</Highlight></CodeLine>
<Link id="l08914" /><CodeLine lineNumber="8914"><Highlight kind="normal">                                                    CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a9fe7595d60ab8e1f3ee1da0846838113">getMinimalBitwidths</a>());</Highlight></CodeLine>
<Link id="l08915" /><CodeLine lineNumber="8915"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/vplantransforms/#ae3449b993cd1c459995c2fe13ef50892">VPlanTransforms::optimize</a>(&#42;Plan);</Highlight></CodeLine>
<Link id="l08916" /><CodeLine lineNumber="8916"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: try to put it close to addActiveLaneMask().</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08917" /><CodeLine lineNumber="8917"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Discard the plan if it is not EVL-compatible</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08918" /><CodeLine lineNumber="8918"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#ab0c7e793ca1b6b8a4f8c00a1bc1cb32f">foldTailWithEVL</a>() &amp;&amp; !<a href="/docs/api/structs/llvm/vplantransforms/#ad16bff9364e25351de81704fe81fd229">VPlanTransforms::tryAddExplicitVectorLength</a>(</Highlight></CodeLine>
<Link id="l08919" /><CodeLine lineNumber="8919"><Highlight kind="normal">                                      &#42;Plan, CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a36ed7dfdcdc1bca9eea99fc741511590">getMaxSafeElements</a>()))</Highlight></CodeLine>
<Link id="l08920" /><CodeLine lineNumber="8920"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08921" /><CodeLine lineNumber="8921"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#af5f1d1b7df16dee92c5b56c26e322b89">verifyVPlanIsValid</a>(&#42;Plan) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;VPlan is invalid&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08922" /><CodeLine lineNumber="8922"><Highlight kind="normal">      VPlans.push&#95;back(std::move(Plan));</Highlight></CodeLine>
<Link id="l08923" /><CodeLine lineNumber="8923"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l08924" /><CodeLine lineNumber="8924"><Highlight kind="normal">    VF = SubRange.<a href="/docs/api/structs/llvm/vfrange/#a8f3e6ec0ac823874aa93cc9d98081701">End</a>;</Highlight></CodeLine>
<Link id="l08925" /><CodeLine lineNumber="8925"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08926" /><CodeLine lineNumber="8926"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08927" /><CodeLine lineNumber="8927"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08928" /><CodeLine lineNumber="8928"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Add the necessary canonical IV and branch recipes required to control the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08929" /><CodeLine lineNumber="8929"><Highlight kind="normal"></Highlight><Highlight kind="comment">// loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08930" /><CodeLine lineNumber="8930" lineLink="#a4d2a943e39c98ccce6fd53e8df9c5c2b"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a4d2a943e39c98ccce6fd53e8df9c5c2b">addCanonicalIVRecipes</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/type">Type</a> &#42;IdxTy, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasNUW,</Highlight></CodeLine>
<Link id="l08931" /><CodeLine lineNumber="8931"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>) &#123;</Highlight></CodeLine>
<Link id="l08932" /><CodeLine lineNumber="8932"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;StartIdx = ConstantInt::get(IdxTy, 0);</Highlight></CodeLine>
<Link id="l08933" /><CodeLine lineNumber="8933"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;StartV = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(StartIdx);</Highlight></CodeLine>
<Link id="l08934" /><CodeLine lineNumber="8934"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08935" /><CodeLine lineNumber="8935"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add a VPCanonicalIVPHIRecipe starting at 0 to the header.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08936" /><CodeLine lineNumber="8936"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CanonicalIVPHI = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpcanonicalivphirecipe">VPCanonicalIVPHIRecipe</a>(StartV, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l08937" /><CodeLine lineNumber="8937"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;TopRegion = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</Highlight></CodeLine>
<Link id="l08938" /><CodeLine lineNumber="8938"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;Header = TopRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</Highlight></CodeLine>
<Link id="l08939" /><CodeLine lineNumber="8939"><Highlight kind="normal">  Header-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#adfdd504b078cce3b90e7c5cf1f5164db">insert</a>(CanonicalIVPHI, Header-&gt;begin());</Highlight></CodeLine>
<Link id="l08940" /><CodeLine lineNumber="8940"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08941" /><CodeLine lineNumber="8941"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> Builder(TopRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a28da654f916bf44da5513b6f1788835c">getExitingBasicBlock</a>());</Highlight></CodeLine>
<Link id="l08942" /><CodeLine lineNumber="8942"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add a VPInstruction to increment the scalar canonical IV by VF &#42; UF.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08943" /><CodeLine lineNumber="8943"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CanonicalIVIncrement = Builder.<a href="/docs/api/classes/llvm/vpbuilder/#ab3b191f35221f351f77883447fef4019">createOverflowingOp</a>(</Highlight></CodeLine>
<Link id="l08944" /><CodeLine lineNumber="8944"><Highlight kind="normal">      Instruction::Add, &#123;CanonicalIVPHI, &amp;Plan.<a href="/docs/api/classes/llvm/vplan/#a2d53ff30dd2a706e91c30d4f50982e3d">getVFxUF</a>()&#125;, &#123;HasNUW, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">&#125;, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>,</Highlight></CodeLine>
<Link id="l08945" /><CodeLine lineNumber="8945"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;index.next&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08946" /><CodeLine lineNumber="8946"><Highlight kind="normal">  CanonicalIVPHI-&gt;<a href="/docs/api/classes/llvm/vpuser/#af4a3b471097ab37b1672a0d88869ea51">addOperand</a>(CanonicalIVIncrement);</Highlight></CodeLine>
<Link id="l08947" /><CodeLine lineNumber="8947"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08948" /><CodeLine lineNumber="8948"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add the BranchOnCount VPInstruction to the latch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08949" /><CodeLine lineNumber="8949"><Highlight kind="normal">  Builder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a49dcace93798ddd457a9d4e584bbc9a2">VPInstruction::BranchOnCount</a>,</Highlight></CodeLine>
<Link id="l08950" /><CodeLine lineNumber="8950"><Highlight kind="normal">                       &#123;CanonicalIVIncrement, &amp;Plan.<a href="/docs/api/classes/llvm/vplan/#a233848f0bf7aef1aca22e6172e5d900d">getVectorTripCount</a>()&#125;, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l08951" /><CodeLine lineNumber="8951"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08952" /><CodeLine lineNumber="8952"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08953" /><CodeLine lineNumber="8953"><Highlight kind="comment">/// Create and return a ResumePhi for \\p WideIV, unless it is truncated. If the</Highlight></CodeLine>
<Link id="l08954" /><CodeLine lineNumber="8954"><Highlight kind="comment">/// induction recipe is not canonical, creates a VPDerivedIVRecipe to compute</Highlight></CodeLine>
<Link id="l08955" /><CodeLine lineNumber="8955"><Highlight kind="comment">/// the end value of the induction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08956" /><CodeLine lineNumber="8956" lineLink="#a20c2e870e2c105fbf0945df09a9a5c4d"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a> &#42;<a href="#a20c2e870e2c105fbf0945df09a9a5c4d">addResumePhiRecipeForInduction</a>(</Highlight></CodeLine>
<Link id="l08957" /><CodeLine lineNumber="8957"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpwideninductionrecipe">VPWidenInductionRecipe</a> &#42;WideIV, <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> &amp;VectorPHBuilder,</Highlight></CodeLine>
<Link id="l08958" /><CodeLine lineNumber="8958"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> &amp;ScalarPHBuilder, <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> &amp;TypeInfo, <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;VectorTC) &#123;</Highlight></CodeLine>
<Link id="l08959" /><CodeLine lineNumber="8959"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WideIntOrFp = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenIntOrFpInductionRecipe&gt;</a>(WideIV);</Highlight></CodeLine>
<Link id="l08960" /><CodeLine lineNumber="8960"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Truncated wide inductions resume from the last lane of their vector value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08961" /><CodeLine lineNumber="8961"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in the last vector iteration which is handled elsewhere.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08962" /><CodeLine lineNumber="8962"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (WideIntOrFp &amp;&amp; WideIntOrFp-&gt;getTruncInst())</Highlight></CodeLine>
<Link id="l08963" /><CodeLine lineNumber="8963"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l08964" /><CodeLine lineNumber="8964"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08965" /><CodeLine lineNumber="8965"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Start = WideIV-&gt;<a href="/docs/api/classes/llvm/vpheaderphirecipe/#a92c12c8e69e03cc781dd010cdaa5f0e6">getStartValue</a>();</Highlight></CodeLine>
<Link id="l08966" /><CodeLine lineNumber="8966"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;Step = WideIV-&gt;<a href="/docs/api/classes/llvm/vpwideninductionrecipe/#a74f9beabcc57857ae7a7ba943e72776b">getStepValue</a>();</Highlight></CodeLine>
<Link id="l08967" /><CodeLine lineNumber="8967"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/inductiondescriptor">InductionDescriptor</a> &amp;<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a> = WideIV-&gt;<a href="/docs/api/classes/llvm/vpwideninductionrecipe/#a82694b8412f0f864ede96af458b2fb87">getInductionDescriptor</a>();</Highlight></CodeLine>
<Link id="l08968" /><CodeLine lineNumber="8968"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;EndValue = VectorTC;</Highlight></CodeLine>
<Link id="l08969" /><CodeLine lineNumber="8969"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!WideIntOrFp || !WideIntOrFp-&gt;isCanonical()) &#123;</Highlight></CodeLine>
<Link id="l08970" /><CodeLine lineNumber="8970"><Highlight kind="normal">    EndValue = VectorPHBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#a3d75b91bc4016f3078bab29877d8b68e">createDerivedIV</a>(</Highlight></CodeLine>
<Link id="l08971" /><CodeLine lineNumber="8971"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getKind(), <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;FPMathOperator&gt;</a>(<a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>.getInductionBinOp()),</Highlight></CodeLine>
<Link id="l08972" /><CodeLine lineNumber="8972"><Highlight kind="normal">        Start, VectorTC, Step);</Highlight></CodeLine>
<Link id="l08973" /><CodeLine lineNumber="8973"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08974" /><CodeLine lineNumber="8974"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08975" /><CodeLine lineNumber="8975"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// EndValue is derived from the vector trip count (which has the same type as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08976" /><CodeLine lineNumber="8976"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the widest induction) and thus may be wider than the induction here.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08977" /><CodeLine lineNumber="8977"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/type">Type</a> &#42;ScalarTypeOfWideIV = TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(WideIV);</Highlight></CodeLine>
<Link id="l08978" /><CodeLine lineNumber="8978"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ScalarTypeOfWideIV != TypeInfo.<a href="/docs/api/classes/llvm/vptypeanalysis/#aac3fb75b481d61e325b6d869d0f5f278">inferScalarType</a>(EndValue)) &#123;</Highlight></CodeLine>
<Link id="l08979" /><CodeLine lineNumber="8979"><Highlight kind="normal">    EndValue = VectorPHBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#a7651e884685052147f007e0e0fe0c774">createScalarCast</a>(Instruction::Trunc, EndValue,</Highlight></CodeLine>
<Link id="l08980" /><CodeLine lineNumber="8980"><Highlight kind="normal">                                                ScalarTypeOfWideIV,</Highlight></CodeLine>
<Link id="l08981" /><CodeLine lineNumber="8981"><Highlight kind="normal">                                                WideIV-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a733c4c530159a8b86223376c0696430e">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l08982" /><CodeLine lineNumber="8982"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l08983" /><CodeLine lineNumber="8983"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08984" /><CodeLine lineNumber="8984"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ResumePhiRecipe =</Highlight></CodeLine>
<Link id="l08985" /><CodeLine lineNumber="8985"><Highlight kind="normal">      ScalarPHBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(<a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a36144832b0ebcda13ce881d2b60eaf91">VPInstruction::ResumePhi</a>, &#123;EndValue, Start&#125;,</Highlight></CodeLine>
<Link id="l08986" /><CodeLine lineNumber="8986"><Highlight kind="normal">                                   WideIV-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a733c4c530159a8b86223376c0696430e">getDebugLoc</a>(), </Highlight><Highlight kind="stringliteral">&quot;bc.resume.val&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l08987" /><CodeLine lineNumber="8987"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ResumePhiRecipe;</Highlight></CodeLine>
<Link id="l08988" /><CodeLine lineNumber="8988"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l08989" /><CodeLine lineNumber="8989"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l08990" /><CodeLine lineNumber="8990"><Highlight kind="comment">/// Create resume phis in the scalar preheader for first-order recurrences,</Highlight></CodeLine>
<Link id="l08991" /><CodeLine lineNumber="8991"><Highlight kind="comment">/// reductions and inductions, and update the VPIRInstructions wrapping the</Highlight></CodeLine>
<Link id="l08992" /><CodeLine lineNumber="8992"><Highlight kind="comment">/// original phis in the scalar header. End values for inductions are added to</Highlight></CodeLine>
<Link id="l08993" /><CodeLine lineNumber="8993"><Highlight kind="comment">/// \\p IVEndValues.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l08994" /><CodeLine lineNumber="8994" lineLink="#a02106664ead4e0c4e755457dbac7f7b3"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a02106664ead4e0c4e755457dbac7f7b3">addScalarResumePhis</a>(<a href="/docs/api/classes/llvm/vprecipebuilder">VPRecipeBuilder</a> &amp;Builder, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan,</Highlight></CodeLine>
<Link id="l08995" /><CodeLine lineNumber="8995"><Highlight kind="normal">                                <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;VPValue &#42;, VPValue &#42;&gt;</a> &amp;IVEndValues) &#123;</Highlight></CodeLine>
<Link id="l08996" /><CodeLine lineNumber="8996"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vptypeanalysis">VPTypeAnalysis</a> TypeInfo(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>());</Highlight></CodeLine>
<Link id="l08997" /><CodeLine lineNumber="8997"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ScalarPH = Plan.<a href="/docs/api/classes/llvm/vplan/#ad5f29ccf71b0494fc179323427eb1e11">getScalarPreheader</a>();</Highlight></CodeLine>
<Link id="l08998" /><CodeLine lineNumber="8998"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MiddleVPBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(ScalarPH-&gt;getSinglePredecessor());</Highlight></CodeLine>
<Link id="l08999" /><CodeLine lineNumber="8999"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;VectorRegion = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</Highlight></CodeLine>
<Link id="l09000" /><CodeLine lineNumber="9000"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> VectorPHBuilder(</Highlight></CodeLine>
<Link id="l09001" /><CodeLine lineNumber="9001"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aa1bb4808c7a5db9f8ed3f479c78c4b5e">getSinglePredecessor</a>()));</Highlight></CodeLine>
<Link id="l09002" /><CodeLine lineNumber="9002"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> MiddleBuilder(MiddleVPBB, MiddleVPBB-&gt;getFirstNonPhi());</Highlight></CodeLine>
<Link id="l09003" /><CodeLine lineNumber="9003"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> ScalarPHBuilder(ScalarPH);</Highlight></CodeLine>
<Link id="l09004" /><CodeLine lineNumber="9004"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;OneVPV = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(</Highlight></CodeLine>
<Link id="l09005" /><CodeLine lineNumber="9005"><Highlight kind="normal">      ConstantInt::get(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>(), 1));</Highlight></CodeLine>
<Link id="l09006" /><CodeLine lineNumber="9006"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;ScalarPhiR : &#42;Plan.<a href="/docs/api/classes/llvm/vplan/#ae56a6505c6bfa319e686fc23acd52495">getScalarHeader</a>()) &#123;</Highlight></CodeLine>
<Link id="l09007" /><CodeLine lineNumber="9007"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ScalarPhiIRI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPIRInstruction&gt;</a>(&amp;ScalarPhiR);</Highlight></CodeLine>
<Link id="l09008" /><CodeLine lineNumber="9008"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ScalarPhiI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;ScalarPhiIRI-&gt;getInstruction());</Highlight></CodeLine>
<Link id="l09009" /><CodeLine lineNumber="9009"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ScalarPhiI)</Highlight></CodeLine>
<Link id="l09010" /><CodeLine lineNumber="9010"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09011" /><CodeLine lineNumber="9011"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09012" /><CodeLine lineNumber="9012"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Extract final value from induction recipe initially, optimize to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09013" /><CodeLine lineNumber="9013"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// pre-computed end value together in optimizeInductionExitUsers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09014" /><CodeLine lineNumber="9014"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VectorPhiR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPHeaderPHIRecipe&gt;</a>(Builder.<a href="/docs/api/classes/llvm/vprecipebuilder/#af5f874dc688e86699e648825bfcbf495">getRecipe</a>(ScalarPhiI));</Highlight></CodeLine>
<Link id="l09015" /><CodeLine lineNumber="9015"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;WideIVR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPWidenInductionRecipe&gt;</a>(VectorPhiR)) &#123;</Highlight></CodeLine>
<Link id="l09016" /><CodeLine lineNumber="9016"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpinstruction">VPInstruction</a> &#42;ResumePhi = <a href="#a20c2e870e2c105fbf0945df09a9a5c4d">addResumePhiRecipeForInduction</a>(</Highlight></CodeLine>
<Link id="l09017" /><CodeLine lineNumber="9017"><Highlight kind="normal">              WideIVR, VectorPHBuilder, ScalarPHBuilder, TypeInfo,</Highlight></CodeLine>
<Link id="l09018" /><CodeLine lineNumber="9018"><Highlight kind="normal">              &amp;Plan.<a href="/docs/api/classes/llvm/vplan/#a233848f0bf7aef1aca22e6172e5d900d">getVectorTripCount</a>())) &#123;</Highlight></CodeLine>
<Link id="l09019" /><CodeLine lineNumber="9019"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ResumePhi-&gt;getOpcode() == <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a36144832b0ebcda13ce881d2b60eaf91">VPInstruction::ResumePhi</a> &amp;&amp;</Highlight></CodeLine>
<Link id="l09020" /><CodeLine lineNumber="9020"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;Expected a ResumePhi&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09021" /><CodeLine lineNumber="9021"><Highlight kind="normal">        IVEndValues&#91;WideIVR&#93; = ResumePhi-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l09022" /><CodeLine lineNumber="9022"><Highlight kind="normal">        ScalarPhiIRI-&gt;addOperand(ResumePhi);</Highlight></CodeLine>
<Link id="l09023" /><CodeLine lineNumber="9023"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09024" /><CodeLine lineNumber="9024"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l09025" /><CodeLine lineNumber="9025"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// TODO: Also handle truncated inductions here. Computing end-values</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09026" /><CodeLine lineNumber="9026"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// separately should be done as VPlan-to-VPlan optimization, after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09027" /><CodeLine lineNumber="9027"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// legalizing all resume values to use the last lane from the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09028" /><CodeLine lineNumber="9028"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenIntOrFpInductionRecipe&gt;</a>(VectorPhiR)-&gt;getTruncInst() &amp;&amp;</Highlight></CodeLine>
<Link id="l09029" /><CodeLine lineNumber="9029"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;should only skip truncated wide inductions&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09030" /><CodeLine lineNumber="9030"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09031" /><CodeLine lineNumber="9031"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09032" /><CodeLine lineNumber="9032"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09033" /><CodeLine lineNumber="9033"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The backedge value provides the value to resume coming out of a loop,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09034" /><CodeLine lineNumber="9034"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// which for FORs is a vector whose last element needs to be extracted. The</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09035" /><CodeLine lineNumber="9035"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// start value provides the value if the loop is bypassed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09036" /><CodeLine lineNumber="9036"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsFOR = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPFirstOrderRecurrencePHIRecipe&gt;</a>(VectorPhiR);</Highlight></CodeLine>
<Link id="l09037" /><CodeLine lineNumber="9037"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ResumeFromVectorLoop = VectorPhiR-&gt;getBackedgeValue();</Highlight></CodeLine>
<Link id="l09038" /><CodeLine lineNumber="9038"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>() == Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l09039" /><CodeLine lineNumber="9039"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Cannot handle loops with uncountable early exits&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09040" /><CodeLine lineNumber="9040"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsFOR)</Highlight></CodeLine>
<Link id="l09041" /><CodeLine lineNumber="9041"><Highlight kind="normal">      ResumeFromVectorLoop = MiddleBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(</Highlight></CodeLine>
<Link id="l09042" /><CodeLine lineNumber="9042"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2ad6b029191d02f4c7a7dda59e44c88ab6">VPInstruction::ExtractFromEnd</a>, &#123;ResumeFromVectorLoop, OneVPV&#125;, &#123;&#125;,</Highlight></CodeLine>
<Link id="l09043" /><CodeLine lineNumber="9043"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;vector.recur.extract&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09044" /><CodeLine lineNumber="9044"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/stringref">StringRef</a> Name = IsFOR ? </Highlight><Highlight kind="stringliteral">&quot;scalar.recur.init&quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;bc.merge.rdx&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09045" /><CodeLine lineNumber="9045"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ResumePhiR = ScalarPHBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(</Highlight></CodeLine>
<Link id="l09046" /><CodeLine lineNumber="9046"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a36144832b0ebcda13ce881d2b60eaf91">VPInstruction::ResumePhi</a>,</Highlight></CodeLine>
<Link id="l09047" /><CodeLine lineNumber="9047"><Highlight kind="normal">        &#123;ResumeFromVectorLoop, VectorPhiR-&gt;getStartValue()&#125;, &#123;&#125;, Name);</Highlight></CodeLine>
<Link id="l09048" /><CodeLine lineNumber="9048"><Highlight kind="normal">    ScalarPhiIRI-&gt;<a href="/docs/api/classes/llvm/vpuser/#af4a3b471097ab37b1672a0d88869ea51">addOperand</a>(ResumePhiR);</Highlight></CodeLine>
<Link id="l09049" /><CodeLine lineNumber="9049"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09050" /><CodeLine lineNumber="9050"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l09051" /><CodeLine lineNumber="9051"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09052" /><CodeLine lineNumber="9052"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Collect VPIRInstructions for phis in the exit blocks that are modeled</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09053" /><CodeLine lineNumber="9053"><Highlight kind="normal"></Highlight><Highlight kind="comment">// in VPlan and add the exiting VPValue as operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09054" /><CodeLine lineNumber="9054"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/setvector">SetVector&lt;VPIRInstruction &#42;&gt;</a></Highlight></CodeLine>
<Link id="l09055" /><CodeLine lineNumber="9055" lineLink="#a435b95efad7ea03299bd527b55b4708a"><Highlight kind="normal"><a href="#a435b95efad7ea03299bd527b55b4708a">collectUsersInExitBlocks</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;OrigLoop, <a href="/docs/api/classes/llvm/vprecipebuilder">VPRecipeBuilder</a> &amp;Builder,</Highlight></CodeLine>
<Link id="l09056" /><CodeLine lineNumber="9056"><Highlight kind="normal">                         <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan) &#123;</Highlight></CodeLine>
<Link id="l09057" /><CodeLine lineNumber="9057"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;VPIRInstruction &#42;&gt;</a> ExitUsersToFix;</Highlight></CodeLine>
<Link id="l09058" /><CodeLine lineNumber="9058"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpirbasicblock">VPIRBasicBlock</a> &#42;ExitVPBB : Plan.<a href="/docs/api/classes/llvm/vplan/#a85800ca7a821f540ad2d6d4d3c2d4208">getExitBlocks</a>()) &#123;</Highlight></CodeLine>
<Link id="l09059" /><CodeLine lineNumber="9059"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : &#42;ExitVPBB) &#123;</Highlight></CodeLine>
<Link id="l09060" /><CodeLine lineNumber="9060"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExitIRI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPIRInstruction&gt;</a>(&amp;R);</Highlight></CodeLine>
<Link id="l09061" /><CodeLine lineNumber="9061"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ExitIRI)</Highlight></CodeLine>
<Link id="l09062" /><CodeLine lineNumber="9062"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09063" /><CodeLine lineNumber="9063"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExitPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;ExitIRI-&gt;getInstruction());</Highlight></CodeLine>
<Link id="l09064" /><CodeLine lineNumber="9064"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ExitPhi)</Highlight></CodeLine>
<Link id="l09065" /><CodeLine lineNumber="9065"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09066" /><CodeLine lineNumber="9066"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExitVPBB-&gt;getSinglePredecessor() != Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>()) &#123;</Highlight></CodeLine>
<Link id="l09067" /><CodeLine lineNumber="9067"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExitIRI-&gt;getNumOperands() ==</Highlight></CodeLine>
<Link id="l09068" /><CodeLine lineNumber="9068"><Highlight kind="normal">                   ExitVPBB-&gt;getPredecessors().size() &amp;&amp;</Highlight></CodeLine>
<Link id="l09069" /><CodeLine lineNumber="9069"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;early-exit must update exit values on construction&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09070" /><CodeLine lineNumber="9070"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09071" /><CodeLine lineNumber="9071"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l09072" /><CodeLine lineNumber="9072"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitingBB = OrigLoop-&gt;<a href="/docs/api/classes/llvm/loopbase/#a1230fd674d2609b96527fe65eaf40b1b">getLoopLatch</a>();</Highlight></CodeLine>
<Link id="l09073" /><CodeLine lineNumber="9073"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;IncomingValue = ExitPhi-&gt;getIncomingValueForBlock(ExitingBB);</Highlight></CodeLine>
<Link id="l09074" /><CodeLine lineNumber="9074"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;V = Builder.<a href="/docs/api/classes/llvm/vprecipebuilder/#a7951985b28c0786b4ca50f061172ff22">getVPValueOrAddLiveIn</a>(IncomingValue);</Highlight></CodeLine>
<Link id="l09075" /><CodeLine lineNumber="9075"><Highlight kind="normal">      ExitIRI-&gt;addOperand(V);</Highlight></CodeLine>
<Link id="l09076" /><CodeLine lineNumber="9076"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (V-&gt;isLiveIn())</Highlight></CodeLine>
<Link id="l09077" /><CodeLine lineNumber="9077"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09078" /><CodeLine lineNumber="9078"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(V-&gt;getDefiningRecipe()-&gt;getParent()-&gt;getEnclosingLoopRegion() &amp;&amp;</Highlight></CodeLine>
<Link id="l09079" /><CodeLine lineNumber="9079"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Only recipes defined inside a region should need fixing.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09080" /><CodeLine lineNumber="9080"><Highlight kind="normal">      ExitUsersToFix.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(ExitIRI);</Highlight></CodeLine>
<Link id="l09081" /><CodeLine lineNumber="9081"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09082" /><CodeLine lineNumber="9082"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09083" /><CodeLine lineNumber="9083"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> ExitUsersToFix;</Highlight></CodeLine>
<Link id="l09084" /><CodeLine lineNumber="9084"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l09085" /><CodeLine lineNumber="9085"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09086" /><CodeLine lineNumber="9086"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Add exit values to \\p Plan. Extracts are added for each entry in \\p</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09087" /><CodeLine lineNumber="9087"><Highlight kind="normal"></Highlight><Highlight kind="comment">// ExitUsersToFix if needed and their operands are updated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09088" /><CodeLine lineNumber="9088"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09089" /><CodeLine lineNumber="9089" lineLink="#af34d746d08a380c672cae45176f9df87"><Highlight kind="normal"><a href="#af34d746d08a380c672cae45176f9df87">addUsersInExitBlocks</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan,</Highlight></CodeLine>
<Link id="l09090" /><CodeLine lineNumber="9090"><Highlight kind="normal">                     </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/setvector">SetVector&lt;VPIRInstruction &#42;&gt;</a> &amp;ExitUsersToFix) &#123;</Highlight></CodeLine>
<Link id="l09091" /><CodeLine lineNumber="9091"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExitUsersToFix.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>())</Highlight></CodeLine>
<Link id="l09092" /><CodeLine lineNumber="9092"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09093" /><CodeLine lineNumber="9093"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09094" /><CodeLine lineNumber="9094"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MiddleVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>();</Highlight></CodeLine>
<Link id="l09095" /><CodeLine lineNumber="9095"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>(MiddleVPBB, MiddleVPBB-&gt;getFirstNonPhi());</Highlight></CodeLine>
<Link id="l09096" /><CodeLine lineNumber="9096"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09097" /><CodeLine lineNumber="9097"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Introduce extract for exiting values and update the VPIRInstructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09098" /><CodeLine lineNumber="9098"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// modeling the corresponding LCSSA phis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09099" /><CodeLine lineNumber="9099"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpirinstruction">VPIRInstruction</a> &#42;ExitIRI : ExitUsersToFix) &#123;</Highlight></CodeLine>
<Link id="l09100" /><CodeLine lineNumber="9100"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExitIRI-&gt;getNumOperands() == 1 &amp;&amp;</Highlight></CodeLine>
<Link id="l09101" /><CodeLine lineNumber="9101"><Highlight kind="normal">           ExitIRI-&gt;getParent()-&gt;getSinglePredecessor() == MiddleVPBB &amp;&amp;</Highlight></CodeLine>
<Link id="l09102" /><CodeLine lineNumber="9102"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;exit values from early exits must be fixed when branch to &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09103" /><CodeLine lineNumber="9103"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;early-exit is added&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09104" /><CodeLine lineNumber="9104"><Highlight kind="normal">    ExitIRI-&gt;extractLastLaneOfOperand(<a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#ae76959fe811ba090de4cba69ac00f1da">B</a>);</Highlight></CodeLine>
<Link id="l09105" /><CodeLine lineNumber="9105"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09106" /><CodeLine lineNumber="9106"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l09107" /><CodeLine lineNumber="9107"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l09108" /><CodeLine lineNumber="9108"><Highlight kind="comment">/// Handle users in the exit block for first order reductions in the original</Highlight></CodeLine>
<Link id="l09109" /><CodeLine lineNumber="9109"><Highlight kind="comment">/// exit block. The penultimate value of recurrences is fed to their LCSSA phi</Highlight></CodeLine>
<Link id="l09110" /><CodeLine lineNumber="9110"><Highlight kind="comment">/// users in the original exit block using the VPIRInstruction wrapping to the</Highlight></CodeLine>
<Link id="l09111" /><CodeLine lineNumber="9111"><Highlight kind="comment">/// LCSSA phi.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09112" /><CodeLine lineNumber="9112" lineLink="#a453563e4ed7e249a7f3e92b98b9052df"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a453563e4ed7e249a7f3e92b98b9052df">addExitUsersForFirstOrderRecurrences</a>(</Highlight></CodeLine>
<Link id="l09113" /><CodeLine lineNumber="9113"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/setvector">SetVector&lt;VPIRInstruction &#42;&gt;</a> &amp;ExitUsersToFix) &#123;</Highlight></CodeLine>
<Link id="l09114" /><CodeLine lineNumber="9114"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;VectorRegion = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</Highlight></CodeLine>
<Link id="l09115" /><CodeLine lineNumber="9115"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ScalarPHVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#ad5f29ccf71b0494fc179323427eb1e11">getScalarPreheader</a>();</Highlight></CodeLine>
<Link id="l09116" /><CodeLine lineNumber="9116"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MiddleVPBB = Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>();</Highlight></CodeLine>
<Link id="l09117" /><CodeLine lineNumber="9117"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> ScalarPHBuilder(ScalarPHVPBB);</Highlight></CodeLine>
<Link id="l09118" /><CodeLine lineNumber="9118"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> MiddleBuilder(MiddleVPBB, MiddleVPBB-&gt;getFirstNonPhi());</Highlight></CodeLine>
<Link id="l09119" /><CodeLine lineNumber="9119"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;TwoVPV = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(</Highlight></CodeLine>
<Link id="l09120" /><CodeLine lineNumber="9120"><Highlight kind="normal">      ConstantInt::get(Plan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpcanonicalivphirecipe/#ac8744d8abf2a7ed185cc14f0a305cf8e">getScalarType</a>(), 2));</Highlight></CodeLine>
<Link id="l09121" /><CodeLine lineNumber="9121"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09122" /><CodeLine lineNumber="9122"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;HeaderPhi : VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l09123" /><CodeLine lineNumber="9123"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;FOR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPFirstOrderRecurrencePHIRecipe&gt;</a>(&amp;HeaderPhi);</Highlight></CodeLine>
<Link id="l09124" /><CodeLine lineNumber="9124"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!FOR)</Highlight></CodeLine>
<Link id="l09125" /><CodeLine lineNumber="9125"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09126" /><CodeLine lineNumber="9126"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09127" /><CodeLine lineNumber="9127"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VectorRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>() == Plan.<a href="/docs/api/classes/llvm/vplan/#a995b2a034ffc26dcd2f3a679f9d2feea">getMiddleBlock</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l09128" /><CodeLine lineNumber="9128"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;Cannot handle loops with uncountable early exits&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09129" /><CodeLine lineNumber="9129"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09130" /><CodeLine lineNumber="9130"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// This is the second phase of vectorizing first-order recurrences, creating</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09131" /><CodeLine lineNumber="9131"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// extract for users outside the loop. An overview of the transformation is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09132" /><CodeLine lineNumber="9132"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// described below. Suppose we have the following loop with some use after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09133" /><CodeLine lineNumber="9133"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the loop of the last a&#91;i-1&#93;,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09134" /><CodeLine lineNumber="9134"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09135" /><CodeLine lineNumber="9135"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   for (int i = 0; i &lt; n; ++i) &#123;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09136" /><CodeLine lineNumber="9136"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     t = a&#91;i - 1&#93;;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09137" /><CodeLine lineNumber="9137"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     b&#91;i&#93; = a&#91;i&#93; - t;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09138" /><CodeLine lineNumber="9138"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   &#125;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09139" /><CodeLine lineNumber="9139"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   use t;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09140" /><CodeLine lineNumber="9140"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09141" /><CodeLine lineNumber="9141"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// There is a first-order recurrence on &quot;a&quot;. For this loop, the shorthand</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09142" /><CodeLine lineNumber="9142"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// scalar IR looks like:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09143" /><CodeLine lineNumber="9143"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09144" /><CodeLine lineNumber="9144"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   scalar.ph:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09145" /><CodeLine lineNumber="9145"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     s.init = a&#91;-1&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09146" /><CodeLine lineNumber="9146"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     br scalar.body</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09147" /><CodeLine lineNumber="9147"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09148" /><CodeLine lineNumber="9148"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   scalar.body:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09149" /><CodeLine lineNumber="9149"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     i = phi &#91;0, scalar.ph&#93;, &#91;i+1, scalar.body&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09150" /><CodeLine lineNumber="9150"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     s1 = phi &#91;s.init, scalar.ph&#93;, &#91;s2, scalar.body&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09151" /><CodeLine lineNumber="9151"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     s2 = a&#91;i&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09152" /><CodeLine lineNumber="9152"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     b&#91;i&#93; = s2 - s1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09153" /><CodeLine lineNumber="9153"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     br cond, scalar.body, exit.block</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09154" /><CodeLine lineNumber="9154"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09155" /><CodeLine lineNumber="9155"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   exit.block:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09156" /><CodeLine lineNumber="9156"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     use = lcssa.phi &#91;s1, scalar.body&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09157" /><CodeLine lineNumber="9157"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09158" /><CodeLine lineNumber="9158"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// In this example, s1 is a recurrence because it&#39;s value depends on the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09159" /><CodeLine lineNumber="9159"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// previous iteration. In the first phase of vectorization, we created a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09160" /><CodeLine lineNumber="9160"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// VPFirstOrderRecurrencePHIRecipe v1 for s1. Now we create the extracts</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09161" /><CodeLine lineNumber="9161"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// for users in the scalar preheader and exit block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09162" /><CodeLine lineNumber="9162"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09163" /><CodeLine lineNumber="9163"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   vector.ph:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09164" /><CodeLine lineNumber="9164"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     v&#95;init = vector(..., ..., ..., a&#91;-1&#93;)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09165" /><CodeLine lineNumber="9165"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     br vector.body</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09166" /><CodeLine lineNumber="9166"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09167" /><CodeLine lineNumber="9167"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   vector.body</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09168" /><CodeLine lineNumber="9168"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     i = phi &#91;0, vector.ph&#93;, &#91;i+4, vector.body&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09169" /><CodeLine lineNumber="9169"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     v1 = phi &#91;v&#95;init, vector.ph&#93;, &#91;v2, vector.body&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09170" /><CodeLine lineNumber="9170"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     v2 = a&#91;i, i+1, i+2, i+3&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09171" /><CodeLine lineNumber="9171"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     b&#91;i&#93; = v2 - v1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09172" /><CodeLine lineNumber="9172"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     // Next, third phase will introduce v1&#39; = splice(v1(3), v2(0, 1, 2))</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09173" /><CodeLine lineNumber="9173"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     b&#91;i, i+1, i+2, i+3&#93; = v2 - v1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09174" /><CodeLine lineNumber="9174"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     br cond, vector.body, middle.block</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09175" /><CodeLine lineNumber="9175"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09176" /><CodeLine lineNumber="9176"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   middle.block:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09177" /><CodeLine lineNumber="9177"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     vector.recur.extract.for.phi = v2(2)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09178" /><CodeLine lineNumber="9178"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     vector.recur.extract = v2(3)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09179" /><CodeLine lineNumber="9179"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     br cond, scalar.ph, exit.block</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09180" /><CodeLine lineNumber="9180"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09181" /><CodeLine lineNumber="9181"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   scalar.ph:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09182" /><CodeLine lineNumber="9182"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     scalar.recur.init = phi &#91;vector.recur.extract, middle.block&#93;,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09183" /><CodeLine lineNumber="9183"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//                             &#91;s.init, otherwise&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09184" /><CodeLine lineNumber="9184"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     br scalar.body</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09185" /><CodeLine lineNumber="9185"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09186" /><CodeLine lineNumber="9186"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   scalar.body:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09187" /><CodeLine lineNumber="9187"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     i = phi &#91;0, scalar.ph&#93;, &#91;i+1, scalar.body&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09188" /><CodeLine lineNumber="9188"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     s1 = phi &#91;scalar.recur.init, scalar.ph&#93;, &#91;s2, scalar.body&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09189" /><CodeLine lineNumber="9189"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     s2 = a&#91;i&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09190" /><CodeLine lineNumber="9190"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     b&#91;i&#93; = s2 - s1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09191" /><CodeLine lineNumber="9191"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     br cond, scalar.body, exit.block</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09192" /><CodeLine lineNumber="9192"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09193" /><CodeLine lineNumber="9193"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//   exit.block:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09194" /><CodeLine lineNumber="9194"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//     lo = lcssa.phi &#91;s1, scalar.body&#93;,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09195" /><CodeLine lineNumber="9195"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//                    &#91;vector.recur.extract.for.phi, middle.block&#93;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09196" /><CodeLine lineNumber="9196"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09197" /><CodeLine lineNumber="9197"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Now update VPIRInstructions modeling LCSSA phis in the exit block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09198" /><CodeLine lineNumber="9198"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Extract the penultimate value of the recurrence and use it as operand for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09199" /><CodeLine lineNumber="9199"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the VPIRInstruction modeling the phi.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09200" /><CodeLine lineNumber="9200"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vpirinstruction">VPIRInstruction</a> &#42;ExitIRI : ExitUsersToFix) &#123;</Highlight></CodeLine>
<Link id="l09201" /><CodeLine lineNumber="9201"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExitIRI-&gt;getOperand(0) != FOR)</Highlight></CodeLine>
<Link id="l09202" /><CodeLine lineNumber="9202"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09203" /><CodeLine lineNumber="9203"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;PenultimateElement = MiddleBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(</Highlight></CodeLine>
<Link id="l09204" /><CodeLine lineNumber="9204"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2ad6b029191d02f4c7a7dda59e44c88ab6">VPInstruction::ExtractFromEnd</a>, &#123;FOR-&gt;getBackedgeValue(), TwoVPV&#125;, &#123;&#125;,</Highlight></CodeLine>
<Link id="l09205" /><CodeLine lineNumber="9205"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;vector.recur.extract.for.phi&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09206" /><CodeLine lineNumber="9206"><Highlight kind="normal">      ExitIRI-&gt;<a href="/docs/api/classes/llvm/vpuser/#a19c3591dc1eeb5648552b33f70e04b65">setOperand</a>(0, PenultimateElement);</Highlight></CodeLine>
<Link id="l09207" /><CodeLine lineNumber="9207"><Highlight kind="normal">      ExitUsersToFix.remove(ExitIRI);</Highlight></CodeLine>
<Link id="l09208" /><CodeLine lineNumber="9208"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09209" /><CodeLine lineNumber="9209"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09210" /><CodeLine lineNumber="9210"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l09211" /><CodeLine lineNumber="9211"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09212" /><CodeLine lineNumber="9212"><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/#aefc42f3cefc5a839ca925b4cb3ae4a7b">VPlanPtr</a></Highlight></CodeLine>
<Link id="l09213" /><CodeLine lineNumber="9213"><Highlight kind="normal">LoopVectorizationPlanner::tryToBuildVPlanWithVPRecipes(<a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</Highlight></CodeLine>
<Link id="l09214" /><CodeLine lineNumber="9214"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09215" /><CodeLine lineNumber="9215"><Highlight kind="normal">  SmallPtrSet&lt;const InterleaveGroup&lt;Instruction&gt; &#42;, 1&gt; InterleaveGroups;</Highlight></CodeLine>
<Link id="l09216" /><CodeLine lineNumber="9216"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09217" /><CodeLine lineNumber="9217"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ---------------------------------------------------------------------------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09218" /><CodeLine lineNumber="9218"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Build initial VPlan: Scan the body of the loop in a topological order to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09219" /><CodeLine lineNumber="9219"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// visit each basic block after having visited its predecessor basic blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09220" /><CodeLine lineNumber="9220"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ---------------------------------------------------------------------------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09221" /><CodeLine lineNumber="9221"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09222" /><CodeLine lineNumber="9222"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create initial VPlan skeleton, having a basic block for the pre-header</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09223" /><CodeLine lineNumber="9223"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// which contains SCEV expansions that need to happen before the CFG is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09224" /><CodeLine lineNumber="9224"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// modified; a basic block for the vector pre-header, followed by a region for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09225" /><CodeLine lineNumber="9225"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the vector loop, followed by the middle basic block. The skeleton vector</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09226" /><CodeLine lineNumber="9226"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// loop region contains a header and latch basic blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09227" /><CodeLine lineNumber="9227"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09228" /><CodeLine lineNumber="9228"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> RequiresScalarEpilogueCheck =</Highlight></CodeLine>
<Link id="l09229" /><CodeLine lineNumber="9229"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">LoopVectorizationPlanner::getDecisionAndClampRange</a>(</Highlight></CodeLine>
<Link id="l09230" /><CodeLine lineNumber="9230"><Highlight kind="normal">          &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(ElementCount VF) &#123;</Highlight></CodeLine>
<Link id="l09231" /><CodeLine lineNumber="9231"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> !CM.requiresScalarEpilogue(VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>());</Highlight></CodeLine>
<Link id="l09232" /><CodeLine lineNumber="9232"><Highlight kind="normal">          &#125;,</Highlight></CodeLine>
<Link id="l09233" /><CodeLine lineNumber="9233"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</Highlight></CodeLine>
<Link id="l09234" /><CodeLine lineNumber="9234"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#aefc42f3cefc5a839ca925b4cb3ae4a7b">VPlanPtr</a> Plan = <a href="/docs/api/classes/llvm/vplan/#a5a956378c8f267d4b2afc6e036a08d42">VPlan::createInitialVPlan</a>(Legal-&gt;getWidestInductionType(),</Highlight></CodeLine>
<Link id="l09235" /><CodeLine lineNumber="9235"><Highlight kind="normal">                                            PSE, RequiresScalarEpilogueCheck,</Highlight></CodeLine>
<Link id="l09236" /><CodeLine lineNumber="9236"><Highlight kind="normal">                                            CM.foldTailByMasking(), OrigLoop);</Highlight></CodeLine>
<Link id="l09237" /><CodeLine lineNumber="9237"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09238" /><CodeLine lineNumber="9238"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Don&#39;t use getDecisionAndClampRange here, because we don&#39;t know the UF</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09239" /><CodeLine lineNumber="9239"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// so this function is better to be conservative, rather than to split</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09240" /><CodeLine lineNumber="9240"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// it up into different VPlans.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09241" /><CodeLine lineNumber="9241"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Consider using getDecisionAndClampRange here to split up VPlans.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09242" /><CodeLine lineNumber="9242"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IVUpdateMayOverflow = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09243" /><CodeLine lineNumber="9243"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (ElementCount VF : <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)</Highlight></CodeLine>
<Link id="l09244" /><CodeLine lineNumber="9244"><Highlight kind="normal">    IVUpdateMayOverflow |= !<a href="#ab7edde995b7986f98c3f59788b960eba">isIndvarOverflowCheckKnownFalse</a>(&amp;CM, VF);</Highlight></CodeLine>
<Link id="l09245" /><CodeLine lineNumber="9245"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09246" /><CodeLine lineNumber="9246"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="#a29c708de8e758ac420523c94c797b501">getDebugLocFromInstOrOperands</a>(Legal-&gt;getPrimaryInduction());</Highlight></CodeLine>
<Link id="l09247" /><CodeLine lineNumber="9247"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdd">TailFoldingStyle</a> <a href="/docs/api/namespaces/llvm/hexstyle/#a2ff7bb0072f1202f7b06bb426d6ecda0">Style</a> = CM.getTailFoldingStyle(IVUpdateMayOverflow);</Highlight></CodeLine>
<Link id="l09248" /><CodeLine lineNumber="9248"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Use NUW for the induction increment if we proved that it won&#39;t overflow in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09249" /><CodeLine lineNumber="9249"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the vector loop or when not folding the tail. In the later case, we know</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09250" /><CodeLine lineNumber="9250"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that the canonical induction increment will not overflow as the vector trip</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09251" /><CodeLine lineNumber="9251"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// count is &gt;= increment and a multiple of the increment.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09252" /><CodeLine lineNumber="9252"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasNUW = !IVUpdateMayOverflow || <a href="/docs/api/namespaces/llvm/hexstyle/#a2ff7bb0072f1202f7b06bb426d6ecda0">Style</a> == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda6adf97f83acf6453d4a6a4b1070f3754">TailFoldingStyle::None</a>;</Highlight></CodeLine>
<Link id="l09253" /><CodeLine lineNumber="9253"><Highlight kind="normal">  <a href="#a4d2a943e39c98ccce6fd53e8df9c5c2b">addCanonicalIVRecipes</a>(&#42;Plan, Legal-&gt;getWidestInductionType(), HasNUW, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l09254" /><CodeLine lineNumber="9254"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09255" /><CodeLine lineNumber="9255"><Highlight kind="normal">  VPRecipeBuilder RecipeBuilder(&#42;Plan, OrigLoop, TLI, &amp;TTI, Legal, CM, PSE,</Highlight></CodeLine>
<Link id="l09256" /><CodeLine lineNumber="9256"><Highlight kind="normal">                                Builder);</Highlight></CodeLine>
<Link id="l09257" /><CodeLine lineNumber="9257"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09258" /><CodeLine lineNumber="9258"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ---------------------------------------------------------------------------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09259" /><CodeLine lineNumber="9259"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Pre-construction: record ingredients whose recipes we&#39;ll need to further</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09260" /><CodeLine lineNumber="9260"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// process after constructing the initial VPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09261" /><CodeLine lineNumber="9261"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ---------------------------------------------------------------------------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09262" /><CodeLine lineNumber="9262"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09263" /><CodeLine lineNumber="9263"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For each interleave group which is relevant for this (possibly trimmed)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09264" /><CodeLine lineNumber="9264"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Range, add it to the set of groups to be later applied to the VPlan and add</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09265" /><CodeLine lineNumber="9265"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// placeholders for its members&#39; Recipes which we&#39;ll be replacing with a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09266" /><CodeLine lineNumber="9266"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// single VPInterleaveRecipe.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09267" /><CodeLine lineNumber="9267"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (InterleaveGroup&lt;Instruction&gt; &#42;IG : IAI.getInterleaveGroups()) &#123;</Highlight></CodeLine>
<Link id="l09268" /><CodeLine lineNumber="9268"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ApplyIG = &#91;IG, </Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(ElementCount VF) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l09269" /><CodeLine lineNumber="9269"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a> = (VF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; </Highlight><Highlight kind="comment">// Query is illegal for VF == 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09270" /><CodeLine lineNumber="9270"><Highlight kind="normal">                     CM.getWideningDecision(IG-&gt;getInsertPos(), VF) ==</Highlight></CodeLine>
<Link id="l09271" /><CodeLine lineNumber="9271"><Highlight kind="normal">                         <a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#abd75237965fb9548c506a19549c4a260a3a2a7904b0c4a7f4c55939e457bcc971">LoopVectorizationCostModel::CM&#95;Interleave</a>);</Highlight></CodeLine>
<Link id="l09272" /><CodeLine lineNumber="9272"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// For scalable vectors, the only interleave factor currently supported</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09273" /><CodeLine lineNumber="9273"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// is 2 since we require the (de)interleave2 intrinsics instead of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09274" /><CodeLine lineNumber="9274"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// shufflevectors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09275" /><CodeLine lineNumber="9275"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!Result || !VF.<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a9188f84e1dd67530330dcab9cae787d7">isScalable</a>() || IG-&gt;getFactor() == 2) &amp;&amp;</Highlight></CodeLine>
<Link id="l09276" /><CodeLine lineNumber="9276"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Unsupported interleave factor for scalable vectors&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09277" /><CodeLine lineNumber="9277"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/ms-demangle/#afb795990ffc0cb7321e7d1eacc246324a8eea62084ca7e541d918e823422bd82e">Result</a>;</Highlight></CodeLine>
<Link id="l09278" /><CodeLine lineNumber="9278"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l09279" /><CodeLine lineNumber="9279"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/loopvectorizationplanner/#abe3531f2a6e2a86c1d35958794805785">getDecisionAndClampRange</a>(ApplyIG, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>))</Highlight></CodeLine>
<Link id="l09280" /><CodeLine lineNumber="9280"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09281" /><CodeLine lineNumber="9281"><Highlight kind="normal">    InterleaveGroups.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(IG);</Highlight></CodeLine>
<Link id="l09282" /><CodeLine lineNumber="9282"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09283" /><CodeLine lineNumber="9283"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09284" /><CodeLine lineNumber="9284"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ---------------------------------------------------------------------------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09285" /><CodeLine lineNumber="9285"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Construct recipes for the instructions in the loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09286" /><CodeLine lineNumber="9286"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ---------------------------------------------------------------------------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09287" /><CodeLine lineNumber="9287"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09288" /><CodeLine lineNumber="9288"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Scan the body of the loop in a topological order to visit each basic block</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09289" /><CodeLine lineNumber="9289"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// after having visited its predecessor basic blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09290" /><CodeLine lineNumber="9290"><Highlight kind="normal">  LoopBlocksDFS DFS(OrigLoop);</Highlight></CodeLine>
<Link id="l09291" /><CodeLine lineNumber="9291"><Highlight kind="normal">  DFS.perform(LI);</Highlight></CodeLine>
<Link id="l09292" /><CodeLine lineNumber="9292"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09293" /><CodeLine lineNumber="9293"><Highlight kind="normal">  VPBasicBlock &#42;HeaderVPBB = Plan-&gt;getVectorLoopRegion()-&gt;getEntryBasicBlock();</Highlight></CodeLine>
<Link id="l09294" /><CodeLine lineNumber="9294"><Highlight kind="normal">  VPBasicBlock &#42;VPBB = HeaderVPBB;</Highlight></CodeLine>
<Link id="l09295" /><CodeLine lineNumber="9295"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;HeaderBB = OrigLoop-&gt;getHeader();</Highlight></CodeLine>
<Link id="l09296" /><CodeLine lineNumber="9296"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> NeedsMasks =</Highlight></CodeLine>
<Link id="l09297" /><CodeLine lineNumber="9297"><Highlight kind="normal">      CM.foldTailByMasking() ||</Highlight></CodeLine>
<Link id="l09298" /><CodeLine lineNumber="9298"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(OrigLoop-&gt;blocks(), &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, HeaderBB&#93;(BasicBlock &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l09299" /><CodeLine lineNumber="9299"><Highlight kind="normal">        bool NeedsBlends = BB != HeaderBB &amp;&amp; !BB-&gt;phis().empty();</Highlight></CodeLine>
<Link id="l09300" /><CodeLine lineNumber="9300"><Highlight kind="normal">        return Legal-&gt;blockNeedsPredication(BB) || NeedsBlends;</Highlight></CodeLine>
<Link id="l09301" /><CodeLine lineNumber="9301"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l09302" /><CodeLine lineNumber="9302"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09303" /><CodeLine lineNumber="9303"><Highlight kind="normal">  RecipeBuilder.collectScaledReductions(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</Highlight></CodeLine>
<Link id="l09304" /><CodeLine lineNumber="9304"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09305" /><CodeLine lineNumber="9305"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;MiddleVPBB = Plan-&gt;getMiddleBlock();</Highlight></CodeLine>
<Link id="l09306" /><CodeLine lineNumber="9306"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock/#a2fc75e7b63babbf776ed29cfed87ae65">VPBasicBlock::iterator</a> MBIP = MiddleVPBB-&gt;getFirstNonPhi();</Highlight></CodeLine>
<Link id="l09307" /><CodeLine lineNumber="9307"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (BasicBlock &#42;BB : <a href="/docs/api/namespaces/llvm/#a341215803e83773a3e97860dc291f121">make&#95;range</a>(DFS.beginRPO(), DFS.endRPO())) &#123;</Highlight></CodeLine>
<Link id="l09308" /><CodeLine lineNumber="9308"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Relevant instructions from basic block BB will be grouped into VPRecipe</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09309" /><CodeLine lineNumber="9309"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// ingredients and fill a new VPBasicBlock.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09310" /><CodeLine lineNumber="9310"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VPBB != HeaderVPBB)</Highlight></CodeLine>
<Link id="l09311" /><CodeLine lineNumber="9311"><Highlight kind="normal">      VPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a2bd1c53f9607876b22c6fd3ec1e28a50">setName</a>(BB-&gt;getName());</Highlight></CodeLine>
<Link id="l09312" /><CodeLine lineNumber="9312"><Highlight kind="normal">    Builder.setInsertPoint(VPBB);</Highlight></CodeLine>
<Link id="l09313" /><CodeLine lineNumber="9313"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09314" /><CodeLine lineNumber="9314"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VPBB == HeaderVPBB)</Highlight></CodeLine>
<Link id="l09315" /><CodeLine lineNumber="9315"><Highlight kind="normal">      RecipeBuilder.createHeaderMask();</Highlight></CodeLine>
<Link id="l09316" /><CodeLine lineNumber="9316"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NeedsMasks)</Highlight></CodeLine>
<Link id="l09317" /><CodeLine lineNumber="9317"><Highlight kind="normal">      RecipeBuilder.createBlockInMask(BB);</Highlight></CodeLine>
<Link id="l09318" /><CodeLine lineNumber="9318"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09319" /><CodeLine lineNumber="9319"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Introduce each ingredient into VPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09320" /><CodeLine lineNumber="9320"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Model and preserve debug intrinsics in VPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09321" /><CodeLine lineNumber="9321"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (Instruction &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a9b64313b5c1907066b7bab1c60a2ea08">drop&#95;end</a>(BB-&gt;instructionsWithoutDebug(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">))) &#123;</Highlight></CodeLine>
<Link id="l09322" /><CodeLine lineNumber="9322"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/rdf/#a173a2217e059f21fb25908fa2bf796d6">Instr</a> = &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>;</Highlight></CodeLine>
<Link id="l09323" /><CodeLine lineNumber="9323"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;VPValue &#42;, 4&gt;</a> <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>;</Highlight></CodeLine>
<Link id="l09324" /><CodeLine lineNumber="9324"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Instr);</Highlight></CodeLine>
<Link id="l09325" /><CodeLine lineNumber="9325"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Phi &amp;&amp; <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getParent() == HeaderBB) &#123;</Highlight></CodeLine>
<Link id="l09326" /><CodeLine lineNumber="9326"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>.push&#95;back(Plan-&gt;getOrAddLiveIn(</Highlight></CodeLine>
<Link id="l09327" /><CodeLine lineNumber="9327"><Highlight kind="normal">            <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIncomingValueForBlock(OrigLoop-&gt;getLoopPreheader())));</Highlight></CodeLine>
<Link id="l09328" /><CodeLine lineNumber="9328"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l09329" /><CodeLine lineNumber="9329"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> OpRange = RecipeBuilder.mapToVPValues(<a href="/docs/api/namespaces/llvm/rdf/#a173a2217e059f21fb25908fa2bf796d6">Instr</a>-&gt;operands());</Highlight></CodeLine>
<Link id="l09330" /><CodeLine lineNumber="9330"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a> = &#123;OpRange.begin(), OpRange.end()&#125;;</Highlight></CodeLine>
<Link id="l09331" /><CodeLine lineNumber="9331"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l09332" /><CodeLine lineNumber="9332"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09333" /><CodeLine lineNumber="9333"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// The stores with invariant address inside the loop will be deleted, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09334" /><CodeLine lineNumber="9334"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// in the exit block, a uniform store recipe will be created for the final</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09335" /><CodeLine lineNumber="9335"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// invariant store of the reduction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09336" /><CodeLine lineNumber="9336"><Highlight kind="normal">      StoreInst &#42;<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>;</Highlight></CodeLine>
<Link id="l09337" /><CodeLine lineNumber="9337"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((SI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &amp;&amp;</Highlight></CodeLine>
<Link id="l09338" /><CodeLine lineNumber="9338"><Highlight kind="normal">          Legal-&gt;isInvariantAddressOfReduction(<a href="/docs/api/namespaces/llvm/siencodingfamily/#ac0e8470f1a7e777b89ff85c06a5d46e0a53036b329d60f608f01b3fa1b8f0a473">SI</a>-&gt;getPointerOperand())) &#123;</Highlight></CodeLine>
<Link id="l09339" /><CodeLine lineNumber="9339"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Only create recipe for the final invariant store of the reduction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09340" /><CodeLine lineNumber="9340"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Legal-&gt;isInvariantStoreOfReduction(SI))</Highlight></CodeLine>
<Link id="l09341" /><CodeLine lineNumber="9341"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09342" /><CodeLine lineNumber="9342"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Recipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPReplicateRecipe(</Highlight></CodeLine>
<Link id="l09343" /><CodeLine lineNumber="9343"><Highlight kind="normal">            SI, RecipeBuilder.mapToVPValues(<a href="/docs/api/namespaces/llvm/rdf/#a173a2217e059f21fb25908fa2bf796d6">Instr</a>-&gt;operands()),</Highlight></CodeLine>
<Link id="l09344" /><CodeLine lineNumber="9344"><Highlight kind="normal">            </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42; IsUniform &#42;/</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09345" /><CodeLine lineNumber="9345"><Highlight kind="normal">        Recipe-&gt;insertBefore(&#42;MiddleVPBB, MBIP);</Highlight></CodeLine>
<Link id="l09346" /><CodeLine lineNumber="9346"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09347" /><CodeLine lineNumber="9347"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l09348" /><CodeLine lineNumber="9348"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09349" /><CodeLine lineNumber="9349"><Highlight kind="normal">      VPRecipeBase &#42;Recipe =</Highlight></CodeLine>
<Link id="l09350" /><CodeLine lineNumber="9350"><Highlight kind="normal">          RecipeBuilder.tryToCreateWidenRecipe(Instr, <a href="/docs/api/files/lib/lib/codegen/mirnamerpass-cpp/#a05e4be4ec3e2c3587dda0e376bb6822c">Operands</a>, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>, VPBB);</Highlight></CodeLine>
<Link id="l09351" /><CodeLine lineNumber="9351"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Recipe)</Highlight></CodeLine>
<Link id="l09352" /><CodeLine lineNumber="9352"><Highlight kind="normal">        Recipe = RecipeBuilder.handleReplication(Instr, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>);</Highlight></CodeLine>
<Link id="l09353" /><CodeLine lineNumber="9353"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09354" /><CodeLine lineNumber="9354"><Highlight kind="normal">      RecipeBuilder.setRecipe(Instr, Recipe);</Highlight></CodeLine>
<Link id="l09355" /><CodeLine lineNumber="9355"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPHeaderPHIRecipe&gt;</a>(Recipe)) &#123;</Highlight></CodeLine>
<Link id="l09356" /><CodeLine lineNumber="9356"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// VPHeaderPHIRecipes must be kept in the phi section of HeaderVPBB. In</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09357" /><CodeLine lineNumber="9357"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// the following cases, VPHeaderPHIRecipes may be created after non-phi</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09358" /><CodeLine lineNumber="9358"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// recipes and need to be moved to the phi section of HeaderVPBB:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09359" /><CodeLine lineNumber="9359"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// &#42; tail-folding (non-phi recipes computing the header mask are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09360" /><CodeLine lineNumber="9360"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// introduced earlier than regular header phi recipes, and should appear</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09361" /><CodeLine lineNumber="9361"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// after them)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09362" /><CodeLine lineNumber="9362"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// &#42; Optimizing truncates to VPWidenIntOrFpInductionRecipe.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09363" /><CodeLine lineNumber="9363"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09364" /><CodeLine lineNumber="9364"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>() == VPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a4a7f4b8433e9a788149ffd94a0a07051">end</a>() ||</Highlight></CodeLine>
<Link id="l09365" /><CodeLine lineNumber="9365"><Highlight kind="normal">                CM.foldTailByMasking() || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;TruncInst&gt;</a>(Instr)) &amp;&amp;</Highlight></CodeLine>
<Link id="l09366" /><CodeLine lineNumber="9366"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;unexpected recipe needs moving&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09367" /><CodeLine lineNumber="9367"><Highlight kind="normal">        Recipe-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#a8859e5e8cad5653b278964f47414fd84">insertBefore</a>(&#42;HeaderVPBB, HeaderVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>());</Highlight></CodeLine>
<Link id="l09368" /><CodeLine lineNumber="9368"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09369" /><CodeLine lineNumber="9369"><Highlight kind="normal">        VPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a23773e962f9a56c9bdf13f7668b063a5">appendRecipe</a>(Recipe);</Highlight></CodeLine>
<Link id="l09370" /><CodeLine lineNumber="9370"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09371" /><CodeLine lineNumber="9371"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09372" /><CodeLine lineNumber="9372"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpblockutils/#a1f625b90be26a131061ab1e43740cc81">VPBlockUtils::insertBlockAfter</a>(Plan-&gt;createVPBasicBlock(</Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">), VPBB);</Highlight></CodeLine>
<Link id="l09373" /><CodeLine lineNumber="9373"><Highlight kind="normal">    VPBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPBasicBlock&gt;</a>(VPBB-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#aebc0e1a3379ed4fd614889e24b8ea48c">getSingleSuccessor</a>());</Highlight></CodeLine>
<Link id="l09374" /><CodeLine lineNumber="9374"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09375" /><CodeLine lineNumber="9375"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09376" /><CodeLine lineNumber="9376"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// After here, VPBB should not be used.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09377" /><CodeLine lineNumber="9377"><Highlight kind="normal">  VPBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09378" /><CodeLine lineNumber="9378"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09379" /><CodeLine lineNumber="9379"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPRegionBlock&gt;</a>(Plan-&gt;getVectorLoopRegion()) &amp;&amp;</Highlight></CodeLine>
<Link id="l09380" /><CodeLine lineNumber="9380"><Highlight kind="normal">         !Plan-&gt;getVectorLoopRegion()-&gt;getEntryBasicBlock()-&gt;empty() &amp;&amp;</Highlight></CodeLine>
<Link id="l09381" /><CodeLine lineNumber="9381"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;entry block must be set to a VPRegionBlock having a non-empty entry &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09382" /><CodeLine lineNumber="9382"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;VPBasicBlock&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09383" /><CodeLine lineNumber="9383"><Highlight kind="normal">  RecipeBuilder.fixHeaderPhis();</Highlight></CodeLine>
<Link id="l09384" /><CodeLine lineNumber="9384"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09385" /><CodeLine lineNumber="9385"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update wide induction increments to use the same step as the corresponding</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09386" /><CodeLine lineNumber="9386"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// wide induction. This enables detecting induction increments directly in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09387" /><CodeLine lineNumber="9387"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// VPlan and removes redundant splats.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09388" /><CodeLine lineNumber="9388"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;&#91;Phi, <a href="/docs/api/namespaces/llvm/callingconv/#abdf8cf606905c10634e831390981b0ed">ID</a>&#93; : Legal-&gt;getInductionVars()) &#123;</Highlight></CodeLine>
<Link id="l09389" /><CodeLine lineNumber="9389"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IVInc = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(</Highlight></CodeLine>
<Link id="l09390" /><CodeLine lineNumber="9390"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getIncomingValueForBlock(OrigLoop-&gt;getLoopLatch()));</Highlight></CodeLine>
<Link id="l09391" /><CodeLine lineNumber="9391"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IVInc-&gt;<a href="/docs/api/classes/llvm/user/#aa0a2cb1582d1cec317bd205085469ca1">getOperand</a>(0) != Phi || IVInc-&gt;<a href="/docs/api/classes/llvm/instruction/#ab4e05d690df389b8b1477c90387b575f">getOpcode</a>() != Instruction::Add)</Highlight></CodeLine>
<Link id="l09392" /><CodeLine lineNumber="9392"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09393" /><CodeLine lineNumber="9393"><Highlight kind="normal">    VPWidenInductionRecipe &#42;WideIV =</Highlight></CodeLine>
<Link id="l09394" /><CodeLine lineNumber="9394"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenInductionRecipe&gt;</a>(RecipeBuilder.getRecipe(Phi));</Highlight></CodeLine>
<Link id="l09395" /><CodeLine lineNumber="9395"><Highlight kind="normal">    VPRecipeBase &#42;<a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> = RecipeBuilder.getRecipe(IVInc);</Highlight></CodeLine>
<Link id="l09396" /><CodeLine lineNumber="9396"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>-&gt;setOperand(1, WideIV-&gt;<a href="/docs/api/classes/llvm/vpwideninductionrecipe/#a74f9beabcc57857ae7a7ba943e72776b">getStepValue</a>());</Highlight></CodeLine>
<Link id="l09397" /><CodeLine lineNumber="9397"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09398" /><CodeLine lineNumber="9398"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09399" /><CodeLine lineNumber="9399"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UncountableExitingBlock =</Highlight></CodeLine>
<Link id="l09400" /><CodeLine lineNumber="9400"><Highlight kind="normal">          Legal-&gt;getUncountableEarlyExitingBlock()) &#123;</Highlight></CodeLine>
<Link id="l09401" /><CodeLine lineNumber="9401"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/structs/llvm/vplantransforms/#ac2fcd61c17c94d7e9d10b24b718c812e">VPlanTransforms::handleUncountableEarlyExit</a>(</Highlight></CodeLine>
<Link id="l09402" /><CodeLine lineNumber="9402"><Highlight kind="normal">            &#42;Plan, &#42;PSE.getSE(), OrigLoop, UncountableExitingBlock,</Highlight></CodeLine>
<Link id="l09403" /><CodeLine lineNumber="9403"><Highlight kind="normal">            RecipeBuilder)) &#123;</Highlight></CodeLine>
<Link id="l09404" /><CodeLine lineNumber="9404"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight></CodeLine>
<Link id="l09405" /><CodeLine lineNumber="9405"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;Some exit values in loop with uncountable exit not supported yet&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l09406" /><CodeLine lineNumber="9406"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot;UncountableEarlyExitLoopsUnsupportedExitValue&quot;</Highlight><Highlight kind="normal">, ORE, OrigLoop);</Highlight></CodeLine>
<Link id="l09407" /><CodeLine lineNumber="9407"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09408" /><CodeLine lineNumber="9408"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09409" /><CodeLine lineNumber="9409"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09410" /><CodeLine lineNumber="9410"><Highlight kind="normal">  DenseMap&lt;VPValue &#42;, VPValue &#42;&gt; IVEndValues;</Highlight></CodeLine>
<Link id="l09411" /><CodeLine lineNumber="9411"><Highlight kind="normal">  <a href="#a02106664ead4e0c4e755457dbac7f7b3">addScalarResumePhis</a>(RecipeBuilder, &#42;Plan, IVEndValues);</Highlight></CodeLine>
<Link id="l09412" /><CodeLine lineNumber="9412"><Highlight kind="normal">  SetVector&lt;VPIRInstruction &#42;&gt; ExitUsersToFix =</Highlight></CodeLine>
<Link id="l09413" /><CodeLine lineNumber="9413"><Highlight kind="normal">      <a href="#a435b95efad7ea03299bd527b55b4708a">collectUsersInExitBlocks</a>(OrigLoop, RecipeBuilder, &#42;Plan);</Highlight></CodeLine>
<Link id="l09414" /><CodeLine lineNumber="9414"><Highlight kind="normal">  <a href="#a453563e4ed7e249a7f3e92b98b9052df">addExitUsersForFirstOrderRecurrences</a>(&#42;Plan, ExitUsersToFix);</Highlight></CodeLine>
<Link id="l09415" /><CodeLine lineNumber="9415"><Highlight kind="normal">  <a href="#af34d746d08a380c672cae45176f9df87">addUsersInExitBlocks</a>(&#42;Plan, ExitUsersToFix);</Highlight></CodeLine>
<Link id="l09416" /><CodeLine lineNumber="9416"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09417" /><CodeLine lineNumber="9417"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ---------------------------------------------------------------------------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09418" /><CodeLine lineNumber="9418"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Transform initial VPlan: Apply previously taken decisions, in order, to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09419" /><CodeLine lineNumber="9419"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// bring the VPlan to its final state.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09420" /><CodeLine lineNumber="9420"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ---------------------------------------------------------------------------</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09421" /><CodeLine lineNumber="9421"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09422" /><CodeLine lineNumber="9422"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Adjust the recipes for any inloop reductions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09423" /><CodeLine lineNumber="9423"><Highlight kind="normal">  adjustRecipesForReductions(Plan, RecipeBuilder, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>.Start);</Highlight></CodeLine>
<Link id="l09424" /><CodeLine lineNumber="9424"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09425" /><CodeLine lineNumber="9425"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Interleave memory: for each Interleave Group we marked earlier as relevant</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09426" /><CodeLine lineNumber="9426"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// for this VPlan, replace the Recipes widening its memory instructions with a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09427" /><CodeLine lineNumber="9427"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// single VPInterleaveRecipe at its insertion point.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09428" /><CodeLine lineNumber="9428"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vplantransforms/#aa88371693bc18186386b04e8c45a30e4">VPlanTransforms::createInterleaveGroups</a>(</Highlight></CodeLine>
<Link id="l09429" /><CodeLine lineNumber="9429"><Highlight kind="normal">      &#42;Plan, InterleaveGroups, RecipeBuilder, CM.isScalarEpilogueAllowed());</Highlight></CodeLine>
<Link id="l09430" /><CodeLine lineNumber="9430"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09431" /><CodeLine lineNumber="9431"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (ElementCount VF : <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)</Highlight></CodeLine>
<Link id="l09432" /><CodeLine lineNumber="9432"><Highlight kind="normal">    Plan-&gt;addVF(VF);</Highlight></CodeLine>
<Link id="l09433" /><CodeLine lineNumber="9433"><Highlight kind="normal">  Plan-&gt;setName(</Highlight><Highlight kind="stringliteral">&quot;Initial VPlan&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09434" /><CodeLine lineNumber="9434"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09435" /><CodeLine lineNumber="9435"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replace VPValues for known constant strides guaranteed by predicate scalar</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09436" /><CodeLine lineNumber="9436"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// evolution.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09437" /><CodeLine lineNumber="9437"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> CanUseVersionedStride = &#91;&amp;Plan&#93;(VPUser &amp;<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>, unsigned) &#123;</Highlight></CodeLine>
<Link id="l09438" /><CodeLine lineNumber="9438"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(&amp;U);</Highlight></CodeLine>
<Link id="l09439" /><CodeLine lineNumber="9439"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>-&gt;getParent()-&gt;getParent() ||</Highlight></CodeLine>
<Link id="l09440" /><CodeLine lineNumber="9440"><Highlight kind="normal">           <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>-&gt;getParent() ==</Highlight></CodeLine>
<Link id="l09441" /><CodeLine lineNumber="9441"><Highlight kind="normal">               Plan-&gt;getVectorLoopRegion()-&gt;getSinglePredecessor();</Highlight></CodeLine>
<Link id="l09442" /><CodeLine lineNumber="9442"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l09443" /><CodeLine lineNumber="9443"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#91;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/lib/target/hexagon/mctargetdesc/hexagonmccodeemitter-cpp/#ae4dfd7b0d66121016d6466d2ff10e8ba">&#95;</a>, Stride&#93; : Legal-&gt;getLAI()-&gt;getSymbolicStrides()) &#123;</Highlight></CodeLine>
<Link id="l09444" /><CodeLine lineNumber="9444"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;StrideV = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;SCEVUnknown&gt;</a>(Stride)-&gt;getValue();</Highlight></CodeLine>
<Link id="l09445" /><CodeLine lineNumber="9445"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ScevStride = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;SCEVConstant&gt;</a>(PSE.getSCEV(StrideV));</Highlight></CodeLine>
<Link id="l09446" /><CodeLine lineNumber="9446"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Only handle constant strides for now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09447" /><CodeLine lineNumber="9447"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ScevStride)</Highlight></CodeLine>
<Link id="l09448" /><CodeLine lineNumber="9448"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09449" /><CodeLine lineNumber="9449"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09450" /><CodeLine lineNumber="9450"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CI = Plan-&gt;getOrAddLiveIn(</Highlight></CodeLine>
<Link id="l09451" /><CodeLine lineNumber="9451"><Highlight kind="normal">        ConstantInt::get(Stride-&gt;getType(), ScevStride-&gt;getAPInt()));</Highlight></CodeLine>
<Link id="l09452" /><CodeLine lineNumber="9452"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VPValue &#42;StrideVPV = Plan-&gt;getLiveIn(StrideV))</Highlight></CodeLine>
<Link id="l09453" /><CodeLine lineNumber="9453"><Highlight kind="normal">      StrideVPV-&gt;<a href="/docs/api/classes/llvm/value/#a7e8dad1701aa6445be4a29f654b0473c">replaceUsesWithIf</a>(CI, CanUseVersionedStride);</Highlight></CodeLine>
<Link id="l09454" /><CodeLine lineNumber="9454"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09455" /><CodeLine lineNumber="9455"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The versioned value may not be used in the loop directly but through a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09456" /><CodeLine lineNumber="9456"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// sext/zext. Add new live-ins in those cases.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09457" /><CodeLine lineNumber="9457"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;U : StrideV-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l09458" /><CodeLine lineNumber="9458"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst, ZExtInst&gt;</a>(U))</Highlight></CodeLine>
<Link id="l09459" /><CodeLine lineNumber="9459"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09460" /><CodeLine lineNumber="9460"><Highlight kind="normal">      VPValue &#42;StrideVPV = Plan-&gt;getLiveIn(U);</Highlight></CodeLine>
<Link id="l09461" /><CodeLine lineNumber="9461"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!StrideVPV)</Highlight></CodeLine>
<Link id="l09462" /><CodeLine lineNumber="9462"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09463" /><CodeLine lineNumber="9463"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> BW = <a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;getType()-&gt;getScalarSizeInBits();</Highlight></CodeLine>
<Link id="l09464" /><CodeLine lineNumber="9464"><Highlight kind="normal">      APInt <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a> = <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SExtInst&gt;</a>(U) ? ScevStride-&gt;getAPInt().sext(BW)</Highlight></CodeLine>
<Link id="l09465" /><CodeLine lineNumber="9465"><Highlight kind="normal">                                 : ScevStride-&gt;getAPInt().zext(BW);</Highlight></CodeLine>
<Link id="l09466" /><CodeLine lineNumber="9466"><Highlight kind="normal">      VPValue &#42;CI = Plan-&gt;getOrAddLiveIn(ConstantInt::get(<a href="/docs/api/namespaces/llvm/m68k/#ab3a288f2953d8eca3e363959fc2cf38ea4c614360da93c0a041b22e537de151eb">U</a>-&gt;getType(), <a href="/docs/api/namespaces/llvm/callingconv/#ac6aa1387c4375260e2468eb5a77fdb4cafd841a49aec1539bc88abc8ff9e170fb">C</a>));</Highlight></CodeLine>
<Link id="l09467" /><CodeLine lineNumber="9467"><Highlight kind="normal">      StrideVPV-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ae3773dd8f9c831f0dde091319b2ff7d0">replaceUsesWithIf</a>(CI, CanUseVersionedStride);</Highlight></CodeLine>
<Link id="l09468" /><CodeLine lineNumber="9468"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09469" /><CodeLine lineNumber="9469"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09470" /><CodeLine lineNumber="9470"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09471" /><CodeLine lineNumber="9471"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vplantransforms/#aa0f143b8d4693978b984f0639c90e508">VPlanTransforms::dropPoisonGeneratingRecipes</a>(&#42;Plan, &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(BasicBlock &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l09472" /><CodeLine lineNumber="9472"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Legal-&gt;blockNeedsPredication(BB);</Highlight></CodeLine>
<Link id="l09473" /><CodeLine lineNumber="9473"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l09474" /><CodeLine lineNumber="9474"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09475" /><CodeLine lineNumber="9475"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Sink users of fixed-order recurrence past the recipe defining the previous</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09476" /><CodeLine lineNumber="9476"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// value and introduce FirstOrderRecurrenceSplice VPInstructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09477" /><CodeLine lineNumber="9477"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/structs/llvm/vplantransforms/#ae64d6953a1334207d9e7d9cd2587ee9f">VPlanTransforms::adjustFixedOrderRecurrences</a>(&#42;Plan, Builder))</Highlight></CodeLine>
<Link id="l09478" /><CodeLine lineNumber="9478"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09479" /><CodeLine lineNumber="9479"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09480" /><CodeLine lineNumber="9480"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#aae88a50a9a37f9a745939e3e726837e6">useActiveLaneMask</a>(Style)) &#123;</Highlight></CodeLine>
<Link id="l09481" /><CodeLine lineNumber="9481"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Move checks to VPlanTransforms::addActiveLaneMask once</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09482" /><CodeLine lineNumber="9482"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TailFoldingStyle is visible there.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09483" /><CodeLine lineNumber="9483"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ForControlFlow = <a href="#a4e445204e48d57b1e23e55869146b7ce">useActiveLaneMaskForControlFlow</a>(Style);</Highlight></CodeLine>
<Link id="l09484" /><CodeLine lineNumber="9484"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> WithoutRuntimeCheck =</Highlight></CodeLine>
<Link id="l09485" /><CodeLine lineNumber="9485"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/hexstyle/#a2ff7bb0072f1202f7b06bb426d6ecda0">Style</a> == <a href="/docs/api/namespaces/llvm/#ada31142763d41520644d228c139a4bdda41105c5fe36c41d2246b18c1724fa2ff">TailFoldingStyle::DataAndControlFlowWithoutRuntimeCheck</a>;</Highlight></CodeLine>
<Link id="l09486" /><CodeLine lineNumber="9486"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/vplantransforms/#ae1d2d60cd9edd9f7ca98c50789747c95">VPlanTransforms::addActiveLaneMask</a>(&#42;Plan, ForControlFlow,</Highlight></CodeLine>
<Link id="l09487" /><CodeLine lineNumber="9487"><Highlight kind="normal">                                       WithoutRuntimeCheck);</Highlight></CodeLine>
<Link id="l09488" /><CodeLine lineNumber="9488"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09489" /><CodeLine lineNumber="9489"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vplantransforms/#a3a573419fed83f23b6bf70ac6731dbfa">VPlanTransforms::optimizeInductionExitUsers</a>(&#42;Plan, IVEndValues);</Highlight></CodeLine>
<Link id="l09490" /><CodeLine lineNumber="9490"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09491" /><CodeLine lineNumber="9491"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#af5f1d1b7df16dee92c5b56c26e322b89">verifyVPlanIsValid</a>(&#42;Plan) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;VPlan is invalid&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09492" /><CodeLine lineNumber="9492"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Plan;</Highlight></CodeLine>
<Link id="l09493" /><CodeLine lineNumber="9493"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l09494" /><CodeLine lineNumber="9494"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09495" /><CodeLine lineNumber="9495"><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/#aefc42f3cefc5a839ca925b4cb3ae4a7b">VPlanPtr</a> LoopVectorizationPlanner::buildVPlan(<a href="/docs/api/structs/llvm/vfrange">VFRange</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>) &#123;</Highlight></CodeLine>
<Link id="l09496" /><CodeLine lineNumber="9496"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Outer loop handling: They may require CFG and instruction level</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09497" /><CodeLine lineNumber="9497"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// transformations before even evaluating whether vectorization is profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09498" /><CodeLine lineNumber="9498"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Since we cannot modify the incoming IR, we need to build VPlan upfront in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09499" /><CodeLine lineNumber="9499"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the vectorization pipeline.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09500" /><CodeLine lineNumber="9500"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!OrigLoop-&gt;isInnermost());</Highlight></CodeLine>
<Link id="l09501" /><CodeLine lineNumber="9501"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;VPlan-native path is not enabled.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09502" /><CodeLine lineNumber="9502"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09503" /><CodeLine lineNumber="9503"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create new empty VPlan</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09504" /><CodeLine lineNumber="9504"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Plan = <a href="/docs/api/classes/llvm/vplan/#a5a956378c8f267d4b2afc6e036a08d42">VPlan::createInitialVPlan</a>(Legal-&gt;getWidestInductionType(), PSE,</Highlight></CodeLine>
<Link id="l09505" /><CodeLine lineNumber="9505"><Highlight kind="normal">                                        </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, OrigLoop);</Highlight></CodeLine>
<Link id="l09506" /><CodeLine lineNumber="9506"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09507" /><CodeLine lineNumber="9507"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Build hierarchical CFG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09508" /><CodeLine lineNumber="9508"><Highlight kind="normal">  VPlanHCFGBuilder HCFGBuilder(OrigLoop, LI, &#42;Plan);</Highlight></CodeLine>
<Link id="l09509" /><CodeLine lineNumber="9509"><Highlight kind="normal">  HCFGBuilder.buildHierarchicalCFG();</Highlight></CodeLine>
<Link id="l09510" /><CodeLine lineNumber="9510"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09511" /><CodeLine lineNumber="9511"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (ElementCount VF : <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#a34bd74317e3f04bfc4318c2d1a470877">Range</a>)</Highlight></CodeLine>
<Link id="l09512" /><CodeLine lineNumber="9512"><Highlight kind="normal">    Plan-&gt;addVF(VF);</Highlight></CodeLine>
<Link id="l09513" /><CodeLine lineNumber="9513"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09514" /><CodeLine lineNumber="9514"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vplantransforms/#ad210afaefb4884ac5008dd5fbaf1cbf8">VPlanTransforms::VPInstructionsToVPRecipes</a>(</Highlight></CodeLine>
<Link id="l09515" /><CodeLine lineNumber="9515"><Highlight kind="normal">      Plan,</Highlight></CodeLine>
<Link id="l09516" /><CodeLine lineNumber="9516"><Highlight kind="normal">      &#91;</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">&#93;(PHINode &#42;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>) &#123; </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Legal-&gt;getIntOrFpInductionDescriptor(<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>); &#125;,</Highlight></CodeLine>
<Link id="l09517" /><CodeLine lineNumber="9517"><Highlight kind="normal">      &#42;PSE.getSE(), &#42;TLI);</Highlight></CodeLine>
<Link id="l09518" /><CodeLine lineNumber="9518"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09519" /><CodeLine lineNumber="9519"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Tail folding is not supported for outer loops, so the induction increment</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09520" /><CodeLine lineNumber="9520"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is guaranteed to not wrap.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09521" /><CodeLine lineNumber="9521"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> HasNUW = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09522" /><CodeLine lineNumber="9522"><Highlight kind="normal">  <a href="#a4d2a943e39c98ccce6fd53e8df9c5c2b">addCanonicalIVRecipes</a>(&#42;Plan, Legal-&gt;getWidestInductionType(), HasNUW,</Highlight></CodeLine>
<Link id="l09523" /><CodeLine lineNumber="9523"><Highlight kind="normal">                        <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a>());</Highlight></CodeLine>
<Link id="l09524" /><CodeLine lineNumber="9524"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09525" /><CodeLine lineNumber="9525"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect mapping of IR header phis to header phi recipes, to be used in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09526" /><CodeLine lineNumber="9526"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// addScalarResumePhis.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09527" /><CodeLine lineNumber="9527"><Highlight kind="normal">  VPRecipeBuilder RecipeBuilder(&#42;Plan, OrigLoop, TLI, &amp;TTI, Legal, CM, PSE,</Highlight></CodeLine>
<Link id="l09528" /><CodeLine lineNumber="9528"><Highlight kind="normal">                                Builder);</Highlight></CodeLine>
<Link id="l09529" /><CodeLine lineNumber="9529"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;R : Plan-&gt;getVectorLoopRegion()-&gt;getEntryBasicBlock()-&gt;phis()) &#123;</Highlight></CodeLine>
<Link id="l09530" /><CodeLine lineNumber="9530"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPCanonicalIVPHIRecipe&gt;</a>(&amp;R))</Highlight></CodeLine>
<Link id="l09531" /><CodeLine lineNumber="9531"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09532" /><CodeLine lineNumber="9532"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;HeaderR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPHeaderPHIRecipe&gt;</a>(&amp;R);</Highlight></CodeLine>
<Link id="l09533" /><CodeLine lineNumber="9533"><Highlight kind="normal">    RecipeBuilder.setRecipe(HeaderR-&gt;getUnderlyingInstr(), HeaderR);</Highlight></CodeLine>
<Link id="l09534" /><CodeLine lineNumber="9534"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09535" /><CodeLine lineNumber="9535"><Highlight kind="normal">  DenseMap&lt;VPValue &#42;, VPValue &#42;&gt; IVEndValues;</Highlight></CodeLine>
<Link id="l09536" /><CodeLine lineNumber="9536"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: IVEndValues are not used yet in the native path, to optimize exit</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09537" /><CodeLine lineNumber="9537"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// values.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09538" /><CodeLine lineNumber="9538"><Highlight kind="normal">  <a href="#a02106664ead4e0c4e755457dbac7f7b3">addScalarResumePhis</a>(RecipeBuilder, &#42;Plan, IVEndValues);</Highlight></CodeLine>
<Link id="l09539" /><CodeLine lineNumber="9539"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09540" /><CodeLine lineNumber="9540"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#af5f1d1b7df16dee92c5b56c26e322b89">verifyVPlanIsValid</a>(&#42;Plan) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;VPlan is invalid&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09541" /><CodeLine lineNumber="9541"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Plan;</Highlight></CodeLine>
<Link id="l09542" /><CodeLine lineNumber="9542"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l09543" /><CodeLine lineNumber="9543"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09544" /><CodeLine lineNumber="9544"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Adjust the recipes for reductions. For in-loop reductions the chain of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09545" /><CodeLine lineNumber="9545"><Highlight kind="normal"></Highlight><Highlight kind="comment">// instructions leading from the loop exit instr to the phi need to be converted</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09546" /><CodeLine lineNumber="9546"><Highlight kind="normal"></Highlight><Highlight kind="comment">// to reductions, with one operand being vector and the other being the scalar</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09547" /><CodeLine lineNumber="9547"><Highlight kind="normal"></Highlight><Highlight kind="comment">// reduction chain. For other reductions, a select is introduced between the phi</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09548" /><CodeLine lineNumber="9548"><Highlight kind="normal"></Highlight><Highlight kind="comment">// and users outside the vector region when folding the tail.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09549" /><CodeLine lineNumber="9549"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09550" /><CodeLine lineNumber="9550"><Highlight kind="normal"></Highlight><Highlight kind="comment">// A ComputeReductionResult recipe is added to the middle block, also for</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09551" /><CodeLine lineNumber="9551"><Highlight kind="normal"></Highlight><Highlight kind="comment">// in-loop reductions which compute their result in-loop, because generating</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09552" /><CodeLine lineNumber="9552"><Highlight kind="normal"></Highlight><Highlight kind="comment">// the subsequent bc.merge.rdx phi is driven by ComputeReductionResult recipes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09553" /><CodeLine lineNumber="9553"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09554" /><CodeLine lineNumber="9554"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Adjust AnyOf reductions; replace the reduction phi for the selected value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09555" /><CodeLine lineNumber="9555"><Highlight kind="normal"></Highlight><Highlight kind="comment">// with a boolean reduction phi node to check if the condition is true in any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09556" /><CodeLine lineNumber="9556"><Highlight kind="normal"></Highlight><Highlight kind="comment">// iteration. The final value is selected by the final ComputeReductionResult.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09557" /><CodeLine lineNumber="9557"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> LoopVectorizationPlanner::adjustRecipesForReductions(</Highlight></CodeLine>
<Link id="l09558" /><CodeLine lineNumber="9558"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#aefc42f3cefc5a839ca925b4cb3ae4a7b">VPlanPtr</a> &amp;Plan, <a href="/docs/api/classes/llvm/vprecipebuilder">VPRecipeBuilder</a> &amp;RecipeBuilder, <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> MinVF) &#123;</Highlight></CodeLine>
<Link id="l09559" /><CodeLine lineNumber="9559"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal">VPlanPatternMatch;</Highlight></CodeLine>
<Link id="l09560" /><CodeLine lineNumber="9560"><Highlight kind="normal">  VPRegionBlock &#42;VectorLoopRegion = Plan-&gt;getVectorLoopRegion();</Highlight></CodeLine>
<Link id="l09561" /><CodeLine lineNumber="9561"><Highlight kind="normal">  VPBasicBlock &#42;<a href="/docs/api/namespaces/anonymous-lvcompare-cpp-/#a1ad6686ca7dcf67bc791fff07fdf7818abf50d5e661106d0abe925af3c2e6f7e7">Header</a> = VectorLoopRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</Highlight></CodeLine>
<Link id="l09562" /><CodeLine lineNumber="9562"><Highlight kind="normal">  VPBasicBlock &#42;MiddleVPBB = Plan-&gt;getMiddleBlock();</Highlight></CodeLine>
<Link id="l09563" /><CodeLine lineNumber="9563"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;VPRecipeBase &#42;&gt;</a> ToDelete;</Highlight></CodeLine>
<Link id="l09564" /><CodeLine lineNumber="9564"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09565" /><CodeLine lineNumber="9565"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (VPRecipeBase &amp;R : <a href="/docs/api/namespaces/anonymous-lvcompare-cpp-/#a1ad6686ca7dcf67bc791fff07fdf7818abf50d5e661106d0abe925af3c2e6f7e7">Header</a>-&gt;phis()) &#123;</Highlight></CodeLine>
<Link id="l09566" /><CodeLine lineNumber="9566"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PhiR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReductionPHIRecipe&gt;</a>(&amp;R);</Highlight></CodeLine>
<Link id="l09567" /><CodeLine lineNumber="9567"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PhiR || !PhiR-&gt;isInLoop() || (MinVF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; !PhiR-&gt;isOrdered()))</Highlight></CodeLine>
<Link id="l09568" /><CodeLine lineNumber="9568"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09569" /><CodeLine lineNumber="9569"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09570" /><CodeLine lineNumber="9570"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> RecurrenceDescriptor &amp;RdxDesc = PhiR-&gt;getRecurrenceDescriptor();</Highlight></CodeLine>
<Link id="l09571" /><CodeLine lineNumber="9571"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> <a href="/docs/api/namespaces/llvm/lltok/#af353621f14cb4b4b3af5ffaff84076b1">Kind</a> = RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>();</Highlight></CodeLine>
<Link id="l09572" /><CodeLine lineNumber="9572"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l09573" /><CodeLine lineNumber="9573"><Highlight kind="normal">        !<a href="/docs/api/classes/llvm/recurrencedescriptor/#a69df67c7d92481ae63a5d8017e96c716">RecurrenceDescriptor::isAnyOfRecurrenceKind</a>(Kind) &amp;&amp;</Highlight></CodeLine>
<Link id="l09574" /><CodeLine lineNumber="9574"><Highlight kind="normal">        !<a href="/docs/api/classes/llvm/recurrencedescriptor/#a7bc46d4489f4d6cb4a4e486ce5f6184b">RecurrenceDescriptor::isFindLastIVRecurrenceKind</a>(Kind) &amp;&amp;</Highlight></CodeLine>
<Link id="l09575" /><CodeLine lineNumber="9575"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;AnyOf and FindLast reductions are not allowed for in-loop reductions&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09576" /><CodeLine lineNumber="9576"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09577" /><CodeLine lineNumber="9577"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Collect the chain of &quot;link&quot; recipes for the reduction starting at PhiR.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09578" /><CodeLine lineNumber="9578"><Highlight kind="normal">    SetVector&lt;VPSingleDefRecipe &#42;&gt; Worklist;</Highlight></CodeLine>
<Link id="l09579" /><CodeLine lineNumber="9579"><Highlight kind="normal">    Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(PhiR);</Highlight></CodeLine>
<Link id="l09580" /><CodeLine lineNumber="9580"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != Worklist.<a href="/docs/api/classes/llvm/setvector/#a1a42c1ba878bd637f374197d05f0a97f">size</a>(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l09581" /><CodeLine lineNumber="9581"><Highlight kind="normal">      VPSingleDefRecipe &#42;Cur = Worklist&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l09582" /><CodeLine lineNumber="9582"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (VPUser &#42;U : Cur-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l09583" /><CodeLine lineNumber="9583"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UserRecipe = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPSingleDefRecipe&gt;</a>(U);</Highlight></CodeLine>
<Link id="l09584" /><CodeLine lineNumber="9584"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!UserRecipe-&gt;getParent()-&gt;getEnclosingLoopRegion()) &#123;</Highlight></CodeLine>
<Link id="l09585" /><CodeLine lineNumber="9585"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((UserRecipe-&gt;getParent() == MiddleVPBB ||</Highlight></CodeLine>
<Link id="l09586" /><CodeLine lineNumber="9586"><Highlight kind="normal">                  UserRecipe-&gt;getParent() == Plan-&gt;getScalarPreheader()) &amp;&amp;</Highlight></CodeLine>
<Link id="l09587" /><CodeLine lineNumber="9587"><Highlight kind="normal">                 </Highlight><Highlight kind="stringliteral">&quot;U must be either in the loop region, the middle block or the &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09588" /><CodeLine lineNumber="9588"><Highlight kind="normal">                 </Highlight><Highlight kind="stringliteral">&quot;scalar preheader.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09589" /><CodeLine lineNumber="9589"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09590" /><CodeLine lineNumber="9590"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l09591" /><CodeLine lineNumber="9591"><Highlight kind="normal">        Worklist.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(UserRecipe);</Highlight></CodeLine>
<Link id="l09592" /><CodeLine lineNumber="9592"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l09593" /><CodeLine lineNumber="9593"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09594" /><CodeLine lineNumber="9594"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09595" /><CodeLine lineNumber="9595"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Visit operation &quot;Links&quot; along the reduction chain top-down starting from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09596" /><CodeLine lineNumber="9596"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the phi until LoopExitValue. We keep track of the previous item</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09597" /><CodeLine lineNumber="9597"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// (PreviousLink) to tell which of the two operands of a Link will remain</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09598" /><CodeLine lineNumber="9598"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// scalar and which will be reduced. For minmax by select(cmp), Link will be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09599" /><CodeLine lineNumber="9599"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the select instructions. Blend recipes of in-loop reduction phi&#39;s  will</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09600" /><CodeLine lineNumber="9600"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// get folded to their non-phi operand, as the reduction recipe handles the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09601" /><CodeLine lineNumber="9601"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// condition directly.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09602" /><CodeLine lineNumber="9602"><Highlight kind="normal">    VPSingleDefRecipe &#42;PreviousLink = PhiR; </Highlight><Highlight kind="comment">// Aka Worklist&#91;0&#93;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09603" /><CodeLine lineNumber="9603"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (VPSingleDefRecipe &#42;CurrentLink : Worklist.<a href="/docs/api/classes/llvm/setvector/#a0c7d0dae14eb8a5916fff9f72d8b46d2">getArrayRef</a>().drop&#95;front()) &#123;</Highlight></CodeLine>
<Link id="l09604" /><CodeLine lineNumber="9604"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;CurrentLinkI = CurrentLink-&gt;getUnderlyingInstr();</Highlight></CodeLine>
<Link id="l09605" /><CodeLine lineNumber="9605"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09606" /><CodeLine lineNumber="9606"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Index of the first operand which holds a non-mask vector operand.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09607" /><CodeLine lineNumber="9607"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IndexOfFirstOperand;</Highlight></CodeLine>
<Link id="l09608" /><CodeLine lineNumber="9608"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Recognize a call to the llvm.fmuladd intrinsic.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09609" /><CodeLine lineNumber="9609"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsFMulAdd = (<a href="/docs/api/namespaces/llvm/lltok/#af353621f14cb4b4b3af5ffaff84076b1">Kind</a> == <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830eaa7dad289ea38506fb1c9b5b148405d0c">RecurKind::FMulAdd</a>);</Highlight></CodeLine>
<Link id="l09610" /><CodeLine lineNumber="9610"><Highlight kind="normal">      VPValue &#42;VecOp;</Highlight></CodeLine>
<Link id="l09611" /><CodeLine lineNumber="9611"><Highlight kind="normal">      VPBasicBlock &#42;LinkVPBB = CurrentLink-&gt;getParent();</Highlight></CodeLine>
<Link id="l09612" /><CodeLine lineNumber="9612"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsFMulAdd) &#123;</Highlight></CodeLine>
<Link id="l09613" /><CodeLine lineNumber="9613"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l09614" /><CodeLine lineNumber="9614"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/recurrencedescriptor/#a08416fb970e8c177c7d78452d927c606">RecurrenceDescriptor::isFMulAddIntrinsic</a>(CurrentLinkI) &amp;&amp;</Highlight></CodeLine>
<Link id="l09615" /><CodeLine lineNumber="9615"><Highlight kind="normal">            </Highlight><Highlight kind="stringliteral">&quot;Expected instruction to be a call to the llvm.fmuladd intrinsic&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09616" /><CodeLine lineNumber="9616"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(((MinVF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPReplicateRecipe&gt;</a>(CurrentLink)) ||</Highlight></CodeLine>
<Link id="l09617" /><CodeLine lineNumber="9617"><Highlight kind="normal">                <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenIntrinsicRecipe&gt;</a>(CurrentLink)) &amp;&amp;</Highlight></CodeLine>
<Link id="l09618" /><CodeLine lineNumber="9618"><Highlight kind="normal">               CurrentLink-&gt;getOperand(2) == PreviousLink &amp;&amp;</Highlight></CodeLine>
<Link id="l09619" /><CodeLine lineNumber="9619"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;expected a call where the previous link is the added operand&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09620" /><CodeLine lineNumber="9620"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09621" /><CodeLine lineNumber="9621"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// If the instruction is a call to the llvm.fmuladd intrinsic then we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09622" /><CodeLine lineNumber="9622"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// need to create an fmul recipe (multiplying the first two operands of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09623" /><CodeLine lineNumber="9623"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// the fmuladd together) to use as the vector operand for the fadd</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09624" /><CodeLine lineNumber="9624"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// reduction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09625" /><CodeLine lineNumber="9625"><Highlight kind="normal">        VPInstruction &#42;FMulRecipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPInstruction(</Highlight></CodeLine>
<Link id="l09626" /><CodeLine lineNumber="9626"><Highlight kind="normal">            Instruction::FMul,</Highlight></CodeLine>
<Link id="l09627" /><CodeLine lineNumber="9627"><Highlight kind="normal">            &#123;CurrentLink-&gt;getOperand(0), CurrentLink-&gt;getOperand(1)&#125;,</Highlight></CodeLine>
<Link id="l09628" /><CodeLine lineNumber="9628"><Highlight kind="normal">            CurrentLinkI-&gt;<a href="/docs/api/classes/llvm/instruction/#a9a167f91db810097d281b1ed627f4575">getFastMathFlags</a>());</Highlight></CodeLine>
<Link id="l09629" /><CodeLine lineNumber="9629"><Highlight kind="normal">        LinkVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#adfdd504b078cce3b90e7c5cf1f5164db">insert</a>(FMulRecipe, CurrentLink-&gt;getIterator());</Highlight></CodeLine>
<Link id="l09630" /><CodeLine lineNumber="9630"><Highlight kind="normal">        VecOp = FMulRecipe;</Highlight></CodeLine>
<Link id="l09631" /><CodeLine lineNumber="9631"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l09632" /><CodeLine lineNumber="9632"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Blend = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPBlendRecipe&gt;</a>(CurrentLink);</Highlight></CodeLine>
<Link id="l09633" /><CodeLine lineNumber="9633"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (PhiR-&gt;isInLoop() &amp;&amp; Blend) &#123;</Highlight></CodeLine>
<Link id="l09634" /><CodeLine lineNumber="9634"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Blend-&gt;getNumIncomingValues() == 2 &amp;&amp;</Highlight></CodeLine>
<Link id="l09635" /><CodeLine lineNumber="9635"><Highlight kind="normal">                 </Highlight><Highlight kind="stringliteral">&quot;Blend must have 2 incoming values&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09636" /><CodeLine lineNumber="9636"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blend-&gt;getIncomingValue(0) == PhiR)</Highlight></CodeLine>
<Link id="l09637" /><CodeLine lineNumber="9637"><Highlight kind="normal">            Blend-&gt;replaceAllUsesWith(Blend-&gt;getIncomingValue(1));</Highlight></CodeLine>
<Link id="l09638" /><CodeLine lineNumber="9638"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l09639" /><CodeLine lineNumber="9639"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(Blend-&gt;getIncomingValue(1) == PhiR &amp;&amp;</Highlight></CodeLine>
<Link id="l09640" /><CodeLine lineNumber="9640"><Highlight kind="normal">                   </Highlight><Highlight kind="stringliteral">&quot;PhiR must be an operand of the blend&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09641" /><CodeLine lineNumber="9641"><Highlight kind="normal">            Blend-&gt;replaceAllUsesWith(Blend-&gt;getIncomingValue(0));</Highlight></CodeLine>
<Link id="l09642" /><CodeLine lineNumber="9642"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l09643" /><CodeLine lineNumber="9643"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09644" /><CodeLine lineNumber="9644"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l09645" /><CodeLine lineNumber="9645"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09646" /><CodeLine lineNumber="9646"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#af08d243545b64f4b77161992d0e2366e">RecurrenceDescriptor::isMinMaxRecurrenceKind</a>(Kind)) &#123;</Highlight></CodeLine>
<Link id="l09647" /><CodeLine lineNumber="9647"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenRecipe&gt;</a>(CurrentLink)) &#123;</Highlight></CodeLine>
<Link id="l09648" /><CodeLine lineNumber="9648"><Highlight kind="normal">            <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;CmpInst&gt;</a>(CurrentLinkI) &amp;&amp;</Highlight></CodeLine>
<Link id="l09649" /><CodeLine lineNumber="9649"><Highlight kind="normal">                   </Highlight><Highlight kind="stringliteral">&quot;need to have the compare of the select&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09650" /><CodeLine lineNumber="9650"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09651" /><CodeLine lineNumber="9651"><Highlight kind="normal">          &#125;</Highlight></CodeLine>
<Link id="l09652" /><CodeLine lineNumber="9652"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenSelectRecipe&gt;</a>(CurrentLink) &amp;&amp;</Highlight></CodeLine>
<Link id="l09653" /><CodeLine lineNumber="9653"><Highlight kind="normal">                 </Highlight><Highlight kind="stringliteral">&quot;must be a select recipe&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09654" /><CodeLine lineNumber="9654"><Highlight kind="normal">          IndexOfFirstOperand = 1;</Highlight></CodeLine>
<Link id="l09655" /><CodeLine lineNumber="9655"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l09656" /><CodeLine lineNumber="9656"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((MinVF.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>() || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPWidenRecipe&gt;</a>(CurrentLink)) &amp;&amp;</Highlight></CodeLine>
<Link id="l09657" /><CodeLine lineNumber="9657"><Highlight kind="normal">                 </Highlight><Highlight kind="stringliteral">&quot;Expected to replace a VPWidenSC&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09658" /><CodeLine lineNumber="9658"><Highlight kind="normal">          IndexOfFirstOperand = 0;</Highlight></CodeLine>
<Link id="l09659" /><CodeLine lineNumber="9659"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l09660" /><CodeLine lineNumber="9660"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Note that for non-commutable operands (cmp-selects), the semantics of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09661" /><CodeLine lineNumber="9661"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// the cmp-select are captured in the recurrence kind.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09662" /><CodeLine lineNumber="9662"><Highlight kind="normal">        </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> VecOpId =</Highlight></CodeLine>
<Link id="l09663" /><CodeLine lineNumber="9663"><Highlight kind="normal">            CurrentLink-&gt;getOperand(IndexOfFirstOperand) == PreviousLink</Highlight></CodeLine>
<Link id="l09664" /><CodeLine lineNumber="9664"><Highlight kind="normal">                ? IndexOfFirstOperand + 1</Highlight></CodeLine>
<Link id="l09665" /><CodeLine lineNumber="9665"><Highlight kind="normal">                : IndexOfFirstOperand;</Highlight></CodeLine>
<Link id="l09666" /><CodeLine lineNumber="9666"><Highlight kind="normal">        VecOp = CurrentLink-&gt;getOperand(VecOpId);</Highlight></CodeLine>
<Link id="l09667" /><CodeLine lineNumber="9667"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(VecOp != PreviousLink &amp;&amp;</Highlight></CodeLine>
<Link id="l09668" /><CodeLine lineNumber="9668"><Highlight kind="normal">               CurrentLink-&gt;getOperand(CurrentLink-&gt;getNumOperands() - 1 -</Highlight></CodeLine>
<Link id="l09669" /><CodeLine lineNumber="9669"><Highlight kind="normal">                                       (VecOpId - IndexOfFirstOperand)) ==</Highlight></CodeLine>
<Link id="l09670" /><CodeLine lineNumber="9670"><Highlight kind="normal">                   PreviousLink &amp;&amp;</Highlight></CodeLine>
<Link id="l09671" /><CodeLine lineNumber="9671"><Highlight kind="normal">               </Highlight><Highlight kind="stringliteral">&quot;PreviousLink must be the operand other than VecOp&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09672" /><CodeLine lineNumber="9672"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l09673" /><CodeLine lineNumber="9673"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09674" /><CodeLine lineNumber="9674"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;BB = CurrentLinkI-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>();</Highlight></CodeLine>
<Link id="l09675" /><CodeLine lineNumber="9675"><Highlight kind="normal">      VPValue &#42;CondOp = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09676" /><CodeLine lineNumber="9676"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CM.blockNeedsPredicationForAnyReason(BB))</Highlight></CodeLine>
<Link id="l09677" /><CodeLine lineNumber="9677"><Highlight kind="normal">        CondOp = RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(BB);</Highlight></CodeLine>
<Link id="l09678" /><CodeLine lineNumber="9678"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09679" /><CodeLine lineNumber="9679"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;RedRecipe = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPReductionRecipe(</Highlight></CodeLine>
<Link id="l09680" /><CodeLine lineNumber="9680"><Highlight kind="normal">          RdxDesc, CurrentLinkI, PreviousLink, VecOp, CondOp,</Highlight></CodeLine>
<Link id="l09681" /><CodeLine lineNumber="9681"><Highlight kind="normal">          CM.useOrderedReductions(RdxDesc), CurrentLinkI-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>());</Highlight></CodeLine>
<Link id="l09682" /><CodeLine lineNumber="9682"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Append the recipe to the end of the VPBasicBlock because we need to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09683" /><CodeLine lineNumber="9683"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// ensure that it comes after all of it&#39;s inputs, including CondOp.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09684" /><CodeLine lineNumber="9684"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Delete CurrentLink as it will be invalid if its operand is replaced</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09685" /><CodeLine lineNumber="9685"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// with a reduction defined at the bottom of the block in the next link.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09686" /><CodeLine lineNumber="9686"><Highlight kind="normal">      LinkVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a23773e962f9a56c9bdf13f7668b063a5">appendRecipe</a>(RedRecipe);</Highlight></CodeLine>
<Link id="l09687" /><CodeLine lineNumber="9687"><Highlight kind="normal">      CurrentLink-&gt;replaceAllUsesWith(RedRecipe);</Highlight></CodeLine>
<Link id="l09688" /><CodeLine lineNumber="9688"><Highlight kind="normal">      ToDelete.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(CurrentLink);</Highlight></CodeLine>
<Link id="l09689" /><CodeLine lineNumber="9689"><Highlight kind="normal">      PreviousLink = RedRecipe;</Highlight></CodeLine>
<Link id="l09690" /><CodeLine lineNumber="9690"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09691" /><CodeLine lineNumber="9691"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09692" /><CodeLine lineNumber="9692"><Highlight kind="normal">  VPBasicBlock &#42;LatchVPBB = VectorLoopRegion-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a28da654f916bf44da5513b6f1788835c">getExitingBasicBlock</a>();</Highlight></CodeLine>
<Link id="l09693" /><CodeLine lineNumber="9693"><Highlight kind="normal">  Builder.setInsertPoint(&amp;&#42;LatchVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a4e30ea9d413dd86c802fee94aa8b5805">begin</a>());</Highlight></CodeLine>
<Link id="l09694" /><CodeLine lineNumber="9694"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock/#a2fc75e7b63babbf776ed29cfed87ae65">VPBasicBlock::iterator</a> IP = MiddleVPBB-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a72533c6b54501809628b9daee79b9d18">getFirstNonPhi</a>();</Highlight></CodeLine>
<Link id="l09695" /><CodeLine lineNumber="9695"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (VPRecipeBase &amp;R :</Highlight></CodeLine>
<Link id="l09696" /><CodeLine lineNumber="9696"><Highlight kind="normal">       Plan-&gt;getVectorLoopRegion()-&gt;getEntryBasicBlock()-&gt;phis()) &#123;</Highlight></CodeLine>
<Link id="l09697" /><CodeLine lineNumber="9697"><Highlight kind="normal">    VPReductionPHIRecipe &#42;PhiR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReductionPHIRecipe&gt;</a>(&amp;R);</Highlight></CodeLine>
<Link id="l09698" /><CodeLine lineNumber="9698"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PhiR)</Highlight></CodeLine>
<Link id="l09699" /><CodeLine lineNumber="9699"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09700" /><CodeLine lineNumber="9700"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09701" /><CodeLine lineNumber="9701"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> RecurrenceDescriptor &amp;RdxDesc = PhiR-&gt;<a href="/docs/api/classes/llvm/vpreductionphirecipe/#add56c575c69df41fbddde0c4cad13271">getRecurrenceDescriptor</a>();</Highlight></CodeLine>
<Link id="l09702" /><CodeLine lineNumber="9702"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If tail is folded by masking, introduce selects between the phi</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09703" /><CodeLine lineNumber="9703"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// and the users outside the vector region of each reduction, at the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09704" /><CodeLine lineNumber="9704"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// beginning of the dedicated latch block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09705" /><CodeLine lineNumber="9705"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OrigExitingVPV = PhiR-&gt;<a href="/docs/api/classes/llvm/vpheaderphirecipe/#a80333e8d5f353fb9e929388e577a593f">getBackedgeValue</a>();</Highlight></CodeLine>
<Link id="l09706" /><CodeLine lineNumber="9706"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;NewExitingVPV = PhiR-&gt;<a href="/docs/api/classes/llvm/vpheaderphirecipe/#a80333e8d5f353fb9e929388e577a593f">getBackedgeValue</a>();</Highlight></CodeLine>
<Link id="l09707" /><CodeLine lineNumber="9707"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PhiR-&gt;<a href="/docs/api/classes/llvm/vpreductionphirecipe/#a9e146bc33d1c57399c7b777576f7768e">isInLoop</a>() &amp;&amp; CM.foldTailByMasking()) &#123;</Highlight></CodeLine>
<Link id="l09708" /><CodeLine lineNumber="9708"><Highlight kind="normal">      VPValue &#42;<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a> = RecipeBuilder.<a href="/docs/api/classes/llvm/vprecipebuilder/#a38a607d72d35cad5060b4cd7b5934bb5">getBlockInMask</a>(OrigLoop-&gt;getHeader());</Highlight></CodeLine>
<Link id="l09709" /><CodeLine lineNumber="9709"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OrigExitingVPV-&gt;getDefiningRecipe()-&gt;getParent() != LatchVPBB &amp;&amp;</Highlight></CodeLine>
<Link id="l09710" /><CodeLine lineNumber="9710"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;reduction recipe must be defined before latch&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09711" /><CodeLine lineNumber="9711"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PhiTy = PhiR-&gt;<a href="/docs/api/classes/llvm/vpuser/#a6e1b252a9bbdc1a440fb57a6257b97f4">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ac6f0bd9ed63fe4a784697d73ae3b6fa0">getLiveInIRValue</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l09712" /><CodeLine lineNumber="9712"><Highlight kind="normal">      std::optional&lt;FastMathFlags&gt; FMFs =</Highlight></CodeLine>
<Link id="l09713" /><CodeLine lineNumber="9713"><Highlight kind="normal">          PhiTy-&gt;<a href="/docs/api/classes/llvm/type/#aac5759c83abd6a4af236401a7cfe7a0f">isFloatingPointTy</a>()</Highlight></CodeLine>
<Link id="l09714" /><CodeLine lineNumber="9714"><Highlight kind="normal">              ? std::make&#95;optional(RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a0d5c759e770c1c6032d077a1b9cf7172">getFastMathFlags</a>())</Highlight></CodeLine>
<Link id="l09715" /><CodeLine lineNumber="9715"><Highlight kind="normal">              : std::nullopt;</Highlight></CodeLine>
<Link id="l09716" /><CodeLine lineNumber="9716"><Highlight kind="normal">      NewExitingVPV =</Highlight></CodeLine>
<Link id="l09717" /><CodeLine lineNumber="9717"><Highlight kind="normal">          Builder.createSelect(<a href="/docs/api/files/lib/lib/target/lib/target/riscv/riscvredundantcopyelimination-cpp/#a193847098793cdbab306803186676899">Cond</a>, OrigExitingVPV, PhiR, &#123;&#125;, </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">, FMFs);</Highlight></CodeLine>
<Link id="l09718" /><CodeLine lineNumber="9718"><Highlight kind="normal">      OrigExitingVPV-&gt;replaceUsesWithIf(NewExitingVPV, &#91;&#93;(VPUser &amp;U, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l09719" /><CodeLine lineNumber="9719"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPInstruction&gt;</a>(&amp;U) &amp;&amp;</Highlight></CodeLine>
<Link id="l09720" /><CodeLine lineNumber="9720"><Highlight kind="normal">               <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPInstruction&gt;</a>(&amp;U)-&gt;getOpcode() ==</Highlight></CodeLine>
<Link id="l09721" /><CodeLine lineNumber="9721"><Highlight kind="normal">                   <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2ad9b4011dc2ac58da0fecd16d99f1f17d">VPInstruction::ComputeReductionResult</a>;</Highlight></CodeLine>
<Link id="l09722" /><CodeLine lineNumber="9722"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l09723" /><CodeLine lineNumber="9723"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CM.usePredicatedReductionSelect(</Highlight></CodeLine>
<Link id="l09724" /><CodeLine lineNumber="9724"><Highlight kind="normal">              PhiR-&gt;<a href="/docs/api/classes/llvm/vpreductionphirecipe/#add56c575c69df41fbddde0c4cad13271">getRecurrenceDescriptor</a>().<a href="/docs/api/classes/llvm/recurrencedescriptor/#a30ee597b72598bc7939d3a40d2a5ba20">getOpcode</a>(), PhiTy))</Highlight></CodeLine>
<Link id="l09725" /><CodeLine lineNumber="9725"><Highlight kind="normal">        PhiR-&gt;<a href="/docs/api/classes/llvm/vpuser/#a19c3591dc1eeb5648552b33f70e04b65">setOperand</a>(1, NewExitingVPV);</Highlight></CodeLine>
<Link id="l09726" /><CodeLine lineNumber="9726"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09727" /><CodeLine lineNumber="9727"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09728" /><CodeLine lineNumber="9728"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the vector reduction can be performed in a smaller type, we truncate</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09729" /><CodeLine lineNumber="9729"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// then extend the loop exit value to enable InstCombine to evaluate the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09730" /><CodeLine lineNumber="9730"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// entire expression in the smaller type.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09731" /><CodeLine lineNumber="9731"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;PhiTy = PhiR-&gt;<a href="/docs/api/classes/llvm/vpheaderphirecipe/#a92c12c8e69e03cc781dd010cdaa5f0e6">getStartValue</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ac6f0bd9ed63fe4a784697d73ae3b6fa0">getLiveInIRValue</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>();</Highlight></CodeLine>
<Link id="l09732" /><CodeLine lineNumber="9732"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (MinVF.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() &amp;&amp; PhiTy != RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l09733" /><CodeLine lineNumber="9733"><Highlight kind="normal">        !<a href="/docs/api/classes/llvm/recurrencedescriptor/#a69df67c7d92481ae63a5d8017e96c716">RecurrenceDescriptor::isAnyOfRecurrenceKind</a>(</Highlight></CodeLine>
<Link id="l09734" /><CodeLine lineNumber="9734"><Highlight kind="normal">            RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>())) &#123;</Highlight></CodeLine>
<Link id="l09735" /><CodeLine lineNumber="9735"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!PhiR-&gt;<a href="/docs/api/classes/llvm/vpreductionphirecipe/#a9e146bc33d1c57399c7b777576f7768e">isInLoop</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unexpected truncated inloop reduction!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09736" /><CodeLine lineNumber="9736"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;RdxTy = RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a4f29fefacd6bdd966f6ba021cc656a2f">getRecurrenceType</a>();</Highlight></CodeLine>
<Link id="l09737" /><CodeLine lineNumber="9737"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Trunc =</Highlight></CodeLine>
<Link id="l09738" /><CodeLine lineNumber="9738"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPWidenCastRecipe(Instruction::Trunc, NewExitingVPV, RdxTy);</Highlight></CodeLine>
<Link id="l09739" /><CodeLine lineNumber="9739"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Extnd =</Highlight></CodeLine>
<Link id="l09740" /><CodeLine lineNumber="9740"><Highlight kind="normal">          RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a855906f5a6f429db8978680fd6de7886">isSigned</a>()</Highlight></CodeLine>
<Link id="l09741" /><CodeLine lineNumber="9741"><Highlight kind="normal">              ? </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPWidenCastRecipe(Instruction::SExt, Trunc, PhiTy)</Highlight></CodeLine>
<Link id="l09742" /><CodeLine lineNumber="9742"><Highlight kind="normal">              : new VPWidenCastRecipe(<a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a>::<a href="/docs/api/namespaces/anonymous-riscvisellowering-cpp-/#a0fb45dddfe1615e320ac9ad137d634e7aa2f0622a02fc4af2ec7bd22803523662">ZExt</a>, Trunc, PhiTy);</Highlight></CodeLine>
<Link id="l09743" /><CodeLine lineNumber="9743"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09744" /><CodeLine lineNumber="9744"><Highlight kind="normal">      Trunc-&gt;insertAfter(NewExitingVPV-&gt;getDefiningRecipe());</Highlight></CodeLine>
<Link id="l09745" /><CodeLine lineNumber="9745"><Highlight kind="normal">      Extnd-&gt;insertAfter(Trunc);</Highlight></CodeLine>
<Link id="l09746" /><CodeLine lineNumber="9746"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/passes/passbuilderbindings-cpp/#acdfbcf188e2d4a80837e89de2ccdffab">if</a> (PhiR-&gt;<a href="/docs/api/classes/llvm/vpuser/#a6e1b252a9bbdc1a440fb57a6257b97f4">getOperand</a>(1) == NewExitingVPV)</Highlight></CodeLine>
<Link id="l09747" /><CodeLine lineNumber="9747"><Highlight kind="normal">        PhiR-&gt;<a href="/docs/api/classes/llvm/vpuser/#a19c3591dc1eeb5648552b33f70e04b65">setOperand</a>(1, Extnd-&gt;getVPSingleValue());</Highlight></CodeLine>
<Link id="l09748" /><CodeLine lineNumber="9748"><Highlight kind="normal">      NewExitingVPV = Extnd;</Highlight></CodeLine>
<Link id="l09749" /><CodeLine lineNumber="9749"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09750" /><CodeLine lineNumber="9750"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09751" /><CodeLine lineNumber="9751"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// We want code in the middle block to appear to execute on the location of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09752" /><CodeLine lineNumber="9752"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the scalar loop&#39;s latch terminator because: (a) it is all compiler</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09753" /><CodeLine lineNumber="9753"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// generated, (b) these instructions are always executed after evaluating</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09754" /><CodeLine lineNumber="9754"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the latch conditional branch, and (c) other passes may add new</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09755" /><CodeLine lineNumber="9755"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// predecessors which terminate on this line. This is the easiest way to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09756" /><CodeLine lineNumber="9756"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// ensure we don&#39;t accidentally cause an extra step back into the loop while</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09757" /><CodeLine lineNumber="9757"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// debugging.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09758" /><CodeLine lineNumber="9758"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/dwarf-linker/#a463a58e257d5f6fb2c39eb9a2474fc24ac2e06fc138163b7095fa483616a0a47a">DebugLoc</a> ExitDL = OrigLoop-&gt;getLoopLatch()-&gt;getTerminator()-&gt;getDebugLoc();</Highlight></CodeLine>
<Link id="l09759" /><CodeLine lineNumber="9759"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09760" /><CodeLine lineNumber="9760"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: At the moment ComputeReductionResult also drives creation of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09761" /><CodeLine lineNumber="9761"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// bc.merge.rdx phi nodes, hence it needs to be created unconditionally here</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09762" /><CodeLine lineNumber="9762"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// even for in-loop reductions, until the reduction resume value handling is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09763" /><CodeLine lineNumber="9763"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// also modeled in VPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09764" /><CodeLine lineNumber="9764"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;FinalReductionResult = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> VPInstruction(</Highlight></CodeLine>
<Link id="l09765" /><CodeLine lineNumber="9765"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2ad9b4011dc2ac58da0fecd16d99f1f17d">VPInstruction::ComputeReductionResult</a>, &#123;PhiR, NewExitingVPV&#125;, ExitDL);</Highlight></CodeLine>
<Link id="l09766" /><CodeLine lineNumber="9766"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Update all users outside the vector region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09767" /><CodeLine lineNumber="9767"><Highlight kind="normal">    OrigExitingVPV-&gt;replaceUsesWithIf(</Highlight></CodeLine>
<Link id="l09768" /><CodeLine lineNumber="9768"><Highlight kind="normal">        FinalReductionResult, &#91;&#93;(VPUser &amp;User, </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l09769" /><CodeLine lineNumber="9769"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Parent = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(&amp;User)-&gt;getParent();</Highlight></CodeLine>
<Link id="l09770" /><CodeLine lineNumber="9770"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Parent &amp;&amp; !Parent-&gt;getParent();</Highlight></CodeLine>
<Link id="l09771" /><CodeLine lineNumber="9771"><Highlight kind="normal">        &#125;);</Highlight></CodeLine>
<Link id="l09772" /><CodeLine lineNumber="9772"><Highlight kind="normal">    FinalReductionResult-&gt;insertBefore(&#42;MiddleVPBB, IP);</Highlight></CodeLine>
<Link id="l09773" /><CodeLine lineNumber="9773"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09774" /><CodeLine lineNumber="9774"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Adjust AnyOf reductions; replace the reduction phi for the selected value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09775" /><CodeLine lineNumber="9775"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// with a boolean reduction phi node to check if the condition is true in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09776" /><CodeLine lineNumber="9776"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// any iteration. The final value is selected by the final</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09777" /><CodeLine lineNumber="9777"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// ComputeReductionResult.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09778" /><CodeLine lineNumber="9778"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a69df67c7d92481ae63a5d8017e96c716">RecurrenceDescriptor::isAnyOfRecurrenceKind</a>(</Highlight></CodeLine>
<Link id="l09779" /><CodeLine lineNumber="9779"><Highlight kind="normal">            RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>())) &#123;</Highlight></CodeLine>
<Link id="l09780" /><CodeLine lineNumber="9780"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPRecipeBase&gt;</a>(&#42;<a href="/docs/api/namespaces/llvm/#ac78c09ae232b2ce188ff590d51e3c268">find&#95;if</a>(PhiR-&gt;<a href="/docs/api/classes/llvm/vpvalue/#af0932bb43954178036c87ea2ee5f112c">users</a>(), &#91;&#93;(VPUser &#42;U) &#123;</Highlight></CodeLine>
<Link id="l09781" /><CodeLine lineNumber="9781"><Highlight kind="normal">        return isa&lt;VPWidenSelectRecipe&gt;(U) ||</Highlight></CodeLine>
<Link id="l09782" /><CodeLine lineNumber="9782"><Highlight kind="normal">               (isa&lt;VPReplicateRecipe&gt;(U) &amp;&amp;</Highlight></CodeLine>
<Link id="l09783" /><CodeLine lineNumber="9783"><Highlight kind="normal">                cast&lt;VPReplicateRecipe&gt;(U)-&gt;getUnderlyingInstr()-&gt;getOpcode() ==</Highlight></CodeLine>
<Link id="l09784" /><CodeLine lineNumber="9784"><Highlight kind="normal">                    Instruction::Select);</Highlight></CodeLine>
<Link id="l09785" /><CodeLine lineNumber="9785"><Highlight kind="normal">      &#125;));</Highlight></CodeLine>
<Link id="l09786" /><CodeLine lineNumber="9786"><Highlight kind="normal">      VPValue &#42;<a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getOperand(0);</Highlight></CodeLine>
<Link id="l09787" /><CodeLine lineNumber="9787"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the compare is checking the reduction PHI node, adjust it to check</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09788" /><CodeLine lineNumber="9788"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// the start value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09789" /><CodeLine lineNumber="9789"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VPRecipeBase &#42;CmpR = <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a>-&gt;getDefiningRecipe()) &#123;</Highlight></CodeLine>
<Link id="l09790" /><CodeLine lineNumber="9790"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != CmpR-&gt;getNumOperands(); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l09791" /><CodeLine lineNumber="9791"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CmpR-&gt;getOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) == PhiR)</Highlight></CodeLine>
<Link id="l09792" /><CodeLine lineNumber="9792"><Highlight kind="normal">            CmpR-&gt;setOperand(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, PhiR-&gt;<a href="/docs/api/classes/llvm/vpheaderphirecipe/#a92c12c8e69e03cc781dd010cdaa5f0e6">getStartValue</a>());</Highlight></CodeLine>
<Link id="l09793" /><CodeLine lineNumber="9793"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l09794" /><CodeLine lineNumber="9794"><Highlight kind="normal">      VPBuilder::InsertPointGuard Guard(Builder);</Highlight></CodeLine>
<Link id="l09795" /><CodeLine lineNumber="9795"><Highlight kind="normal">      Builder.setInsertPoint(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>);</Highlight></CodeLine>
<Link id="l09796" /><CodeLine lineNumber="9796"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09797" /><CodeLine lineNumber="9797"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If the true value of the select is the reduction phi, the new value is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09798" /><CodeLine lineNumber="9798"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// selected if the negated condition is true in any iteration.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09799" /><CodeLine lineNumber="9799"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getOperand(1) == PhiR)</Highlight></CodeLine>
<Link id="l09800" /><CodeLine lineNumber="9800"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/x86/#a86730e94ae6fdf0fe3145b2acc88dea8ac9b4c62f6dc1bc5caf3c768b687cbf7e">Cmp</a> = Builder.createNot(Cmp);</Highlight></CodeLine>
<Link id="l09801" /><CodeLine lineNumber="9801"><Highlight kind="normal">      VPValue &#42;<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">Or</a> = Builder.createOr(PhiR, Cmp);</Highlight></CodeLine>
<Link id="l09802" /><CodeLine lineNumber="9802"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>-&gt;getVPSingleValue()-&gt;replaceAllUsesWith(<a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830ea3a2d5fe857d8f9541136a124c2edec6c">Or</a>);</Highlight></CodeLine>
<Link id="l09803" /><CodeLine lineNumber="9803"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Delete Select now that it has invalid types.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09804" /><CodeLine lineNumber="9804"><Highlight kind="normal">      ToDelete.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpuregbankselect-cpp/#a09bc27545df3b02401428427d0b5ce6f">Select</a>);</Highlight></CodeLine>
<Link id="l09805" /><CodeLine lineNumber="9805"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09806" /><CodeLine lineNumber="9806"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Convert the reduction phi to operate on bools.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09807" /><CodeLine lineNumber="9807"><Highlight kind="normal">      PhiR-&gt;<a href="/docs/api/classes/llvm/vpuser/#a19c3591dc1eeb5648552b33f70e04b65">setOperand</a>(0, Plan-&gt;getOrAddLiveIn(<a href="/docs/api/classes/llvm/constantint/#aa7cce62ac5cc6df09cce0535874336b7">ConstantInt::getFalse</a>(</Highlight></CodeLine>
<Link id="l09808" /><CodeLine lineNumber="9808"><Highlight kind="normal">                              OrigLoop-&gt;getHeader()-&gt;getContext())));</Highlight></CodeLine>
<Link id="l09809" /><CodeLine lineNumber="9809"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09810" /><CodeLine lineNumber="9810"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09811" /><CodeLine lineNumber="9811"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09812" /><CodeLine lineNumber="9812"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a7bc46d4489f4d6cb4a4e486ce5f6184b">RecurrenceDescriptor::isFindLastIVRecurrenceKind</a>(</Highlight></CodeLine>
<Link id="l09813" /><CodeLine lineNumber="9813"><Highlight kind="normal">            RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>())) &#123;</Highlight></CodeLine>
<Link id="l09814" /><CodeLine lineNumber="9814"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Adjust the start value for FindLastIV recurrences to use the sentinel</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09815" /><CodeLine lineNumber="9815"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// value after generating the ResumePhi recipe, which uses the original</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09816" /><CodeLine lineNumber="9816"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// start value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09817" /><CodeLine lineNumber="9817"><Highlight kind="normal">      PhiR-&gt;<a href="/docs/api/classes/llvm/vpuser/#a19c3591dc1eeb5648552b33f70e04b65">setOperand</a>(0, Plan-&gt;getOrAddLiveIn(RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#aed10715d943d3e1b4ca75b585ea96ab8">getSentinelValue</a>()));</Highlight></CodeLine>
<Link id="l09818" /><CodeLine lineNumber="9818"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09819" /><CodeLine lineNumber="9819"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09820" /><CodeLine lineNumber="9820"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09821" /><CodeLine lineNumber="9821"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vplantransforms/#ace9e1e6e7295914973dec18350b382ca">VPlanTransforms::clearReductionWrapFlags</a>(&#42;Plan);</Highlight></CodeLine>
<Link id="l09822" /><CodeLine lineNumber="9822"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (VPRecipeBase &#42;R : ToDelete)</Highlight></CodeLine>
<Link id="l09823" /><CodeLine lineNumber="9823"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/riscvfencefield/#a147be9e9780c1e33363ea572d4c7b25fa1835091d83e0e052cd1a32c99b2be731">R</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l09824" /><CodeLine lineNumber="9824"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l09825" /><CodeLine lineNumber="9825"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09826" /><CodeLine lineNumber="9826" lineLink="/docs/api/classes/llvm/vpderivedivrecipe/#a0f37fe11b57d14686c7ca5e7a3846174"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpderivedivrecipe/#a0f37fe11b57d14686c7ca5e7a3846174">VPDerivedIVRecipe::execute</a>(<a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State) &#123;</Highlight></CodeLine>
<Link id="l09827" /><CodeLine lineNumber="9827"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!State.Lane &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;VPDerivedIVRecipe being replicated.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09828" /><CodeLine lineNumber="9828"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09829" /><CodeLine lineNumber="9829"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Fast-math-flags propagate from the original induction instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09830" /><CodeLine lineNumber="9830"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/irbuilderbase/fastmathflagguard">IRBuilder&lt;&gt;::FastMathFlagGuard</a> FMFG(State.Builder);</Highlight></CodeLine>
<Link id="l09831" /><CodeLine lineNumber="9831"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (FPBinOp)</Highlight></CodeLine>
<Link id="l09832" /><CodeLine lineNumber="9832"><Highlight kind="normal">    State.Builder.setFastMathFlags(FPBinOp-&gt;getFastMathFlags());</Highlight></CodeLine>
<Link id="l09833" /><CodeLine lineNumber="9833"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09834" /><CodeLine lineNumber="9834"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Step = State.get(<a href="/docs/api/classes/llvm/vpderivedivrecipe/#a49cc736389970ff14e3f53d8b5664674">getStepValue</a>(), <a href="/docs/api/classes/llvm/vplane">VPLane</a>(0));</Highlight></CodeLine>
<Link id="l09835" /><CodeLine lineNumber="9835"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;Index = State.get(<a href="/docs/api/classes/llvm/vpuser/#a6e1b252a9bbdc1a440fb57a6257b97f4">getOperand</a>(1), <a href="/docs/api/classes/llvm/vplane">VPLane</a>(0));</Highlight></CodeLine>
<Link id="l09836" /><CodeLine lineNumber="9836"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/value">Value</a> &#42;DerivedIV = <a href="#a23f5821d9ac264ae25dd087747e2c181">emitTransformedIndex</a>(</Highlight></CodeLine>
<Link id="l09837" /><CodeLine lineNumber="9837"><Highlight kind="normal">      State.Builder, Index, <a href="/docs/api/classes/llvm/vpderivedivrecipe/#aeb71527486a6730ec967f207fe2ac4fd">getStartValue</a>()-&gt;<a href="/docs/api/classes/llvm/vpvalue/#ac6f0bd9ed63fe4a784697d73ae3b6fa0">getLiveInIRValue</a>(), Step, Kind,</Highlight></CodeLine>
<Link id="l09838" /><CodeLine lineNumber="9838"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a07be078de4a2c223bd6a76e24e1c02db">cast&#95;if&#95;present&lt;BinaryOperator&gt;</a>(FPBinOp));</Highlight></CodeLine>
<Link id="l09839" /><CodeLine lineNumber="9839"><Highlight kind="normal">  DerivedIV-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(Name);</Highlight></CodeLine>
<Link id="l09840" /><CodeLine lineNumber="9840"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If index is the vector trip count, the concrete value will only be set in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09841" /><CodeLine lineNumber="9841"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// prepareToExecute, leading to missed simplifications, e.g. if it is 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09842" /><CodeLine lineNumber="9842"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: Remove the special case for the vector trip count once it is computed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09843" /><CodeLine lineNumber="9843"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// in VPlan and can be used during VPlan simplification.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09844" /><CodeLine lineNumber="9844"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((DerivedIV != Index ||</Highlight></CodeLine>
<Link id="l09845" /><CodeLine lineNumber="9845"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/vpuser/#a6e1b252a9bbdc1a440fb57a6257b97f4">getOperand</a>(1) == &amp;<a href="/docs/api/classes/llvm/vprecipebase/#a6c88376daf23b16ad26b7ac6c224d21e">getParent</a>()-&gt;getPlan()-&gt;getVectorTripCount()) &amp;&amp;</Highlight></CodeLine>
<Link id="l09846" /><CodeLine lineNumber="9846"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;IV didn&#39;t need transforming?&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09847" /><CodeLine lineNumber="9847"><Highlight kind="normal">  State.set(</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, DerivedIV, <a href="/docs/api/classes/llvm/vplane">VPLane</a>(0));</Highlight></CodeLine>
<Link id="l09848" /><CodeLine lineNumber="9848"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l09849" /><CodeLine lineNumber="9849"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09850" /><CodeLine lineNumber="9850" lineLink="/docs/api/classes/llvm/vpreplicaterecipe/#a2ed5b7b284097278ee4e550897b1f057"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpreplicaterecipe/#a2ed5b7b284097278ee4e550897b1f057">VPReplicateRecipe::execute</a>(<a href="/docs/api/structs/llvm/vptransformstate">VPTransformState</a> &amp;State) &#123;</Highlight></CodeLine>
<Link id="l09851" /><CodeLine lineNumber="9851"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;UI = <a href="/docs/api/classes/llvm/vpsingledefrecipe/#a12b12fbdf160f2cf70973e09adbf97d4">getUnderlyingInstr</a>();</Highlight></CodeLine>
<Link id="l09852" /><CodeLine lineNumber="9852"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (State.Lane) &#123; </Highlight><Highlight kind="comment">// Generate a single instance.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09853" /><CodeLine lineNumber="9853"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((State.VF.isScalar() || !<a href="/docs/api/classes/llvm/vpreplicaterecipe/#a8bb23947220a946748e3f1e6e6825155">isUniform</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l09854" /><CodeLine lineNumber="9854"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;uniform recipe shouldn&#39;t be predicated&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09855" /><CodeLine lineNumber="9855"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!State.VF.isScalable() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Can&#39;t scalarize a scalable vector&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09856" /><CodeLine lineNumber="9856"><Highlight kind="normal">    State.ILV-&gt;scalarizeInstruction(UI, </Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, &#42;State.Lane, State);</Highlight></CodeLine>
<Link id="l09857" /><CodeLine lineNumber="9857"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Insert scalar instance packing it into a vector.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09858" /><CodeLine lineNumber="9858"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (State.VF.isVector() &amp;&amp; <a href="/docs/api/classes/llvm/vpreplicaterecipe/#af0ce1d62aef3b8e6a79ebe1703f5a7d2">shouldPack</a>()) &#123;</Highlight></CodeLine>
<Link id="l09859" /><CodeLine lineNumber="9859"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we&#39;re constructing lane 0, initialize to start from poison.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09860" /><CodeLine lineNumber="9860"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (State.Lane-&gt;isFirstLane()) &#123;</Highlight></CodeLine>
<Link id="l09861" /><CodeLine lineNumber="9861"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!State.VF.isScalable() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;VF is assumed to be non scalable.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09862" /><CodeLine lineNumber="9862"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64asmprinter-cpp/#a434449d5a0f4b334aca9163b13b6286ba02b848adda8d7d33a2b25d87dbef1d75">Poison</a> = <a href="/docs/api/classes/llvm/poisonvalue/#a1bf08613fb664a2e377a9a72c59a6b66">PoisonValue::get</a>(</Highlight></CodeLine>
<Link id="l09863" /><CodeLine lineNumber="9863"><Highlight kind="normal">            <a href="/docs/api/classes/llvm/vectortype/#a861be1e2092622462053c6d31dddbfd5">VectorType::get</a>(UI-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), State.VF));</Highlight></CodeLine>
<Link id="l09864" /><CodeLine lineNumber="9864"><Highlight kind="normal">        State.set(</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64asmprinter-cpp/#a434449d5a0f4b334aca9163b13b6286ba02b848adda8d7d33a2b25d87dbef1d75">Poison</a>);</Highlight></CodeLine>
<Link id="l09865" /><CodeLine lineNumber="9865"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l09866" /><CodeLine lineNumber="9866"><Highlight kind="normal">      State.packScalarIntoVectorValue(</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, &#42;State.Lane);</Highlight></CodeLine>
<Link id="l09867" /><CodeLine lineNumber="9867"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l09868" /><CodeLine lineNumber="9868"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09869" /><CodeLine lineNumber="9869"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09870" /><CodeLine lineNumber="9870"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09871" /><CodeLine lineNumber="9871"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsUniform) &#123;</Highlight></CodeLine>
<Link id="l09872" /><CodeLine lineNumber="9872"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Uniform within VL means we need to generate lane 0</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09873" /><CodeLine lineNumber="9873"><Highlight kind="normal">    State.ILV-&gt;scalarizeInstruction(UI, </Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/vplane">VPLane</a>(0), State);</Highlight></CodeLine>
<Link id="l09874" /><CodeLine lineNumber="9874"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09875" /><CodeLine lineNumber="9875"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09876" /><CodeLine lineNumber="9876"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09877" /><CodeLine lineNumber="9877"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// A store of a loop varying value to a uniform address only needs the last</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09878" /><CodeLine lineNumber="9878"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// copy of the store.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09879" /><CodeLine lineNumber="9879"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;StoreInst&gt;</a>(UI) &amp;&amp;</Highlight></CodeLine>
<Link id="l09880" /><CodeLine lineNumber="9880"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/vputils/#a002a77cdbc23293b8f7a8458ffd0f905">vputils::isUniformAfterVectorization</a>(<a href="/docs/api/classes/llvm/vpuser/#a6e1b252a9bbdc1a440fb57a6257b97f4">getOperand</a>(1))) &#123;</Highlight></CodeLine>
<Link id="l09881" /><CodeLine lineNumber="9881"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Lane = <a href="/docs/api/classes/llvm/vplane/#a0e95bf2235bec4b650114e87c75e072c">VPLane::getLastLaneForVF</a>(State.VF);</Highlight></CodeLine>
<Link id="l09882" /><CodeLine lineNumber="9882"><Highlight kind="normal">    State.ILV-&gt;scalarizeInstruction(UI, </Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/vplane">VPLane</a>(Lane), State);</Highlight></CodeLine>
<Link id="l09883" /><CodeLine lineNumber="9883"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09884" /><CodeLine lineNumber="9884"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09885" /><CodeLine lineNumber="9885"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09886" /><CodeLine lineNumber="9886"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Generate scalar instances for all VF lanes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09887" /><CodeLine lineNumber="9887"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!State.VF.isScalable() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Can&#39;t scalarize a scalable vector&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09888" /><CodeLine lineNumber="9888"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> EndLane = State.VF.getKnownMinValue();</Highlight></CodeLine>
<Link id="l09889" /><CodeLine lineNumber="9889"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Lane = 0; Lane &lt; EndLane; ++Lane)</Highlight></CodeLine>
<Link id="l09890" /><CodeLine lineNumber="9890"><Highlight kind="normal">    State.ILV-&gt;scalarizeInstruction(UI, </Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">, <a href="/docs/api/classes/llvm/vplane">VPLane</a>(Lane), State);</Highlight></CodeLine>
<Link id="l09891" /><CodeLine lineNumber="9891"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l09892" /><CodeLine lineNumber="9892"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09893" /><CodeLine lineNumber="9893"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Determine how to lower the scalar epilogue, which depends on 1) optimising</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09894" /><CodeLine lineNumber="9894"><Highlight kind="normal"></Highlight><Highlight kind="comment">// for minimum code-size, 2) predicate compiler options, 3) loop hints forcing</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09895" /><CodeLine lineNumber="9895"><Highlight kind="normal"></Highlight><Highlight kind="comment">// predication, and 4) a TTI hook that analyses whether the loop is suitable</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09896" /><CodeLine lineNumber="9896"><Highlight kind="normal"></Highlight><Highlight kind="comment">// for predication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09897" /><CodeLine lineNumber="9897" lineLink="#a8cde912cc23c18f493e4e5005c85748b"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> <a href="#a8cde912cc23c18f493e4e5005c85748b">getScalarEpilogueLowering</a>(</Highlight></CodeLine>
<Link id="l09898" /><CodeLine lineNumber="9898"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> &amp;Hints, <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI,</Highlight></CodeLine>
<Link id="l09899" /><CodeLine lineNumber="9899"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI,</Highlight></CodeLine>
<Link id="l09900" /><CodeLine lineNumber="9900"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &amp;LVL, <a href="/docs/api/classes/llvm/interleavedaccessinfo">InterleavedAccessInfo</a> &#42;IAI) &#123;</Highlight></CodeLine>
<Link id="l09901" /><CodeLine lineNumber="9901"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 1) OptSize takes precedence over all other options, i.e. if this is set,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09902" /><CodeLine lineNumber="9902"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// don&#39;t look at hints or options, and don&#39;t request a scalar epilogue.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09903" /><CodeLine lineNumber="9903"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// (For PGSO, as shouldOptimizeForSize isn&#39;t currently accessible from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09904" /><CodeLine lineNumber="9904"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// LoopAccessInfo (due to code dependency and not being able to reliably get</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09905" /><CodeLine lineNumber="9905"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// PSI/BFI from a loop analysis under NPM), we cannot suppress the collection</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09906" /><CodeLine lineNumber="9906"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// of strides in LoopAccessInfo::analyzeLoop() and vectorize without</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09907" /><CodeLine lineNumber="9907"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// versioning when the vectorization is forced, unlike hasOptSize. So revert</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09908" /><CodeLine lineNumber="9908"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// back to the old way and vectorize with versioning when forced. See D81345.)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09909" /><CodeLine lineNumber="9909"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;hasOptSize() || (<a href="/docs/api/namespaces/llvm/#a3af72f14ea20f2c762c751d2d49e5ea3">llvm::shouldOptimizeForSize</a>(L-&gt;getHeader(), PSI, BFI,</Highlight></CodeLine>
<Link id="l09910" /><CodeLine lineNumber="9910"><Highlight kind="normal">                                                      <a href="/docs/api/namespaces/llvm/#aec7c967a5416fa6e154433965357a50ea089e7eb4db258e05f70eef4ed5aa10bb">PGSOQueryType::IRPass</a>) &amp;&amp;</Highlight></CodeLine>
<Link id="l09911" /><CodeLine lineNumber="9911"><Highlight kind="normal">                          Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a20ecacbd54e401685d798d86161af6cf">getForce</a>() != <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a>))</Highlight></CodeLine>
<Link id="l09912" /><CodeLine lineNumber="9912"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da4f61afe29426363c5cf62d4ee93199b7">CM&#95;ScalarEpilogueNotAllowedOptSize</a>;</Highlight></CodeLine>
<Link id="l09913" /><CodeLine lineNumber="9913"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09914" /><CodeLine lineNumber="9914"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 2) If set, obey the directives</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09915" /><CodeLine lineNumber="9915"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#abe3c68238712d04bbe3a70f3a8f483f5">PreferPredicateOverEpilogue</a>.getNumOccurrences()) &#123;</Highlight></CodeLine>
<Link id="l09916" /><CodeLine lineNumber="9916"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (<a href="#abe3c68238712d04bbe3a70f3a8f483f5">PreferPredicateOverEpilogue</a>) &#123;</Highlight></CodeLine>
<Link id="l09917" /><CodeLine lineNumber="9917"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa114bc9020d046f551b06f41f6f4539f7">PreferPredicateTy::ScalarEpilogue</a>:</Highlight></CodeLine>
<Link id="l09918" /><CodeLine lineNumber="9918"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>;</Highlight></CodeLine>
<Link id="l09919" /><CodeLine lineNumber="9919"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa3111b239a92c1674cea87d025e818091">PreferPredicateTy::PredicateElseScalarEpilogue</a>:</Highlight></CodeLine>
<Link id="l09920" /><CodeLine lineNumber="9920"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>;</Highlight></CodeLine>
<Link id="l09921" /><CodeLine lineNumber="9921"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/preferpredicatety/#ab00d54c73f16daa1e1f9f65f77db0cdaa5e6f0abe1c426939c61d8924cfa02e5a">PreferPredicateTy::PredicateOrDontVectorize</a>:</Highlight></CodeLine>
<Link id="l09922" /><CodeLine lineNumber="9922"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9dab8edd8f39c728bd8b0045b64768ef206">CM&#95;ScalarEpilogueNotAllowedUsePredicate</a>;</Highlight></CodeLine>
<Link id="l09923" /><CodeLine lineNumber="9923"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l09924" /><CodeLine lineNumber="9924"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09925" /><CodeLine lineNumber="9925"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09926" /><CodeLine lineNumber="9926"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 3) If set, obey the hints</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09927" /><CodeLine lineNumber="9927"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a7592f6d851162d7f66f26408f40e9388">getPredicate</a>()) &#123;</Highlight></CodeLine>
<Link id="l09928" /><CodeLine lineNumber="9928"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a>:</Highlight></CodeLine>
<Link id="l09929" /><CodeLine lineNumber="9929"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>;</Highlight></CodeLine>
<Link id="l09930" /><CodeLine lineNumber="9930"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea980c2c6e59ca5dcf413baa325d8bc385">LoopVectorizeHints::FK&#95;Disabled</a>:</Highlight></CodeLine>
<Link id="l09931" /><CodeLine lineNumber="9931"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>;</Highlight></CodeLine>
<Link id="l09932" /><CodeLine lineNumber="9932"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l09933" /><CodeLine lineNumber="9933"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09934" /><CodeLine lineNumber="9934"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 4) if the TTI hook indicates this is profitable, request predication.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09935" /><CodeLine lineNumber="9935"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/tailfoldinginfo">TailFoldingInfo</a> TFI(TLI, &amp;LVL, IAI);</Highlight></CodeLine>
<Link id="l09936" /><CodeLine lineNumber="9936"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>-&gt;preferPredicateOverEpilogue(&amp;TFI))</Highlight></CodeLine>
<Link id="l09937" /><CodeLine lineNumber="9937"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>;</Highlight></CodeLine>
<Link id="l09938" /><CodeLine lineNumber="9938"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09939" /><CodeLine lineNumber="9939"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>;</Highlight></CodeLine>
<Link id="l09940" /><CodeLine lineNumber="9940"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l09941" /><CodeLine lineNumber="9941"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09942" /><CodeLine lineNumber="9942"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Process the loop in the VPlan-native vectorization path. This path builds</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09943" /><CodeLine lineNumber="9943"><Highlight kind="normal"></Highlight><Highlight kind="comment">// VPlan upfront in the vectorization pipeline, which allows to apply</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09944" /><CodeLine lineNumber="9944"><Highlight kind="normal"></Highlight><Highlight kind="comment">// VPlan-to-VPlan transformations from the very beginning without modifying the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09945" /><CodeLine lineNumber="9945"><Highlight kind="normal"></Highlight><Highlight kind="comment">// input LLVM IR.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09946" /><CodeLine lineNumber="9946" lineLink="#adeb41c907ebde15846bc643325909f95"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#adeb41c907ebde15846bc643325909f95">processLoopInVPlanNativePath</a>(</Highlight></CodeLine>
<Link id="l09947" /><CodeLine lineNumber="9947"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;PSE, <a href="/docs/api/classes/llvm/loopinfo">LoopInfo</a> &#42;LI, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</Highlight></CodeLine>
<Link id="l09948" /><CodeLine lineNumber="9948"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> &#42;LVL, <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</Highlight></CodeLine>
<Link id="l09949" /><CodeLine lineNumber="9949"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/targetlibraryinfo">TargetLibraryInfo</a> &#42;TLI, <a href="/docs/api/classes/llvm/demandedbits">DemandedBits</a> &#42;DB, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</Highlight></CodeLine>
<Link id="l09950" /><CodeLine lineNumber="9950"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI,</Highlight></CodeLine>
<Link id="l09951" /><CodeLine lineNumber="9951"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/profilesummaryinfo">ProfileSummaryInfo</a> &#42;PSI, <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> &amp;Hints,</Highlight></CodeLine>
<Link id="l09952" /><CodeLine lineNumber="9952"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loopvectorizationrequirements">LoopVectorizationRequirements</a> &amp;Requirements) &#123;</Highlight></CodeLine>
<Link id="l09953" /><CodeLine lineNumber="9953"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09954" /><CodeLine lineNumber="9954"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;SCEVCouldNotCompute&gt;</a>(PSE.<a href="/docs/api/classes/llvm/predicatedscalarevolution/#ada1db826f3d2266fe2c4d06218d8d342">getBackedgeTakenCount</a>())) &#123;</Highlight></CodeLine>
<Link id="l09955" /><CodeLine lineNumber="9955"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: cannot compute the outer-loop trip count\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09956" /><CodeLine lineNumber="9956"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09957" /><CodeLine lineNumber="9957"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l09958" /><CodeLine lineNumber="9958"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a> &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;VPlan-native path is disabled.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09959" /><CodeLine lineNumber="9959"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = L-&gt;getHeader()-&gt;getParent();</Highlight></CodeLine>
<Link id="l09960" /><CodeLine lineNumber="9960"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/interleavedaccessinfo">InterleavedAccessInfo</a> IAI(PSE, L, DT, LI, LVL-&gt;<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab5632546144c4db5bbe1f975aeebd9d2">getLAI</a>());</Highlight></CodeLine>
<Link id="l09961" /><CodeLine lineNumber="9961"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09962" /><CodeLine lineNumber="9962"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> </Highlight><Highlight kind="keywordtype">SEL</Highlight><Highlight kind="normal"> =</Highlight></CodeLine>
<Link id="l09963" /><CodeLine lineNumber="9963"><Highlight kind="normal">      <a href="#a8cde912cc23c18f493e4e5005c85748b">getScalarEpilogueLowering</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, L, Hints, PSI, BFI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, TLI, &#42;LVL, &amp;IAI);</Highlight></CodeLine>
<Link id="l09964" /><CodeLine lineNumber="9964"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09965" /><CodeLine lineNumber="9965"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> CM(</Highlight><Highlight kind="keywordtype">SEL</Highlight><Highlight kind="normal">, L, PSE, LI, LVL, &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, TLI, DB, AC, ORE, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</Highlight></CodeLine>
<Link id="l09966" /><CodeLine lineNumber="9966"><Highlight kind="normal">                                &amp;Hints, IAI);</Highlight></CodeLine>
<Link id="l09967" /><CodeLine lineNumber="9967"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Use the planner for outer loop vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09968" /><CodeLine lineNumber="9968"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: CM is not used at this point inside the planner. Turn CM into an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09969" /><CodeLine lineNumber="9969"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// optional argument if we don&#39;t need it in the future.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09970" /><CodeLine lineNumber="9970"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationplanner">LoopVectorizationPlanner</a> LVP(L, LI, DT, TLI, &#42;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, LVL, CM, IAI, PSE, Hints,</Highlight></CodeLine>
<Link id="l09971" /><CodeLine lineNumber="9971"><Highlight kind="normal">                               ORE);</Highlight></CodeLine>
<Link id="l09972" /><CodeLine lineNumber="9972"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09973" /><CodeLine lineNumber="9973"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get user vectorization factor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09974" /><CodeLine lineNumber="9974"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF = Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a50cae5c2df432357d50f182d310ce7b7">getWidth</a>();</Highlight></CodeLine>
<Link id="l09975" /><CodeLine lineNumber="9975"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09976" /><CodeLine lineNumber="9976"><Highlight kind="normal">  CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a06f5d9725a2b1f7b06e8bf51f7d31417">collectElementTypesForWidening</a>();</Highlight></CodeLine>
<Link id="l09977" /><CodeLine lineNumber="9977"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09978" /><CodeLine lineNumber="9978"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Plan how to best vectorize, return the best VF and its cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09979" /><CodeLine lineNumber="9979"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> VF = LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a2206e77c573f4947146faa681ea8855e">planInVPlanNativePath</a>(UserVF);</Highlight></CodeLine>
<Link id="l09980" /><CodeLine lineNumber="9980"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09981" /><CodeLine lineNumber="9981"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we are stress testing VPlan builds, do not attempt to generate vector</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09982" /><CodeLine lineNumber="9982"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// code. Masked vector code generation support will follow soon.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09983" /><CodeLine lineNumber="9983"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Also, do not attempt to vectorize if no vector code will be produced.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09984" /><CodeLine lineNumber="9984"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a9f30855a6efcd4a12875deb88880b510">VPlanBuildStressTest</a> || <a href="/docs/api/structs/llvm/vectorizationfactor/#acd24dfdad4f887e1f7b10c9039a05930">VectorizationFactor::Disabled</a>() == VF)</Highlight></CodeLine>
<Link id="l09985" /><CodeLine lineNumber="9985"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l09986" /><CodeLine lineNumber="9986"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09987" /><CodeLine lineNumber="9987"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;BestPlan = LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>);</Highlight></CodeLine>
<Link id="l09988" /><CodeLine lineNumber="9988"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09989" /><CodeLine lineNumber="9989"><Highlight kind="normal">  &#123;</Highlight></CodeLine>
<Link id="l09990" /><CodeLine lineNumber="9990"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AddBranchWeights =</Highlight></CodeLine>
<Link id="l09991" /><CodeLine lineNumber="9991"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;L-&gt;getLoopLatch()-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l09992" /><CodeLine lineNumber="9992"><Highlight kind="normal">    GeneratedRTChecks Checks(PSE, DT, LI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getDataLayout(),</Highlight></CodeLine>
<Link id="l09993" /><CodeLine lineNumber="9993"><Highlight kind="normal">                             AddBranchWeights, CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l09994" /><CodeLine lineNumber="9994"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/innerloopvectorizer">InnerLoopVectorizer</a> LB(L, PSE, LI, DT, TLI, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, AC, ORE, VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>,</Highlight></CodeLine>
<Link id="l09995" /><CodeLine lineNumber="9995"><Highlight kind="normal">                           VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, 1, LVL, &amp;CM, BFI, PSI, Checks, BestPlan);</Highlight></CodeLine>
<Link id="l09996" /><CodeLine lineNumber="9996"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Vectorizing outer loop in \\&quot;&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l09997" /><CodeLine lineNumber="9997"><Highlight kind="normal">                      &lt;&lt; L-&gt;getHeader()-&gt;getParent()-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09998" /><CodeLine lineNumber="9998"><Highlight kind="normal">    LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#acbe2feb9e960936a43c845a1fa8eaba4">executePlan</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, 1, BestPlan, LB, DT, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l09999" /><CodeLine lineNumber="9999"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10000" /><CodeLine lineNumber="10000"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10001" /><CodeLine lineNumber="10001"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a0c19b37908311872f655348755e8d003">reportVectorization</a>(ORE, L, VF, 1);</Highlight></CodeLine>
<Link id="l10002" /><CodeLine lineNumber="10002"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10003" /><CodeLine lineNumber="10003"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Mark the loop as already vectorized to avoid vectorizing again.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10004" /><CodeLine lineNumber="10004"><Highlight kind="normal">  Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#aa2f5ef2d522fb80de283a23d5bed6d86">setAlreadyVectorized</a>();</Highlight></CodeLine>
<Link id="l10005" /><CodeLine lineNumber="10005"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a26389c546573f058ad8ecbdc5c1933cf">verifyFunction</a>(&#42;L-&gt;getHeader()-&gt;getParent(), &amp;<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</Highlight></CodeLine>
<Link id="l10006" /><CodeLine lineNumber="10006"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10007" /><CodeLine lineNumber="10007"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l10008" /><CodeLine lineNumber="10008"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10009" /><CodeLine lineNumber="10009"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Emit a remark if there are stores to floats that required a floating point</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10010" /><CodeLine lineNumber="10010"><Highlight kind="normal"></Highlight><Highlight kind="comment">// extension. If the vectorized loop was generated with floating point there</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10011" /><CodeLine lineNumber="10011"><Highlight kind="normal"></Highlight><Highlight kind="comment">// will be a performance penalty from the conversion overhead and the change in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10012" /><CodeLine lineNumber="10012"><Highlight kind="normal"></Highlight><Highlight kind="comment">// the vector width.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10013" /><CodeLine lineNumber="10013" lineLink="#af1fba45879c49d4839b11ec30afd7532"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#af1fba45879c49d4839b11ec30afd7532">checkMixedPrecision</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L, <a href="/docs/api/classes/llvm/optimizationremarkemitter">OptimizationRemarkEmitter</a> &#42;ORE) &#123;</Highlight></CodeLine>
<Link id="l10014" /><CodeLine lineNumber="10014"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> Worklist;</Highlight></CodeLine>
<Link id="l10015" /><CodeLine lineNumber="10015"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : L-&gt;getBlocks()) &#123;</Highlight></CodeLine>
<Link id="l10016" /><CodeLine lineNumber="10016"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;Inst : &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l10017" /><CodeLine lineNumber="10017"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;S = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;StoreInst&gt;</a>(&amp;Inst)) &#123;</Highlight></CodeLine>
<Link id="l10018" /><CodeLine lineNumber="10018"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (S-&gt;getValueOperand()-&gt;getType()-&gt;isFloatTy())</Highlight></CodeLine>
<Link id="l10019" /><CodeLine lineNumber="10019"><Highlight kind="normal">          Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(S);</Highlight></CodeLine>
<Link id="l10020" /><CodeLine lineNumber="10020"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l10021" /><CodeLine lineNumber="10021"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l10022" /><CodeLine lineNumber="10022"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10023" /><CodeLine lineNumber="10023"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10024" /><CodeLine lineNumber="10024"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Traverse the floating point stores upwards searching, for floating point</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10025" /><CodeLine lineNumber="10025"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// conversions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10026" /><CodeLine lineNumber="10026"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Instruction &#42;, 4&gt;</a> Visited;</Highlight></CodeLine>
<Link id="l10027" /><CodeLine lineNumber="10027"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;const Instruction &#42;, 4&gt;</a> EmittedRemark;</Highlight></CodeLine>
<Link id="l10028" /><CodeLine lineNumber="10028"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l10029" /><CodeLine lineNumber="10029"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l10030" /><CodeLine lineNumber="10030"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!L-&gt;contains(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l10031" /><CodeLine lineNumber="10031"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10032" /><CodeLine lineNumber="10032"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>).second)</Highlight></CodeLine>
<Link id="l10033" /><CodeLine lineNumber="10033"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10034" /><CodeLine lineNumber="10034"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10035" /><CodeLine lineNumber="10035"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Emit a remark if the floating point store required a floating</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10036" /><CodeLine lineNumber="10036"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// point conversion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10037" /><CodeLine lineNumber="10037"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: More work could be done to identify the root cause such as a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10038" /><CodeLine lineNumber="10038"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// constant or a function return type and point the user to it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10039" /><CodeLine lineNumber="10039"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;FPExtInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &amp;&amp; EmittedRemark.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>).second)</Highlight></CodeLine>
<Link id="l10040" /><CodeLine lineNumber="10040"><Highlight kind="normal">      ORE-&gt;<a href="/docs/api/classes/llvm/optimizationremarkemitter/#aae6a98aea85aa3af87357cc5448db499">emit</a>(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l10041" /><CodeLine lineNumber="10041"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a>(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>, </Highlight><Highlight kind="stringliteral">&quot;VectorMixedPrecision&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10042" /><CodeLine lineNumber="10042"><Highlight kind="normal">                                          <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getDebugLoc(), L-&gt;getHeader())</Highlight></CodeLine>
<Link id="l10043" /><CodeLine lineNumber="10043"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;floating point conversion changes vector width. &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10044" /><CodeLine lineNumber="10044"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Mixed floating point precision requires an up/down &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10045" /><CodeLine lineNumber="10045"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;cast that will negatively impact performance.&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10046" /><CodeLine lineNumber="10046"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l10047" /><CodeLine lineNumber="10047"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10048" /><CodeLine lineNumber="10048"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/use">Use</a> &amp;<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a> : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;operands())</Highlight></CodeLine>
<Link id="l10049" /><CodeLine lineNumber="10049"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OpI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/namespaces/llvm/#ab471937b9a227e70c7fe8bd9604014d6">Op</a>))</Highlight></CodeLine>
<Link id="l10050" /><CodeLine lineNumber="10050"><Highlight kind="normal">        Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(OpI);</Highlight></CodeLine>
<Link id="l10051" /><CodeLine lineNumber="10051"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10052" /><CodeLine lineNumber="10052"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l10053" /><CodeLine lineNumber="10053"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10054" /><CodeLine lineNumber="10054" lineLink="#a362f793f3254317c698e3560548788a5"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a362f793f3254317c698e3560548788a5">areRuntimeChecksProfitable</a>(GeneratedRTChecks &amp;Checks,</Highlight></CodeLine>
<Link id="l10055" /><CodeLine lineNumber="10055"><Highlight kind="normal">                                       <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> &amp;VF, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</Highlight></CodeLine>
<Link id="l10056" /><CodeLine lineNumber="10056"><Highlight kind="normal">                                       </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/targettransforminfo">TargetTransformInfo</a> &amp;<a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>,</Highlight></CodeLine>
<Link id="l10057" /><CodeLine lineNumber="10057"><Highlight kind="normal">                                       <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> &amp;PSE,</Highlight></CodeLine>
<Link id="l10058" /><CodeLine lineNumber="10058"><Highlight kind="normal">                                       <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> </Highlight><Highlight kind="keywordtype">SEL</Highlight><Highlight kind="normal">) &#123;</Highlight></CodeLine>
<Link id="l10059" /><CodeLine lineNumber="10059"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instructioncost">InstructionCost</a> CheckCost = Checks.getCost();</Highlight></CodeLine>
<Link id="l10060" /><CodeLine lineNumber="10060"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CheckCost.<a href="/docs/api/classes/llvm/instructioncost/#ae01c5ced9fe2fe50f421ae121483ef04">isValid</a>())</Highlight></CodeLine>
<Link id="l10061" /><CodeLine lineNumber="10061"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10062" /><CodeLine lineNumber="10062"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10063" /><CodeLine lineNumber="10063"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// When interleaving only scalar and vector cost will be equal, which in turn</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10064" /><CodeLine lineNumber="10064"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// would lead to a divide by 0 Fall back to hard threshold.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10065" /><CodeLine lineNumber="10065"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>()) &#123;</Highlight></CodeLine>
<Link id="l10066" /><CodeLine lineNumber="10066"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CheckCost &gt; <a href="#a1293f02da7fffb33096a44f1b1768b3f">VectorizeMemoryCheckThreshold</a>) &#123;</Highlight></CodeLine>
<Link id="l10067" /><CodeLine lineNumber="10067"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l10068" /><CodeLine lineNumber="10068"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()</Highlight></CodeLine>
<Link id="l10069" /><CodeLine lineNumber="10069"><Highlight kind="normal">          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Interleaving only is not profitable due to runtime checks\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10070" /><CodeLine lineNumber="10070"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10071" /><CodeLine lineNumber="10071"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l10072" /><CodeLine lineNumber="10072"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10073" /><CodeLine lineNumber="10073"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10074" /><CodeLine lineNumber="10074"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10075" /><CodeLine lineNumber="10075"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The scalar cost should only be 0 when vectorizing with a user specified VF/IC. In those cases, runtime checks should always be generated.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10076" /><CodeLine lineNumber="10076"><Highlight kind="normal">  uint64&#95;t ScalarC = &#42;VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a76f716c04dfa813b98e1c112bc642d34">ScalarCost</a>.<a href="/docs/api/classes/llvm/instructioncost/#a9b642067999075ba996ecdee40b52b68">getValue</a>();</Highlight></CodeLine>
<Link id="l10077" /><CodeLine lineNumber="10077"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ScalarC == 0)</Highlight></CodeLine>
<Link id="l10078" /><CodeLine lineNumber="10078"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10079" /><CodeLine lineNumber="10079"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10080" /><CodeLine lineNumber="10080"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// First, compute the minimum iteration count required so that the vector</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10081" /><CodeLine lineNumber="10081"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// loop outperforms the scalar loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10082" /><CodeLine lineNumber="10082"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  The total cost of the scalar loop is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10083" /><CodeLine lineNumber="10083"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   ScalarC &#42; TC</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10084" /><CodeLine lineNumber="10084"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  where</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10085" /><CodeLine lineNumber="10085"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  &#42; TC is the actual trip count of the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10086" /><CodeLine lineNumber="10086"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  &#42; ScalarC is the cost of a single scalar iteration.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10087" /><CodeLine lineNumber="10087"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10088" /><CodeLine lineNumber="10088"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  The total cost of the vector loop is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10089" /><CodeLine lineNumber="10089"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    RtC + VecC &#42; (TC / VF) + EpiC</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10090" /><CodeLine lineNumber="10090"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  where</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10091" /><CodeLine lineNumber="10091"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  &#42; RtC is the cost of the generated runtime checks</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10092" /><CodeLine lineNumber="10092"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  &#42; VecC is the cost of a single vector iteration.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10093" /><CodeLine lineNumber="10093"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  &#42; TC is the actual trip count of the loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10094" /><CodeLine lineNumber="10094"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  &#42; VF is the vectorization factor</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10095" /><CodeLine lineNumber="10095"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  &#42; EpiCost is the cost of the generated epilogue, including the cost</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10096" /><CodeLine lineNumber="10096"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//    of the remaining scalar operations.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10097" /><CodeLine lineNumber="10097"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10098" /><CodeLine lineNumber="10098"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Vectorization is profitable once the total vector cost is less than the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10099" /><CodeLine lineNumber="10099"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// total scalar cost:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10100" /><CodeLine lineNumber="10100"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   RtC + VecC &#42; (TC / VF) + EpiC &lt;  ScalarC &#42; TC</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10101" /><CodeLine lineNumber="10101"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10102" /><CodeLine lineNumber="10102"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now we can compute the minimum required trip count TC as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10103" /><CodeLine lineNumber="10103"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   VF &#42; (RtC + EpiC) / (ScalarC &#42; VF - VecC) &lt; TC</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10104" /><CodeLine lineNumber="10104"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10105" /><CodeLine lineNumber="10105"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For now we assume the epilogue cost EpiC = 0 for simplicity. Note that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10106" /><CodeLine lineNumber="10106"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the computations are performed on doubles, not integers and the result</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10107" /><CodeLine lineNumber="10107"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is rounded up, hence we get an upper estimate of the TC.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10108" /><CodeLine lineNumber="10108"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IntVF = <a href="#ab3df41ae1ed3978e3b825bc4dd50ae8d">getEstimatedRuntimeVF</a>(L, <a href="/docs/api/namespaces/llvm/#aa0d69e81725c10fa5407f0bf34462068">TTI</a>, VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>);</Highlight></CodeLine>
<Link id="l10109" /><CodeLine lineNumber="10109"><Highlight kind="normal">  uint64&#95;t RtC = &#42;CheckCost.<a href="/docs/api/classes/llvm/instructioncost/#a9b642067999075ba996ecdee40b52b68">getValue</a>();</Highlight></CodeLine>
<Link id="l10110" /><CodeLine lineNumber="10110"><Highlight kind="normal">  uint64&#95;t Div = ScalarC &#42; IntVF - &#42;VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a048d568675a5cc69c3fb85206882316d">Cost</a>.<a href="/docs/api/classes/llvm/instructioncost/#a9b642067999075ba996ecdee40b52b68">getValue</a>();</Highlight></CodeLine>
<Link id="l10111" /><CodeLine lineNumber="10111"><Highlight kind="normal">  uint64&#95;t MinTC1 = Div == 0 ? 0 : <a href="/docs/api/namespaces/llvm/#a9dda4472ee0b7ea92ab49eedf6e13d50">divideCeil</a>(RtC &#42; IntVF, Div);</Highlight></CodeLine>
<Link id="l10112" /><CodeLine lineNumber="10112"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10113" /><CodeLine lineNumber="10113"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Second, compute a minimum iteration count so that the cost of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10114" /><CodeLine lineNumber="10114"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// runtime checks is only a fraction of the total scalar loop cost. This</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10115" /><CodeLine lineNumber="10115"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// adds a loop-dependent bound on the overhead incurred if the runtime</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10116" /><CodeLine lineNumber="10116"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// checks fail. In case the runtime checks fail, the cost is RtC + ScalarC</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10117" /><CodeLine lineNumber="10117"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// &#42; TC. To bound the runtime check to be a fraction 1/X of the scalar</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10118" /><CodeLine lineNumber="10118"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// cost, compute</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10119" /><CodeLine lineNumber="10119"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   RtC &lt; ScalarC &#42; TC &#42; (1 / X)  ==&gt;  RtC &#42; X / ScalarC &lt; TC</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10120" /><CodeLine lineNumber="10120"><Highlight kind="normal">  uint64&#95;t MinTC2 = <a href="/docs/api/namespaces/llvm/#a9dda4472ee0b7ea92ab49eedf6e13d50">divideCeil</a>(RtC &#42; 10, ScalarC);</Highlight></CodeLine>
<Link id="l10121" /><CodeLine lineNumber="10121"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10122" /><CodeLine lineNumber="10122"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now pick the larger minimum. If it is not a multiple of VF and a scalar</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10123" /><CodeLine lineNumber="10123"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// epilogue is allowed, choose the next closest multiple of VF. This should</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10124" /><CodeLine lineNumber="10124"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// partly compensate for ignoring the epilogue cost.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10125" /><CodeLine lineNumber="10125"><Highlight kind="normal">  uint64&#95;t MinTC = std::max(MinTC1, MinTC2);</Highlight></CodeLine>
<Link id="l10126" /><CodeLine lineNumber="10126"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">SEL</Highlight><Highlight kind="normal"> == <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da65f7ef37c3a0cd826b5e361e8cf32cf7">CM&#95;ScalarEpilogueAllowed</a>)</Highlight></CodeLine>
<Link id="l10127" /><CodeLine lineNumber="10127"><Highlight kind="normal">    MinTC = <a href="/docs/api/namespaces/llvm/#ab102f0f12dd38aeea5906b1d80c792ff">alignTo</a>(MinTC, IntVF);</Highlight></CodeLine>
<Link id="l10128" /><CodeLine lineNumber="10128"><Highlight kind="normal">  VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a0c1900dc8fe6b998c1de1880f300dcfa">MinProfitableTripCount</a> = <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(MinTC);</Highlight></CodeLine>
<Link id="l10129" /><CodeLine lineNumber="10129"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10130" /><CodeLine lineNumber="10130"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l10131" /><CodeLine lineNumber="10131"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Minimum required TC for runtime checks to be profitable:&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10132" /><CodeLine lineNumber="10132"><Highlight kind="normal">             &lt;&lt; VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a0c1900dc8fe6b998c1de1880f300dcfa">MinProfitableTripCount</a> &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10133" /><CodeLine lineNumber="10133"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10134" /><CodeLine lineNumber="10134"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Skip vectorization if the expected trip count is less than the minimum</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10135" /><CodeLine lineNumber="10135"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// required trip count.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10136" /><CodeLine lineNumber="10136"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ExpectedTC = <a href="#a84375e6536d9214c7895013078055aff">getSmallBestKnownTC</a>(PSE, L)) &#123;</Highlight></CodeLine>
<Link id="l10137" /><CodeLine lineNumber="10137"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/details/fixedorscalablequantity/#a83e6442f8ebefccdb5e089732fe397ac">ElementCount::isKnownLT</a>(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(&#42;ExpectedTC),</Highlight></CodeLine>
<Link id="l10138" /><CodeLine lineNumber="10138"><Highlight kind="normal">                                VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a0c1900dc8fe6b998c1de1880f300dcfa">MinProfitableTripCount</a>)) &#123;</Highlight></CodeLine>
<Link id="l10139" /><CodeLine lineNumber="10139"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Vectorization is not beneficial: expected &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10140" /><CodeLine lineNumber="10140"><Highlight kind="normal">                           </Highlight><Highlight kind="stringliteral">&quot;trip count &lt; minimum profitable VF (&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10141" /><CodeLine lineNumber="10141"><Highlight kind="normal">                        &lt;&lt; &#42;ExpectedTC &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; &lt; &quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a0c1900dc8fe6b998c1de1880f300dcfa">MinProfitableTripCount</a></Highlight></CodeLine>
<Link id="l10142" /><CodeLine lineNumber="10142"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;)\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10143" /><CodeLine lineNumber="10143"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10144" /><CodeLine lineNumber="10144"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10145" /><CodeLine lineNumber="10145"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l10146" /><CodeLine lineNumber="10146"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10147" /><CodeLine lineNumber="10147"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10148" /><CodeLine lineNumber="10148"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l10149" /><CodeLine lineNumber="10149"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10150" /><CodeLine lineNumber="10150" lineLink="/docs/api/structs/llvm/loopvectorizepass/#a51be961763c595602654e8d825f26b59"><Highlight kind="normal"><a href="/docs/api/structs/llvm/loopvectorizepass/#a51be961763c595602654e8d825f26b59">LoopVectorizePass::LoopVectorizePass</a>(<a href="/docs/api/structs/llvm/loopvectorizeoptions">LoopVectorizeOptions</a> Opts)</Highlight></CodeLine>
<Link id="l10151" /><CodeLine lineNumber="10151"><Highlight kind="normal">    : InterleaveOnlyWhenForced(Opts.InterleaveOnlyWhenForced ||</Highlight></CodeLine>
<Link id="l10152" /><CodeLine lineNumber="10152"><Highlight kind="normal">                               !<a href="/docs/api/namespaces/llvm/#af98e93062e9f33018307ffc64d4b009e">EnableLoopInterleaving</a>),</Highlight></CodeLine>
<Link id="l10153" /><CodeLine lineNumber="10153"><Highlight kind="normal">      VectorizeOnlyWhenForced(Opts.VectorizeOnlyWhenForced ||</Highlight></CodeLine>
<Link id="l10154" /><CodeLine lineNumber="10154"><Highlight kind="normal">                              !<a href="/docs/api/namespaces/llvm/#a7f386d38a2c6c22a343243e9e48f7532">EnableLoopVectorization</a>) &#123;&#125;</Highlight></CodeLine>
<Link id="l10155" /><CodeLine lineNumber="10155"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l10156" /><CodeLine lineNumber="10156"><Highlight kind="comment">/// Prepare \\p MainPlan for vectorizing the main vector loop during epilogue</Highlight></CodeLine>
<Link id="l10157" /><CodeLine lineNumber="10157"><Highlight kind="comment">/// vectorization. Remove ResumePhis from \\p MainPlan for inductions that</Highlight></CodeLine>
<Link id="l10158" /><CodeLine lineNumber="10158"><Highlight kind="comment">/// don&#39;t have a corresponding wide induction in \\p EpiPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10159" /><CodeLine lineNumber="10159" lineLink="#a13368acf4fbb5816c3d82099b11519b1"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a13368acf4fbb5816c3d82099b11519b1">preparePlanForMainVectorLoop</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;MainPlan, <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;EpiPlan) &#123;</Highlight></CodeLine>
<Link id="l10160" /><CodeLine lineNumber="10160"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect PHI nodes of widened phis in the VPlan for the epilogue. Those</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10161" /><CodeLine lineNumber="10161"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// will need their resume-values computed in the main vector loop. Others</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10162" /><CodeLine lineNumber="10162"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// can be removed from the main VPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10163" /><CodeLine lineNumber="10163"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;PHINode &#42;, 2&gt;</a> EpiWidenedPhis;</Highlight></CodeLine>
<Link id="l10164" /><CodeLine lineNumber="10164"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R :</Highlight></CodeLine>
<Link id="l10165" /><CodeLine lineNumber="10165"><Highlight kind="normal">       EpiPlan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>()-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>()-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a668c6f14a461ccf0ee11c9c7a076a901">phis</a>()) &#123;</Highlight></CodeLine>
<Link id="l10166" /><CodeLine lineNumber="10166"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;VPCanonicalIVPHIRecipe&gt;</a>(&amp;R))</Highlight></CodeLine>
<Link id="l10167" /><CodeLine lineNumber="10167"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10168" /><CodeLine lineNumber="10168"><Highlight kind="normal">    EpiWidenedPhis.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(</Highlight></CodeLine>
<Link id="l10169" /><CodeLine lineNumber="10169"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(R.getVPSingleValue()-&gt;getUnderlyingValue()));</Highlight></CodeLine>
<Link id="l10170" /><CodeLine lineNumber="10170"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10171" /><CodeLine lineNumber="10171"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(</Highlight></CodeLine>
<Link id="l10172" /><CodeLine lineNumber="10172"><Highlight kind="normal">           &#42;<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPIRBasicBlock&gt;</a>(MainPlan.<a href="/docs/api/classes/llvm/vplan/#ae56a6505c6bfa319e686fc23acd52495">getScalarHeader</a>()))) &#123;</Highlight></CodeLine>
<Link id="l10173" /><CodeLine lineNumber="10173"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;VPIRInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPIRInstruction&gt;</a>(&amp;R);</Highlight></CodeLine>
<Link id="l10174" /><CodeLine lineNumber="10174"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;IRI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(&amp;VPIRInst-&gt;getInstruction());</Highlight></CodeLine>
<Link id="l10175" /><CodeLine lineNumber="10175"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IRI)</Highlight></CodeLine>
<Link id="l10176" /><CodeLine lineNumber="10176"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10177" /><CodeLine lineNumber="10177"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EpiWidenedPhis.<a href="/docs/api/classes/llvm/smallptrsetimpl/#af74676a3c7447be34bd2c1da76ec0c48">contains</a>(IRI))</Highlight></CodeLine>
<Link id="l10178" /><CodeLine lineNumber="10178"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10179" /><CodeLine lineNumber="10179"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// There is no corresponding wide induction in the epilogue plan that would</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10180" /><CodeLine lineNumber="10180"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// need a resume value. Remove the VPIRInst wrapping the scalar header phi</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10181" /><CodeLine lineNumber="10181"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// together with the corresponding ResumePhi. The resume values for the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10182" /><CodeLine lineNumber="10182"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// scalar loop will be created during execution of EpiPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10183" /><CodeLine lineNumber="10183"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &#42;ResumePhi = VPIRInst-&gt;<a href="/docs/api/classes/llvm/vpuser/#a6e1b252a9bbdc1a440fb57a6257b97f4">getOperand</a>(0)-&gt;<a href="/docs/api/classes/llvm/vpvalue/#a3be8d7833df422f3538ddb13af69bd70">getDefiningRecipe</a>();</Highlight></CodeLine>
<Link id="l10184" /><CodeLine lineNumber="10184"><Highlight kind="normal">    VPIRInst-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#aac9dfb61b37082dca00de284bb3309e8">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l10185" /><CodeLine lineNumber="10185"><Highlight kind="normal">    ResumePhi-&gt;<a href="/docs/api/classes/llvm/vprecipebase/#aac9dfb61b37082dca00de284bb3309e8">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l10186" /><CodeLine lineNumber="10186"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10187" /><CodeLine lineNumber="10187"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vplantransforms/#aaca9dd97d4c523d8c65274654abe4eb9">VPlanTransforms::removeDeadRecipes</a>(MainPlan);</Highlight></CodeLine>
<Link id="l10188" /><CodeLine lineNumber="10188"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10189" /><CodeLine lineNumber="10189"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/vplanpatternmatch">VPlanPatternMatch</a>;</Highlight></CodeLine>
<Link id="l10190" /><CodeLine lineNumber="10190"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;MainScalarPH = MainPlan.<a href="/docs/api/classes/llvm/vplan/#ad5f29ccf71b0494fc179323427eb1e11">getScalarPreheader</a>();</Highlight></CodeLine>
<Link id="l10191" /><CodeLine lineNumber="10191"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;VectorTC = &amp;MainPlan.<a href="/docs/api/classes/llvm/vplan/#a233848f0bf7aef1aca22e6172e5d900d">getVectorTripCount</a>();</Highlight></CodeLine>
<Link id="l10192" /><CodeLine lineNumber="10192"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there is a suitable resume value for the canonical induction in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10193" /><CodeLine lineNumber="10193"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// scalar (which will become vector) epilogue loop we are done. Otherwise</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10194" /><CodeLine lineNumber="10194"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// create it below.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10195" /><CodeLine lineNumber="10195"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(&#42;MainScalarPH, &#91;VectorTC&#93;(<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R) &#123;</Highlight></CodeLine>
<Link id="l10196" /><CodeLine lineNumber="10196"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/patternmatch/#a25d956d9e0beadd47ce4bc255dfa811d">match</a>(&amp;R, m&#95;VPInstruction&lt;VPInstruction::ResumePhi&gt;(</Highlight></CodeLine>
<Link id="l10197" /><CodeLine lineNumber="10197"><Highlight kind="normal">                             <a href="/docs/api/namespaces/llvm/patternmatch/#a2d9861feadd3a09792967a012559e7b2">m&#95;Specific</a>(VectorTC), <a href="/docs/api/namespaces/llvm/patternmatch/#a2471be3f1b50002f54bf45c590d8d41b">m&#95;SpecificInt</a>(0)));</Highlight></CodeLine>
<Link id="l10198" /><CodeLine lineNumber="10198"><Highlight kind="normal">      &#125;))</Highlight></CodeLine>
<Link id="l10199" /><CodeLine lineNumber="10199"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10200" /><CodeLine lineNumber="10200"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbuilder">VPBuilder</a> ScalarPHBuilder(MainScalarPH, MainScalarPH-&gt;<a href="/docs/api/classes/llvm/vpbasicblock/#a4e30ea9d413dd86c802fee94aa8b5805">begin</a>());</Highlight></CodeLine>
<Link id="l10201" /><CodeLine lineNumber="10201"><Highlight kind="normal">  ScalarPHBuilder.<a href="/docs/api/classes/llvm/vpbuilder/#accbbcc76f9eb947b3804ad96beb2bbd2">createNaryOp</a>(</Highlight></CodeLine>
<Link id="l10202" /><CodeLine lineNumber="10202"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpinstruction/#a507f9482c01673384c0c203530dad6f2a36144832b0ebcda13ce881d2b60eaf91">VPInstruction::ResumePhi</a>,</Highlight></CodeLine>
<Link id="l10203" /><CodeLine lineNumber="10203"><Highlight kind="normal">      &#123;VectorTC, MainPlan.<a href="/docs/api/classes/llvm/vplan/#ad9053d6ed9627166c144b8895d1c1010">getCanonicalIV</a>()-&gt;<a href="/docs/api/classes/llvm/vpheaderphirecipe/#a92c12c8e69e03cc781dd010cdaa5f0e6">getStartValue</a>()&#125;, &#123;&#125;,</Highlight></CodeLine>
<Link id="l10204" /><CodeLine lineNumber="10204"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;vec.epilog.resume.val&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10205" /><CodeLine lineNumber="10205"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l10206" /><CodeLine lineNumber="10206"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l10207" /><CodeLine lineNumber="10207"><Highlight kind="comment">/// Prepare \\p Plan for vectorizing the epilogue loop. That is, re-use expanded</Highlight></CodeLine>
<Link id="l10208" /><CodeLine lineNumber="10208"><Highlight kind="comment">/// SCEVs from \\p ExpandedSCEVs and set resume values for header recipes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10209" /><CodeLine lineNumber="10209"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10210" /><CodeLine lineNumber="10210" lineLink="#aae23f7e6fc37b0f1bb756f938023512c"><Highlight kind="normal"><a href="#aae23f7e6fc37b0f1bb756f938023512c">preparePlanForEpilogueVectorLoop</a>(<a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;Plan, <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L,</Highlight></CodeLine>
<Link id="l10211" /><CodeLine lineNumber="10211"><Highlight kind="normal">                                 </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> SCEV2ValueTy &amp;ExpandedSCEVs,</Highlight></CodeLine>
<Link id="l10212" /><CodeLine lineNumber="10212"><Highlight kind="normal">                                 </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a> &amp;EPI) &#123;</Highlight></CodeLine>
<Link id="l10213" /><CodeLine lineNumber="10213"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpregionblock">VPRegionBlock</a> &#42;VectorLoop = Plan.<a href="/docs/api/classes/llvm/vplan/#a89f94c49b2cb5daaa93d19c89307c307">getVectorLoopRegion</a>();</Highlight></CodeLine>
<Link id="l10214" /><CodeLine lineNumber="10214"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/vpbasicblock">VPBasicBlock</a> &#42;Header = VectorLoop-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#ad928235da3a32b50ba65140da09daf5d">getEntryBasicBlock</a>();</Highlight></CodeLine>
<Link id="l10215" /><CodeLine lineNumber="10215"><Highlight kind="normal">  Header-&gt;<a href="/docs/api/classes/llvm/vpblockbase/#a2bd1c53f9607876b22c6fd3ec1e28a50">setName</a>(</Highlight><Highlight kind="stringliteral">&quot;vec.epilog.vector.body&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10216" /><CodeLine lineNumber="10216"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10217" /><CodeLine lineNumber="10217"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Re-use the trip count and steps expanded for the main loop, as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10218" /><CodeLine lineNumber="10218"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// skeleton creation needs it as a value that dominates both the scalar</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10219" /><CodeLine lineNumber="10219"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and vector epilogue loops</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10220" /><CodeLine lineNumber="10220"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// TODO: This is a workaround needed for epilogue vectorization and it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10221" /><CodeLine lineNumber="10221"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// should be removed once induction resume value creation is done</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10222" /><CodeLine lineNumber="10222"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// directly in VPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10223" /><CodeLine lineNumber="10223"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;R : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">make&#95;early&#95;inc&#95;range</a>(&#42;Plan.<a href="/docs/api/classes/llvm/vplan/#a1c868dfd250ff9592c06dd61a7fb0bcf">getEntry</a>())) &#123;</Highlight></CodeLine>
<Link id="l10224" /><CodeLine lineNumber="10224"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExpandR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPExpandSCEVRecipe&gt;</a>(&amp;R);</Highlight></CodeLine>
<Link id="l10225" /><CodeLine lineNumber="10225"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ExpandR)</Highlight></CodeLine>
<Link id="l10226" /><CodeLine lineNumber="10226"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10227" /><CodeLine lineNumber="10227"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExpandedVal =</Highlight></CodeLine>
<Link id="l10228" /><CodeLine lineNumber="10228"><Highlight kind="normal">        Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(ExpandedSCEVs.find(ExpandR-&gt;getSCEV())-&gt;second);</Highlight></CodeLine>
<Link id="l10229" /><CodeLine lineNumber="10229"><Highlight kind="normal">    ExpandR-&gt;<a href="/docs/api/classes/llvm/vpvalue/#abaad22a81f7fa4ce5b60ec619ac14c37">replaceAllUsesWith</a>(ExpandedVal);</Highlight></CodeLine>
<Link id="l10230" /><CodeLine lineNumber="10230"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Plan.<a href="/docs/api/classes/llvm/vplan/#a2f5fc19caa67daeca8a1316c7e055e3c">getTripCount</a>() == ExpandR)</Highlight></CodeLine>
<Link id="l10231" /><CodeLine lineNumber="10231"><Highlight kind="normal">      Plan.<a href="/docs/api/classes/llvm/vplan/#a9bb77d906fd1ae7e241f0c95dcba094b">resetTripCount</a>(ExpandedVal);</Highlight></CodeLine>
<Link id="l10232" /><CodeLine lineNumber="10232"><Highlight kind="normal">    ExpandR-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l10233" /><CodeLine lineNumber="10233"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10234" /><CodeLine lineNumber="10234"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10235" /><CodeLine lineNumber="10235"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Ensure that the start values for all header phi recipes are updated before</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10236" /><CodeLine lineNumber="10236"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vectorizing the epilogue loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10237" /><CodeLine lineNumber="10237"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/vprecipebase">VPRecipeBase</a> &amp;R : Header-&gt;phis()) &#123;</Highlight></CodeLine>
<Link id="l10238" /><CodeLine lineNumber="10238"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPCanonicalIVPHIRecipe&gt;</a>(&amp;R)) &#123;</Highlight></CodeLine>
<Link id="l10239" /><CodeLine lineNumber="10239"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// When vectorizing the epilogue loop, the canonical induction start</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10240" /><CodeLine lineNumber="10240"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// value needs to be changed from zero to the value after the main</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10241" /><CodeLine lineNumber="10241"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// vector loop. Find the resume value created during execution of the main</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10242" /><CodeLine lineNumber="10242"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// VPlan.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10243" /><CodeLine lineNumber="10243"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// FIXME: Improve modeling for canonical IV start values in the epilogue</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10244" /><CodeLine lineNumber="10244"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10245" /><CodeLine lineNumber="10245"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;MainMiddle = <a href="/docs/api/namespaces/llvm/#a8f6975e193997c4e0183e96774a7cb39">find&#95;singleton&lt;BasicBlock&gt;</a>(</Highlight></CodeLine>
<Link id="l10246" /><CodeLine lineNumber="10246"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(L-&gt;getLoopPreheader()),</Highlight></CodeLine>
<Link id="l10247" /><CodeLine lineNumber="10247"><Highlight kind="normal">          &#91;&amp;EPI&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal">) -&gt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l10248" /><CodeLine lineNumber="10248"><Highlight kind="normal">            if (BB != EPI.MainLoopIterationCountCheck &amp;&amp;</Highlight></CodeLine>
<Link id="l10249" /><CodeLine lineNumber="10249"><Highlight kind="normal">                BB != EPI.EpilogueIterationCountCheck &amp;&amp;</Highlight></CodeLine>
<Link id="l10250" /><CodeLine lineNumber="10250"><Highlight kind="normal">                BB != EPI.SCEVSafetyCheck &amp;&amp; BB != EPI.MemSafetyCheck)</Highlight></CodeLine>
<Link id="l10251" /><CodeLine lineNumber="10251"><Highlight kind="normal">              return BB;</Highlight></CodeLine>
<Link id="l10252" /><CodeLine lineNumber="10252"><Highlight kind="normal">            return nullptr;</Highlight></CodeLine>
<Link id="l10253" /><CodeLine lineNumber="10253"><Highlight kind="normal">          &#125;);</Highlight></CodeLine>
<Link id="l10254" /><CodeLine lineNumber="10254"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</Highlight></CodeLine>
<Link id="l10255" /><CodeLine lineNumber="10255"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/type">Type</a> &#42;IdxTy = <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;getScalarType();</Highlight></CodeLine>
<Link id="l10256" /><CodeLine lineNumber="10256"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;EPResumeVal = <a href="/docs/api/namespaces/llvm/#a8f6975e193997c4e0183e96774a7cb39">find&#95;singleton&lt;PHINode&gt;</a>(</Highlight></CodeLine>
<Link id="l10257" /><CodeLine lineNumber="10257"><Highlight kind="normal">          L-&gt;getLoopPreheader()-&gt;phis(),</Highlight></CodeLine>
<Link id="l10258" /><CodeLine lineNumber="10258"><Highlight kind="normal">          &#91;&amp;EPI, IdxTy, MainMiddle&#93;(<a href="/docs/api/classes/llvm/phinode">PHINode</a> &amp;<a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal">) -&gt; <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l10259" /><CodeLine lineNumber="10259"><Highlight kind="normal">            if (P.getType() == IdxTy &amp;&amp;</Highlight></CodeLine>
<Link id="l10260" /><CodeLine lineNumber="10260"><Highlight kind="normal">                P.getIncomingValueForBlock(MainMiddle) == EPI.VectorTripCount &amp;&amp;</Highlight></CodeLine>
<Link id="l10261" /><CodeLine lineNumber="10261"><Highlight kind="normal">                match(</Highlight></CodeLine>
<Link id="l10262" /><CodeLine lineNumber="10262"><Highlight kind="normal">                    P.getIncomingValueForBlock(EPI.MainLoopIterationCountCheck),</Highlight></CodeLine>
<Link id="l10263" /><CodeLine lineNumber="10263"><Highlight kind="normal">                    m&#95;SpecificInt(0)))</Highlight></CodeLine>
<Link id="l10264" /><CodeLine lineNumber="10264"><Highlight kind="normal">              return &amp;P;</Highlight></CodeLine>
<Link id="l10265" /><CodeLine lineNumber="10265"><Highlight kind="normal">            return nullptr;</Highlight></CodeLine>
<Link id="l10266" /><CodeLine lineNumber="10266"><Highlight kind="normal">          &#125;);</Highlight></CodeLine>
<Link id="l10267" /><CodeLine lineNumber="10267"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(EPResumeVal &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;must have a resume value for the canonical IV&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10268" /><CodeLine lineNumber="10268"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;VPV = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(EPResumeVal);</Highlight></CodeLine>
<Link id="l10269" /><CodeLine lineNumber="10269"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/namespaces/llvm/#a0d10fe510ced2849a8074fe81e5d04ce">all&#95;of</a>(<a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;users(),</Highlight></CodeLine>
<Link id="l10270" /><CodeLine lineNumber="10270"><Highlight kind="normal">                    &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/vpuser">VPUser</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l10271" /><CodeLine lineNumber="10271"><Highlight kind="normal">                      return isa&lt;VPScalarIVStepsRecipe&gt;(U) ||</Highlight></CodeLine>
<Link id="l10272" /><CodeLine lineNumber="10272"><Highlight kind="normal">                             isa&lt;VPScalarCastRecipe&gt;(U) ||</Highlight></CodeLine>
<Link id="l10273" /><CodeLine lineNumber="10273"><Highlight kind="normal">                             isa&lt;VPDerivedIVRecipe&gt;(U) ||</Highlight></CodeLine>
<Link id="l10274" /><CodeLine lineNumber="10274"><Highlight kind="normal">                             cast&lt;VPInstruction&gt;(U)-&gt;getOpcode() ==</Highlight></CodeLine>
<Link id="l10275" /><CodeLine lineNumber="10275"><Highlight kind="normal">                                 Instruction::Add;</Highlight></CodeLine>
<Link id="l10276" /><CodeLine lineNumber="10276"><Highlight kind="normal">                    &#125;) &amp;&amp;</Highlight></CodeLine>
<Link id="l10277" /><CodeLine lineNumber="10277"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;the canonical IV should only be used by its increment or &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10278" /><CodeLine lineNumber="10278"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;ScalarIVSteps when resetting the start value&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10279" /><CodeLine lineNumber="10279"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/lib/support/blake3/blake3-impl-h/#a78823051d1dad34b9b3d8120112e674d">IV</a>-&gt;setOperand(0, VPV);</Highlight></CodeLine>
<Link id="l10280" /><CodeLine lineNumber="10280"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10281" /><CodeLine lineNumber="10281"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l10282" /><CodeLine lineNumber="10282"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10283" /><CodeLine lineNumber="10283"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;ResumeV = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10284" /><CodeLine lineNumber="10284"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: Move setting of resume values to prepareToExecute.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10285" /><CodeLine lineNumber="10285"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ReductionPhi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;VPReductionPHIRecipe&gt;</a>(&amp;R)) &#123;</Highlight></CodeLine>
<Link id="l10286" /><CodeLine lineNumber="10286"><Highlight kind="normal">      ResumeV = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(ReductionPhi-&gt;getUnderlyingInstr())</Highlight></CodeLine>
<Link id="l10287" /><CodeLine lineNumber="10287"><Highlight kind="normal">                    -&gt;getIncomingValueForBlock(L-&gt;getLoopPreheader());</Highlight></CodeLine>
<Link id="l10288" /><CodeLine lineNumber="10288"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/recurrencedescriptor">RecurrenceDescriptor</a> &amp;RdxDesc =</Highlight></CodeLine>
<Link id="l10289" /><CodeLine lineNumber="10289"><Highlight kind="normal">          ReductionPhi-&gt;getRecurrenceDescriptor();</Highlight></CodeLine>
<Link id="l10290" /><CodeLine lineNumber="10290"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#aac36edd0f1ce976f0025c98e88d3830e">RecurKind</a> RK = RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a89e9d5a5838c63159df1aed56f600ef1">getRecurrenceKind</a>();</Highlight></CodeLine>
<Link id="l10291" /><CodeLine lineNumber="10291"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a69df67c7d92481ae63a5d8017e96c716">RecurrenceDescriptor::isAnyOfRecurrenceKind</a>(RK)) &#123;</Highlight></CodeLine>
<Link id="l10292" /><CodeLine lineNumber="10292"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// VPReductionPHIRecipes for AnyOf reductions expect a boolean as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10293" /><CodeLine lineNumber="10293"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// start value; compare the final value from the main vector loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10294" /><CodeLine lineNumber="10294"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// to the start value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10295" /><CodeLine lineNumber="10295"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;PBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(ResumeV)-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l10296" /><CodeLine lineNumber="10296"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(PBB, PBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>());</Highlight></CodeLine>
<Link id="l10297" /><CodeLine lineNumber="10297"><Highlight kind="normal">        ResumeV =</Highlight></CodeLine>
<Link id="l10298" /><CodeLine lineNumber="10298"><Highlight kind="normal">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a6ef1729b04a4fbd6c6f27787cdd0e813">CreateICmpNE</a>(ResumeV, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a61351428b7eb226cbad866ccf2382817">getRecurrenceStartValue</a>());</Highlight></CodeLine>
<Link id="l10299" /><CodeLine lineNumber="10299"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/recurrencedescriptor/#a7bc46d4489f4d6cb4a4e486ce5f6184b">RecurrenceDescriptor::isFindLastIVRecurrenceKind</a>(RK)) &#123;</Highlight></CodeLine>
<Link id="l10300" /><CodeLine lineNumber="10300"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// VPReductionPHIRecipe for FindLastIV reductions requires an adjustment</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10301" /><CodeLine lineNumber="10301"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// to the resume value. The resume value is adjusted to the sentinel</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10302" /><CodeLine lineNumber="10302"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// value when the final value from the main vector loop equals the start</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10303" /><CodeLine lineNumber="10303"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// value. This ensures correctness when the start value might not be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10304" /><CodeLine lineNumber="10304"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// less than the minimum value of a monotonically increasing induction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10305" /><CodeLine lineNumber="10305"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// variable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10306" /><CodeLine lineNumber="10306"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ResumeBB = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(ResumeV)-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l10307" /><CodeLine lineNumber="10307"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/irbuilder">IRBuilder&lt;&gt;</a> Builder(ResumeBB, ResumeBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>());</Highlight></CodeLine>
<Link id="l10308" /><CodeLine lineNumber="10308"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;Cmp =</Highlight></CodeLine>
<Link id="l10309" /><CodeLine lineNumber="10309"><Highlight kind="normal">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a8c75539a39f167f352b37ccdd788a7e4">CreateICmpEQ</a>(ResumeV, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#a61351428b7eb226cbad866ccf2382817">getRecurrenceStartValue</a>());</Highlight></CodeLine>
<Link id="l10310" /><CodeLine lineNumber="10310"><Highlight kind="normal">        ResumeV =</Highlight></CodeLine>
<Link id="l10311" /><CodeLine lineNumber="10311"><Highlight kind="normal">            Builder.<a href="/docs/api/classes/llvm/irbuilderbase/#a49b228f797f9b3563256da446100c3ac">CreateSelect</a>(Cmp, RdxDesc.<a href="/docs/api/classes/llvm/recurrencedescriptor/#aed10715d943d3e1b4ca75b585ea96ab8">getSentinelValue</a>(), ResumeV);</Highlight></CodeLine>
<Link id="l10312" /><CodeLine lineNumber="10312"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l10313" /><CodeLine lineNumber="10313"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l10314" /><CodeLine lineNumber="10314"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Retrieve the induction resume values for wide inductions from</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10315" /><CodeLine lineNumber="10315"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// their original phi nodes in the scalar loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10316" /><CodeLine lineNumber="10316"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;IndPhi = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPWidenInductionRecipe&gt;</a>(&amp;R)-&gt;getPHINode();</Highlight></CodeLine>
<Link id="l10317" /><CodeLine lineNumber="10317"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Hook up to the PHINode generated by a ResumePhi recipe of main</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10318" /><CodeLine lineNumber="10318"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// loop VPlan, which feeds the scalar loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10319" /><CodeLine lineNumber="10319"><Highlight kind="normal">      ResumeV = IndPhi-&gt;<a href="/docs/api/classes/llvm/phinode/#ab2db7609ec72b1af2f91d47e40dc3722">getIncomingValueForBlock</a>(L-&gt;getLoopPreheader());</Highlight></CodeLine>
<Link id="l10320" /><CodeLine lineNumber="10320"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l10321" /><CodeLine lineNumber="10321"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ResumeV &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Must have a resume value&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10322" /><CodeLine lineNumber="10322"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/vpvalue">VPValue</a> &#42;StartVal = Plan.<a href="/docs/api/classes/llvm/vplan/#ac38d49d70b5f78779e83abdf4dcb4be0">getOrAddLiveIn</a>(ResumeV);</Highlight></CodeLine>
<Link id="l10323" /><CodeLine lineNumber="10323"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;VPHeaderPHIRecipe&gt;</a>(&amp;R)-&gt;setStartValue(StartVal);</Highlight></CodeLine>
<Link id="l10324" /><CodeLine lineNumber="10324"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10325" /><CodeLine lineNumber="10325"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l10326" /><CodeLine lineNumber="10326"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10327" /><CodeLine lineNumber="10327" lineLink="/docs/api/structs/llvm/loopvectorizepass/#a160afa01e95095aa0c8115b6e0e6f4a6"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/loopvectorizepass/#a160afa01e95095aa0c8115b6e0e6f4a6">LoopVectorizePass::processLoop</a>(<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L) &#123;</Highlight></CodeLine>
<Link id="l10328" /><CodeLine lineNumber="10328"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a> || L-&gt;isInnermost()) &amp;&amp;</Highlight></CodeLine>
<Link id="l10329" /><CodeLine lineNumber="10329"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;VPlan-native path is not enabled. Only process inner loops.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10330" /><CodeLine lineNumber="10330"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10331" /><CodeLine lineNumber="10331"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\nLV: Checking a loop in &#39;&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10332" /><CodeLine lineNumber="10332"><Highlight kind="normal">                    &lt;&lt; L-&gt;getHeader()-&gt;getParent()-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;&#39; from &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10333" /><CodeLine lineNumber="10333"><Highlight kind="normal">                    &lt;&lt; L-&gt;getLocStr() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10334" /><CodeLine lineNumber="10334"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10335" /><CodeLine lineNumber="10335"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizehints">LoopVectorizeHints</a> Hints(L, InterleaveOnlyWhenForced, &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>);</Highlight></CodeLine>
<Link id="l10336" /><CodeLine lineNumber="10336"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10337" /><CodeLine lineNumber="10337"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l10338" /><CodeLine lineNumber="10338"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Loop hints:&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10339" /><CodeLine lineNumber="10339"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; force=&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10340" /><CodeLine lineNumber="10340"><Highlight kind="normal">             &lt;&lt; (Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a20ecacbd54e401685d798d86161af6cf">getForce</a>() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea980c2c6e59ca5dcf413baa325d8bc385">LoopVectorizeHints::FK&#95;Disabled</a></Highlight></CodeLine>
<Link id="l10341" /><CodeLine lineNumber="10341"><Highlight kind="normal">                     ? </Highlight><Highlight kind="stringliteral">&quot;disabled&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10342" /><CodeLine lineNumber="10342"><Highlight kind="normal">                     : (Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a20ecacbd54e401685d798d86161af6cf">getForce</a>() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a></Highlight></CodeLine>
<Link id="l10343" /><CodeLine lineNumber="10343"><Highlight kind="normal">                            ? </Highlight><Highlight kind="stringliteral">&quot;enabled&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10344" /><CodeLine lineNumber="10344"><Highlight kind="normal">                            : </Highlight><Highlight kind="stringliteral">&quot;?&quot;</Highlight><Highlight kind="normal">))</Highlight></CodeLine>
<Link id="l10345" /><CodeLine lineNumber="10345"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; width=&quot;</Highlight><Highlight kind="normal"> &lt;&lt; Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a50cae5c2df432357d50f182d310ce7b7">getWidth</a>()</Highlight></CodeLine>
<Link id="l10346" /><CodeLine lineNumber="10346"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; interleave=&quot;</Highlight><Highlight kind="normal"> &lt;&lt; Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#ad98353127dbeb649d41ca07da5074b49">getInterleave</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10347" /><CodeLine lineNumber="10347"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10348" /><CodeLine lineNumber="10348"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Function containing loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10349" /><CodeLine lineNumber="10349"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = L-&gt;getHeader()-&gt;getParent();</Highlight></CodeLine>
<Link id="l10350" /><CodeLine lineNumber="10350"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10351" /><CodeLine lineNumber="10351"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Looking at the diagnostic output is the only way to determine if a loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10352" /><CodeLine lineNumber="10352"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// was vectorized (other than looking at the IR or machine code), so it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10353" /><CodeLine lineNumber="10353"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// is important to generate an optimization remark for each loop. Most of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10354" /><CodeLine lineNumber="10354"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// these messages are generated as OptimizationRemarkAnalysis. Remarks</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10355" /><CodeLine lineNumber="10355"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// generated as OptimizationRemark and OptimizationRemarkMissed are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10356" /><CodeLine lineNumber="10356"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// less verbose reporting vectorized loops and unvectorized loops that may</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10357" /><CodeLine lineNumber="10357"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// benefit from vectorization, respectively.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10358" /><CodeLine lineNumber="10358"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10359" /><CodeLine lineNumber="10359"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a21b6d9e2aa12c8c68d8e2f122ec7ecec">allowVectorization</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, L, VectorizeOnlyWhenForced)) &#123;</Highlight></CodeLine>
<Link id="l10360" /><CodeLine lineNumber="10360"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Loop hints prevent vectorization.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10361" /><CodeLine lineNumber="10361"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10362" /><CodeLine lineNumber="10362"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10363" /><CodeLine lineNumber="10363"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10364" /><CodeLine lineNumber="10364"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/predicatedscalarevolution">PredicatedScalarEvolution</a> PSE(&#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#a7e7c40b0a986979535eddeb2bb6eae05">SE</a>, &#42;L);</Highlight></CodeLine>
<Link id="l10365" /><CodeLine lineNumber="10365"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10366" /><CodeLine lineNumber="10366"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if it is legal to vectorize the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10367" /><CodeLine lineNumber="10367"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationrequirements">LoopVectorizationRequirements</a> Requirements;</Highlight></CodeLine>
<Link id="l10368" /><CodeLine lineNumber="10368"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationlegality">LoopVectorizationLegality</a> LVL(L, PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#a38ff83df2a3ad17de50157ed09a1c259">LAIs</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>,</Highlight></CodeLine>
<Link id="l10369" /><CodeLine lineNumber="10369"><Highlight kind="normal">                                &amp;Requirements, &amp;Hints, <a href="/docs/api/structs/llvm/loopvectorizepass/#a427352f0eda31223a0b25d9f143ce0b1">DB</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>);</Highlight></CodeLine>
<Link id="l10370" /><CodeLine lineNumber="10370"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#a3ce10d1174bdfcac2b73ed7efa352b7f">canVectorize</a>(<a href="/docs/api/namespaces/llvm/#a6ef0a19ea2267182eb0da4f6e191b59b">EnableVPlanNativePath</a>)) &#123;</Highlight></CodeLine>
<Link id="l10371" /><CodeLine lineNumber="10371"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Not vectorizing: Cannot prove legality.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10372" /><CodeLine lineNumber="10372"><Highlight kind="normal">    Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a440979b6103588bef39bd2d62065d5ff">emitRemarkWithHints</a>();</Highlight></CodeLine>
<Link id="l10373" /><CodeLine lineNumber="10373"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10374" /><CodeLine lineNumber="10374"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10375" /><CodeLine lineNumber="10375"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10376" /><CodeLine lineNumber="10376"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab22ff9e23f7f27234c8f6ec76db0c1f3">hasUncountableEarlyExit</a>() &amp;&amp; !<a href="#af7af1b4bf03205c80dcba0a6324c4f21">EnableEarlyExitVectorization</a>) &#123;</Highlight></CodeLine>
<Link id="l10377" /><CodeLine lineNumber="10377"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight><Highlight kind="stringliteral">&quot;Auto-vectorization of loops with uncountable &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10378" /><CodeLine lineNumber="10378"><Highlight kind="normal">                               </Highlight><Highlight kind="stringliteral">&quot;early exit is not enabled&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10379" /><CodeLine lineNumber="10379"><Highlight kind="normal">                               </Highlight><Highlight kind="stringliteral">&quot;UncountableEarlyExitLoopsDisabled&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, L);</Highlight></CodeLine>
<Link id="l10380" /><CodeLine lineNumber="10380"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10381" /><CodeLine lineNumber="10381"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10382" /><CodeLine lineNumber="10382"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10383" /><CodeLine lineNumber="10383"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#a9ede4d70a86b91ae038a77c86b3f4aaa">hasStructVectorCall</a>()) &#123;</Highlight></CodeLine>
<Link id="l10384" /><CodeLine lineNumber="10384"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight><Highlight kind="stringliteral">&quot;Auto-vectorization of calls that return struct &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10385" /><CodeLine lineNumber="10385"><Highlight kind="normal">                               </Highlight><Highlight kind="stringliteral">&quot;types is not yet supported&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10386" /><CodeLine lineNumber="10386"><Highlight kind="normal">                               </Highlight><Highlight kind="stringliteral">&quot;StructCallVectorizationUnsupported&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, L);</Highlight></CodeLine>
<Link id="l10387" /><CodeLine lineNumber="10387"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10388" /><CodeLine lineNumber="10388"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10389" /><CodeLine lineNumber="10389"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10390" /><CodeLine lineNumber="10390"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Entrance to the VPlan-native vectorization path. Outer loops are processed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10391" /><CodeLine lineNumber="10391"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// here. They may require CFG and instruction level transformations before</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10392" /><CodeLine lineNumber="10392"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// even evaluating whether vectorization is profitable. Since we cannot modify</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10393" /><CodeLine lineNumber="10393"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the incoming IR, we need to build VPlan upfront in the vectorization</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10394" /><CodeLine lineNumber="10394"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// pipeline.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10395" /><CodeLine lineNumber="10395"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!L-&gt;isInnermost())</Highlight></CodeLine>
<Link id="l10396" /><CodeLine lineNumber="10396"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="#adeb41c907ebde15846bc643325909f95">processLoopInVPlanNativePath</a>(L, PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, &amp;LVL, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a427352f0eda31223a0b25d9f143ce0b1">DB</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>,</Highlight></CodeLine>
<Link id="l10397" /><CodeLine lineNumber="10397"><Highlight kind="normal">                                        <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>, Hints, Requirements);</Highlight></CodeLine>
<Link id="l10398" /><CodeLine lineNumber="10398"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10399" /><CodeLine lineNumber="10399"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(L-&gt;isInnermost() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Inner loop expected.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10400" /><CodeLine lineNumber="10400"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10401" /><CodeLine lineNumber="10401"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/interleavedaccessinfo">InterleavedAccessInfo</a> IAI(PSE, L, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab5632546144c4db5bbe1f975aeebd9d2">getLAI</a>());</Highlight></CodeLine>
<Link id="l10402" /><CodeLine lineNumber="10402"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> UseInterleaved = <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>-&gt;enableInterleavedAccessVectorization();</Highlight></CodeLine>
<Link id="l10403" /><CodeLine lineNumber="10403"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10404" /><CodeLine lineNumber="10404"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If an override option has been passed in for interleaved accesses, use it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10405" /><CodeLine lineNumber="10405"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#ac3af17aa5bce5ef8c3aa82faeacfc456">EnableInterleavedMemAccesses</a>.getNumOccurrences() &gt; 0)</Highlight></CodeLine>
<Link id="l10406" /><CodeLine lineNumber="10406"><Highlight kind="normal">    UseInterleaved = <a href="#ac3af17aa5bce5ef8c3aa82faeacfc456">EnableInterleavedMemAccesses</a>;</Highlight></CodeLine>
<Link id="l10407" /><CodeLine lineNumber="10407"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10408" /><CodeLine lineNumber="10408"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Analyze interleaved memory accesses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10409" /><CodeLine lineNumber="10409"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UseInterleaved)</Highlight></CodeLine>
<Link id="l10410" /><CodeLine lineNumber="10410"><Highlight kind="normal">    IAI.<a href="/docs/api/classes/llvm/interleavedaccessinfo/#af587d7218fa15a456103c3d2125a1fc8">analyzeInterleaving</a>(<a href="#adf8d8fb6f39b9c0cf21d55b7229d35e2">useMaskedInterleavedAccesses</a>(&#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>));</Highlight></CodeLine>
<Link id="l10411" /><CodeLine lineNumber="10411"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10412" /><CodeLine lineNumber="10412"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab22ff9e23f7f27234c8f6ec76db0c1f3">hasUncountableEarlyExit</a>()) &#123;</Highlight></CodeLine>
<Link id="l10413" /><CodeLine lineNumber="10413"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;LoopLatch = L-&gt;getLoopLatch();</Highlight></CodeLine>
<Link id="l10414" /><CodeLine lineNumber="10414"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IAI.<a href="/docs/api/classes/llvm/interleavedaccessinfo/#a34ed64ff27fabc002da4047589142b02">requiresScalarEpilogue</a>() ||</Highlight></CodeLine>
<Link id="l10415" /><CodeLine lineNumber="10415"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#a7a32abdcf9e80b2483aa55bc36f2840e">getCountableExitingBlocks</a>(),</Highlight></CodeLine>
<Link id="l10416" /><CodeLine lineNumber="10416"><Highlight kind="normal">               &#91;LoopLatch&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123; return BB != LoopLatch; &#125;)) &#123;</Highlight></CodeLine>
<Link id="l10417" /><CodeLine lineNumber="10417"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight><Highlight kind="stringliteral">&quot;Auto-vectorization of early exit loops &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10418" /><CodeLine lineNumber="10418"><Highlight kind="normal">                                 </Highlight><Highlight kind="stringliteral">&quot;requiring a scalar epilogue is unsupported&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10419" /><CodeLine lineNumber="10419"><Highlight kind="normal">                                 </Highlight><Highlight kind="stringliteral">&quot;UncountableEarlyExitUnsupported&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, L);</Highlight></CodeLine>
<Link id="l10420" /><CodeLine lineNumber="10420"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10421" /><CodeLine lineNumber="10421"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l10422" /><CodeLine lineNumber="10422"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10423" /><CodeLine lineNumber="10423"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10424" /><CodeLine lineNumber="10424"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check the function attributes and profiles to find out if this function</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10425" /><CodeLine lineNumber="10425"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// should be optimized for size.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10426" /><CodeLine lineNumber="10426"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9d">ScalarEpilogueLowering</a> </Highlight><Highlight kind="keywordtype">SEL</Highlight><Highlight kind="normal"> =</Highlight></CodeLine>
<Link id="l10427" /><CodeLine lineNumber="10427"><Highlight kind="normal">      <a href="#a8cde912cc23c18f493e4e5005c85748b">getScalarEpilogueLowering</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, L, Hints, <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, LVL, &amp;IAI);</Highlight></CodeLine>
<Link id="l10428" /><CodeLine lineNumber="10428"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10429" /><CodeLine lineNumber="10429"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check the loop for a trip count threshold: vectorize loops with a tiny trip</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10430" /><CodeLine lineNumber="10430"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// count by optimizing for size, to minimize overheads.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10431" /><CodeLine lineNumber="10431"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ExpectedTC = <a href="#a84375e6536d9214c7895013078055aff">getSmallBestKnownTC</a>(PSE, L);</Highlight></CodeLine>
<Link id="l10432" /><CodeLine lineNumber="10432"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExpectedTC &amp;&amp; &#42;ExpectedTC &lt; <a href="#a15320a2d7ced6e62766048ae7b6f8b13">TinyTripCountVectorThreshold</a>) &#123;</Highlight></CodeLine>
<Link id="l10433" /><CodeLine lineNumber="10433"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found a loop with a very small trip count. &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10434" /><CodeLine lineNumber="10434"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;This loop is worth vectorizing only if no scalar &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10435" /><CodeLine lineNumber="10435"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;iteration overheads are incurred.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10436" /><CodeLine lineNumber="10436"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a20ecacbd54e401685d798d86161af6cf">getForce</a>() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a>)</Highlight></CodeLine>
<Link id="l10437" /><CodeLine lineNumber="10437"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; But vectorizing was explicitly forced.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10438" /><CodeLine lineNumber="10438"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l10439" /><CodeLine lineNumber="10439"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (&#42;ExpectedTC &gt; <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>-&gt;getMinTripCountTailFoldingThreshold()) &#123;</Highlight></CodeLine>
<Link id="l10440" /><CodeLine lineNumber="10440"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10441" /><CodeLine lineNumber="10441"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Predicate tail-folded loops are efficient even when the loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10442" /><CodeLine lineNumber="10442"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// iteration count is low. However, setting the epilogue policy to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10443" /><CodeLine lineNumber="10443"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// &#96;CM&#95;ScalarEpilogueNotAllowedLowTripLoop&#96; prevents vectorizing loops</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10444" /><CodeLine lineNumber="10444"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// with runtime checks. It&#39;s more effective to let</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10445" /><CodeLine lineNumber="10445"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// &#96;areRuntimeChecksProfitable&#96; determine if vectorization is beneficial</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10446" /><CodeLine lineNumber="10446"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// for the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10447" /><CodeLine lineNumber="10447"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">SEL</Highlight><Highlight kind="normal"> != <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da34c20b2dbd2edddfd1b013f073a32354">CM&#95;ScalarEpilogueNotNeededUsePredicate</a>)</Highlight></CodeLine>
<Link id="l10448" /><CodeLine lineNumber="10448"><Highlight kind="normal">          </Highlight><Highlight kind="keywordtype">SEL</Highlight><Highlight kind="normal"> = <a href="/docs/api/namespaces/llvm/#ab5d4f35a197e7b0f2320bdbbf518bd9da0a5c3a3ea2de39aa77f3e6da8de4d5bd">CM&#95;ScalarEpilogueNotAllowedLowTripLoop</a>;</Highlight></CodeLine>
<Link id="l10449" /><CodeLine lineNumber="10449"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l10450" /><CodeLine lineNumber="10450"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; But the target considers the trip count too &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10451" /><CodeLine lineNumber="10451"><Highlight kind="normal">                             </Highlight><Highlight kind="stringliteral">&quot;small to consider vectorizing.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10452" /><CodeLine lineNumber="10452"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight></CodeLine>
<Link id="l10453" /><CodeLine lineNumber="10453"><Highlight kind="normal">            </Highlight><Highlight kind="stringliteral">&quot;The trip count is below the minial threshold value.&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10454" /><CodeLine lineNumber="10454"><Highlight kind="normal">            </Highlight><Highlight kind="stringliteral">&quot;loop trip count is too low, avoiding vectorization&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10455" /><CodeLine lineNumber="10455"><Highlight kind="normal">            </Highlight><Highlight kind="stringliteral">&quot;LowTripCount&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, L);</Highlight></CodeLine>
<Link id="l10456" /><CodeLine lineNumber="10456"><Highlight kind="normal">        Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a440979b6103588bef39bd2d62065d5ff">emitRemarkWithHints</a>();</Highlight></CodeLine>
<Link id="l10457" /><CodeLine lineNumber="10457"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10458" /><CodeLine lineNumber="10458"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l10459" /><CodeLine lineNumber="10459"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l10460" /><CodeLine lineNumber="10460"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10461" /><CodeLine lineNumber="10461"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10462" /><CodeLine lineNumber="10462"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check the function attributes to see if implicit floats or vectors are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10463" /><CodeLine lineNumber="10463"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// allowed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10464" /><CodeLine lineNumber="10464"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;hasFnAttribute(Attribute::NoImplicitFloat)) &#123;</Highlight></CodeLine>
<Link id="l10465" /><CodeLine lineNumber="10465"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight></CodeLine>
<Link id="l10466" /><CodeLine lineNumber="10466"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Can&#39;t vectorize when the NoImplicitFloat attribute is used&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10467" /><CodeLine lineNumber="10467"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;loop not vectorized due to NoImplicitFloat attribute&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10468" /><CodeLine lineNumber="10468"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;NoImplicitFloat&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, L);</Highlight></CodeLine>
<Link id="l10469" /><CodeLine lineNumber="10469"><Highlight kind="normal">    Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a440979b6103588bef39bd2d62065d5ff">emitRemarkWithHints</a>();</Highlight></CodeLine>
<Link id="l10470" /><CodeLine lineNumber="10470"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10471" /><CodeLine lineNumber="10471"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10472" /><CodeLine lineNumber="10472"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10473" /><CodeLine lineNumber="10473"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check if the target supports potentially unsafe FP vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10474" /><CodeLine lineNumber="10474"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: Add a check for the type of safety issue (denormal, signaling)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10475" /><CodeLine lineNumber="10475"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// for the target we&#39;re vectorizing for, to make sure none of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10476" /><CodeLine lineNumber="10476"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// additional fp-math flags can help.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10477" /><CodeLine lineNumber="10477"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a475b1d2223ddab6c0ab44dfcea7dcba7">isPotentiallyUnsafe</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l10478" /><CodeLine lineNumber="10478"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>-&gt;isFPVectorizationPotentiallyUnsafe()) &#123;</Highlight></CodeLine>
<Link id="l10479" /><CodeLine lineNumber="10479"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#ab425bb10a0f4af749bbb29aa07fc6854">reportVectorizationFailure</a>(</Highlight></CodeLine>
<Link id="l10480" /><CodeLine lineNumber="10480"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Potentially unsafe FP op prevents vectorization&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10481" /><CodeLine lineNumber="10481"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;loop not vectorized due to unsafe FP support.&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10482" /><CodeLine lineNumber="10482"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;UnsafeFP&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, L);</Highlight></CodeLine>
<Link id="l10483" /><CodeLine lineNumber="10483"><Highlight kind="normal">    Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a440979b6103588bef39bd2d62065d5ff">emitRemarkWithHints</a>();</Highlight></CodeLine>
<Link id="l10484" /><CodeLine lineNumber="10484"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10485" /><CodeLine lineNumber="10485"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10486" /><CodeLine lineNumber="10486"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10487" /><CodeLine lineNumber="10487"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllowOrderedReductions;</Highlight></CodeLine>
<Link id="l10488" /><CodeLine lineNumber="10488"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If the flag is set, use that instead and override the TTI behaviour.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10489" /><CodeLine lineNumber="10489"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#acb0b374f69dc6867357f0aa5e93ab33d">ForceOrderedReductions</a>.getNumOccurrences() &gt; 0)</Highlight></CodeLine>
<Link id="l10490" /><CodeLine lineNumber="10490"><Highlight kind="normal">    AllowOrderedReductions = <a href="#acb0b374f69dc6867357f0aa5e93ab33d">ForceOrderedReductions</a>;</Highlight></CodeLine>
<Link id="l10491" /><CodeLine lineNumber="10491"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10492" /><CodeLine lineNumber="10492"><Highlight kind="normal">    AllowOrderedReductions = <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>-&gt;enableOrderedReductions();</Highlight></CodeLine>
<Link id="l10493" /><CodeLine lineNumber="10493"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#a552a158f5a673da0a26461d1471cea41">canVectorizeFPMath</a>(AllowOrderedReductions)) &#123;</Highlight></CodeLine>
<Link id="l10494" /><CodeLine lineNumber="10494"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l10495" /><CodeLine lineNumber="10495"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;ExactFPMathInst = Requirements.<a href="/docs/api/classes/llvm/loopvectorizationrequirements/#a2bb8d6e55fae2cbc8eead3d7d4d3af09">getExactFPInst</a>();</Highlight></CodeLine>
<Link id="l10496" /><CodeLine lineNumber="10496"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/optimizationremarkanalysisfpcommute">OptimizationRemarkAnalysisFPCommute</a>(<a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </Highlight><Highlight kind="stringliteral">&quot;CantReorderFPOps&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10497" /><CodeLine lineNumber="10497"><Highlight kind="normal">                                                 ExactFPMathInst-&gt;getDebugLoc(),</Highlight></CodeLine>
<Link id="l10498" /><CodeLine lineNumber="10498"><Highlight kind="normal">                                                 ExactFPMathInst-&gt;getParent())</Highlight></CodeLine>
<Link id="l10499" /><CodeLine lineNumber="10499"><Highlight kind="normal">             &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;loop not vectorized: cannot prove it is safe to reorder &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10500" /><CodeLine lineNumber="10500"><Highlight kind="normal">                </Highlight><Highlight kind="stringliteral">&quot;floating-point operations&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10501" /><CodeLine lineNumber="10501"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l10502" /><CodeLine lineNumber="10502"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: loop not vectorized: cannot prove it is safe to &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10503" /><CodeLine lineNumber="10503"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;reorder floating-point operations\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10504" /><CodeLine lineNumber="10504"><Highlight kind="normal">    Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a440979b6103588bef39bd2d62065d5ff">emitRemarkWithHints</a>();</Highlight></CodeLine>
<Link id="l10505" /><CodeLine lineNumber="10505"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10506" /><CodeLine lineNumber="10506"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10507" /><CodeLine lineNumber="10507"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10508" /><CodeLine lineNumber="10508"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Use the cost model.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10509" /><CodeLine lineNumber="10509"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationcostmodel">LoopVectorizationCostModel</a> CM(</Highlight><Highlight kind="keywordtype">SEL</Highlight><Highlight kind="normal">, L, PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, &amp;LVL, &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a427352f0eda31223a0b25d9f143ce0b1">DB</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>,</Highlight></CodeLine>
<Link id="l10510" /><CodeLine lineNumber="10510"><Highlight kind="normal">                                <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>, &amp;Hints, IAI);</Highlight></CodeLine>
<Link id="l10511" /><CodeLine lineNumber="10511"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Use the planner for vectorization.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10512" /><CodeLine lineNumber="10512"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/loopvectorizationplanner">LoopVectorizationPlanner</a> LVP(L, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, &amp;LVL, CM, IAI, PSE, Hints,</Highlight></CodeLine>
<Link id="l10513" /><CodeLine lineNumber="10513"><Highlight kind="normal">                               <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>);</Highlight></CodeLine>
<Link id="l10514" /><CodeLine lineNumber="10514"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10515" /><CodeLine lineNumber="10515"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Get user vectorization factor and interleave count.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10516" /><CodeLine lineNumber="10516"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/elementcount">ElementCount</a> UserVF = Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a50cae5c2df432357d50f182d310ce7b7">getWidth</a>();</Highlight></CodeLine>
<Link id="l10517" /><CodeLine lineNumber="10517"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> UserIC = Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#ad98353127dbeb649d41ca07da5074b49">getInterleave</a>();</Highlight></CodeLine>
<Link id="l10518" /><CodeLine lineNumber="10518"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10519" /><CodeLine lineNumber="10519"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Plan how to best vectorize.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10520" /><CodeLine lineNumber="10520"><Highlight kind="normal">  LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#aca6160bb3d669e9ce01f91b124e7e0a1">plan</a>(UserVF, UserIC);</Highlight></CodeLine>
<Link id="l10521" /><CodeLine lineNumber="10521"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> VF = LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a4adc69fc8f74164e990cce6afc1e061b">computeBestVF</a>();</Highlight></CodeLine>
<Link id="l10522" /><CodeLine lineNumber="10522"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> IC = 1;</Highlight></CodeLine>
<Link id="l10523" /><CodeLine lineNumber="10523"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10524" /><CodeLine lineNumber="10524"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;allowExtraAnalysis(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>))</Highlight></CodeLine>
<Link id="l10525" /><CodeLine lineNumber="10525"><Highlight kind="normal">    LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#aa216c2cbc8d9610dc20db065aca671d3">emitInvalidCostRemarks</a>(<a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>);</Highlight></CodeLine>
<Link id="l10526" /><CodeLine lineNumber="10526"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10527" /><CodeLine lineNumber="10527"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AddBranchWeights =</Highlight></CodeLine>
<Link id="l10528" /><CodeLine lineNumber="10528"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#add2fce2ce0e32b20e41b0aa9f8ca70c2">hasBranchWeightMD</a>(&#42;L-&gt;getLoopLatch()-&gt;getTerminator());</Highlight></CodeLine>
<Link id="l10529" /><CodeLine lineNumber="10529"><Highlight kind="normal">  GeneratedRTChecks Checks(PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getDataLayout(),</Highlight></CodeLine>
<Link id="l10530" /><CodeLine lineNumber="10530"><Highlight kind="normal">                           AddBranchWeights, CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#a686506cbb75808c52247608065bc6596">CostKind</a>);</Highlight></CodeLine>
<Link id="l10531" /><CodeLine lineNumber="10531"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#adce80172b05bc0a227fbd5e3d7bb80f2">hasPlanWithVF</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>)) &#123;</Highlight></CodeLine>
<Link id="l10532" /><CodeLine lineNumber="10532"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Select the interleave count.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10533" /><CodeLine lineNumber="10533"><Highlight kind="normal">    IC = CM.<a href="/docs/api/classes/llvm/loopvectorizationcostmodel/#af9f62350ccdebd24858be552f3fc051c">selectInterleaveCount</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a048d568675a5cc69c3fb85206882316d">Cost</a>);</Highlight></CodeLine>
<Link id="l10534" /><CodeLine lineNumber="10534"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10535" /><CodeLine lineNumber="10535"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> SelectedIC = std::max(IC, UserIC);</Highlight></CodeLine>
<Link id="l10536" /><CodeLine lineNumber="10536"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  Optimistically generate runtime checks if they are needed. Drop them if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10537" /><CodeLine lineNumber="10537"><Highlight kind="normal">    </Highlight><Highlight kind="comment">//  they turn out to not be profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10538" /><CodeLine lineNumber="10538"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>() || SelectedIC &gt; 1)</Highlight></CodeLine>
<Link id="l10539" /><CodeLine lineNumber="10539"><Highlight kind="normal">      Checks.create(L, &#42;LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab5632546144c4db5bbe1f975aeebd9d2">getLAI</a>(), PSE.<a href="/docs/api/classes/llvm/predicatedscalarevolution/#a12a8ac8838fb851a2de5dc5275307bb6">getPredicate</a>(), VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, SelectedIC);</Highlight></CodeLine>
<Link id="l10540" /><CodeLine lineNumber="10540"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10541" /><CodeLine lineNumber="10541"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Check if it is profitable to vectorize with runtime checks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10542" /><CodeLine lineNumber="10542"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ForceVectorization =</Highlight></CodeLine>
<Link id="l10543" /><CodeLine lineNumber="10543"><Highlight kind="normal">        Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a20ecacbd54e401685d798d86161af6cf">getForce</a>() == <a href="/docs/api/classes/llvm/loopvectorizehints/#a55ab1072c44295ad279535d714a0f33ea278ca681847fb2bad9707f76d899b231">LoopVectorizeHints::FK&#95;Enabled</a>;</Highlight></CodeLine>
<Link id="l10544" /><CodeLine lineNumber="10544"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!ForceVectorization &amp;&amp;</Highlight></CodeLine>
<Link id="l10545" /><CodeLine lineNumber="10545"><Highlight kind="normal">        !<a href="#a362f793f3254317c698e3560548788a5">areRuntimeChecksProfitable</a>(Checks, VF, L, &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, PSE, </Highlight><Highlight kind="keywordtype">SEL</Highlight><Highlight kind="normal">)) &#123;</Highlight></CodeLine>
<Link id="l10546" /><CodeLine lineNumber="10546"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l10547" /><CodeLine lineNumber="10547"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/optimizationremarkanalysisaliasing">OptimizationRemarkAnalysisAliasing</a>(</Highlight></CodeLine>
<Link id="l10548" /><CodeLine lineNumber="10548"><Highlight kind="normal">                   <a href="/docs/api/files/include/include/llvm/include/llvm/adt/genericcycleimpl-h/#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>, </Highlight><Highlight kind="stringliteral">&quot;CantReorderMemOps&quot;</Highlight><Highlight kind="normal">, L-&gt;getStartLoc(),</Highlight></CodeLine>
<Link id="l10549" /><CodeLine lineNumber="10549"><Highlight kind="normal">                   L-&gt;getHeader())</Highlight></CodeLine>
<Link id="l10550" /><CodeLine lineNumber="10550"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;loop not vectorized: cannot prove it is safe to reorder &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10551" /><CodeLine lineNumber="10551"><Highlight kind="normal">                  </Highlight><Highlight kind="stringliteral">&quot;memory operations&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10552" /><CodeLine lineNumber="10552"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l10553" /><CodeLine lineNumber="10553"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Too many memory checks needed.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10554" /><CodeLine lineNumber="10554"><Highlight kind="normal">      Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#a440979b6103588bef39bd2d62065d5ff">emitRemarkWithHints</a>();</Highlight></CodeLine>
<Link id="l10555" /><CodeLine lineNumber="10555"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10556" /><CodeLine lineNumber="10556"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l10557" /><CodeLine lineNumber="10557"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10558" /><CodeLine lineNumber="10558"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10559" /><CodeLine lineNumber="10559"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Identify the diagnostic messages that should be produced.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10560" /><CodeLine lineNumber="10560"><Highlight kind="normal">  std::pair&lt;StringRef, std::string&gt; VecDiagMsg, IntDiagMsg;</Highlight></CodeLine>
<Link id="l10561" /><CodeLine lineNumber="10561"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> VectorizeLoop = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, InterleaveLoop = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10562" /><CodeLine lineNumber="10562"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>.<a href="/docs/api/classes/llvm/elementcount/#a991f269cde2e7fbcb254ef371efc8d1a">isScalar</a>()) &#123;</Highlight></CodeLine>
<Link id="l10563" /><CodeLine lineNumber="10563"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Vectorization is possible but not beneficial.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10564" /><CodeLine lineNumber="10564"><Highlight kind="normal">    VecDiagMsg = std::make&#95;pair(</Highlight></CodeLine>
<Link id="l10565" /><CodeLine lineNumber="10565"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;VectorizationNotBeneficial&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10566" /><CodeLine lineNumber="10566"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;the cost-model indicates that vectorization is not beneficial&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10567" /><CodeLine lineNumber="10567"><Highlight kind="normal">    VectorizeLoop = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10568" /><CodeLine lineNumber="10568"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10569" /><CodeLine lineNumber="10569"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10570" /><CodeLine lineNumber="10570"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#adce80172b05bc0a227fbd5e3d7bb80f2">hasPlanWithVF</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>) &amp;&amp; UserIC &gt; 1) &#123;</Highlight></CodeLine>
<Link id="l10571" /><CodeLine lineNumber="10571"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Tell the user interleaving was avoided up-front, despite being explicitly</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10572" /><CodeLine lineNumber="10572"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// requested.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10573" /><CodeLine lineNumber="10573"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Ignoring UserIC, because vectorization and &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10574" /><CodeLine lineNumber="10574"><Highlight kind="normal">                         </Highlight><Highlight kind="stringliteral">&quot;interleaving should be avoided up front\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10575" /><CodeLine lineNumber="10575"><Highlight kind="normal">    IntDiagMsg = std::make&#95;pair(</Highlight></CodeLine>
<Link id="l10576" /><CodeLine lineNumber="10576"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;InterleavingAvoided&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10577" /><CodeLine lineNumber="10577"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Ignoring UserIC, because interleaving was avoided up front&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10578" /><CodeLine lineNumber="10578"><Highlight kind="normal">    InterleaveLoop = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10579" /><CodeLine lineNumber="10579"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IC == 1 &amp;&amp; UserIC &lt;= 1) &#123;</Highlight></CodeLine>
<Link id="l10580" /><CodeLine lineNumber="10580"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Tell the user interleaving is not beneficial.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10581" /><CodeLine lineNumber="10581"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Interleaving is not beneficial.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10582" /><CodeLine lineNumber="10582"><Highlight kind="normal">    IntDiagMsg = std::make&#95;pair(</Highlight></CodeLine>
<Link id="l10583" /><CodeLine lineNumber="10583"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;InterleavingNotBeneficial&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10584" /><CodeLine lineNumber="10584"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;the cost-model indicates that interleaving is not beneficial&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10585" /><CodeLine lineNumber="10585"><Highlight kind="normal">    InterleaveLoop = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10586" /><CodeLine lineNumber="10586"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (UserIC == 1) &#123;</Highlight></CodeLine>
<Link id="l10587" /><CodeLine lineNumber="10587"><Highlight kind="normal">      IntDiagMsg.first = </Highlight><Highlight kind="stringliteral">&quot;InterleavingNotBeneficialAndDisabled&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10588" /><CodeLine lineNumber="10588"><Highlight kind="normal">      IntDiagMsg.second +=</Highlight></CodeLine>
<Link id="l10589" /><CodeLine lineNumber="10589"><Highlight kind="normal">          </Highlight><Highlight kind="stringliteral">&quot; and is explicitly disabled or interleave count is set to 1&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10590" /><CodeLine lineNumber="10590"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l10591" /><CodeLine lineNumber="10591"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IC &gt; 1 &amp;&amp; UserIC == 1) &#123;</Highlight></CodeLine>
<Link id="l10592" /><CodeLine lineNumber="10592"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Tell the user interleaving is beneficial, but it explicitly disabled.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10593" /><CodeLine lineNumber="10593"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight></CodeLine>
<Link id="l10594" /><CodeLine lineNumber="10594"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Interleaving is beneficial but is explicitly disabled.&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10595" /><CodeLine lineNumber="10595"><Highlight kind="normal">    IntDiagMsg = std::make&#95;pair(</Highlight></CodeLine>
<Link id="l10596" /><CodeLine lineNumber="10596"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;InterleavingBeneficialButDisabled&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10597" /><CodeLine lineNumber="10597"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;the cost-model indicates that interleaving is beneficial &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10598" /><CodeLine lineNumber="10598"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;but is explicitly disabled or interleave count is set to 1&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10599" /><CodeLine lineNumber="10599"><Highlight kind="normal">    InterleaveLoop = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10600" /><CodeLine lineNumber="10600"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10601" /><CodeLine lineNumber="10601"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10602" /><CodeLine lineNumber="10602"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there is a histogram in the loop, do not just interleave without</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10603" /><CodeLine lineNumber="10603"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vectorizing. The order of operations will be incorrect without the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10604" /><CodeLine lineNumber="10604"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// histogram intrinsics, which are only used for recipes with VF &gt; 1</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10605" /><CodeLine lineNumber="10605"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VectorizeLoop &amp;&amp; InterleaveLoop &amp;&amp; LVL.<a href="/docs/api/classes/llvm/loopvectorizationlegality/#ab306c8094bdb8c7cbdbdfb9a05800007">hasHistograms</a>()) &#123;</Highlight></CodeLine>
<Link id="l10606" /><CodeLine lineNumber="10606"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Not interleaving without vectorization due &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10607" /><CodeLine lineNumber="10607"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;to histogram operations.\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10608" /><CodeLine lineNumber="10608"><Highlight kind="normal">    IntDiagMsg = std::make&#95;pair(</Highlight></CodeLine>
<Link id="l10609" /><CodeLine lineNumber="10609"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;HistogramPreventsScalarInterleaving&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l10610" /><CodeLine lineNumber="10610"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;Unable to interleave without vectorization due to constraints on &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10611" /><CodeLine lineNumber="10611"><Highlight kind="normal">        </Highlight><Highlight kind="stringliteral">&quot;the order of histogram operations&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10612" /><CodeLine lineNumber="10612"><Highlight kind="normal">    InterleaveLoop = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10613" /><CodeLine lineNumber="10613"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10614" /><CodeLine lineNumber="10614"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10615" /><CodeLine lineNumber="10615"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Override IC if user provided an interleave count.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10616" /><CodeLine lineNumber="10616"><Highlight kind="normal">  IC = UserIC &gt; 0 ? UserIC : IC;</Highlight></CodeLine>
<Link id="l10617" /><CodeLine lineNumber="10617"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10618" /><CodeLine lineNumber="10618"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Emit diagnostic messages, if any.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10619" /><CodeLine lineNumber="10619"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">char</Highlight><Highlight kind="normal"> &#42;VAPassName = Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#abcf8c2b35316773f1ab0ba70aeb2a6de">vectorizeAnalysisPassName</a>();</Highlight></CodeLine>
<Link id="l10620" /><CodeLine lineNumber="10620"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VectorizeLoop &amp;&amp; !InterleaveLoop) &#123;</Highlight></CodeLine>
<Link id="l10621" /><CodeLine lineNumber="10621"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Do not vectorize or interleaving the loop.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10622" /><CodeLine lineNumber="10622"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l10623" /><CodeLine lineNumber="10623"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/optimizationremarkmissed">OptimizationRemarkMissed</a>(VAPassName, VecDiagMsg.first,</Highlight></CodeLine>
<Link id="l10624" /><CodeLine lineNumber="10624"><Highlight kind="normal">                                      L-&gt;getStartLoc(), L-&gt;getHeader())</Highlight></CodeLine>
<Link id="l10625" /><CodeLine lineNumber="10625"><Highlight kind="normal">             &lt;&lt; VecDiagMsg.second;</Highlight></CodeLine>
<Link id="l10626" /><CodeLine lineNumber="10626"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l10627" /><CodeLine lineNumber="10627"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l10628" /><CodeLine lineNumber="10628"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/optimizationremarkmissed">OptimizationRemarkMissed</a>(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>, IntDiagMsg.first,</Highlight></CodeLine>
<Link id="l10629" /><CodeLine lineNumber="10629"><Highlight kind="normal">                                      L-&gt;getStartLoc(), L-&gt;getHeader())</Highlight></CodeLine>
<Link id="l10630" /><CodeLine lineNumber="10630"><Highlight kind="normal">             &lt;&lt; IntDiagMsg.second;</Highlight></CodeLine>
<Link id="l10631" /><CodeLine lineNumber="10631"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l10632" /><CodeLine lineNumber="10632"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10633" /><CodeLine lineNumber="10633"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10634" /><CodeLine lineNumber="10634"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10635" /><CodeLine lineNumber="10635"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VectorizeLoop &amp;&amp; InterleaveLoop) &#123;</Highlight></CodeLine>
<Link id="l10636" /><CodeLine lineNumber="10636"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Interleave Count is &quot;</Highlight><Highlight kind="normal"> &lt;&lt; IC &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10637" /><CodeLine lineNumber="10637"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l10638" /><CodeLine lineNumber="10638"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a>(VAPassName, VecDiagMsg.first,</Highlight></CodeLine>
<Link id="l10639" /><CodeLine lineNumber="10639"><Highlight kind="normal">                                        L-&gt;getStartLoc(), L-&gt;getHeader())</Highlight></CodeLine>
<Link id="l10640" /><CodeLine lineNumber="10640"><Highlight kind="normal">             &lt;&lt; VecDiagMsg.second;</Highlight></CodeLine>
<Link id="l10641" /><CodeLine lineNumber="10641"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l10642" /><CodeLine lineNumber="10642"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VectorizeLoop &amp;&amp; !InterleaveLoop) &#123;</Highlight></CodeLine>
<Link id="l10643" /><CodeLine lineNumber="10643"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found a vectorizable loop (&quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a></Highlight></CodeLine>
<Link id="l10644" /><CodeLine lineNumber="10644"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;) in &quot;</Highlight><Highlight kind="normal"> &lt;&lt; L-&gt;getLocStr() &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10645" /><CodeLine lineNumber="10645"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l10646" /><CodeLine lineNumber="10646"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/optimizationremarkanalysis">OptimizationRemarkAnalysis</a>(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>, IntDiagMsg.first,</Highlight></CodeLine>
<Link id="l10647" /><CodeLine lineNumber="10647"><Highlight kind="normal">                                        L-&gt;getStartLoc(), L-&gt;getHeader())</Highlight></CodeLine>
<Link id="l10648" /><CodeLine lineNumber="10648"><Highlight kind="normal">             &lt;&lt; IntDiagMsg.second;</Highlight></CodeLine>
<Link id="l10649" /><CodeLine lineNumber="10649"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l10650" /><CodeLine lineNumber="10650"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (VectorizeLoop &amp;&amp; InterleaveLoop) &#123;</Highlight></CodeLine>
<Link id="l10651" /><CodeLine lineNumber="10651"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Found a vectorizable loop (&quot;</Highlight><Highlight kind="normal"> &lt;&lt; VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a></Highlight></CodeLine>
<Link id="l10652" /><CodeLine lineNumber="10652"><Highlight kind="normal">                      &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;) in &quot;</Highlight><Highlight kind="normal"> &lt;&lt; L-&gt;getLocStr() &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10653" /><CodeLine lineNumber="10653"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;LV: Interleave Count is &quot;</Highlight><Highlight kind="normal"> &lt;&lt; IC &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10654" /><CodeLine lineNumber="10654"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10655" /><CodeLine lineNumber="10655"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10656" /><CodeLine lineNumber="10656"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> DisableRuntimeUnroll = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10657" /><CodeLine lineNumber="10657"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/mdnode">MDNode</a> &#42;OrigLoopID = L-&gt;getLoopID();</Highlight></CodeLine>
<Link id="l10658" /><CodeLine lineNumber="10658"><Highlight kind="normal">  &#123;</Highlight></CodeLine>
<Link id="l10659" /><CodeLine lineNumber="10659"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/ore">ore</a>;</Highlight></CodeLine>
<Link id="l10660" /><CodeLine lineNumber="10660"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!VectorizeLoop) &#123;</Highlight></CodeLine>
<Link id="l10661" /><CodeLine lineNumber="10661"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IC &gt; 1 &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;interleave count should not be 1 or 0&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10662" /><CodeLine lineNumber="10662"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we decided that it is not legal to vectorize the loop, then</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10663" /><CodeLine lineNumber="10663"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// interleave it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10664" /><CodeLine lineNumber="10664"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;BestPlan = LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>);</Highlight></CodeLine>
<Link id="l10665" /><CodeLine lineNumber="10665"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/innerloopvectorizer">InnerLoopVectorizer</a> Unroller(</Highlight></CodeLine>
<Link id="l10666" /><CodeLine lineNumber="10666"><Highlight kind="normal">          L, PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1),</Highlight></CodeLine>
<Link id="l10667" /><CodeLine lineNumber="10667"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1), IC, &amp;LVL, &amp;CM, <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>, Checks, BestPlan);</Highlight></CodeLine>
<Link id="l10668" /><CodeLine lineNumber="10668"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10669" /><CodeLine lineNumber="10669"><Highlight kind="normal">      LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#acbe2feb9e960936a43c845a1fa8eaba4">executePlan</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, IC, BestPlan, Unroller, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10670" /><CodeLine lineNumber="10670"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10671" /><CodeLine lineNumber="10671"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;emit(&#91;&amp;&#93;() &#123;</Highlight></CodeLine>
<Link id="l10672" /><CodeLine lineNumber="10672"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/optimizationremark">OptimizationRemark</a>(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>, </Highlight><Highlight kind="stringliteral">&quot;Interleaved&quot;</Highlight><Highlight kind="normal">, L-&gt;getStartLoc(),</Highlight></CodeLine>
<Link id="l10673" /><CodeLine lineNumber="10673"><Highlight kind="normal">                                  L-&gt;getHeader())</Highlight></CodeLine>
<Link id="l10674" /><CodeLine lineNumber="10674"><Highlight kind="normal">               &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;interleaved loop (interleaved count: &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10675" /><CodeLine lineNumber="10675"><Highlight kind="normal">               &lt;&lt; NV(</Highlight><Highlight kind="stringliteral">&quot;InterleaveCount&quot;</Highlight><Highlight kind="normal">, IC) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;)&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10676" /><CodeLine lineNumber="10676"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l10677" /><CodeLine lineNumber="10677"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l10678" /><CodeLine lineNumber="10678"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If we decided that it is &#42;legal&#42; to vectorize the loop, then do it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10679" /><CodeLine lineNumber="10679"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10680" /><CodeLine lineNumber="10680"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;BestPlan = LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>);</Highlight></CodeLine>
<Link id="l10681" /><CodeLine lineNumber="10681"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Consider vectorizing the epilogue too if it&#39;s profitable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10682" /><CodeLine lineNumber="10682"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/vectorizationfactor">VectorizationFactor</a> EpilogueVF =</Highlight></CodeLine>
<Link id="l10683" /><CodeLine lineNumber="10683"><Highlight kind="normal">          LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a0b6b1ae088cb8ca3aa4f26c4098daa3d">selectEpilogueVectorizationFactor</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, IC);</Highlight></CodeLine>
<Link id="l10684" /><CodeLine lineNumber="10684"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (EpilogueVF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>.<a href="/docs/api/classes/llvm/elementcount/#a098a514da47d00e1176aa2e16eacfb70">isVector</a>()) &#123;</Highlight></CodeLine>
<Link id="l10685" /><CodeLine lineNumber="10685"><Highlight kind="normal">        std::unique&#95;ptr&lt;VPlan&gt; BestMainPlan(BestPlan.<a href="/docs/api/classes/llvm/vplan/#afadf7ae5a5fad2c0bde13e8b72bf7a71">duplicate</a>());</Highlight></CodeLine>
<Link id="l10686" /><CodeLine lineNumber="10686"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10687" /><CodeLine lineNumber="10687"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// The first pass vectorizes the main loop and creates a scalar epilogue</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10688" /><CodeLine lineNumber="10688"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// to be vectorized by executing the plan (potentially with a different</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10689" /><CodeLine lineNumber="10689"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// factor) again shortly afterwards.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10690" /><CodeLine lineNumber="10690"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/vplan">VPlan</a> &amp;BestEpiPlan = LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#a10f355c5a55dd7e98d31c2f7e0b590aa">getPlanFor</a>(EpilogueVF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>);</Highlight></CodeLine>
<Link id="l10691" /><CodeLine lineNumber="10691"><Highlight kind="normal">        <a href="#a13368acf4fbb5816c3d82099b11519b1">preparePlanForMainVectorLoop</a>(&#42;BestMainPlan, BestEpiPlan);</Highlight></CodeLine>
<Link id="l10692" /><CodeLine lineNumber="10692"><Highlight kind="normal">        <a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo">EpilogueLoopVectorizationInfo</a> EPI(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, IC, EpilogueVF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, 1,</Highlight></CodeLine>
<Link id="l10693" /><CodeLine lineNumber="10693"><Highlight kind="normal">                                          BestEpiPlan);</Highlight></CodeLine>
<Link id="l10694" /><CodeLine lineNumber="10694"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/epiloguevectorizermainloop">EpilogueVectorizerMainLoop</a> MainILV(L, PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>,</Highlight></CodeLine>
<Link id="l10695" /><CodeLine lineNumber="10695"><Highlight kind="normal">                                           EPI, &amp;LVL, &amp;CM, <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>, Checks,</Highlight></CodeLine>
<Link id="l10696" /><CodeLine lineNumber="10696"><Highlight kind="normal">                                           &#42;BestMainPlan);</Highlight></CodeLine>
<Link id="l10697" /><CodeLine lineNumber="10697"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> ExpandedSCEVs = LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#acbe2feb9e960936a43c845a1fa8eaba4">executePlan</a>(EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d536d11651c11a778ea9fe9332a4a2e">MainLoopVF</a>, EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a18939d452d993dd7ddd465c5c11535a4">MainLoopUF</a>,</Highlight></CodeLine>
<Link id="l10698" /><CodeLine lineNumber="10698"><Highlight kind="normal">                                             &#42;BestMainPlan, MainILV, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10699" /><CodeLine lineNumber="10699"><Highlight kind="normal">        ++LoopsVectorized;</Highlight></CodeLine>
<Link id="l10700" /><CodeLine lineNumber="10700"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10701" /><CodeLine lineNumber="10701"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Second pass vectorizes the epilogue and adjusts the control flow</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10702" /><CodeLine lineNumber="10702"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// edges from the first pass.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10703" /><CodeLine lineNumber="10703"><Highlight kind="normal">        EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6d536d11651c11a778ea9fe9332a4a2e">MainLoopVF</a> = EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a529385ab333b24f1f2c2dd8525ad52a8">EpilogueVF</a>;</Highlight></CodeLine>
<Link id="l10704" /><CodeLine lineNumber="10704"><Highlight kind="normal">        EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a18939d452d993dd7ddd465c5c11535a4">MainLoopUF</a> = EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6ec74a5afe1cfb93444b9f8988ed4c12">EpilogueUF</a>;</Highlight></CodeLine>
<Link id="l10705" /><CodeLine lineNumber="10705"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/epiloguevectorizerepilogueloop">EpilogueVectorizerEpilogueLoop</a> EpilogILV(L, PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>,</Highlight></CodeLine>
<Link id="l10706" /><CodeLine lineNumber="10706"><Highlight kind="normal">                                                 <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, EPI, &amp;LVL, &amp;CM, <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>,</Highlight></CodeLine>
<Link id="l10707" /><CodeLine lineNumber="10707"><Highlight kind="normal">                                                 Checks, BestEpiPlan);</Highlight></CodeLine>
<Link id="l10708" /><CodeLine lineNumber="10708"><Highlight kind="normal">        EpilogILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a9160ed9f749a9c4df711061181288e13">setTripCount</a>(MainILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a35de654dc8297fa810c78922102bb696">getTripCount</a>());</Highlight></CodeLine>
<Link id="l10709" /><CodeLine lineNumber="10709"><Highlight kind="normal">        <a href="#aae23f7e6fc37b0f1bb756f938023512c">preparePlanForEpilogueVectorLoop</a>(BestEpiPlan, L, ExpandedSCEVs, EPI);</Highlight></CodeLine>
<Link id="l10710" /><CodeLine lineNumber="10710"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10711" /><CodeLine lineNumber="10711"><Highlight kind="normal">        LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#acbe2feb9e960936a43c845a1fa8eaba4">executePlan</a>(EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a529385ab333b24f1f2c2dd8525ad52a8">EpilogueVF</a>, EPI.<a href="/docs/api/structs/llvm/epilogueloopvectorizationinfo/#a6ec74a5afe1cfb93444b9f8988ed4c12">EpilogueUF</a>, BestEpiPlan, EpilogILV,</Highlight></CodeLine>
<Link id="l10712" /><CodeLine lineNumber="10712"><Highlight kind="normal">                        <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">, &amp;ExpandedSCEVs);</Highlight></CodeLine>
<Link id="l10713" /><CodeLine lineNumber="10713"><Highlight kind="normal">        ++LoopsEpilogueVectorized;</Highlight></CodeLine>
<Link id="l10714" /><CodeLine lineNumber="10714"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10715" /><CodeLine lineNumber="10715"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!MainILV.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a2e066ef7bc9673cbb2a825189491577d">areSafetyChecksAdded</a>())</Highlight></CodeLine>
<Link id="l10716" /><CodeLine lineNumber="10716"><Highlight kind="normal">          DisableRuntimeUnroll = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10717" /><CodeLine lineNumber="10717"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l10718" /><CodeLine lineNumber="10718"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/innerloopvectorizer">InnerLoopVectorizer</a> LB(L, PSE, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>,</Highlight></CodeLine>
<Link id="l10719" /><CodeLine lineNumber="10719"><Highlight kind="normal">                               VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a0c1900dc8fe6b998c1de1880f300dcfa">MinProfitableTripCount</a>, IC, &amp;LVL, &amp;CM, <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a>,</Highlight></CodeLine>
<Link id="l10720" /><CodeLine lineNumber="10720"><Highlight kind="normal">                               <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>, Checks, BestPlan);</Highlight></CodeLine>
<Link id="l10721" /><CodeLine lineNumber="10721"><Highlight kind="normal">        LVP.<a href="/docs/api/classes/llvm/loopvectorizationplanner/#acbe2feb9e960936a43c845a1fa8eaba4">executePlan</a>(VF.<a href="/docs/api/structs/llvm/vectorizationfactor/#a3a4e23fea2c7cec4fd3c2bf27351679c">Width</a>, IC, BestPlan, LB, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10722" /><CodeLine lineNumber="10722"><Highlight kind="normal">        ++LoopsVectorized;</Highlight></CodeLine>
<Link id="l10723" /><CodeLine lineNumber="10723"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10724" /><CodeLine lineNumber="10724"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Add metadata to disable runtime unrolling a scalar loop when there</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10725" /><CodeLine lineNumber="10725"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// are no runtime checks about strides and memory. A scalar loop that is</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10726" /><CodeLine lineNumber="10726"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// rarely used is not worth unrolling.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10727" /><CodeLine lineNumber="10727"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LB.<a href="/docs/api/classes/llvm/innerloopvectorizer/#a2e066ef7bc9673cbb2a825189491577d">areSafetyChecksAdded</a>())</Highlight></CodeLine>
<Link id="l10728" /><CodeLine lineNumber="10728"><Highlight kind="normal">          DisableRuntimeUnroll = </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10729" /><CodeLine lineNumber="10729"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l10730" /><CodeLine lineNumber="10730"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Report the vectorization decision.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10731" /><CodeLine lineNumber="10731"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a0c19b37908311872f655348755e8d003">reportVectorization</a>(<a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, L, VF, IC);</Highlight></CodeLine>
<Link id="l10732" /><CodeLine lineNumber="10732"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l10733" /><CodeLine lineNumber="10733"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10734" /><CodeLine lineNumber="10734"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>-&gt;allowExtraAnalysis(<a href="/docs/api/files/lib/lib/transforms/lib/transforms/vectorize/loopvectorizationlegality-cpp/#a0eff4a8bccb143ae91e197e6a59d4692">LV&#95;NAME</a>))</Highlight></CodeLine>
<Link id="l10735" /><CodeLine lineNumber="10735"><Highlight kind="normal">      <a href="#af1fba45879c49d4839b11ec30afd7532">checkMixedPrecision</a>(L, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>);</Highlight></CodeLine>
<Link id="l10736" /><CodeLine lineNumber="10736"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10737" /><CodeLine lineNumber="10737"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10738" /><CodeLine lineNumber="10738"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(<a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>-&gt;verify(DominatorTree::VerificationLevel::Fast) &amp;&amp;</Highlight></CodeLine>
<Link id="l10739" /><CodeLine lineNumber="10739"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;DT not preserved correctly&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10740" /><CodeLine lineNumber="10740"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10741" /><CodeLine lineNumber="10741"><Highlight kind="normal">  std::optional&lt;MDNode &#42;&gt; RemainderLoopID =</Highlight></CodeLine>
<Link id="l10742" /><CodeLine lineNumber="10742"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a368216c9c116e3f30d8dd352ce1370fc">makeFollowupLoopID</a>(OrigLoopID, &#123;<a href="#a3bf55ccbbeedcfb8cd2a1bd62c0ad91a">LLVMLoopVectorizeFollowupAll</a>,</Highlight></CodeLine>
<Link id="l10743" /><CodeLine lineNumber="10743"><Highlight kind="normal">                                      <a href="#aadedae9de069f3bcef6fa7a90ce4a630">LLVMLoopVectorizeFollowupEpilogue</a>&#125;);</Highlight></CodeLine>
<Link id="l10744" /><CodeLine lineNumber="10744"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (RemainderLoopID) &#123;</Highlight></CodeLine>
<Link id="l10745" /><CodeLine lineNumber="10745"><Highlight kind="normal">    L-&gt;setLoopID(&#42;RemainderLoopID);</Highlight></CodeLine>
<Link id="l10746" /><CodeLine lineNumber="10746"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l10747" /><CodeLine lineNumber="10747"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DisableRuntimeUnroll)</Highlight></CodeLine>
<Link id="l10748" /><CodeLine lineNumber="10748"><Highlight kind="normal">      <a href="#a033bb363914fbd3c2cd990330959036c">addRuntimeUnrollDisableMetaData</a>(L);</Highlight></CodeLine>
<Link id="l10749" /><CodeLine lineNumber="10749"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10750" /><CodeLine lineNumber="10750"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Mark the loop as already vectorized to avoid vectorizing again.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10751" /><CodeLine lineNumber="10751"><Highlight kind="normal">    Hints.<a href="/docs/api/classes/llvm/loopvectorizehints/#aa2f5ef2d522fb80de283a23d5bed6d86">setAlreadyVectorized</a>();</Highlight></CodeLine>
<Link id="l10752" /><CodeLine lineNumber="10752"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10753" /><CodeLine lineNumber="10753"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10754" /><CodeLine lineNumber="10754"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!<a href="/docs/api/namespaces/llvm/#a26389c546573f058ad8ecbdc5c1933cf">verifyFunction</a>(&#42;L-&gt;getHeader()-&gt;getParent(), &amp;<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>()));</Highlight></CodeLine>
<Link id="l10755" /><CodeLine lineNumber="10755"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10756" /><CodeLine lineNumber="10756"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l10757" /><CodeLine lineNumber="10757"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10758" /><CodeLine lineNumber="10758" lineLink="/docs/api/structs/llvm/loopvectorizepass/#a0d3ab70393b799b3be4875c3334a4f42"><Highlight kind="normal"><a href="/docs/api/structs/llvm/loopvectorizeresult">LoopVectorizeResult</a> <a href="/docs/api/structs/llvm/loopvectorizepass/#a0d3ab70393b799b3be4875c3334a4f42">LoopVectorizePass::runImpl</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l10759" /><CodeLine lineNumber="10759"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10760" /><CodeLine lineNumber="10760"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Don&#39;t attempt if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10761" /><CodeLine lineNumber="10761"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 1 the target claims to have no vector registers, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10762" /><CodeLine lineNumber="10762"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// 2 interleaving won&#39;t help ILP.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10763" /><CodeLine lineNumber="10763"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10764" /><CodeLine lineNumber="10764"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The second condition is necessary because, even if the target has no</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10765" /><CodeLine lineNumber="10765"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vector registers, loop vectorization may still enable scalar</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10766" /><CodeLine lineNumber="10766"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// interleaving.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10767" /><CodeLine lineNumber="10767"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>-&gt;getNumberOfRegisters(<a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>-&gt;getRegisterClassForType(</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">)) &amp;&amp;</Highlight></CodeLine>
<Link id="l10768" /><CodeLine lineNumber="10768"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a>-&gt;getMaxInterleaveFactor(<a href="/docs/api/classes/llvm/elementcount/#a584cb8dfa0090b33a969c4dda27337f6">ElementCount::getFixed</a>(1)) &lt; 2)</Highlight></CodeLine>
<Link id="l10769" /><CodeLine lineNumber="10769"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/loopvectorizeresult">LoopVectorizeResult</a>(</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10770" /><CodeLine lineNumber="10770"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10771" /><CodeLine lineNumber="10771"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, CFGChanged = </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10772" /><CodeLine lineNumber="10772"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10773" /><CodeLine lineNumber="10773"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The vectorizer requires loops to be in simplified form.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10774" /><CodeLine lineNumber="10774"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Since simplification may add new inner loops, it has to run before the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10775" /><CodeLine lineNumber="10775"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// legality and profitability checks. This means running the loop vectorizer</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10776" /><CodeLine lineNumber="10776"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// will simplify all loops, regardless of whether anything end up being</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10777" /><CodeLine lineNumber="10777"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// vectorized.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10778" /><CodeLine lineNumber="10778"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;L : &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>)</Highlight></CodeLine>
<Link id="l10779" /><CodeLine lineNumber="10779"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= CFGChanged |=</Highlight></CodeLine>
<Link id="l10780" /><CodeLine lineNumber="10780"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a0083a69883e0f97e111dbff064c60f42">simplifyLoop</a>(L, <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a7e7c40b0a986979535eddeb2bb6eae05">SE</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a>, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="comment">/&#42; PreserveLCSSA &#42;/</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l10781" /><CodeLine lineNumber="10781"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10782" /><CodeLine lineNumber="10782"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Build up a worklist of inner-loops to vectorize. This is necessary as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10783" /><CodeLine lineNumber="10783"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the act of vectorizing or partially unrolling a loop creates new loops</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10784" /><CodeLine lineNumber="10784"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// and can invalidate iterators across the loops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10785" /><CodeLine lineNumber="10785"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Loop &#42;, 8&gt;</a> Worklist;</Highlight></CodeLine>
<Link id="l10786" /><CodeLine lineNumber="10786"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10787" /><CodeLine lineNumber="10787"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L : &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>)</Highlight></CodeLine>
<Link id="l10788" /><CodeLine lineNumber="10788"><Highlight kind="normal">    <a href="#a00315ff11c9068aab97e5780bdfa5eef">collectSupportedLoops</a>(&#42;L, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a>, Worklist);</Highlight></CodeLine>
<Link id="l10789" /><CodeLine lineNumber="10789"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10790" /><CodeLine lineNumber="10790"><Highlight kind="normal">  LoopsAnalyzed += Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>();</Highlight></CodeLine>
<Link id="l10791" /><CodeLine lineNumber="10791"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10792" /><CodeLine lineNumber="10792"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now walk the identified inner loops.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10793" /><CodeLine lineNumber="10793"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!Worklist.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l10794" /><CodeLine lineNumber="10794"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/loop">Loop</a> &#42;L = Worklist.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l10795" /><CodeLine lineNumber="10795"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10796" /><CodeLine lineNumber="10796"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// For the inner loops we actually process, form LCSSA to simplify the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10797" /><CodeLine lineNumber="10797"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// transform.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10798" /><CodeLine lineNumber="10798"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= <a href="/docs/api/namespaces/llvm/#a30e47ae014eb35bea24e45097c2bd731">formLCSSARecursively</a>(&#42;L, &#42;<a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>, <a href="/docs/api/structs/llvm/loopvectorizepass/#a7e7c40b0a986979535eddeb2bb6eae05">SE</a>);</Highlight></CodeLine>
<Link id="l10799" /><CodeLine lineNumber="10799"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10800" /><CodeLine lineNumber="10800"><Highlight kind="normal">    <a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a> |= CFGChanged |= <a href="/docs/api/structs/llvm/loopvectorizepass/#a160afa01e95095aa0c8115b6e0e6f4a6">processLoop</a>(L);</Highlight></CodeLine>
<Link id="l10801" /><CodeLine lineNumber="10801"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10802" /><CodeLine lineNumber="10802"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>) &#123;</Highlight></CodeLine>
<Link id="l10803" /><CodeLine lineNumber="10803"><Highlight kind="normal">      <a href="/docs/api/structs/llvm/loopvectorizepass/#a38ff83df2a3ad17de50157ed09a1c259">LAIs</a>-&gt;clear();</Highlight></CodeLine>
<Link id="l10804" /><CodeLine lineNumber="10804"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10805" /><CodeLine lineNumber="10805"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10806" /><CodeLine lineNumber="10806"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a4522d39270d83d73550a3777a2fca312">VerifySCEV</a>)</Highlight></CodeLine>
<Link id="l10807" /><CodeLine lineNumber="10807"><Highlight kind="normal">        <a href="/docs/api/structs/llvm/loopvectorizepass/#a7e7c40b0a986979535eddeb2bb6eae05">SE</a>-&gt;verify();</Highlight></CodeLine>
<Link id="l10808" /><CodeLine lineNumber="10808"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10809" /><CodeLine lineNumber="10809"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l10810" /><CodeLine lineNumber="10810"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10811" /><CodeLine lineNumber="10811"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10812" /><CodeLine lineNumber="10812"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Process each loop nest in the function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10813" /><CodeLine lineNumber="10813"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/loopvectorizeresult">LoopVectorizeResult</a>(<a href="/docs/api/groups/arcopt/#gaa57b1a4e6a1c79233913139635169cf1">Changed</a>, CFGChanged);</Highlight></CodeLine>
<Link id="l10814" /><CodeLine lineNumber="10814"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l10815" /><CodeLine lineNumber="10815"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10816" /><CodeLine lineNumber="10816" lineLink="/docs/api/structs/llvm/loopvectorizepass/#af3b0e58cfdb2c6c663cd47a8808ba70a"><Highlight kind="normal"><a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> <a href="/docs/api/structs/llvm/loopvectorizepass/#af3b0e58cfdb2c6c663cd47a8808ba70a">LoopVectorizePass::run</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>,</Highlight></CodeLine>
<Link id="l10817" /><CodeLine lineNumber="10817"><Highlight kind="normal">                                         <a href="/docs/api/namespaces/llvm/#adce09a5a0de0e3177eb00e932734af2f">FunctionAnalysisManager</a> &amp;AM) &#123;</Highlight></CodeLine>
<Link id="l10818" /><CodeLine lineNumber="10818"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l10819" /><CodeLine lineNumber="10819"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// There are no loops in the function. Return before computing other</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10820" /><CodeLine lineNumber="10820"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// expensive analyses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10821" /><CodeLine lineNumber="10821"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/loopvectorizepass/#a32cea93d587825e715e63f5d58834cd3">LI</a>-&gt;empty())</Highlight></CodeLine>
<Link id="l10822" /><CodeLine lineNumber="10822"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</Highlight></CodeLine>
<Link id="l10823" /><CodeLine lineNumber="10823"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizepass/#a7e7c40b0a986979535eddeb2bb6eae05">SE</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/scalarevolutionanalysis">ScalarEvolutionAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l10824" /><CodeLine lineNumber="10824"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizepass/#af801c62acf781555151418001a6c5270">TTI</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/targetiranalysis">TargetIRAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l10825" /><CodeLine lineNumber="10825"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizepass/#af4e171d085c0c20949584a32ee65acce">DT</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l10826" /><CodeLine lineNumber="10826"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizepass/#a07ce98f749d234136ba025ecbf174b53">TLI</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/targetlibraryanalysis">TargetLibraryAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l10827" /><CodeLine lineNumber="10827"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizepass/#ab9ba33b1dd671be4bc212c442516409f">AC</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/assumptionanalysis">AssumptionAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l10828" /><CodeLine lineNumber="10828"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizepass/#a427352f0eda31223a0b25d9f143ce0b1">DB</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/demandedbitsanalysis">DemandedBitsAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l10829" /><CodeLine lineNumber="10829"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizepass/#af494038e310bd942f44e66bee50ce632">ORE</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/optimizationremarkemitteranalysis">OptimizationRemarkEmitterAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l10830" /><CodeLine lineNumber="10830"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizepass/#a38ff83df2a3ad17de50157ed09a1c259">LAIs</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/loopaccessanalysis">LoopAccessAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l10831" /><CodeLine lineNumber="10831"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10832" /><CodeLine lineNumber="10832"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;MAMProxy = AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/namespaces/llvm/#a2b0ee73723ccffec457f8712220b0c25">ModuleAnalysisManagerFunctionProxy</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l10833" /><CodeLine lineNumber="10833"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a> = MAMProxy.getCachedResult&lt;<a href="/docs/api/classes/llvm/profilesummaryanalysis">ProfileSummaryAnalysis</a>&gt;(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent());</Highlight></CodeLine>
<Link id="l10834" /><CodeLine lineNumber="10834"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10835" /><CodeLine lineNumber="10835"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a> &amp;&amp; <a href="/docs/api/structs/llvm/loopvectorizepass/#a1833d18292c92e20a003f7074e518060">PSI</a>-&gt;hasProfileSummary())</Highlight></CodeLine>
<Link id="l10836" /><CodeLine lineNumber="10836"><Highlight kind="normal">    <a href="/docs/api/structs/llvm/loopvectorizepass/#a5604ee7cd98afbb8b5a581e9c3dd7dff">BFI</a> = &amp;AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/classes/llvm/blockfrequencyanalysis">BlockFrequencyAnalysis</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l10837" /><CodeLine lineNumber="10837"><Highlight kind="normal">  <a href="/docs/api/structs/llvm/loopvectorizeresult">LoopVectorizeResult</a> Result = <a href="/docs/api/structs/llvm/loopvectorizepass/#a0d3ab70393b799b3be4875c3334a4f42">runImpl</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l10838" /><CodeLine lineNumber="10838"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Result.MadeAnyChange)</Highlight></CodeLine>
<Link id="l10839" /><CodeLine lineNumber="10839"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/preservedanalyses/#a1258a1ff55557c27684010ebd7283712">PreservedAnalyses::all</a>();</Highlight></CodeLine>
<Link id="l10840" /><CodeLine lineNumber="10840"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/preservedanalyses">PreservedAnalyses</a> PA;</Highlight></CodeLine>
<Link id="l10841" /><CodeLine lineNumber="10841"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10842" /><CodeLine lineNumber="10842"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#aa9ef2dbd1b7ce921093f7d4a7bd4cc5c">isAssignmentTrackingEnabled</a>(&#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>.getParent())) &#123;</Highlight></CodeLine>
<Link id="l10843" /><CodeLine lineNumber="10843"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</Highlight></CodeLine>
<Link id="l10844" /><CodeLine lineNumber="10844"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a08f3f942afc0ee9115a8f9fa87e9191d">RemoveRedundantDbgInstrs</a>(&amp;BB);</Highlight></CodeLine>
<Link id="l10845" /><CodeLine lineNumber="10845"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10846" /><CodeLine lineNumber="10846"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10847" /><CodeLine lineNumber="10847"><Highlight kind="normal">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/loopanalysis">LoopAnalysis</a>&gt;();</Highlight></CodeLine>
<Link id="l10848" /><CodeLine lineNumber="10848"><Highlight kind="normal">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/dominatortreeanalysis">DominatorTreeAnalysis</a>&gt;();</Highlight></CodeLine>
<Link id="l10849" /><CodeLine lineNumber="10849"><Highlight kind="normal">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/scalarevolutionanalysis">ScalarEvolutionAnalysis</a>&gt;();</Highlight></CodeLine>
<Link id="l10850" /><CodeLine lineNumber="10850"><Highlight kind="normal">  PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/classes/llvm/loopaccessanalysis">LoopAccessAnalysis</a>&gt;();</Highlight></CodeLine>
<Link id="l10851" /><CodeLine lineNumber="10851"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10852" /><CodeLine lineNumber="10852"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Result.MadeCFGChange) &#123;</Highlight></CodeLine>
<Link id="l10853" /><CodeLine lineNumber="10853"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Making CFG changes likely means a loop got vectorized. Indicate that</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10854" /><CodeLine lineNumber="10854"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// extra simplification passes should be run.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10855" /><CodeLine lineNumber="10855"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// TODO: MadeCFGChanges is not a prefect proxy. Extra passes should only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10856" /><CodeLine lineNumber="10856"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// be run if runtime checks have been added.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10857" /><CodeLine lineNumber="10857"><Highlight kind="normal">    AM.<a href="/docs/api/classes/llvm/analysismanager/#aaab1fad63e4f3b8679469720a873fedd">getResult</a>&lt;<a href="/docs/api/structs/llvm/shouldrunextravectorpasses">ShouldRunExtraVectorPasses</a>&gt;(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>);</Highlight></CodeLine>
<Link id="l10858" /><CodeLine lineNumber="10858"><Highlight kind="normal">    PA.<a href="/docs/api/classes/llvm/preservedanalyses/#ad966bea18aa62ffb9e040509adc7c99f">preserve</a>&lt;<a href="/docs/api/structs/llvm/shouldrunextravectorpasses">ShouldRunExtraVectorPasses</a>&gt;();</Highlight></CodeLine>
<Link id="l10859" /><CodeLine lineNumber="10859"><Highlight kind="normal">  &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l10860" /><CodeLine lineNumber="10860"><Highlight kind="normal">    PA.<a href="/docs/api/classes/llvm/preservedanalyses/#a937c42f77e161349ce0f999e448c7027">preserveSet</a>&lt;<a href="/docs/api/classes/llvm/cfganalyses">CFGAnalyses</a>&gt;();</Highlight></CodeLine>
<Link id="l10861" /><CodeLine lineNumber="10861"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l10862" /><CodeLine lineNumber="10862"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> PA;</Highlight></CodeLine>
<Link id="l10863" /><CodeLine lineNumber="10863"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l10864" /><CodeLine lineNumber="10864"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10865" /><CodeLine lineNumber="10865" lineLink="/docs/api/structs/llvm/loopvectorizepass/#a4fa1898352e5014c447a589398c94595"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/structs/llvm/loopvectorizepass/#a4fa1898352e5014c447a589398c94595">LoopVectorizePass::printPipeline</a>(</Highlight></CodeLine>
<Link id="l10866" /><CodeLine lineNumber="10866"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/raw-ostream">raw&#95;ostream</a> &amp;OS, <a href="/docs/api/classes/llvm/function-ref">function&#95;ref</a>&lt;<a href="/docs/api/classes/llvm/stringref">StringRef</a>(<a href="/docs/api/classes/llvm/stringref">StringRef</a>)&gt; MapClassName2PassName) &#123;</Highlight></CodeLine>
<Link id="l10867" /><CodeLine lineNumber="10867"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">static&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/structs/llvm/passinfomixin">PassInfoMixin&lt;LoopVectorizePass&gt;</a> &#42;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(</Highlight><Highlight kind="keyword">this</Highlight><Highlight kind="normal">)-&gt;<a href="/docs/api/structs/llvm/loopvectorizepass/#a4fa1898352e5014c447a589398c94595">printPipeline</a>(</Highlight></CodeLine>
<Link id="l10868" /><CodeLine lineNumber="10868"><Highlight kind="normal">      OS, MapClassName2PassName);</Highlight></CodeLine>
<Link id="l10869" /><CodeLine lineNumber="10869"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l10870" /><CodeLine lineNumber="10870"><Highlight kind="normal">  OS &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;&lt;&#39;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10871" /><CodeLine lineNumber="10871"><Highlight kind="normal">  OS &lt;&lt; (InterleaveOnlyWhenForced ? </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;no-&quot;</Highlight><Highlight kind="normal">) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;interleave-forced-only;&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10872" /><CodeLine lineNumber="10872"><Highlight kind="normal">  OS &lt;&lt; (VectorizeOnlyWhenForced ? </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;no-&quot;</Highlight><Highlight kind="normal">) &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;vectorize-forced-only;&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10873" /><CodeLine lineNumber="10873"><Highlight kind="normal">  OS &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;&gt;&#39;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l10874" /><CodeLine lineNumber="10874"><Highlight kind="normal">&#125;</Highlight></CodeLine>

</ProgramListing>


</DoxygenPage>
