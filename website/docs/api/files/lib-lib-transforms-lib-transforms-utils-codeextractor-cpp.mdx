---

# DO NOT EDIT!
# Automatically generated via docusaurus-plugin-doxygen by Doxygen.

slug: /api/files/lib/lib/transforms/lib/transforms/utils/codeextractor-cpp
custom_edit_url: null
keywords:
  - doxygen
  - reference
  - file

---

import Link from '@docusaurus/Link'

import CodeLine from '@xpack/docusaurus-plugin-doxygen/components/CodeLine'
import DoxygenPage from '@xpack/docusaurus-plugin-doxygen/components/DoxygenPage'
import Highlight from '@xpack/docusaurus-plugin-doxygen/components/Highlight'
import IncludesList from '@xpack/docusaurus-plugin-doxygen/components/IncludesList'
import IncludesListItem from '@xpack/docusaurus-plugin-doxygen/components/IncludesListItem'
import MemberDefinition from '@xpack/docusaurus-plugin-doxygen/components/MemberDefinition'
import MembersIndex from '@xpack/docusaurus-plugin-doxygen/components/MembersIndex'
import MembersIndexItem from '@xpack/docusaurus-plugin-doxygen/components/MembersIndexItem'
import ProgramListing from '@xpack/docusaurus-plugin-doxygen/components/ProgramListing'
import SectionDefinition from '@xpack/docusaurus-plugin-doxygen/components/SectionDefinition'

import pluginConfig from '@site/docusaurus-plugin-doxygen-config.json'

# The `CodeExtractor.cpp` File Reference

<DoxygenPage pluginConfig={pluginConfig}>



## Included Headers

<IncludesList>
<IncludesListItem
  filePath="llvm/Transforms/Utils/CodeExtractor.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/codeextractor-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/ArrayRef.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/DenseMap.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/STLExtras.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SetVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallPtrSet.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/ADT/SmallVector.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/AssumptionCache.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BlockFrequencyInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BlockFrequencyInfoImpl.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfoimpl-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Analysis/BranchProbabilityInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/analysis/branchprobabilityinfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Argument.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/argument-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Attributes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/BasicBlock.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/CFG.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constant.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Constants.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DIBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DataLayout.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfo.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DebugInfoMetadata.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/DerivedTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Dominators.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Function.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/function-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/GlobalValue.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/globalvalue-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstIterator.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/institerator-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/InstrTypes.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instruction.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Instructions.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/IntrinsicInst.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Intrinsics.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/LLVMContext.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/MDBuilder.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Module.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/module-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/PatternMatch.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Type.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/type-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/User.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/user-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Value.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/value-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/IR/Verifier.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/ir/verifier-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/BlockFrequency.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/blockfrequency-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/BranchProbability.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Casting.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/casting-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/CommandLine.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/Debug.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/debug-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/ErrorHandling.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Support/raw_ostream.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h"
  isLocal="true" />
<IncludesListItem
  filePath="llvm/Transforms/Utils/BasicBlockUtils.h"
  permalink="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h"
  isLocal="true" />
<IncludesListItem
  filePath="cassert"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="cstdint"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="iterator"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="map"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="utility"
  permalink=""
  isLocal="false" />
<IncludesListItem
  filePath="vector"
  permalink=""
  isLocal="false" />
</IncludesList>

## Functions Index

<MembersIndex>

<MembersIndexItem
  type="void"
  name={<><a href="#a19cc77dc725d4cbbf994e5db311e3c97">applyFirstDebugLoc</a> (Function &#42;oldFunction, ArrayRef&lt; BasicBlock &#42; &gt; Blocks, Instruction &#42;BranchI)</>}>
If the original function has debug info, we have to add a debug location to the new branch instruction from the artificial entry block. <a href="#a19cc77dc725d4cbbf994e5db311e3c97">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt;</>}
  name={<><a href="#a10e1b14fd1da88aad682e5d70ab224bb">buildExtractionBlockSet</a> (ArrayRef&lt; BasicBlock &#42; &gt; BBs, DominatorTree &#42;DT, bool AllowVarArgs, bool AllowAlloca)</>}>
Build a set of blocks to extract if the input blocks are viable. <a href="#a10e1b14fd1da88aad682e5d70ab224bb">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a4dde4d426caa9831108c7520128292e0">definedInCaller</a> (const SetVector&lt; BasicBlock &#42; &gt; &amp;Blocks, Value &#42;V)</>}>
definedInCaller - Return true if the specified value is defined in the function being code extracted, but not in the region being extracted. <a href="#a4dde4d426caa9831108c7520128292e0">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a2b5ed2fba3b0aa877b82ba5d6f4131bf">definedInRegion</a> (const SetVector&lt; BasicBlock &#42; &gt; &amp;Blocks, Value &#42;V)</>}>
definedInRegion - Return true if the specified value is defined in the extracted region. <a href="#a2b5ed2fba3b0aa877b82ba5d6f4131bf">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a01efda615d7f206d097e0280ab2fbaa7">eraseDebugIntrinsicsWithNonLocalRefs</a> (Function &amp;F)</>}>
Erase debug info intrinsics which refer to values in <code>F</code> but aren&#39;t in <code>F</code>. <a href="#a01efda615d7f206d097e0280ab2fbaa7">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#a93144a1eb23283cfa213d7dccb12d683">eraseLifetimeMarkersOnInputs</a> (const SetVector&lt; BasicBlock &#42; &gt; &amp;Blocks, const SetVector&lt; Value &#42; &gt; &amp;SunkAllocas, SetVector&lt; Value &#42; &gt; &amp;LifetimesStart)</>}>
Erase lifetime.start markers which reference inputs to the extraction region, and insert the referenced memory into <code>LifetimesStart</code>. <a href="#a93144a1eb23283cfa213d7dccb12d683">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#aa1461454928a2518e7f3eea698b3a1da">fixupDebugInfoPostExtraction</a> (Function &amp;OldFunc, Function &amp;NewFunc, CallInst &amp;TheCall)</>}>
Fix up the debug info in the old and new functions by pointing line locations and debug intrinsics to the new subprogram scope, and by deleting intrinsics which point to values outside of the new function. <a href="#aa1461454928a2518e7f3eea698b3a1da">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</>}
  name={<><a href="#a8289e5f6e7e557759efb2b1b785c9196">getCommonExitBlock</a> (const SetVector&lt; BasicBlock &#42; &gt; &amp;Blocks)</>}>
</MembersIndexItem>

<MembersIndexItem
  type="void"
  name={<><a href="#ae3b43649c18ab9e63c1be61b93dd7031">insertLifetimeMarkersSurroundingCall</a> (Module &#42;M, ArrayRef&lt; Value &#42; &gt; LifetimesStart, ArrayRef&lt; Value &#42; &gt; LifetimesEnd, CallInst &#42;TheCall)</>}>
Insert lifetime start/end markers surrounding the call to the new function for objects defined in the caller. <a href="#ae3b43649c18ab9e63c1be61b93dd7031">More...</a>
</MembersIndexItem>

<MembersIndexItem
  type="bool"
  name={<><a href="#a5a7fe53bda3cbce584280a177a18d5ab">isBlockValidForExtraction</a> (const BasicBlock &amp;BB, const SetVector&lt; BasicBlock &#42; &gt; &amp;Result, bool AllowVarArgs, bool AllowAlloca)</>}>
Test whether a block is valid for extraction. <a href="#a5a7fe53bda3cbce584280a177a18d5ab">More...</a>
</MembersIndexItem>

</MembersIndex>

## Variables Index

<MembersIndex>

<MembersIndexItem
  type={<><a href="/docs/api/classes/llvm/cl/opt">cl::opt</a>&lt; bool &gt;</>}
  name={<><a href="#ab04f4c20d718420071af11662817dbd4">AggregateArgsOpt</a></>}>
</MembersIndexItem>

</MembersIndex>

## Defines Index

<MembersIndex>

<MembersIndexItem
  type="#define"
  name={<><a href="#ad78e062f62e0d6e453941fb4ca843e4d">DEBUG&#95;TYPE</a>&nbsp;&nbsp;&nbsp;&quot;code-extractor&quot;</>}>
</MembersIndexItem>

</MembersIndex>


<SectionDefinition>

## Functions

### applyFirstDebugLoc() {#a19cc77dc725d4cbbf994e5db311e3c97}

<MemberDefinition
  prototype={<>static void applyFirstDebugLoc (<a href="/docs/api/classes/llvm/function">Function</a> &#42; oldFunction, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; Blocks, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42; BranchI)</>}
  labels = {["static"]}>
If the original function has debug info, we have to add a debug location to the new branch instruction from the artificial entry block.

We use the debug location of the first instruction in the extracted blocks, as there is no other equivalent line in the source code.

Definition at line <a href="#l01057">1057</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codeextractor-cpp">CodeExtractor.cpp</a>.
</MemberDefinition>

### buildExtractionBlockSet() {#a10e1b14fd1da88aad682e5d70ab224bb}

<MemberDefinition
  prototype={<>static SetVector&lt; BasicBlock &#42; &gt; buildExtractionBlockSet (<a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; BBs, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42; DT, bool AllowVarArgs, bool AllowAlloca)</>}
  labels = {["static"]}>
Build a set of blocks to extract if the input blocks are viable.

Definition at line <a href="#l00195">195</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codeextractor-cpp">CodeExtractor.cpp</a>.
</MemberDefinition>

### definedInCaller() {#a4dde4d426caa9831108c7520128292e0}

<MemberDefinition
  prototype={<>static bool definedInCaller (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; Blocks, <a href="/docs/api/classes/llvm/value">Value</a> &#42; V)</>}
  labels = {["static"]}>
definedInCaller - Return true if the specified value is defined in the function being code extracted, but not in the region being extracted.

These values must be passed in as live-ins to the function.

Definition at line <a href="#l00267">267</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codeextractor-cpp">CodeExtractor.cpp</a>.
</MemberDefinition>

### definedInRegion() {#a2b5ed2fba3b0aa877b82ba5d6f4131bf}

<MemberDefinition
  prototype={<>static bool definedInRegion (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; Blocks, <a href="/docs/api/classes/llvm/value">Value</a> &#42; V)</>}
  labels = {["static"]}>
definedInRegion - Return true if the specified value is defined in the extracted region.

Definition at line <a href="#l00257">257</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codeextractor-cpp">CodeExtractor.cpp</a>.
</MemberDefinition>

### eraseDebugIntrinsicsWithNonLocalRefs() {#a01efda615d7f206d097e0280ab2fbaa7}

<MemberDefinition
  prototype={<>static void eraseDebugIntrinsicsWithNonLocalRefs (<a href="/docs/api/classes/llvm/function">Function</a> &amp; F)</>}
  labels = {["static"]}>
Erase debug info intrinsics which refer to values in <code>F</code> but aren&#39;t in <code>F</code>.

Definition at line <a href="#l01212">1212</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codeextractor-cpp">CodeExtractor.cpp</a>.
</MemberDefinition>

### eraseLifetimeMarkersOnInputs() {#a93144a1eb23283cfa213d7dccb12d683}

<MemberDefinition
  prototype={<>static void eraseLifetimeMarkersOnInputs (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; Blocks, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; SunkAllocas, <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; &amp; LifetimesStart)</>}
  labels = {["static"]}>
Erase lifetime.start markers which reference inputs to the extraction region, and insert the referenced memory into <code>LifetimesStart</code>.

The extraction region is defined by a set of blocks (<code>Blocks</code>), and a set of allocas which will be moved from the caller function into the extracted function (<code>SunkAllocas</code>).

Definition at line <a href="#l01082">1082</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codeextractor-cpp">CodeExtractor.cpp</a>.
</MemberDefinition>

### fixupDebugInfoPostExtraction() {#aa1461454928a2518e7f3eea698b3a1da}

<MemberDefinition
  prototype={<>static void fixupDebugInfoPostExtraction (<a href="/docs/api/classes/llvm/function">Function</a> &amp; OldFunc, <a href="/docs/api/classes/llvm/function">Function</a> &amp; NewFunc, <a href="/docs/api/classes/llvm/callinst">CallInst</a> &amp; TheCall)</>}
  labels = {["static"]}>
Fix up the debug info in the old and new functions by pointing line locations and debug intrinsics to the new subprogram scope, and by deleting intrinsics which point to values outside of the new function.

Definition at line <a href="#l01229">1229</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codeextractor-cpp">CodeExtractor.cpp</a>.
</MemberDefinition>

### getCommonExitBlock() {#a8289e5f6e7e557759efb2b1b785c9196}

<MemberDefinition
  prototype={<>static BasicBlock &#42; getCommonExitBlock (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; Blocks)</>}
  labels = {["static"]}>

Definition at line <a href="#l00275">275</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codeextractor-cpp">CodeExtractor.cpp</a>.
</MemberDefinition>

### insertLifetimeMarkersSurroundingCall() {#ae3b43649c18ab9e63c1be61b93dd7031}

<MemberDefinition
  prototype={<>static void insertLifetimeMarkersSurroundingCall (<a href="/docs/api/classes/llvm/module">Module</a> &#42; M, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; LifetimesStart, <a href="/docs/api/classes/llvm/arrayref">ArrayRef</a>&lt; <a href="/docs/api/classes/llvm/value">Value</a> &#42; &gt; LifetimesEnd, <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42; TheCall)</>}
  labels = {["static"]}>
Insert lifetime start/end markers surrounding the call to the new function for objects defined in the caller.

Definition at line <a href="#l01107">1107</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codeextractor-cpp">CodeExtractor.cpp</a>.
</MemberDefinition>

### isBlockValidForExtraction() {#a5a7fe53bda3cbce584280a177a18d5ab}

<MemberDefinition
  prototype={<>static bool isBlockValidForExtraction (<a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp; BB, <a href="/docs/api/files/lib/lib/target/lib/target/aarch64/aarch64promoteconstant-cpp/#a90f8350fecae261c25be85d38b451bff">const</a> <a href="/docs/api/classes/llvm/setvector">SetVector</a>&lt; <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42; &gt; &amp; Result, bool AllowVarArgs, bool AllowAlloca)</>}
  labels = {["static"]}>
Test whether a block is valid for extraction.

Definition at line <a href="#l00084">84</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codeextractor-cpp">CodeExtractor.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Variables

### AggregateArgsOpt {#ab04f4c20d718420071af11662817dbd4}

<MemberDefinition
  prototype={<>cl::opt&lt; bool &gt; AggregateArgsOpt(&quot;aggregate-extracted-args&quot;, cl::Hidden, cl::desc(&quot;Aggregate arguments to code-extracted functions&quot;))</>}
  labels = {["static"]}>

Definition at line <a href="#l00080">80</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codeextractor-cpp">CodeExtractor.cpp</a>.
</MemberDefinition>

</SectionDefinition>

<SectionDefinition>

## Defines

### DEBUG&#95;TYPE {#ad78e062f62e0d6e453941fb4ca843e4d}

<MemberDefinition
  prototype={<>#define DEBUG&#95;TYPE&nbsp;&nbsp;&nbsp;&quot;code-extractor&quot;</>}>

Definition at line <a href="#l00073">73</a> of file <a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/codeextractor-cpp">CodeExtractor.cpp</a>.
</MemberDefinition>

</SectionDefinition>

## File Listing

The file content with the documentation metadata removed is:

<ProgramListing>

<Link id="l00001" /><CodeLine lineNumber="1"><Highlight kind="comment">//===- CodeExtractor.cpp - Pull code region into a new function -----------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00002" /><CodeLine lineNumber="2"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00003" /><CodeLine lineNumber="3"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00004" /><CodeLine lineNumber="4"><Highlight kind="normal"></Highlight><Highlight kind="comment">// See https://llvm.org/LICENSE.txt for license information.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00005" /><CodeLine lineNumber="5"><Highlight kind="normal"></Highlight><Highlight kind="comment">// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00006" /><CodeLine lineNumber="6"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00007" /><CodeLine lineNumber="7"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00008" /><CodeLine lineNumber="8"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00009" /><CodeLine lineNumber="9"><Highlight kind="normal"></Highlight><Highlight kind="comment">// This file implements the interface to tear out a code region, such as an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00010" /><CodeLine lineNumber="10"><Highlight kind="normal"></Highlight><Highlight kind="comment">// individual loop or a parallel section, into a new function, replacing it with</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00011" /><CodeLine lineNumber="11"><Highlight kind="normal"></Highlight><Highlight kind="comment">// a call to the new function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00012" /><CodeLine lineNumber="12"><Highlight kind="normal"></Highlight><Highlight kind="comment">//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00013" /><CodeLine lineNumber="13"><Highlight kind="normal"></Highlight><Highlight kind="comment">//===----------------------------------------------------------------------===//</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00014" /><CodeLine lineNumber="14"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00015" /><CodeLine lineNumber="15"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/codeextractor-h">llvm/Transforms/Utils/CodeExtractor.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00016" /><CodeLine lineNumber="16"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/arrayref-h">llvm/ADT/ArrayRef.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00017" /><CodeLine lineNumber="17"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/densemap-h">llvm/ADT/DenseMap.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00018" /><CodeLine lineNumber="18"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/stlextras-h">llvm/ADT/STLExtras.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00019" /><CodeLine lineNumber="19"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/setvector-h">llvm/ADT/SetVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00020" /><CodeLine lineNumber="20"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallptrset-h">llvm/ADT/SmallPtrSet.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00021" /><CodeLine lineNumber="21"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/adt/smallvector-h">llvm/ADT/SmallVector.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00022" /><CodeLine lineNumber="22"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/assumptioncache-h">llvm/Analysis/AssumptionCache.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00023" /><CodeLine lineNumber="23"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfo-h">llvm/Analysis/BlockFrequencyInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00024" /><CodeLine lineNumber="24"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/blockfrequencyinfoimpl-h">llvm/Analysis/BlockFrequencyInfoImpl.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00025" /><CodeLine lineNumber="25"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/analysis/branchprobabilityinfo-h">llvm/Analysis/BranchProbabilityInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00026" /><CodeLine lineNumber="26"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/argument-h">llvm/IR/Argument.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00027" /><CodeLine lineNumber="27"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/attributes-h">llvm/IR/Attributes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00028" /><CodeLine lineNumber="28"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/basicblock-h">llvm/IR/BasicBlock.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00029" /><CodeLine lineNumber="29"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/cfg-h">llvm/IR/CFG.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00030" /><CodeLine lineNumber="30"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constant-h">llvm/IR/Constant.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00031" /><CodeLine lineNumber="31"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/constants-h">llvm/IR/Constants.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00032" /><CodeLine lineNumber="32"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dibuilder-h">llvm/IR/DIBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00033" /><CodeLine lineNumber="33"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/datalayout-h">llvm/IR/DataLayout.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00034" /><CodeLine lineNumber="34"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfo-h">llvm/IR/DebugInfo.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00035" /><CodeLine lineNumber="35"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/debuginfometadata-h">llvm/IR/DebugInfoMetadata.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00036" /><CodeLine lineNumber="36"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/derivedtypes-h">llvm/IR/DerivedTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00037" /><CodeLine lineNumber="37"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/dominators-h">llvm/IR/Dominators.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00038" /><CodeLine lineNumber="38"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/function-h">llvm/IR/Function.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00039" /><CodeLine lineNumber="39"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/globalvalue-h">llvm/IR/GlobalValue.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00040" /><CodeLine lineNumber="40"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/institerator-h">llvm/IR/InstIterator.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00041" /><CodeLine lineNumber="41"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instrtypes-h">llvm/IR/InstrTypes.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00042" /><CodeLine lineNumber="42"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instruction-h">llvm/IR/Instruction.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00043" /><CodeLine lineNumber="43"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/instructions-h">llvm/IR/Instructions.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00044" /><CodeLine lineNumber="44"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsicinst-h">llvm/IR/IntrinsicInst.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00045" /><CodeLine lineNumber="45"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/intrinsics-h">llvm/IR/Intrinsics.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00046" /><CodeLine lineNumber="46"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/llvmcontext-h">llvm/IR/LLVMContext.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00047" /><CodeLine lineNumber="47"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/mdbuilder-h">llvm/IR/MDBuilder.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00048" /><CodeLine lineNumber="48"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/module-h">llvm/IR/Module.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00049" /><CodeLine lineNumber="49"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/patternmatch-h">llvm/IR/PatternMatch.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00050" /><CodeLine lineNumber="50"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/type-h">llvm/IR/Type.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00051" /><CodeLine lineNumber="51"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/user-h">llvm/IR/User.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00052" /><CodeLine lineNumber="52"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/value-h">llvm/IR/Value.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00053" /><CodeLine lineNumber="53"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/ir/verifier-h">llvm/IR/Verifier.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00054" /><CodeLine lineNumber="54"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/blockfrequency-h">llvm/Support/BlockFrequency.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00055" /><CodeLine lineNumber="55"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/branchprobability-h">llvm/Support/BranchProbability.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00056" /><CodeLine lineNumber="56"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/casting-h">llvm/Support/Casting.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00057" /><CodeLine lineNumber="57"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/commandline-h">llvm/Support/CommandLine.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00058" /><CodeLine lineNumber="58"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h">llvm/Support/Debug.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00059" /><CodeLine lineNumber="59"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h">llvm/Support/ErrorHandling.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00060" /><CodeLine lineNumber="60"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/support/raw-ostream-h">llvm/Support/raw&#95;ostream.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00061" /><CodeLine lineNumber="61"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &quot;<a href="/docs/api/files/include/include/llvm/include/llvm/transforms/include/llvm/transforms/utils/basicblockutils-h">llvm/Transforms/Utils/BasicBlockUtils.h</a>&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00062" /><CodeLine lineNumber="62"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cassert&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00063" /><CodeLine lineNumber="63"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;cstdint&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00064" /><CodeLine lineNumber="64"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;iterator&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00065" /><CodeLine lineNumber="65"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;map&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00066" /><CodeLine lineNumber="66"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;utility&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00067" /><CodeLine lineNumber="67"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#include &lt;vector&gt;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00068" /><CodeLine lineNumber="68"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00069" /><CodeLine lineNumber="69"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm">llvm</a>;</Highlight></CodeLine>
<Link id="l00070" /><CodeLine lineNumber="70"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using namespace </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/patternmatch">llvm::PatternMatch</a>;</Highlight></CodeLine>
<Link id="l00071" /><CodeLine lineNumber="71"><Highlight kind="normal"></Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/llvm/#a854ac9cfc31bb306b1495a508707dc26">ProfileCount</a> = <a href="/docs/api/classes/llvm/function/profilecount">Function::ProfileCount</a>;</Highlight></CodeLine>
<Link id="l00072" /><CodeLine lineNumber="72"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00073" /><CodeLine lineNumber="73" lineLink="#ad78e062f62e0d6e453941fb4ca843e4d"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#define DEBUG&#95;TYPE &quot;code-extractor&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00074" /><CodeLine lineNumber="74"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00075" /><CodeLine lineNumber="75"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Provide a command-line option to aggregate function arguments into a struct</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00076" /><CodeLine lineNumber="76"><Highlight kind="normal"></Highlight><Highlight kind="comment">// for functions produced by the code extractor. This is useful when converting</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00077" /><CodeLine lineNumber="77"><Highlight kind="normal"></Highlight><Highlight kind="comment">// extracted functions to pthread-based code, as only one argument (void&#42;) can</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00078" /><CodeLine lineNumber="78"><Highlight kind="normal"></Highlight><Highlight kind="comment">// be passed in to pthread&#95;create().</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00079" /><CodeLine lineNumber="79"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/cl/opt">cl::opt&lt;bool&gt;</a></Highlight></CodeLine>
<Link id="l00080" /><CodeLine lineNumber="80" lineLink="#ab04f4c20d718420071af11662817dbd4"><Highlight kind="normal"><a href="#ab04f4c20d718420071af11662817dbd4">AggregateArgsOpt</a>(</Highlight><Highlight kind="stringliteral">&quot;aggregate-extracted-args&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/namespaces/llvm/cl/#a68075925a54790e71ca790e1d4f21a40a263ac008d8d31f13ce460395fc4cf7e6">cl::Hidden</a>,</Highlight></CodeLine>
<Link id="l00081" /><CodeLine lineNumber="81"><Highlight kind="normal">                 <a href="/docs/api/structs/llvm/cl/desc">cl::desc</a>(</Highlight><Highlight kind="stringliteral">&quot;Aggregate arguments to code-extracted functions&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l00082" /><CodeLine lineNumber="82"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00083" /><CodeLine lineNumber="83"><Highlight kind="comment">/// Test whether a block is valid for extraction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00084" /><CodeLine lineNumber="84" lineLink="#a5a7fe53bda3cbce584280a177a18d5ab"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a5a7fe53bda3cbce584280a177a18d5ab">isBlockValidForExtraction</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB,</Highlight></CodeLine>
<Link id="l00085" /><CodeLine lineNumber="85"><Highlight kind="normal">                                      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/setvector">SetVector&lt;BasicBlock &#42;&gt;</a> &amp;Result,</Highlight></CodeLine>
<Link id="l00086" /><CodeLine lineNumber="86"><Highlight kind="normal">                                      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllowVarArgs, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllowAlloca) &#123;</Highlight></CodeLine>
<Link id="l00087" /><CodeLine lineNumber="87"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// taking the address of a basic block moved to another function is illegal</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00088" /><CodeLine lineNumber="88"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB.<a href="/docs/api/classes/llvm/basicblock/#a315f26c899f5ea8a780db4740ba95ef4">hasAddressTaken</a>())</Highlight></CodeLine>
<Link id="l00089" /><CodeLine lineNumber="89"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00090" /><CodeLine lineNumber="90"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00091" /><CodeLine lineNumber="91"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// don&#39;t hoist code that uses another basicblock address, as it&#39;s likely to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00092" /><CodeLine lineNumber="92"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// lead to unexpected behavior, like cross-function jumps</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00093" /><CodeLine lineNumber="93"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;User const &#42;, 16&gt;</a> Visited;</Highlight></CodeLine>
<Link id="l00094" /><CodeLine lineNumber="94"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;User const &#42;, 16&gt;</a> ToVisit;</Highlight></CodeLine>
<Link id="l00095" /><CodeLine lineNumber="95"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00096" /><CodeLine lineNumber="96"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> &amp;Inst : BB)</Highlight></CodeLine>
<Link id="l00097" /><CodeLine lineNumber="97"><Highlight kind="normal">    ToVisit.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;Inst);</Highlight></CodeLine>
<Link id="l00098" /><CodeLine lineNumber="98"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00099" /><CodeLine lineNumber="99"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (!ToVisit.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l00100" /><CodeLine lineNumber="100"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/user">User</a> </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> &#42;Curr = ToVisit.<a href="/docs/api/classes/llvm/smallvectorimpl/#a0c8ffe664a36e30d49c84d0aded2fe08">pop&#95;back&#95;val</a>();</Highlight></CodeLine>
<Link id="l00101" /><CodeLine lineNumber="101"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Visited.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Curr).second)</Highlight></CodeLine>
<Link id="l00102" /><CodeLine lineNumber="102"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00103" /><CodeLine lineNumber="103"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;BlockAddress const&gt;</a>(Curr))</Highlight></CodeLine>
<Link id="l00104" /><CodeLine lineNumber="104"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">; </Highlight><Highlight kind="comment">// even a reference to self is likely to be not compatible</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00105" /><CodeLine lineNumber="105"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00106" /><CodeLine lineNumber="106"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(Curr) &amp;&amp; <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Curr)-&gt;<a href="/docs/api/files/lib/lib/analysis/basicaliasanalysis-cpp/#a1b8850f1ed44c12bc3501175a71c251c">getParent</a>() != &amp;BB)</Highlight></CodeLine>
<Link id="l00107" /><CodeLine lineNumber="107"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00108" /><CodeLine lineNumber="108"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00109" /><CodeLine lineNumber="109"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> &amp;U : Curr-&gt;<a href="/docs/api/classes/llvm/user/#a0b931781aa589c6ebe64a76c1447e5b2">operands</a>()) &#123;</Highlight></CodeLine>
<Link id="l00110" /><CodeLine lineNumber="110"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UU = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;User&gt;</a>(U))</Highlight></CodeLine>
<Link id="l00111" /><CodeLine lineNumber="111"><Highlight kind="normal">        ToVisit.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(UU);</Highlight></CodeLine>
<Link id="l00112" /><CodeLine lineNumber="112"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00113" /><CodeLine lineNumber="113"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00114" /><CodeLine lineNumber="114"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00115" /><CodeLine lineNumber="115"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If explicitly requested, allow vastart and alloca. For invoke instructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00116" /><CodeLine lineNumber="116"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// verify that extraction is valid.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00117" /><CodeLine lineNumber="117"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock/#a42a7d51fdde6913db72d098356c2c019">BasicBlock::const&#95;iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB.<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(), <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = BB.<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00118" /><CodeLine lineNumber="118"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00119" /><CodeLine lineNumber="119"><Highlight kind="normal">       </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AllowAlloca)</Highlight></CodeLine>
<Link id="l00120" /><CodeLine lineNumber="120"><Highlight kind="normal">         </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00121" /><CodeLine lineNumber="121"><Highlight kind="normal">       </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00122" /><CodeLine lineNumber="122"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00123" /><CodeLine lineNumber="123"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00124" /><CodeLine lineNumber="124"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00125" /><CodeLine lineNumber="125"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Unwind destination (either a landingpad, catchswitch, or cleanuppad)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00126" /><CodeLine lineNumber="126"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// must be a part of the subgraph which is being extracted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00127" /><CodeLine lineNumber="127"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UBB = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getUnwindDest())</Highlight></CodeLine>
<Link id="l00128" /><CodeLine lineNumber="128"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Result.count(UBB))</Highlight></CodeLine>
<Link id="l00129" /><CodeLine lineNumber="129"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00130" /><CodeLine lineNumber="130"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00131" /><CodeLine lineNumber="131"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00132" /><CodeLine lineNumber="132"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00133" /><CodeLine lineNumber="133"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// All catch handlers of a catchswitch instruction as well as the unwind</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00134" /><CodeLine lineNumber="134"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// destination must be in the subgraph.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00135" /><CodeLine lineNumber="135"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CSI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CatchSwitchInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00136" /><CodeLine lineNumber="136"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UBB = CSI-&gt;getUnwindDest())</Highlight></CodeLine>
<Link id="l00137" /><CodeLine lineNumber="137"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Result.count(UBB))</Highlight></CodeLine>
<Link id="l00138" /><CodeLine lineNumber="138"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00139" /><CodeLine lineNumber="139"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;HBB : CSI-&gt;handlers())</Highlight></CodeLine>
<Link id="l00140" /><CodeLine lineNumber="140"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Result.count(</Highlight><Highlight kind="keyword">const&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a>&#42;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(HBB)))</Highlight></CodeLine>
<Link id="l00141" /><CodeLine lineNumber="141"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00142" /><CodeLine lineNumber="142"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00143" /><CodeLine lineNumber="143"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00144" /><CodeLine lineNumber="144"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00145" /><CodeLine lineNumber="145"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Make sure that entire catch handler is within subgraph. It is sufficient</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00146" /><CodeLine lineNumber="146"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to check that catch return&#39;s block is in the list.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00147" /><CodeLine lineNumber="147"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CPI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CatchPadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00148" /><CodeLine lineNumber="148"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : CPI-&gt;users())</Highlight></CodeLine>
<Link id="l00149" /><CodeLine lineNumber="149"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CRI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CatchReturnInst&gt;</a>(U))</Highlight></CodeLine>
<Link id="l00150" /><CodeLine lineNumber="150"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Result.count(</Highlight><Highlight kind="keyword">const&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a>&#42;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(CRI-&gt;getParent())))</Highlight></CodeLine>
<Link id="l00151" /><CodeLine lineNumber="151"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00152" /><CodeLine lineNumber="152"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00153" /><CodeLine lineNumber="153"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00154" /><CodeLine lineNumber="154"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00155" /><CodeLine lineNumber="155"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// And do similar checks for cleanup handler - the entire handler must be</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00156" /><CodeLine lineNumber="156"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// in subgraph which is going to be extracted. For cleanup return should</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00157" /><CodeLine lineNumber="157"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// additionally check that the unwind destination is also in the subgraph.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00158" /><CodeLine lineNumber="158"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CPI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CleanupPadInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00159" /><CodeLine lineNumber="159"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;U : CPI-&gt;users())</Highlight></CodeLine>
<Link id="l00160" /><CodeLine lineNumber="160"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CRI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CleanupReturnInst&gt;</a>(U))</Highlight></CodeLine>
<Link id="l00161" /><CodeLine lineNumber="161"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Result.count(</Highlight><Highlight kind="keyword">const&#95;cast&lt;</Highlight><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a>&#42;</Highlight><Highlight kind="keyword">&gt;</Highlight><Highlight kind="normal">(CRI-&gt;getParent())))</Highlight></CodeLine>
<Link id="l00162" /><CodeLine lineNumber="162"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00163" /><CodeLine lineNumber="163"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00164" /><CodeLine lineNumber="164"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00165" /><CodeLine lineNumber="165"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;CRI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CleanupReturnInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00166" /><CodeLine lineNumber="166"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;UBB = CRI-&gt;getUnwindDest())</Highlight></CodeLine>
<Link id="l00167" /><CodeLine lineNumber="167"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Result.count(UBB))</Highlight></CodeLine>
<Link id="l00168" /><CodeLine lineNumber="168"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00169" /><CodeLine lineNumber="169"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00170" /><CodeLine lineNumber="170"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00171" /><CodeLine lineNumber="171"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00172" /><CodeLine lineNumber="172"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l00173" /><CodeLine lineNumber="173"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = CI-&gt;getCalledFunction()) &#123;</Highlight></CodeLine>
<Link id="l00174" /><CodeLine lineNumber="174"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IID = <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getIntrinsicID();</Highlight></CodeLine>
<Link id="l00175" /><CodeLine lineNumber="175"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IID == Intrinsic::vastart) &#123;</Highlight></CodeLine>
<Link id="l00176" /><CodeLine lineNumber="176"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AllowVarArgs)</Highlight></CodeLine>
<Link id="l00177" /><CodeLine lineNumber="177"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00178" /><CodeLine lineNumber="178"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00179" /><CodeLine lineNumber="179"><Highlight kind="normal">            </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00180" /><CodeLine lineNumber="180"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00181" /><CodeLine lineNumber="181"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00182" /><CodeLine lineNumber="182"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Currently, we miscompile outlined copies of eh&#95;typid&#95;for. There are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00183" /><CodeLine lineNumber="183"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// proposals for fixing this in llvm.org/PR39545.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00184" /><CodeLine lineNumber="184"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IID == Intrinsic::eh&#95;typeid&#95;for)</Highlight></CodeLine>
<Link id="l00185" /><CodeLine lineNumber="185"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00186" /><CodeLine lineNumber="186"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00187" /><CodeLine lineNumber="187"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00188" /><CodeLine lineNumber="188"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00189" /><CodeLine lineNumber="189"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00190" /><CodeLine lineNumber="190"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00191" /><CodeLine lineNumber="191"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00192" /><CodeLine lineNumber="192"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00193" /><CodeLine lineNumber="193"><Highlight kind="comment">/// Build a set of blocks to extract if the input blocks are viable.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00194" /><CodeLine lineNumber="194"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/setvector">SetVector&lt;BasicBlock &#42;&gt;</a></Highlight></CodeLine>
<Link id="l00195" /><CodeLine lineNumber="195" lineLink="#a10e1b14fd1da88aad682e5d70ab224bb"><Highlight kind="normal"><a href="#a10e1b14fd1da88aad682e5d70ab224bb">buildExtractionBlockSet</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;BasicBlock &#42;&gt;</a> BBs, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</Highlight></CodeLine>
<Link id="l00196" /><CodeLine lineNumber="196"><Highlight kind="normal">                        </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllowVarArgs, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllowAlloca) &#123;</Highlight></CodeLine>
<Link id="l00197" /><CodeLine lineNumber="197"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!BBs.<a href="/docs/api/classes/llvm/arrayref/#ac835b8735b1b2faec0efdca236e37d94">empty</a>() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;The set of blocks to extract must be non-empty&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00198" /><CodeLine lineNumber="198"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/setvector">SetVector&lt;BasicBlock &#42;&gt;</a> Result;</Highlight></CodeLine>
<Link id="l00199" /><CodeLine lineNumber="199"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00200" /><CodeLine lineNumber="200"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Loop over the blocks, adding them to our set-vector, and aborting with an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00201" /><CodeLine lineNumber="201"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// empty set if we encounter invalid blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00202" /><CodeLine lineNumber="202"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : BBs) &#123;</Highlight></CodeLine>
<Link id="l00203" /><CodeLine lineNumber="203"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If this block is dead, don&#39;t process it.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00204" /><CodeLine lineNumber="204"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DT &amp;&amp; !DT-&gt;<a href="/docs/api/classes/llvm/dominatortree/#a1a70f2c359aadd76a72aaaede16aca4a">isReachableFromEntry</a>(BB))</Highlight></CodeLine>
<Link id="l00205" /><CodeLine lineNumber="205"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00206" /><CodeLine lineNumber="206"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00207" /><CodeLine lineNumber="207"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Result.insert(BB))</Highlight></CodeLine>
<Link id="l00208" /><CodeLine lineNumber="208"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;Repeated basic blocks in extraction input&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00209" /><CodeLine lineNumber="209"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00210" /><CodeLine lineNumber="210"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00211" /><CodeLine lineNumber="211"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Region front block: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; Result.front()-&gt;getName()</Highlight></CodeLine>
<Link id="l00212" /><CodeLine lineNumber="212"><Highlight kind="normal">                    &lt;&lt; </Highlight><Highlight kind="charliteral">&#39;\\n&#39;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00213" /><CodeLine lineNumber="213"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00214" /><CodeLine lineNumber="214"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;BB : Result) &#123;</Highlight></CodeLine>
<Link id="l00215" /><CodeLine lineNumber="215"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a5a7fe53bda3cbce584280a177a18d5ab">isBlockValidForExtraction</a>(&#42;BB, Result, AllowVarArgs, AllowAlloca))</Highlight></CodeLine>
<Link id="l00216" /><CodeLine lineNumber="216"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;&#125;;</Highlight></CodeLine>
<Link id="l00217" /><CodeLine lineNumber="217"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00218" /><CodeLine lineNumber="218"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Make sure that the first block is not a landing pad.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00219" /><CodeLine lineNumber="219"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB == Result.front()) &#123;</Highlight></CodeLine>
<Link id="l00220" /><CodeLine lineNumber="220"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BB-&gt;isEHPad()) &#123;</Highlight></CodeLine>
<Link id="l00221" /><CodeLine lineNumber="221"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;The first block cannot be an unwind block\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00222" /><CodeLine lineNumber="222"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;&#125;;</Highlight></CodeLine>
<Link id="l00223" /><CodeLine lineNumber="223"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00224" /><CodeLine lineNumber="224"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00225" /><CodeLine lineNumber="225"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00226" /><CodeLine lineNumber="226"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00227" /><CodeLine lineNumber="227"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// All blocks other than the first must not have predecessors outside of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00228" /><CodeLine lineNumber="228"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the subgraph which is being extracted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00229" /><CodeLine lineNumber="229"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;PBB : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(BB))</Highlight></CodeLine>
<Link id="l00230" /><CodeLine lineNumber="230"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Result.count(PBB)) &#123;</Highlight></CodeLine>
<Link id="l00231" /><CodeLine lineNumber="231"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;No blocks in this region may have entries from &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00232" /><CodeLine lineNumber="232"><Highlight kind="normal">                             </Highlight><Highlight kind="stringliteral">&quot;outside the region except for the first block!\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00233" /><CodeLine lineNumber="233"><Highlight kind="normal">                          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Problematic source BB: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; BB-&gt;getName() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00234" /><CodeLine lineNumber="234"><Highlight kind="normal">                          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Problematic destination BB: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; PBB-&gt;getName()</Highlight></CodeLine>
<Link id="l00235" /><CodeLine lineNumber="235"><Highlight kind="normal">                          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00236" /><CodeLine lineNumber="236"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;&#125;;</Highlight></CodeLine>
<Link id="l00237" /><CodeLine lineNumber="237"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00238" /><CodeLine lineNumber="238"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00239" /><CodeLine lineNumber="239"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00240" /><CodeLine lineNumber="240"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Result;</Highlight></CodeLine>
<Link id="l00241" /><CodeLine lineNumber="241"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00242" /><CodeLine lineNumber="242"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00243" /><CodeLine lineNumber="243" lineLink="/docs/api/classes/llvm/codeextractor/#a152c260d40a85ed5b0ef5f11f86ac3b4"><Highlight kind="normal"><a href="/docs/api/classes/llvm/codeextractor/#a152c260d40a85ed5b0ef5f11f86ac3b4">CodeExtractor::CodeExtractor</a>(<a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;BasicBlock &#42;&gt;</a> BBs, <a href="/docs/api/classes/llvm/dominatortree">DominatorTree</a> &#42;DT,</Highlight></CodeLine>
<Link id="l00244" /><CodeLine lineNumber="244"><Highlight kind="normal">                             </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AggregateArgs, <a href="/docs/api/classes/llvm/blockfrequencyinfo">BlockFrequencyInfo</a> &#42;BFI,</Highlight></CodeLine>
<Link id="l00245" /><CodeLine lineNumber="245"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/branchprobabilityinfo">BranchProbabilityInfo</a> &#42;BPI, <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC,</Highlight></CodeLine>
<Link id="l00246" /><CodeLine lineNumber="246"><Highlight kind="normal">                             </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllowVarArgs, </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> AllowAlloca,</Highlight></CodeLine>
<Link id="l00247" /><CodeLine lineNumber="247"><Highlight kind="normal">                             <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;AllocationBlock, std::string Suffix,</Highlight></CodeLine>
<Link id="l00248" /><CodeLine lineNumber="248"><Highlight kind="normal">                             </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> ArgsInZeroAddressSpace)</Highlight></CodeLine>
<Link id="l00249" /><CodeLine lineNumber="249"><Highlight kind="normal">    : DT(DT), AggregateArgs(AggregateArgs || <a href="#ab04f4c20d718420071af11662817dbd4">AggregateArgsOpt</a>), BFI(BFI),</Highlight></CodeLine>
<Link id="l00250" /><CodeLine lineNumber="250"><Highlight kind="normal">      BPI(BPI), AC(AC), AllocationBlock(AllocationBlock),</Highlight></CodeLine>
<Link id="l00251" /><CodeLine lineNumber="251"><Highlight kind="normal">      AllowVarArgs(AllowVarArgs),</Highlight></CodeLine>
<Link id="l00252" /><CodeLine lineNumber="252"><Highlight kind="normal">      Blocks(<a href="#a10e1b14fd1da88aad682e5d70ab224bb">buildExtractionBlockSet</a>(BBs, DT, AllowVarArgs, AllowAlloca)),</Highlight></CodeLine>
<Link id="l00253" /><CodeLine lineNumber="253"><Highlight kind="normal">      Suffix(Suffix), ArgsInZeroAddressSpace(ArgsInZeroAddressSpace) &#123;&#125;</Highlight></CodeLine>
<Link id="l00254" /><CodeLine lineNumber="254"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00255" /><CodeLine lineNumber="255"><Highlight kind="comment">/// definedInRegion - Return true if the specified value is defined in the</Highlight></CodeLine>
<Link id="l00256" /><CodeLine lineNumber="256"><Highlight kind="comment">/// extracted region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00257" /><CodeLine lineNumber="257" lineLink="#a2b5ed2fba3b0aa877b82ba5d6f4131bf"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a2b5ed2fba3b0aa877b82ba5d6f4131bf">definedInRegion</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/setvector">SetVector&lt;BasicBlock &#42;&gt;</a> &amp;Blocks, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l00258" /><CodeLine lineNumber="258"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V))</Highlight></CodeLine>
<Link id="l00259" /><CodeLine lineNumber="259"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.<a href="/docs/api/classes/llvm/setvector/#abb03e3b6c4fd937936a13afe4f60d291">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()))</Highlight></CodeLine>
<Link id="l00260" /><CodeLine lineNumber="260"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00261" /><CodeLine lineNumber="261"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00262" /><CodeLine lineNumber="262"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00263" /><CodeLine lineNumber="263"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00264" /><CodeLine lineNumber="264"><Highlight kind="comment">/// definedInCaller - Return true if the specified value is defined in the</Highlight></CodeLine>
<Link id="l00265" /><CodeLine lineNumber="265"><Highlight kind="comment">/// function being code extracted, but not in the region being extracted.</Highlight></CodeLine>
<Link id="l00266" /><CodeLine lineNumber="266"><Highlight kind="comment">/// These values must be passed in as live-ins to the function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00267" /><CodeLine lineNumber="267" lineLink="#a4dde4d426caa9831108c7520128292e0"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="#a4dde4d426caa9831108c7520128292e0">definedInCaller</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/setvector">SetVector&lt;BasicBlock &#42;&gt;</a> &amp;Blocks, <a href="/docs/api/classes/llvm/value">Value</a> &#42;V) &#123;</Highlight></CodeLine>
<Link id="l00268" /><CodeLine lineNumber="268"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Argument&gt;</a>(V)) </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00269" /><CodeLine lineNumber="269"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(V))</Highlight></CodeLine>
<Link id="l00270" /><CodeLine lineNumber="270"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Blocks.<a href="/docs/api/classes/llvm/setvector/#abb03e3b6c4fd937936a13afe4f60d291">count</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()))</Highlight></CodeLine>
<Link id="l00271" /><CodeLine lineNumber="271"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00272" /><CodeLine lineNumber="272"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00273" /><CodeLine lineNumber="273"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00274" /><CodeLine lineNumber="274"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00275" /><CodeLine lineNumber="275" lineLink="#a8289e5f6e7e557759efb2b1b785c9196"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="#a8289e5f6e7e557759efb2b1b785c9196">getCommonExitBlock</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/setvector">SetVector&lt;BasicBlock &#42;&gt;</a> &amp;Blocks) &#123;</Highlight></CodeLine>
<Link id="l00276" /><CodeLine lineNumber="276"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CommonExitBlock = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00277" /><CodeLine lineNumber="277"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> hasNonCommonExitSucc = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>) &#123;</Highlight></CodeLine>
<Link id="l00278" /><CodeLine lineNumber="278"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>)) &#123;</Highlight></CodeLine>
<Link id="l00279" /><CodeLine lineNumber="279"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Internal edges, ok.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00280" /><CodeLine lineNumber="280"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.<a href="/docs/api/classes/llvm/setvector/#abb03e3b6c4fd937936a13afe4f60d291">count</a>(Succ))</Highlight></CodeLine>
<Link id="l00281" /><CodeLine lineNumber="281"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00282" /><CodeLine lineNumber="282"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!CommonExitBlock) &#123;</Highlight></CodeLine>
<Link id="l00283" /><CodeLine lineNumber="283"><Highlight kind="normal">        CommonExitBlock = Succ;</Highlight></CodeLine>
<Link id="l00284" /><CodeLine lineNumber="284"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00285" /><CodeLine lineNumber="285"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00286" /><CodeLine lineNumber="286"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CommonExitBlock != Succ)</Highlight></CodeLine>
<Link id="l00287" /><CodeLine lineNumber="287"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00288" /><CodeLine lineNumber="288"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00289" /><CodeLine lineNumber="289"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00290" /><CodeLine lineNumber="290"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00291" /><CodeLine lineNumber="291"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00292" /><CodeLine lineNumber="292"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(Blocks, hasNonCommonExitSucc))</Highlight></CodeLine>
<Link id="l00293" /><CodeLine lineNumber="293"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00294" /><CodeLine lineNumber="294"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00295" /><CodeLine lineNumber="295"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CommonExitBlock;</Highlight></CodeLine>
<Link id="l00296" /><CodeLine lineNumber="296"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00297" /><CodeLine lineNumber="297"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00298" /><CodeLine lineNumber="298" lineLink="/docs/api/classes/llvm/codeextractoranalysiscache/#a6c11ef80226655b08c6203641896fa50"><Highlight kind="normal"><a href="/docs/api/classes/llvm/codeextractoranalysiscache/#a6c11ef80226655b08c6203641896fa50">CodeExtractorAnalysisCache::CodeExtractorAnalysisCache</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l00299" /><CodeLine lineNumber="299"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l00300" /><CodeLine lineNumber="300"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : BB.instructionsWithoutDebug())</Highlight></CodeLine>
<Link id="l00301" /><CodeLine lineNumber="301"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>))</Highlight></CodeLine>
<Link id="l00302" /><CodeLine lineNumber="302"><Highlight kind="normal">        Allocas.push&#95;back(AI);</Highlight></CodeLine>
<Link id="l00303" /><CodeLine lineNumber="303"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00304" /><CodeLine lineNumber="304"><Highlight kind="normal">    findSideEffectInfoForBlock(BB);</Highlight></CodeLine>
<Link id="l00305" /><CodeLine lineNumber="305"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00306" /><CodeLine lineNumber="306"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00307" /><CodeLine lineNumber="307"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00308" /><CodeLine lineNumber="308"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> CodeExtractorAnalysisCache::findSideEffectInfoForBlock(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB) &#123;</Highlight></CodeLine>
<Link id="l00309" /><CodeLine lineNumber="309"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : BB.<a href="/docs/api/classes/llvm/basicblock/#a2069641f358ef416658a2f321ca19d74">instructionsWithoutDebug</a>()) &#123;</Highlight></CodeLine>
<Link id="l00310" /><CodeLine lineNumber="310"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> Opcode = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.getOpcode();</Highlight></CodeLine>
<Link id="l00311" /><CodeLine lineNumber="311"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/value">Value</a> &#42;MemAddr = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00312" /><CodeLine lineNumber="312"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (Opcode) &#123;</Highlight></CodeLine>
<Link id="l00313" /><CodeLine lineNumber="313"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Store:</Highlight></CodeLine>
<Link id="l00314" /><CodeLine lineNumber="314"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Instruction::Load: &#123;</Highlight></CodeLine>
<Link id="l00315" /><CodeLine lineNumber="315"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Opcode == Instruction::Store) &#123;</Highlight></CodeLine>
<Link id="l00316" /><CodeLine lineNumber="316"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/storeinst">StoreInst</a> &#42;<a href="/docs/api/namespaces/llvm/si">SI</a> = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;StoreInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l00317" /><CodeLine lineNumber="317"><Highlight kind="normal">        MemAddr = <a href="/docs/api/namespaces/llvm/si">SI</a>-&gt;getPointerOperand();</Highlight></CodeLine>
<Link id="l00318" /><CodeLine lineNumber="318"><Highlight kind="normal">      &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00319" /><CodeLine lineNumber="319"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/loadinst">LoadInst</a> &#42;LI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;LoadInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l00320" /><CodeLine lineNumber="320"><Highlight kind="normal">        MemAddr = LI-&gt;<a href="/docs/api/classes/llvm/loadinst/#a2d1ff28d6923802e165905b8d1766e76">getPointerOperand</a>();</Highlight></CodeLine>
<Link id="l00321" /><CodeLine lineNumber="321"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00322" /><CodeLine lineNumber="322"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Global variable can not be aliased with locals.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00323" /><CodeLine lineNumber="323"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(MemAddr))</Highlight></CodeLine>
<Link id="l00324" /><CodeLine lineNumber="324"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00325" /><CodeLine lineNumber="325"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a> = MemAddr-&gt;<a href="/docs/api/classes/llvm/value/#a3711f4a2446d9e9302ebfa2fb1180883">stripInBoundsConstantOffsets</a>();</Highlight></CodeLine>
<Link id="l00326" /><CodeLine lineNumber="326"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>)) &#123;</Highlight></CodeLine>
<Link id="l00327" /><CodeLine lineNumber="327"><Highlight kind="normal">        SideEffectingBlocks.insert(&amp;BB);</Highlight></CodeLine>
<Link id="l00328" /><CodeLine lineNumber="328"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00329" /><CodeLine lineNumber="329"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00330" /><CodeLine lineNumber="330"><Highlight kind="normal">      BaseMemAddrs&#91;&amp;BB&#93;.insert(<a href="/docs/api/namespaces/llvm/sampleprof/#a702f69807459cc25db5754a5f179d3fcaf6fbeb8fa9f451468611536b00878d41">Base</a>);</Highlight></CodeLine>
<Link id="l00331" /><CodeLine lineNumber="331"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00332" /><CodeLine lineNumber="332"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00333" /><CodeLine lineNumber="333"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">: &#123;</Highlight></CodeLine>
<Link id="l00334" /><CodeLine lineNumber="334"><Highlight kind="normal">      IntrinsicInst &#42;IntrInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l00335" /><CodeLine lineNumber="335"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IntrInst) &#123;</Highlight></CodeLine>
<Link id="l00336" /><CodeLine lineNumber="336"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IntrInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a185bafe1e8f07def76a3bac154a23e7a">isLifetimeStartOrEnd</a>())</Highlight></CodeLine>
<Link id="l00337" /><CodeLine lineNumber="337"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00338" /><CodeLine lineNumber="338"><Highlight kind="normal">        SideEffectingBlocks.insert(&amp;BB);</Highlight></CodeLine>
<Link id="l00339" /><CodeLine lineNumber="339"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00340" /><CodeLine lineNumber="340"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00341" /><CodeLine lineNumber="341"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Treat all the other cases conservatively if it has side effects.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00342" /><CodeLine lineNumber="342"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.mayHaveSideEffects()) &#123;</Highlight></CodeLine>
<Link id="l00343" /><CodeLine lineNumber="343"><Highlight kind="normal">        SideEffectingBlocks.insert(&amp;BB);</Highlight></CodeLine>
<Link id="l00344" /><CodeLine lineNumber="344"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00345" /><CodeLine lineNumber="345"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00346" /><CodeLine lineNumber="346"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00347" /><CodeLine lineNumber="347"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00348" /><CodeLine lineNumber="348"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00349" /><CodeLine lineNumber="349"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00350" /><CodeLine lineNumber="350"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00351" /><CodeLine lineNumber="351" lineLink="/docs/api/classes/llvm/codeextractoranalysiscache/#af0ee5fce396f816a21443799205fbedd"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/codeextractoranalysiscache/#af0ee5fce396f816a21443799205fbedd">CodeExtractorAnalysisCache::doesBlockContainClobberOfAddr</a>(</Highlight></CodeLine>
<Link id="l00352" /><CodeLine lineNumber="352"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB, <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;Addr)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00353" /><CodeLine lineNumber="353"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SideEffectingBlocks.count(&amp;BB))</Highlight></CodeLine>
<Link id="l00354" /><CodeLine lineNumber="354"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00355" /><CodeLine lineNumber="355"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> It = BaseMemAddrs.find(&amp;BB);</Highlight></CodeLine>
<Link id="l00356" /><CodeLine lineNumber="356"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (It != BaseMemAddrs.end())</Highlight></CodeLine>
<Link id="l00357" /><CodeLine lineNumber="357"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> It-&gt;second.count(Addr);</Highlight></CodeLine>
<Link id="l00358" /><CodeLine lineNumber="358"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00359" /><CodeLine lineNumber="359"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00360" /><CodeLine lineNumber="360"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00361" /><CodeLine lineNumber="361" lineLink="/docs/api/classes/llvm/codeextractor/#ae9ce92095ff18cb2c607d5a3591703ca"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/codeextractor/#ae9ce92095ff18cb2c607d5a3591703ca">CodeExtractor::isLegalToShrinkwrapLifetimeMarkers</a>(</Highlight></CodeLine>
<Link id="l00362" /><CodeLine lineNumber="362"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/codeextractoranalysiscache">CodeExtractorAnalysisCache</a> &amp;CEAC, <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Addr)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00363" /><CodeLine lineNumber="363"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;AllocaInst&gt;</a>(Addr-&gt;<a href="/docs/api/classes/llvm/value/#a3711f4a2446d9e9302ebfa2fb1180883">stripInBoundsConstantOffsets</a>());</Highlight></CodeLine>
<Link id="l00364" /><CodeLine lineNumber="364"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Func = (&#42;Blocks.begin())-&gt;getParent();</Highlight></CodeLine>
<Link id="l00365" /><CodeLine lineNumber="365"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &amp;BB : &#42;Func) &#123;</Highlight></CodeLine>
<Link id="l00366" /><CodeLine lineNumber="366"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.count(&amp;BB))</Highlight></CodeLine>
<Link id="l00367" /><CodeLine lineNumber="367"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00368" /><CodeLine lineNumber="368"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (CEAC.<a href="/docs/api/classes/llvm/codeextractoranalysiscache/#af0ee5fce396f816a21443799205fbedd">doesBlockContainClobberOfAddr</a>(BB, AI))</Highlight></CodeLine>
<Link id="l00369" /><CodeLine lineNumber="369"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00370" /><CodeLine lineNumber="370"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00371" /><CodeLine lineNumber="371"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00372" /><CodeLine lineNumber="372"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00373" /><CodeLine lineNumber="373"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00374" /><CodeLine lineNumber="374"><Highlight kind="normal"><a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;</Highlight></CodeLine>
<Link id="l00375" /><CodeLine lineNumber="375" lineLink="/docs/api/classes/llvm/codeextractor/#a19ce83f3f1fef433e2ba91a0b2a196a0"><Highlight kind="normal"><a href="/docs/api/classes/llvm/codeextractor/#a19ce83f3f1fef433e2ba91a0b2a196a0">CodeExtractor::findOrCreateBlockForHoisting</a>(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CommonExitBlock) &#123;</Highlight></CodeLine>
<Link id="l00376" /><CodeLine lineNumber="376"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;SinglePredFromOutlineRegion = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00377" /><CodeLine lineNumber="377"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!Blocks.count(CommonExitBlock) &amp;&amp;</Highlight></CodeLine>
<Link id="l00378" /><CodeLine lineNumber="378"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Expect a block outside the region!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00379" /><CodeLine lineNumber="379"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(CommonExitBlock)) &#123;</Highlight></CodeLine>
<Link id="l00380" /><CodeLine lineNumber="380"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Blocks.count(Pred))</Highlight></CodeLine>
<Link id="l00381" /><CodeLine lineNumber="381"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00382" /><CodeLine lineNumber="382"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SinglePredFromOutlineRegion) &#123;</Highlight></CodeLine>
<Link id="l00383" /><CodeLine lineNumber="383"><Highlight kind="normal">      SinglePredFromOutlineRegion = Pred;</Highlight></CodeLine>
<Link id="l00384" /><CodeLine lineNumber="384"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SinglePredFromOutlineRegion != Pred) &#123;</Highlight></CodeLine>
<Link id="l00385" /><CodeLine lineNumber="385"><Highlight kind="normal">      SinglePredFromOutlineRegion = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00386" /><CodeLine lineNumber="386"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00387" /><CodeLine lineNumber="387"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00388" /><CodeLine lineNumber="388"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00389" /><CodeLine lineNumber="389"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00390" /><CodeLine lineNumber="390"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SinglePredFromOutlineRegion)</Highlight></CodeLine>
<Link id="l00391" /><CodeLine lineNumber="391"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> SinglePredFromOutlineRegion;</Highlight></CodeLine>
<Link id="l00392" /><CodeLine lineNumber="392"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00393" /><CodeLine lineNumber="393"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#ifndef NDEBUG</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00394" /><CodeLine lineNumber="394"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> getFirstPHI = &#91;&#93;(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l00395" /><CodeLine lineNumber="395"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</Highlight></CodeLine>
<Link id="l00396" /><CodeLine lineNumber="396"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;FirstPhi = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00397" /><CodeLine lineNumber="397"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>()) &#123;</Highlight></CodeLine>
<Link id="l00398" /><CodeLine lineNumber="398"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00399" /><CodeLine lineNumber="399"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Phi)</Highlight></CodeLine>
<Link id="l00400" /><CodeLine lineNumber="400"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00401" /><CodeLine lineNumber="401"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!FirstPhi) &#123;</Highlight></CodeLine>
<Link id="l00402" /><CodeLine lineNumber="402"><Highlight kind="normal">        FirstPhi = Phi;</Highlight></CodeLine>
<Link id="l00403" /><CodeLine lineNumber="403"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00404" /><CodeLine lineNumber="404"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00405" /><CodeLine lineNumber="405"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00406" /><CodeLine lineNumber="406"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> FirstPhi;</Highlight></CodeLine>
<Link id="l00407" /><CodeLine lineNumber="407"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00408" /><CodeLine lineNumber="408"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If there are any phi nodes, the single pred either exists or has already</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00409" /><CodeLine lineNumber="409"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// be created before code extraction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00410" /><CodeLine lineNumber="410"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(!getFirstPHI(CommonExitBlock) &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Phi not expected&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00411" /><CodeLine lineNumber="411"><Highlight kind="normal"></Highlight><Highlight kind="preprocessor">#endif</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00412" /><CodeLine lineNumber="412"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00413" /><CodeLine lineNumber="413"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewExitBlock =</Highlight></CodeLine>
<Link id="l00414" /><CodeLine lineNumber="414"><Highlight kind="normal">      CommonExitBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a52c990590792c91dd20b6d45acebe359">splitBasicBlock</a>(CommonExitBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>());</Highlight></CodeLine>
<Link id="l00415" /><CodeLine lineNumber="415"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00416" /><CodeLine lineNumber="416"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred :</Highlight></CodeLine>
<Link id="l00417" /><CodeLine lineNumber="417"><Highlight kind="normal">       <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(CommonExitBlock))) &#123;</Highlight></CodeLine>
<Link id="l00418" /><CodeLine lineNumber="418"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.count(Pred))</Highlight></CodeLine>
<Link id="l00419" /><CodeLine lineNumber="419"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00420" /><CodeLine lineNumber="420"><Highlight kind="normal">    Pred-&gt;getTerminator()-&gt;replaceUsesOfWith(CommonExitBlock, NewExitBlock);</Highlight></CodeLine>
<Link id="l00421" /><CodeLine lineNumber="421"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00422" /><CodeLine lineNumber="422"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now add the old exit block to the outline region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00423" /><CodeLine lineNumber="423"><Highlight kind="normal">  Blocks.insert(CommonExitBlock);</Highlight></CodeLine>
<Link id="l00424" /><CodeLine lineNumber="424"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> CommonExitBlock;</Highlight></CodeLine>
<Link id="l00425" /><CodeLine lineNumber="425"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00426" /><CodeLine lineNumber="426"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00427" /><CodeLine lineNumber="427"><Highlight kind="normal"></Highlight><Highlight kind="comment">// Find the pair of life time markers for address &#39;Addr&#39; that are either</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00428" /><CodeLine lineNumber="428"><Highlight kind="normal"></Highlight><Highlight kind="comment">// defined inside the outline region or can legally be shrinkwrapped into the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00429" /><CodeLine lineNumber="429"><Highlight kind="normal"></Highlight><Highlight kind="comment">// outline region. If there are not other untracked uses of the address, return</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00430" /><CodeLine lineNumber="430"><Highlight kind="normal"></Highlight><Highlight kind="comment">// the pair of markers if found; otherwise return a pair of nullptr.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00431" /><CodeLine lineNumber="431"><Highlight kind="normal">CodeExtractor::LifetimeMarkerInfo</Highlight></CodeLine>
<Link id="l00432" /><CodeLine lineNumber="432"><Highlight kind="normal">CodeExtractor::getLifetimeMarkers(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/codeextractoranalysiscache">CodeExtractorAnalysisCache</a> &amp;CEAC,</Highlight></CodeLine>
<Link id="l00433" /><CodeLine lineNumber="433"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Addr,</Highlight></CodeLine>
<Link id="l00434" /><CodeLine lineNumber="434"><Highlight kind="normal">                                  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ExitBlock)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00435" /><CodeLine lineNumber="435"><Highlight kind="normal">  LifetimeMarkerInfo Info;</Highlight></CodeLine>
<Link id="l00436" /><CodeLine lineNumber="436"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00437" /><CodeLine lineNumber="437"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : Addr-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l00438" /><CodeLine lineNumber="438"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;IntrInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(U);</Highlight></CodeLine>
<Link id="l00439" /><CodeLine lineNumber="439"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IntrInst) &#123;</Highlight></CodeLine>
<Link id="l00440" /><CodeLine lineNumber="440"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We don&#39;t model addresses with multiple start/end markers, but the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00441" /><CodeLine lineNumber="441"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// markers do not need to be in the region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00442" /><CodeLine lineNumber="442"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IntrInst-&gt;<a href="/docs/api/classes/llvm/intrinsicinst/#a7ff64b3625b6f9020556ed05a5f72af4">getIntrinsicID</a>() == Intrinsic::lifetime&#95;start) &#123;</Highlight></CodeLine>
<Link id="l00443" /><CodeLine lineNumber="443"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Info.LifeStart)</Highlight></CodeLine>
<Link id="l00444" /><CodeLine lineNumber="444"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;&#125;;</Highlight></CodeLine>
<Link id="l00445" /><CodeLine lineNumber="445"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.LifeStart = IntrInst;</Highlight></CodeLine>
<Link id="l00446" /><CodeLine lineNumber="446"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00447" /><CodeLine lineNumber="447"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00448" /><CodeLine lineNumber="448"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IntrInst-&gt;<a href="/docs/api/classes/llvm/intrinsicinst/#a7ff64b3625b6f9020556ed05a5f72af4">getIntrinsicID</a>() == Intrinsic::lifetime&#95;end) &#123;</Highlight></CodeLine>
<Link id="l00449" /><CodeLine lineNumber="449"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.LifeEnd)</Highlight></CodeLine>
<Link id="l00450" /><CodeLine lineNumber="450"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;&#125;;</Highlight></CodeLine>
<Link id="l00451" /><CodeLine lineNumber="451"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.LifeEnd = IntrInst;</Highlight></CodeLine>
<Link id="l00452" /><CodeLine lineNumber="452"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00453" /><CodeLine lineNumber="453"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00454" /><CodeLine lineNumber="454"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// At this point, permit debug uses outside of the region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00455" /><CodeLine lineNumber="455"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// This is fixed in a later call to fixupDebugInfoPostExtraction().</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00456" /><CodeLine lineNumber="456"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(IntrInst))</Highlight></CodeLine>
<Link id="l00457" /><CodeLine lineNumber="457"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00458" /><CodeLine lineNumber="458"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00459" /><CodeLine lineNumber="459"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Find untracked uses of the address, bail.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00460" /><CodeLine lineNumber="460"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a2b5ed2fba3b0aa877b82ba5d6f4131bf">definedInRegion</a>(Blocks, U))</Highlight></CodeLine>
<Link id="l00461" /><CodeLine lineNumber="461"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;&#125;;</Highlight></CodeLine>
<Link id="l00462" /><CodeLine lineNumber="462"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00463" /><CodeLine lineNumber="463"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00464" /><CodeLine lineNumber="464"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.LifeStart || !<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.LifeEnd)</Highlight></CodeLine>
<Link id="l00465" /><CodeLine lineNumber="465"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;&#125;;</Highlight></CodeLine>
<Link id="l00466" /><CodeLine lineNumber="466"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00467" /><CodeLine lineNumber="467"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.SinkLifeStart = !<a href="#a2b5ed2fba3b0aa877b82ba5d6f4131bf">definedInRegion</a>(Blocks, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.LifeStart);</Highlight></CodeLine>
<Link id="l00468" /><CodeLine lineNumber="468"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.HoistLifeEnd = !<a href="#a2b5ed2fba3b0aa877b82ba5d6f4131bf">definedInRegion</a>(Blocks, <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.LifeEnd);</Highlight></CodeLine>
<Link id="l00469" /><CodeLine lineNumber="469"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Do legality check.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00470" /><CodeLine lineNumber="470"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> ((<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.SinkLifeStart || <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.HoistLifeEnd) &amp;&amp;</Highlight></CodeLine>
<Link id="l00471" /><CodeLine lineNumber="471"><Highlight kind="normal">      !<a href="/docs/api/classes/llvm/codeextractor/#ae9ce92095ff18cb2c607d5a3591703ca">isLegalToShrinkwrapLifetimeMarkers</a>(CEAC, Addr))</Highlight></CodeLine>
<Link id="l00472" /><CodeLine lineNumber="472"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;&#125;;</Highlight></CodeLine>
<Link id="l00473" /><CodeLine lineNumber="473"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00474" /><CodeLine lineNumber="474"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check to see if we have a place to do hoisting, if not, bail.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00475" /><CodeLine lineNumber="475"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>.HoistLifeEnd &amp;&amp; !ExitBlock)</Highlight></CodeLine>
<Link id="l00476" /><CodeLine lineNumber="476"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> &#123;&#125;;</Highlight></CodeLine>
<Link id="l00477" /><CodeLine lineNumber="477"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00478" /><CodeLine lineNumber="478"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/cseinfo-cpp/#a75f8a8519c2c9b30e7c06dc5e256fffa">Info</a>;</Highlight></CodeLine>
<Link id="l00479" /><CodeLine lineNumber="479"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00480" /><CodeLine lineNumber="480"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00481" /><CodeLine lineNumber="481" lineLink="/docs/api/classes/llvm/codeextractor/#a537993928c8af5b0d064fcd5ce1dec2f"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/codeextractor/#a537993928c8af5b0d064fcd5ce1dec2f">CodeExtractor::findAllocas</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/codeextractoranalysiscache">CodeExtractorAnalysisCache</a> &amp;CEAC,</Highlight></CodeLine>
<Link id="l00482" /><CodeLine lineNumber="482"><Highlight kind="normal">                                ValueSet &amp;SinkCands, ValueSet &amp;HoistCands,</Highlight></CodeLine>
<Link id="l00483" /><CodeLine lineNumber="483"><Highlight kind="normal">                                <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;&amp;ExitBlock)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00484" /><CodeLine lineNumber="484"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;Func = (&#42;Blocks.begin())-&gt;getParent();</Highlight></CodeLine>
<Link id="l00485" /><CodeLine lineNumber="485"><Highlight kind="normal">  ExitBlock = <a href="#a8289e5f6e7e557759efb2b1b785c9196">getCommonExitBlock</a>(Blocks);</Highlight></CodeLine>
<Link id="l00486" /><CodeLine lineNumber="486"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00487" /><CodeLine lineNumber="487"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> moveOrIgnoreLifetimeMarkers =</Highlight></CodeLine>
<Link id="l00488" /><CodeLine lineNumber="488"><Highlight kind="normal">      &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> LifetimeMarkerInfo &amp;LMI) -&gt; </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l00489" /><CodeLine lineNumber="489"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LMI.LifeStart)</Highlight></CodeLine>
<Link id="l00490" /><CodeLine lineNumber="490"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00491" /><CodeLine lineNumber="491"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LMI.SinkLifeStart) &#123;</Highlight></CodeLine>
<Link id="l00492" /><CodeLine lineNumber="492"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Sinking lifetime.start: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;LMI.LifeStart</Highlight></CodeLine>
<Link id="l00493" /><CodeLine lineNumber="493"><Highlight kind="normal">                        &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00494" /><CodeLine lineNumber="494"><Highlight kind="normal">      SinkCands.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(LMI.LifeStart);</Highlight></CodeLine>
<Link id="l00495" /><CodeLine lineNumber="495"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00496" /><CodeLine lineNumber="496"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LMI.HoistLifeEnd) &#123;</Highlight></CodeLine>
<Link id="l00497" /><CodeLine lineNumber="497"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Hoisting lifetime.end: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;LMI.LifeEnd &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00498" /><CodeLine lineNumber="498"><Highlight kind="normal">      HoistCands.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(LMI.LifeEnd);</Highlight></CodeLine>
<Link id="l00499" /><CodeLine lineNumber="499"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00500" /><CodeLine lineNumber="500"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00501" /><CodeLine lineNumber="501"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l00502" /><CodeLine lineNumber="502"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00503" /><CodeLine lineNumber="503"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Look up allocas in the original function in CodeExtractorAnalysisCache, as</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00504" /><CodeLine lineNumber="504"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// this is much faster than walking all the instructions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00505" /><CodeLine lineNumber="505"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/allocainst">AllocaInst</a> &#42;AI : CEAC.<a href="/docs/api/classes/llvm/codeextractoranalysiscache/#a35fd9ad0c2debb7b171f4c61ce7bdac6">getAllocas</a>()) &#123;</Highlight></CodeLine>
<Link id="l00506" /><CodeLine lineNumber="506"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB = AI-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l00507" /><CodeLine lineNumber="507"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.count(BB))</Highlight></CodeLine>
<Link id="l00508" /><CodeLine lineNumber="508"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00509" /><CodeLine lineNumber="509"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00510" /><CodeLine lineNumber="510"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// As a prior call to extractCodeRegion() may have shrinkwrapped the alloca,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00511" /><CodeLine lineNumber="511"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// check whether it is actually still in the original function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00512" /><CodeLine lineNumber="512"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;AIFunc = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l00513" /><CodeLine lineNumber="513"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AIFunc != Func)</Highlight></CodeLine>
<Link id="l00514" /><CodeLine lineNumber="514"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00515" /><CodeLine lineNumber="515"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00516" /><CodeLine lineNumber="516"><Highlight kind="normal">    LifetimeMarkerInfo MarkerInfo = getLifetimeMarkers(CEAC, AI, ExitBlock);</Highlight></CodeLine>
<Link id="l00517" /><CodeLine lineNumber="517"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> Moved = moveOrIgnoreLifetimeMarkers(MarkerInfo);</Highlight></CodeLine>
<Link id="l00518" /><CodeLine lineNumber="518"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Moved) &#123;</Highlight></CodeLine>
<Link id="l00519" /><CodeLine lineNumber="519"><Highlight kind="normal">      <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Sinking alloca: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;AI &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00520" /><CodeLine lineNumber="520"><Highlight kind="normal">      SinkCands.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(AI);</Highlight></CodeLine>
<Link id="l00521" /><CodeLine lineNumber="521"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00522" /><CodeLine lineNumber="522"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00523" /><CodeLine lineNumber="523"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00524" /><CodeLine lineNumber="524"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Find bitcasts in the outlined region that have lifetime marker users</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00525" /><CodeLine lineNumber="525"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// outside that region. Replace the lifetime marker use with an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00526" /><CodeLine lineNumber="526"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// outside region bitcast to avoid unnecessary alloca/reload instructions</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00527" /><CodeLine lineNumber="527"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// and extra lifetime markers.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00528" /><CodeLine lineNumber="528"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 2&gt;</a> LifetimeBitcastUsers;</Highlight></CodeLine>
<Link id="l00529" /><CodeLine lineNumber="529"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : AI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l00530" /><CodeLine lineNumber="530"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a2b5ed2fba3b0aa877b82ba5d6f4131bf">definedInRegion</a>(Blocks, U))</Highlight></CodeLine>
<Link id="l00531" /><CodeLine lineNumber="531"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00532" /><CodeLine lineNumber="532"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00533" /><CodeLine lineNumber="533"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (U-&gt;stripInBoundsConstantOffsets() != AI)</Highlight></CodeLine>
<Link id="l00534" /><CodeLine lineNumber="534"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00535" /><CodeLine lineNumber="535"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00536" /><CodeLine lineNumber="536"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Bitcast = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l00537" /><CodeLine lineNumber="537"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;BU : Bitcast-&gt;users()) &#123;</Highlight></CodeLine>
<Link id="l00538" /><CodeLine lineNumber="538"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;IntrInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(BU);</Highlight></CodeLine>
<Link id="l00539" /><CodeLine lineNumber="539"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IntrInst)</Highlight></CodeLine>
<Link id="l00540" /><CodeLine lineNumber="540"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00541" /><CodeLine lineNumber="541"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00542" /><CodeLine lineNumber="542"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IntrInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a185bafe1e8f07def76a3bac154a23e7a">isLifetimeStartOrEnd</a>())</Highlight></CodeLine>
<Link id="l00543" /><CodeLine lineNumber="543"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00544" /><CodeLine lineNumber="544"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00545" /><CodeLine lineNumber="545"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="#a2b5ed2fba3b0aa877b82ba5d6f4131bf">definedInRegion</a>(Blocks, IntrInst))</Highlight></CodeLine>
<Link id="l00546" /><CodeLine lineNumber="546"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00547" /><CodeLine lineNumber="547"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00548" /><CodeLine lineNumber="548"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Replace use of extracted region bitcast&quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00549" /><CodeLine lineNumber="549"><Highlight kind="normal">                          &lt;&lt; &#42;Bitcast &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; in out-of-region lifetime marker &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00550" /><CodeLine lineNumber="550"><Highlight kind="normal">                          &lt;&lt; &#42;IntrInst &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00551" /><CodeLine lineNumber="551"><Highlight kind="normal">        LifetimeBitcastUsers.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(IntrInst);</Highlight></CodeLine>
<Link id="l00552" /><CodeLine lineNumber="552"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00553" /><CodeLine lineNumber="553"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00554" /><CodeLine lineNumber="554"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00555" /><CodeLine lineNumber="555"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : LifetimeBitcastUsers) &#123;</Highlight></CodeLine>
<Link id="l00556" /><CodeLine lineNumber="556"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/module">Module</a> &#42;M = AIFunc-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>();</Highlight></CodeLine>
<Link id="l00557" /><CodeLine lineNumber="557"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = M-&gt;getContext();</Highlight></CodeLine>
<Link id="l00558" /><CodeLine lineNumber="558"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Int8PtrTy = <a href="/docs/api/classes/llvm/pointertype/#af8a1dbdbfd89aa4899b3c0d39495d0dd">PointerType::getUnqual</a>(Ctx);</Highlight></CodeLine>
<Link id="l00559" /><CodeLine lineNumber="559"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/castinst">CastInst</a> &#42;CastI =</Highlight></CodeLine>
<Link id="l00560" /><CodeLine lineNumber="560"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/castinst/#ac120250caf531b58acce9d8cc34c7032">CastInst::CreatePointerCast</a>(AI, Int8PtrTy, </Highlight><Highlight kind="stringliteral">&quot;lt.cast&quot;</Highlight><Highlight kind="normal">, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getIterator());</Highlight></CodeLine>
<Link id="l00561" /><CodeLine lineNumber="561"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceUsesOfWith(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(1), CastI);</Highlight></CodeLine>
<Link id="l00562" /><CodeLine lineNumber="562"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00563" /><CodeLine lineNumber="563"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00564" /><CodeLine lineNumber="564"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Follow any bitcasts.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00565" /><CodeLine lineNumber="565"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 2&gt;</a> Bitcasts;</Highlight></CodeLine>
<Link id="l00566" /><CodeLine lineNumber="566"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;LifetimeMarkerInfo, 2&gt;</a> BitcastLifetimeInfo;</Highlight></CodeLine>
<Link id="l00567" /><CodeLine lineNumber="567"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : AI-&gt;<a href="/docs/api/classes/llvm/value/#a411cf3e3932f209ce3374cb31adc1da6">users</a>()) &#123;</Highlight></CodeLine>
<Link id="l00568" /><CodeLine lineNumber="568"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (U-&gt;stripInBoundsConstantOffsets() == AI) &#123;</Highlight></CodeLine>
<Link id="l00569" /><CodeLine lineNumber="569"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Bitcast = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l00570" /><CodeLine lineNumber="570"><Highlight kind="normal">        LifetimeMarkerInfo LMI = getLifetimeMarkers(CEAC, Bitcast, ExitBlock);</Highlight></CodeLine>
<Link id="l00571" /><CodeLine lineNumber="571"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LMI.LifeStart) &#123;</Highlight></CodeLine>
<Link id="l00572" /><CodeLine lineNumber="572"><Highlight kind="normal">          Bitcasts.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(Bitcast);</Highlight></CodeLine>
<Link id="l00573" /><CodeLine lineNumber="573"><Highlight kind="normal">          BitcastLifetimeInfo.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(LMI);</Highlight></CodeLine>
<Link id="l00574" /><CodeLine lineNumber="574"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00575" /><CodeLine lineNumber="575"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00576" /><CodeLine lineNumber="576"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00577" /><CodeLine lineNumber="577"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00578" /><CodeLine lineNumber="578"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Found unknown use of AI.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00579" /><CodeLine lineNumber="579"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a2b5ed2fba3b0aa877b82ba5d6f4131bf">definedInRegion</a>(Blocks, U)) &#123;</Highlight></CodeLine>
<Link id="l00580" /><CodeLine lineNumber="580"><Highlight kind="normal">        Bitcasts.<a href="/docs/api/classes/llvm/smallvectorimpl/#aac0ea55010b7b1a301e65a0baea057aa">clear</a>();</Highlight></CodeLine>
<Link id="l00581" /><CodeLine lineNumber="581"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00582" /><CodeLine lineNumber="582"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00583" /><CodeLine lineNumber="583"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00584" /><CodeLine lineNumber="584"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00585" /><CodeLine lineNumber="585"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Either no bitcasts reference the alloca or there are unknown uses.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00586" /><CodeLine lineNumber="586"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Bitcasts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#ad9a3c7bc26b130377bbafc170b5f88a2">empty</a>())</Highlight></CodeLine>
<Link id="l00587" /><CodeLine lineNumber="587"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00588" /><CodeLine lineNumber="588"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00589" /><CodeLine lineNumber="589"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Sinking alloca (via bitcast): &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;AI &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00590" /><CodeLine lineNumber="590"><Highlight kind="normal">    SinkCands.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(AI);</Highlight></CodeLine>
<Link id="l00591" /><CodeLine lineNumber="591"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, E = Bitcasts.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> != E; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00592" /><CodeLine lineNumber="592"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;BitcastAddr = Bitcasts&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l00593" /><CodeLine lineNumber="593"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> LifetimeMarkerInfo &amp;LMI = BitcastLifetimeInfo&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l00594" /><CodeLine lineNumber="594"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(LMI.LifeStart &amp;&amp;</Highlight></CodeLine>
<Link id="l00595" /><CodeLine lineNumber="595"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Unsafe to sink bitcast without lifetime markers&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00596" /><CodeLine lineNumber="596"><Highlight kind="normal">      moveOrIgnoreLifetimeMarkers(LMI);</Highlight></CodeLine>
<Link id="l00597" /><CodeLine lineNumber="597"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a2b5ed2fba3b0aa877b82ba5d6f4131bf">definedInRegion</a>(Blocks, BitcastAddr)) &#123;</Highlight></CodeLine>
<Link id="l00598" /><CodeLine lineNumber="598"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Sinking bitcast-of-alloca: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;BitcastAddr</Highlight></CodeLine>
<Link id="l00599" /><CodeLine lineNumber="599"><Highlight kind="normal">                          &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00600" /><CodeLine lineNumber="600"><Highlight kind="normal">        SinkCands.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(BitcastAddr);</Highlight></CodeLine>
<Link id="l00601" /><CodeLine lineNumber="601"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00602" /><CodeLine lineNumber="602"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00603" /><CodeLine lineNumber="603"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00604" /><CodeLine lineNumber="604"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00605" /><CodeLine lineNumber="605"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00606" /><CodeLine lineNumber="606" lineLink="/docs/api/classes/llvm/codeextractor/#ad3a4770e725305d3529cba8c6562c85a"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/codeextractor/#ad3a4770e725305d3529cba8c6562c85a">CodeExtractor::isEligible</a>()</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00607" /><CodeLine lineNumber="607"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.empty())</Highlight></CodeLine>
<Link id="l00608" /><CodeLine lineNumber="608"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00609" /><CodeLine lineNumber="609"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Header = &#42;Blocks.<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</Highlight></CodeLine>
<Link id="l00610" /><CodeLine lineNumber="610"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a> = Header-&gt;getParent();</Highlight></CodeLine>
<Link id="l00611" /><CodeLine lineNumber="611"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00612" /><CodeLine lineNumber="612"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// For functions with varargs, check that varargs handling is only done in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00613" /><CodeLine lineNumber="613"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// outlined function, i.e vastart and vaend are only used in outlined blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00614" /><CodeLine lineNumber="614"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AllowVarArgs &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>-&gt;getFunctionType()-&gt;isVarArg()) &#123;</Highlight></CodeLine>
<Link id="l00615" /><CodeLine lineNumber="615"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> containsVarArgIntrinsic = &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l00616" /><CodeLine lineNumber="616"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;CallInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l00617" /><CodeLine lineNumber="617"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &#42;Callee = CI-&gt;getCalledFunction())</Highlight></CodeLine>
<Link id="l00618" /><CodeLine lineNumber="618"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> Callee-&gt;getIntrinsicID() == Intrinsic::vastart ||</Highlight></CodeLine>
<Link id="l00619" /><CodeLine lineNumber="619"><Highlight kind="normal">                 Callee-&gt;getIntrinsicID() == Intrinsic::vaend;</Highlight></CodeLine>
<Link id="l00620" /><CodeLine lineNumber="620"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00621" /><CodeLine lineNumber="621"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l00622" /><CodeLine lineNumber="622"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00623" /><CodeLine lineNumber="623"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;BB : &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l00624" /><CodeLine lineNumber="624"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.count(&amp;BB))</Highlight></CodeLine>
<Link id="l00625" /><CodeLine lineNumber="625"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00626" /><CodeLine lineNumber="626"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">llvm::any&#95;of</a>(BB, containsVarArgIntrinsic))</Highlight></CodeLine>
<Link id="l00627" /><CodeLine lineNumber="627"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00628" /><CodeLine lineNumber="628"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00629" /><CodeLine lineNumber="629"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00630" /><CodeLine lineNumber="630"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// stacksave as input implies stackrestore in the outlined function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00631" /><CodeLine lineNumber="631"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This can confuse prolog epilog insertion phase.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00632" /><CodeLine lineNumber="632"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// stacksave&#39;s uses must not cross outlined function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00633" /><CodeLine lineNumber="633"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : Blocks) &#123;</Highlight></CodeLine>
<Link id="l00634" /><CodeLine lineNumber="634"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l00635" /><CodeLine lineNumber="635"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/intrinsicinst">IntrinsicInst</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l00636" /><CodeLine lineNumber="636"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)</Highlight></CodeLine>
<Link id="l00637" /><CodeLine lineNumber="637"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00638" /><CodeLine lineNumber="638"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsSave = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::stacksave;</Highlight></CodeLine>
<Link id="l00639" /><CodeLine lineNumber="639"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsRestore = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::stackrestore;</Highlight></CodeLine>
<Link id="l00640" /><CodeLine lineNumber="640"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsSave &amp;&amp; <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;users(), &#91;&amp;Blks = this-&gt;Blocks&#93;(<a href="/docs/api/classes/llvm/user">User</a> &#42;U) &#123;</Highlight></CodeLine>
<Link id="l00641" /><CodeLine lineNumber="641"><Highlight kind="normal">            return !definedInRegion(Blks, U);</Highlight></CodeLine>
<Link id="l00642" /><CodeLine lineNumber="642"><Highlight kind="normal">          &#125;))</Highlight></CodeLine>
<Link id="l00643" /><CodeLine lineNumber="643"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00644" /><CodeLine lineNumber="644"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsRestore &amp;&amp; !<a href="#a2b5ed2fba3b0aa877b82ba5d6f4131bf">definedInRegion</a>(Blocks, <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getArgOperand(0)))</Highlight></CodeLine>
<Link id="l00645" /><CodeLine lineNumber="645"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00646" /><CodeLine lineNumber="646"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00647" /><CodeLine lineNumber="647"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00648" /><CodeLine lineNumber="648"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00649" /><CodeLine lineNumber="649"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00650" /><CodeLine lineNumber="650"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00651" /><CodeLine lineNumber="651" lineLink="/docs/api/classes/llvm/codeextractor/#ab4d4236fd0a481a0d93e159a9882fc53"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/codeextractor/#ab4d4236fd0a481a0d93e159a9882fc53">CodeExtractor::findInputsOutputs</a>(ValueSet &amp;Inputs, ValueSet &amp;Outputs,</Highlight></CodeLine>
<Link id="l00652" /><CodeLine lineNumber="652"><Highlight kind="normal">                                      </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> ValueSet &amp;SinkCands,</Highlight></CodeLine>
<Link id="l00653" /><CodeLine lineNumber="653"><Highlight kind="normal">                                      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> CollectGlobalInputs)</Highlight><Highlight kind="keyword"> const </Highlight><Highlight kind="normal">&#123;</Highlight></CodeLine>
<Link id="l00654" /><CodeLine lineNumber="654"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : Blocks) &#123;</Highlight></CodeLine>
<Link id="l00655" /><CodeLine lineNumber="655"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If a used value is defined outside the region, it&#39;s an input.  If an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00656" /><CodeLine lineNumber="656"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instruction is used outside the region, it&#39;s an output.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00657" /><CodeLine lineNumber="657"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l00658" /><CodeLine lineNumber="658"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;OI : <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.operands()) &#123;</Highlight></CodeLine>
<Link id="l00659" /><CodeLine lineNumber="659"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/value">Value</a> &#42;V = OI;</Highlight></CodeLine>
<Link id="l00660" /><CodeLine lineNumber="660"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!SinkCands.<a href="/docs/api/classes/llvm/setvector/#abb03e3b6c4fd937936a13afe4f60d291">count</a>(V) &amp;&amp;</Highlight></CodeLine>
<Link id="l00661" /><CodeLine lineNumber="661"><Highlight kind="normal">            (<a href="#a4dde4d426caa9831108c7520128292e0">definedInCaller</a>(Blocks, V) ||</Highlight></CodeLine>
<Link id="l00662" /><CodeLine lineNumber="662"><Highlight kind="normal">             (CollectGlobalInputs &amp;&amp; <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">llvm::isa&lt;llvm::GlobalVariable&gt;</a>(V))))</Highlight></CodeLine>
<Link id="l00663" /><CodeLine lineNumber="663"><Highlight kind="normal">          Inputs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(V);</Highlight></CodeLine>
<Link id="l00664" /><CodeLine lineNumber="664"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00665" /><CodeLine lineNumber="665"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00666" /><CodeLine lineNumber="666"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/user">User</a> &#42;U : <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>.users())</Highlight></CodeLine>
<Link id="l00667" /><CodeLine lineNumber="667"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="#a2b5ed2fba3b0aa877b82ba5d6f4131bf">definedInRegion</a>(Blocks, U)) &#123;</Highlight></CodeLine>
<Link id="l00668" /><CodeLine lineNumber="668"><Highlight kind="normal">          Outputs.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(&amp;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>);</Highlight></CodeLine>
<Link id="l00669" /><CodeLine lineNumber="669"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00670" /><CodeLine lineNumber="670"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00671" /><CodeLine lineNumber="671"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00672" /><CodeLine lineNumber="672"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00673" /><CodeLine lineNumber="673"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00674" /><CodeLine lineNumber="674"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00675" /><CodeLine lineNumber="675"><Highlight kind="comment">/// severSplitPHINodesOfEntry - If a PHI node has multiple inputs from outside</Highlight></CodeLine>
<Link id="l00676" /><CodeLine lineNumber="676"><Highlight kind="comment">/// of the region, we need to split the entry block of the region so that the</Highlight></CodeLine>
<Link id="l00677" /><CodeLine lineNumber="677"><Highlight kind="comment">/// PHI node is easier to deal with.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00678" /><CodeLine lineNumber="678"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> CodeExtractor::severSplitPHINodesOfEntry(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;&amp;Header) &#123;</Highlight></CodeLine>
<Link id="l00679" /><CodeLine lineNumber="679"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumPredsFromRegion = 0;</Highlight></CodeLine>
<Link id="l00680" /><CodeLine lineNumber="680"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> NumPredsOutsideRegion = 0;</Highlight></CodeLine>
<Link id="l00681" /><CodeLine lineNumber="681"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00682" /><CodeLine lineNumber="682"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Header != &amp;Header-&gt;getParent()-&gt;getEntryBlock()) &#123;</Highlight></CodeLine>
<Link id="l00683" /><CodeLine lineNumber="683"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Header-&gt;begin());</Highlight></CodeLine>
<Link id="l00684" /><CodeLine lineNumber="684"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!PN) </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;  </Highlight><Highlight kind="comment">// No PHI nodes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00685" /><CodeLine lineNumber="685"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00686" /><CodeLine lineNumber="686"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the header node contains any PHI nodes, check to see if there is more</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00687" /><CodeLine lineNumber="687"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// than one entry from outside the region.  If so, we need to sever the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00688" /><CodeLine lineNumber="688"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// header block into two.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00689" /><CodeLine lineNumber="689"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i)</Highlight></CodeLine>
<Link id="l00690" /><CodeLine lineNumber="690"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.count(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i)))</Highlight></CodeLine>
<Link id="l00691" /><CodeLine lineNumber="691"><Highlight kind="normal">        ++NumPredsFromRegion;</Highlight></CodeLine>
<Link id="l00692" /><CodeLine lineNumber="692"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00693" /><CodeLine lineNumber="693"><Highlight kind="normal">        ++NumPredsOutsideRegion;</Highlight></CodeLine>
<Link id="l00694" /><CodeLine lineNumber="694"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00695" /><CodeLine lineNumber="695"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If there is one (or fewer) predecessor from outside the region, we don&#39;t</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00696" /><CodeLine lineNumber="696"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// need to do anything special.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00697" /><CodeLine lineNumber="697"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumPredsOutsideRegion &lt;= 1) </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00698" /><CodeLine lineNumber="698"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00699" /><CodeLine lineNumber="699"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00700" /><CodeLine lineNumber="700"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Otherwise, we need to split the header block into two pieces: one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00701" /><CodeLine lineNumber="701"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// containing PHI nodes merging values from outside of the region, and a</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00702" /><CodeLine lineNumber="702"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// second that contains all of the code for the block and merges back any</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00703" /><CodeLine lineNumber="703"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// incoming values from inside of the region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00704" /><CodeLine lineNumber="704"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;NewBB = <a href="/docs/api/namespaces/llvm/#ac6c9ffe7979754415f4ca0d677174bc2">SplitBlock</a>(Header, Header-&gt;getFirstNonPHIIt(), DT);</Highlight></CodeLine>
<Link id="l00705" /><CodeLine lineNumber="705"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00706" /><CodeLine lineNumber="706"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// We only want to code extract the second block now, and it becomes the new</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00707" /><CodeLine lineNumber="707"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// header of the region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00708" /><CodeLine lineNumber="708"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;OldPred = Header;</Highlight></CodeLine>
<Link id="l00709" /><CodeLine lineNumber="709"><Highlight kind="normal">  Blocks.remove(OldPred);</Highlight></CodeLine>
<Link id="l00710" /><CodeLine lineNumber="710"><Highlight kind="normal">  Blocks.insert(NewBB);</Highlight></CodeLine>
<Link id="l00711" /><CodeLine lineNumber="711"><Highlight kind="normal">  Header = NewBB;</Highlight></CodeLine>
<Link id="l00712" /><CodeLine lineNumber="712"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00713" /><CodeLine lineNumber="713"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Okay, now we need to adjust the PHI nodes and any branches from within the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00714" /><CodeLine lineNumber="714"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// region to go to the new header block instead of the old header block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00715" /><CodeLine lineNumber="715"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (NumPredsFromRegion) &#123;</Highlight></CodeLine>
<Link id="l00716" /><CodeLine lineNumber="716"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/phinode">PHINode</a> &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(OldPred-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</Highlight></CodeLine>
<Link id="l00717" /><CodeLine lineNumber="717"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Loop over all of the predecessors of OldPred that are in the region,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00718" /><CodeLine lineNumber="718"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// changing them to branch to NewBB instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00719" /><CodeLine lineNumber="719"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i)</Highlight></CodeLine>
<Link id="l00720" /><CodeLine lineNumber="720"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.count(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i))) &#123;</Highlight></CodeLine>
<Link id="l00721" /><CodeLine lineNumber="721"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i)-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</Highlight></CodeLine>
<Link id="l00722" /><CodeLine lineNumber="722"><Highlight kind="normal">        TI-&gt;<a href="/docs/api/classes/llvm/user/#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(OldPred, NewBB);</Highlight></CodeLine>
<Link id="l00723" /><CodeLine lineNumber="723"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00724" /><CodeLine lineNumber="724"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00725" /><CodeLine lineNumber="725"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Okay, everything within the region is now branching to the right block, we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00726" /><CodeLine lineNumber="726"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// just have to update the PHI nodes now, inserting PHI nodes into NewBB.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00727" /><CodeLine lineNumber="727"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> AfterPHIs;</Highlight></CodeLine>
<Link id="l00728" /><CodeLine lineNumber="728"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (AfterPHIs = OldPred-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(AfterPHIs); ++AfterPHIs) &#123;</Highlight></CodeLine>
<Link id="l00729" /><CodeLine lineNumber="729"><Highlight kind="normal">      PHINode &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(AfterPHIs);</Highlight></CodeLine>
<Link id="l00730" /><CodeLine lineNumber="730"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Create a new PHI node in the new region, which has an incoming value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00731" /><CodeLine lineNumber="731"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// from OldPred of PN.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00732" /><CodeLine lineNumber="732"><Highlight kind="normal">      PHINode &#42;NewPN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(PN-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), 1 + NumPredsFromRegion,</Highlight></CodeLine>
<Link id="l00733" /><CodeLine lineNumber="733"><Highlight kind="normal">                                       PN-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.ce&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00734" /><CodeLine lineNumber="734"><Highlight kind="normal">      NewPN-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(NewBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>());</Highlight></CodeLine>
<Link id="l00735" /><CodeLine lineNumber="735"><Highlight kind="normal">      PN-&gt;<a href="/docs/api/classes/llvm/value/#a3ab5fc45117b450e8bb04e564cb6e5f2">replaceAllUsesWith</a>(NewPN);</Highlight></CodeLine>
<Link id="l00736" /><CodeLine lineNumber="736"><Highlight kind="normal">      NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(PN, OldPred);</Highlight></CodeLine>
<Link id="l00737" /><CodeLine lineNumber="737"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00738" /><CodeLine lineNumber="738"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Loop over all of the incoming value in PN, moving them to NewPN if they</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00739" /><CodeLine lineNumber="739"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// are from the extracted region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00740" /><CodeLine lineNumber="740"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i != PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); ++i) &#123;</Highlight></CodeLine>
<Link id="l00741" /><CodeLine lineNumber="741"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.count(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i))) &#123;</Highlight></CodeLine>
<Link id="l00742" /><CodeLine lineNumber="742"><Highlight kind="normal">          NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i), PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i));</Highlight></CodeLine>
<Link id="l00743" /><CodeLine lineNumber="743"><Highlight kind="normal">          PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a6f01dbe965b38186b1a78378689d4105">removeIncomingValue</a>(i);</Highlight></CodeLine>
<Link id="l00744" /><CodeLine lineNumber="744"><Highlight kind="normal">          --i;</Highlight></CodeLine>
<Link id="l00745" /><CodeLine lineNumber="745"><Highlight kind="normal">        &#125;</Highlight></CodeLine>
<Link id="l00746" /><CodeLine lineNumber="746"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00747" /><CodeLine lineNumber="747"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00748" /><CodeLine lineNumber="748"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00749" /><CodeLine lineNumber="749"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00750" /><CodeLine lineNumber="750"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l00751" /><CodeLine lineNumber="751"><Highlight kind="comment">/// severSplitPHINodesOfExits - if PHI nodes in exit blocks have inputs from</Highlight></CodeLine>
<Link id="l00752" /><CodeLine lineNumber="752"><Highlight kind="comment">/// outlined region, we split these PHIs on two: one with inputs from region</Highlight></CodeLine>
<Link id="l00753" /><CodeLine lineNumber="753"><Highlight kind="comment">/// and other with remaining incoming blocks; then first PHIs are placed in</Highlight></CodeLine>
<Link id="l00754" /><CodeLine lineNumber="754"><Highlight kind="comment">/// outlined region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00755" /><CodeLine lineNumber="755"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> CodeExtractor::severSplitPHINodesOfExits() &#123;</Highlight></CodeLine>
<Link id="l00756" /><CodeLine lineNumber="756"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (BasicBlock &#42;ExitBB : ExtractedFuncRetVals) &#123;</Highlight></CodeLine>
<Link id="l00757" /><CodeLine lineNumber="757"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;NewBB = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00758" /><CodeLine lineNumber="758"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00759" /><CodeLine lineNumber="759"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (PHINode &amp;PN : ExitBB-&gt;phis()) &#123;</Highlight></CodeLine>
<Link id="l00760" /><CodeLine lineNumber="760"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Find all incoming values from the outlining region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00761" /><CodeLine lineNumber="761"><Highlight kind="normal">      SmallVector&lt;unsigned, 2&gt; IncomingVals;</Highlight></CodeLine>
<Link id="l00762" /><CodeLine lineNumber="762"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0; i &lt; PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); ++i)</Highlight></CodeLine>
<Link id="l00763" /><CodeLine lineNumber="763"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.count(PN.<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i)))</Highlight></CodeLine>
<Link id="l00764" /><CodeLine lineNumber="764"><Highlight kind="normal">          IncomingVals.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(i);</Highlight></CodeLine>
<Link id="l00765" /><CodeLine lineNumber="765"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00766" /><CodeLine lineNumber="766"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Do not process PHI if there is one (or fewer) predecessor from region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00767" /><CodeLine lineNumber="767"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If PHI has exactly one predecessor from region, only this one incoming</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00768" /><CodeLine lineNumber="768"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// will be replaced on codeRepl block, so it should be safe to skip PHI.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00769" /><CodeLine lineNumber="769"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IncomingVals.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>() &lt;= 1)</Highlight></CodeLine>
<Link id="l00770" /><CodeLine lineNumber="770"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00771" /><CodeLine lineNumber="771"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00772" /><CodeLine lineNumber="772"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Create block for new PHIs and add it to the list of outlined if it</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00773" /><CodeLine lineNumber="773"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// wasn&#39;t done before.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00774" /><CodeLine lineNumber="774"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewBB) &#123;</Highlight></CodeLine>
<Link id="l00775" /><CodeLine lineNumber="775"><Highlight kind="normal">        NewBB = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(ExitBB-&gt;getContext(),</Highlight></CodeLine>
<Link id="l00776" /><CodeLine lineNumber="776"><Highlight kind="normal">                                   ExitBB-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;.split&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l00777" /><CodeLine lineNumber="777"><Highlight kind="normal">                                   ExitBB-&gt;getParent(), ExitBB);</Highlight></CodeLine>
<Link id="l00778" /><CodeLine lineNumber="778"><Highlight kind="normal">        NewBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab571b8358a3a8b6db1327d06bdc5e9f4">IsNewDbgInfoFormat</a> = ExitBB-&gt;IsNewDbgInfoFormat;</Highlight></CodeLine>
<Link id="l00779" /><CodeLine lineNumber="779"><Highlight kind="normal">        SmallVector&lt;BasicBlock &#42;, 4&gt; Preds(<a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(ExitBB));</Highlight></CodeLine>
<Link id="l00780" /><CodeLine lineNumber="780"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (BasicBlock &#42;PredBB : Preds)</Highlight></CodeLine>
<Link id="l00781" /><CodeLine lineNumber="781"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.count(PredBB))</Highlight></CodeLine>
<Link id="l00782" /><CodeLine lineNumber="782"><Highlight kind="normal">            PredBB-&gt;getTerminator()-&gt;replaceUsesOfWith(ExitBB, NewBB);</Highlight></CodeLine>
<Link id="l00783" /><CodeLine lineNumber="783"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(ExitBB, NewBB);</Highlight></CodeLine>
<Link id="l00784" /><CodeLine lineNumber="784"><Highlight kind="normal">        Blocks.insert(NewBB);</Highlight></CodeLine>
<Link id="l00785" /><CodeLine lineNumber="785"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00786" /><CodeLine lineNumber="786"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00787" /><CodeLine lineNumber="787"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Split this PHI.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00788" /><CodeLine lineNumber="788"><Highlight kind="normal">      PHINode &#42;NewPN = <a href="/docs/api/classes/llvm/phinode/#af4aba918a76ca15bde1be3e14572e475">PHINode::Create</a>(PN.<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>(), IncomingVals.<a href="/docs/api/classes/llvm/smallvectortemplatecommon/#a1c479a8c434377c2b8cb056bdfdfc201">size</a>(),</Highlight></CodeLine>
<Link id="l00789" /><CodeLine lineNumber="789"><Highlight kind="normal">                                       PN.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.ce&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00790" /><CodeLine lineNumber="790"><Highlight kind="normal">      NewPN-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(NewBB-&gt;<a href="/docs/api/classes/llvm/basicblock/#a362b5e6097732cbc0d2fb555a1f73400">getFirstNonPHIIt</a>());</Highlight></CodeLine>
<Link id="l00791" /><CodeLine lineNumber="791"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i : IncomingVals)</Highlight></CodeLine>
<Link id="l00792" /><CodeLine lineNumber="792"><Highlight kind="normal">        NewPN-&gt;<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i), PN.<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i));</Highlight></CodeLine>
<Link id="l00793" /><CodeLine lineNumber="793"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i : <a href="/docs/api/namespaces/llvm/#a6b0ac1fa4f05de76413c5e0ca6334035">reverse</a>(IncomingVals))</Highlight></CodeLine>
<Link id="l00794" /><CodeLine lineNumber="794"><Highlight kind="normal">        PN.<a href="/docs/api/classes/llvm/phinode/#a6f01dbe965b38186b1a78378689d4105">removeIncomingValue</a>(i, </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00795" /><CodeLine lineNumber="795"><Highlight kind="normal">      PN.<a href="/docs/api/classes/llvm/phinode/#a089cccb6f231efee72abc76d0f9c695f">addIncoming</a>(NewPN, NewBB);</Highlight></CodeLine>
<Link id="l00796" /><CodeLine lineNumber="796"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00797" /><CodeLine lineNumber="797"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00798" /><CodeLine lineNumber="798"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00799" /><CodeLine lineNumber="799"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00800" /><CodeLine lineNumber="800"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> CodeExtractor::splitReturnBlocks() &#123;</Highlight></CodeLine>
<Link id="l00801" /><CodeLine lineNumber="801"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (BasicBlock &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : Blocks)</Highlight></CodeLine>
<Link id="l00802" /><CodeLine lineNumber="802"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ReturnInst &#42;RI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;ReturnInst&gt;</a>(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>-&gt;getTerminator())) &#123;</Highlight></CodeLine>
<Link id="l00803" /><CodeLine lineNumber="803"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/ms-demangle/#a851a17f7dc73f9988807242926dcc645a03c2e7e41ffc181a4e84080b4710e81e">New</a> =</Highlight></CodeLine>
<Link id="l00804" /><CodeLine lineNumber="804"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>-&gt;splitBasicBlock(RI-&gt;getIterator(), <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;.ret&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00805" /><CodeLine lineNumber="805"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DT) &#123;</Highlight></CodeLine>
<Link id="l00806" /><CodeLine lineNumber="806"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Old dominates New. New node dominates all other nodes dominated</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00807" /><CodeLine lineNumber="807"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// by Old.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00808" /><CodeLine lineNumber="808"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a58b9df85470fc4e2a8066ff6a62e5a34">DomTreeNode</a> &#42;OldNode = DT-&gt;getNode(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>);</Highlight></CodeLine>
<Link id="l00809" /><CodeLine lineNumber="809"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;DomTreeNode &#42;, 8&gt;</a> <a href="/docs/api/namespaces/llvm/logicalview/#a93d1317dbbd98cf3bdce4d7cb31e81d1a64e4aca4297806247f62a7b5f8cbd3df">Children</a>(OldNode-&gt;<a href="/docs/api/classes/llvm/domtreenodebase/#a40b8345d54ada5dab71ae11d71e89d2f">begin</a>(),</Highlight></CodeLine>
<Link id="l00810" /><CodeLine lineNumber="810"><Highlight kind="normal">                                               OldNode-&gt;<a href="/docs/api/classes/llvm/domtreenodebase/#a74111c67a831eb30b020ecf063bce406">end</a>());</Highlight></CodeLine>
<Link id="l00811" /><CodeLine lineNumber="811"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00812" /><CodeLine lineNumber="812"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/#a58b9df85470fc4e2a8066ff6a62e5a34">DomTreeNode</a> &#42;NewNode = DT-&gt;addNewBlock(New, <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>);</Highlight></CodeLine>
<Link id="l00813" /><CodeLine lineNumber="813"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00814" /><CodeLine lineNumber="814"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a58b9df85470fc4e2a8066ff6a62e5a34">DomTreeNode</a> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : Children)</Highlight></CodeLine>
<Link id="l00815" /><CodeLine lineNumber="815"><Highlight kind="normal">          DT-&gt;changeImmediateDominator(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, NewNode);</Highlight></CodeLine>
<Link id="l00816" /><CodeLine lineNumber="816"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l00817" /><CodeLine lineNumber="817"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l00818" /><CodeLine lineNumber="818"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l00819" /><CodeLine lineNumber="819"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00820" /><CodeLine lineNumber="820"><Highlight kind="normal"><a href="/docs/api/classes/llvm/function">Function</a> &#42;CodeExtractor::constructFunctionDeclaration(</Highlight></CodeLine>
<Link id="l00821" /><CodeLine lineNumber="821"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> ValueSet &amp;inputs, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> ValueSet &amp;outputs, <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> EntryFreq,</Highlight></CodeLine>
<Link id="l00822" /><CodeLine lineNumber="822"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/twine">Twine</a> &amp;Name, ValueSet &amp;StructValues, <a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;&amp;StructTy) &#123;</Highlight></CodeLine>
<Link id="l00823" /><CodeLine lineNumber="823"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;inputs: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; inputs.size() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00824" /><CodeLine lineNumber="824"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;outputs: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; outputs.size() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00825" /><CodeLine lineNumber="825"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00826" /><CodeLine lineNumber="826"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;oldFunction = Blocks.front()-&gt;getParent();</Highlight></CodeLine>
<Link id="l00827" /><CodeLine lineNumber="827"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/codegen/machinecheckdebugify-cpp/#a85892acfa8970627e9bd9c9815f15c25">Module</a> &#42;<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a> = Blocks.front()-&gt;getModule();</Highlight></CodeLine>
<Link id="l00828" /><CodeLine lineNumber="828"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00829" /><CodeLine lineNumber="829"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Assemble the function&#39;s parameter lists.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00830" /><CodeLine lineNumber="830"><Highlight kind="normal">  std::vector&lt;Type &#42;&gt; ParamTy;</Highlight></CodeLine>
<Link id="l00831" /><CodeLine lineNumber="831"><Highlight kind="normal">  std::vector&lt;Type &#42;&gt; AggParamTy;</Highlight></CodeLine>
<Link id="l00832" /><CodeLine lineNumber="832"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> DataLayout &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>-&gt;getDataLayout();</Highlight></CodeLine>
<Link id="l00833" /><CodeLine lineNumber="833"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00834" /><CodeLine lineNumber="834"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add the types of the input values to the function&#39;s argument list</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00835" /><CodeLine lineNumber="835"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;value : inputs) &#123;</Highlight></CodeLine>
<Link id="l00836" /><CodeLine lineNumber="836"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;value used in func: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;value &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00837" /><CodeLine lineNumber="837"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AggregateArgs &amp;&amp; !ExcludeArgsFromAggregate.contains(value)) &#123;</Highlight></CodeLine>
<Link id="l00838" /><CodeLine lineNumber="838"><Highlight kind="normal">      AggParamTy.push&#95;back(value-&gt;getType());</Highlight></CodeLine>
<Link id="l00839" /><CodeLine lineNumber="839"><Highlight kind="normal">      StructValues.insert(value);</Highlight></CodeLine>
<Link id="l00840" /><CodeLine lineNumber="840"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00841" /><CodeLine lineNumber="841"><Highlight kind="normal">      ParamTy.push&#95;back(value-&gt;getType());</Highlight></CodeLine>
<Link id="l00842" /><CodeLine lineNumber="842"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00843" /><CodeLine lineNumber="843"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00844" /><CodeLine lineNumber="844"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add the types of the output values to the function&#39;s argument list.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00845" /><CodeLine lineNumber="845"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;output : outputs) &#123;</Highlight></CodeLine>
<Link id="l00846" /><CodeLine lineNumber="846"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(<a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;instr used in func: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;output &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;\\n&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00847" /><CodeLine lineNumber="847"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AggregateArgs &amp;&amp; !ExcludeArgsFromAggregate.contains(output)) &#123;</Highlight></CodeLine>
<Link id="l00848" /><CodeLine lineNumber="848"><Highlight kind="normal">      AggParamTy.push&#95;back(output-&gt;getType());</Highlight></CodeLine>
<Link id="l00849" /><CodeLine lineNumber="849"><Highlight kind="normal">      StructValues.insert(output);</Highlight></CodeLine>
<Link id="l00850" /><CodeLine lineNumber="850"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00851" /><CodeLine lineNumber="851"><Highlight kind="normal">      ParamTy.push&#95;back(</Highlight></CodeLine>
<Link id="l00852" /><CodeLine lineNumber="852"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/pointertype/#a8d7f800be5fd53dcfcdcbdc6fd9ccfe3">PointerType::get</a>(output-&gt;getContext(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getAllocaAddrSpace()));</Highlight></CodeLine>
<Link id="l00853" /><CodeLine lineNumber="853"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00854" /><CodeLine lineNumber="854"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00855" /><CodeLine lineNumber="855"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(</Highlight></CodeLine>
<Link id="l00856" /><CodeLine lineNumber="856"><Highlight kind="normal">      (ParamTy.size() + AggParamTy.size()) ==</Highlight></CodeLine>
<Link id="l00857" /><CodeLine lineNumber="857"><Highlight kind="normal">          (inputs.size() + outputs.size()) &amp;&amp;</Highlight></CodeLine>
<Link id="l00858" /><CodeLine lineNumber="858"><Highlight kind="normal">      </Highlight><Highlight kind="stringliteral">&quot;Number of scalar and aggregate params does not match inputs, outputs&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00859" /><CodeLine lineNumber="859"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((StructValues.empty() || AggregateArgs) &amp;&amp;</Highlight></CodeLine>
<Link id="l00860" /><CodeLine lineNumber="860"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;Expeced StructValues only with AggregateArgs set&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l00861" /><CodeLine lineNumber="861"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00862" /><CodeLine lineNumber="862"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Concatenate scalar and aggregate params in ParamTy.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00863" /><CodeLine lineNumber="863"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AggParamTy.empty()) &#123;</Highlight></CodeLine>
<Link id="l00864" /><CodeLine lineNumber="864"><Highlight kind="normal">    StructTy = <a href="/docs/api/classes/llvm/structtype/#a18fc4545474c6ebb6f7c547f64f4fb31">StructType::get</a>(<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>-&gt;getContext(), AggParamTy);</Highlight></CodeLine>
<Link id="l00865" /><CodeLine lineNumber="865"><Highlight kind="normal">    ParamTy.push&#95;back(<a href="/docs/api/classes/llvm/pointertype/#a8d7f800be5fd53dcfcdcbdc6fd9ccfe3">PointerType::get</a>(</Highlight></CodeLine>
<Link id="l00866" /><CodeLine lineNumber="866"><Highlight kind="normal">        <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>-&gt;getContext(), ArgsInZeroAddressSpace ? 0 : <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getAllocaAddrSpace()));</Highlight></CodeLine>
<Link id="l00867" /><CodeLine lineNumber="867"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l00868" /><CodeLine lineNumber="868"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00869" /><CodeLine lineNumber="869"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;RetTy = getSwitchType();</Highlight></CodeLine>
<Link id="l00870" /><CodeLine lineNumber="870"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(&#123;</Highlight></CodeLine>
<Link id="l00871" /><CodeLine lineNumber="871"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;Function type: &quot;</Highlight><Highlight kind="normal"> &lt;&lt; &#42;RetTy &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot; f(&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00872" /><CodeLine lineNumber="872"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;i : ParamTy)</Highlight></CodeLine>
<Link id="l00873" /><CodeLine lineNumber="873"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; &#42;i &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;, &quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00874" /><CodeLine lineNumber="874"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a7c46c742c31be54870e2038048e6b391">dbgs</a>() &lt;&lt; </Highlight><Highlight kind="stringliteral">&quot;)\\n&quot;</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00875" /><CodeLine lineNumber="875"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l00876" /><CodeLine lineNumber="876"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00877" /><CodeLine lineNumber="877"><Highlight kind="normal">  FunctionType &#42;funcType = <a href="/docs/api/classes/llvm/functiontype/#af8be7844c269f201ebcee1e15048c378">FunctionType::get</a>(</Highlight></CodeLine>
<Link id="l00878" /><CodeLine lineNumber="878"><Highlight kind="normal">      RetTy, ParamTy, AllowVarArgs &amp;&amp; oldFunction-&gt;<a href="/docs/api/classes/llvm/function/#af457a58a84b500d44feb7b699aa43ec1">isVarArg</a>());</Highlight></CodeLine>
<Link id="l00879" /><CodeLine lineNumber="879"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00880" /><CodeLine lineNumber="880"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create the new function</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00881" /><CodeLine lineNumber="881"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;newFunction =</Highlight></CodeLine>
<Link id="l00882" /><CodeLine lineNumber="882"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/function/#a05d7aedbbdc0fd24e8bc27edfe9c603f">Function::Create</a>(funcType, <a href="/docs/api/classes/llvm/globalvalue/#aedfa75f0c85c4aa85b257f066fbea57ca1511edd03e02d1f3dd277a3c6abf6ad5">GlobalValue::InternalLinkage</a>,</Highlight></CodeLine>
<Link id="l00883" /><CodeLine lineNumber="883"><Highlight kind="normal">                       oldFunction-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a702d4986803a1782ba305b1c7a0f1c21">getAddressSpace</a>(), Name, M);</Highlight></CodeLine>
<Link id="l00884" /><CodeLine lineNumber="884"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00885" /><CodeLine lineNumber="885"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Propagate personality info to the new function if there is one.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00886" /><CodeLine lineNumber="886"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (oldFunction-&gt;<a href="/docs/api/classes/llvm/function/#a6a0f6312963ee6fb0969243607174949">hasPersonalityFn</a>())</Highlight></CodeLine>
<Link id="l00887" /><CodeLine lineNumber="887"><Highlight kind="normal">    newFunction-&gt;<a href="/docs/api/classes/llvm/function/#a6f9ba62511c44dd991c6cd7485098d15">setPersonalityFn</a>(oldFunction-&gt;<a href="/docs/api/classes/llvm/function/#a6f77e4e800ba4dffd63e8ddb330062aa">getPersonalityFn</a>());</Highlight></CodeLine>
<Link id="l00888" /><CodeLine lineNumber="888"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00889" /><CodeLine lineNumber="889"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Inherit all of the target dependent attributes and white-listed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00890" /><CodeLine lineNumber="890"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// target independent attributes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00891" /><CodeLine lineNumber="891"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  (e.g. If the extracted region contains a call to an x86.sse</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00892" /><CodeLine lineNumber="892"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  instruction we need to make sure that the extracted region has the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00893" /><CodeLine lineNumber="893"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  &quot;target-features&quot; attribute allowing it to be lowered.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00894" /><CodeLine lineNumber="894"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// FIXME: This should be changed to check to see if a specific</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00895" /><CodeLine lineNumber="895"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//           attribute can not be inherited.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00896" /><CodeLine lineNumber="896"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;Attr : oldFunction-&gt;<a href="/docs/api/classes/llvm/function/#a7477aafbbe989ad35b96fac186d8e9fd">getAttributes</a>().getFnAttrs()) &#123;</Highlight></CodeLine>
<Link id="l00897" /><CodeLine lineNumber="897"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Attr.isStringAttribute()) &#123;</Highlight></CodeLine>
<Link id="l00898" /><CodeLine lineNumber="898"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Attr.getKindAsString() == </Highlight><Highlight kind="stringliteral">&quot;thunk&quot;</Highlight><Highlight kind="normal">)</Highlight></CodeLine>
<Link id="l00899" /><CodeLine lineNumber="899"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00900" /><CodeLine lineNumber="900"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00901" /><CodeLine lineNumber="901"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (Attr.getKindAsEnum()) &#123;</Highlight></CodeLine>
<Link id="l00902" /><CodeLine lineNumber="902"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Those attributes cannot be propagated safely. Explicitly list them</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00903" /><CodeLine lineNumber="903"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// here so we get a warning if new attributes are added.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00904" /><CodeLine lineNumber="904"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::AllocSize:</Highlight></CodeLine>
<Link id="l00905" /><CodeLine lineNumber="905"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Builtin:</Highlight></CodeLine>
<Link id="l00906" /><CodeLine lineNumber="906"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Convergent:</Highlight></CodeLine>
<Link id="l00907" /><CodeLine lineNumber="907"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::JumpTable:</Highlight></CodeLine>
<Link id="l00908" /><CodeLine lineNumber="908"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Naked:</Highlight></CodeLine>
<Link id="l00909" /><CodeLine lineNumber="909"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoBuiltin:</Highlight></CodeLine>
<Link id="l00910" /><CodeLine lineNumber="910"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoMerge:</Highlight></CodeLine>
<Link id="l00911" /><CodeLine lineNumber="911"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoReturn:</Highlight></CodeLine>
<Link id="l00912" /><CodeLine lineNumber="912"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoSync:</Highlight></CodeLine>
<Link id="l00913" /><CodeLine lineNumber="913"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::ReturnsTwice:</Highlight></CodeLine>
<Link id="l00914" /><CodeLine lineNumber="914"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Speculatable:</Highlight></CodeLine>
<Link id="l00915" /><CodeLine lineNumber="915"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::StackAlignment:</Highlight></CodeLine>
<Link id="l00916" /><CodeLine lineNumber="916"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::WillReturn:</Highlight></CodeLine>
<Link id="l00917" /><CodeLine lineNumber="917"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::AllocKind:</Highlight></CodeLine>
<Link id="l00918" /><CodeLine lineNumber="918"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::PresplitCoroutine:</Highlight></CodeLine>
<Link id="l00919" /><CodeLine lineNumber="919"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Memory:</Highlight></CodeLine>
<Link id="l00920" /><CodeLine lineNumber="920"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoFPClass:</Highlight></CodeLine>
<Link id="l00921" /><CodeLine lineNumber="921"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::CoroDestroyOnlyWhenComplete:</Highlight></CodeLine>
<Link id="l00922" /><CodeLine lineNumber="922"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::CoroElideSafe:</Highlight></CodeLine>
<Link id="l00923" /><CodeLine lineNumber="923"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoDivergenceSource:</Highlight></CodeLine>
<Link id="l00924" /><CodeLine lineNumber="924"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00925" /><CodeLine lineNumber="925"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Those attributes should be safe to propagate to the extracted function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00926" /><CodeLine lineNumber="926"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::AlwaysInline:</Highlight></CodeLine>
<Link id="l00927" /><CodeLine lineNumber="927"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Cold:</Highlight></CodeLine>
<Link id="l00928" /><CodeLine lineNumber="928"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::DisableSanitizerInstrumentation:</Highlight></CodeLine>
<Link id="l00929" /><CodeLine lineNumber="929"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::FnRetThunkExtern:</Highlight></CodeLine>
<Link id="l00930" /><CodeLine lineNumber="930"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Hot:</Highlight></CodeLine>
<Link id="l00931" /><CodeLine lineNumber="931"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::HybridPatchable:</Highlight></CodeLine>
<Link id="l00932" /><CodeLine lineNumber="932"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoRecurse:</Highlight></CodeLine>
<Link id="l00933" /><CodeLine lineNumber="933"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::InlineHint:</Highlight></CodeLine>
<Link id="l00934" /><CodeLine lineNumber="934"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::MinSize:</Highlight></CodeLine>
<Link id="l00935" /><CodeLine lineNumber="935"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoCallback:</Highlight></CodeLine>
<Link id="l00936" /><CodeLine lineNumber="936"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoDuplicate:</Highlight></CodeLine>
<Link id="l00937" /><CodeLine lineNumber="937"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoFree:</Highlight></CodeLine>
<Link id="l00938" /><CodeLine lineNumber="938"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoImplicitFloat:</Highlight></CodeLine>
<Link id="l00939" /><CodeLine lineNumber="939"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoInline:</Highlight></CodeLine>
<Link id="l00940" /><CodeLine lineNumber="940"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NonLazyBind:</Highlight></CodeLine>
<Link id="l00941" /><CodeLine lineNumber="941"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoRedZone:</Highlight></CodeLine>
<Link id="l00942" /><CodeLine lineNumber="942"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoUnwind:</Highlight></CodeLine>
<Link id="l00943" /><CodeLine lineNumber="943"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoSanitizeBounds:</Highlight></CodeLine>
<Link id="l00944" /><CodeLine lineNumber="944"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoSanitizeCoverage:</Highlight></CodeLine>
<Link id="l00945" /><CodeLine lineNumber="945"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NullPointerIsValid:</Highlight></CodeLine>
<Link id="l00946" /><CodeLine lineNumber="946"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::OptimizeForDebugging:</Highlight></CodeLine>
<Link id="l00947" /><CodeLine lineNumber="947"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::OptForFuzzing:</Highlight></CodeLine>
<Link id="l00948" /><CodeLine lineNumber="948"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::OptimizeNone:</Highlight></CodeLine>
<Link id="l00949" /><CodeLine lineNumber="949"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::OptimizeForSize:</Highlight></CodeLine>
<Link id="l00950" /><CodeLine lineNumber="950"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SafeStack:</Highlight></CodeLine>
<Link id="l00951" /><CodeLine lineNumber="951"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::ShadowCallStack:</Highlight></CodeLine>
<Link id="l00952" /><CodeLine lineNumber="952"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SanitizeAddress:</Highlight></CodeLine>
<Link id="l00953" /><CodeLine lineNumber="953"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SanitizeMemory:</Highlight></CodeLine>
<Link id="l00954" /><CodeLine lineNumber="954"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SanitizeNumericalStability:</Highlight></CodeLine>
<Link id="l00955" /><CodeLine lineNumber="955"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SanitizeThread:</Highlight></CodeLine>
<Link id="l00956" /><CodeLine lineNumber="956"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SanitizeType:</Highlight></CodeLine>
<Link id="l00957" /><CodeLine lineNumber="957"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SanitizeHWAddress:</Highlight></CodeLine>
<Link id="l00958" /><CodeLine lineNumber="958"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SanitizeMemTag:</Highlight></CodeLine>
<Link id="l00959" /><CodeLine lineNumber="959"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SanitizeRealtime:</Highlight></CodeLine>
<Link id="l00960" /><CodeLine lineNumber="960"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SanitizeRealtimeBlocking:</Highlight></CodeLine>
<Link id="l00961" /><CodeLine lineNumber="961"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SpeculativeLoadHardening:</Highlight></CodeLine>
<Link id="l00962" /><CodeLine lineNumber="962"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::StackProtect:</Highlight></CodeLine>
<Link id="l00963" /><CodeLine lineNumber="963"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::StackProtectReq:</Highlight></CodeLine>
<Link id="l00964" /><CodeLine lineNumber="964"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::StackProtectStrong:</Highlight></CodeLine>
<Link id="l00965" /><CodeLine lineNumber="965"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::StrictFP:</Highlight></CodeLine>
<Link id="l00966" /><CodeLine lineNumber="966"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::UWTable:</Highlight></CodeLine>
<Link id="l00967" /><CodeLine lineNumber="967"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::VScaleRange:</Highlight></CodeLine>
<Link id="l00968" /><CodeLine lineNumber="968"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoCfCheck:</Highlight></CodeLine>
<Link id="l00969" /><CodeLine lineNumber="969"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::MustProgress:</Highlight></CodeLine>
<Link id="l00970" /><CodeLine lineNumber="970"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoProfile:</Highlight></CodeLine>
<Link id="l00971" /><CodeLine lineNumber="971"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SkipProfile:</Highlight></CodeLine>
<Link id="l00972" /><CodeLine lineNumber="972"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l00973" /><CodeLine lineNumber="973"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// These attributes cannot be applied to functions.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l00974" /><CodeLine lineNumber="974"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Alignment:</Highlight></CodeLine>
<Link id="l00975" /><CodeLine lineNumber="975"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::AllocatedPointer:</Highlight></CodeLine>
<Link id="l00976" /><CodeLine lineNumber="976"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::AllocAlign:</Highlight></CodeLine>
<Link id="l00977" /><CodeLine lineNumber="977"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::ByVal:</Highlight></CodeLine>
<Link id="l00978" /><CodeLine lineNumber="978"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Captures:</Highlight></CodeLine>
<Link id="l00979" /><CodeLine lineNumber="979"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Dereferenceable:</Highlight></CodeLine>
<Link id="l00980" /><CodeLine lineNumber="980"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::DereferenceableOrNull:</Highlight></CodeLine>
<Link id="l00981" /><CodeLine lineNumber="981"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::ElementType:</Highlight></CodeLine>
<Link id="l00982" /><CodeLine lineNumber="982"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::InAlloca:</Highlight></CodeLine>
<Link id="l00983" /><CodeLine lineNumber="983"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::InReg:</Highlight></CodeLine>
<Link id="l00984" /><CodeLine lineNumber="984"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Nest:</Highlight></CodeLine>
<Link id="l00985" /><CodeLine lineNumber="985"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoAlias:</Highlight></CodeLine>
<Link id="l00986" /><CodeLine lineNumber="986"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoCapture:</Highlight></CodeLine>
<Link id="l00987" /><CodeLine lineNumber="987"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoUndef:</Highlight></CodeLine>
<Link id="l00988" /><CodeLine lineNumber="988"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NonNull:</Highlight></CodeLine>
<Link id="l00989" /><CodeLine lineNumber="989"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Preallocated:</Highlight></CodeLine>
<Link id="l00990" /><CodeLine lineNumber="990"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::ReadNone:</Highlight></CodeLine>
<Link id="l00991" /><CodeLine lineNumber="991"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::ReadOnly:</Highlight></CodeLine>
<Link id="l00992" /><CodeLine lineNumber="992"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Returned:</Highlight></CodeLine>
<Link id="l00993" /><CodeLine lineNumber="993"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SExt:</Highlight></CodeLine>
<Link id="l00994" /><CodeLine lineNumber="994"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::StructRet:</Highlight></CodeLine>
<Link id="l00995" /><CodeLine lineNumber="995"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SwiftError:</Highlight></CodeLine>
<Link id="l00996" /><CodeLine lineNumber="996"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SwiftSelf:</Highlight></CodeLine>
<Link id="l00997" /><CodeLine lineNumber="997"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::SwiftAsync:</Highlight></CodeLine>
<Link id="l00998" /><CodeLine lineNumber="998"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::ZExt:</Highlight></CodeLine>
<Link id="l00999" /><CodeLine lineNumber="999"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::ImmArg:</Highlight></CodeLine>
<Link id="l01000" /><CodeLine lineNumber="1000"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::ByRef:</Highlight></CodeLine>
<Link id="l01001" /><CodeLine lineNumber="1001"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::WriteOnly:</Highlight></CodeLine>
<Link id="l01002" /><CodeLine lineNumber="1002"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Writable:</Highlight></CodeLine>
<Link id="l01003" /><CodeLine lineNumber="1003"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::DeadOnUnwind:</Highlight></CodeLine>
<Link id="l01004" /><CodeLine lineNumber="1004"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Range:</Highlight></CodeLine>
<Link id="l01005" /><CodeLine lineNumber="1005"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::Initializes:</Highlight></CodeLine>
<Link id="l01006" /><CodeLine lineNumber="1006"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> Attribute::NoExt:</Highlight></CodeLine>
<Link id="l01007" /><CodeLine lineNumber="1007"><Highlight kind="normal">      </Highlight><Highlight kind="comment">//  These are not really attributes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01008" /><CodeLine lineNumber="1008"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/attribute/#aab7ee4b8fd1d3e7e4cea87868855e60ea5e58e419b1c9e35d6131976412fd8f0c">Attribute::None</a>:</Highlight></CodeLine>
<Link id="l01009" /><CodeLine lineNumber="1009"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/attribute/#aab7ee4b8fd1d3e7e4cea87868855e60eadf64174102f26dd4fd9d79cc93ddee1b">Attribute::EndAttrKinds</a>:</Highlight></CodeLine>
<Link id="l01010" /><CodeLine lineNumber="1010"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/attribute/#aab7ee4b8fd1d3e7e4cea87868855e60eaa108685538d49543443a0ce281efd1d8">Attribute::EmptyKey</a>:</Highlight></CodeLine>
<Link id="l01011" /><CodeLine lineNumber="1011"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/attribute/#aab7ee4b8fd1d3e7e4cea87868855e60ea3e672d8a791835da7d662b61f79590a6">Attribute::TombstoneKey</a>:</Highlight></CodeLine>
<Link id="l01012" /><CodeLine lineNumber="1012"><Highlight kind="normal">        <a href="/docs/api/files/include/include/llvm/include/llvm/support/errorhandling-h/#ace243f5c25697a1107cce46626b3dc94">llvm&#95;unreachable</a>(</Highlight><Highlight kind="stringliteral">&quot;Not a function attribute&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01013" /><CodeLine lineNumber="1013"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01014" /><CodeLine lineNumber="1014"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01015" /><CodeLine lineNumber="1015"><Highlight kind="normal">    newFunction-&gt;<a href="/docs/api/classes/llvm/function/#a01875e4204852069dd4b7938cab4140b">addFnAttr</a>(Attr);</Highlight></CodeLine>
<Link id="l01016" /><CodeLine lineNumber="1016"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01017" /><CodeLine lineNumber="1017"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01018" /><CodeLine lineNumber="1018"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create scalar and aggregate iterators to name all of the arguments we</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01019" /><CodeLine lineNumber="1019"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// inserted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01020" /><CodeLine lineNumber="1020"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function/#a1c9f2f058966db1f8ca270398bda8362">Function::arg&#95;iterator</a> ScalarAI = newFunction-&gt;<a href="/docs/api/classes/llvm/function/#a8bf193a781a92cae52d7f9216d0824f8">arg&#95;begin</a>();</Highlight></CodeLine>
<Link id="l01021" /><CodeLine lineNumber="1021"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01022" /><CodeLine lineNumber="1022"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Set names and attributes for input and output arguments.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01023" /><CodeLine lineNumber="1023"><Highlight kind="normal">  ScalarAI = newFunction-&gt;<a href="/docs/api/classes/llvm/function/#a8bf193a781a92cae52d7f9216d0824f8">arg&#95;begin</a>();</Highlight></CodeLine>
<Link id="l01024" /><CodeLine lineNumber="1024"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;input : inputs) &#123;</Highlight></CodeLine>
<Link id="l01025" /><CodeLine lineNumber="1025"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StructValues.contains(input))</Highlight></CodeLine>
<Link id="l01026" /><CodeLine lineNumber="1026"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01027" /><CodeLine lineNumber="1027"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01028" /><CodeLine lineNumber="1028"><Highlight kind="normal">    ScalarAI-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(input-&gt;getName());</Highlight></CodeLine>
<Link id="l01029" /><CodeLine lineNumber="1029"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (input-&gt;isSwiftError())</Highlight></CodeLine>
<Link id="l01030" /><CodeLine lineNumber="1030"><Highlight kind="normal">      newFunction-&gt;<a href="/docs/api/classes/llvm/function/#aa5087b607af833220d9ebab0c88c83c1">addParamAttr</a>(ScalarAI - newFunction-&gt;<a href="/docs/api/classes/llvm/function/#a8bf193a781a92cae52d7f9216d0824f8">arg&#95;begin</a>(),</Highlight></CodeLine>
<Link id="l01031" /><CodeLine lineNumber="1031"><Highlight kind="normal">                                Attribute::SwiftError);</Highlight></CodeLine>
<Link id="l01032" /><CodeLine lineNumber="1032"><Highlight kind="normal">    ++ScalarAI;</Highlight></CodeLine>
<Link id="l01033" /><CodeLine lineNumber="1033"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01034" /><CodeLine lineNumber="1034"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;output : outputs) &#123;</Highlight></CodeLine>
<Link id="l01035" /><CodeLine lineNumber="1035"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StructValues.contains(output))</Highlight></CodeLine>
<Link id="l01036" /><CodeLine lineNumber="1036"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01037" /><CodeLine lineNumber="1037"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01038" /><CodeLine lineNumber="1038"><Highlight kind="normal">    ScalarAI-&gt;<a href="/docs/api/classes/llvm/value/#a35ee267850af7c235474a8c46c7ac5af">setName</a>(output-&gt;getName() + </Highlight><Highlight kind="stringliteral">&quot;.out&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01039" /><CodeLine lineNumber="1039"><Highlight kind="normal">    ++ScalarAI;</Highlight></CodeLine>
<Link id="l01040" /><CodeLine lineNumber="1040"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01041" /><CodeLine lineNumber="1041"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01042" /><CodeLine lineNumber="1042"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update the entry count of the function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01043" /><CodeLine lineNumber="1043"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BFI) &#123;</Highlight></CodeLine>
<Link id="l01044" /><CodeLine lineNumber="1044"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a> = BFI-&gt;getProfileCountFromFreq(EntryFreq);</Highlight></CodeLine>
<Link id="l01045" /><CodeLine lineNumber="1045"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>.has&#95;value())</Highlight></CodeLine>
<Link id="l01046" /><CodeLine lineNumber="1046"><Highlight kind="normal">      newFunction-&gt;<a href="/docs/api/classes/llvm/function/#aefb3254278b224f10e5b966cea653e01">setEntryCount</a>(</Highlight></CodeLine>
<Link id="l01047" /><CodeLine lineNumber="1047"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/#a854ac9cfc31bb306b1495a508707dc26">ProfileCount</a>(&#42;<a href="/docs/api/namespaces/llvm/#a845e08be4b0320d66901a66b0c0e9509">Count</a>, <a href="/docs/api/classes/llvm/function/#a438d2f246b76817114ade2a005a6bcabac7dbc704eba08842e6acdde9cf6379ba">Function::PCT&#95;Real</a>)); </Highlight><Highlight kind="comment">// FIXME</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01048" /><CodeLine lineNumber="1048"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01049" /><CodeLine lineNumber="1049"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01050" /><CodeLine lineNumber="1050"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> newFunction;</Highlight></CodeLine>
<Link id="l01051" /><CodeLine lineNumber="1051"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01052" /><CodeLine lineNumber="1052"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01053" /><CodeLine lineNumber="1053"><Highlight kind="comment">/// If the original function has debug info, we have to add a debug location</Highlight></CodeLine>
<Link id="l01054" /><CodeLine lineNumber="1054"><Highlight kind="comment">/// to the new branch instruction from the artificial entry block.</Highlight></CodeLine>
<Link id="l01055" /><CodeLine lineNumber="1055"><Highlight kind="comment">/// We use the debug location of the first instruction in the extracted</Highlight></CodeLine>
<Link id="l01056" /><CodeLine lineNumber="1056"><Highlight kind="comment">/// blocks, as there is no other equivalent line in the source code.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01057" /><CodeLine lineNumber="1057" lineLink="#a19cc77dc725d4cbbf994e5db311e3c97"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a19cc77dc725d4cbbf994e5db311e3c97">applyFirstDebugLoc</a>(<a href="/docs/api/classes/llvm/function">Function</a> &#42;oldFunction,</Highlight></CodeLine>
<Link id="l01058" /><CodeLine lineNumber="1058"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;BasicBlock &#42;&gt;</a> Blocks,</Highlight></CodeLine>
<Link id="l01059" /><CodeLine lineNumber="1059"><Highlight kind="normal">                               <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;BranchI) &#123;</Highlight></CodeLine>
<Link id="l01060" /><CodeLine lineNumber="1060"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (oldFunction-&gt;<a href="/docs/api/classes/llvm/function/#a4d834f9897d15e3a6349063b5d637cd8">getSubprogram</a>()) &#123;</Highlight></CodeLine>
<Link id="l01061" /><CodeLine lineNumber="1061"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(Blocks, &#91;&amp;BranchI&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l01062" /><CodeLine lineNumber="1062"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(&#42;BB, &#91;&amp;BranchI&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01063" /><CodeLine lineNumber="1063"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDebugLoc())</Highlight></CodeLine>
<Link id="l01064" /><CodeLine lineNumber="1064"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01065" /><CodeLine lineNumber="1065"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Don&#39;t use source locations attached to debug-intrinsics: they could</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01066" /><CodeLine lineNumber="1066"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// be from completely unrelated scopes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01067" /><CodeLine lineNumber="1067"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;DbgInfoIntrinsic&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>))</Highlight></CodeLine>
<Link id="l01068" /><CodeLine lineNumber="1068"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01069" /><CodeLine lineNumber="1069"><Highlight kind="normal">        BranchI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDebugLoc());</Highlight></CodeLine>
<Link id="l01070" /><CodeLine lineNumber="1070"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01071" /><CodeLine lineNumber="1071"><Highlight kind="normal">      &#125;);</Highlight></CodeLine>
<Link id="l01072" /><CodeLine lineNumber="1072"><Highlight kind="normal">    &#125;);</Highlight></CodeLine>
<Link id="l01073" /><CodeLine lineNumber="1073"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01074" /><CodeLine lineNumber="1074"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01075" /><CodeLine lineNumber="1075"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01076" /><CodeLine lineNumber="1076"><Highlight kind="comment">/// Erase lifetime.start markers which reference inputs to the extraction</Highlight></CodeLine>
<Link id="l01077" /><CodeLine lineNumber="1077"><Highlight kind="comment">/// region, and insert the referenced memory into \\p LifetimesStart.</Highlight></CodeLine>
<Link id="l01078" /><CodeLine lineNumber="1078"><Highlight kind="comment">///</Highlight></CodeLine>
<Link id="l01079" /><CodeLine lineNumber="1079"><Highlight kind="comment">/// The extraction region is defined by a set of blocks (\\p Blocks), and a set</Highlight></CodeLine>
<Link id="l01080" /><CodeLine lineNumber="1080"><Highlight kind="comment">/// of allocas which will be moved from the caller function into the extracted</Highlight></CodeLine>
<Link id="l01081" /><CodeLine lineNumber="1081"><Highlight kind="comment">/// function (\\p SunkAllocas).</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01082" /><CodeLine lineNumber="1082" lineLink="#a93144a1eb23283cfa213d7dccb12d683"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a93144a1eb23283cfa213d7dccb12d683">eraseLifetimeMarkersOnInputs</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/setvector">SetVector&lt;BasicBlock &#42;&gt;</a> &amp;Blocks,</Highlight></CodeLine>
<Link id="l01083" /><CodeLine lineNumber="1083"><Highlight kind="normal">                                         </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;SunkAllocas,</Highlight></CodeLine>
<Link id="l01084" /><CodeLine lineNumber="1084"><Highlight kind="normal">                                         <a href="/docs/api/classes/llvm/setvector">SetVector&lt;Value &#42;&gt;</a> &amp;LifetimesStart) &#123;</Highlight></CodeLine>
<Link id="l01085" /><CodeLine lineNumber="1085"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;BB : Blocks) &#123;</Highlight></CodeLine>
<Link id="l01086" /><CodeLine lineNumber="1086"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(&#42;BB)) &#123;</Highlight></CodeLine>
<Link id="l01087" /><CodeLine lineNumber="1087"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;IntrinsicInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01088" /><CodeLine lineNumber="1088"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> || !<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;isLifetimeStartOrEnd())</Highlight></CodeLine>
<Link id="l01089" /><CodeLine lineNumber="1089"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01090" /><CodeLine lineNumber="1090"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01091" /><CodeLine lineNumber="1091"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Get the memory operand of the lifetime marker. If the underlying</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01092" /><CodeLine lineNumber="1092"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// object is a sunk alloca, or is otherwise defined in the extraction</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01093" /><CodeLine lineNumber="1093"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// region, the lifetime marker must not be erased.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01094" /><CodeLine lineNumber="1094"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/value">Value</a> &#42;Mem = <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getOperand(1)-&gt;stripInBoundsOffsets();</Highlight></CodeLine>
<Link id="l01095" /><CodeLine lineNumber="1095"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (SunkAllocas.<a href="/docs/api/classes/llvm/setvector/#abb03e3b6c4fd937936a13afe4f60d291">count</a>(Mem) || <a href="#a2b5ed2fba3b0aa877b82ba5d6f4131bf">definedInRegion</a>(Blocks, Mem))</Highlight></CodeLine>
<Link id="l01096" /><CodeLine lineNumber="1096"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01097" /><CodeLine lineNumber="1097"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01098" /><CodeLine lineNumber="1098"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;getIntrinsicID() == Intrinsic::lifetime&#95;start)</Highlight></CodeLine>
<Link id="l01099" /><CodeLine lineNumber="1099"><Highlight kind="normal">        LifetimesStart.<a href="/docs/api/classes/llvm/setvector/#af34eb71cc483e84d2eca80575cb9ccde">insert</a>(Mem);</Highlight></CodeLine>
<Link id="l01100" /><CodeLine lineNumber="1100"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01101" /><CodeLine lineNumber="1101"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01102" /><CodeLine lineNumber="1102"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01103" /><CodeLine lineNumber="1103"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01104" /><CodeLine lineNumber="1104"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01105" /><CodeLine lineNumber="1105"><Highlight kind="comment">/// Insert lifetime start/end markers surrounding the call to the new function</Highlight></CodeLine>
<Link id="l01106" /><CodeLine lineNumber="1106"><Highlight kind="comment">/// for objects defined in the caller.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01107" /><CodeLine lineNumber="1107" lineLink="#ae3b43649c18ab9e63c1be61b93dd7031"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#ae3b43649c18ab9e63c1be61b93dd7031">insertLifetimeMarkersSurroundingCall</a>(</Highlight></CodeLine>
<Link id="l01108" /><CodeLine lineNumber="1108"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/module">Module</a> &#42;M, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Value &#42;&gt;</a> LifetimesStart, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Value &#42;&gt;</a> LifetimesEnd,</Highlight></CodeLine>
<Link id="l01109" /><CodeLine lineNumber="1109"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;TheCall) &#123;</Highlight></CodeLine>
<Link id="l01110" /><CodeLine lineNumber="1110"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = M-&gt;getContext();</Highlight></CodeLine>
<Link id="l01111" /><CodeLine lineNumber="1111"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NegativeOne = <a href="/docs/api/classes/llvm/constantint/#a9ad53d2a00a6fb861b3a048c6592b742">ConstantInt::getSigned</a>(<a href="/docs/api/classes/llvm/type/#a05186fa23e4d11b9855a9599ba87a4b7">Type::getInt64Ty</a>(Ctx), -1);</Highlight></CodeLine>
<Link id="l01112" /><CodeLine lineNumber="1112"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;Term = TheCall-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getTerminator();</Highlight></CodeLine>
<Link id="l01113" /><CodeLine lineNumber="1113"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01114" /><CodeLine lineNumber="1114"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Emit lifetime markers for the pointers given in \\p Objects. Insert the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01115" /><CodeLine lineNumber="1115"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// markers before the call if \\p InsertBefore, and after the call otherwise.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01116" /><CodeLine lineNumber="1116"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> insertMarkers = &#91;&amp;&#93;(<a href="/docs/api/namespaces/llvm/intrinsic/#a80add6b3b1cdaec560907995127adc16">Intrinsic::ID</a> MarkerFunc, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Value &#42;&gt;</a> Objects,</Highlight></CodeLine>
<Link id="l01117" /><CodeLine lineNumber="1117"><Highlight kind="normal">                           </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> InsertBefore) &#123;</Highlight></CodeLine>
<Link id="l01118" /><CodeLine lineNumber="1118"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/value">Value</a> &#42;Mem : Objects) &#123;</Highlight></CodeLine>
<Link id="l01119" /><CodeLine lineNumber="1119"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(Mem) || <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(Mem)-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/utils/evaluator-cpp/#a92efb02157b6836e1232c577d34678d6">getFunction</a>() ==</Highlight></CodeLine>
<Link id="l01120" /><CodeLine lineNumber="1120"><Highlight kind="normal">                                            TheCall-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>()) &amp;&amp;</Highlight></CodeLine>
<Link id="l01121" /><CodeLine lineNumber="1121"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Input memory not defined in original function&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01122" /><CodeLine lineNumber="1122"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01123" /><CodeLine lineNumber="1123"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/function">Function</a> &#42;Func =</Highlight></CodeLine>
<Link id="l01124" /><CodeLine lineNumber="1124"><Highlight kind="normal">          <a href="/docs/api/namespaces/llvm/intrinsic/#a0cff8be0190d8e20b7cf13646f34afa2">Intrinsic::getOrInsertDeclaration</a>(M, MarkerFunc, Mem-&gt;getType());</Highlight></CodeLine>
<Link id="l01125" /><CodeLine lineNumber="1125"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> Marker = <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(Func, &#123;NegativeOne, Mem&#125;);</Highlight></CodeLine>
<Link id="l01126" /><CodeLine lineNumber="1126"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (InsertBefore)</Highlight></CodeLine>
<Link id="l01127" /><CodeLine lineNumber="1127"><Highlight kind="normal">        Marker-&gt;<a href="/docs/api/classes/llvm/instruction/#a482498a1c760122fd33c7fc8190dd277">insertBefore</a>(TheCall-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01128" /><CodeLine lineNumber="1128"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01129" /><CodeLine lineNumber="1129"><Highlight kind="normal">        Marker-&gt;insertBefore(Term-&gt;getIterator());</Highlight></CodeLine>
<Link id="l01130" /><CodeLine lineNumber="1130"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01131" /><CodeLine lineNumber="1131"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01132" /><CodeLine lineNumber="1132"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01133" /><CodeLine lineNumber="1133"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LifetimesStart.<a href="/docs/api/classes/llvm/arrayref/#ac835b8735b1b2faec0efdca236e37d94">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l01134" /><CodeLine lineNumber="1134"><Highlight kind="normal">    insertMarkers(Intrinsic::lifetime&#95;start, LifetimesStart,</Highlight></CodeLine>
<Link id="l01135" /><CodeLine lineNumber="1135"><Highlight kind="normal">                  </Highlight><Highlight kind="comment">/&#42;InsertBefore=&#42;/</Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01136" /><CodeLine lineNumber="1136"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01137" /><CodeLine lineNumber="1137"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01138" /><CodeLine lineNumber="1138"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!LifetimesEnd.<a href="/docs/api/classes/llvm/arrayref/#ac835b8735b1b2faec0efdca236e37d94">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l01139" /><CodeLine lineNumber="1139"><Highlight kind="normal">    insertMarkers(Intrinsic::lifetime&#95;end, LifetimesEnd,</Highlight></CodeLine>
<Link id="l01140" /><CodeLine lineNumber="1140"><Highlight kind="normal">                  </Highlight><Highlight kind="comment">/&#42;InsertBefore=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01141" /><CodeLine lineNumber="1141"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01142" /><CodeLine lineNumber="1142"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01143" /><CodeLine lineNumber="1143"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01144" /><CodeLine lineNumber="1144"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> CodeExtractor::moveCodeToFunction(<a href="/docs/api/classes/llvm/function">Function</a> &#42;newFunction) &#123;</Highlight></CodeLine>
<Link id="l01145" /><CodeLine lineNumber="1145"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> newFuncIt = newFunction-&gt;<a href="/docs/api/classes/llvm/function/#a88a5e60837674780a9d812d661897ac5">begin</a>();</Highlight></CodeLine>
<Link id="l01146" /><CodeLine lineNumber="1146"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (BasicBlock &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : Blocks) &#123;</Highlight></CodeLine>
<Link id="l01147" /><CodeLine lineNumber="1147"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Delete the basic block from the old function, and the list of blocks</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01148" /><CodeLine lineNumber="1148"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>-&gt;removeFromParent();</Highlight></CodeLine>
<Link id="l01149" /><CodeLine lineNumber="1149"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01150" /><CodeLine lineNumber="1150"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Insert this basic block into the new function</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01151" /><CodeLine lineNumber="1151"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Insert the original blocks after the entry block created</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01152" /><CodeLine lineNumber="1152"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// for the new function. The entry block may be followed</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01153" /><CodeLine lineNumber="1153"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// by a set of exit blocks at this point, but these exit</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01154" /><CodeLine lineNumber="1154"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// blocks better be placed at the end of the new function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01155" /><CodeLine lineNumber="1155"><Highlight kind="normal">    newFuncIt = newFunction-&gt;<a href="/docs/api/classes/llvm/function/#aaab8110aafc070c83bc701b13d2260df">insert</a>(std::next(newFuncIt), <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>);</Highlight></CodeLine>
<Link id="l01156" /><CodeLine lineNumber="1156"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01157" /><CodeLine lineNumber="1157"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01158" /><CodeLine lineNumber="1158"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01159" /><CodeLine lineNumber="1159"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> CodeExtractor::calculateNewCallTerminatorWeights(</Highlight></CodeLine>
<Link id="l01160" /><CodeLine lineNumber="1160"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CodeReplacer,</Highlight></CodeLine>
<Link id="l01161" /><CodeLine lineNumber="1161"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, BlockFrequency&gt;</a> &amp;ExitWeights,</Highlight></CodeLine>
<Link id="l01162" /><CodeLine lineNumber="1162"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchprobabilityinfo">BranchProbabilityInfo</a> &#42;BPI) &#123;</Highlight></CodeLine>
<Link id="l01163" /><CodeLine lineNumber="1163"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/anonymous-blockfrequencyinfoimpl-cpp-/#a03c5183992b1c37a3db46deb244a3b72">Distribution</a> = BlockFrequencyInfoImplBase::Distribution;</Highlight></CodeLine>
<Link id="l01164" /><CodeLine lineNumber="1164"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">using </Highlight><Highlight kind="normal"><a href="/docs/api/namespaces/anonymous-blockfrequencyinfoimpl-cpp-/#a5267fe37656bee76cc29b372540c5113">BlockNode</a> = BlockFrequencyInfoImplBase::BlockNode;</Highlight></CodeLine>
<Link id="l01165" /><CodeLine lineNumber="1165"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01166" /><CodeLine lineNumber="1166"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update the branch weights for the exit block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01167" /><CodeLine lineNumber="1167"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;TI = CodeReplacer-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</Highlight></CodeLine>
<Link id="l01168" /><CodeLine lineNumber="1168"><Highlight kind="normal">  SmallVector&lt;unsigned, 8&gt; BranchWeights(TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>(), 0);</Highlight></CodeLine>
<Link id="l01169" /><CodeLine lineNumber="1169"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01170" /><CodeLine lineNumber="1170"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Block Frequency distribution with dummy node.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01171" /><CodeLine lineNumber="1171"><Highlight kind="normal">  <a href="/docs/api/namespaces/anonymous-blockfrequencyinfoimpl-cpp-/#a03c5183992b1c37a3db46deb244a3b72">Distribution</a> BranchDist;</Highlight></CodeLine>
<Link id="l01172" /><CodeLine lineNumber="1172"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01173" /><CodeLine lineNumber="1173"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/#a8fc529c79977cdd01e187986f960a07f">SmallVector&lt;BranchProbability, 4&gt;</a> EdgeProbabilities(</Highlight></CodeLine>
<Link id="l01174" /><CodeLine lineNumber="1174"><Highlight kind="normal">      TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>(), <a href="/docs/api/classes/llvm/branchprobability/#a76e4454abb329dee28e8f525ddd1a210">BranchProbability::getUnknown</a>());</Highlight></CodeLine>
<Link id="l01175" /><CodeLine lineNumber="1175"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01176" /><CodeLine lineNumber="1176"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add each of the frequencies of the successors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01177" /><CodeLine lineNumber="1177"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>(); i &lt; e; ++i) &#123;</Highlight></CodeLine>
<Link id="l01178" /><CodeLine lineNumber="1178"><Highlight kind="normal">    <a href="/docs/api/namespaces/anonymous-blockfrequencyinfoimpl-cpp-/#a5267fe37656bee76cc29b372540c5113">BlockNode</a> ExitNode(i);</Highlight></CodeLine>
<Link id="l01179" /><CodeLine lineNumber="1179"><Highlight kind="normal">    uint64&#95;t ExitFreq = ExitWeights.<a href="/docs/api/classes/llvm/densemapbase/#a0b2ca98dc28c61793ff5c90d23e5f14e">lookup</a>(TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(i)).getFrequency();</Highlight></CodeLine>
<Link id="l01180" /><CodeLine lineNumber="1180"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExitFreq != 0)</Highlight></CodeLine>
<Link id="l01181" /><CodeLine lineNumber="1181"><Highlight kind="normal">      BranchDist.addExit(ExitNode, ExitFreq);</Highlight></CodeLine>
<Link id="l01182" /><CodeLine lineNumber="1182"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01183" /><CodeLine lineNumber="1183"><Highlight kind="normal">      EdgeProbabilities&#91;i&#93; = <a href="/docs/api/classes/llvm/branchprobability/#afd00958cba7080048a84cccfcef55d71">BranchProbability::getZero</a>();</Highlight></CodeLine>
<Link id="l01184" /><CodeLine lineNumber="1184"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01185" /><CodeLine lineNumber="1185"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01186" /><CodeLine lineNumber="1186"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Check for no total weight.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01187" /><CodeLine lineNumber="1187"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BranchDist.Total == 0) &#123;</Highlight></CodeLine>
<Link id="l01188" /><CodeLine lineNumber="1188"><Highlight kind="normal">    BPI-&gt;setEdgeProbability(CodeReplacer, EdgeProbabilities);</Highlight></CodeLine>
<Link id="l01189" /><CodeLine lineNumber="1189"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01190" /><CodeLine lineNumber="1190"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01191" /><CodeLine lineNumber="1191"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01192" /><CodeLine lineNumber="1192"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Normalize the distribution so that they can fit in unsigned.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01193" /><CodeLine lineNumber="1193"><Highlight kind="normal">  BranchDist.normalize();</Highlight></CodeLine>
<Link id="l01194" /><CodeLine lineNumber="1194"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01195" /><CodeLine lineNumber="1195"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create normalized branch weights and set the metadata.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01196" /><CodeLine lineNumber="1196"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = 0, <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a> = BranchDist.Weights.size(); <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> &lt; <a href="/docs/api/files/lib/lib/ir/builtingcs-cpp/#abb2b3a60ccc38a28239e19a1646e0c8a">E</a>; ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01197" /><CodeLine lineNumber="1197"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;<a href="/docs/api/namespaces/anonymous-blockfrequencyinfoimpl-cpp-/#aede9c090bfa516420939d4240fad8248">Weight</a> = BranchDist.Weights&#91;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>&#93;;</Highlight></CodeLine>
<Link id="l01198" /><CodeLine lineNumber="1198"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01199" /><CodeLine lineNumber="1199"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Get the weight and update the current BFI.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01200" /><CodeLine lineNumber="1200"><Highlight kind="normal">    BranchWeights&#91;<a href="/docs/api/namespaces/anonymous-blockfrequencyinfoimpl-cpp-/#aede9c090bfa516420939d4240fad8248">Weight</a>.<a href="/docs/api/structs/llvm/blockfrequencyinfoimplbase/weight/#a7d49b2704586051c51172cc77d4104b3">TargetNode</a>.<a href="/docs/api/structs/llvm/blockfrequencyinfoimplbase/blocknode/#afd6ff190a72a58d7c890cf480bc6f6e8">Index</a>&#93; = <a href="/docs/api/namespaces/anonymous-blockfrequencyinfoimpl-cpp-/#aede9c090bfa516420939d4240fad8248">Weight</a>.<a href="/docs/api/structs/llvm/blockfrequencyinfoimplbase/weight/#ab134b83ec8b71cfe2e2003c8a130bd24">Amount</a>;</Highlight></CodeLine>
<Link id="l01201" /><CodeLine lineNumber="1201"><Highlight kind="normal">    BranchProbability BP(<a href="/docs/api/namespaces/anonymous-blockfrequencyinfoimpl-cpp-/#aede9c090bfa516420939d4240fad8248">Weight</a>.<a href="/docs/api/structs/llvm/blockfrequencyinfoimplbase/weight/#ab134b83ec8b71cfe2e2003c8a130bd24">Amount</a>, BranchDist.Total);</Highlight></CodeLine>
<Link id="l01202" /><CodeLine lineNumber="1202"><Highlight kind="normal">    EdgeProbabilities&#91;<a href="/docs/api/namespaces/anonymous-blockfrequencyinfoimpl-cpp-/#aede9c090bfa516420939d4240fad8248">Weight</a>.<a href="/docs/api/structs/llvm/blockfrequencyinfoimplbase/weight/#a7d49b2704586051c51172cc77d4104b3">TargetNode</a>.<a href="/docs/api/structs/llvm/blockfrequencyinfoimplbase/blocknode/#afd6ff190a72a58d7c890cf480bc6f6e8">Index</a>&#93; = BP;</Highlight></CodeLine>
<Link id="l01203" /><CodeLine lineNumber="1203"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01204" /><CodeLine lineNumber="1204"><Highlight kind="normal">  BPI-&gt;setEdgeProbability(CodeReplacer, EdgeProbabilities);</Highlight></CodeLine>
<Link id="l01205" /><CodeLine lineNumber="1205"><Highlight kind="normal">  TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a9247a212ea89acc9573fa7e7f557eaba">setMetadata</a>(</Highlight></CodeLine>
<Link id="l01206" /><CodeLine lineNumber="1206"><Highlight kind="normal">      LLVMContext::MD&#95;prof,</Highlight></CodeLine>
<Link id="l01207" /><CodeLine lineNumber="1207"><Highlight kind="normal">      MDBuilder(TI-&gt;<a href="/docs/api/classes/llvm/value/#ab3fc0225d8aaf8434026c3573f961f2c">getContext</a>()).createBranchWeights(BranchWeights));</Highlight></CodeLine>
<Link id="l01208" /><CodeLine lineNumber="1208"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01209" /><CodeLine lineNumber="1209"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01210" /><CodeLine lineNumber="1210"><Highlight kind="comment">/// Erase debug info intrinsics which refer to values in \\p F but aren&#39;t in</Highlight></CodeLine>
<Link id="l01211" /><CodeLine lineNumber="1211"><Highlight kind="comment">/// \\p F.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01212" /><CodeLine lineNumber="1212" lineLink="#a01efda615d7f206d097e0280ab2fbaa7"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#a01efda615d7f206d097e0280ab2fbaa7">eraseDebugIntrinsicsWithNonLocalRefs</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>) &#123;</Highlight></CodeLine>
<Link id="l01213" /><CodeLine lineNumber="1213"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)) &#123;</Highlight></CodeLine>
<Link id="l01214" /><CodeLine lineNumber="1214"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableIntrinsic &#42;, 4&gt;</a> DbgUsers;</Highlight></CodeLine>
<Link id="l01215" /><CodeLine lineNumber="1215"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableRecord &#42;, 4&gt;</a> DbgVariableRecords;</Highlight></CodeLine>
<Link id="l01216" /><CodeLine lineNumber="1216"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a26bad0f6e5435a5a4dc50850c5b8f628">findDbgUsers</a>(DbgUsers, &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, &amp;DbgVariableRecords);</Highlight></CodeLine>
<Link id="l01217" /><CodeLine lineNumber="1217"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/dbgvariableintrinsic">DbgVariableIntrinsic</a> &#42;DVI : DbgUsers)</Highlight></CodeLine>
<Link id="l01218" /><CodeLine lineNumber="1218"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVI-&gt;getFunction() != &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</Highlight></CodeLine>
<Link id="l01219" /><CodeLine lineNumber="1219"><Highlight kind="normal">        DVI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01220" /><CodeLine lineNumber="1220"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &#42;DVR : DbgVariableRecords)</Highlight></CodeLine>
<Link id="l01221" /><CodeLine lineNumber="1221"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVR-&gt;getFunction() != &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#a96d73bbd7af15cb1fc38c3f4a3bd82e9">F</a>)</Highlight></CodeLine>
<Link id="l01222" /><CodeLine lineNumber="1222"><Highlight kind="normal">        DVR-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01223" /><CodeLine lineNumber="1223"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01224" /><CodeLine lineNumber="1224"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01225" /><CodeLine lineNumber="1225"><Highlight kind="normal"></Highlight><Highlight kind="comment"></Highlight></CodeLine>
<Link id="l01226" /><CodeLine lineNumber="1226"><Highlight kind="comment">/// Fix up the debug info in the old and new functions by pointing line</Highlight></CodeLine>
<Link id="l01227" /><CodeLine lineNumber="1227"><Highlight kind="comment">/// locations and debug intrinsics to the new subprogram scope, and by deleting</Highlight></CodeLine>
<Link id="l01228" /><CodeLine lineNumber="1228"><Highlight kind="comment">/// intrinsics which point to values outside of the new function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01229" /><CodeLine lineNumber="1229" lineLink="#aa1461454928a2518e7f3eea698b3a1da"><Highlight kind="normal"></Highlight><Highlight kind="keyword">static</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="#aa1461454928a2518e7f3eea698b3a1da">fixupDebugInfoPostExtraction</a>(<a href="/docs/api/classes/llvm/function">Function</a> &amp;OldFunc, <a href="/docs/api/classes/llvm/function">Function</a> &amp;NewFunc,</Highlight></CodeLine>
<Link id="l01230" /><CodeLine lineNumber="1230"><Highlight kind="normal">                                         <a href="/docs/api/classes/llvm/callinst">CallInst</a> &amp;TheCall) &#123;</Highlight></CodeLine>
<Link id="l01231" /><CodeLine lineNumber="1231"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/disubprogram">DISubprogram</a> &#42;OldSP = OldFunc.<a href="/docs/api/classes/llvm/function/#a4d834f9897d15e3a6349063b5d637cd8">getSubprogram</a>();</Highlight></CodeLine>
<Link id="l01232" /><CodeLine lineNumber="1232"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/llvmcontext">LLVMContext</a> &amp;Ctx = OldFunc.<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>();</Highlight></CodeLine>
<Link id="l01233" /><CodeLine lineNumber="1233"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01234" /><CodeLine lineNumber="1234"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!OldSP) &#123;</Highlight></CodeLine>
<Link id="l01235" /><CodeLine lineNumber="1235"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Erase any debug info the new function contains.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01236" /><CodeLine lineNumber="1236"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a21fc2a53fec95633917f4135b7ab645e">stripDebugInfo</a>(NewFunc);</Highlight></CodeLine>
<Link id="l01237" /><CodeLine lineNumber="1237"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Make sure the old function doesn&#39;t contain any non-local metadata refs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01238" /><CodeLine lineNumber="1238"><Highlight kind="normal">    <a href="#a01efda615d7f206d097e0280ab2fbaa7">eraseDebugIntrinsicsWithNonLocalRefs</a>(NewFunc);</Highlight></CodeLine>
<Link id="l01239" /><CodeLine lineNumber="1239"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01240" /><CodeLine lineNumber="1240"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01241" /><CodeLine lineNumber="1241"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01242" /><CodeLine lineNumber="1242"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create a subprogram for the new function. Leave out a description of the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01243" /><CodeLine lineNumber="1243"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// function arguments, as the parameters don&#39;t correspond to anything at the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01244" /><CodeLine lineNumber="1244"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// source level.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01245" /><CodeLine lineNumber="1245"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(OldSP-&gt;getUnit() &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Missing compile unit for subprogram&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01246" /><CodeLine lineNumber="1246"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/dibuilder">DIBuilder</a> DIB(&#42;OldFunc.<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>(), </Highlight><Highlight kind="comment">/&#42;AllowUnresolved=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01247" /><CodeLine lineNumber="1247"><Highlight kind="normal">                OldSP-&gt;getUnit());</Highlight></CodeLine>
<Link id="l01248" /><CodeLine lineNumber="1248"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> SPType = DIB.<a href="/docs/api/classes/llvm/dibuilder/#a1930fd092560cf172fb618ba55263ec7">createSubroutineType</a>(DIB.<a href="/docs/api/classes/llvm/dibuilder/#abf27ce323516bd289ce53d2e241581fc">getOrCreateTypeArray</a>(&#123;&#125;));</Highlight></CodeLine>
<Link id="l01249" /><CodeLine lineNumber="1249"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/disubprogram/#aee46b4d49ad15932fe2706f1d308d4e9">DISubprogram::DISPFlags</a> SPFlags = DISubprogram::SPFlagDefinition |</Highlight></CodeLine>
<Link id="l01250" /><CodeLine lineNumber="1250"><Highlight kind="normal">                                    DISubprogram::SPFlagOptimized |</Highlight></CodeLine>
<Link id="l01251" /><CodeLine lineNumber="1251"><Highlight kind="normal">                                    DISubprogram::SPFlagLocalToUnit;</Highlight></CodeLine>
<Link id="l01252" /><CodeLine lineNumber="1252"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> NewSP = DIB.<a href="/docs/api/classes/llvm/dibuilder/#a57d91109bab556ea565fe8dd35f1d30c">createFunction</a>(</Highlight></CodeLine>
<Link id="l01253" /><CodeLine lineNumber="1253"><Highlight kind="normal">      OldSP-&gt;getUnit(), NewFunc.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>(), NewFunc.<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>(), OldSP-&gt;<a href="/docs/api/classes/llvm/discope/#a693505a142c46203bb19ff1f09b5ea22">getFile</a>(),</Highlight></CodeLine>
<Link id="l01254" /><CodeLine lineNumber="1254"><Highlight kind="normal">      </Highlight><Highlight kind="comment">/&#42;LineNo=&#42;/</Highlight><Highlight kind="normal">0, SPType, </Highlight><Highlight kind="comment">/&#42;ScopeLine=&#42;/</Highlight><Highlight kind="normal">0, DINode::FlagZero, SPFlags);</Highlight></CodeLine>
<Link id="l01255" /><CodeLine lineNumber="1255"><Highlight kind="normal">  NewFunc.<a href="/docs/api/classes/llvm/function/#a05a19abc8ee11d5909275d980efa1670">setSubprogram</a>(NewSP);</Highlight></CodeLine>
<Link id="l01256" /><CodeLine lineNumber="1256"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01257" /><CodeLine lineNumber="1257"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> IsInvalidLocation = &#91;&amp;NewFunc&#93;(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Location) &#123;</Highlight></CodeLine>
<Link id="l01258" /><CodeLine lineNumber="1258"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Location is invalid if it isn&#39;t a constant or an instruction, or is an</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01259" /><CodeLine lineNumber="1259"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// instruction but isn&#39;t in the new function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01260" /><CodeLine lineNumber="1260"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Location ||</Highlight></CodeLine>
<Link id="l01261" /><CodeLine lineNumber="1261"><Highlight kind="normal">        (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Constant&gt;</a>(Location) &amp;&amp; !<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;Instruction&gt;</a>(Location)))</Highlight></CodeLine>
<Link id="l01262" /><CodeLine lineNumber="1262"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01263" /><CodeLine lineNumber="1263"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;LocationInst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Location);</Highlight></CodeLine>
<Link id="l01264" /><CodeLine lineNumber="1264"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> LocationInst &amp;&amp; LocationInst-&gt;<a href="/docs/api/classes/llvm/instruction/#a6a66ebb3aa12757479a3c88de77d78f8">getFunction</a>() != &amp;NewFunc;</Highlight></CodeLine>
<Link id="l01265" /><CodeLine lineNumber="1265"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01266" /><CodeLine lineNumber="1266"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01267" /><CodeLine lineNumber="1267"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Debug intrinsics in the new function need to be updated in one of two</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01268" /><CodeLine lineNumber="1268"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// ways:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01269" /><CodeLine lineNumber="1269"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  1) They need to be deleted, because they describe a value in the old</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01270" /><CodeLine lineNumber="1270"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01271" /><CodeLine lineNumber="1271"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//  2) They need to point to fresh metadata, e.g. because they currently</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01272" /><CodeLine lineNumber="1272"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//     point to a variable in the wrong scope.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01273" /><CodeLine lineNumber="1273"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smalldensemap">SmallDenseMap&lt;DINode &#42;, DINode &#42;&gt;</a> RemappedMetadata;</Highlight></CodeLine>
<Link id="l01274" /><CodeLine lineNumber="1274"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;Instruction &#42;, 4&gt;</a> DebugIntrinsicsToDelete;</Highlight></CodeLine>
<Link id="l01275" /><CodeLine lineNumber="1275"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallvector">SmallVector&lt;DbgVariableRecord &#42;, 4&gt;</a> DVRsToDelete;</Highlight></CodeLine>
<Link id="l01276" /><CodeLine lineNumber="1276"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;const MDNode &#42;, MDNode &#42;&gt;</a> Cache;</Highlight></CodeLine>
<Link id="l01277" /><CodeLine lineNumber="1277"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01278" /><CodeLine lineNumber="1278"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> GetUpdatedDIVariable = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/dilocalvariable">DILocalVariable</a> &#42;OldVar) &#123;</Highlight></CodeLine>
<Link id="l01279" /><CodeLine lineNumber="1279"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/dinode">DINode</a> &#42;&amp;NewVar = RemappedMetadata&#91;OldVar&#93;;</Highlight></CodeLine>
<Link id="l01280" /><CodeLine lineNumber="1280"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewVar) &#123;</Highlight></CodeLine>
<Link id="l01281" /><CodeLine lineNumber="1281"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/dilocalscope">DILocalScope</a> &#42;NewScope = <a href="/docs/api/classes/llvm/dilocalscope/#ae713d283078fedb08e45a4e893508866">DILocalScope::cloneScopeForSubprogram</a>(</Highlight></CodeLine>
<Link id="l01282" /><CodeLine lineNumber="1282"><Highlight kind="normal">          &#42;OldVar-&gt;getScope(), &#42;NewSP, Ctx, Cache);</Highlight></CodeLine>
<Link id="l01283" /><CodeLine lineNumber="1283"><Highlight kind="normal">      NewVar = DIB.<a href="/docs/api/classes/llvm/dibuilder/#ae6081972b0560d0f16bd503654924b1b">createAutoVariable</a>(</Highlight></CodeLine>
<Link id="l01284" /><CodeLine lineNumber="1284"><Highlight kind="normal">          NewScope, OldVar-&gt;<a href="/docs/api/classes/llvm/discope/#a4b0548df6ca16114b44faf5986a11f76">getName</a>(), OldVar-&gt;getFile(), OldVar-&gt;getLine(),</Highlight></CodeLine>
<Link id="l01285" /><CodeLine lineNumber="1285"><Highlight kind="normal">          OldVar-&gt;getType(), </Highlight><Highlight kind="comment">/&#42;AlwaysPreserve=&#42;/</Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">, DINode::FlagZero,</Highlight></CodeLine>
<Link id="l01286" /><CodeLine lineNumber="1286"><Highlight kind="normal">          OldVar-&gt;getAlignInBits());</Highlight></CodeLine>
<Link id="l01287" /><CodeLine lineNumber="1287"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01288" /><CodeLine lineNumber="1288"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;DILocalVariable&gt;</a>(NewVar);</Highlight></CodeLine>
<Link id="l01289" /><CodeLine lineNumber="1289"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01290" /><CodeLine lineNumber="1290"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01291" /><CodeLine lineNumber="1291"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> UpdateDbgLabel = &#91;&amp;&#93;(</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;LabelRecord) &#123;</Highlight></CodeLine>
<Link id="l01292" /><CodeLine lineNumber="1292"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Point the label record to a fresh label within the new function if</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01293" /><CodeLine lineNumber="1293"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// the record was not inlined from some other function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01294" /><CodeLine lineNumber="1294"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (LabelRecord-&gt;getDebugLoc().getInlinedAt())</Highlight></CodeLine>
<Link id="l01295" /><CodeLine lineNumber="1295"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01296" /><CodeLine lineNumber="1296"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/dilabel">DILabel</a> &#42;OldLabel = LabelRecord-&gt;getLabel();</Highlight></CodeLine>
<Link id="l01297" /><CodeLine lineNumber="1297"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/dinode">DINode</a> &#42;&amp;NewLabel = RemappedMetadata&#91;OldLabel&#93;;</Highlight></CodeLine>
<Link id="l01298" /><CodeLine lineNumber="1298"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!NewLabel) &#123;</Highlight></CodeLine>
<Link id="l01299" /><CodeLine lineNumber="1299"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/dilocalscope">DILocalScope</a> &#42;NewScope = <a href="/docs/api/classes/llvm/dilocalscope/#ae713d283078fedb08e45a4e893508866">DILocalScope::cloneScopeForSubprogram</a>(</Highlight></CodeLine>
<Link id="l01300" /><CodeLine lineNumber="1300"><Highlight kind="normal">          &#42;OldLabel-&gt;<a href="/docs/api/classes/llvm/dilabel/#a87999af3acdf673c2b50574a6a65d461">getScope</a>(), &#42;NewSP, Ctx, Cache);</Highlight></CodeLine>
<Link id="l01301" /><CodeLine lineNumber="1301"><Highlight kind="normal">      NewLabel = <a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DILabel::get</a>(Ctx, NewScope, OldLabel-&gt;<a href="/docs/api/classes/llvm/dilabel/#a2152c315a764477e671b0a4f706500ba">getName</a>(),</Highlight></CodeLine>
<Link id="l01302" /><CodeLine lineNumber="1302"><Highlight kind="normal">                              OldLabel-&gt;<a href="/docs/api/classes/llvm/dilabel/#a10b159813a0633143cfce1f2cc7bebf1">getFile</a>(), OldLabel-&gt;<a href="/docs/api/classes/llvm/dilabel/#a30e4e7c5816fb2eed1f26cf70390550a">getLine</a>());</Highlight></CodeLine>
<Link id="l01303" /><CodeLine lineNumber="1303"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01304" /><CodeLine lineNumber="1304"><Highlight kind="normal">    LabelRecord-&gt;setLabel(<a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;DILabel&gt;</a>(NewLabel));</Highlight></CodeLine>
<Link id="l01305" /><CodeLine lineNumber="1305"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01306" /><CodeLine lineNumber="1306"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01307" /><CodeLine lineNumber="1307"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> UpdateDbgRecordsOnInst = &#91;&amp;&#93;(<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) -&gt; </Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01308" /><CodeLine lineNumber="1308"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/dbgrecord">DbgRecord</a> &amp;DR : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDbgRecordRange()) &#123;</Highlight></CodeLine>
<Link id="l01309" /><CodeLine lineNumber="1309"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/dbglabelrecord">DbgLabelRecord</a> &#42;DLR = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;DbgLabelRecord&gt;</a>(&amp;DR)) &#123;</Highlight></CodeLine>
<Link id="l01310" /><CodeLine lineNumber="1310"><Highlight kind="normal">        UpdateDbgLabel(DLR);</Highlight></CodeLine>
<Link id="l01311" /><CodeLine lineNumber="1311"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01312" /><CodeLine lineNumber="1312"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01313" /><CodeLine lineNumber="1313"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01314" /><CodeLine lineNumber="1314"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/dbgvariablerecord">DbgVariableRecord</a> &amp;DVR = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;DbgVariableRecord&gt;</a>(DR);</Highlight></CodeLine>
<Link id="l01315" /><CodeLine lineNumber="1315"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Apply the two updates that dbg.values get: invalid operands, and</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01316" /><CodeLine lineNumber="1316"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// variable metadata fixup.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01317" /><CodeLine lineNumber="1317"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#afd3574da4a2a86d1540dbdfcef171dd8">location&#95;ops</a>(), IsInvalidLocation)) &#123;</Highlight></CodeLine>
<Link id="l01318" /><CodeLine lineNumber="1318"><Highlight kind="normal">        DVRsToDelete.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;DVR);</Highlight></CodeLine>
<Link id="l01319" /><CodeLine lineNumber="1319"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01320" /><CodeLine lineNumber="1320"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01321" /><CodeLine lineNumber="1321"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#a8e44c4d5de5d1134497e3ca3b922c535">isDbgAssign</a>() &amp;&amp; IsInvalidLocation(DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#a8b5e9ae479c5eea5e6d9179a0c203da1">getAddress</a>())) &#123;</Highlight></CodeLine>
<Link id="l01322" /><CodeLine lineNumber="1322"><Highlight kind="normal">        DVRsToDelete.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(&amp;DVR);</Highlight></CodeLine>
<Link id="l01323" /><CodeLine lineNumber="1323"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01324" /><CodeLine lineNumber="1324"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01325" /><CodeLine lineNumber="1325"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DVR.<a href="/docs/api/classes/llvm/dbgrecord/#a3a0f4e00c3f6345c52c6acd178b3fca3">getDebugLoc</a>().<a href="/docs/api/classes/llvm/debugloc/#ada0b6f3c53a53b7274e7aeb23eeab5a8">getInlinedAt</a>())</Highlight></CodeLine>
<Link id="l01326" /><CodeLine lineNumber="1326"><Highlight kind="normal">        DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#a8b176855918bd3a4e49e48ddb0d3660a">setVariable</a>(GetUpdatedDIVariable(DVR.<a href="/docs/api/classes/llvm/dbgvariablerecord/#aa774c62045e74bb457b32713c0670696">getVariable</a>()));</Highlight></CodeLine>
<Link id="l01327" /><CodeLine lineNumber="1327"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01328" /><CodeLine lineNumber="1328"><Highlight kind="normal">  &#125;;</Highlight></CodeLine>
<Link id="l01329" /><CodeLine lineNumber="1329"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01330" /><CodeLine lineNumber="1330"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a>(NewFunc)) &#123;</Highlight></CodeLine>
<Link id="l01331" /><CodeLine lineNumber="1331"><Highlight kind="normal">    UpdateDbgRecordsOnInst(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01332" /><CodeLine lineNumber="1332"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01333" /><CodeLine lineNumber="1333"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;DII = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;DbgInfoIntrinsic&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01334" /><CodeLine lineNumber="1334"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DII)</Highlight></CodeLine>
<Link id="l01335" /><CodeLine lineNumber="1335"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01336" /><CodeLine lineNumber="1336"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01337" /><CodeLine lineNumber="1337"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Point the intrinsic to a fresh label within the new function if the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01338" /><CodeLine lineNumber="1338"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// intrinsic was not inlined from some other function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01339" /><CodeLine lineNumber="1339"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;DLI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;DbgLabelInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l01340" /><CodeLine lineNumber="1340"><Highlight kind="normal">      UpdateDbgLabel(DLI);</Highlight></CodeLine>
<Link id="l01341" /><CodeLine lineNumber="1341"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01342" /><CodeLine lineNumber="1342"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01343" /><CodeLine lineNumber="1343"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01344" /><CodeLine lineNumber="1344"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;DVI = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;DbgVariableIntrinsic&gt;</a>(DII);</Highlight></CodeLine>
<Link id="l01345" /><CodeLine lineNumber="1345"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If any of the used locations are invalid, delete the intrinsic.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01346" /><CodeLine lineNumber="1346"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a61d13d6824ec46c31260a4fd0997eda0">any&#95;of</a>(DVI-&gt;location&#95;ops(), IsInvalidLocation)) &#123;</Highlight></CodeLine>
<Link id="l01347" /><CodeLine lineNumber="1347"><Highlight kind="normal">      DebugIntrinsicsToDelete.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(DVI);</Highlight></CodeLine>
<Link id="l01348" /><CodeLine lineNumber="1348"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01349" /><CodeLine lineNumber="1349"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01350" /><CodeLine lineNumber="1350"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// DbgAssign intrinsics have an extra Value argument:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01351" /><CodeLine lineNumber="1351"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;DAI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;DbgAssignIntrinsic&gt;</a>(DVI);</Highlight></CodeLine>
<Link id="l01352" /><CodeLine lineNumber="1352"><Highlight kind="normal">        DAI &amp;&amp; IsInvalidLocation(DAI-&gt;getAddress())) &#123;</Highlight></CodeLine>
<Link id="l01353" /><CodeLine lineNumber="1353"><Highlight kind="normal">      DebugIntrinsicsToDelete.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(DVI);</Highlight></CodeLine>
<Link id="l01354" /><CodeLine lineNumber="1354"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01355" /><CodeLine lineNumber="1355"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01356" /><CodeLine lineNumber="1356"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// If the variable was in the scope of the old function, i.e. it was not</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01357" /><CodeLine lineNumber="1357"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// inlined, point the intrinsic to a fresh variable within the new function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01358" /><CodeLine lineNumber="1358"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!DVI-&gt;getDebugLoc().getInlinedAt())</Highlight></CodeLine>
<Link id="l01359" /><CodeLine lineNumber="1359"><Highlight kind="normal">      DVI-&gt;setVariable(GetUpdatedDIVariable(DVI-&gt;getVariable()));</Highlight></CodeLine>
<Link id="l01360" /><CodeLine lineNumber="1360"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01361" /><CodeLine lineNumber="1361"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01362" /><CodeLine lineNumber="1362"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;DII : DebugIntrinsicsToDelete)</Highlight></CodeLine>
<Link id="l01363" /><CodeLine lineNumber="1363"><Highlight kind="normal">    DII-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01364" /><CodeLine lineNumber="1364"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;DVR : DVRsToDelete)</Highlight></CodeLine>
<Link id="l01365" /><CodeLine lineNumber="1365"><Highlight kind="normal">    DVR-&gt;getMarker()-&gt;MarkedInstr-&gt;dropOneDbgRecord(DVR);</Highlight></CodeLine>
<Link id="l01366" /><CodeLine lineNumber="1366"><Highlight kind="normal">  DIB.<a href="/docs/api/classes/llvm/dibuilder/#a2e5c0418b92861c5387f5f60b60ef614">finalizeSubprogram</a>(NewSP);</Highlight></CodeLine>
<Link id="l01367" /><CodeLine lineNumber="1367"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01368" /><CodeLine lineNumber="1368"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Fix up the scope information attached to the line locations and the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01369" /><CodeLine lineNumber="1369"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// debug assignment metadata in the new function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01370" /><CodeLine lineNumber="1370"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;DIAssignID &#42;, DIAssignID &#42;&gt;</a> AssignmentIDMap;</Highlight></CodeLine>
<Link id="l01371" /><CodeLine lineNumber="1371"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/files/lib/lib/codegen/atomicexpandpass-cpp/#a1bcc06b1cb86bd0ea08f33323190bdaa">instructions</a>(NewFunc)) &#123;</Highlight></CodeLine>
<Link id="l01372" /><CodeLine lineNumber="1372"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/debugloc">DebugLoc</a> &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDebugLoc())</Highlight></CodeLine>
<Link id="l01373" /><CodeLine lineNumber="1373"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.setDebugLoc(</Highlight></CodeLine>
<Link id="l01374" /><CodeLine lineNumber="1374"><Highlight kind="normal">          <a href="/docs/api/classes/llvm/debugloc/#aac09dfae0aafa3f07db67a5813f454ae">DebugLoc::replaceInlinedAtSubprogram</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>, &#42;NewSP, Ctx, Cache));</Highlight></CodeLine>
<Link id="l01375" /><CodeLine lineNumber="1375"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/dbgrecord">DbgRecord</a> &amp;DR : <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>.getDbgRecordRange())</Highlight></CodeLine>
<Link id="l01376" /><CodeLine lineNumber="1376"><Highlight kind="normal">      DR.setDebugLoc(<a href="/docs/api/classes/llvm/debugloc/#aac09dfae0aafa3f07db67a5813f454ae">DebugLoc::replaceInlinedAtSubprogram</a>(DR.getDebugLoc(),</Highlight></CodeLine>
<Link id="l01377" /><CodeLine lineNumber="1377"><Highlight kind="normal">                                                          &#42;NewSP, Ctx, Cache));</Highlight></CodeLine>
<Link id="l01378" /><CodeLine lineNumber="1378"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01379" /><CodeLine lineNumber="1379"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Loop info metadata may contain line locations. Fix them up.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01380" /><CodeLine lineNumber="1380"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> updateLoopInfoLoc = &#91;&amp;Ctx, &amp;Cache, NewSP&#93;(<a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42;MD) -&gt; <a href="/docs/api/classes/llvm/metadata">Metadata</a> &#42; &#123;</Highlight></CodeLine>
<Link id="l01381" /><CodeLine lineNumber="1381"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/namespaces/llvm/loc">Loc</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;DILocation&gt;</a>(MD))</Highlight></CodeLine>
<Link id="l01382" /><CodeLine lineNumber="1382"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/debugloc/#aac09dfae0aafa3f07db67a5813f454ae">DebugLoc::replaceInlinedAtSubprogram</a>(<a href="/docs/api/namespaces/llvm/loc">Loc</a>, &#42;NewSP, Ctx, Cache);</Highlight></CodeLine>
<Link id="l01383" /><CodeLine lineNumber="1383"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> MD;</Highlight></CodeLine>
<Link id="l01384" /><CodeLine lineNumber="1384"><Highlight kind="normal">    &#125;;</Highlight></CodeLine>
<Link id="l01385" /><CodeLine lineNumber="1385"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#aecd4ed57fa6a20d048310d43f5c96da9">updateLoopMetadataDebugLocations</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>, updateLoopInfoLoc);</Highlight></CodeLine>
<Link id="l01386" /><CodeLine lineNumber="1386"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/at/#a64974d467d808a48c21d2b455ce3ecdd">at::remapAssignID</a>(AssignmentIDMap, <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01387" /><CodeLine lineNumber="1387"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01388" /><CodeLine lineNumber="1388"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!TheCall.<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>())</Highlight></CodeLine>
<Link id="l01389" /><CodeLine lineNumber="1389"><Highlight kind="normal">    TheCall.<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/classes/llvm/mdnode/#a7d10a7b9b7f40b04d27ed97c38ea1950">DILocation::get</a>(Ctx, 0, 0, OldSP));</Highlight></CodeLine>
<Link id="l01390" /><CodeLine lineNumber="1390"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01391" /><CodeLine lineNumber="1391"><Highlight kind="normal">  <a href="#a01efda615d7f206d097e0280ab2fbaa7">eraseDebugIntrinsicsWithNonLocalRefs</a>(NewFunc);</Highlight></CodeLine>
<Link id="l01392" /><CodeLine lineNumber="1392"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01393" /><CodeLine lineNumber="1393"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01394" /><CodeLine lineNumber="1394"><Highlight kind="normal"><a href="/docs/api/classes/llvm/function">Function</a> &#42;</Highlight></CodeLine>
<Link id="l01395" /><CodeLine lineNumber="1395" lineLink="/docs/api/classes/llvm/codeextractor/#a8561c48aa0b397c37f9e071dad7df392"><Highlight kind="normal"><a href="/docs/api/classes/llvm/codeextractor/#a8561c48aa0b397c37f9e071dad7df392">CodeExtractor::extractCodeRegion</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/codeextractoranalysiscache">CodeExtractorAnalysisCache</a> &amp;CEAC) &#123;</Highlight></CodeLine>
<Link id="l01396" /><CodeLine lineNumber="1396"><Highlight kind="normal">  ValueSet Inputs, Outputs;</Highlight></CodeLine>
<Link id="l01397" /><CodeLine lineNumber="1397"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/codeextractor/#a8561c48aa0b397c37f9e071dad7df392">extractCodeRegion</a>(CEAC, Inputs, Outputs);</Highlight></CodeLine>
<Link id="l01398" /><CodeLine lineNumber="1398"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01399" /><CodeLine lineNumber="1399"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01400" /><CodeLine lineNumber="1400"><Highlight kind="normal"><a href="/docs/api/classes/llvm/function">Function</a> &#42;</Highlight></CodeLine>
<Link id="l01401" /><CodeLine lineNumber="1401" lineLink="/docs/api/classes/llvm/codeextractor/#ac0645a37d60eb4946b1b73c517a96544"><Highlight kind="normal"><a href="/docs/api/classes/llvm/codeextractor/#a8561c48aa0b397c37f9e071dad7df392">CodeExtractor::extractCodeRegion</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/codeextractoranalysiscache">CodeExtractorAnalysisCache</a> &amp;CEAC,</Highlight></CodeLine>
<Link id="l01402" /><CodeLine lineNumber="1402"><Highlight kind="normal">                                 ValueSet &amp;inputs, ValueSet &amp;outputs) &#123;</Highlight></CodeLine>
<Link id="l01403" /><CodeLine lineNumber="1403"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/classes/llvm/codeextractor/#ad3a4770e725305d3529cba8c6562c85a">isEligible</a>())</Highlight></CodeLine>
<Link id="l01404" /><CodeLine lineNumber="1404"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01405" /><CodeLine lineNumber="1405"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01406" /><CodeLine lineNumber="1406"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Assumption: this is a single-entry code region, and the header is the first</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01407" /><CodeLine lineNumber="1407"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// block in the region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01408" /><CodeLine lineNumber="1408"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;header = &#42;Blocks.<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>();</Highlight></CodeLine>
<Link id="l01409" /><CodeLine lineNumber="1409"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;oldFunction = header-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l01410" /><CodeLine lineNumber="1410"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01411" /><CodeLine lineNumber="1411"><Highlight kind="normal">  normalizeCFGForExtraction(header);</Highlight></CodeLine>
<Link id="l01412" /><CodeLine lineNumber="1412"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01413" /><CodeLine lineNumber="1413"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Remove @llvm.assume calls that will be moved to the new function from the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01414" /><CodeLine lineNumber="1414"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// old function&#39;s assumption cache.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01415" /><CodeLine lineNumber="1415"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : Blocks) &#123;</Highlight></CodeLine>
<Link id="l01416" /><CodeLine lineNumber="1416"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/instruction">Instruction</a> &amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> : <a href="/docs/api/namespaces/llvm/#a3d2cdc4a0db233678e7141c9d6ea3419">llvm::make&#95;early&#95;inc&#95;range</a>(&#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>)) &#123;</Highlight></CodeLine>
<Link id="l01417" /><CodeLine lineNumber="1417"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AssumeInst&gt;</a>(&amp;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)) &#123;</Highlight></CodeLine>
<Link id="l01418" /><CodeLine lineNumber="1418"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AC)</Highlight></CodeLine>
<Link id="l01419" /><CodeLine lineNumber="1419"><Highlight kind="normal">          AC-&gt;unregisterAssumption(AI);</Highlight></CodeLine>
<Link id="l01420" /><CodeLine lineNumber="1420"><Highlight kind="normal">        AI-&gt;eraseFromParent();</Highlight></CodeLine>
<Link id="l01421" /><CodeLine lineNumber="1421"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01422" /><CodeLine lineNumber="1422"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01423" /><CodeLine lineNumber="1423"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01424" /><CodeLine lineNumber="1424"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01425" /><CodeLine lineNumber="1425"><Highlight kind="normal">  ValueSet SinkingCands, HoistingCands;</Highlight></CodeLine>
<Link id="l01426" /><CodeLine lineNumber="1426"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;CommonExit = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01427" /><CodeLine lineNumber="1427"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/codeextractor/#a537993928c8af5b0d064fcd5ce1dec2f">findAllocas</a>(CEAC, SinkingCands, HoistingCands, CommonExit);</Highlight></CodeLine>
<Link id="l01428" /><CodeLine lineNumber="1428"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(HoistingCands.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>() || CommonExit);</Highlight></CodeLine>
<Link id="l01429" /><CodeLine lineNumber="1429"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01430" /><CodeLine lineNumber="1430"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Find inputs to, outputs from the code region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01431" /><CodeLine lineNumber="1431"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/codeextractor/#ab4d4236fd0a481a0d93e159a9882fc53">findInputsOutputs</a>(inputs, outputs, SinkingCands);</Highlight></CodeLine>
<Link id="l01432" /><CodeLine lineNumber="1432"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01433" /><CodeLine lineNumber="1433"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Collect objects which are inputs to the extraction region and also</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01434" /><CodeLine lineNumber="1434"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// referenced by lifetime start markers within it. The effects of these</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01435" /><CodeLine lineNumber="1435"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// markers must be replicated in the calling function to prevent the stack</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01436" /><CodeLine lineNumber="1436"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// coloring pass from merging slots which store input objects.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01437" /><CodeLine lineNumber="1437"><Highlight kind="normal">  ValueSet LifetimesStart;</Highlight></CodeLine>
<Link id="l01438" /><CodeLine lineNumber="1438"><Highlight kind="normal">  <a href="#a93144a1eb23283cfa213d7dccb12d683">eraseLifetimeMarkersOnInputs</a>(Blocks, SinkingCands, LifetimesStart);</Highlight></CodeLine>
<Link id="l01439" /><CodeLine lineNumber="1439"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01440" /><CodeLine lineNumber="1440"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!HoistingCands.<a href="/docs/api/classes/llvm/setvector/#ac178f4fc4e4a0642610c374256b9fb27">empty</a>()) &#123;</Highlight></CodeLine>
<Link id="l01441" /><CodeLine lineNumber="1441"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;HoistToBlock = <a href="/docs/api/classes/llvm/codeextractor/#a19ce83f3f1fef433e2ba91a0b2a196a0">findOrCreateBlockForHoisting</a>(CommonExit);</Highlight></CodeLine>
<Link id="l01442" /><CodeLine lineNumber="1442"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/instruction">Instruction</a> &#42;TI = HoistToBlock-&gt;getTerminator();</Highlight></CodeLine>
<Link id="l01443" /><CodeLine lineNumber="1443"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : HoistingCands)</Highlight></CodeLine>
<Link id="l01444" /><CodeLine lineNumber="1444"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)-&gt;<a href="/docs/api/classes/llvm/instruction/#af67d1f3a518964d80a109bb3d9d5cf1e">moveBefore</a>(TI-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01445" /><CodeLine lineNumber="1445"><Highlight kind="normal">    computeExtractedFuncRetVals();</Highlight></CodeLine>
<Link id="l01446" /><CodeLine lineNumber="1446"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01447" /><CodeLine lineNumber="1447"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01448" /><CodeLine lineNumber="1448"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// CFG/ExitBlocks must not change hereafter</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01449" /><CodeLine lineNumber="1449"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01450" /><CodeLine lineNumber="1450"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Calculate the entry frequency of the new function before we change the root</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01451" /><CodeLine lineNumber="1451"><Highlight kind="normal">  </Highlight><Highlight kind="comment">//   block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01452" /><CodeLine lineNumber="1452"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> EntryFreq;</Highlight></CodeLine>
<Link id="l01453" /><CodeLine lineNumber="1453"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, BlockFrequency&gt;</a> ExitWeights;</Highlight></CodeLine>
<Link id="l01454" /><CodeLine lineNumber="1454"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BFI) &#123;</Highlight></CodeLine>
<Link id="l01455" /><CodeLine lineNumber="1455"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(BPI &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Both BPI and BFI are required to preserve profile info&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01456" /><CodeLine lineNumber="1456"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Pred : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(header)) &#123;</Highlight></CodeLine>
<Link id="l01457" /><CodeLine lineNumber="1457"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.count(Pred))</Highlight></CodeLine>
<Link id="l01458" /><CodeLine lineNumber="1458"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01459" /><CodeLine lineNumber="1459"><Highlight kind="normal">      EntryFreq +=</Highlight></CodeLine>
<Link id="l01460" /><CodeLine lineNumber="1460"><Highlight kind="normal">          BFI-&gt;getBlockFreq(Pred) &#42; BPI-&gt;getEdgeProbability(Pred, header);</Highlight></CodeLine>
<Link id="l01461" /><CodeLine lineNumber="1461"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01462" /><CodeLine lineNumber="1462"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01463" /><CodeLine lineNumber="1463"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : ExtractedFuncRetVals) &#123;</Highlight></CodeLine>
<Link id="l01464" /><CodeLine lineNumber="1464"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : <a href="/docs/api/namespaces/llvm/#acb22fb04083152eee862457e42e8dc31">predecessors</a>(Succ)) &#123;</Highlight></CodeLine>
<Link id="l01465" /><CodeLine lineNumber="1465"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Blocks.count(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>))</Highlight></CodeLine>
<Link id="l01466" /><CodeLine lineNumber="1466"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01467" /><CodeLine lineNumber="1467"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01468" /><CodeLine lineNumber="1468"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Update the branch weight for this successor.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01469" /><CodeLine lineNumber="1469"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> &amp;BF = ExitWeights&#91;Succ&#93;;</Highlight></CodeLine>
<Link id="l01470" /><CodeLine lineNumber="1470"><Highlight kind="normal">        BF += BFI-&gt;getBlockFreq(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>) &#42; BPI-&gt;getEdgeProbability(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>, Succ);</Highlight></CodeLine>
<Link id="l01471" /><CodeLine lineNumber="1471"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l01472" /><CodeLine lineNumber="1472"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01473" /><CodeLine lineNumber="1473"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01474" /><CodeLine lineNumber="1474"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01475" /><CodeLine lineNumber="1475"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Determine position for the replacement code. Do so before header is moved</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01476" /><CodeLine lineNumber="1476"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// to the new function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01477" /><CodeLine lineNumber="1477"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ReplIP = header;</Highlight></CodeLine>
<Link id="l01478" /><CodeLine lineNumber="1478"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">while</Highlight><Highlight kind="normal"> (ReplIP &amp;&amp; Blocks.count(ReplIP))</Highlight></CodeLine>
<Link id="l01479" /><CodeLine lineNumber="1479"><Highlight kind="normal">    ReplIP = ReplIP-&gt;<a href="/docs/api/classes/llvm/ilist-node-with-parent/#a62ee7ece4986606d41363bc1f70d5ab2">getNextNode</a>();</Highlight></CodeLine>
<Link id="l01480" /><CodeLine lineNumber="1480"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01481" /><CodeLine lineNumber="1481"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Construct new function based on inputs/outputs &amp; add allocas for all defs.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01482" /><CodeLine lineNumber="1482"><Highlight kind="normal">  std::string SuffixToUse =</Highlight></CodeLine>
<Link id="l01483" /><CodeLine lineNumber="1483"><Highlight kind="normal">      Suffix.<a href="/docs/api/classes/llvm/basicblock/#a266367eb01c634406b32f816d2d9c6bf">empty</a>()</Highlight></CodeLine>
<Link id="l01484" /><CodeLine lineNumber="1484"><Highlight kind="normal">          ? (header-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>().empty() ? </Highlight><Highlight kind="stringliteral">&quot;extracted&quot;</Highlight><Highlight kind="normal"> : header-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>().<a href="/docs/api/classes/llvm/stringref/#a223dd14e7d12bc5cea01889b972a98b2">str</a>())</Highlight></CodeLine>
<Link id="l01485" /><CodeLine lineNumber="1485"><Highlight kind="normal">          : Suffix;</Highlight></CodeLine>
<Link id="l01486" /><CodeLine lineNumber="1486"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01487" /><CodeLine lineNumber="1487"><Highlight kind="normal">  ValueSet StructValues;</Highlight></CodeLine>
<Link id="l01488" /><CodeLine lineNumber="1488"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;StructTy = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01489" /><CodeLine lineNumber="1489"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function">Function</a> &#42;newFunction = constructFunctionDeclaration(</Highlight></CodeLine>
<Link id="l01490" /><CodeLine lineNumber="1490"><Highlight kind="normal">      inputs, outputs, EntryFreq, oldFunction-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.&quot;</Highlight><Highlight kind="normal"> + SuffixToUse,</Highlight></CodeLine>
<Link id="l01491" /><CodeLine lineNumber="1491"><Highlight kind="normal">      StructValues, StructTy);</Highlight></CodeLine>
<Link id="l01492" /><CodeLine lineNumber="1492"><Highlight kind="normal">  newFunction-&gt;<a href="/docs/api/classes/llvm/function/#a5f470380211ecb6cee767f1ef0f16ed0">IsNewDbgInfoFormat</a> = oldFunction-&gt;<a href="/docs/api/classes/llvm/function/#a5f470380211ecb6cee767f1ef0f16ed0">IsNewDbgInfoFormat</a>;</Highlight></CodeLine>
<Link id="l01493" /><CodeLine lineNumber="1493"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01494" /><CodeLine lineNumber="1494"><Highlight kind="normal">  emitFunctionBody(inputs, outputs, StructValues, newFunction, StructTy, header,</Highlight></CodeLine>
<Link id="l01495" /><CodeLine lineNumber="1495"><Highlight kind="normal">                   SinkingCands);</Highlight></CodeLine>
<Link id="l01496" /><CodeLine lineNumber="1496"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01497" /><CodeLine lineNumber="1497"><Highlight kind="normal">  std::vector&lt;Value &#42;&gt; Reloads;</Highlight></CodeLine>
<Link id="l01498" /><CodeLine lineNumber="1498"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;TheCall = emitReplacerCall(</Highlight></CodeLine>
<Link id="l01499" /><CodeLine lineNumber="1499"><Highlight kind="normal">      inputs, outputs, StructValues, newFunction, StructTy, oldFunction, ReplIP,</Highlight></CodeLine>
<Link id="l01500" /><CodeLine lineNumber="1500"><Highlight kind="normal">      EntryFreq, LifetimesStart.<a href="/docs/api/classes/llvm/setvector/#a0c7d0dae14eb8a5916fff9f72d8b46d2">getArrayRef</a>(), Reloads);</Highlight></CodeLine>
<Link id="l01501" /><CodeLine lineNumber="1501"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01502" /><CodeLine lineNumber="1502"><Highlight kind="normal">  insertReplacerCall(oldFunction, header, TheCall-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>(), outputs,</Highlight></CodeLine>
<Link id="l01503" /><CodeLine lineNumber="1503"><Highlight kind="normal">                     Reloads, ExitWeights);</Highlight></CodeLine>
<Link id="l01504" /><CodeLine lineNumber="1504"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01505" /><CodeLine lineNumber="1505"><Highlight kind="normal">  <a href="#aa1461454928a2518e7f3eea698b3a1da">fixupDebugInfoPostExtraction</a>(&#42;oldFunction, &#42;newFunction, &#42;TheCall);</Highlight></CodeLine>
<Link id="l01506" /><CodeLine lineNumber="1506"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01507" /><CodeLine lineNumber="1507"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a26389c546573f058ad8ecbdc5c1933cf">verifyFunction</a>(&#42;newFunction, &amp;<a href="/docs/api/namespaces/llvm/#a9a7b5c68c90f85baaedaa854cc5002cc">errs</a>())) &#123;</Highlight></CodeLine>
<Link id="l01508" /><CodeLine lineNumber="1508"><Highlight kind="normal">    newFunction-&gt;<a href="/docs/api/classes/llvm/value/#af7dca9a9e816ef69fd9e9467f64f72b4">dump</a>();</Highlight></CodeLine>
<Link id="l01509" /><CodeLine lineNumber="1509"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</Highlight><Highlight kind="stringliteral">&quot;verification of newFunction failed!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01510" /><CodeLine lineNumber="1510"><Highlight kind="normal">  &#125;);</Highlight></CodeLine>
<Link id="l01511" /><CodeLine lineNumber="1511"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a26389c546573f058ad8ecbdc5c1933cf">verifyFunction</a>(&#42;oldFunction))</Highlight></CodeLine>
<Link id="l01512" /><CodeLine lineNumber="1512"><Highlight kind="normal">                 <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</Highlight><Highlight kind="stringliteral">&quot;verification of oldFunction failed!&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l01513" /><CodeLine lineNumber="1513"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/support/debug-h/#a196897517069dda1bdb549e24468f7d7">LLVM&#95;DEBUG</a>(</Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AC &amp;&amp; <a href="/docs/api/classes/llvm/codeextractor/#a995ee70f3e9a0cb350322bb1e058a707">verifyAssumptionCache</a>(&#42;oldFunction, &#42;newFunction, AC))</Highlight></CodeLine>
<Link id="l01514" /><CodeLine lineNumber="1514"><Highlight kind="normal">                 <a href="/docs/api/namespaces/llvm/#a7f2a3d4dcfee70225988aec53ff1e173">report&#95;fatal&#95;error</a>(</Highlight><Highlight kind="stringliteral">&quot;Stale Asumption cache for old Function!&quot;</Highlight><Highlight kind="normal">));</Highlight></CodeLine>
<Link id="l01515" /><CodeLine lineNumber="1515"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> newFunction;</Highlight></CodeLine>
<Link id="l01516" /><CodeLine lineNumber="1516"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01517" /><CodeLine lineNumber="1517"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01518" /><CodeLine lineNumber="1518"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> CodeExtractor::normalizeCFGForExtraction(<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;&amp;header) &#123;</Highlight></CodeLine>
<Link id="l01519" /><CodeLine lineNumber="1519"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we have any return instructions in the region, split those blocks so</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01520" /><CodeLine lineNumber="1520"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// that the return is not in the region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01521" /><CodeLine lineNumber="1521"><Highlight kind="normal">  splitReturnBlocks();</Highlight></CodeLine>
<Link id="l01522" /><CodeLine lineNumber="1522"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01523" /><CodeLine lineNumber="1523"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If we have to split PHI nodes of the entry or exit blocks, do so now.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01524" /><CodeLine lineNumber="1524"><Highlight kind="normal">  severSplitPHINodesOfEntry(header);</Highlight></CodeLine>
<Link id="l01525" /><CodeLine lineNumber="1525"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01526" /><CodeLine lineNumber="1526"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// If a PHI in an exit block has multiple incoming values from the outlined</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01527" /><CodeLine lineNumber="1527"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// region, create a new PHI for those values within the region such that only</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01528" /><CodeLine lineNumber="1528"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// PHI itself becomes an output value, not each of its incoming values</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01529" /><CodeLine lineNumber="1529"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// individually.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01530" /><CodeLine lineNumber="1530"><Highlight kind="normal">  computeExtractedFuncRetVals();</Highlight></CodeLine>
<Link id="l01531" /><CodeLine lineNumber="1531"><Highlight kind="normal">  severSplitPHINodesOfExits();</Highlight></CodeLine>
<Link id="l01532" /><CodeLine lineNumber="1532"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01533" /><CodeLine lineNumber="1533"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01534" /><CodeLine lineNumber="1534"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> CodeExtractor::computeExtractedFuncRetVals() &#123;</Highlight></CodeLine>
<Link id="l01535" /><CodeLine lineNumber="1535"><Highlight kind="normal">  ExtractedFuncRetVals.clear();</Highlight></CodeLine>
<Link id="l01536" /><CodeLine lineNumber="1536"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01537" /><CodeLine lineNumber="1537"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/smallptrset">SmallPtrSet&lt;BasicBlock &#42;, 2&gt;</a> ExitBlocks;</Highlight></CodeLine>
<Link id="l01538" /><CodeLine lineNumber="1538"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : Blocks) &#123;</Highlight></CodeLine>
<Link id="l01539" /><CodeLine lineNumber="1539"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;Succ : <a href="/docs/api/namespaces/llvm/#a26e2a938b431eaa6eca2beaa96410c9d">successors</a>(<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>)) &#123;</Highlight></CodeLine>
<Link id="l01540" /><CodeLine lineNumber="1540"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.count(Succ))</Highlight></CodeLine>
<Link id="l01541" /><CodeLine lineNumber="1541"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01542" /><CodeLine lineNumber="1542"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01543" /><CodeLine lineNumber="1543"><Highlight kind="normal">      </Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> IsNew = ExitBlocks.<a href="/docs/api/classes/llvm/smallptrsetimpl/#a9d834ae3da8c62c2b668dada51335eb0">insert</a>(Succ).second;</Highlight></CodeLine>
<Link id="l01544" /><CodeLine lineNumber="1544"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (IsNew)</Highlight></CodeLine>
<Link id="l01545" /><CodeLine lineNumber="1545"><Highlight kind="normal">        ExtractedFuncRetVals.push&#95;back(Succ);</Highlight></CodeLine>
<Link id="l01546" /><CodeLine lineNumber="1546"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01547" /><CodeLine lineNumber="1547"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01548" /><CodeLine lineNumber="1548"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01549" /><CodeLine lineNumber="1549"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01550" /><CodeLine lineNumber="1550"><Highlight kind="normal"><a href="/docs/api/classes/llvm/type">Type</a> &#42;CodeExtractor::getSwitchType() &#123;</Highlight></CodeLine>
<Link id="l01551" /><CodeLine lineNumber="1551"><Highlight kind="normal">  LLVMContext &amp;Context = Blocks.front()-&gt;<a href="/docs/api/classes/llvm/type/#a909eca4ba9e5eefc203c8e3770bdab25">getContext</a>();</Highlight></CodeLine>
<Link id="l01552" /><CodeLine lineNumber="1552"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01553" /><CodeLine lineNumber="1553"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExtractedFuncRetVals.size() &lt; 65535 &amp;&amp;</Highlight></CodeLine>
<Link id="l01554" /><CodeLine lineNumber="1554"><Highlight kind="normal">         </Highlight><Highlight kind="stringliteral">&quot;too many exit blocks for switch&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01555" /><CodeLine lineNumber="1555"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (ExtractedFuncRetVals.size()) &#123;</Highlight></CodeLine>
<Link id="l01556" /><CodeLine lineNumber="1556"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> 0:</Highlight></CodeLine>
<Link id="l01557" /><CodeLine lineNumber="1557"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> 1:</Highlight></CodeLine>
<Link id="l01558" /><CodeLine lineNumber="1558"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/type/#a6e20e76960d952de088354cbcd14c3ab">Type::getVoidTy</a>(Context);</Highlight></CodeLine>
<Link id="l01559" /><CodeLine lineNumber="1559"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> 2:</Highlight></CodeLine>
<Link id="l01560" /><CodeLine lineNumber="1560"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Conditional branch, return a bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01561" /><CodeLine lineNumber="1561"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/type/#aa75984a442f2379de0c66018201fa628">Type::getInt1Ty</a>(Context);</Highlight></CodeLine>
<Link id="l01562" /><CodeLine lineNumber="1562"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l01563" /><CodeLine lineNumber="1563"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/type/#a87f56db834c58ca630624956ecf6972f">Type::getInt16Ty</a>(Context);</Highlight></CodeLine>
<Link id="l01564" /><CodeLine lineNumber="1564"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01565" /><CodeLine lineNumber="1565"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01566" /><CodeLine lineNumber="1566"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01567" /><CodeLine lineNumber="1567"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> CodeExtractor::emitFunctionBody(</Highlight></CodeLine>
<Link id="l01568" /><CodeLine lineNumber="1568"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> ValueSet &amp;inputs, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> ValueSet &amp;outputs,</Highlight></CodeLine>
<Link id="l01569" /><CodeLine lineNumber="1569"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> ValueSet &amp;StructValues, <a href="/docs/api/classes/llvm/function">Function</a> &#42;newFunction,</Highlight></CodeLine>
<Link id="l01570" /><CodeLine lineNumber="1570"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;StructArgTy, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;header, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> ValueSet &amp;SinkingCands) &#123;</Highlight></CodeLine>
<Link id="l01571" /><CodeLine lineNumber="1571"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/codeview/#adfebd8c4ae29ccd84c600c1e65d6b807a86408593c34af77fdd90df932f8b5261">Function</a> &#42;oldFunction = header-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>();</Highlight></CodeLine>
<Link id="l01572" /><CodeLine lineNumber="1572"><Highlight kind="normal">  LLVMContext &amp;Context = oldFunction-&gt;<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>();</Highlight></CodeLine>
<Link id="l01573" /><CodeLine lineNumber="1573"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01574" /><CodeLine lineNumber="1574"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// The new function needs a root node because other nodes can branch to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01575" /><CodeLine lineNumber="1575"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// head of the region, but the entry node of a function cannot have preds.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01576" /><CodeLine lineNumber="1576"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;newFuncRoot =</Highlight></CodeLine>
<Link id="l01577" /><CodeLine lineNumber="1577"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Context, </Highlight><Highlight kind="stringliteral">&quot;newFuncRoot&quot;</Highlight><Highlight kind="normal">, newFunction);</Highlight></CodeLine>
<Link id="l01578" /><CodeLine lineNumber="1578"><Highlight kind="normal">  newFuncRoot-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab571b8358a3a8b6db1327d06bdc5e9f4">IsNewDbgInfoFormat</a> = oldFunction-&gt;<a href="/docs/api/classes/llvm/function/#a5f470380211ecb6cee767f1ef0f16ed0">IsNewDbgInfoFormat</a>;</Highlight></CodeLine>
<Link id="l01579" /><CodeLine lineNumber="1579"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01580" /><CodeLine lineNumber="1580"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now sink all instructions which only have non-phi uses inside the region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01581" /><CodeLine lineNumber="1581"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Group the allocas at the start of the block, so that any bitcast uses of</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01582" /><CodeLine lineNumber="1582"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the allocas are well-defined.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01583" /><CodeLine lineNumber="1583"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : SinkingCands) &#123;</Highlight></CodeLine>
<Link id="l01584" /><CodeLine lineNumber="1584"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)) &#123;</Highlight></CodeLine>
<Link id="l01585" /><CodeLine lineNumber="1585"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)-&gt;moveBefore(&#42;newFuncRoot,</Highlight></CodeLine>
<Link id="l01586" /><CodeLine lineNumber="1586"><Highlight kind="normal">                                        newFuncRoot-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</Highlight></CodeLine>
<Link id="l01587" /><CodeLine lineNumber="1587"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01588" /><CodeLine lineNumber="1588"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01589" /><CodeLine lineNumber="1589"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a> : SinkingCands) &#123;</Highlight></CodeLine>
<Link id="l01590" /><CodeLine lineNumber="1590"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;AllocaInst&gt;</a>(<a href="/docs/api/files/lib/lib/target/lib/target/nvptx/nvvmintrrange-cpp/#ac5804672fc0850438d63caec770647f8">II</a>)) &#123;</Highlight></CodeLine>
<Link id="l01591" /><CodeLine lineNumber="1591"><Highlight kind="normal">      AI-&gt;moveBefore(&#42;newFuncRoot, newFuncRoot-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</Highlight></CodeLine>
<Link id="l01592" /><CodeLine lineNumber="1592"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01593" /><CodeLine lineNumber="1593"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01594" /><CodeLine lineNumber="1594"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01595" /><CodeLine lineNumber="1595"><Highlight kind="normal">  <a href="/docs/api/classes/llvm/function/#a1c9f2f058966db1f8ca270398bda8362">Function::arg&#95;iterator</a> ScalarAI = newFunction-&gt;<a href="/docs/api/classes/llvm/function/#a8bf193a781a92cae52d7f9216d0824f8">arg&#95;begin</a>();</Highlight></CodeLine>
<Link id="l01596" /><CodeLine lineNumber="1596"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/logicalview/#a9696bc411b0a7022c2cc78bff5173cefa1853680a6d666b9fea2d789dd00bc7eb">Argument</a> &#42;AggArg = StructValues.empty()</Highlight></CodeLine>
<Link id="l01597" /><CodeLine lineNumber="1597"><Highlight kind="normal">                         ? nullptr</Highlight></CodeLine>
<Link id="l01598" /><CodeLine lineNumber="1598"><Highlight kind="normal">                         : newFunction-&gt;<a href="/docs/api/classes/llvm/function/#aecf2b6d6f052a378dd8f69fd1bb700b1">getArg</a>(newFunction-&gt;<a href="/docs/api/classes/llvm/function/#ac6baa801e4aea800984e760d5460662f">arg&#95;size</a>() - 1);</Highlight></CodeLine>
<Link id="l01599" /><CodeLine lineNumber="1599"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01600" /><CodeLine lineNumber="1600"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Rewrite all users of the inputs in the extracted region to use the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01601" /><CodeLine lineNumber="1601"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// arguments (or appropriate addressing into struct) instead.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01602" /><CodeLine lineNumber="1602"><Highlight kind="normal">  SmallVector&lt;Value &#42;&gt; NewValues;</Highlight></CodeLine>
<Link id="l01603" /><CodeLine lineNumber="1603"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = inputs.size(), aggIdx = 0; i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l01604" /><CodeLine lineNumber="1604"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RewriteVal;</Highlight></CodeLine>
<Link id="l01605" /><CodeLine lineNumber="1605"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StructValues.contains(inputs&#91;i&#93;)) &#123;</Highlight></CodeLine>
<Link id="l01606" /><CodeLine lineNumber="1606"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Idx&#91;2&#93;;</Highlight></CodeLine>
<Link id="l01607" /><CodeLine lineNumber="1607"><Highlight kind="normal">      Idx&#91;0&#93; = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(header-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>()));</Highlight></CodeLine>
<Link id="l01608" /><CodeLine lineNumber="1608"><Highlight kind="normal">      Idx&#91;1&#93; = ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(header-&gt;<a href="/docs/api/classes/llvm/basicblock/#aa286a0f7f5d38488d593bb7ef0ba183e">getContext</a>()), aggIdx);</Highlight></CodeLine>
<Link id="l01609" /><CodeLine lineNumber="1609"><Highlight kind="normal">      GetElementPtrInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/classes/llvm/getelementptrinst/#a7e5d474f9fda4b2b2e5de3dcfefcc472">GetElementPtrInst::Create</a>(</Highlight></CodeLine>
<Link id="l01610" /><CodeLine lineNumber="1610"><Highlight kind="normal">          StructArgTy, AggArg, Idx, </Highlight><Highlight kind="stringliteral">&quot;gep&#95;&quot;</Highlight><Highlight kind="normal"> + inputs&#91;i&#93;-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/provenanceanalysisevaluator-cpp/#a2ee79648e8bce3ddbb26358ff10e3e82">getName</a>(), newFuncRoot);</Highlight></CodeLine>
<Link id="l01611" /><CodeLine lineNumber="1611"><Highlight kind="normal">      RewriteVal = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> LoadInst(StructArgTy-&gt;<a href="/docs/api/classes/llvm/structtype/#aee3c78d73273cb8449cd10cc15edcb83">getElementType</a>(aggIdx), <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>,</Highlight></CodeLine>
<Link id="l01612" /><CodeLine lineNumber="1612"><Highlight kind="normal">                                </Highlight><Highlight kind="stringliteral">&quot;loadgep&#95;&quot;</Highlight><Highlight kind="normal"> + inputs&#91;i&#93;-&gt;getName(), newFuncRoot);</Highlight></CodeLine>
<Link id="l01613" /><CodeLine lineNumber="1613"><Highlight kind="normal">      ++aggIdx;</Highlight></CodeLine>
<Link id="l01614" /><CodeLine lineNumber="1614"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01615" /><CodeLine lineNumber="1615"><Highlight kind="normal">      RewriteVal = &amp;&#42;ScalarAI++;</Highlight></CodeLine>
<Link id="l01616" /><CodeLine lineNumber="1616"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01617" /><CodeLine lineNumber="1617"><Highlight kind="normal">    NewValues.<a href="/docs/api/classes/llvm/smallvectortemplatebase/#af42bfbc067df27c19ee2fc859df58799">push&#95;back</a>(RewriteVal);</Highlight></CodeLine>
<Link id="l01618" /><CodeLine lineNumber="1618"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01619" /><CodeLine lineNumber="1619"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01620" /><CodeLine lineNumber="1620"><Highlight kind="normal">  moveCodeToFunction(newFunction);</Highlight></CodeLine>
<Link id="l01621" /><CodeLine lineNumber="1621"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01622" /><CodeLine lineNumber="1622"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = inputs.size(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l01623" /><CodeLine lineNumber="1623"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;RewriteVal = NewValues&#91;i&#93;;</Highlight></CodeLine>
<Link id="l01624" /><CodeLine lineNumber="1624"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01625" /><CodeLine lineNumber="1625"><Highlight kind="normal">    std::vector&lt;User &#42;&gt; <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>(inputs&#91;i&#93;-&gt;user&#95;begin(), inputs&#91;i&#93;-&gt;user&#95;end());</Highlight></CodeLine>
<Link id="l01626" /><CodeLine lineNumber="1626"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (User &#42;<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/localizer-cpp/#a428090a453f41a199ef67fc3f2179fbc">use</a> : <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>)</Highlight></CodeLine>
<Link id="l01627" /><CodeLine lineNumber="1627"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Instruction &#42;inst = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(<a href="/docs/api/files/lib/lib/codegen/lib/codegen/globalisel/localizer-cpp/#a428090a453f41a199ef67fc3f2179fbc">use</a>))</Highlight></CodeLine>
<Link id="l01628" /><CodeLine lineNumber="1628"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.count(inst-&gt;getParent()))</Highlight></CodeLine>
<Link id="l01629" /><CodeLine lineNumber="1629"><Highlight kind="normal">          inst-&gt;replaceUsesOfWith(inputs&#91;i&#93;, RewriteVal);</Highlight></CodeLine>
<Link id="l01630" /><CodeLine lineNumber="1630"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01631" /><CodeLine lineNumber="1631"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01632" /><CodeLine lineNumber="1632"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Since there may be multiple exits from the original region, make the new</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01633" /><CodeLine lineNumber="1633"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// function return an unsigned, switch on that number.  This loop iterates</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01634" /><CodeLine lineNumber="1634"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// over all of the blocks in the extracted region, updating any terminator</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01635" /><CodeLine lineNumber="1635"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// instructions in the to-be-extracted region that branch to blocks that are</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01636" /><CodeLine lineNumber="1636"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// not in the region to be extracted.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01637" /><CodeLine lineNumber="1637"><Highlight kind="normal">  std::map&lt;BasicBlock &#42;, BasicBlock &#42;&gt; ExitBlockMap;</Highlight></CodeLine>
<Link id="l01638" /><CodeLine lineNumber="1638"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01639" /><CodeLine lineNumber="1639"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Iterate over the previously collected targets, and create new blocks inside</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01640" /><CodeLine lineNumber="1640"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the function to branch to.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01641" /><CodeLine lineNumber="1641"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ExtractedFuncRetVals)) &#123;</Highlight></CodeLine>
<Link id="l01642" /><CodeLine lineNumber="1642"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;OldTarget = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.value();</Highlight></CodeLine>
<Link id="l01643" /><CodeLine lineNumber="1643"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">size&#95;t</Highlight><Highlight kind="normal"> SuccNum = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.index();</Highlight></CodeLine>
<Link id="l01644" /><CodeLine lineNumber="1644"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01645" /><CodeLine lineNumber="1645"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;NewTarget = <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(</Highlight></CodeLine>
<Link id="l01646" /><CodeLine lineNumber="1646"><Highlight kind="normal">        Context, OldTarget-&gt;<a href="/docs/api/classes/llvm/value/#adb5c319f5905c1d3ca9eb5df546388c5">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.exitStub&quot;</Highlight><Highlight kind="normal">, newFunction);</Highlight></CodeLine>
<Link id="l01647" /><CodeLine lineNumber="1647"><Highlight kind="normal">    ExitBlockMap&#91;OldTarget&#93; = NewTarget;</Highlight></CodeLine>
<Link id="l01648" /><CodeLine lineNumber="1648"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01649" /><CodeLine lineNumber="1649"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;brVal = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01650" /><CodeLine lineNumber="1650"><Highlight kind="normal">    <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;RetTy = getSwitchType();</Highlight></CodeLine>
<Link id="l01651" /><CodeLine lineNumber="1651"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ExtractedFuncRetVals.size() &lt; 65535 &amp;&amp;</Highlight></CodeLine>
<Link id="l01652" /><CodeLine lineNumber="1652"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;too many exit blocks for switch&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01653" /><CodeLine lineNumber="1653"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (ExtractedFuncRetVals.size()) &#123;</Highlight></CodeLine>
<Link id="l01654" /><CodeLine lineNumber="1654"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> 0:</Highlight></CodeLine>
<Link id="l01655" /><CodeLine lineNumber="1655"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> 1:</Highlight></CodeLine>
<Link id="l01656" /><CodeLine lineNumber="1656"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// No value needed.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01657" /><CodeLine lineNumber="1657"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01658" /><CodeLine lineNumber="1658"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> 2: </Highlight><Highlight kind="comment">// Conditional branch, return a bool</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01659" /><CodeLine lineNumber="1659"><Highlight kind="normal">      brVal = ConstantInt::get(RetTy, !SuccNum);</Highlight></CodeLine>
<Link id="l01660" /><CodeLine lineNumber="1660"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01661" /><CodeLine lineNumber="1661"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l01662" /><CodeLine lineNumber="1662"><Highlight kind="normal">      brVal = ConstantInt::get(RetTy, SuccNum);</Highlight></CodeLine>
<Link id="l01663" /><CodeLine lineNumber="1663"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01664" /><CodeLine lineNumber="1664"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01665" /><CodeLine lineNumber="1665"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01666" /><CodeLine lineNumber="1666"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/returninst/#a932710d4c1c965497707751eb4f7948f">ReturnInst::Create</a>(Context, brVal, NewTarget);</Highlight></CodeLine>
<Link id="l01667" /><CodeLine lineNumber="1667"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01668" /><CodeLine lineNumber="1668"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01669" /><CodeLine lineNumber="1669"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (BasicBlock &#42;<a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a> : Blocks) &#123;</Highlight></CodeLine>
<Link id="l01670" /><CodeLine lineNumber="1670"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;TI = <a href="/docs/api/namespaces/llvm/#a0e00fad9c34de40b1e31f3aa6f8e024cae1e4c8c9ccd9fc39c391da4bcd093fb2">Block</a>-&gt;getTerminator();</Highlight></CodeLine>
<Link id="l01671" /><CodeLine lineNumber="1671"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a3287172f2d13af086e6d66364e8c6de3">getNumSuccessors</a>(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l01672" /><CodeLine lineNumber="1672"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Blocks.count(TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(i)))</Highlight></CodeLine>
<Link id="l01673" /><CodeLine lineNumber="1673"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01674" /><CodeLine lineNumber="1674"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;OldTarget = TI-&gt;<a href="/docs/api/classes/llvm/instruction/#a6e5d2e18c81baaeec7dadc81a0dea993">getSuccessor</a>(i);</Highlight></CodeLine>
<Link id="l01675" /><CodeLine lineNumber="1675"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// add a new basic block which returns the appropriate value</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01676" /><CodeLine lineNumber="1676"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;NewTarget = ExitBlockMap&#91;OldTarget&#93;;</Highlight></CodeLine>
<Link id="l01677" /><CodeLine lineNumber="1677"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(NewTarget &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Unknown target block!&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01678" /><CodeLine lineNumber="1678"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01679" /><CodeLine lineNumber="1679"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// rewrite the original branch instruction with this new target</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01680" /><CodeLine lineNumber="1680"><Highlight kind="normal">      TI-&gt;<a href="/docs/api/classes/llvm/instruction/#ae959364e4640ac025bbc046d3d7c7e61">setSuccessor</a>(i, NewTarget);</Highlight></CodeLine>
<Link id="l01681" /><CodeLine lineNumber="1681"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01682" /><CodeLine lineNumber="1682"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01683" /><CodeLine lineNumber="1683"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01684" /><CodeLine lineNumber="1684"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Loop over all of the PHI nodes in the header and exit blocks, and change</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01685" /><CodeLine lineNumber="1685"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// any references to the old incoming edge to be the new incoming edge.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01686" /><CodeLine lineNumber="1686"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = header-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0ed5f3ab3c2e4196ee0cffffa080c062">begin</a>(); <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>); ++<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>) &#123;</Highlight></CodeLine>
<Link id="l01687" /><CodeLine lineNumber="1687"><Highlight kind="normal">    PHINode &#42;PN = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;PHINode&gt;</a>(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>);</Highlight></CodeLine>
<Link id="l01688" /><CodeLine lineNumber="1688"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = PN-&gt;<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i)</Highlight></CodeLine>
<Link id="l01689" /><CodeLine lineNumber="1689"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Blocks.count(PN-&gt;<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i)))</Highlight></CodeLine>
<Link id="l01690" /><CodeLine lineNumber="1690"><Highlight kind="normal">        PN-&gt;<a href="/docs/api/classes/llvm/phinode/#a5ba57877c55dfdbe6e3bbfdacd9ef8c1">setIncomingBlock</a>(i, newFuncRoot);</Highlight></CodeLine>
<Link id="l01691" /><CodeLine lineNumber="1691"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01692" /><CodeLine lineNumber="1692"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01693" /><CodeLine lineNumber="1693"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Connect newFunction entry block to new header.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01694" /><CodeLine lineNumber="1694"><Highlight kind="normal">  BranchInst &#42;BranchI = <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(header, newFuncRoot);</Highlight></CodeLine>
<Link id="l01695" /><CodeLine lineNumber="1695"><Highlight kind="normal">  <a href="#a19cc77dc725d4cbbf994e5db311e3c97">applyFirstDebugLoc</a>(oldFunction, Blocks.getArrayRef(), BranchI);</Highlight></CodeLine>
<Link id="l01696" /><CodeLine lineNumber="1696"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01697" /><CodeLine lineNumber="1697"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Store the arguments right after the definition of output value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01698" /><CodeLine lineNumber="1698"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This should be proceeded after creating exit stubs to be ensure that invoke</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01699" /><CodeLine lineNumber="1699"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// result restore will be placed in the outlined function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01700" /><CodeLine lineNumber="1700"><Highlight kind="normal">  ScalarAI = newFunction-&gt;<a href="/docs/api/classes/llvm/function/#a8bf193a781a92cae52d7f9216d0824f8">arg&#95;begin</a>();</Highlight></CodeLine>
<Link id="l01701" /><CodeLine lineNumber="1701"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AggIdx = 0;</Highlight></CodeLine>
<Link id="l01702" /><CodeLine lineNumber="1702"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01703" /><CodeLine lineNumber="1703"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Input : inputs) &#123;</Highlight></CodeLine>
<Link id="l01704" /><CodeLine lineNumber="1704"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StructValues.contains(Input))</Highlight></CodeLine>
<Link id="l01705" /><CodeLine lineNumber="1705"><Highlight kind="normal">      ++AggIdx;</Highlight></CodeLine>
<Link id="l01706" /><CodeLine lineNumber="1706"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01707" /><CodeLine lineNumber="1707"><Highlight kind="normal">      ++ScalarAI;</Highlight></CodeLine>
<Link id="l01708" /><CodeLine lineNumber="1708"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01709" /><CodeLine lineNumber="1709"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01710" /><CodeLine lineNumber="1710"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Output : outputs) &#123;</Highlight></CodeLine>
<Link id="l01711" /><CodeLine lineNumber="1711"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Find proper insertion point.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01712" /><CodeLine lineNumber="1712"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// In case Output is an invoke, we insert the store at the beginning in the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01713" /><CodeLine lineNumber="1713"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// &#39;normal destination&#39; BB. Otherwise we insert the store right after</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01714" /><CodeLine lineNumber="1714"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Output.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01715" /><CodeLine lineNumber="1715"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/basicblock/#a98c0a84a5dfa8bce341c829709f171e5">BasicBlock::iterator</a> InsertPt;</Highlight></CodeLine>
<Link id="l01716" /><CodeLine lineNumber="1716"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;InvokeI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;InvokeInst&gt;</a>(Output))</Highlight></CodeLine>
<Link id="l01717" /><CodeLine lineNumber="1717"><Highlight kind="normal">      InsertPt = InvokeI-&gt;getNormalDest()-&gt;getFirstInsertionPt();</Highlight></CodeLine>
<Link id="l01718" /><CodeLine lineNumber="1718"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;Phi = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;PHINode&gt;</a>(Output))</Highlight></CodeLine>
<Link id="l01719" /><CodeLine lineNumber="1719"><Highlight kind="normal">      InsertPt = <a href="/docs/api/namespaces/llvm/rdf/#a379bee2dadbfd1d7a599f003c4275dd8">Phi</a>-&gt;getParent()-&gt;getFirstInsertionPt();</Highlight></CodeLine>
<Link id="l01720" /><CodeLine lineNumber="1720"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;OutI = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(Output))</Highlight></CodeLine>
<Link id="l01721" /><CodeLine lineNumber="1721"><Highlight kind="normal">      InsertPt = std::next(OutI-&gt;getIterator());</Highlight></CodeLine>
<Link id="l01722" /><CodeLine lineNumber="1722"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01723" /><CodeLine lineNumber="1723"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Globals don&#39;t need to be updated, just advance to the next argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01724" /><CodeLine lineNumber="1724"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StructValues.contains(Output))</Highlight></CodeLine>
<Link id="l01725" /><CodeLine lineNumber="1725"><Highlight kind="normal">        ++AggIdx;</Highlight></CodeLine>
<Link id="l01726" /><CodeLine lineNumber="1726"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01727" /><CodeLine lineNumber="1727"><Highlight kind="normal">        ++ScalarAI;</Highlight></CodeLine>
<Link id="l01728" /><CodeLine lineNumber="1728"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01729" /><CodeLine lineNumber="1729"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01730" /><CodeLine lineNumber="1730"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01731" /><CodeLine lineNumber="1731"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>((InsertPt-&gt;getFunction() == newFunction ||</Highlight></CodeLine>
<Link id="l01732" /><CodeLine lineNumber="1732"><Highlight kind="normal">            Blocks.count(InsertPt-&gt;getParent())) &amp;&amp;</Highlight></CodeLine>
<Link id="l01733" /><CodeLine lineNumber="1733"><Highlight kind="normal">           </Highlight><Highlight kind="stringliteral">&quot;InsertPt should be in new function&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01734" /><CodeLine lineNumber="1734"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01735" /><CodeLine lineNumber="1735"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StructValues.contains(Output)) &#123;</Highlight></CodeLine>
<Link id="l01736" /><CodeLine lineNumber="1736"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(AggArg &amp;&amp; </Highlight><Highlight kind="stringliteral">&quot;Number of aggregate output arguments should match &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01737" /><CodeLine lineNumber="1737"><Highlight kind="normal">                       </Highlight><Highlight kind="stringliteral">&quot;the number of defined values&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01738" /><CodeLine lineNumber="1738"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Idx&#91;2&#93;;</Highlight></CodeLine>
<Link id="l01739" /><CodeLine lineNumber="1739"><Highlight kind="normal">      Idx&#91;0&#93; = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Context));</Highlight></CodeLine>
<Link id="l01740" /><CodeLine lineNumber="1740"><Highlight kind="normal">      Idx&#91;1&#93; = ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Context), AggIdx);</Highlight></CodeLine>
<Link id="l01741" /><CodeLine lineNumber="1741"><Highlight kind="normal">      GetElementPtrInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/classes/llvm/getelementptrinst/#a7e5d474f9fda4b2b2e5de3dcfefcc472">GetElementPtrInst::Create</a>(</Highlight></CodeLine>
<Link id="l01742" /><CodeLine lineNumber="1742"><Highlight kind="normal">          StructArgTy, AggArg, Idx, </Highlight><Highlight kind="stringliteral">&quot;gep&#95;&quot;</Highlight><Highlight kind="normal"> + Output-&gt;getName(), InsertPt);</Highlight></CodeLine>
<Link id="l01743" /><CodeLine lineNumber="1743"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> StoreInst(Output, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, InsertPt);</Highlight></CodeLine>
<Link id="l01744" /><CodeLine lineNumber="1744"><Highlight kind="normal">      ++AggIdx;</Highlight></CodeLine>
<Link id="l01745" /><CodeLine lineNumber="1745"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01746" /><CodeLine lineNumber="1746"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(ScalarAI != newFunction-&gt;<a href="/docs/api/classes/llvm/function/#a8300ac1ef141b8a7c63c13fa9369d976">arg&#95;end</a>() &amp;&amp;</Highlight></CodeLine>
<Link id="l01747" /><CodeLine lineNumber="1747"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;Number of scalar output arguments should match &quot;</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01748" /><CodeLine lineNumber="1748"><Highlight kind="normal">             </Highlight><Highlight kind="stringliteral">&quot;the number of defined values&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01749" /><CodeLine lineNumber="1749"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> StoreInst(Output, &amp;&#42;ScalarAI, InsertPt);</Highlight></CodeLine>
<Link id="l01750" /><CodeLine lineNumber="1750"><Highlight kind="normal">      ++ScalarAI;</Highlight></CodeLine>
<Link id="l01751" /><CodeLine lineNumber="1751"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01752" /><CodeLine lineNumber="1752"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01753" /><CodeLine lineNumber="1753"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01754" /><CodeLine lineNumber="1754"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ExtractedFuncRetVals.empty()) &#123;</Highlight></CodeLine>
<Link id="l01755" /><CodeLine lineNumber="1755"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Mark the new function &#96;noreturn&#96; if applicable. Terminators which resume</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01756" /><CodeLine lineNumber="1756"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// exception propagation are treated as returning instructions. This is to</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01757" /><CodeLine lineNumber="1757"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// avoid inserting traps after calls to outlined functions which unwind.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01758" /><CodeLine lineNumber="1758"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a7dc3069afa2ce5ea62ac2eb183e51c00">none&#95;of</a>(Blocks, &#91;&#93;(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> BasicBlock &#42;BB) &#123;</Highlight></CodeLine>
<Link id="l01759" /><CodeLine lineNumber="1759"><Highlight kind="normal">          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;<a href="/docs/api/namespaces/llvm/m68kbeads/#abf9ad6053d17fcef3b68af71aa681944a27d0e059322508a76f918503800ef1bd">Term</a> = BB-&gt;<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>();</Highlight></CodeLine>
<Link id="l01760" /><CodeLine lineNumber="1760"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ReturnInst&gt;</a>(Term) || <a href="/docs/api/namespaces/llvm/#a92ca992e52dddc420f4b069cae06dfbe">isa&lt;ResumeInst&gt;</a>(Term);</Highlight></CodeLine>
<Link id="l01761" /><CodeLine lineNumber="1761"><Highlight kind="normal">        &#125;))</Highlight></CodeLine>
<Link id="l01762" /><CodeLine lineNumber="1762"><Highlight kind="normal">      newFunction-&gt;<a href="/docs/api/classes/llvm/function/#a57d6d47f3d0fe19f5a9bc1626630d4b0">setDoesNotReturn</a>();</Highlight></CodeLine>
<Link id="l01763" /><CodeLine lineNumber="1763"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01764" /><CodeLine lineNumber="1764"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01765" /><CodeLine lineNumber="1765"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01766" /><CodeLine lineNumber="1766"><Highlight kind="normal"><a href="/docs/api/classes/llvm/callinst">CallInst</a> &#42;CodeExtractor::emitReplacerCall(</Highlight></CodeLine>
<Link id="l01767" /><CodeLine lineNumber="1767"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> ValueSet &amp;inputs, </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> ValueSet &amp;outputs,</Highlight></CodeLine>
<Link id="l01768" /><CodeLine lineNumber="1768"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> ValueSet &amp;StructValues, <a href="/docs/api/classes/llvm/function">Function</a> &#42;newFunction,</Highlight></CodeLine>
<Link id="l01769" /><CodeLine lineNumber="1769"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/structtype">StructType</a> &#42;StructArgTy, <a href="/docs/api/classes/llvm/function">Function</a> &#42;oldFunction, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;ReplIP,</Highlight></CodeLine>
<Link id="l01770" /><CodeLine lineNumber="1770"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/blockfrequency">BlockFrequency</a> EntryFreq, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Value &#42;&gt;</a> LifetimesStart,</Highlight></CodeLine>
<Link id="l01771" /><CodeLine lineNumber="1771"><Highlight kind="normal">    std::vector&lt;Value &#42;&gt; &amp;Reloads) &#123;</Highlight></CodeLine>
<Link id="l01772" /><CodeLine lineNumber="1772"><Highlight kind="normal">  LLVMContext &amp;Context = oldFunction-&gt;<a href="/docs/api/classes/llvm/function/#a9fffac2512fe651f0d5e37e27f5bd51c">getContext</a>();</Highlight></CodeLine>
<Link id="l01773" /><CodeLine lineNumber="1773"><Highlight kind="normal">  <a href="/docs/api/files/lib/lib/codegen/machinecheckdebugify-cpp/#a85892acfa8970627e9bd9c9815f15c25">Module</a> &#42;<a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a> = oldFunction-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>();</Highlight></CodeLine>
<Link id="l01774" /><CodeLine lineNumber="1774"><Highlight kind="normal">  </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> DataLayout &amp;<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = <a href="/docs/api/namespaces/llvm/arm/#ac2456158e5acb44477d8ecfa2d04dbdea69691c7bdcc3ce6d5d8a1361f22d04ac">M</a>-&gt;getDataLayout();</Highlight></CodeLine>
<Link id="l01775" /><CodeLine lineNumber="1775"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01776" /><CodeLine lineNumber="1776"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// This takes place of the original loop</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01777" /><CodeLine lineNumber="1777"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;codeReplacer =</Highlight></CodeLine>
<Link id="l01778" /><CodeLine lineNumber="1778"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/basicblock/#a4a5b798214be930cf8e133c032ba0129">BasicBlock::Create</a>(Context, </Highlight><Highlight kind="stringliteral">&quot;codeRepl&quot;</Highlight><Highlight kind="normal">, oldFunction, ReplIP);</Highlight></CodeLine>
<Link id="l01779" /><CodeLine lineNumber="1779"><Highlight kind="normal">  codeReplacer-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab571b8358a3a8b6db1327d06bdc5e9f4">IsNewDbgInfoFormat</a> = oldFunction-&gt;<a href="/docs/api/classes/llvm/function/#a5f470380211ecb6cee767f1ef0f16ed0">IsNewDbgInfoFormat</a>;</Highlight></CodeLine>
<Link id="l01780" /><CodeLine lineNumber="1780"><Highlight kind="normal">  <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;AllocaBlock =</Highlight></CodeLine>
<Link id="l01781" /><CodeLine lineNumber="1781"><Highlight kind="normal">      AllocationBlock ? AllocationBlock : &amp;oldFunction-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>();</Highlight></CodeLine>
<Link id="l01782" /><CodeLine lineNumber="1782"><Highlight kind="normal">  AllocaBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#ab571b8358a3a8b6db1327d06bdc5e9f4">IsNewDbgInfoFormat</a> = oldFunction-&gt;<a href="/docs/api/classes/llvm/function/#a5f470380211ecb6cee767f1ef0f16ed0">IsNewDbgInfoFormat</a>;</Highlight></CodeLine>
<Link id="l01783" /><CodeLine lineNumber="1783"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01784" /><CodeLine lineNumber="1784"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update the entry count of the function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01785" /><CodeLine lineNumber="1785"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BFI)</Highlight></CodeLine>
<Link id="l01786" /><CodeLine lineNumber="1786"><Highlight kind="normal">    BFI-&gt;setBlockFreq(codeReplacer, EntryFreq);</Highlight></CodeLine>
<Link id="l01787" /><CodeLine lineNumber="1787"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01788" /><CodeLine lineNumber="1788"><Highlight kind="normal">  std::vector&lt;Value &#42;&gt; params;</Highlight></CodeLine>
<Link id="l01789" /><CodeLine lineNumber="1789"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01790" /><CodeLine lineNumber="1790"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add inputs as params, or to be filled into the struct</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01791" /><CodeLine lineNumber="1791"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;input : inputs) &#123;</Highlight></CodeLine>
<Link id="l01792" /><CodeLine lineNumber="1792"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StructValues.contains(input))</Highlight></CodeLine>
<Link id="l01793" /><CodeLine lineNumber="1793"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01794" /><CodeLine lineNumber="1794"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01795" /><CodeLine lineNumber="1795"><Highlight kind="normal">    params.push&#95;back(input);</Highlight></CodeLine>
<Link id="l01796" /><CodeLine lineNumber="1796"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01797" /><CodeLine lineNumber="1797"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01798" /><CodeLine lineNumber="1798"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Create allocas for the outputs</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01799" /><CodeLine lineNumber="1799"><Highlight kind="normal">  std::vector&lt;Value &#42;&gt; ReloadOutputs;</Highlight></CodeLine>
<Link id="l01800" /><CodeLine lineNumber="1800"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;output : outputs) &#123;</Highlight></CodeLine>
<Link id="l01801" /><CodeLine lineNumber="1801"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StructValues.contains(output))</Highlight></CodeLine>
<Link id="l01802" /><CodeLine lineNumber="1802"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01803" /><CodeLine lineNumber="1803"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01804" /><CodeLine lineNumber="1804"><Highlight kind="normal">    AllocaInst &#42;alloca = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> AllocaInst(</Highlight></CodeLine>
<Link id="l01805" /><CodeLine lineNumber="1805"><Highlight kind="normal">        output-&gt;getType(), <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getAllocaAddrSpace(), </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01806" /><CodeLine lineNumber="1806"><Highlight kind="normal">        output-&gt;<a href="/docs/api/classes/llvm/machinebasicblock/#aedf6cb1135961f41f39dc58ca8576123">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.loc&quot;</Highlight><Highlight kind="normal">, AllocaBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</Highlight></CodeLine>
<Link id="l01807" /><CodeLine lineNumber="1807"><Highlight kind="normal">    params.push&#95;back(alloca);</Highlight></CodeLine>
<Link id="l01808" /><CodeLine lineNumber="1808"><Highlight kind="normal">    ReloadOutputs.push&#95;back(alloca);</Highlight></CodeLine>
<Link id="l01809" /><CodeLine lineNumber="1809"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01810" /><CodeLine lineNumber="1810"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01811" /><CodeLine lineNumber="1811"><Highlight kind="normal">  AllocaInst &#42;<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a763a932e166ac85a6d2d1606e8649993">Struct</a> = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01812" /><CodeLine lineNumber="1812"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!StructValues.empty()) &#123;</Highlight></CodeLine>
<Link id="l01813" /><CodeLine lineNumber="1813"><Highlight kind="normal">    <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a763a932e166ac85a6d2d1606e8649993">Struct</a> = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> AllocaInst(StructArgTy, <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getAllocaAddrSpace(), </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01814" /><CodeLine lineNumber="1814"><Highlight kind="normal">                            </Highlight><Highlight kind="stringliteral">&quot;structArg&quot;</Highlight><Highlight kind="normal">, AllocaBlock-&gt;<a href="/docs/api/classes/llvm/basicblock/#a161fd4e9fa5367f64c2a4c9e921c3ad3">getFirstInsertionPt</a>());</Highlight></CodeLine>
<Link id="l01815" /><CodeLine lineNumber="1815"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (ArgsInZeroAddressSpace &amp;&amp; <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>.getAllocaAddrSpace() != 0) &#123;</Highlight></CodeLine>
<Link id="l01816" /><CodeLine lineNumber="1816"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;StructSpaceCast = </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> AddrSpaceCastInst(</Highlight></CodeLine>
<Link id="l01817" /><CodeLine lineNumber="1817"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a763a932e166ac85a6d2d1606e8649993">Struct</a>, PointerType ::get(Context, 0), </Highlight><Highlight kind="stringliteral">&quot;structArg.ascast&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l01818" /><CodeLine lineNumber="1818"><Highlight kind="normal">      StructSpaceCast-&gt;insertAfter(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a763a932e166ac85a6d2d1606e8649993">Struct</a>-&gt;getIterator());</Highlight></CodeLine>
<Link id="l01819" /><CodeLine lineNumber="1819"><Highlight kind="normal">      params.push&#95;back(StructSpaceCast);</Highlight></CodeLine>
<Link id="l01820" /><CodeLine lineNumber="1820"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01821" /><CodeLine lineNumber="1821"><Highlight kind="normal">      params.push&#95;back(<a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a763a932e166ac85a6d2d1606e8649993">Struct</a>);</Highlight></CodeLine>
<Link id="l01822" /><CodeLine lineNumber="1822"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01823" /><CodeLine lineNumber="1823"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01824" /><CodeLine lineNumber="1824"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AggIdx = 0;</Highlight></CodeLine>
<Link id="l01825" /><CodeLine lineNumber="1825"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (<a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;input : inputs) &#123;</Highlight></CodeLine>
<Link id="l01826" /><CodeLine lineNumber="1826"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!StructValues.contains(input))</Highlight></CodeLine>
<Link id="l01827" /><CodeLine lineNumber="1827"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01828" /><CodeLine lineNumber="1828"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01829" /><CodeLine lineNumber="1829"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Idx&#91;2&#93;;</Highlight></CodeLine>
<Link id="l01830" /><CodeLine lineNumber="1830"><Highlight kind="normal">      Idx&#91;0&#93; = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Context));</Highlight></CodeLine>
<Link id="l01831" /><CodeLine lineNumber="1831"><Highlight kind="normal">      Idx&#91;1&#93; = ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Context), AggIdx);</Highlight></CodeLine>
<Link id="l01832" /><CodeLine lineNumber="1832"><Highlight kind="normal">      GetElementPtrInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/classes/llvm/getelementptrinst/#a7e5d474f9fda4b2b2e5de3dcfefcc472">GetElementPtrInst::Create</a>(</Highlight></CodeLine>
<Link id="l01833" /><CodeLine lineNumber="1833"><Highlight kind="normal">          StructArgTy, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a763a932e166ac85a6d2d1606e8649993">Struct</a>, Idx, </Highlight><Highlight kind="stringliteral">&quot;gep&#95;&quot;</Highlight><Highlight kind="normal"> + input-&gt;getName());</Highlight></CodeLine>
<Link id="l01834" /><CodeLine lineNumber="1834"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;insertInto(codeReplacer, codeReplacer-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</Highlight></CodeLine>
<Link id="l01835" /><CodeLine lineNumber="1835"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> StoreInst(input, <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>, codeReplacer);</Highlight></CodeLine>
<Link id="l01836" /><CodeLine lineNumber="1836"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01837" /><CodeLine lineNumber="1837"><Highlight kind="normal">      ++AggIdx;</Highlight></CodeLine>
<Link id="l01838" /><CodeLine lineNumber="1838"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01839" /><CodeLine lineNumber="1839"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01840" /><CodeLine lineNumber="1840"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01841" /><CodeLine lineNumber="1841"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Emit the call to the function</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01842" /><CodeLine lineNumber="1842"><Highlight kind="normal">  CallInst &#42;call = <a href="/docs/api/classes/llvm/callinst/#aa04721251be00370fbde6d21f47fed1a">CallInst::Create</a>(</Highlight></CodeLine>
<Link id="l01843" /><CodeLine lineNumber="1843"><Highlight kind="normal">      newFunction, params, ExtractedFuncRetVals.size() &gt; 1 ? </Highlight><Highlight kind="stringliteral">&quot;targetBlock&quot;</Highlight><Highlight kind="normal"> : </Highlight><Highlight kind="stringliteral">&quot;&quot;</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01844" /><CodeLine lineNumber="1844"><Highlight kind="normal">      codeReplacer);</Highlight></CodeLine>
<Link id="l01845" /><CodeLine lineNumber="1845"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01846" /><CodeLine lineNumber="1846"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Set swifterror parameter attributes.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01847" /><CodeLine lineNumber="1847"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> ParamIdx = 0;</Highlight></CodeLine>
<Link id="l01848" /><CodeLine lineNumber="1848"><Highlight kind="normal">  </Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> AggIdx = 0;</Highlight></CodeLine>
<Link id="l01849" /><CodeLine lineNumber="1849"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> input : inputs) &#123;</Highlight></CodeLine>
<Link id="l01850" /><CodeLine lineNumber="1850"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StructValues.contains(input)) &#123;</Highlight></CodeLine>
<Link id="l01851" /><CodeLine lineNumber="1851"><Highlight kind="normal">      ++AggIdx;</Highlight></CodeLine>
<Link id="l01852" /><CodeLine lineNumber="1852"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01853" /><CodeLine lineNumber="1853"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (input-&gt;isSwiftError())</Highlight></CodeLine>
<Link id="l01854" /><CodeLine lineNumber="1854"><Highlight kind="normal">        call-&gt;<a href="/docs/api/classes/llvm/callbase/#ae5d05ec2b9a60806746addff3f2a71a9">addParamAttr</a>(ParamIdx, Attribute::SwiftError);</Highlight></CodeLine>
<Link id="l01855" /><CodeLine lineNumber="1855"><Highlight kind="normal">      ++ParamIdx;</Highlight></CodeLine>
<Link id="l01856" /><CodeLine lineNumber="1856"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01857" /><CodeLine lineNumber="1857"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01858" /><CodeLine lineNumber="1858"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01859" /><CodeLine lineNumber="1859"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Add debug location to the new call, if the original function has debug</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01860" /><CodeLine lineNumber="1860"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// info. In that case, the terminator of the entry block of the extracted</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01861" /><CodeLine lineNumber="1861"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// function contains the first debug location of the extracted function,</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01862" /><CodeLine lineNumber="1862"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// set in extractCodeRegion.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01863" /><CodeLine lineNumber="1863"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (codeReplacer-&gt;<a href="/docs/api/classes/llvm/basicblock/#a1b4bf7c97cdc8159fd73d48063f0b250">getParent</a>()-&gt;<a href="/docs/api/classes/llvm/function/#a4d834f9897d15e3a6349063b5d637cd8">getSubprogram</a>()) &#123;</Highlight></CodeLine>
<Link id="l01864" /><CodeLine lineNumber="1864"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a> = newFunction-&gt;<a href="/docs/api/classes/llvm/function/#a169f0c26ef46161741fdd120a806f853">getEntryBlock</a>().<a href="/docs/api/classes/llvm/basicblock/#aef9e9fcf4c5dfce90276ca16d91b8e46">getTerminator</a>()-&gt;<a href="/docs/api/classes/llvm/instruction/#a4b8faae4ff9e7434a1d226d03d15dcd2">getDebugLoc</a>())</Highlight></CodeLine>
<Link id="l01865" /><CodeLine lineNumber="1865"><Highlight kind="normal">      call-&gt;<a href="/docs/api/classes/llvm/instruction/#ae8f5bf5cc06f696b52c709677df00fbf">setDebugLoc</a>(<a href="/docs/api/files/lib/lib/target/lib/target/arm/armslshardening-cpp/#ad467c4ab9119043f9b7750ab986be61a">DL</a>);</Highlight></CodeLine>
<Link id="l01866" /><CodeLine lineNumber="1866"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01867" /><CodeLine lineNumber="1867"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01868" /><CodeLine lineNumber="1868"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Reload the outputs passed in by reference, use the struct if output is in</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01869" /><CodeLine lineNumber="1869"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// the aggregate or reload from the scalar argument.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01870" /><CodeLine lineNumber="1870"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = outputs.size(), scalarIdx = 0; i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l01871" /><CodeLine lineNumber="1871"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Output = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01872" /><CodeLine lineNumber="1872"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (StructValues.contains(outputs&#91;i&#93;)) &#123;</Highlight></CodeLine>
<Link id="l01873" /><CodeLine lineNumber="1873"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;Idx&#91;2&#93;;</Highlight></CodeLine>
<Link id="l01874" /><CodeLine lineNumber="1874"><Highlight kind="normal">      Idx&#91;0&#93; = <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Context));</Highlight></CodeLine>
<Link id="l01875" /><CodeLine lineNumber="1875"><Highlight kind="normal">      Idx&#91;1&#93; = ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a30dd396c5b40cd86c1591872e574ccdf">Type::getInt32Ty</a>(Context), AggIdx);</Highlight></CodeLine>
<Link id="l01876" /><CodeLine lineNumber="1876"><Highlight kind="normal">      GetElementPtrInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a> = <a href="/docs/api/classes/llvm/getelementptrinst/#a7e5d474f9fda4b2b2e5de3dcfefcc472">GetElementPtrInst::Create</a>(</Highlight></CodeLine>
<Link id="l01877" /><CodeLine lineNumber="1877"><Highlight kind="normal">          StructArgTy, <a href="/docs/api/files/lib/lib/analysis/targetlibraryinfo-cpp/#aca185e6d0e9f423dbb24440206454872a763a932e166ac85a6d2d1606e8649993">Struct</a>, Idx, </Highlight><Highlight kind="stringliteral">&quot;gep&#95;reload&#95;&quot;</Highlight><Highlight kind="normal"> + outputs&#91;i&#93;-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/provenanceanalysisevaluator-cpp/#a2ee79648e8bce3ddbb26358ff10e3e82">getName</a>());</Highlight></CodeLine>
<Link id="l01878" /><CodeLine lineNumber="1878"><Highlight kind="normal">      <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>-&gt;insertInto(codeReplacer, codeReplacer-&gt;<a href="/docs/api/classes/llvm/basicblock/#a0b4e7bee9b8575cc7db73329f1a561bd">end</a>());</Highlight></CodeLine>
<Link id="l01879" /><CodeLine lineNumber="1879"><Highlight kind="normal">      Output = <a href="/docs/api/files/lib/lib/target/lib/target/hexagon/hexagoncommongep-cpp/#ad532e8710e50302e0a376b61c91fa91d">GEP</a>;</Highlight></CodeLine>
<Link id="l01880" /><CodeLine lineNumber="1880"><Highlight kind="normal">      ++AggIdx;</Highlight></CodeLine>
<Link id="l01881" /><CodeLine lineNumber="1881"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01882" /><CodeLine lineNumber="1882"><Highlight kind="normal">      Output = ReloadOutputs&#91;scalarIdx&#93;;</Highlight></CodeLine>
<Link id="l01883" /><CodeLine lineNumber="1883"><Highlight kind="normal">      ++scalarIdx;</Highlight></CodeLine>
<Link id="l01884" /><CodeLine lineNumber="1884"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01885" /><CodeLine lineNumber="1885"><Highlight kind="normal">    LoadInst &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpumarklastscratchload-cpp/#a8a3fe89940744b94ffe5dacd6704c2be">load</a> =</Highlight></CodeLine>
<Link id="l01886" /><CodeLine lineNumber="1886"><Highlight kind="normal">        </Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> LoadInst(outputs&#91;i&#93;-&gt;<a href="/docs/api/files/lib/lib/object/tapifile-cpp/#a913a691648e20063bbd278e8f02d8430">getType</a>(), Output,</Highlight></CodeLine>
<Link id="l01887" /><CodeLine lineNumber="1887"><Highlight kind="normal">                     outputs&#91;i&#93;-&gt;<a href="/docs/api/files/lib/lib/transforms/lib/transforms/objcarc/provenanceanalysisevaluator-cpp/#a2ee79648e8bce3ddbb26358ff10e3e82">getName</a>() + </Highlight><Highlight kind="stringliteral">&quot;.reload&quot;</Highlight><Highlight kind="normal">, codeReplacer);</Highlight></CodeLine>
<Link id="l01888" /><CodeLine lineNumber="1888"><Highlight kind="normal">    Reloads.push&#95;back(<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpumarklastscratchload-cpp/#a8a3fe89940744b94ffe5dacd6704c2be">load</a>);</Highlight></CodeLine>
<Link id="l01889" /><CodeLine lineNumber="1889"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01890" /><CodeLine lineNumber="1890"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01891" /><CodeLine lineNumber="1891"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now we can emit a switch statement using the call as a value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01892" /><CodeLine lineNumber="1892"><Highlight kind="normal">  SwitchInst &#42;TheSwitch =</Highlight></CodeLine>
<Link id="l01893" /><CodeLine lineNumber="1893"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/switchinst/#a3c1416226bed5e92acb74aebe8e20f5a">SwitchInst::Create</a>(<a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(<a href="/docs/api/classes/llvm/type/#a87f56db834c58ca630624956ecf6972f">Type::getInt16Ty</a>(Context)),</Highlight></CodeLine>
<Link id="l01894" /><CodeLine lineNumber="1894"><Highlight kind="normal">                         codeReplacer, 0, codeReplacer);</Highlight></CodeLine>
<Link id="l01895" /><CodeLine lineNumber="1895"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a> : <a href="/docs/api/namespaces/llvm/#a206e2134ddd2312c3488d0632d98f554">enumerate</a>(ExtractedFuncRetVals)) &#123;</Highlight></CodeLine>
<Link id="l01896" /><CodeLine lineNumber="1896"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/isd/#a22ea9cec080dd5f4f47ba234c2f59110a8472e46f9e4db168c5610ecdfb05dbaf">BasicBlock</a> &#42;OldTarget = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.value();</Highlight></CodeLine>
<Link id="l01897" /><CodeLine lineNumber="1897"><Highlight kind="normal">    </Highlight><Highlight kind="keywordtype">size&#95;t</Highlight><Highlight kind="normal"> SuccNum = <a href="/docs/api/files/lib/lib/option/option-cpp/#a04665169063c8ca1f2ea96c27fc7c2b2">P</a>.index();</Highlight></CodeLine>
<Link id="l01898" /><CodeLine lineNumber="1898"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01899" /><CodeLine lineNumber="1899"><Highlight kind="normal">    TheSwitch-&gt;<a href="/docs/api/classes/llvm/switchinst/#a62abc2475d09c01d583ba24a487898fd">addCase</a>(ConstantInt::get(<a href="/docs/api/classes/llvm/type/#a87f56db834c58ca630624956ecf6972f">Type::getInt16Ty</a>(Context), SuccNum),</Highlight></CodeLine>
<Link id="l01900" /><CodeLine lineNumber="1900"><Highlight kind="normal">                       OldTarget);</Highlight></CodeLine>
<Link id="l01901" /><CodeLine lineNumber="1901"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01902" /><CodeLine lineNumber="1902"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01903" /><CodeLine lineNumber="1903"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Now that we&#39;ve done the deed, simplify the switch instruction.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01904" /><CodeLine lineNumber="1904"><Highlight kind="normal">  <a href="/docs/api/files/include/include/llvm/include/llvm/demangle/itaniumdemangle-h/#a88ee8e4eea43084bd8964682683da88caa1fa27779242b4902f7ae3bdd5c6d508">Type</a> &#42;OldFnRetTy = TheSwitch-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent()-&gt;getReturnType();</Highlight></CodeLine>
<Link id="l01905" /><CodeLine lineNumber="1905"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">switch</Highlight><Highlight kind="normal"> (ExtractedFuncRetVals.size()) &#123;</Highlight></CodeLine>
<Link id="l01906" /><CodeLine lineNumber="1906"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> 0:</Highlight></CodeLine>
<Link id="l01907" /><CodeLine lineNumber="1907"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// There are no successors (the block containing the switch itself), which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01908" /><CodeLine lineNumber="1908"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// means that previously this was the last part of the function, and hence</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01909" /><CodeLine lineNumber="1909"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// this should be rewritten as a &#96;ret&#96; or &#96;unreachable&#96;.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01910" /><CodeLine lineNumber="1910"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (newFunction-&gt;<a href="/docs/api/classes/llvm/function/#ab8ef748e928424955da3d1f6676b25d9">doesNotReturn</a>()) &#123;</Highlight></CodeLine>
<Link id="l01911" /><CodeLine lineNumber="1911"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// If fn is no return, end with an unreachable terminator.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01912" /><CodeLine lineNumber="1912"><Highlight kind="normal">      (void)</Highlight><Highlight kind="keyword">new</Highlight><Highlight kind="normal"> UnreachableInst(Context, TheSwitch-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01913" /><CodeLine lineNumber="1913"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OldFnRetTy-&gt;<a href="/docs/api/classes/llvm/type/#ae8eaa0b4eeac52a2b2282cb1bfd981ae">isVoidTy</a>()) &#123;</Highlight></CodeLine>
<Link id="l01914" /><CodeLine lineNumber="1914"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// We have no return value.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01915" /><CodeLine lineNumber="1915"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/returninst/#a932710d4c1c965497707751eb4f7948f">ReturnInst::Create</a>(Context, </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">,</Highlight></CodeLine>
<Link id="l01916" /><CodeLine lineNumber="1916"><Highlight kind="normal">                         TheSwitch-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>()); </Highlight><Highlight kind="comment">// Return void</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01917" /><CodeLine lineNumber="1917"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (OldFnRetTy == TheSwitch-&gt;<a href="/docs/api/classes/llvm/switchinst/#add8214051c768ea9d437cac4b6d50c56">getCondition</a>()-&gt;<a href="/docs/api/classes/llvm/value/#a0344a49526443edf90cc0aef3abd3337">getType</a>()) &#123;</Highlight></CodeLine>
<Link id="l01918" /><CodeLine lineNumber="1918"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// return what we have</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01919" /><CodeLine lineNumber="1919"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/returninst/#a932710d4c1c965497707751eb4f7948f">ReturnInst::Create</a>(Context, TheSwitch-&gt;<a href="/docs/api/classes/llvm/switchinst/#add8214051c768ea9d437cac4b6d50c56">getCondition</a>(),</Highlight></CodeLine>
<Link id="l01920" /><CodeLine lineNumber="1920"><Highlight kind="normal">                         TheSwitch-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01921" /><CodeLine lineNumber="1921"><Highlight kind="normal">    &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"> &#123;</Highlight></CodeLine>
<Link id="l01922" /><CodeLine lineNumber="1922"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// Otherwise we must have code extracted an unwind or something, just</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01923" /><CodeLine lineNumber="1923"><Highlight kind="normal">      </Highlight><Highlight kind="comment">// return whatever we want.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01924" /><CodeLine lineNumber="1924"><Highlight kind="normal">      <a href="/docs/api/classes/llvm/returninst/#a932710d4c1c965497707751eb4f7948f">ReturnInst::Create</a>(Context, <a href="/docs/api/classes/llvm/constant/#aa6574d526b3e38a28f688a7bb4325c2c">Constant::getNullValue</a>(OldFnRetTy),</Highlight></CodeLine>
<Link id="l01925" /><CodeLine lineNumber="1925"><Highlight kind="normal">                         TheSwitch-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01926" /><CodeLine lineNumber="1926"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l01927" /><CodeLine lineNumber="1927"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01928" /><CodeLine lineNumber="1928"><Highlight kind="normal">    TheSwitch-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01929" /><CodeLine lineNumber="1929"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01930" /><CodeLine lineNumber="1930"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> 1:</Highlight></CodeLine>
<Link id="l01931" /><CodeLine lineNumber="1931"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Only a single destination, change the switch into an unconditional</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01932" /><CodeLine lineNumber="1932"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01933" /><CodeLine lineNumber="1933"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(TheSwitch-&gt;<a href="/docs/api/classes/llvm/switchinst/#a30f79d54afada3c9005d24ab8743a9d6">getSuccessor</a>(1), TheSwitch-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01934" /><CodeLine lineNumber="1934"><Highlight kind="normal">    TheSwitch-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01935" /><CodeLine lineNumber="1935"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01936" /><CodeLine lineNumber="1936"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">case</Highlight><Highlight kind="normal"> 2:</Highlight></CodeLine>
<Link id="l01937" /><CodeLine lineNumber="1937"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Only two destinations, convert to a condition branch.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01938" /><CodeLine lineNumber="1938"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remark: This also swaps the target branches:</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01939" /><CodeLine lineNumber="1939"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// 0 -&gt; false -&gt; getSuccessor(2); 1 -&gt; true -&gt; getSuccessor(1)</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01940" /><CodeLine lineNumber="1940"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/branchinst/#a9f40e42226cee617c16cb1c447b115c5">BranchInst::Create</a>(TheSwitch-&gt;<a href="/docs/api/classes/llvm/switchinst/#a30f79d54afada3c9005d24ab8743a9d6">getSuccessor</a>(1), TheSwitch-&gt;<a href="/docs/api/classes/llvm/switchinst/#a30f79d54afada3c9005d24ab8743a9d6">getSuccessor</a>(2),</Highlight></CodeLine>
<Link id="l01941" /><CodeLine lineNumber="1941"><Highlight kind="normal">                       call, TheSwitch-&gt;<a href="/docs/api/classes/llvm/ilist-node-impl/#af719fc783be6589465137d997701a432">getIterator</a>());</Highlight></CodeLine>
<Link id="l01942" /><CodeLine lineNumber="1942"><Highlight kind="normal">    TheSwitch-&gt;<a href="/docs/api/classes/llvm/instruction/#a601ee49a4c4e0babf29bd1cf09036570">eraseFromParent</a>();</Highlight></CodeLine>
<Link id="l01943" /><CodeLine lineNumber="1943"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01944" /><CodeLine lineNumber="1944"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">default</Highlight><Highlight kind="normal">:</Highlight></CodeLine>
<Link id="l01945" /><CodeLine lineNumber="1945"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Otherwise, make the default destination of the switch instruction be one</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01946" /><CodeLine lineNumber="1946"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// of the other successors.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01947" /><CodeLine lineNumber="1947"><Highlight kind="normal">    TheSwitch-&gt;<a href="/docs/api/classes/llvm/switchinst/#a48f1c68131a864a29455ce86c1d571b2">setCondition</a>(call);</Highlight></CodeLine>
<Link id="l01948" /><CodeLine lineNumber="1948"><Highlight kind="normal">    TheSwitch-&gt;<a href="/docs/api/classes/llvm/switchinst/#aa22bdae1cee3c836f2b4cf8307fc7598">setDefaultDest</a>(</Highlight></CodeLine>
<Link id="l01949" /><CodeLine lineNumber="1949"><Highlight kind="normal">        TheSwitch-&gt;<a href="/docs/api/classes/llvm/switchinst/#a30f79d54afada3c9005d24ab8743a9d6">getSuccessor</a>(ExtractedFuncRetVals.size()));</Highlight></CodeLine>
<Link id="l01950" /><CodeLine lineNumber="1950"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// Remove redundant case</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01951" /><CodeLine lineNumber="1951"><Highlight kind="normal">    TheSwitch-&gt;<a href="/docs/api/classes/llvm/switchinst/#aff8bc09200ccc3617a5cb37e0d2f23ff">removeCase</a>(</Highlight></CodeLine>
<Link id="l01952" /><CodeLine lineNumber="1952"><Highlight kind="normal">        <a href="/docs/api/classes/llvm/switchinst/#a723af715edeaedc8ed1048f8c235ce9e">SwitchInst::CaseIt</a>(TheSwitch, ExtractedFuncRetVals.size() - 1));</Highlight></CodeLine>
<Link id="l01953" /><CodeLine lineNumber="1953"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">break</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01954" /><CodeLine lineNumber="1954"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l01955" /><CodeLine lineNumber="1955"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01956" /><CodeLine lineNumber="1956"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Insert lifetime markers around the reloads of any output values. The</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01957" /><CodeLine lineNumber="1957"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// allocas output values are stored in are only in-use in the codeRepl block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01958" /><CodeLine lineNumber="1958"><Highlight kind="normal">  <a href="#ae3b43649c18ab9e63c1be61b93dd7031">insertLifetimeMarkersSurroundingCall</a>(M, ReloadOutputs, ReloadOutputs, call);</Highlight></CodeLine>
<Link id="l01959" /><CodeLine lineNumber="1959"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01960" /><CodeLine lineNumber="1960"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Replicate the effects of any lifetime start/end markers which referenced</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01961" /><CodeLine lineNumber="1961"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// input objects in the extraction region by placing markers around the call.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01962" /><CodeLine lineNumber="1962"><Highlight kind="normal">  <a href="#ae3b43649c18ab9e63c1be61b93dd7031">insertLifetimeMarkersSurroundingCall</a>(oldFunction-&gt;<a href="/docs/api/classes/llvm/globalvalue/#a739b30c811f1eece61b05320ddf44e5b">getParent</a>(), LifetimesStart,</Highlight></CodeLine>
<Link id="l01963" /><CodeLine lineNumber="1963"><Highlight kind="normal">                                       &#123;&#125;, call);</Highlight></CodeLine>
<Link id="l01964" /><CodeLine lineNumber="1964"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01965" /><CodeLine lineNumber="1965"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> call;</Highlight></CodeLine>
<Link id="l01966" /><CodeLine lineNumber="1966"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l01967" /><CodeLine lineNumber="1967"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01968" /><CodeLine lineNumber="1968"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> CodeExtractor::insertReplacerCall(</Highlight></CodeLine>
<Link id="l01969" /><CodeLine lineNumber="1969"><Highlight kind="normal">    <a href="/docs/api/classes/llvm/function">Function</a> &#42;oldFunction, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;header, <a href="/docs/api/classes/llvm/basicblock">BasicBlock</a> &#42;codeReplacer,</Highlight></CodeLine>
<Link id="l01970" /><CodeLine lineNumber="1970"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> ValueSet &amp;outputs, <a href="/docs/api/classes/llvm/arrayref">ArrayRef&lt;Value &#42;&gt;</a> Reloads,</Highlight></CodeLine>
<Link id="l01971" /><CodeLine lineNumber="1971"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/densemap">DenseMap&lt;BasicBlock &#42;, BlockFrequency&gt;</a> &amp;ExitWeights) &#123;</Highlight></CodeLine>
<Link id="l01972" /><CodeLine lineNumber="1972"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01973" /><CodeLine lineNumber="1973"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Rewrite branches to basic blocks outside of the loop to new dummy blocks</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01974" /><CodeLine lineNumber="1974"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// within the new function. This must be done before we lose track of which</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01975" /><CodeLine lineNumber="1975"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// blocks were originally in the code region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01976" /><CodeLine lineNumber="1976"><Highlight kind="normal">  std::vector&lt;User &#42;&gt; <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>(header-&gt;<a href="/docs/api/classes/llvm/value/#a158da2b6d3d938aaa15b6acd00150e2c">user&#95;begin</a>(), header-&gt;<a href="/docs/api/classes/llvm/value/#aa22118b2b3f206bfda2ffab4cda94d64">user&#95;end</a>());</Highlight></CodeLine>
<Link id="l01977" /><CodeLine lineNumber="1977"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &amp;U : <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>)</Highlight></CodeLine>
<Link id="l01978" /><CodeLine lineNumber="1978"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// The BasicBlock which contains the branch is not in the region</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01979" /><CodeLine lineNumber="1979"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// modify the branch target to a new block</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01980" /><CodeLine lineNumber="1980"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (Instruction &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a22eeee01734061ac1b31ccd994c49eef">dyn&#95;cast&lt;Instruction&gt;</a>(U))</Highlight></CodeLine>
<Link id="l01981" /><CodeLine lineNumber="1981"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;isTerminator() &amp;&amp; <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFunction() == oldFunction &amp;&amp;</Highlight></CodeLine>
<Link id="l01982" /><CodeLine lineNumber="1982"><Highlight kind="normal">          !Blocks.count(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getParent()))</Highlight></CodeLine>
<Link id="l01983" /><CodeLine lineNumber="1983"><Highlight kind="normal">        <a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;replaceUsesOfWith(header, codeReplacer);</Highlight></CodeLine>
<Link id="l01984" /><CodeLine lineNumber="1984"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01985" /><CodeLine lineNumber="1985"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// When moving the code region it is sufficient to replace all uses to the</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01986" /><CodeLine lineNumber="1986"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// extracted function values. Since the original definition&#39;s block</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01987" /><CodeLine lineNumber="1987"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// dominated its use, it will also be dominated by codeReplacer&#39;s switch</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01988" /><CodeLine lineNumber="1988"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// which joined multiple exit blocks.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01989" /><CodeLine lineNumber="1989"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (BasicBlock &#42;ExitBB : ExtractedFuncRetVals)</Highlight></CodeLine>
<Link id="l01990" /><CodeLine lineNumber="1990"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (PHINode &amp;PN : ExitBB-&gt;phis()) &#123;</Highlight></CodeLine>
<Link id="l01991" /><CodeLine lineNumber="1991"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;IncomingCodeReplacerVal = </Highlight><Highlight kind="keyword">nullptr</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01992" /><CodeLine lineNumber="1992"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = PN.<a href="/docs/api/classes/llvm/phinode/#aef51af4b490af6b3bf2dfbc8737a8f9f">getNumIncomingValues</a>(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l01993" /><CodeLine lineNumber="1993"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Ignore incoming values from outside of the extracted region.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01994" /><CodeLine lineNumber="1994"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!Blocks.count(PN.<a href="/docs/api/classes/llvm/phinode/#ac53e1aabdf64e91b8b325bcac250d8a9">getIncomingBlock</a>(i)))</Highlight></CodeLine>
<Link id="l01995" /><CodeLine lineNumber="1995"><Highlight kind="normal">          </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l01996" /><CodeLine lineNumber="1996"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01997" /><CodeLine lineNumber="1997"><Highlight kind="normal">        </Highlight><Highlight kind="comment">// Ensure that there is only one incoming value from codeReplacer.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l01998" /><CodeLine lineNumber="1998"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!IncomingCodeReplacerVal) &#123;</Highlight></CodeLine>
<Link id="l01999" /><CodeLine lineNumber="1999"><Highlight kind="normal">          PN.<a href="/docs/api/classes/llvm/phinode/#a5ba57877c55dfdbe6e3bbfdacd9ef8c1">setIncomingBlock</a>(i, codeReplacer);</Highlight></CodeLine>
<Link id="l02000" /><CodeLine lineNumber="2000"><Highlight kind="normal">          IncomingCodeReplacerVal = PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i);</Highlight></CodeLine>
<Link id="l02001" /><CodeLine lineNumber="2001"><Highlight kind="normal">        &#125; </Highlight><Highlight kind="keywordflow">else</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02002" /><CodeLine lineNumber="2002"><Highlight kind="normal">          <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/silowercontrolflow-cpp/#a4868c5d81c5ccc98c47aeab6244346a0">assert</a>(IncomingCodeReplacerVal == PN.<a href="/docs/api/classes/llvm/phinode/#aca1fd00f3ab63ec8f0f1ccc2093a9f6d">getIncomingValue</a>(i) &amp;&amp;</Highlight></CodeLine>
<Link id="l02003" /><CodeLine lineNumber="2003"><Highlight kind="normal">                 </Highlight><Highlight kind="stringliteral">&quot;PHI has two incompatbile incoming values from codeRepl&quot;</Highlight><Highlight kind="normal">);</Highlight></CodeLine>
<Link id="l02004" /><CodeLine lineNumber="2004"><Highlight kind="normal">      &#125;</Highlight></CodeLine>
<Link id="l02005" /><CodeLine lineNumber="2005"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02006" /><CodeLine lineNumber="2006"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02007" /><CodeLine lineNumber="2007"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keywordtype">unsigned</Highlight><Highlight kind="normal"> i = 0, e = outputs.size(); i != e; ++i) &#123;</Highlight></CodeLine>
<Link id="l02008" /><CodeLine lineNumber="2008"><Highlight kind="normal">    <a href="/docs/api/namespaces/llvm/#a066e2a31a13d6520e52ae1944f194662">Value</a> &#42;<a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpumarklastscratchload-cpp/#a8a3fe89940744b94ffe5dacd6704c2be">load</a> = Reloads&#91;i&#93;;</Highlight></CodeLine>
<Link id="l02009" /><CodeLine lineNumber="2009"><Highlight kind="normal">    std::vector&lt;User &#42;&gt; <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>(outputs&#91;i&#93;-&gt;user&#95;begin(), outputs&#91;i&#93;-&gt;user&#95;end());</Highlight></CodeLine>
<Link id="l02010" /><CodeLine lineNumber="2010"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (User &#42;U : <a href="/docs/api/files/lib/lib/analysis/ivusers-cpp/#a4e5b9edb51eec9dbca592075eb64dfcb">Users</a>) &#123;</Highlight></CodeLine>
<Link id="l02011" /><CodeLine lineNumber="2011"><Highlight kind="normal">      <a href="/docs/api/namespaces/llvm/sandboxir/#a75d3582b0f0bc7a5123de92ada301e97">Instruction</a> &#42;inst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(U);</Highlight></CodeLine>
<Link id="l02012" /><CodeLine lineNumber="2012"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (inst-&gt;<a href="/docs/api/classes/llvm/ilist-detail/node-parent-access/#a7e19e7508415378ad9523e0339b23e22">getParent</a>()-&gt;getParent() == oldFunction)</Highlight></CodeLine>
<Link id="l02013" /><CodeLine lineNumber="2013"><Highlight kind="normal">        inst-&gt;<a href="/docs/api/classes/llvm/user/#a1600c7959045cb6b6a5f5a1d427ec67e">replaceUsesOfWith</a>(outputs&#91;i&#93;, <a href="/docs/api/files/lib/lib/target/lib/target/amdgpu/amdgpumarklastscratchload-cpp/#a8a3fe89940744b94ffe5dacd6704c2be">load</a>);</Highlight></CodeLine>
<Link id="l02014" /><CodeLine lineNumber="2014"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02015" /><CodeLine lineNumber="2015"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02016" /><CodeLine lineNumber="2016"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02017" /><CodeLine lineNumber="2017"><Highlight kind="normal">  </Highlight><Highlight kind="comment">// Update the branch weights for the exit block.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02018" /><CodeLine lineNumber="2018"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (BFI &amp;&amp; ExtractedFuncRetVals.size() &gt; 1)</Highlight></CodeLine>
<Link id="l02019" /><CodeLine lineNumber="2019"><Highlight kind="normal">    calculateNewCallTerminatorWeights(codeReplacer, ExitWeights, BPI);</Highlight></CodeLine>
<Link id="l02020" /><CodeLine lineNumber="2020"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02021" /><CodeLine lineNumber="2021"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02022" /><CodeLine lineNumber="2022" lineLink="/docs/api/classes/llvm/codeextractor/#a995ee70f3e9a0cb350322bb1e058a707"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">bool</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/codeextractor/#a995ee70f3e9a0cb350322bb1e058a707">CodeExtractor::verifyAssumptionCache</a>(</Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;OldFunc,</Highlight></CodeLine>
<Link id="l02023" /><CodeLine lineNumber="2023"><Highlight kind="normal">                                          </Highlight><Highlight kind="keyword">const</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/function">Function</a> &amp;NewFunc,</Highlight></CodeLine>
<Link id="l02024" /><CodeLine lineNumber="2024"><Highlight kind="normal">                                          <a href="/docs/api/classes/llvm/assumptioncache">AssumptionCache</a> &#42;AC) &#123;</Highlight></CodeLine>
<Link id="l02025" /><CodeLine lineNumber="2025"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> AssumeVH : AC-&gt;assumptions()) &#123;</Highlight></CodeLine>
<Link id="l02026" /><CodeLine lineNumber="2026"><Highlight kind="normal">    </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a> = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;CallInst&gt;</a>(AssumeVH);</Highlight></CodeLine>
<Link id="l02027" /><CodeLine lineNumber="2027"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>)</Highlight></CodeLine>
<Link id="l02028" /><CodeLine lineNumber="2028"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02029" /><CodeLine lineNumber="2029"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02030" /><CodeLine lineNumber="2030"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// There shouldn&#39;t be any llvm.assume intrinsics in the new function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02031" /><CodeLine lineNumber="2031"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getFunction() != &amp;OldFunc)</Highlight></CodeLine>
<Link id="l02032" /><CodeLine lineNumber="2032"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02033" /><CodeLine lineNumber="2033"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02034" /><CodeLine lineNumber="2034"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// There shouldn&#39;t be any stale affected values in the assumption cache</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02035" /><CodeLine lineNumber="2035"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// that were previously in the old function, but that have now been moved</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02036" /><CodeLine lineNumber="2036"><Highlight kind="normal">    </Highlight><Highlight kind="comment">// to the new function.</Highlight><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02037" /><CodeLine lineNumber="2037"><Highlight kind="normal">    </Highlight><Highlight kind="keywordflow">for</Highlight><Highlight kind="normal"> (</Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> AffectedValVH : AC-&gt;assumptionsFor(<a href="/docs/api/files/lib/lib/support/md5-cpp/#ac0eafdc9ee161b71e7af98af736952fd">I</a>-&gt;getOperand(0))) &#123;</Highlight></CodeLine>
<Link id="l02038" /><CodeLine lineNumber="2038"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AffectedCI = <a href="/docs/api/namespaces/llvm/#a5f6182886dc2f96c204299e92c1565d5">dyn&#95;cast&#95;or&#95;null&lt;CallInst&gt;</a>(AffectedValVH);</Highlight></CodeLine>
<Link id="l02039" /><CodeLine lineNumber="2039"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (!AffectedCI)</Highlight></CodeLine>
<Link id="l02040" /><CodeLine lineNumber="2040"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">continue</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02041" /><CodeLine lineNumber="2041"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AffectedCI-&gt;getFunction() != &amp;OldFunc)</Highlight></CodeLine>
<Link id="l02042" /><CodeLine lineNumber="2042"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02043" /><CodeLine lineNumber="2043"><Highlight kind="normal">      </Highlight><Highlight kind="keyword">auto</Highlight><Highlight kind="normal"> &#42;AssumedInst = <a href="/docs/api/namespaces/llvm/#ac4fc845f5ed92de63cd4474f128f5fc5">cast&lt;Instruction&gt;</a>(AffectedCI-&gt;getOperand(0));</Highlight></CodeLine>
<Link id="l02044" /><CodeLine lineNumber="2044"><Highlight kind="normal">      </Highlight><Highlight kind="keywordflow">if</Highlight><Highlight kind="normal"> (AssumedInst-&gt;getFunction() != &amp;OldFunc)</Highlight></CodeLine>
<Link id="l02045" /><CodeLine lineNumber="2045"><Highlight kind="normal">        </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">true</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02046" /><CodeLine lineNumber="2046"><Highlight kind="normal">    &#125;</Highlight></CodeLine>
<Link id="l02047" /><CodeLine lineNumber="2047"><Highlight kind="normal">  &#125;</Highlight></CodeLine>
<Link id="l02048" /><CodeLine lineNumber="2048"><Highlight kind="normal">  </Highlight><Highlight kind="keywordflow">return</Highlight><Highlight kind="normal"> </Highlight><Highlight kind="keyword">false</Highlight><Highlight kind="normal">;</Highlight></CodeLine>
<Link id="l02049" /><CodeLine lineNumber="2049"><Highlight kind="normal">&#125;</Highlight></CodeLine>
<Link id="l02050" /><CodeLine lineNumber="2050"><Highlight kind="normal"></Highlight></CodeLine>
<Link id="l02051" /><CodeLine lineNumber="2051" lineLink="/docs/api/classes/llvm/codeextractor/#ad4d03968d09741d23f5b83e7a538f04f"><Highlight kind="normal"></Highlight><Highlight kind="keywordtype">void</Highlight><Highlight kind="normal"> <a href="/docs/api/classes/llvm/codeextractor/#ad4d03968d09741d23f5b83e7a538f04f">CodeExtractor::excludeArgFromAggregate</a>(<a href="/docs/api/classes/llvm/value">Value</a> &#42;Arg) &#123;</Highlight></CodeLine>
<Link id="l02052" /><CodeLine lineNumber="2052"><Highlight kind="normal">  ExcludeArgsFromAggregate.insert(Arg);</Highlight></CodeLine>
<Link id="l02053" /><CodeLine lineNumber="2053"><Highlight kind="normal">&#125;</Highlight></CodeLine>

</ProgramListing>

</DoxygenPage>
